!function(t){function e(r){if(n[r])return n[r].exports;var o=n[r]={exports:{},id:r,loaded:!1};return t[r].call(o.exports,o,o.exports,e),o.loaded=!0,o.exports}var n={};return e.m=t,e.c=n,e.p="/",e(0)}([function(t,e,n){"use strict";function r(t){return t&&t.__esModule?t:{"default":t}}Object.defineProperty(e,"__esModule",{value:!0});var o=n(1),i=r(o),s=n(7),u=r(s);if(window){window.Climb=window.Climb||{};for(var c=document.querySelectorAll(".climb-wall"),h=0;h<c.length;++h){var a=c[h],p=a.dataset.collectionId,f=a.dataset.limit;i["default"].render(i["default"].createElement(u["default"],{collectionId:p,limit:f}),a)}}e["default"]=u["default"],t.exports=e["default"]},function(t,e){t.exports=React},function(t,e,n){"use strict";function r(t){return t&&t.__esModule?t:{"default":t}}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function i(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(e,"__esModule",{value:!0});var s=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),u=function(t,e,n){for(var r=!0;r;){var o=t,i=e,s=n;u=h=c=void 0,r=!1,null===o&&(o=Function.prototype);var u=Object.getOwnPropertyDescriptor(o,i);if(void 0!==u){if("value"in u)return u.value;var c=u.get;return void 0===c?void 0:c.call(s)}var h=Object.getPrototypeOf(o);if(null===h)return void 0;t=h,e=i,n=s,r=!0}},c=n(1),h=r(c),a=function(t){function e(){o(this,e),u(Object.getPrototypeOf(e.prototype),"constructor",this).apply(this,arguments)}return i(e,t),s(e,[{key:"render",value:function(){return h["default"].createElement("a",{className:"climb__tile__author",href:this.props.link},h["default"].createElement("img",{src:this.props.picture,alt:"Profile pic of "+this.props.name}),h["default"].createElement("h4",{className:"climb__tile__author__username"},this.props.username),h["default"].createElement("h4",{className:"climb__tile__author__followers"},this.props.followers_count))}}]),e}(h["default"].Component);a.propTypes={},e["default"]=a,t.exports=e["default"]},function(t,e,n){"use strict";function r(t){return t&&t.__esModule?t:{"default":t}}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function i(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(e,"__esModule",{value:!0});var s=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),u=function(t,e,n){for(var r=!0;r;){var o=t,i=e,s=n;u=h=c=void 0,r=!1,null===o&&(o=Function.prototype);var u=Object.getOwnPropertyDescriptor(o,i);if(void 0!==u){if("value"in u)return u.value;var c=u.get;return void 0===c?void 0:c.call(s)}var h=Object.getPrototypeOf(o);if(null===h)return void 0;t=h,e=i,n=s,r=!0}},c=n(1),h=r(c),a=function(t){function e(){o(this,e),u(Object.getPrototypeOf(e.prototype),"constructor",this).apply(this,arguments)}return i(e,t),s(e,[{key:"render",value:function(){return h["default"].createElement("img",{className:"climb__tile__image",src:this.props.src,"data-width":this.props.width,"data-height":this.props.height})}}]),e}(h["default"].Component);a.propTypes={src:h["default"].PropTypes.string.isRequired,width:h["default"].PropTypes.number,height:h["default"].PropTypes.number},e["default"]=a,t.exports=e["default"]},function(t,e,n){"use strict";function r(t){return t&&t.__esModule?t:{"default":t}}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function i(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(e,"__esModule",{value:!0});var s=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),u=function(t,e,n){for(var r=!0;r;){var o=t,i=e,s=n;u=h=c=void 0,r=!1,null===o&&(o=Function.prototype);var u=Object.getOwnPropertyDescriptor(o,i);if(void 0!==u){if("value"in u)return u.value;var c=u.get;return void 0===c?void 0:c.call(s)}var h=Object.getPrototypeOf(o);if(null===h)return void 0;t=h,e=i,n=s,r=!0}},c=n(1),h=r(c),a=function(t){function e(){o(this,e),u(Object.getPrototypeOf(e.prototype),"constructor",this).apply(this,arguments)}return i(e,t),s(e,[{key:"render",value:function(){return h["default"].createElement("ul",null)}}]),e}(h["default"].Component);a.propTypes={body:h["default"].PropTypes.string.isRequired},e["default"]=a,t.exports=e["default"]},function(t,e,n){"use strict";function r(t){return t&&t.__esModule?t:{"default":t}}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function i(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(e,"__esModule",{value:!0});var s=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),u=function(t,e,n){for(var r=!0;r;){var o=t,i=e,s=n;u=h=c=void 0,r=!1,null===o&&(o=Function.prototype);var u=Object.getOwnPropertyDescriptor(o,i);if(void 0!==u){if("value"in u)return u.value;var c=u.get;return void 0===c?void 0:c.call(s)}var h=Object.getPrototypeOf(o);if(null===h)return void 0;t=h,e=i,n=s,r=!0}},c=n(1),h=r(c),a=function(t){function e(){o(this,e),u(Object.getPrototypeOf(e.prototype),"constructor",this).apply(this,arguments)}return i(e,t),s(e,[{key:"render",value:function(){return h["default"].createElement("div",{className:"climb__tile__message",dangerouslySetInnerHTML:{__html:this.props.body}})}}]),e}(h["default"].Component);a.propTypes={body:h["default"].PropTypes.string.isRequired},e["default"]=a,t.exports=e["default"]},function(t,e,n){"use strict";function r(t){return t&&t.__esModule?t:{"default":t}}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function i(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(e,"__esModule",{value:!0});var s=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),u=function(t,e,n){for(var r=!0;r;){var o=t,i=e,s=n;u=h=c=void 0,r=!1,null===o&&(o=Function.prototype);var u=Object.getOwnPropertyDescriptor(o,i);if(void 0!==u){if("value"in u)return u.value;var c=u.get;return void 0===c?void 0:c.call(s)}var h=Object.getPrototypeOf(o);if(null===h)return void 0;t=h,e=i,n=s,r=!0}},c=n(1),h=r(c),a=n(3),p=r(a),f=n(5),l=r(f),d=n(2),v=r(d),b=n(4),_=r(b),m=function(t){function e(t){o(this,e),u(Object.getPrototypeOf(e.prototype),"constructor",this).call(this,t),this.createImage.bind(this),this.createMessage.bind(this),this.createInteraction.bind(this),this.createClassString.bind(this)}return i(e,t),s(e,[{key:"createImage",value:function(){if(null!==this.props.image){var t=this.props.image,e=t.url,n=t.width,r=t.height;return h["default"].createElement(p["default"],{src:e,width:n,height:r})}return null}},{key:"createMessage",value:function(){return this.props.message?h["default"].createElement(l["default"],{body:this.props.message}):null}},{key:"createInteraction",value:function(){return this.props.link?h["default"].createElement(_["default"],{body:this.props}):null}},{key:"createClassString",value:function(){var t="climb__tile climb__tile--"+this.props.source_type;return this.props.image&&(t+=" climb__tile--has-media climb__tile--has-image"),this.props.video_url&&(t+=" climb__tile--has-media climb__tile--has-video"),t}},{key:"render",value:function(){var t=this.createImage(),e=this.createMessage(),n=this.createInteraction(),r=this.createClassString(),o=this.props.author;return h["default"].createElement("div",{className:r},h["default"].createElement("a",{href:this.props.link},t),h["default"].createElement("div",{className:"climb__tile__content"},e),h["default"].createElement(v["default"],o),h["default"].createElement("div",{className:"climb__tile__interaction"},n))}}]),e}(h["default"].Component);m.propTypes={link:h["default"].PropTypes.string.isRequired,source_type:h["default"].PropTypes.string.isRequired,timestamp:h["default"].PropTypes.number.isRequired,author:h["default"].PropTypes.shape({username:h["default"].PropTypes.string.isRequired,picture:h["default"].PropTypes.string.isRequired,link:h["default"].PropTypes.string.isRequired}),message:h["default"].PropTypes.string,video_src:h["default"].PropTypes.string,image:h["default"].PropTypes.shape({url:h["default"].PropTypes.string.isRequired,width:h["default"].PropTypes.number.isRequired,height:h["default"].PropTypes.number.isRequired})},e["default"]=m,t.exports=e["default"]},function(t,e,n){"use strict";function r(t){return t&&t.__esModule?t:{"default":t}}function o(t,e){var n={};for(var r in t)e.indexOf(r)>=0||Object.prototype.hasOwnProperty.call(t,r)&&(n[r]=t[r]);return n}function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function s(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(e,"__esModule",{value:!0});var u=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},c=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),h=function(t,e,n){for(var r=!0;r;){var o=t,i=e,s=n;u=h=c=void 0,r=!1,null===o&&(o=Function.prototype);var u=Object.getOwnPropertyDescriptor(o,i);if(void 0!==u){if("value"in u)return u.value;var c=u.get;return void 0===c?void 0:c.call(s)}var h=Object.getPrototypeOf(o);if(null===h)return void 0;t=h,e=i,n=s,r=!0}},a=n(1),p=r(a),f=n(8),l=r(f),d=n(6),v=r(d),b=function(t){function e(t){i(this,e),h(Object.getPrototypeOf(e.prototype),"constructor",this).call(this,t),this.state={items:[]}}return s(e,t),c(e,[{key:"init",value:function(){var t=this;this.props.collectionId&&l["default"].getStream(this.props.collectionId).subscribe(function(e){var n=30;t.setState({items:e.splice(0,n)})})}},{key:"componentDidMount",value:function(){this.init()}},{key:"componentDidUpdate",value:function(){var t=void 0;(t=window.Climb&&window.Climb.onUpdate?window.Climb.onUpdate:function(){})()}},{key:"render",value:function(){var t=[];return this.state.items.map(function(e){var n=e.id,r=o(e,["id"]);t.push(p["default"].createElement(v["default"],u({key:n},r)))}),p["default"].createElement("div",{className:"climb__wall"},t)}}]),e}(p["default"].Component);b.displayName="Wall",b.propTypes={collectionId:p["default"].PropTypes.string.isRequired,limit:p["default"].PropTypes.number},e["default"]=b,t.exports=e["default"]},function(t,e,n){"use strict";function r(t){return t&&t.__esModule?t:{"default":t}}Object.defineProperty(e,"__esModule",{value:!0});var o=n(10),i=r(o),s=n(9),u=r(s),c=function(t){var e=5e3,n=i["default"].Observable.just("http://app.climb.social/api/v1/collections/"+t),r=i["default"].Observable.interval(e).startWith(null),o=r.combineLatest(n,function(t,e){return e}).flatMap(function(t){var e=""+t;return i["default"].Observable.fromPromise(u["default"](e).then(function(t){return t.json()}))});return o},h={getStream:c};e["default"]=h,t.exports=e["default"]},function(t,e,n){var r,o,i;!function(n,s){o=[e,t],r=s,i="function"==typeof r?r.apply(e,o):r,!(void 0!==i&&(t.exports=i))}(this,function(t,e){"use strict";function n(){return"jsonp_"+Date.now()+"_"+Math.ceil(1e5*Math.random())}function r(t){try{delete window[t]}catch(e){window[t]=void 0}}function o(t){var e=document.getElementById(t);document.getElementsByTagName("head")[0].removeChild(e)}var i={timeout:5e3,jsonpCallback:"callback"},s=function(t){var e=arguments.length<=1||void 0===arguments[1]?{}:arguments[1],s=null!=e.timeout?e.timeout:i.timeout,u=null!=e.jsonpCallback?e.jsonpCallback:i.jsonpCallback,c=void 0;return new Promise(function(e,i){var h=n();window[h]=function(t){e({ok:!0,json:function(){return Promise.resolve(t)}}),c&&clearTimeout(c),o(u+"_"+h),r(h)},t+=-1===t.indexOf("?")?"?":"&";var a=document.createElement("script");a.setAttribute("src",t+u+"="+h),a.id=u+"_"+h,document.getElementsByTagName("head")[0].appendChild(a),c=setTimeout(function(){i(new Error("JSONP request to "+t+" timed out")),r(h),o(u+"_"+h)},s)})};e.exports=s})},function(t,e,n){var r;(function(t,o,i){(function(s){function u(t){for(var e=[],n=0,r=t.length;r>n;n++)e.push(t[n]);return e}function c(t){return function(){try{return t.apply(this,arguments)}catch(e){return Xt.e=e,Xt}}}function h(t){throw t}function a(t,e){if(Zt&&e.stack&&"object"==typeof t&&null!==t&&t.stack&&-1===t.stack.indexOf(re)){for(var n=[],r=e;r;r=r.source)r.stack&&n.unshift(r.stack);n.unshift(t.stack);var o=n.join("\n"+re+"\n");t.stack=p(o)}}function p(t){for(var e=t.split("\n"),n=[],r=0,o=e.length;o>r;r++){var i=e[r];f(i)||l(i)||!i||n.push(i)}return n.join("\n")}function f(t){var e=v(t);if(!e)return!1;var n=e[0],r=e[1];return n===ee&&r>=ne&&os>=r}function l(t){return-1!==t.indexOf("(module.js:")||-1!==t.indexOf("(node.js:")}function d(){if(Zt)try{throw new Error}catch(t){var e=t.stack.split("\n"),n=e[0].indexOf("@")>0?e[1]:e[2],r=v(n);if(!r)return;return ee=r[0],r[1]}}function v(t){var e=/at .+ \((.+):(\d+):(?:\d+)\)$/.exec(t);if(e)return[e[1],Number(e[2])];var n=/at ([^ ]+):(\d+):(?:\d+)$/.exec(t);if(n)return[n[1],Number(n[2])];var r=/.*@(.+):(\d+)$/.exec(t);return r?[r[1],Number(r[2])]:void 0}function b(t){var e=[];if(!rt(t))return e;Me.nonEnumArgs&&t.length&&Le(t)&&(t=We.call(t));var n=Me.enumPrototypes&&"function"==typeof t,r=Me.enumErrorProps&&(t===ke||t instanceof Error);for(var o in t)n&&"prototype"==o||r&&("message"==o||"name"==o)||e.push(o);if(Me.nonEnumShadows&&t!==qe){var i=t.constructor,s=-1,u=_e;if(t===(i&&i.prototype))var c=t===Te?De:t===ke?Ee:Se.call(t),h=Re[c];for(;++s<u;)o=be[s],h&&h[o]||!Ae.call(t,o)||e.push(o)}return e}function _(t,e,n){for(var r=-1,o=n(t),i=o.length;++r<i;){var s=o[r];if(e(t[s],s,t)===!1)break}return t}function m(t,e){return _(t,e,b)}function y(t){return"function"!=typeof t.toString&&"string"==typeof(t+"")}function w(t,e,n,r){if(t===e)return 0!==t||1/t==1/e;var o=typeof t,i=typeof e;if(t===t&&(null==t||null==e||"function"!=o&&"object"!=o&&"function"!=i&&"object"!=i))return!1;var s=Se.call(t),u=Se.call(e);if(s==me&&(s=Ne),u==me&&(u=Ne),s!=u)return!1;switch(s){case we:case ge:return+t==+e;case xe:return t!=+t?e!=+e:0==t?1/t==1/e:t==+e;case Oe:case De:return t==String(e)}var c=s==ye;if(!c){if(s!=Ne||!Me.nodeClass&&(y(t)||y(e)))return!1;var h=!Me.argsObject&&Le(t)?Object:t.constructor,a=!Me.argsObject&&Le(e)?Object:e.constructor;if(!(h==a||Ae.call(t,"constructor")&&Ae.call(e,"constructor")||Gt(h)&&h instanceof h&&Gt(a)&&a instanceof a||!("constructor"in t&&"constructor"in e)))return!1}n||(n=[]),r||(r=[]);for(var p=n.length;p--;)if(n[p]==t)return r[p]==e;var f=0,l=!0;if(n.push(t),r.push(e),c){if(p=t.length,f=e.length,l=f==p)for(;f--;){var d=e[f];if(!(l=w(t[f],d,n,r)))break}}else m(e,function(e,o,i){return Ae.call(i,o)?(f++,l=Ae.call(t,o)&&w(t[o],e,n,r)):void 0}),l&&m(t,function(t,e,n){return Ae.call(n,e)?l=--f>-1:void 0});return n.pop(),r.pop(),l}function g(t,e){for(var n=new Array(t),r=0;t>r;r++)n[r]=e();return n}function E(t,e){this.id=t,this.value=e}function C(t,e){this.scheduler=t,this.disposable=e,this.isDisposed=!1}function x(t,e){e.isDisposed||(e.isDisposed=!0,e.disposable.dispose())}function N(t){this._s=t,this.isDisposed=!1}function O(t){this._s=t}function D(t){this._s=t,this._l=t.length,this._i=0}function S(t){this._a=t}function A(t){this._a=t,this._l=T(t),this._i=0}function j(t){return"number"==typeof t&&zt.isFinite(t)}function k(t){var e,n=t[ae];if(!n&&"string"==typeof t)return e=new O(t),e[ae]();if(!n&&t.length!==s)return e=new S(t),e[ae]();if(!n)throw new TypeError("Object is not iterable");return t[ae]()}function q(t){var e=+t;return 0===e?e:isNaN(e)?e:0>e?-1:1}function T(t){var e=+t.length;return isNaN(e)?0:0!==e&&j(e)?(e=q(e)*Math.floor(Math.abs(e)),0>=e?0:e>sr?sr:e):e}function P(t,e){this.observer=t,this.parent=e}function F(t,e){return hn(t)||(t=bn),new cr(e,t)}function R(t,e){this.observer=t,this.parent=e}function M(t,e){this.observer=t,this.parent=e}function L(t,e){return t.amb(e)}function I(){return!1}function W(){for(var t=arguments.length,e=new Array(t),n=0;t>n;n++)e[n]=arguments[n];return e}function I(){return!1}function W(){for(var t=arguments.length,e=new Array(t),n=0;t>n;n++)e[n]=arguments[n];return e}function I(){return!1}function z(){return[]}function I(){return!1}function z(){return[]}function W(){for(var t=arguments.length,e=new Array(t),n=0;t>n;n++)e[n]=arguments[n];return e}function B(t){return function(e){return t.subscribe(e)}}function V(t){return t.toArray()}function U(t){return t.length>0}function H(t,e,n){var r=ve(e,n,3);return t.map(function(e,n){var o=r(e,n,t);return $t(o)&&(o=Xn(o)),(le(o)||fe(o))&&(o=ur(o)),o}).concatAll()}function K(t,e,n){for(var r=0,o=t.length;o>r;r++)if(n(t[r],e))return r;return-1}function J(t){this.comparer=t,this.set=[]}function Q(t,e){return function(n){for(var r=n,o=0;e>o;o++){var i=r[t[o]];if("undefined"==typeof i)return s;r=i}return r}}function $(t){if(0===t.length)throw new oe;return t[0]}function G(t,e,n,r){var o=ve(e,n,3);return new Xi(function(e){return t.subscribe(new Ko(e,t,o,r))},t)}function X(t){return t?Ln.isObservable(t)?t:$t(t)?Ln.fromPromise(t):nt(t)||et(t)?ei.call(this,t):Gt(t)?tt.call(this,t):le(t)||fe(t)?Y.call(this,t):rt(t)?Z.call(this,t):t:t}function Y(t){return Ln.from(t).flatMap(X).toArray()}function Z(t){function e(t,e){n[e]=s,o.push(t.map(function(t){n[e]=t}))}for(var n=new t.constructor,r=Object.keys(t),o=[],i=0,u=r.length;u>i;i++){var c=r[i],h=X.call(this,t[c]);h&&Ln.isObservable(h)?e(h,c):n[c]=t[c]}return Ln.forkJoin.apply(Ln,o).map(function(){return n})}function tt(t){var e=this;return new Xi(function(n){t.call(e,function(){var t=arguments[0],e=arguments[1];if(t)return n.onError(t);if(arguments.length>2){for(var r=[],o=1,i=arguments.length;i>o;o++)r.push(arguments[o]);e=r}n.onNext(e),n.onCompleted()})})}function et(t){return Gt(t.next)&&Gt(t["throw"])}function nt(t){var e=t.constructor;return e?"GeneratorFunction"===e.name||"GeneratorFunction"===e.displayName?!0:et(e.prototype):!1}function rt(t){return Object==t.constructor}function ot(t,e,n,r){var o=new ns;return r.push(it(o,e,n)),t.apply(e,r),o.asObservable()}function it(t,e,n){return function(){for(var r=arguments.length,o=new Array(r),i=0;r>i;i++)o[i]=arguments[i];if(Gt(n)){if(o=Yt(n).apply(e,o),o===Xt)return t.onError(o.e);t.onNext(o)}else o.length<=1?t.onNext(o[0]):t.onNext(o);t.onCompleted()}}function st(t,e,n,r){var o=new ns;return r.push(ut(o,e,n)),t.apply(e,r),o.asObservable()}function ut(t,e,n){return function(){var r=arguments[0];if(r)return t.onError(r);for(var o=arguments.length,i=[],s=1;o>s;s++)i[s-1]=arguments[s];if(Gt(n)){var i=Yt(n).apply(e,i);if(i===Xt)return t.onError(i.e);t.onNext(i)}else i.length<=1?t.onNext(i[0]):t.onNext(i);t.onCompleted()}}function ct(t,e,n){this._e=t,this._n=e,this._fn=n,this._e.addEventListener(this._n,this._fn,!1),this.isDisposed=!1}function ht(t,e,n){var r=new Ke,o=Object.prototype.toString.call(t);if("[object NodeList]"===o||"[object HTMLCollection]"===o)for(var i=0,s=t.length;s>i;i++)r.add(ht(t.item(i),e,n));else t&&r.add(new ct(t,e,n));return r}function at(t,e){return function(){var n=arguments[0];return Gt(e)&&(n=Yt(e).apply(null,arguments),n===Xt)?t.onError(n.e):void t.onNext(n)}}function pt(t,e,n){return new Xi(function(r){function o(t,e){if(h[e]=t,s[e]=!0,u||(u=s.every(Ut))){if(i)return r.onError(i);var o=Yt(n).apply(null,h);if(o===Xt)return r.onError(o.e);r.onNext(o)}c&&h[1]&&r.onCompleted()}var i,s=[!1,!1],u=!1,c=!1,h=new Array(2);return new nn(t.subscribe(function(t){o(t,0)},function(t){h[1]?r.onError(t):i=t},function(){c=!0,h[1]&&r.onCompleted()}),e.subscribe(function(t){o(t,1)},function(t){r.onError(t)},function(){c=!0,o(!0,1)}))},t)}function V(t){return t.toArray()}function ft(t,e){return t.groupJoin(this,e,rr,function(t,e){return e})}function lt(t){var e=this;return new Xi(function(n){var r=new es,o=new Ke,i=new on(o);return n.onNext(Ve(r,i)),o.add(e.subscribe(function(t){r.onNext(t)},function(t){r.onError(t),n.onError(t)},function(){r.onCompleted(),n.onCompleted()})),$t(t)&&(t=Xn(t)),o.add(t.subscribe(function(t){r.onCompleted(),r=new es,n.onNext(Ve(r,i))},function(t){r.onError(t),n.onError(t)},function(){r.onCompleted(),n.onCompleted()})),i},e)}function dt(t){var e=this;return new Xi(function(n){function r(){var e;try{e=t()}catch(i){return void n.onError(i)}$t(e)&&(e=Xn(e));var c=new tn;o.setDisposable(c),c.setDisposable(e.take(1).subscribe(Vt,function(t){u.onError(t),n.onError(t)},function(){u.onCompleted(),u=new es,n.onNext(Ve(u,s)),r()}))}var o=new en,i=new Ke(o),s=new on(i),u=new es;return n.onNext(Ve(u,s)),i.add(e.subscribe(function(t){u.onNext(t)},function(t){u.onError(t),n.onError(t)},function(){u.onCompleted(),n.onCompleted()})),r(),s},e)}function vt(t,e){return new bi(t,e)}function bt(t){this.patterns=t}function _t(t,e){this.expression=t,this.selector=e}function mt(t,e,n){var r=t.get(e);if(!r){var o=new wi(e,n);return t.set(e,o),o}return r}function yt(t,e,n){this.joinObserverArray=t,this.onNext=e,this.onCompleted=n,this.joinObservers=new yi;for(var r=0,o=this.joinObserverArray.length;o>r;r++){var i=this.joinObserverArray[r];this.joinObservers.set(i,i)}}function wt(t,e){return new gi(t,e)}function gt(t,e,n){return new Xi(function(r){var o=t,i=cn(e);return n.scheduleRecursiveFuture(0,o,function(t,e){if(i>0){var s=n.now();o+=i,s>=o&&(o=s+i)}r.onNext(t),e(t+1,new Date(o))})})}function Et(t,e,n){return t===e?new Xi(function(t){return n.schedulePeriodic(0,e,function(e){return t.onNext(e),e+1})}):tr(function(){return gt(new Date(n.now()+t),e,n)})}function Ct(t,e,n){return new Xi(function(r){var o,i=!1,s=new en,u=null,c=[],h=!1;return o=t.materialize().timestamp(n).subscribe(function(t){var o,a;"E"===t.value.kind?(c=[],c.push(t),u=t.value.error,a=!h):(c.push({value:t.value,timestamp:t.timestamp+e}),a=!i,i=!0),a&&(null!==u?r.onError(u):(o=new tn,s.setDisposable(o),o.setDisposable(n.scheduleRecursiveFuture(null,e,function(t,e){var o,s,a,p;if(null===u){h=!0;do a=null,c.length>0&&c[0].timestamp-n.now()<=0&&(a=c.shift().value),null!==a&&a.accept(r);while(null!==a);p=!1,s=0,c.length>0?(p=!0,s=Math.max(0,c[0].timestamp-n.now())):i=!1,o=u,h=!1,null!==o?r.onError(o):p&&e(null,s)}}))))}),new nn(o,s)},t)}function xt(t,e,n){return tr(function(){return Ct(t,e-n.now(),n)})}function Nt(t,e,n){var r,o;return Gt(e)?o=e:(r=e,o=n),new Xi(function(e){function n(){c.setDisposable(t.subscribe(function(t){var n=Yt(o)(t);if(n===Xt)return e.onError(n.e);var r=new tn;s.add(r),r.setDisposable(n.subscribe(function(){e.onNext(t),s.remove(r),i()},function(t){e.onError(t)},function(){e.onNext(t),s.remove(r),i()}))},function(t){e.onError(t)},function(){u=!0,c.dispose(),i()}))}function i(){u&&0===s.length&&e.onCompleted()}var s=new Ke,u=!1,c=new en;return r?c.setDisposable(r.subscribe(n,function(t){e.onError(t)},n)):n(),new nn(c,s)},this)}function Ot(t,e){return new Xi(function(n){var r,o=!1,i=new en,s=0,u=t.subscribe(function(t){var u=Yt(e)(t);if(u===Xt)return n.onError(u.e);$t(u)&&(u=Xn(u)),o=!0,r=t,s++;var c=s,h=new tn;i.setDisposable(h),h.setDisposable(u.subscribe(function(){o&&s===c&&n.onNext(r),o=!1,h.dispose()},function(t){n.onError(t)},function(){o&&s===c&&n.onNext(r),o=!1,h.dispose()}))},function(t){i.dispose(),n.onError(t),o=!1,s++},function(){i.dispose(),o&&n.onNext(r),n.onCompleted(),o=!1,s++});return new nn(u,i)},t)}function V(t){return t.toArray()}function V(t){return t.toArray()}function Dt(t,e){return new Xi(function(n){function r(){s&&(s=!1,n.onNext(o)),i&&n.onCompleted()}var o,i=!1,s=!1,u=new tn;return u.setDisposable(t.subscribe(function(t){s=!0,o=t},function(t){n.onError(t)},function(){i=!0,u.dispose()})),new nn(u,e.subscribe(r,function(t){n.onError(t)},r))},t)}function St(t,e,n,r){return Gt(e)&&(r=n,n=e,e=lr()),r||(r=wr(new Ai)),new Xi(function(o){function i(t){function e(){return p=n===a}var n=a,i=new tn;c.setDisposable(i),i.setDisposable(t.subscribe(function(){e()&&u.setDisposable(r.subscribe(o)),i.dispose()},function(t){e()&&o.onError(t)},function(){e()&&u.setDisposable(r.subscribe(o))}))}function s(){var t=!p;return t&&a++,t}var u=new en,c=new en,h=new tn;u.setDisposable(h);var a=0,p=!1;return i(e),h.setDisposable(t.subscribe(function(t){if(s()){o.onNext(t);var e=Yt(n)(t);if(e===Xt)return o.onError(e.e);i($t(e)?Xn(e):e)}},function(t){s()&&o.onError(t)},function(){s()&&o.onCompleted()})),new nn(u,c)},t)}function At(t,e,n,r){return hn(n)&&(r=n,n=wr(new Ai)),n instanceof Error&&(n=wr(n)),hn(r)||(r=gn),new Xi(function(o){function i(){var t=s;a.setDisposable(r.scheduleFuture(null,e,function(){h=s===t,h&&($t(n)&&(n=Xn(n)),c.setDisposable(n.subscribe(o)))}))}var s=0,u=new tn,c=new en,h=!1,a=new en;return c.setDisposable(u),i(),u.setDisposable(t.subscribe(function(t){h||(s++,o.onNext(t),i())},function(t){h||(s++,o.onError(t))},function(){h||(s++,o.onCompleted())})),new nn(c,a)},t)}function jt(t){return{"@@transducer/init":function(){return t},"@@transducer/step":function(t,e){return t.onNext(e)},"@@transducer/result":function(t){return t.onCompleted()}}}function kt(t){this.predicate=t}function qt(t){this.predicate=t}function Tt(t,e){var n=this;this.scheduler=t,this.messages=e,this.subscriptions=[],this.observers=[];for(var r=0,o=this.messages.length;o>r;r++){var i=this.messages[r],s=i.value;!function(e){t.scheduleAbsolute(null,i.time,function(){for(var t=n.observers.slice(0),r=0,o=t.length;o>r;r++)e.accept(t[r]);return Ge})}(s)}}var Pt={"function":!0,object:!0},Ft=Pt[typeof e]&&e&&!e.nodeType&&e,Rt=Pt[typeof self]&&self.Object&&self,Mt=Pt[typeof window]&&window&&window.Object&&window,Lt=Pt[typeof t]&&t&&!t.nodeType&&t,It=Lt&&Lt.exports===Ft&&Ft,Wt=Ft&&Lt&&"object"==typeof o&&o&&o.Object&&o,zt=zt=Wt||Mt!==(this&&this.window)&&Mt||Rt||this,Bt={internals:{},config:{Promise:zt.Promise},helpers:{}},Vt=Bt.helpers.noop=function(){},Ut=Bt.helpers.identity=function(t){return t},Ht=Bt.helpers.defaultNow=Date.now,Kt=Bt.helpers.defaultComparer=function(t,e){return Ie(t,e)},Jt=Bt.helpers.defaultSubComparer=function(t,e){return t>e?1:e>t?-1:0},Qt=(Bt.helpers.defaultKeySerializer=function(t){return t.toString()},Bt.helpers.defaultError=function(t){throw t}),$t=Bt.helpers.isPromise=function(t){return!!t&&"function"!=typeof t.subscribe&&"function"==typeof t.then},Gt=Bt.helpers.isFunction=function(){var t=function(t){return"function"==typeof t||!1};return t(/x/)&&(t=function(t){return"function"==typeof t&&"[object Function]"==Se.call(t)}),t}(),Xt={e:{}},Yt=Bt.internals.tryCatch=function(t){if(!Gt(t))throw new TypeError("fn must be a function");return c(t)};Bt.config.longStackSupport=!1;var Zt=!1,te=Yt(function(){throw new Error})();Zt=!!te.e&&!!te.e.stack;var ee,ne=d(),re="From previous event:",oe=Bt.EmptyError=function(){this.message="Sequence contains no elements.",this.name="EmptyError",Error.call(this)};oe.prototype=Object.create(Error.prototype);var ie=Bt.ObjectDisposedError=function(){this.message="Object has been disposed",this.name="ObjectDisposedError",Error.call(this)};ie.prototype=Object.create(Error.prototype);var se=Bt.ArgumentOutOfRangeError=function(){this.message="Argument out of range",this.name="ArgumentOutOfRangeError",Error.call(this)};se.prototype=Object.create(Error.prototype);var ue=Bt.NotSupportedError=function(t){this.message=t||"This operation is not supported",this.name="NotSupportedError",Error.call(this)};ue.prototype=Object.create(Error.prototype);var ce=Bt.NotImplementedError=function(t){this.message=t||"This operation is not implemented",this.name="NotImplementedError",Error.call(this)};ce.prototype=Object.create(Error.prototype);var he=Bt.helpers.notImplemented=function(){throw new ce},ae=(Bt.helpers.notSupported=function(){throw new ue},"function"==typeof Symbol&&Symbol.iterator||"_es6shim_iterator_");zt.Set&&"function"==typeof(new zt.Set)["@@iterator"]&&(ae="@@iterator");var pe=Bt.doneEnumerator={done:!0,value:s},fe=Bt.helpers.isIterable=function(t){return t[ae]!==s},le=Bt.helpers.isArrayLike=function(t){return t&&t.length!==s};Bt.helpers.iterator=ae;var de,ve=Bt.internals.bindCallback=function(t,e,n){if("undefined"==typeof e)return t;switch(n){case 0:return function(){return t.call(e)};case 1:return function(n){return t.call(e,n)};case 2:return function(n,r){return t.call(e,n,r)};case 3:return function(n,r,o){return t.call(e,n,r,o)}}return function(){return t.apply(e,arguments)}},be=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],_e=be.length,me="[object Arguments]",ye="[object Array]",we="[object Boolean]",ge="[object Date]",Ee="[object Error]",Ce="[object Function]",xe="[object Number]",Ne="[object Object]",Oe="[object RegExp]",De="[object String]",Se=Object.prototype.toString,Ae=Object.prototype.hasOwnProperty,je=Se.call(arguments)==me,ke=Error.prototype,qe=Object.prototype,Te=String.prototype,Pe=qe.propertyIsEnumerable;try{de=!(Se.call(document)==Ne&&!({toString:0}+""))}catch(Fe){de=!0}var Re={};Re[ye]=Re[ge]=Re[xe]={constructor:!0,toLocaleString:!0,toString:!0,valueOf:!0},Re[we]=Re[De]={constructor:!0,toString:!0,valueOf:!0},Re[Ee]=Re[Ce]=Re[Oe]={constructor:!0,toString:!0},Re[Ne]={constructor:!0};var Me={};!function(){var t=function(){this.x=1},e=[];t.prototype={valueOf:1,y:1};for(var n in new t)e.push(n);for(n in arguments);Me.enumErrorProps=Pe.call(ke,"message")||Pe.call(ke,"name"),Me.enumPrototypes=Pe.call(t,"prototype"),Me.nonEnumArgs=0!=n,Me.nonEnumShadows=!/valueOf/.test(e)}(1);var rt=Bt.internals.isObject=function(t){var e=typeof t;return t&&("function"==e||"object"==e)||!1},Le=function(t){return t&&"object"==typeof t?Se.call(t)==me:!1};je||(Le=function(t){return t&&"object"==typeof t?Ae.call(t,"callee"):!1});var Ie=Bt.internals.isEqual=function(t,e){return w(t,e,[],[])},We=({}.hasOwnProperty,
Array.prototype.slice),ze=Bt.internals.inherits=function(t,e){function n(){this.constructor=t}n.prototype=e.prototype,t.prototype=new n},Be=Bt.internals.addProperties=function(t){for(var e=[],n=1,r=arguments.length;r>n;n++)e.push(arguments[n]);for(var o=0,i=e.length;i>o;o++){var s=e[o];for(var u in s)t[u]=s[u]}},Ve=Bt.internals.addRef=function(t,e){return new Xi(function(n){return new nn(e.getDisposable(),t.subscribe(n))})};E.prototype.compareTo=function(t){var e=this.value.compareTo(t.value);return 0===e&&(e=this.id-t.id),e};var Ue=Bt.internals.PriorityQueue=function(t){this.items=new Array(t),this.length=0},He=Ue.prototype;He.isHigherPriority=function(t,e){return this.items[t].compareTo(this.items[e])<0},He.percolate=function(t){if(!(t>=this.length||0>t)){var e=t-1>>1;if(!(0>e||e===t)&&this.isHigherPriority(t,e)){var n=this.items[t];this.items[t]=this.items[e],this.items[e]=n,this.percolate(e)}}},He.heapify=function(t){if(+t||(t=0),!(t>=this.length||0>t)){var e=2*t+1,n=2*t+2,r=t;if(e<this.length&&this.isHigherPriority(e,r)&&(r=e),n<this.length&&this.isHigherPriority(n,r)&&(r=n),r!==t){var o=this.items[t];this.items[t]=this.items[r],this.items[r]=o,this.heapify(r)}}},He.peek=function(){return this.items[0].value},He.removeAt=function(t){this.items[t]=this.items[--this.length],this.items[this.length]=s,this.heapify()},He.dequeue=function(){var t=this.peek();return this.removeAt(0),t},He.enqueue=function(t){var e=this.length++;this.items[e]=new E(Ue.count++,t),this.percolate(e)},He.remove=function(t){for(var e=0;e<this.length;e++)if(this.items[e].value===t)return this.removeAt(e),!0;return!1},Ue.count=0;var Ke=Bt.CompositeDisposable=function(){var t,e,n=[];if(Array.isArray(arguments[0]))n=arguments[0],e=n.length;else for(e=arguments.length,n=new Array(e),t=0;e>t;t++)n[t]=arguments[t];this.disposables=n,this.isDisposed=!1,this.length=n.length},Je=Ke.prototype;Je.add=function(t){this.isDisposed?t.dispose():(this.disposables.push(t),this.length++)},Je.remove=function(t){var e=!1;if(!this.isDisposed){var n=this.disposables.indexOf(t);-1!==n&&(e=!0,this.disposables.splice(n,1),this.length--,t.dispose())}return e},Je.dispose=function(){if(!this.isDisposed){this.isDisposed=!0;for(var t=this.disposables.length,e=new Array(t),n=0;t>n;n++)e[n]=this.disposables[n];for(this.disposables=[],this.length=0,n=0;t>n;n++)e[n].dispose()}};var Qe=Bt.Disposable=function(t){this.isDisposed=!1,this.action=t||Vt};Qe.prototype.dispose=function(){this.isDisposed||(this.action(),this.isDisposed=!0)};var $e=Qe.create=function(t){return new Qe(t)},Ge=Qe.empty={dispose:Vt},Xe=Qe.isDisposable=function(t){return t&&Gt(t.dispose)},Ye=Qe.checkDisposed=function(t){if(t.isDisposed)throw new ie},Ze=Qe._fixup=function(t){return Xe(t)?t:Ge},tn=Bt.SingleAssignmentDisposable=function(){this.isDisposed=!1,this.current=null};tn.prototype.getDisposable=function(){return this.current},tn.prototype.setDisposable=function(t){if(this.current)throw new Error("Disposable has already been assigned");var e=this.isDisposed;!e&&(this.current=t),e&&t&&t.dispose()},tn.prototype.dispose=function(){if(!this.isDisposed){this.isDisposed=!0;var t=this.current;this.current=null,t&&t.dispose()}};var en=Bt.SerialDisposable=function(){this.isDisposed=!1,this.current=null};en.prototype.getDisposable=function(){return this.current},en.prototype.setDisposable=function(t){var e=this.isDisposed;if(!e){var n=this.current;this.current=t}n&&n.dispose(),e&&t&&t.dispose()},en.prototype.dispose=function(){if(!this.isDisposed){this.isDisposed=!0;var t=this.current;this.current=null}t&&t.dispose()};var nn=Bt.BinaryDisposable=function(t,e){this._first=t,this._second=e,this.isDisposed=!1};nn.prototype.dispose=function(){if(!this.isDisposed){this.isDisposed=!0;var t=this._first;this._first=null,t&&t.dispose();var e=this._second;this._second=null,e&&e.dispose()}};var rn=Bt.NAryDisposable=function(t){this._disposables=t,this.isDisposed=!1};rn.prototype.dispose=function(){if(!this.isDisposed){this.isDisposed=!0;for(var t=0,e=this._disposables.length;e>t;t++)this._disposables[t].dispose();this._disposables.length=0}};var on=Bt.RefCountDisposable=function(){function t(t){this.disposable=t,this.disposable.count++,this.isInnerDisposed=!1}function e(t){this.underlyingDisposable=t,this.isDisposed=!1,this.isPrimaryDisposed=!1,this.count=0}return t.prototype.dispose=function(){this.disposable.isDisposed||this.isInnerDisposed||(this.isInnerDisposed=!0,this.disposable.count--,0===this.disposable.count&&this.disposable.isPrimaryDisposed&&(this.disposable.isDisposed=!0,this.disposable.underlyingDisposable.dispose()))},e.prototype.dispose=function(){this.isDisposed||this.isPrimaryDisposed||(this.isPrimaryDisposed=!0,0===this.count&&(this.isDisposed=!0,this.underlyingDisposable.dispose()))},e.prototype.getDisposable=function(){return this.isDisposed?Ge:new t(this)},e}();C.prototype.dispose=function(){this.scheduler.schedule(this,x)};var sn=Bt.internals.ScheduledItem=function(t,e,n,r,o){this.scheduler=t,this.state=e,this.action=n,this.dueTime=r,this.comparer=o||Jt,this.disposable=new tn};sn.prototype.invoke=function(){this.disposable.setDisposable(this.invokeCore())},sn.prototype.compareTo=function(t){return this.comparer(this.dueTime,t.dueTime)},sn.prototype.isCancelled=function(){return this.disposable.isDisposed},sn.prototype.invokeCore=function(){return Ze(this.action(this.scheduler,this.state))};var un=Bt.Scheduler=function(){function t(){}t.isScheduler=function(e){return e instanceof t};var e=t.prototype;return e.schedule=function(t,e){throw new ce},e.scheduleFuture=function(e,n,r){var o=n;return o instanceof Date&&(o-=this.now()),o=t.normalize(o),0===o?this.schedule(e,r):this._scheduleFuture(e,o,r)},e._scheduleFuture=function(t,e,n){throw new ce},t.now=Ht,t.prototype.now=Ht,t.normalize=function(t){return 0>t&&(t=0),t},t}(),cn=un.normalize,hn=un.isScheduler;!function(t){function e(t,e){function n(e){function r(t,e){return s?i.remove(c):u=!0,o(e,n),Ge}var s=!1,u=!1,c=t.schedule(e,r);u||(i.add(c),s=!0)}var r=e[0],o=e[1],i=new Ke;return o(r,n),i}function n(t,e){function n(e,r){function s(t,e){return u?i.remove(h):c=!0,o(e,n),Ge}var u=!1,c=!1,h=t.scheduleFuture(e,r,s);c||(i.add(h),u=!0)}var r=e[0],o=e[1],i=new Ke;return o(r,n),i}t.scheduleRecursive=function(t,n){return this.schedule([t,n],e)},t.scheduleRecursiveFuture=function(t,e,r){return this.scheduleFuture([t,r],e,n)}}(un.prototype),function(t){un.prototype.schedulePeriodic=function(t,e,n){if("undefined"==typeof zt.setInterval)throw new ue;e=cn(e);var r=t,o=zt.setInterval(function(){r=n(r)},e);return $e(function(){zt.clearInterval(o)})}}(un.prototype),function(t){t.catchError=t["catch"]=function(t){return new En(this,t)}}(un.prototype);var an,pn,fn=Bt.internals.SchedulePeriodicRecursive=function(){function t(t,e){e(0,this._period);try{this._state=this._action(this._state)}catch(n){throw this._cancel.dispose(),n}}function e(t,e,n,r){this._scheduler=t,this._state=e,this._period=n,this._action=r}return e.prototype.start=function(){var e=new tn;return this._cancel=e,e.setDisposable(this._scheduler.scheduleRecursiveFuture(0,this._period,t.bind(this))),e},e}(),ln=function(t){function e(){t.call(this)}return ze(e,t),e.prototype.schedule=function(t,e){return Ze(e(this,t))},e}(un),dn=un.immediate=new ln,vn=function(t){function e(){for(;r.length>0;){var t=r.dequeue();!t.isCancelled()&&t.invoke()}}function n(){t.call(this)}var r;return ze(n,t),n.prototype.schedule=function(t,n){var o=new sn(this,t,n,this.now());if(r)r.enqueue(o);else{r=new Ue(4),r.enqueue(o);var i=Yt(e)();r=null,i===Xt&&h(i.e)}return o.disposable},n.prototype.scheduleRequired=function(){return!r},n}(un),bn=un.currentThread=new vn,_n=function(){var t,e=Vt;if(zt.setTimeout)t=zt.setTimeout,e=zt.clearTimeout;else{if(!zt.WScript)throw new ue;t=function(t,e){zt.WScript.Sleep(e),t()}}return{setTimeout:t,clearTimeout:e}}(),mn=_n.setTimeout,yn=_n.clearTimeout;!function(){function t(e){if(s)mn(function(){t(e)},0);else{var n=o[e];if(n){s=!0;var r=Yt(n)();pn(e),s=!1,r===Xt&&h(r.e)}}}function e(){if(!zt.postMessage||zt.importScripts)return!1;var t=!1,e=zt.onmessage;return zt.onmessage=function(){t=!0},zt.postMessage("","*"),zt.onmessage=e,t}function n(e){"string"==typeof e.data&&e.data.substring(0,a.length)===a&&t(e.data.substring(a.length))}var r=1,o={},s=!1;pn=function(t){delete o[t]};var u=new RegExp("^"+String(Se).replace(/[.*+?^${}()|[\]\\]/g,"\\$&").replace(/toString| for [^\]]+/g,".*?")+"$"),c="function"==typeof(c=Wt&&It&&Wt.setImmediate)&&!u.test(c)&&c;if(Gt(c))an=function(e){var n=r++;return o[n]=e,c(function(){t(n)}),n};else if("undefined"!=typeof i&&"[object process]"==={}.toString.call(i))an=function(e){var n=r++;return o[n]=e,i.nextTick(function(){t(n)}),n};else if(e()){var a="ms.rx.schedule"+Math.random();zt.addEventListener?zt.addEventListener("message",n,!1):zt.attachEvent?zt.attachEvent("onmessage",n):zt.onmessage=n,an=function(t){var e=r++;return o[e]=t,zt.postMessage(a+currentId,"*"),e}}else if(zt.MessageChannel){var p=new zt.MessageChannel;p.port1.onmessage=function(e){t(e.data)},an=function(t){var e=r++;return o[e]=t,p.port2.postMessage(e),e}}else an="document"in zt&&"onreadystatechange"in zt.document.createElement("script")?function(e){var n=zt.document.createElement("script"),i=r++;return o[i]=e,n.onreadystatechange=function(){t(i),n.onreadystatechange=null,n.parentNode.removeChild(n),n=null},zt.document.documentElement.appendChild(n),i}:function(e){var n=r++;return o[n]=e,mn(function(){t(n)},0),n}}();var wn=function(t){function e(){t.call(this)}function n(t){this._id=t,this.isDisposed=!1}return ze(e,t),n.prototype.dispose=function(){this.isDisposed||(this.isDisposed=!0,yn(this._id))},e.prototype.schedule=function(t,e){var r=this,o=new tn,i=an(function(){!o.isDisposed&&o.setDisposable(Ze(e(r,t)))});return new nn(o,new n(i))},e.prototype._scheduleFuture=function(t,e,r){var o=this,i=un.normalize(e),s=new tn;if(0===i)return o.schedule(t,r);var u=mn(function(){!s.isDisposed&&s.setDisposable(Ze(r(o,t)))},i);return new nn(s,new n(u))},e}(un),gn=un["default"]=un.async=new wn,En=function(t){function e(e,n){this._scheduler=e,this._handler=n,this._recursiveOriginal=null,this._recursiveWrapper=null,t.call(this)}return ze(e,t),e.prototype.schedule=function(t,e){return this._scheduler.schedule(t,this._wrap(e))},e.prototype._scheduleFuture=function(t,e,n){return this._scheduler.schedule(t,e,this._wrap(n))},e.prototype.now=function(){return this._scheduler.now()},e.prototype._clone=function(t){return new e(t,this._handler)},e.prototype._wrap=function(t){var e=this;return function(n,r){var o=Yt(t)(e._getRecursiveWrapper(n),r);return o===Xt?(e._handler(o.e)||h(o.e),Ge):Ze(ret)}},e.prototype._getRecursiveWrapper=function(t){if(this._recursiveOriginal!==t){this._recursiveOriginal=t;var e=this._clone(t);e._recursiveOriginal=t,e._recursiveWrapper=e,this._recursiveWrapper=e}return this._recursiveWrapper},e.prototype.schedulePeriodic=function(t,e,n){var r=this,o=!1,i=new tn;return i.setDisposable(this._scheduler.schedulePeriodic(t,e,function(t){if(o)return null;var e=Yt(n)(t);return e===Xt?(o=!0,r._handler(e.e)||h(e.e),i.dispose(),null):ret})),i},e}(un),Cn=Bt.Notification=function(){function t(){}return t.prototype._accept=function(t,e,n){throw new ce},t.prototype._acceptObservable=function(t,e,n){throw new ce},t.prototype.accept=function(t,e,n){return t&&"object"==typeof t?this._acceptObservable(t):this._accept(t,e,n)},t.prototype.toObservable=function(t){var e=this;return hn(t)||(t=dn),new Xi(function(n){return t.schedule(e,function(t,e){e._acceptObservable(n),"N"===e.kind&&n.onCompleted()})})},t}(),xn=function(t){function e(t){this.value=t,this.kind="N"}return ze(e,t),e.prototype._accept=function(t){return t(this.value)},e.prototype._acceptObservable=function(t){return t.onNext(this.value)},e.prototype.toString=function(){return"OnNext("+this.value+")"},e}(Cn),Nn=function(t){function e(t){this.error=t,this.kind="E"}return ze(e,t),e.prototype._accept=function(t,e){return e(this.error)},e.prototype._acceptObservable=function(t){return t.onError(this.error)},e.prototype.toString=function(){return"OnError("+this.error+")"},e}(Cn),On=function(t){function e(){this.kind="C"}return ze(e,t),e.prototype._accept=function(t,e,n){return n()},e.prototype._acceptObservable=function(t){return t.onCompleted()},e.prototype.toString=function(){return"OnCompleted()"},e}(Cn),Dn=Cn.createOnNext=function(t){return new xn(t)},Sn=Cn.createOnError=function(t){return new Nn(t)},An=Cn.createOnCompleted=function(){return new On},jn=Bt.Observer=function(){};jn.prototype.toNotifier=function(){var t=this;return function(e){return e.accept(t)}},jn.prototype.asObserver=function(){var t=this;return new Pn(function(e){t.onNext(e)},function(e){t.onError(e)},function(){t.onCompleted()})},jn.prototype.checked=function(){return new Fn(this)};var kn=jn.create=function(t,e,n){return t||(t=Vt),e||(e=Qt),n||(n=Vt),new Pn(t,e,n)};jn.fromNotifier=function(t,e){var n=ve(t,e,1);return new Pn(function(t){return n(Dn(t))},function(t){return n(Sn(t))},function(){return n(An())})},jn.prototype.notifyOn=function(t){return new Mn(t,this)},jn.prototype.makeSafe=function(t){return new AnonymousSafeObserver(this._onNext,this._onError,this._onCompleted,t)};var qn,Tn=Bt.internals.AbstractObserver=function(t){function e(){this.isStopped=!1}return ze(e,t),e.prototype.next=he,e.prototype.error=he,e.prototype.completed=he,e.prototype.onNext=function(t){!this.isStopped&&this.next(t)},e.prototype.onError=function(t){this.isStopped||(this.isStopped=!0,this.error(t))},e.prototype.onCompleted=function(){this.isStopped||(this.isStopped=!0,this.completed())},e.prototype.dispose=function(){this.isStopped=!0},e.prototype.fail=function(t){return this.isStopped?!1:(this.isStopped=!0,this.error(t),!0)},e}(jn),Pn=Bt.AnonymousObserver=function(t){function e(e,n,r){t.call(this),this._onNext=e,this._onError=n,this._onCompleted=r}return ze(e,t),e.prototype.next=function(t){this._onNext(t)},e.prototype.error=function(t){this._onError(t)},e.prototype.completed=function(){this._onCompleted()},e}(Tn),Fn=function(t){function e(e){t.call(this),this._observer=e,this._state=0}ze(e,t);var n=e.prototype;return n.onNext=function(t){this.checkAccess();var e=Yt(this._observer.onNext).call(this._observer,t);this._state=0,e===Xt&&h(e.e)},n.onError=function(t){this.checkAccess();var e=Yt(this._observer.onError).call(this._observer,t);this._state=2,e===Xt&&h(e.e)},n.onCompleted=function(){this.checkAccess();var t=Yt(this._observer.onCompleted).call(this._observer);this._state=2,t===Xt&&h(t.e)},n.checkAccess=function(){if(1===this._state)throw new Error("Re-entrancy detected");if(2===this._state)throw new Error("Observer completed");0===this._state&&(this._state=1)},e}(jn),Rn=Bt.internals.ScheduledObserver=function(t){function e(e,n){t.call(this),this.scheduler=e,this.observer=n,this.isAcquired=!1,this.hasFaulted=!1,this.queue=[],this.disposable=new en}return ze(e,t),e.prototype.next=function(t){var e=this;this.queue.push(function(){e.observer.onNext(t)})},e.prototype.error=function(t){var e=this;this.queue.push(function(){e.observer.onError(t)})},e.prototype.completed=function(){var t=this;this.queue.push(function(){t.observer.onCompleted()})},e.prototype.ensureActive=function(){var t=!1;!this.hasFaulted&&this.queue.length>0&&(t=!this.isAcquired,this.isAcquired=!0),t&&this.disposable.setDisposable(this.scheduler.scheduleRecursive(this,function(t,e){var n;if(!(t.queue.length>0))return void(t.isAcquired=!1);n=t.queue.shift();var r=Yt(n)();return r===Xt?(t.queue=[],t.hasFaulted=!0,h(r.e)):void e(t)}))},e.prototype.dispose=function(){t.prototype.dispose.call(this),this.disposable.dispose()},e}(Tn),Mn=function(t){function e(e,n,r){t.call(this,e,n),this._cancel=r}return ze(e,t),e.prototype.next=function(e){t.prototype.next.call(this,e),this.ensureActive()},e.prototype.error=function(e){t.prototype.error.call(this,e),this.ensureActive()},e.prototype.completed=function(){t.prototype.completed.call(this),this.ensureActive()},e.prototype.dispose=function(){t.prototype.dispose.call(this),this._cancel&&this._cancel.dispose(),this._cancel=null},e}(Rn),Ln=Bt.Observable=function(){function t(t,e){return function(n){var r=n.onError;return n.onError=function(e){a(e,t),r.call(n,e)},e.call(t,n)}}function e(){if(Bt.config.longStackSupport&&Zt){var e=this._subscribe,n=Yt(h)(new Error).e;this.stack=n.stack.substring(n.stack.indexOf("\n")+1),this._subscribe=t(this,e)}}return qn=e.prototype,e.isObservable=function(t){return t&&Gt(t.subscribe)},qn.subscribe=qn.forEach=function(t,e,n){return this._subscribe("object"==typeof t?t:kn(t,e,n))},qn.subscribeOnNext=function(t,e){return this._subscribe(kn("undefined"!=typeof e?function(n){t.call(e,n)}:t))},qn.subscribeOnError=function(t,e){return this._subscribe(kn(null,"undefined"!=typeof e?function(n){t.call(e,n)}:t))},qn.subscribeOnCompleted=function(t,e){return this._subscribe(kn(null,null,"undefined"!=typeof e?function(){t.call(e)}:t))},e}(),In=Bt.ObservableBase=function(t){function e(t){return t&&Gt(t.dispose)?t:Gt(t)?$e(t):Ge}function n(t,n){var r=n[0],o=n[1],i=Yt(o.subscribeCore).call(o,r);i!==Xt||r.fail(Xt.e)||h(Xt.e),r.setDisposable(e(i))}function r(){t.call(this)}return ze(r,t),r.prototype._subscribe=function(t){var e=new Yi(t),r=[e,this];return bn.scheduleRequired()?bn.schedule(r,n):n(null,r),e},r.prototype.subscribeCore=he,r}(Ln),Wn=Bt.FlatMapObservable=function(t){function e(e,n,r,o){this.resultSelector=Gt(r)?r:null,this.selector=ve(Gt(n)?n:function(){return n},o,3),this.source=e,t.call(this)}function n(t,e,n,r){this.i=0,this.selector=e,this.resultSelector=n,this.source=r,this.o=t,Tn.call(this)}return ze(e,t),e.prototype.subscribeCore=function(t){return this.source.subscribe(new n(t,this.selector,this.resultSelector,this))},ze(n,Tn),n.prototype._wrapResult=function(t,e,n){return this.resultSelector?t.map(function(t,r){return this.resultSelector(e,t,n,r)},this):t},n.prototype.next=function(t){var e=this.i++,n=Yt(this.selector)(t,e,this.source);return n===Xt?this.o.onError(n.e):($t(n)&&(n=Xn(n)),(le(n)||fe(n))&&(n=Ln.from(n)),void this.o.onNext(this._wrapResult(n,t,e)))},n.prototype.error=function(t){this.o.onError(t)},n.prototype.onCompleted=function(){this.o.onCompleted()},e}(In),zn=Bt.internals.Enumerable=function(){};N.prototype.dispose=function(){this.isDisposed||(this.isDisposed=!0,this._s.isDisposed=!0)};var Bn=function(t){function e(e){this.sources=e,t.call(this)}function n(t,e,n){this._o=t,this._s=e,this._e=n,Tn.call(this)}return ze(e,t),e.prototype.subscribeCore=function(t){var e={isDisposed:!1},r=new en,o=bn.scheduleRecursive(this.sources[ae](),function(o,i){if(!e.isDisposed){var s=Yt(o.next).call(o);if(s===Xt)return t.onError(s.e);if(s.done)return t.onCompleted();var u=s.value;$t(u)&&(u=Xn(u));var c=new tn;r.setDisposable(c),c.setDisposable(u.subscribe(new n(t,i,o)))}});return new rn([r,o,new N(e)])},ze(n,Tn),n.prototype.onNext=function(t){this._o.onNext(t)},n.prototype.onError=function(t){this._o.onError(t)},n.prototype.onCompleted=function(){this._s(this._e)},e}(In);zn.prototype.concat=function(){return new Bn(this)};var Vn=function(t){function e(e){this.sources=e,t.call(this)}function n(t,e){this._o=t,this._recurse=e,Tn.call(this)}return ze(e,t),e.prototype.subscribeCore=function(t){var e=this.sources[ae](),r={isDisposed:!1},o=new en,i=bn.scheduleRecursive(null,function(i,s){if(!r.isDisposed){var u=Yt(e.next).call(e);if(u===Xt)return t.onError(u.e);if(u.done)return null!==i?t.onError(i):t.onCompleted();var c=u.value;$t(c)&&(c=Xn(c));var h=new tn;o.setDisposable(h),h.setDisposable(c.subscribe(new n(t,s)))}});return new rn([o,i,new N(r)])},ze(n,Tn),n.prototype.next=function(t){this._o.onNext(t)},n.prototype.error=function(t){this._recurse(t)},n.prototype.completed=function(){this._o.onCompleted()},e}(In);zn.prototype.catchError=function(){return new Vn(this)},zn.prototype.catchErrorWhen=function(t){var e=this;return new Xi(function(n){var r,o=new es,i=new es,s=t(o),u=s.subscribe(i),c=e[ae](),h={isDisposed:!1},a=new en,p=bn.scheduleRecursive(null,function(t,e){if(!h.isDisposed){var s=Yt(c.next).call(c);if(s===Xt)return n.onError(s.e);if(s.done)return void(r?n.onError(r):n.onCompleted());var u=s.value;$t(u)&&(u=Xn(u));var p=new tn,f=new tn;a.setDisposable(new nn(f,p)),p.setDisposable(u.subscribe(function(t){n.onNext(t)},function(t){f.setDisposable(i.subscribe(e,function(t){n.onError(t)},function(){n.onCompleted()})),o.onNext(t)},function(){n.onCompleted()}))}});return new rn([u,a,p,new N(h)])})};var Un=function(t){function e(t,e){this.v=t,this.c=null==e?-1:e}function n(t){this.v=t.v,this.l=t.c}return ze(e,t),e.prototype[ae]=function(){return new n(this)},n.prototype.next=function(){return 0===this.l?pe:(this.l>0&&this.l--,{done:!1,value:this.v})},e}(zn),Hn=zn.repeat=function(t,e){return new Un(t,e)},Kn=function(t){function e(t,e,n){this.s=t,this.fn=e?ve(e,n,3):null}function n(t){this.i=-1,this.s=t.s,this.l=this.s.length,this.fn=t.fn}return ze(e,t),e.prototype[ae]=function(){return new n(this)},n.prototype.next=function(){return++this.i<this.l?{done:!1,value:this.fn?this.fn(this.s[this.i],this.i,this.s):this.s[this.i]}:pe},e}(zn),Jn=zn.of=function(t,e,n){return new Kn(t,e,n)},Qn=function(t){function e(e,n){this.source=e,this._s=n,t.call(this)}return ze(e,t),e.prototype.subscribeCore=function(t){return this.source.subscribe(new Mn(this._s,t))},e}(In);qn.observeOn=function(t){return new Qn(this,t)};var $n=function(t){function e(e,n){this.source=e,this._s=n,t.call(this)}function n(t,e){var n=e[0],r=e[1],o=e[2];r.setDisposable(new C(t,n.subscribe(o)))}return ze(e,t),e.prototype.subscribeCore=function(t){var e=new tn,r=new en;return r.setDisposable(e),e.setDisposable(this._s.schedule([this.source,r,t],n)),r},e}(In);qn.subscribeOn=function(t){return new $n(this,t)};var Gn=function(t){function e(e){this.p=e,t.call(this)}return ze(e,t),e.prototype.subscribeCore=function(t){return this.p.then(function(e){t.onNext(e),t.onCompleted()},function(e){t.onError(e)}),Ge},e}(In),Xn=Ln.fromPromise=function(t){return new Gn(t)};qn.toPromise=function(t){if(t||(t=Bt.config.Promise),!t)throw new ue("Promise type not provided nor in Rx.config.Promise");var e=this;return new t(function(t,n){var r;e.subscribe(function(t){r=t},n,function(){t(r)})})};var Yn=function(t){function e(e){this.source=e,t.call(this)}function n(t){this.o=t,this.a=[],Tn.call(this)}return ze(e,t),e.prototype.subscribeCore=function(t){return this.source.subscribe(new n(t))},ze(n,Tn),n.prototype.next=function(t){this.a.push(t)},n.prototype.error=function(t){this.o.onError(t)},n.prototype.completed=function(){this.o.onNext(this.a),this.o.onCompleted()},e}(In);qn.toArray=function(){return new Yn(this)},Ln.create=function(t,e){return new Xi(t,e)};var Zn=function(t){function e(e){this._f=e,t.call(this)}return ze(e,t),e.prototype.subscribeCore=function(t){var e=Yt(this._f)();return e===Xt?wr(e.e).subscribe(t):($t(e)&&(e=Xn(e)),e.subscribe(t))},e}(In),tr=Ln.defer=function(t){return new Zn(t)},er=function(t){function e(e){this.scheduler=e,t.call(this)}function n(t,e){this.observer=t,this.scheduler=e}function r(t,e){return e.onCompleted(),Ge}return ze(e,t),e.prototype.subscribeCore=function(t){var e=new n(t,this.scheduler);return e.run()},n.prototype.run=function(){var t=this.observer;return this.scheduler===dn?r(null,t):this.scheduler.schedule(t,r)},e}(In),nr=new er(dn),rr=Ln.empty=function(t){return hn(t)||(t=dn),t===dn?nr:new er(t)},or=function(t){function e(e,n,r){this.iterable=e,this.mapper=n,this.scheduler=r,t.call(this)}return ze(e,t),e.prototype.subscribeCore=function(t){var e=new ir(t,this);return e.run()},e}(In),ir=function(){function t(t,e){this.o=t,this.parent=e}return t.prototype.run=function(){function t(t,e){var i=Yt(n.next).call(n);if(i===Xt)return r.onError(i.e);if(i.done)return r.onCompleted();var s=i.value;return Gt(o)&&(s=Yt(o)(s,t),s===Xt)?r.onError(s.e):(r.onNext(s),void e(t+1))}var e=Object(this.parent.iterable),n=k(e),r=this.o,o=this.parent.mapper;return this.parent.scheduler.scheduleRecursive(0,t)},t}(),sr=Math.pow(2,53)-1;O.prototype[ae]=function(){return new D(this._s)},D.prototype[ae]=function(){return this},D.prototype.next=function(){return this._i<this._l?{done:!1,value:this._s.charAt(this._i++)}:pe},S.prototype[ae]=function(){return new A(this._a)},A.prototype[ae]=function(){return this},A.prototype.next=function(){return this._i<this._l?{done:!1,value:this._a[this._i++]}:pe};var ur=Ln.from=function(t,e,n,r){if(null==t)throw new Error("iterable cannot be null.");if(e&&!Gt(e))throw new Error("mapFn when provided must be a function");if(e)var o=ve(e,n,2);return hn(r)||(r=bn),new or(t,o,r)},cr=function(t){function e(e,n){this.args=e,this.scheduler=n,t.call(this)}return ze(e,t),e.prototype.subscribeCore=function(t){var e=new P(t,this);return e.run()},e}(In);P.prototype.run=function(){function t(t,o){r>t?(e.onNext(n[t]),o(t+1)):e.onCompleted()}var e=this.observer,n=this.parent.args,r=n.length;return this.parent.scheduler.scheduleRecursive(0,t)};var hr=Ln.fromArray=function(t,e){return hn(e)||(e=bn),new cr(t,e)},ar=function(t){function e(e,n,r,o,i){this._state=e,this._cndFn=n,this._itrFn=r,this._resFn=o,this._s=i,this._first=!0,t.call(this)}function n(t,e){if(t._first)t._first=!1;else if(t._state=Yt(t._itrFn)(t._state),t._state===Xt)return t._o.onError(t._state.e);var n=Yt(t._cndFn)(t._state);if(n===Xt)return t._o.onError(n.e);if(n){var r=Yt(t._resFn)(t._state);if(r===Xt)return t._o.onError(r.e);t._o.onNext(r),e(t)}else t._o.onCompleted()}return ze(e,t),e.prototype.subscribeCore=function(t){return this._o=t,this._s.scheduleRecursive(this,n)},e}(In);Ln.generate=function(t,e,n,r,o){return hn(o)||(o=bn),new ar(t,e,n,r,o)},Ln.of=function(){for(var t=arguments.length,e=new Array(t),n=0;t>n;n++)e[n]=arguments[n];return new cr(e,bn)},Ln.ofWithScheduler=function(t){for(var e=arguments.length,n=new Array(e-1),r=1;e>r;r++)n[r-1]=arguments[r];return new cr(n,t)},Ln.ofArrayChanges=function(t){if(!Array.isArray(t))throw new TypeError("Array.observe only accepts arrays.");if("function"!=typeof Array.observe&&"function"!=typeof Array.unobserve)throw new TypeError("Array.observe is not supported on your platform");return new Xi(function(e){function n(t){for(var n=0,r=t.length;r>n;n++)e.onNext(t[n])}return Array.observe(t,n),function(){Array.unobserve(t,n)}})},Ln.ofObjectChanges=function(t){if(null==t)throw new TypeError("object must not be null or undefined.");if("function"!=typeof Object.observe&&"function"!=typeof Object.unobserve)throw new TypeError("Object.observe is not supported on your platform");return new Xi(function(e){function n(t){for(var n=0,r=t.length;r>n;n++)e.onNext(t[n])}return Object.observe(t,n),function(){Object.unobserve(t,n)}})};var pr=function(t){function e(){t.call(this)}return ze(e,t),e.prototype.subscribeCore=function(t){return Ge},e}(In),fr=new pr,lr=Ln.never=function(){return fr},dr=function(t){function e(e,n){this.obj=e,this.keys=Object.keys(e),this.scheduler=n,t.call(this)}return ze(e,t),e.prototype.subscribeCore=function(t){var e=new R(t,this);return e.run()},e}(In);R.prototype.run=function(){function t(t,i){if(o>t){var s=r[t];e.onNext([s,n[s]]),i(t+1)}else e.onCompleted()}var e=this.observer,n=this.parent.obj,r=this.parent.keys,o=r.length;return this.parent.scheduler.scheduleRecursive(0,t)},Ln.pairs=function(t,e){return e||(e=bn),new dr(t,e)};var vr=function(t){function e(e,n,r){this.start=e,this.rangeCount=n,this.scheduler=r,t.call(this)}return ze(e,t),e.prototype.subscribeCore=function(t){var e=new br(t,this);return e.run()},e}(In),br=function(){function t(t,e){this.observer=t,this.parent=e}return t.prototype.run=function(){function t(t,o){n>t?(r.onNext(e+t),o(t+1)):r.onCompleted()}var e=this.parent.start,n=this.parent.rangeCount,r=this.observer;return this.parent.scheduler.scheduleRecursive(0,t)},t}();Ln.range=function(t,e,n){return hn(n)||(n=bn),new vr(t,e,n)};var _r=function(t){function e(e,n,r){this.value=e,this.repeatCount=null==n?-1:n,this.scheduler=r,t.call(this)}return ze(e,t),e.prototype.subscribeCore=function(t){var e=new M(t,this);return e.run()},e}(In);M.prototype.run=function(){function t(t,r){return(-1===t||t>0)&&(e.onNext(n),t>0&&t--),0===t?e.onCompleted():void r(t)}var e=this.observer,n=this.parent.value;return this.parent.scheduler.scheduleRecursive(this.parent.repeatCount,t)},Ln.repeat=function(t,e,n){return hn(n)||(n=bn),new _r(t,e,n)};var mr=function(t){function e(e,n){this.value=e,this.scheduler=n,t.call(this)}function n(t,e,n){this.observer=t,this.value=e,this.scheduler=n}function r(t,e){var n=e[0],r=e[1];return r.onNext(n),r.onCompleted(),Ge}return ze(e,t),e.prototype.subscribeCore=function(t){var e=new n(t,this.value,this.scheduler);return e.run()},n.prototype.run=function(){var t=[this.value,this.observer];return this.scheduler===dn?r(null,t):this.scheduler.schedule(t,r)},e}(In),yr=(Ln["return"]=Ln.just=function(t,e){return hn(e)||(e=dn),new mr(t,e)},function(t){function e(e,n){this.error=e,this.scheduler=n,t.call(this)}function n(t,e){this.o=t,this.p=e}function r(t,e){var n=e[0],r=e[1];r.onError(n)}return ze(e,t),e.prototype.subscribeCore=function(t){var e=new n(t,this);return e.run()},n.prototype.run=function(){return this.p.scheduler.schedule([this.p.error,this.o],r)},e}(In)),wr=Ln["throw"]=function(t,e){return hn(e)||(e=dn),new yr(t,e)},gr=function(t){function e(e,n){this._resFn=e,this._obsFn=n,t.call(this)}return ze(e,t),e.prototype.subscribeCore=function(t){var e=Ge,n=Yt(this._resFn)();if(n===Xt)return new nn(wr(n.e).subscribe(t),e);n&&(e=n);var r=Yt(this._obsFn)(n);return r===Xt?new nn(wr(r.e).subscribe(t),e):new nn(r.subscribe(t),e)},e}(In);Ln.using=function(t,e){return new gr(t,e)},qn.amb=function(t){var e=this;return new Xi(function(n){function r(){i||(i=s,h.dispose())}function o(){i||(i=u,c.dispose())}var i,s="L",u="R",c=new tn,h=new tn;$t(t)&&(t=Xn(t));var a=kn(function(t){r(),i===s&&n.onNext(t)},function(t){r(),i===s&&n.onError(t)},function(){r(),i===s&&n.onCompleted()}),p=kn(function(t){o(),i===u&&n.onNext(t)},function(t){o(),i===u&&n.onError(t)},function(){o(),i===u&&n.onCompleted()});return c.setDisposable(e.subscribe(a)),h.setDisposable(t.subscribe(p)),new nn(c,h)})},Ln.amb=function(){var t,e=lr();if(Array.isArray(arguments[0]))t=arguments[0];else{var n=arguments.length;t=new Array(t);for(var r=0;n>r;r++)t[r]=arguments[r]}for(var r=0,n=t.length;n>r;r++)e=L(e,t[r]);return e};var Er=function(t){function e(e,n){this.source=e,this._fn=n,t.call(this)}return ze(e,t),e.prototype.subscribeCore=function(t){var e=new tn,n=new en;return n.setDisposable(e),e.setDisposable(this.source.subscribe(new Cr(t,n,this._fn))),n},e}(In),Cr=function(t){function e(e,n,r){this._o=e,this._s=n,this._fn=r,t.call(this)}return ze(e,t),e.prototype.next=function(t){this._o.onNext(t)},e.prototype.completed=function(){return this._o.onCompleted()},e.prototype.error=function(t){var e=Yt(this._fn)(t);if(e===Xt)return this._o.onError(e.e);$t(e)&&(e=Xn(e));var n=new tn;this._s.setDisposable(n),n.setDisposable(e.subscribe(this._o))},e}(Tn);qn["catch"]=function(t){return Gt(t)?new Er(this,t):xr([this,t])};var xr=Ln["catch"]=function(){var t;if(Array.isArray(arguments[0]))t=arguments[0];else{var e=arguments.length;t=new Array(e);for(var n=0;e>n;n++)t[n]=arguments[n]}return Jn(t).catchError()};qn.combineLatest=function(){for(var t=arguments.length,e=new Array(t),n=0;t>n;n++)e[n]=arguments[n];return Array.isArray(e[0])?e[0].unshift(this):e.unshift(this),Dr.apply(this,e)};var Nr=function(t){function e(e,n){var r=e.length;this._params=e,this._cb=n,this._hv=g(r,I),this._hvAll=!1,this._done=g(r,I),this._v=new Array(r),t.call(this)}return ze(e,t),e.prototype.subscribeCore=function(t){for(var e=this._params.length,n=new Array(e),r=0;e>r;r++){var o=this._params[r],i=new tn;n[r]=i,$t(o)&&(o=Xn(o)),i.setDisposable(o.subscribe(new Or(t,r,this)))}return new rn(n)},e}(In),Or=function(t){function e(e,n,r){this._o=e,this._i=n,this._p=r,t.call(this)}return ze(e,t),e.prototype.next=function(t){
if(this._p._v[this._i]=t,this._p._hv[this._i]=!0,this._p._hvAll||(this._p._hvAll=this._p._hv.every(Ut))){var e=Yt(this._p._cb).apply(null,this._p._v);if(e===Xt)return this._o.onError(e.e);this._o.onNext(e)}else this._p._done.filter(function(t,e){return e!==this._i},this).every(Ut)&&this._o.onCompleted()},e.prototype.error=function(t){this._o.onError(t)},e.prototype.completed=function(){this._p._done[this._i]=!0,this._p._done.every(Ut)&&this._o.onCompleted()},e}(Tn),Dr=Ln.combineLatest=function(){for(var t=arguments.length,e=new Array(t),n=0;t>n;n++)e[n]=arguments[n];var r=Gt(e[t-1])?e.pop():W;return Array.isArray(e[0])&&(e=e[0]),new Nr(e,r)};qn.concat=function(){for(var t=[],e=0,n=arguments.length;n>e;e++)t.push(arguments[e]);return t.unshift(this),Ar.apply(null,t)};var Sr=function(t){function e(e){this.sources=e,t.call(this)}function n(t,e){this.sources=t,this.o=e}return ze(e,t),e.prototype.subscribeCore=function(t){var e=new n(this.sources,t);return e.run()},n.prototype.run=function(){var t,e=new en,n=this.sources,r=n.length,o=this.o,i=dn.scheduleRecursive(0,function(i,s){if(!t){if(i===r)return o.onCompleted();var u=n[i];$t(u)&&(u=Xn(u));var c=new tn;e.setDisposable(c),c.setDisposable(u.subscribe(function(t){o.onNext(t)},function(t){o.onError(t)},function(){s(i+1)}))}});return new Ke(e,i,$e(function(){t=!0}))},e}(In),Ar=Ln.concat=function(){var t;if(Array.isArray(arguments[0]))t=arguments[0];else{t=new Array(arguments.length);for(var e=0,n=arguments.length;n>e;e++)t[e]=arguments[e]}return new Sr(t)};qn.concatAll=function(){return this.merge(1)};var jr=function(t){function e(e,n){this.source=e,this.maxConcurrent=n,t.call(this)}return ze(e,t),e.prototype.subscribeCore=function(t){var e=new Ke;return e.add(this.source.subscribe(new kr(t,this.maxConcurrent,e))),e},e}(In),kr=function(){function t(t,e,n){this.o=t,this.max=e,this.g=n,this.done=!1,this.q=[],this.activeCount=0,this.isStopped=!1}function e(t,e){this.parent=t,this.sad=e,this.isStopped=!1}return t.prototype.handleSubscribe=function(t){var n=new tn;this.g.add(n),$t(t)&&(t=Xn(t)),n.setDisposable(t.subscribe(new e(this,n)))},t.prototype.onNext=function(t){this.isStopped||(this.activeCount<this.max?(this.activeCount++,this.handleSubscribe(t)):this.q.push(t))},t.prototype.onError=function(t){this.isStopped||(this.isStopped=!0,this.o.onError(t))},t.prototype.onCompleted=function(){this.isStopped||(this.isStopped=!0,this.done=!0,0===this.activeCount&&this.o.onCompleted())},t.prototype.dispose=function(){this.isStopped=!0},t.prototype.fail=function(t){return this.isStopped?!1:(this.isStopped=!0,this.o.onError(t),!0)},e.prototype.onNext=function(t){this.isStopped||this.parent.o.onNext(t)},e.prototype.onError=function(t){this.isStopped||(this.isStopped=!0,this.parent.o.onError(t))},e.prototype.onCompleted=function(){if(!this.isStopped){this.isStopped=!0;var t=this.parent;t.g.remove(this.sad),t.q.length>0?t.handleSubscribe(t.q.shift()):(t.activeCount--,t.done&&0===t.activeCount&&t.o.onCompleted())}},e.prototype.dispose=function(){this.isStopped=!0},e.prototype.fail=function(t){return this.isStopped?!1:(this.isStopped=!0,this.parent.o.onError(t),!0)},t}();qn.merge=function(t){return"number"!=typeof t?qr(this,t):new jr(this,t)};var qr=Ln.merge=function(){var t,e,n=[],r=arguments.length;if(arguments[0])if(hn(arguments[0]))for(t=arguments[0],e=1;r>e;e++)n.push(arguments[e]);else for(t=dn,e=0;r>e;e++)n.push(arguments[e]);else for(t=dn,e=1;r>e;e++)n.push(arguments[e]);return Array.isArray(n[0])&&(n=n[0]),F(t,n).mergeAll()},Tr=function(t){function e(e){this.source=e,t.call(this)}function n(t,e){this.o=t,this.g=e,this.isStopped=!1,this.done=!1}function r(t,e){this.parent=t,this.sad=e,this.isStopped=!1}return ze(e,t),e.prototype.subscribeCore=function(t){var e=new Ke,r=new tn;return e.add(r),r.setDisposable(this.source.subscribe(new n(t,e))),e},n.prototype.onNext=function(t){if(!this.isStopped){var e=new tn;this.g.add(e),$t(t)&&(t=Xn(t)),e.setDisposable(t.subscribe(new r(this,e)))}},n.prototype.onError=function(t){this.isStopped||(this.isStopped=!0,this.o.onError(t))},n.prototype.onCompleted=function(){this.isStopped||(this.isStopped=!0,this.done=!0,1===this.g.length&&this.o.onCompleted())},n.prototype.dispose=function(){this.isStopped=!0},n.prototype.fail=function(t){return this.isStopped?!1:(this.isStopped=!0,this.o.onError(t),!0)},r.prototype.onNext=function(t){this.isStopped||this.parent.o.onNext(t)},r.prototype.onError=function(t){this.isStopped||(this.isStopped=!0,this.parent.o.onError(t))},r.prototype.onCompleted=function(){if(!this.isStopped){var t=this.parent;this.isStopped=!0,t.g.remove(this.sad),t.done&&1===t.g.length&&t.o.onCompleted()}},r.prototype.dispose=function(){this.isStopped=!0},r.prototype.fail=function(t){return this.isStopped?!1:(this.isStopped=!0,this.parent.o.onError(t),!0)},e}(In);qn.mergeAll=function(){return new Tr(this)};var Pr=Bt.CompositeError=function(t){this.name="NotImplementedError",this.innerErrors=t,this.message="This contains multiple errors. Check the innerErrors",Error.call(this)};Pr.prototype=Error.prototype,Ln.mergeDelayError=function(){var t;if(Array.isArray(arguments[0]))t=arguments[0];else{var e=arguments.length;t=new Array(e);for(var n=0;e>n;n++)t[n]=arguments[n]}var r=F(null,t);return new Xi(function(t){function e(){0===s.length?t.onCompleted():1===s.length?t.onError(s[0]):t.onError(new Pr(s))}var n=new Ke,o=new tn,i=!1,s=[];return n.add(o),o.setDisposable(r.subscribe(function(r){var o=new tn;n.add(o),$t(r)&&(r=Xn(r)),o.setDisposable(r.subscribe(function(e){t.onNext(e)},function(t){s.push(t),n.remove(o),i&&1===n.length&&e()},function(){n.remove(o),i&&1===n.length&&e()}))},function(t){s.push(t),i=!0,1===n.length&&e()},function(){i=!0,1===n.length&&e()})),n})},qn.onErrorResumeNext=function(t){if(!t)throw new Error("Second observable is required");return Fr([this,t])};var Fr=Ln.onErrorResumeNext=function(){var t=[];if(Array.isArray(arguments[0]))t=arguments[0];else for(var e=0,n=arguments.length;n>e;e++)t.push(arguments[e]);return new Xi(function(e){var n=0,r=new en,o=dn.scheduleRecursive(null,function(o,i){var s,u;n<t.length?(s=t[n++],$t(s)&&(s=Xn(s)),u=new tn,r.setDisposable(u),u.setDisposable(s.subscribe(e.onNext.bind(e),i,i))):e.onCompleted()});return new nn(r,o)})},Rr=function(t){function e(e,n){this._s=e,this._o=$t(n)?Xn(n):n,this._open=!1,t.call(this)}return ze(e,t),e.prototype.subscribeCore=function(t){var e=new tn;e.setDisposable(this._s.subscribe(new Mr(t,this))),$t(this._o)&&(this._o=Xn(this._o));var n=new tn;return n.setDisposable(this._o.subscribe(new Lr(t,this,n))),new nn(e,n)},e}(In),Mr=function(t){function e(e,n){this._o=e,this._p=n,t.call(this)}return ze(e,t),e.prototype.next=function(t){this._p._open&&this._o.onNext(t)},e.prototype.error=function(t){this._o.onError(t)},e.prototype.onCompleted=function(){this._p._open&&this._o.onCompleted()},e}(Tn),Lr=function(t){function e(e,n,r){this._o=e,this._p=n,this._r=r,t.call(this)}return ze(e,t),e.prototype.next=function(){this._p._open=!0,this._r.dispose()},e.prototype.error=function(t){this._o.onError(t)},e.prototype.onCompleted=function(){this._r.dispose()},e}(Tn);qn.skipUntil=function(t){return new Rr(this,t)};var Ir=function(t){function e(e){this.source=e,t.call(this)}function n(t,e){this.o=t,this.inner=e,this.stopped=!1,this.latest=0,this.hasLatest=!1,Tn.call(this)}function r(t,e){this.parent=t,this.id=e,Tn.call(this)}return ze(e,t),e.prototype.subscribeCore=function(t){var e=new en,r=this.source.subscribe(new n(t,e));return new nn(r,e)},ze(n,Tn),n.prototype.next=function(t){var e=new tn,n=++this.latest;this.hasLatest=!0,this.inner.setDisposable(e),$t(t)&&(t=Xn(t)),e.setDisposable(t.subscribe(new r(this,n)))},n.prototype.error=function(t){this.o.onError(t)},n.prototype.completed=function(){this.stopped=!0,!this.hasLatest&&this.o.onCompleted()},ze(r,Tn),r.prototype.next=function(t){this.parent.latest===this.id&&this.parent.o.onNext(t)},r.prototype.error=function(t){this.parent.latest===this.id&&this.parent.o.onError(t)},r.prototype.completed=function(){this.parent.latest===this.id&&(this.parent.hasLatest=!1,this.parent.isStopped&&this.parent.o.onCompleted())},e}(In);qn["switch"]=qn.switchLatest=function(){return new Ir(this)};var Wr=function(t){function e(e,n){this.source=e,this.other=$t(n)?Xn(n):n,t.call(this)}return ze(e,t),e.prototype.subscribeCore=function(t){return new nn(this.source.subscribe(t),this.other.subscribe(new zr(t)))},e}(In),zr=function(t){function e(e){this._o=e,t.call(this)}return ze(e,t),e.prototype.next=function(){this._o.onCompleted()},e.prototype.error=function(t){this._o.onError(t)},e.prototype.onCompleted=Vt,e}(Tn);qn.takeUntil=function(t){return new Wr(this,t)};var Br=function(t){function e(e,n,r){var o=n.length;this._s=e,this._ss=n,this._cb=r,this._hv=g(o,I),this._hvAll=!1,this._v=new Array(o),t.call(this)}return ze(e,t),e.prototype.subscribeCore=function(t){for(var e=this._ss.length,n=new Array(e+1),r=0;e>r;r++){var o=this._ss[r],i=new tn;$t(o)&&(o=Xn(o)),i.setDisposable(o.subscribe(new Vr(t,r,this))),n[r]=i}var i=new tn;return i.setDisposable(this._s.subscribe(new Ur(t,this))),n[e]=i,new rn(n)},e}(In),Vr=function(t){function e(e,n,r){this._o=e,this._i=n,this._p=r,t.call(this)}return ze(e,t),e.prototype.next=function(t){this._p._v[this._i]=t,this._p._hv[this._i]=!0,this._p._hvAll=this._p._hv.every(Ut)},e.prototype.error=function(t){this._o.onError(t)},e.prototype.completed=Vt,e}(Tn),Ur=function(t){function e(e,n){this._o=e,this._p=n,t.call(this)}return ze(e,t),e.prototype.next=function(t){var e=[t].concat(this._p._v);if(this._p._hvAll){var n=Yt(this._p._cb).apply(null,e);return n===Xt?this._o.onError(n.e):void this._o.onNext(n)}},e.prototype.error=function(t){this._o.onError(t)},e.prototype.completed=function(){this._o.onCompleted()},e}(Tn);qn.withLatestFrom=function(){if(0===arguments.length)throw new Error("invalid arguments");for(var t=arguments.length,e=new Array(t),n=0;t>n;n++)e[n]=arguments[n];var r=Gt(e[t-1])?e.pop():W;return Array.isArray(e[0])&&(e=e[0]),new Br(this,e,r)};var Hr=function(t){function e(e,n){var r=e.length;this._s=e,this._cb=n,this._done=g(r,I),this._q=g(r,z),t.call(this)}return ze(e,t),e.prototype.subscribeCore=function(t){for(var e=this._s.length,n=new Array(e),r=0;e>r;r++){var o=this._s[r],i=new tn;n[r]=i,$t(o)&&(o=Xn(o)),i.setDisposable(o.subscribe(new Kr(t,r,this)))}return new rn(n)},e}(In),Kr=function(t){function e(e,n,r){this._o=e,this._i=n,this._p=r,t.call(this)}return ze(e,t),e.prototype.next=function(t){if(this._p._q[this._i].push(t),this._p._q.every(function(t){return t.length>0})){var e=this._p._q.map(function(t){return t.shift()}),n=Yt(this._p._cb).apply(null,e);if(n===Xt)return this._o.onError(n.e);this._o.onNext(n)}else this._p._done.filter(function(t,e){return e!==this._i},this).every(Ut)&&this._o.onCompleted()},e.prototype.error=function(t){this._o.onError(t)},e.prototype.completed=function(){this._p._done[this._i]=!0,this._p._done.every(Ut)&&this._o.onCompleted()},e}(Tn);qn.zip=function(){if(0===arguments.length)throw new Error("invalid arguments");for(var t=arguments.length,e=new Array(t),n=0;t>n;n++)e[n]=arguments[n];var r=Gt(e[t-1])?e.pop():W;Array.isArray(e[0])&&(e=e[0]);var o=this;return e.unshift(o),new Hr(e,r)},Ln.zip=function(){for(var t=arguments.length,e=new Array(t),n=0;t>n;n++)e[n]=arguments[n];Array.isArray(e[0])&&(e=Gt(e[1])?e[0].concat(e[1]):e[0]);var r=e.shift();return r.zip.apply(r,e)},qn.zipIterable=function(){if(0===arguments.length)throw new Error("invalid arguments");for(var t=arguments.length,e=new Array(t),n=0;t>n;n++)e[n]=arguments[n];var r=Gt(e[t-1])?e.pop():W,o=this;return e.unshift(o),new Xi(function(t){for(var n=e.length,i=g(n,z),s=g(n,I),u=new Array(n),c=0;n>c;c++)!function(n){var c=e[n],h=new tn;(le(c)||fe(c))&&(c=ur(c)),h.setDisposable(c.subscribe(function(e){if(i[n].push(e),i.every(function(t){return t.length>0})){var u=i.map(function(t){return t.shift()}),c=Yt(r).apply(o,u);if(c===Xt)return t.onError(c.e);t.onNext(c)}else s.filter(function(t,e){return e!==n}).every(Ut)&&t.onCompleted()},function(e){t.onError(e)},function(){s[n]=!0,s.every(Ut)&&t.onCompleted()})),u[n]=h}(c);return new Ke(u)},o)},qn.asObservable=function(){return new Xi(B(this),this)},qn.bufferWithCount=function(t,e){return"number"!=typeof e&&(e=t),this.windowWithCount(t,e).flatMap(V).filter(U)};var Jr=function(t){function e(e){this.source=e,t.call(this)}return ze(e,t),e.prototype.subscribeCore=function(t){return this.source.subscribe(new Qr(t))},e}(In),Qr=function(t){function e(e){this._o=e,t.call(this)}return ze(e,t),e.prototype.next=function(t){t.accept(this._o)},e.prototype.error=function(t){this._o.onError(t)},e.prototype.completed=function(){this._o.onCompleted()},e}(Tn);qn.dematerialize=function(){return new Jr(this)};var $r=function(t){function e(e,n,r){this.source=e,this.keyFn=n,this.comparer=r,t.call(this)}return ze(e,t),e.prototype.subscribeCore=function(t){return this.source.subscribe(new Gr(t,this.keyFn,this.comparer))},e}(In),Gr=function(t){function e(e,n,r){this.o=e,this.keyFn=n,this.comparer=r,this.hasCurrentKey=!1,this.currentKey=null,t.call(this)}return ze(e,t),e.prototype.next=function(t){var e,n=t;return Gt(this.keyFn)&&(n=Yt(this.keyFn)(t),n===Xt)?this.o.onError(n.e):this.hasCurrentKey&&(e=Yt(this.comparer)(this.currentKey,n),e===Xt)?this.o.onError(e.e):void(this.hasCurrentKey&&e||(this.hasCurrentKey=!0,this.currentKey=n,this.o.onNext(t)))},e.prototype.error=function(t){this.o.onError(t)},e.prototype.completed=function(){this.o.onCompleted()},e}(Tn);qn.distinctUntilChanged=function(t,e){return e||(e=Kt),new $r(this,t,e)};var Xr=function(t){function e(e,n,r,o){this.source=e,this._oN=n,this._oE=r,this._oC=o,t.call(this)}function n(t,e){this.o=t,this.t=!e._oN||Gt(e._oN)?kn(e._oN||Vt,e._oE||Vt,e._oC||Vt):e._oN,this.isStopped=!1,Tn.call(this)}return ze(e,t),e.prototype.subscribeCore=function(t){return this.source.subscribe(new n(t,this))},ze(n,Tn),n.prototype.next=function(t){var e=Yt(this.t.onNext).call(this.t,t);e===Xt&&this.o.onError(e.e),this.o.onNext(t)},n.prototype.error=function(t){var e=Yt(this.t.onError).call(this.t,t);return e===Xt?this.o.onError(e.e):void this.o.onError(t)},n.prototype.completed=function(){var t=Yt(this.t.onCompleted).call(this.t);return t===Xt?this.o.onError(t.e):void this.o.onCompleted()},e}(In);qn["do"]=qn.tap=qn.doAction=function(t,e,n){return new Xr(this,t,e,n)},qn.doOnNext=qn.tapOnNext=function(t,e){return this.tap("undefined"!=typeof e?function(n){t.call(e,n)}:t)},qn.doOnError=qn.tapOnError=function(t,e){return this.tap(Vt,"undefined"!=typeof e?function(n){t.call(e,n)}:t)},qn.doOnCompleted=qn.tapOnCompleted=function(t,e){return this.tap(Vt,null,"undefined"!=typeof e?function(){t.call(e)}:t)},qn["finally"]=function(t){var e=this;return new Xi(function(n){var r=Yt(e.subscribe).call(e,n);return r===Xt?(t(),h(r.e)):$e(function(){var e=Yt(r.dispose).call(r);t(),e===Xt&&h(e.e)})},this)};var Yr=function(t){function e(e){this.source=e,t.call(this)}function n(t){this.o=t,this.isStopped=!1}return ze(e,t),e.prototype.subscribeCore=function(t){return this.source.subscribe(new n(t))},n.prototype.onNext=Vt,n.prototype.onError=function(t){this.isStopped||(this.isStopped=!0,this.o.onError(t))},n.prototype.onCompleted=function(){this.isStopped||(this.isStopped=!0,this.o.onCompleted())},n.prototype.dispose=function(){this.isStopped=!0},n.prototype.fail=function(t){return this.isStopped?!1:(this.isStopped=!0,this.observer.onError(t),!0)},e}(In);qn.ignoreElements=function(){return new Yr(this)};var Zr=function(t){function e(e,n){this.source=e,t.call(this)}return ze(e,t),e.prototype.subscribeCore=function(t){return this.source.subscribe(new to(t))},e}(In),to=function(t){function e(e){this._o=e,t.call(this)}return ze(e,t),e.prototype.next=function(t){this._o.onNext(Dn(t))},e.prototype.error=function(t){this._o.onNext(Sn(t)),this._o.onCompleted()},e.prototype.completed=function(){this._o.onNext(An()),this._o.onCompleted()},e}(Tn);qn.materialize=function(){return new Zr(this)},qn.repeat=function(t){return Hn(this,t).concat()},qn.retry=function(t){return Hn(this,t).catchError()},qn.retryWhen=function(t){return Hn(this).catchErrorWhen(t)};var eo=function(t){function e(e,n,r,o){this.source=e,this.accumulator=n,this.hasSeed=r,this.seed=o,t.call(this)}return ze(e,t),e.prototype.subscribeCore=function(t){return this.source.subscribe(new no(t,this))},e}(In),no=function(t){function e(e,n){this._o=e,this._p=n,this._fn=n.accumulator,this._hs=n.hasSeed,this._s=n.seed,this._ha=!1,this._a=null,this._hv=!1,this._i=0,t.call(this)}return ze(e,t),e.prototype.next=function(t){return!this._hv&&(this._hv=!0),this._ha?this._a=Yt(this._fn)(this._a,t,this._i,this._p):(this._a=this._hs?Yt(this._fn)(this._s,t,this._i,this._p):t,this._ha=!0),this._a===Xt?this._o.onError(this._a.e):(this._o.onNext(this._a),void this._i++)},e.prototype.error=function(t){this._o.onError(t)},e.prototype.completed=function(){!this._hv&&this._hs&&this._o.onNext(this._s),this._o.onCompleted()},e}(Tn);qn.scan=function(){var t,e=!1,n=arguments[0];return 2===arguments.length&&(e=!0,t=arguments[1]),new eo(this,n,e,t)};var ro=function(t){function e(e,n){this.source=e,this._c=n,t.call(this)}return ze(e,t),e.prototype.subscribeCore=function(t){return this.source.subscribe(new oo(t,this._c))},e}(In),oo=function(t){function e(e,n){this._o=e,this._c=n,this._q=[],t.call(this)}return ze(e,t),e.prototype.next=function(t){this._q.push(t),this._q.length>this._c&&this._o.onNext(this._q.shift())},e.prototype.error=function(t){this._o.onError(t)},e.prototype.completed=function(){this._o.onCompleted()},e}(Tn);qn.skipLast=function(t){if(0>t)throw new se;return new ro(this,t)},qn.startWith=function(){var t,e=0;arguments.length&&hn(arguments[0])?(t=arguments[0],e=1):t=dn;for(var n=[],r=e,o=arguments.length;o>r;r++)n.push(arguments[r]);return Jn([hr(n,t),this]).concat()};var io=function(t){function e(e,n){this._o=e,this._c=n,this._q=[],t.call(this)}return ze(e,t),e.prototype.next=function(t){this._q.push(t),this._q.length>this._c&&this._q.shift()},e.prototype.error=function(t){this._o.onError(t)},e.prototype.completed=function(){for(;this._q.length>0;)this._o.onNext(this._q.shift());this._o.onCompleted()},e}(Tn);qn.takeLast=function(t){if(0>t)throw new se;var e=this;return new Xi(function(n){return e.subscribe(new io(n,t))},e)};var so=function(t){function e(e,n){this._o=e,this._c=n,this._q=[],t.call(this)}return ze(e,t),e.prototype.next=function(t){this._q.push(t),this._q.length>this._c&&this._q.shift()},e.prototype.error=function(t){this._o.onError(t)},e.prototype.completed=function(){this._o.onNext(this._q),this._o.onCompleted()},e}(Tn);qn.takeLastBuffer=function(t){if(0>t)throw new se;var e=this;return new Xi(function(n){return e.subscribe(new so(n,t))},e)},qn.windowWithCount=function(t,e){var n=this;if(+t||(t=0),Math.abs(t)===1/0&&(t=0),0>=t)throw new se;if(null==e&&(e=t),+e||(e=0),Math.abs(e)===1/0&&(e=0),0>=e)throw new se;return new Xi(function(r){function o(){var t=new es;c.push(t),r.onNext(Ve(t,s))}var i=new tn,s=new on(i),u=0,c=[];return o(),i.setDisposable(n.subscribe(function(n){for(var r=0,i=c.length;i>r;r++)c[r].onNext(n);var s=u-t+1;s>=0&&s%e===0&&c.shift().onCompleted(),++u%e===0&&o()},function(t){for(;c.length>0;)c.shift().onError(t);r.onError(t)},function(){for(;c.length>0;)c.shift().onCompleted();r.onCompleted()})),s},n)},qn.selectConcat=qn.concatMap=function(t,e,n){return Gt(t)&&Gt(e)?this.concatMap(function(n,r){var o=t(n,r);return $t(o)&&(o=Xn(o)),(le(o)||fe(o))&&(o=ur(o)),o.map(function(t,o){return e(n,t,r,o)})}):Gt(t)?H(this,t,n):H(this,function(){return t})},qn.concatMapObserver=qn.selectConcatObserver=function(t,e,n,r){var o=this,i=ve(t,r,2),s=ve(e,r,1),u=ve(n,r,0);return new Xi(function(t){var e=0;return o.subscribe(function(n){var r;try{r=i(n,e++)}catch(o){return void t.onError(o)}$t(r)&&(r=Xn(r)),t.onNext(r)},function(e){var n;try{n=s(e)}catch(r){return void t.onError(r)}$t(n)&&(n=Xn(n)),t.onNext(n),t.onCompleted()},function(){var e;try{e=u()}catch(n){return void t.onError(n)}$t(e)&&(e=Xn(e)),t.onNext(e),t.onCompleted()})},this).concatAll()};var uo=function(t){function e(e,n){this._o=e,this._d=n,this._f=!1,t.call(this)}return ze(e,t),e.prototype.next=function(t){this._f=!0,this._o.onNext(t)},e.prototype.error=function(t){this._o.onError(t)},e.prototype.completed=function(){!this._f&&this._o.onNext(defaultValue),this._o.onCompleted()},e}(Tn);qn.defaultIfEmpty=function(t){var e=this;return t===s&&(t=null),new Xi(function(n){return e.subscribe(new uo(n,t))},e)},J.prototype.push=function(t){var e=-1===K(this.set,t,this.comparer);return e&&this.set.push(t),e};var co=function(t){function e(e,n,r){this.source=e,this._keyFn=n,this._cmpFn=r,t.call(this)}return ze(e,t),e.prototype.subscribeCore=function(t){return this.source.subscribe(new ho(t,this._keyFn,this._cmpFn))},e}(In),ho=function(t){function e(e,n,r){this._o=e,this._keyFn=n,this._h=new J(r),t.call(this)}return ze(e,t),e.prototype.next=function(t){var e=t;return Gt(this._keyFn)&&(e=Yt(this._keyFn)(t),e===Xt)?this._o.onError(e.e):void(this._h.push(e)&&this._o.onNext(t))},e.prototype.error=function(t){this._o.onError(t)},e.prototype.completed=function(){this._o.onCompleted()},e}(Tn);qn.distinct=function(t,e){return e||(e=Kt),new co(this,t,e)},qn.groupBy=function(t,e){return this.groupByUntil(t,e,lr)},qn.groupByUntil=function(t,e,n){var r=this;return new Xi(function(o){var i=new yi,u=new Ke,c=new on(u),h=function(t){return function(e){e.onError(t)}};return u.add(r.subscribe(function(r){var a=Yt(t)(r);if(a===Xt)return i.forEach(h(a.e)),o.onError(a.e);var p=!1,f=i.get(a);if(f===s&&(f=new es,i.set(a,f),p=!0),p){var l=new ts(a,f,c),d=new ts(a,f),v=Yt(n)(d);if(v===Xt)return i.forEach(h(v.e)),o.onError(v.e);o.onNext(l);var b=new tn;u.add(b),b.setDisposable(v.take(1).subscribe(Vt,function(t){i.forEach(h(t)),o.onError(t)},function(){i["delete"](a)&&f.onCompleted(),u.remove(b)}))}var _=r;return Gt(e)&&(_=Yt(e)(r),_===Xt)?(i.forEach(h(_.e)),o.onError(_.e)):void f.onNext(_)},function(t){i.forEach(h(t)),o.onError(t)},function(){i.forEach(function(t){t.onCompleted()}),o.onCompleted()})),c},r)};var ao=function(t){function e(e,n,r){this.source=e,this.selector=ve(n,r,3),t.call(this)}function n(t,e){return function(n,r,o){return t.call(this,e.selector(n,r,o),r,o)}}function r(t,e,n){this.o=t,this.selector=e,this.source=n,this.i=0,Tn.call(this)}return ze(e,t),e.prototype.internalMap=function(t,r){return new e(this.source,n(t,this),r)},e.prototype.subscribeCore=function(t){return this.source.subscribe(new r(t,this.selector,this))},ze(r,Tn),r.prototype.next=function(t){var e=Yt(this.selector)(t,this.i++,this.source);return e===Xt?this.o.onError(e.e):void this.o.onNext(e)},r.prototype.error=function(t){this.o.onError(t)},r.prototype.completed=function(){this.o.onCompleted()},e}(In);qn.map=qn.select=function(t,e){var n="function"==typeof t?t:function(){return t};return this instanceof ao?this.internalMap(n,e):new ao(this,n,e)},qn.pluck=function(){var t=arguments.length,e=new Array(t);if(0===t)throw new Error("List of properties cannot be empty.");for(var n=0;t>n;n++)e[n]=arguments[n];return this.map(Q(e,t))},qn.flatMap=qn.selectMany=function(t,e,n){return new Wn(this,t,e,n).mergeAll()},qn.flatMapObserver=qn.selectManyObserver=function(t,e,n,r){var o=this;return new Xi(function(i){var s=0;return o.subscribe(function(e){var n;try{n=t.call(r,e,s++)}catch(o){return void i.onError(o)}$t(n)&&(n=Xn(n)),i.onNext(n)},function(t){var n;try{n=e.call(r,t)}catch(o){return void i.onError(o)}$t(n)&&(n=Xn(n)),i.onNext(n),i.onCompleted()},function(){var t;try{t=n.call(r)}catch(e){return void i.onError(e)}$t(t)&&(t=Xn(t)),i.onNext(t),i.onCompleted()})},o).mergeAll()},Bt.Observable.prototype.flatMapLatest=function(t,e,n){return new Wn(this,t,e,n).switchLatest()};var po=function(t){function e(e,n){this.source=e,this.skipCount=n,t.call(this)}function n(t,e){this.c=e,this.r=e,this.o=t,this.isStopped=!1}return ze(e,t),e.prototype.subscribeCore=function(t){return this.source.subscribe(new n(t,this.skipCount))},n.prototype.onNext=function(t){this.isStopped||(this.r<=0?this.o.onNext(t):this.r--)},n.prototype.onError=function(t){this.isStopped||(this.isStopped=!0,this.o.onError(t))},n.prototype.onCompleted=function(){this.isStopped||(this.isStopped=!0,this.o.onCompleted())},n.prototype.dispose=function(){this.isStopped=!0},n.prototype.fail=function(t){return this.isStopped?!1:(this.isStopped=!0,this.o.onError(t),!0)},e}(In);qn.skip=function(t){if(0>t)throw new se;return new po(this,t)};var fo=function(t){function e(e,n){this.source=e,this._fn=n,t.call(this)}return ze(e,t),e.prototype.subscribeCore=function(t){return this.source.subscribe(new lo(t,this))},e}(In),lo=function(t){function e(e,n){this._o=e,this._p=n,this._i=0,this._r=!1,t.call(this)}return ze(e,t),e.prototype.next=function(t){if(!this._r){var e=Yt(this._p._fn)(t,this._i++,this._p);if(e===Xt)return this._o.onError(e.e);this._r=!e}this._r&&this._o.onNext(t)},e.prototype.error=function(t){this._o.onError(t)},e.prototype.completed=function(){this._o.onCompleted()},e}(Tn);qn.skipWhile=function(t,e){var n=ve(t,e,3);return new fo(this,n)};var vo=function(t){function e(e,n){this.source=e,this.takeCount=n,t.call(this)}function n(t,e){this.o=t,this.c=e,this.r=e,this.isStopped=!1}return ze(e,t),e.prototype.subscribeCore=function(t){return this.source.subscribe(new n(t,this.takeCount))},n.prototype={onNext:function(t){this.isStopped||this.r-->0&&(this.o.onNext(t),this.r<=0&&this.o.onCompleted())},onError:function(t){this.isStopped||(this.isStopped=!0,this.o.onError(t))},onCompleted:function(){this.isStopped||(this.isStopped=!0,this.o.onCompleted())},dispose:function(){this.isStopped=!0},fail:function(t){return this.isStopped?!1:(this.isStopped=!0,this.o.onError(t),!0)}},e}(In);qn.take=function(t,e){if(0>t)throw new se;return 0===t?rr(e):new vo(this,t)};var bo=function(t){function e(e,n){this.source=e,this._fn=n,t.call(this)}return ze(e,t),e.prototype.subscribeCore=function(t){return this.source.subscribe(new _o(t,this))},e}(In),_o=function(t){function e(e,n){this._o=e,this._p=n,this._i=0,this._r=!0,t.call(this)}return ze(e,t),e.prototype.next=function(t){return this._r&&(this._r=Yt(this._p._fn)(t,this._i++,this._p),this._r===Xt)?this._o.onError(this._r.e):void(this._r?this._o.onNext(t):this._o.onCompleted())},e.prototype.error=function(t){this._o.onError(t)},e.prototype.completed=function(){this._o.onCompleted()},e}(Tn);qn.takeWhile=function(t,e){var n=ve(t,e,3);return new bo(this,n)};var mo=function(t){function e(e,n,r){this.source=e,this.predicate=ve(n,r,3),t.call(this)}function n(t,e){return function(n,r,o){return e.predicate(n,r,o)&&t.call(this,n,r,o)}}function r(t,e,n){this.o=t,this.predicate=e,this.source=n,this.i=0,Tn.call(this)}return ze(e,t),e.prototype.subscribeCore=function(t){return this.source.subscribe(new r(t,this.predicate,this))},e.prototype.internalFilter=function(t,r){return new e(this.source,n(t,this),r)},ze(r,Tn),r.prototype.next=function(t){var e=Yt(this.predicate)(t,this.i++,this.source);return e===Xt?this.o.onError(e.e):void(e&&this.o.onNext(t))},r.prototype.error=function(t){this.o.onError(t)},r.prototype.completed=function(){this.o.onCompleted()},e}(In);qn.filter=qn.where=function(t,e){return this instanceof mo?this.internalFilter(t,e):new mo(this,t,e)};var yo=function(t){function e(e,n,r){this.source=e,this._k=n,this._c=r,t.call(this)}return ze(e,t),e.prototype.subscribeCore=function(t){return this.source.subscribe(new wo(t,this._k,this._c))},e}(In),wo=function(t){function e(e,n,r){this._o=e,this._k=n,this._c=r,this._v=null,this._hv=!1,this._l=[],t.call(this)}return ze(e,t),e.prototype.next=function(t){var e=Yt(this._k)(t);if(e===Xt)return this._o.onError(e.e);var n=0;if(this._hv){if(n=Yt(this._c)(e,this._v),n===Xt)return this._o.onError(n.e)}else this._hv=!0,this._v=e;n>0&&(this._v=e,this._l=[]),n>=0&&this._l.push(t)},e.prototype.error=function(t){this._o.onError(t)},e.prototype.completed=function(){this._o.onNext(this._l),this._o.onCompleted()},e}(Tn),go=function(t){function e(e,n,r,o){this.source=e,this.accumulator=n,this.hasSeed=r,this.seed=o,t.call(this)}return ze(e,t),e.prototype.subscribeCore=function(t){return this.source.subscribe(new Eo(t,this))},e}(In),Eo=function(t){function e(e,n){this._o=e,this._p=n,this._fn=n.accumulator,this._hs=n.hasSeed,this._s=n.seed,this._ha=!1,this._a=null,this._hv=!1,this._i=0,t.call(this)}return ze(e,t),e.prototype.next=function(t){return!this._hv&&(this._hv=!0),this._ha?this._a=Yt(this._fn)(this._a,t,this._i,this._p):(this._a=this._hs?Yt(this._fn)(this._s,t,this._i,this._p):t,this._ha=!0),this._a===Xt?this._o.onError(this._a.e):void this._i++},e.prototype.error=function(t){this._o.onError(t)},e.prototype.completed=function(){this._hv&&this._o.onNext(this._a),!this._hv&&this._hs&&this._o.onNext(this._s),!this._hv&&!this._hs&&this._o.onError(new oe),this._o.onCompleted()},e}(Tn);qn.reduce=function(){var t,e=!1,n=arguments[0];return 2===arguments.length&&(e=!0,t=arguments[1]),new go(this,n,e,t)};var Co=function(t){function e(e,n){this.source=e,this._fn=n,t.call(this)}return ze(e,t),e.prototype.subscribeCore=function(t){return this.source.subscribe(new xo(t,this._fn,this.source))},e}(In),xo=function(t){function e(e,n,r){this._o=e,this._fn=n,this._s=r,this._i=0,t.call(this)}return ze(e,t),e.prototype.next=function(t){var e=Yt(this._fn)(t,this._i++,this._s);return e===Xt?this._o.onError(e.e):void(Boolean(e)&&(this._o.onNext(!0),this._o.onCompleted()))},e.prototype.error=function(t){this._o.onError(t)},e.prototype.completed=function(){this._o.onNext(!1),this._o.onCompleted()},e}(Tn);qn.some=function(t,e){var n=ve(t,e,3);return new Co(this,n)};var No=function(t){function e(e){this.source=e,t.call(this)}return ze(e,t),e.prototype.subscribeCore=function(t){return this.source.subscribe(new Oo(t))},e}(In),Oo=function(t){function e(e){this._o=e,t.call(this)}return ze(e,t),e.prototype.next=function(){this._o.onNext(!1),this._o.onCompleted()},e.prototype.error=function(t){this._o.onError(t)},e.prototype.completed=function(){this._o.onNext(!0),this._o.onCompleted()},e}(Tn);qn.isEmpty=function(){return new No(this)};var Do=function(t){function e(e,n){this.source=e,this._fn=n,t.call(this)}return ze(e,t),e.prototype.subscribeCore=function(t){return this.source.subscribe(new So(t,this._fn,this.source))},e}(In),So=function(t){function e(e,n,r){this._o=e,this._fn=n,this._s=r,this._i=0,t.call(this)}return ze(e,t),e.prototype.next=function(t){var e=Yt(this._fn)(t,this._i++,this._s);return e===Xt?this._o.onError(e.e):void(Boolean(e)||(this._o.onNext(!1),this._o.onCompleted()))},e.prototype.error=function(t){this._o.onError(t)},e.prototype.completed=function(){this._o.onNext(!0),this._o.onCompleted()},e}(Tn);qn.every=function(t,e){var n=ve(t,e,3);return new Do(this,n)};var Ao=function(t){function e(e,n,r){var o=+r||0;Math.abs(o)===1/0&&(o=0),this.source=e,this._elem=n,this._n=o,t.call(this)}return ze(e,t),e.prototype.subscribeCore=function(t){return this._n<0?(t.onNext(!1),t.onCompleted(),Ge):this.source.subscribe(new jo(t,this._elem,this._n))},e}(In),jo=function(t){function e(e,n,r){this._o=e,this._elem=n,this._n=r,this._i=0,t.call(this)}function n(t,e){return 0===t&&0===e||t===e||isNaN(t)&&isNaN(e)}return ze(e,t),e.prototype.next=function(t){this._i++>=this._n&&n(t,this._elem)&&(this._o.onNext(!0),this._o.onCompleted())},e.prototype.error=function(t){this._o.onError(t)},e.prototype.completed=function(){this._o.onNext(!1),this._o.onCompleted()},e}(Tn);qn.includes=function(t,e){return new Ao(this,t,e)};var ko=function(t){function e(e,n){this.source=e,this._fn=n,t.call(this)}return ze(e,t),e.prototype.subscribeCore=function(t){return this.source.subscribe(new qo(t,this._fn,this.source))},e}(In),qo=function(t){function e(e,n,r){this._o=e,this._fn=n,this._s=r,this._i=0,this._c=0,t.call(this)}return ze(e,t),e.prototype.next=function(t){if(this._fn){var e=Yt(this._fn)(t,this._i++,this._s);if(e===Xt)return this._o.onError(e.e);
Boolean(e)&&this._c++}else this._c++},e.prototype.error=function(t){this._o.onError(t)},e.prototype.completed=function(){this._o.onNext(this._c),this._o.onCompleted()},e}(Tn);qn.count=function(t,e){var n=ve(t,e,3);return new ko(this,n)};var To=function(t){function e(e,n,r){this.source=e,this._e=n,this._n=r,t.call(this)}return ze(e,t),e.prototype.subscribeCore=function(t){return this._n<0?(t.onNext(-1),t.onCompleted(),Ge):this.source.subscribe(new Po(t,this._e,this._n))},e}(In),Po=function(t){function e(e,n,r){this._o=e,this._e=n,this._n=r,this._i=0,t.call(this)}return ze(e,t),e.prototype.next=function(t){this._i>=this._n&&t===this._e&&(this._o.onNext(this._i),this._o.onCompleted()),this._i++},e.prototype.error=function(t){this._o.onError(t)},e.prototype.completed=function(){this._o.onNext(-1),this._o.onCompleted()},e}(Tn);qn.indexOf=function(t,e){var n=+e||0;return Math.abs(n)===1/0&&(n=0),new To(this,t,n)};var Fo=function(t){function e(e,n){this.source=e,this._fn=n,t.call(this)}return ze(e,t),e.prototype.subscribeCore=function(t){return this.source.subscribe(new Ro(t,this._fn,this.source))},e}(In),Ro=function(t){function e(e,n,r){this._o=e,this._fn=n,this._s=r,this._i=0,this._c=0,t.call(this)}return ze(e,t),e.prototype.next=function(t){if(this._fn){var e=Yt(this._fn)(t,this._i++,this._s);if(e===Xt)return this._o.onError(e.e);this._c+=e}else this._c+=t},e.prototype.error=function(t){this._o.onError(t)},e.prototype.completed=function(){this._o.onNext(this._c),this._o.onCompleted()},e}(Tn);qn.sum=function(t,e){var n=ve(t,e,3);return new Fo(this,n)},qn.minBy=function(t,e){return e||(e=Jt),new yo(this,t,function(t,n){return-1*e(t,n)})},qn.min=function(t){return this.minBy(Ut,t).map(function(t){return $(t)})},qn.maxBy=function(t,e){return e||(e=Jt),new yo(this,t,e)},qn.max=function(t){return this.maxBy(Ut,t).map(function(t){return $(t)})};var Mo=function(t){function e(e,n){this.source=e,this._fn=n,t.call(this)}return ze(e,t),e.prototype.subscribeCore=function(t){return this.source.subscribe(new Lo(t,this._fn,this.source))},e}(In),Lo=function(t){function e(e,n,r){this._o=e,this._fn=n,this._s=r,this._c=0,this._t=0,t.call(this)}return ze(e,t),e.prototype.next=function(t){if(this._fn){var e=Yt(this._fn)(t,this._c++,this._s);if(e===Xt)return this._o.onError(e.e);this._t+=e}else this._c++,this._t+=t},e.prototype.error=function(t){this._o.onError(t)},e.prototype.completed=function(){return 0===this._c?this._o.onError(new oe):(this._o.onNext(this._t/this._c),void this._o.onCompleted())},e}(Tn);qn.average=function(t,e){var n,r=this;return Gt(t)&&(n=ve(t,e,3)),new Mo(r,n)},qn.sequenceEqual=function(t,e){var n=this;return e||(e=Kt),new Xi(function(r){var o=!1,i=!1,s=[],u=[],c=n.subscribe(function(t){if(u.length>0){var n=u.shift(),o=Yt(e)(n,t);if(o===Xt)return r.onError(o.e);o||(r.onNext(!1),r.onCompleted())}else i?(r.onNext(!1),r.onCompleted()):s.push(t)},function(t){r.onError(t)},function(){o=!0,0===s.length&&(u.length>0?(r.onNext(!1),r.onCompleted()):i&&(r.onNext(!0),r.onCompleted()))});(le(t)||fe(t))&&(t=ur(t)),$t(t)&&(t=Xn(t));var h=t.subscribe(function(t){if(s.length>0){var n=s.shift(),i=Yt(e)(n,t);if(i===Xt)return r.onError(i.e);i||(r.onNext(!1),r.onCompleted())}else o?(r.onNext(!1),r.onCompleted()):u.push(t)},function(t){r.onError(t)},function(){i=!0,0===u.length&&(s.length>0?(r.onNext(!1),r.onCompleted()):o&&(r.onNext(!0),r.onCompleted()))});return new nn(c,h)},n)};var Io=function(t){function e(e,n,r){this.source=e,this._i=n,this._d=r,t.call(this)}return ze(e,t),e.prototype.subscribeCore=function(t){return this.source.subscribe(new Wo(t,this._i,this._d))},e}(In),Wo=function(t){function e(e,n,r){this._o=e,this._i=n,this._d=r,t.call(this)}return ze(e,t),e.prototype.next=function(t){0===this._i--&&(this._o.onNext(t),this._o.onCompleted())},e.prototype.error=function(t){this._o.onError(t)},e.prototype.completed=function(){this._d===s?this._o.onError(new se):(this._o.onNext(this._d),this._o.onCompleted())},e}(Tn);qn.elementAt=function(t,e){if(0>t)throw new se;return new Io(this,t,e)};var zo=function(t){function e(e,n,r){this._o=e,this._obj=n,this._s=r,this._i=0,this._hv=!1,this._v=null,t.call(this)}return ze(e,t),e.prototype.next=function(t){var e=!1;if(this._obj.predicate){var n=Yt(this._obj.predicate)(t,this._i++,this._s);if(n===Xt)return this._o.onError(n.e);Boolean(n)&&(e=!0)}else this._obj.predicate||(e=!0);if(e){if(this._hv)return this._o.onError(new Error("Sequence contains more than one matching element"));this._hv=!0,this._v=t}},e.prototype.error=function(t){this._o.onError(t)},e.prototype.completed=function(){this._hv?(this._o.onNext(this._v),this._o.onCompleted()):this._obj.defaultValue===s?this._o.onError(new oe):(this._o.onNext(this._obj.defaultValue),this._o.onCompleted())},e}(Tn);qn.single=function(t,e){var n={},r=this;if(n="object"==typeof arguments[0]?arguments[0]:{predicate:arguments[0],thisArg:arguments[1],defaultValue:arguments[2]},Gt(n.predicate)){var o=n.predicate;n.predicate=ve(o,n.thisArg,3)}return new Xi(function(t){return r.subscribe(new zo(t,n,r))},r)};var Bo=function(t){function e(e,n){this.source=e,this._obj=n,t.call(this)}return ze(e,t),e.prototype.subscribeCore=function(t){return this.source.subscribe(new Vo(t,this._obj,this.source))},e}(In),Vo=function(t){function e(e,n,r){this._o=e,this._obj=n,this._s=r,this._i=0,t.call(this)}return ze(e,t),e.prototype.next=function(t){if(this._obj.predicate){var e=Yt(this._obj.predicate)(t,this._i++,this._s);if(e===Xt)return this._o.onError(e.e);Boolean(e)&&(this._o.onNext(t),this._o.onCompleted())}else this._obj.predicate||(this._o.onNext(t),this._o.onCompleted())},e.prototype.error=function(t){this._o.onError(t)},e.prototype.completed=function(){this._obj.defaultValue===s?this._o.onError(new oe):(this._o.onNext(this._obj.defaultValue),this._o.onCompleted())},e}(Tn);qn.first=function(){var t={};if(t="object"==typeof arguments[0]?arguments[0]:{predicate:arguments[0],thisArg:arguments[1],defaultValue:arguments[2]},Gt(t.predicate)){var e=t.predicate;t.predicate=ve(e,t.thisArg,3)}return new Bo(this,t)};var Uo=function(t){function e(e,n){this.source=e,this._obj=n,t.call(this)}return ze(e,t),e.prototype.subscribeCore=function(t){return this.source.subscribe(new Ho(t,this._obj,this.source))},e}(In),Ho=function(t){function e(e,n,r){this._o=e,this._obj=n,this._s=r,this._i=0,this._hv=!1,this._v=null,t.call(this)}return ze(e,t),e.prototype.next=function(t){var e=!1;if(this._obj.predicate){var n=Yt(this._obj.predicate)(t,this._i++,this._s);if(n===Xt)return this._o.onError(n.e);Boolean(n)&&(e=!0)}else this._obj.predicate||(e=!0);e&&(this._hv=!0,this._v=t)},e.prototype.error=function(t){this._o.onError(t)},e.prototype.completed=function(){this._hv?(this._o.onNext(this._v),this._o.onCompleted()):this._obj.defaultValue===s?this._o.onError(new oe):(this._o.onNext(this._obj.defaultValue),this._o.onCompleted())},e}(Tn);qn.last=function(){var t={};if(t="object"==typeof arguments[0]?arguments[0]:{predicate:arguments[0],thisArg:arguments[1],defaultValue:arguments[2]},Gt(t.predicate)){var e=t.predicate;t.predicate=ve(e,t.thisArg,3)}return new Uo(this,t)};var Ko=function(t){function e(e,n,r,o){this._o=e,this._s=n,this._cb=r,this._y=o,this._i=0,t.call(this)}return ze(e,t),e.prototype.next=function(t){var e=Yt(this._cb)(t,this._i,this._s);return e===Xt?this._o.onError(e.e):void(e?(this._o.onNext(this._y?this._i:t),this._o.onCompleted()):this._i++)},e.prototype.error=function(t){this._o.onError(t)},e.prototype.completed=function(){this._y&&this._o.onNext(-1),this._o.onCompleted()},e}(Tn);qn.find=function(t,e){return G(this,t,e,!1)},qn.findIndex=function(t,e){return G(this,t,e,!0)};var Jo=function(t){function e(e){this.source=e,t.call(this)}return ze(e,t),e.prototype.subscribeCore=function(t){return this.source.subscribe(new Qo(t))},e}(In),Qo=function(t){function e(e){this._o=e,this._s=new zt.Set,t.call(this)}return ze(e,t),e.prototype.next=function(t){this._s.add(t)},e.prototype.error=function(t){this._o.onError(t)},e.prototype.completed=function(){this._o.onNext(this._s),this._o.onCompleted()},e}(Tn);qn.toSet=function(){if("undefined"==typeof zt.Set)throw new TypeError;return new Jo(this)};var $o=function(t){function e(e,n,r){this.source=e,this._k=n,this._e=r,t.call(this)}return ze(e,t),e.prototype.subscribeCore=function(t){return this.source.subscribe(new Go(t,this._k,this._e))},e}(In),Go=function(t){function e(e,n,r){this._o=e,this._k=n,this._e=r,this._m=new zt.Map,t.call(this)}return ze(e,t),e.prototype.next=function(t){var e=Yt(this._k)(t);if(e===Xt)return this._o.onError(e.e);var n=t;return this._e&&(n=Yt(this._e)(t),n===Xt)?this._o.onError(n.e):void this._m.set(e,n)},e.prototype.error=function(t){this._o.onError(t)},e.prototype.completed=function(){this._o.onNext(this._m),this._o.onCompleted()},e}(Tn);qn.toMap=function(t,e){if("undefined"==typeof zt.Map)throw new TypeError;return new $o(this,t,e)};var Xo=function(t){function e(e,n,r){this.source=e,this._b=n,this._e=r,t.call(this)}return ze(e,t),e.prototype.subscribeCore=function(t){return this.source.subscribe(new Yo(t,this._b,this._e))},e}(In),Yo=function(t){function e(e,n,r){this._o=e,this._b=n,this._e=r,this._i=0,t.call(this)}return ze(e,t),e.prototype.next=function(t){this._i>=this._b&&(this._e===this._i?this._o.onCompleted():this._o.onNext(t)),this._i++},e.prototype.error=function(t){this._o.onError(t)},e.prototype.completed=function(){this._o.onCompleted()},e}(Tn);qn.slice=function(t,e){var n=t||0;if(0>n)throw new Bt.ArgumentOutOfRangeError;if("number"==typeof e&&n>e)throw new Bt.ArgumentOutOfRangeError;return new Xo(this,n,e)};var Zo=function(t){function e(e,n,r){this.source=e,this._e=n,this._n=r,t.call(this)}return ze(e,t),e.prototype.subscribeCore=function(t){return this._n<0?(t.onNext(-1),t.onCompleted(),Ge):this.source.subscribe(new ti(t,this._e,this._n))},e}(In),ti=function(t){function e(e,n,r){this._o=e,this._e=n,this._n=r,this._v=0,this._hv=!1,this._i=0,t.call(this)}return ze(e,t),e.prototype.next=function(t){this._i>=this._n&&t===this._e&&(this._hv=!0,this._v=this._i),this._i++},e.prototype.error=function(t){this._o.onError(t)},e.prototype.completed=function(){this._hv?this._o.onNext(this._v):this._o.onNext(-1),this._o.onCompleted()},e}(Tn);qn.lastIndexOf=function(t,e){var n=+e||0;return Math.abs(n)===1/0&&(n=0),new Zo(this,t,n)},Ln.wrap=function(t){function e(){return Ln.spawn.call(this,t.apply(this,arguments))}return e.__generatorFunction__=t,e};var ei=Ln.spawn=function(){for(var t=arguments[0],e=this,n=[],r=1,o=arguments.length;o>r;r++)n.push(arguments[r]);return new Xi(function(r){function o(e){var n=Yt(t.next).call(t,e);return n===Xt?r.onError(n.e):void s(n)}function i(e){var n=Yt(t.next).call(t,e);return n===Xt?r.onError(n.e):void s(n)}function s(t){if(t.done)return r.onNext(t.value),void r.onCompleted();var n=X.call(e,t.value);Ln.isObservable(n)?u.add(n.subscribe(o,i)):i(new TypeError("type not supported"))}var u=new Ke;return Gt(t)&&(t=t.apply(e,n)),t&&Gt(t.next)?(o(),u):(r.onNext(t),r.onCompleted())})};Ln.start=function(t,e,n){return ni(t,e,n)()};var ni=Ln.toAsync=function(t,e,n){return hn(n)||(n=gn),function(){var r=arguments,o=new ns;return n.schedule(null,function(){var n;try{n=t.apply(e,r)}catch(i){return void o.onError(i)}o.onNext(n),o.onCompleted()}),o.asObservable()}};Ln.fromCallback=function(t,e,n){return function(){"undefined"==typeof e&&(e=this);for(var r=arguments.length,o=new Array(r),i=0;r>i;i++)o[i]=arguments[i];return ot(t,e,n,o)}},Ln.fromNodeCallback=function(t,e,n){return function(){"undefined"==typeof e&&(e=this);for(var r=arguments.length,o=new Array(r),i=0;r>i;i++)o[i]=arguments[i];return st(t,e,n,o)}},ct.prototype.dispose=function(){this.isDisposed||(this._e.removeEventListener(this._n,this._fn,!1),this.isDisposed=!0)},Bt.config.useNativeEvents=!1,Ln.fromEvent=function(t,e,n){return t.addListener?ri(function(n){t.addListener(e,n)},function(n){t.removeListener(e,n)},n):Bt.config.useNativeEvents||"function"!=typeof t.on||"function"!=typeof t.off?new Xi(function(r){return ht(t,e,at(r,n))}).publish().refCount():ri(function(n){t.on(e,n)},function(n){t.off(e,n)},n)};var ri=Ln.fromEventPattern=function(t,e,n,r){return hn(r)||(r=dn),new Xi(function(r){function o(){var t=arguments[0];return Gt(n)&&(t=Yt(n).apply(null,arguments),t===Xt)?r.onError(t.e):void r.onNext(t)}var i=t(o);return $e(function(){Gt(e)&&e(o,i)})}).publish().refCount()};Ln.startAsync=function(t){var e=Yt(t)();return e===Xt?wr(e.e):Xn(e)};var oi=function(t){function e(e,n){this.source=e,this.controller=new es,n&&n.subscribe?this.pauser=this.controller.merge(n):this.pauser=this.controller,t.call(this)}return ze(e,t),e.prototype._subscribe=function(t){var e=this.source.publish(),n=e.subscribe(t),r=Ge,o=this.pauser.distinctUntilChanged().subscribe(function(t){t?r=e.connect():(r.dispose(),r=Ge)});return new rn([n,r,o])},e.prototype.pause=function(){this.controller.onNext(!1)},e.prototype.resume=function(){this.controller.onNext(!0)},e}(Ln);qn.pausable=function(t){return new oi(this,t)};var ii=function(t){function e(e,n){this.source=e,this.controller=new es,n&&n.subscribe?this.pauser=this.controller.merge(n):this.pauser=this.controller,t.call(this)}return ze(e,t),e.prototype._subscribe=function(t){function e(){for(;r.length>0;)t.onNext(r.shift())}var n,r=[],o=pt(this.source,this.pauser.startWith(!1).distinctUntilChanged(),function(t,e){return{data:t,shouldFire:e}}).subscribe(function(o){n!==s&&o.shouldFire!==n?(n=o.shouldFire,o.shouldFire&&e()):(n=o.shouldFire,o.shouldFire?t.onNext(o.data):r.push(o.data))},function(n){e(),t.onError(n)},function(){e(),t.onCompleted()});return o},e.prototype.pause=function(){this.controller.onNext(!1)},e.prototype.resume=function(){this.controller.onNext(!0)},e}(Ln);qn.pausableBuffered=function(t){return new ii(this,t)};var si=function(t){function e(e,n,r){t.call(this),this.subject=new ui(n,r),this.source=e.multicast(this.subject).refCount()}return ze(e,t),e.prototype._subscribe=function(t){return this.source.subscribe(t)},e.prototype.request=function(t){return this.subject.request(null==t?-1:t)},e}(Ln),ui=function(t){function e(e,n){null==e&&(e=!0),t.call(this),this.subject=new es,this.enableQueue=e,this.queue=e?[]:null,this.requestedCount=0,this.requestedDisposable=null,this.error=null,this.hasFailed=!1,this.hasCompleted=!1,this.scheduler=n||bn}return ze(e,t),Be(e.prototype,jn,{_subscribe:function(t){return this.subject.subscribe(t)},onCompleted:function(){this.hasCompleted=!0,this.enableQueue&&0!==this.queue.length?this.queue.push(Cn.createOnCompleted()):(this.subject.onCompleted(),this.disposeCurrentRequest())},onError:function(t){this.hasFailed=!0,this.error=t,this.enableQueue&&0!==this.queue.length?this.queue.push(Cn.createOnError(t)):(this.subject.onError(t),this.disposeCurrentRequest())},onNext:function(t){this.requestedCount<=0?this.enableQueue&&this.queue.push(Cn.createOnNext(t)):(0===this.requestedCount--&&this.disposeCurrentRequest(),this.subject.onNext(t))},_processRequest:function(t){if(this.enableQueue)for(;this.queue.length>0&&(t>0||"N"!==this.queue[0].kind);){var e=this.queue.shift();e.accept(this.subject),"N"===e.kind?t--:(this.disposeCurrentRequest(),this.queue=[])}return t},request:function(t){this.disposeCurrentRequest();var e=this;return this.requestedDisposable=this.scheduler.schedule(t,function(t,n){var r=e._processRequest(n),o=e.hasCompleted||e.hasFailed;return!o&&r>0?(e.requestedCount=r,$e(function(){e.requestedCount=0})):void 0}),this.requestedDisposable},disposeCurrentRequest:function(){this.requestedDisposable&&(this.requestedDisposable.dispose(),this.requestedDisposable=null)}}),e}(Ln);qn.controlled=function(t,e){return t&&hn(t)&&(e=t,t=!0),null==t&&(t=!0),new si(this,t,e)};var ci=function(t){function e(e){t.call(this),this.source=e}function n(t,e){e.source.request(1)}ze(e,t),e.prototype._subscribe=function(t){return this.subscription=this.source.subscribe(new r(t,this,this.subscription)),new nn(this.subscription,gn.schedule(this,n))};var r=function(t){function n(e,n,r){t.call(this),this.observer=e,this.observable=n,this.cancel=r,this.scheduleDisposable=null}function r(t,e){e.observable.source.request(1)}return ze(n,t),n.prototype.completed=function(){this.observer.onCompleted(),this.dispose()},n.prototype.error=function(t){this.observer.onError(t),this.dispose()},n.prototype.next=function(t){this.observer.onNext(t),this.scheduleDisposable=gn.schedule(this,r)},e.dispose=function(){this.observer=null,this.cancel&&(this.cancel.dispose(),this.cancel=null),this.scheduleDisposable&&(this.scheduleDisposable.dispose(),this.scheduleDisposable=null),t.prototype.dispose.call(this)},n}(Tn);return e}(Ln);si.prototype.stopAndWait=function(){return new ci(this)};var hi=function(t){function e(e,n){t.call(this),this.source=e,this.windowSize=n}function n(t,e){e.source.request(e.windowSize)}ze(e,t),e.prototype._subscribe=function(t){return this.subscription=this.source.subscribe(new r(t,this,this.subscription)),new nn(this.subscription,gn.schedule(this,n))};var r=function(t){function e(e,n,r){this.observer=e,this.observable=n,this.cancel=r,this.received=0,this.scheduleDisposable=null,t.call(this)}function n(t,e){e.observable.source.request(e.observable.windowSize)}return ze(e,t),e.prototype.completed=function(){this.observer.onCompleted(),this.dispose()},e.prototype.error=function(t){this.observer.onError(t),this.dispose()},e.prototype.next=function(t){this.observer.onNext(t),this.received=++this.received%this.observable.windowSize,0===this.received&&(this.scheduleDisposable=gn.schedule(this,n))},e.prototype.dispose=function(){this.observer=null,this.cancel&&(this.cancel.dispose(),this.cancel=null),this.scheduleDisposable&&(this.scheduleDisposable.dispose(),this.scheduleDisposable=null),t.prototype.dispose.call(this)},e}(Tn);return e}(Ln);si.prototype.windowed=function(t){return new hi(this,t)},qn.pipe=function(t){function e(){n.resume()}var n=this.pausableBuffered();return t.addListener("drain",e),n.subscribe(function(e){!t.write(String(e))&&n.pause()},function(e){t.emit("error",e)},function(){!t._isStdio&&t.end(),t.removeListener("drain",e)}),n.resume(),t};var ai=function(t){function e(e,n,r){this.source=e,this._fn1=n,this._fn2=r,t.call(this)}return ze(e,t),e.prototype.subscribeCore=function(t){var e=this.source.multicast(this._fn1());return new nn(this._fn2(e).subscribe(t),e.connect())},e}(In);qn.multicast=function(t,e){return Gt(t)?new ai(this,t,e):new vi(this,t)},qn.publish=function(t){return t&&Gt(t)?this.multicast(function(){return new es},t):this.multicast(new es)},qn.share=function(){return this.publish().refCount()},qn.publishLast=function(t){return t&&Gt(t)?this.multicast(function(){return new ns},t):this.multicast(new ns)},qn.publishValue=function(t,e){return 2===arguments.length?this.multicast(function(){return new fi(e)},t):this.multicast(new fi(t))},qn.shareValue=function(t){return this.publishValue(t).refCount()},qn.replay=function(t,e,n,r){return t&&Gt(t)?this.multicast(function(){return new li(e,n,r)},t):this.multicast(new li(e,n,r))},qn.shareReplay=function(t,e,n){return this.replay(null,t,e,n).refCount()};var pi=function(t,e){this._s=t,this._o=e};pi.prototype.dispose=function(){if(!this._s.isDisposed&&null!==this._o){var t=this._s.observers.indexOf(this._o);this._s.observers.splice(t,1),this._o=null}};var fi=Bt.BehaviorSubject=function(t){function e(e){t.call(this),this.value=e,this.observers=[],this.isDisposed=!1,this.isStopped=!1,this.hasError=!1}return ze(e,t),Be(e.prototype,jn,{_subscribe:function(t){return Ye(this),this.isStopped?(this.hasError?t.onError(this.error):t.onCompleted(),Ge):(this.observers.push(t),t.onNext(this.value),new pi(this,t))},getValue:function(){if(Ye(this),this.hasError)throw this.error;return this.value},hasObservers:function(){return this.observers.length>0},onCompleted:function(){if(Ye(this),!this.isStopped){this.isStopped=!0;for(var t=0,e=u(this.observers),n=e.length;n>t;t++)e[t].onCompleted();this.observers.length=0}},onError:function(t){if(Ye(this),!this.isStopped){this.isStopped=!0,this.hasError=!0,this.error=t;for(var e=0,n=u(this.observers),r=n.length;r>e;e++)n[e].onError(t);this.observers.length=0}},onNext:function(t){if(Ye(this),!this.isStopped){this.value=t;for(var e=0,n=u(this.observers),r=n.length;r>e;e++)n[e].onNext(t)}},dispose:function(){this.isDisposed=!0,this.observers=null,this.value=null,this.error=null}}),e}(Ln),li=Bt.ReplaySubject=function(t){function e(t,e){return $e(function(){e.dispose(),!t.isDisposed&&t.observers.splice(t.observers.indexOf(e),1)})}function n(e,n,o){this.bufferSize=null==e?r:e,this.windowSize=null==n?r:n,this.scheduler=o||bn,this.q=[],this.observers=[],this.isStopped=!1,this.isDisposed=!1,this.hasError=!1,this.error=null,t.call(this)}var r=Math.pow(2,53)-1;return ze(n,t),Be(n.prototype,jn.prototype,{_subscribe:function(t){Ye(this);var n=new Rn(this.scheduler,t),r=e(this,n);this._trim(this.scheduler.now()),this.observers.push(n);for(var o=0,i=this.q.length;i>o;o++)n.onNext(this.q[o].value);return this.hasError?n.onError(this.error):this.isStopped&&n.onCompleted(),n.ensureActive(),r},hasObservers:function(){return this.observers.length>0},_trim:function(t){for(;this.q.length>this.bufferSize;)this.q.shift();for(;this.q.length>0&&t-this.q[0].interval>this.windowSize;)this.q.shift()},onNext:function(t){if(Ye(this),!this.isStopped){var e=this.scheduler.now();this.q.push({interval:e,value:t}),this._trim(e);for(var n=0,r=u(this.observers),o=r.length;o>n;n++){var i=r[n];i.onNext(t),i.ensureActive()}}},onError:function(t){if(Ye(this),!this.isStopped){this.isStopped=!0,this.error=t,this.hasError=!0;var e=this.scheduler.now();this._trim(e);for(var n=0,r=u(this.observers),o=r.length;o>n;n++){var i=r[n];i.onError(t),i.ensureActive()}this.observers.length=0}},onCompleted:function(){if(Ye(this),!this.isStopped){this.isStopped=!0;var t=this.scheduler.now();this._trim(t);for(var e=0,n=u(this.observers),r=n.length;r>e;e++){var o=n[e];o.onCompleted(),o.ensureActive()}this.observers.length=0}},dispose:function(){this.isDisposed=!0,this.observers=null}}),n}(Ln),di=function(t){function e(e){this.source=e,this._count=0,this._connectableSubscription=null,t.call(this)}function n(t,e){this._p=t,this._s=e,this.isDisposed=!1}return ze(e,t),e.prototype.subscribeCore=function(t){var e=1===++this._count,r=this.source.subscribe(t);return e&&(this._connectableSubscription=this.source.connect()),new n(this,r)},n.prototype.dispose=function(){this.isDisposed||(this.isDisposed=!0,this._s.dispose(),0===--this._p._count&&this._p._connectableSubscription.dispose())},e}(In),vi=Bt.ConnectableObservable=function(t){function e(e,n){this.source=e,this._hasSubscription=!1,this._subscription=null,this._sourceObservable=e.asObservable(),this._subject=n,t.call(this)}function n(t){this._p=t,this.isDisposed=!1}return ze(e,t),n.prototype.dispose=function(){this.isDisposed||(this.isDisposed=!0,this._p._hasSubscription=!1)},e.prototype.connect=function(){return this._hasSubscription||(this._hasSubscription=!0,this._subscription=new nn(this._sourceObservable.subscribe(this._subject),new n(this))),this._subscription},e.prototype._subscribe=function(t){return this._subject.subscribe(t)},e.prototype.refCount=function(){return new di(this)},e}(Ln);qn.singleInstance=function(){function t(){return r||(r=!0,e=n["finally"](function(){r=!1}).publish().refCount()),e}var e,n=this,r=!1;return new Xi(function(e){return t().subscribe(e)})},qn.join=function(t,e,n,r){var o=this;return new Xi(function(i){var s=new Ke,u=!1,c=!1,h=0,a=0,p=new yi,f=new yi,l=function(t){i.onError(t)};return s.add(o.subscribe(function(t){var n=h++,o=new tn;p.set(n,t),s.add(o);var c=Yt(e)(t);return c===Xt?i.onError(c.e):(o.setDisposable(c.take(1).subscribe(Vt,l,function(){p["delete"](n)&&0===p.size&&u&&i.onCompleted(),s.remove(o)})),void f.forEach(function(e){var n=Yt(r)(t,e);return n===Xt?i.onError(n.e):void i.onNext(n)}))},l,function(){u=!0,(c||0===p.size)&&i.onCompleted()})),s.add(t.subscribe(function(t){var e=a++,o=new tn;f.set(e,t),s.add(o);var u=Yt(n)(t);return u===Xt?i.onError(u.e):(o.setDisposable(u.take(1).subscribe(Vt,l,function(){f["delete"](e)&&0===f.size&&c&&i.onCompleted(),s.remove(o)})),void p.forEach(function(e){var n=Yt(r)(e,t);return n===Xt?i.onError(n.e):void i.onNext(n)}))},l,function(){c=!0,(u||0===f.size)&&i.onCompleted()})),s},o)},qn.groupJoin=function(t,e,n,r){var o=this;return new Xi(function(i){function s(t){}var u=new Ke,c=new on(u),h=new yi,a=new yi,p=0,f=0,s=function(t){return function(e){e.onError(t)}};return u.add(o.subscribe(function(t){var n=new es,o=p++;h.set(o,n);var f=Yt(r)(t,Ve(n,c));if(f===Xt)return h.forEach(s(f.e)),i.onError(f.e);i.onNext(f),a.forEach(function(t){n.onNext(t)});var l=new tn;u.add(l);var d=Yt(e)(t);return d===Xt?(h.forEach(s(d.e)),i.onError(d.e)):void l.setDisposable(d.take(1).subscribe(Vt,function(t){h.forEach(s(t)),i.onError(t)},function(){h["delete"](o)&&n.onCompleted(),u.remove(l)}))},function(t){h.forEach(s(t)),i.onError(t)},function(){i.onCompleted()})),u.add(t.subscribe(function(t){var e=f++;a.set(e,t);var r=new tn;u.add(r);var o=Yt(n)(t);return o===Xt?(h.forEach(s(o.e)),i.onError(o.e)):(r.setDisposable(o.take(1).subscribe(Vt,function(t){h.forEach(s(t)),i.onError(t)},function(){a["delete"](e),u.remove(r)})),void h.forEach(function(e){e.onNext(t)}))},function(t){h.forEach(s(t)),i.onError(t)})),c},o)},qn.buffer=function(){return this.window.apply(this,arguments).flatMap(V)},qn.window=function(t,e){return 1===arguments.length&&"function"!=typeof arguments[0]?lt.call(this,t):"function"==typeof t?dt.call(this,t):ft.call(this,t,e)},qn.pairwise=function(){var t=this;return new Xi(function(e){var n,r=!1;return t.subscribe(function(t){r?e.onNext([n,t]):r=!0,n=t},e.onError.bind(e),e.onCompleted.bind(e))},t)},qn.partition=function(t,e){return[this.filter(t,e),this.filter(function(n,r,o){return!t.call(e,n,r,o)})]};var bi=function(t){function e(t,e){this.c=t,this.s=e}return ze(e,t),e.prototype[ae]=function(){var t=this;return{next:function(){return t.c()?{done:!1,value:t.s}:{done:!0,value:void 0}}}},e}(zn);qn.letBind=qn.let=function(t){return t(this)},Ln["if"]=function(t,e,n){return tr(function(){return n||(n=rr()),$t(e)&&(e=Xn(e)),$t(n)&&(n=Xn(n)),"function"==typeof n.now&&(n=rr(n)),t()?e:n})},Ln["for"]=Ln.forIn=function(t,e,n){return Jn(t,e,n).concat()};var _i=Ln["while"]=Ln.whileDo=function(t,e){return $t(e)&&(e=Xn(e)),vt(t,e).concat()};qn.doWhile=function(t){return Ar([this,_i(t,this)])},Ln["case"]=function(t,e,n){return tr(function(){$t(n)&&(n=Xn(n)),n||(n=rr()),hn(n)&&(n=rr(n));var r=e[t()];return $t(r)&&(r=Xn(r)),r||n})},qn.expand=function(t,e){hn(e)||(e=dn);var n=this;return new Xi(function(r){var o=[],i=new en,s=new Ke(i),u=0,c=!1,h=function(){var n=!1;o.length>0&&(n=!c,c=!0),n&&i.setDisposable(e.scheduleRecursive(null,function(e,n){var i;if(!(o.length>0))return void(c=!1);i=o.shift();var a=new tn;s.add(a),a.setDisposable(i.subscribe(function(e){r.onNext(e);var n=null;try{n=t(e)}catch(i){r.onError(i)}o.push(n),u++,h()},function(t){r.onError(t)},function(){s.remove(a),u--,0===u&&r.onCompleted()})),n()}))};return o.push(n),u++,h(),s},this)},Ln.forkJoin=function(){var t=[];if(Array.isArray(arguments[0]))t=arguments[0];else for(var e=0,n=arguments.length;n>e;e++)t.push(arguments[e]);return new Xi(function(e){var n=t.length;if(0===n)return e.onCompleted(),Ge;for(var r=new Ke,o=!1,i=new Array(n),s=new Array(n),u=new Array(n),c=0;n>c;c++)!function(c){var h=t[c];$t(h)&&(h=Xn(h)),r.add(h.subscribe(function(t){o||(i[c]=!0,u[c]=t)},function(t){o=!0,e.onError(t),r.dispose()},function(){if(!o){if(!i[c])return void e.onCompleted();s[c]=!0;for(var t=0;n>t;t++)if(!s[t])return;o=!0,e.onNext(u),e.onCompleted()}}))}(c);return r})},qn.forkJoin=function(t,e){var n=this;return new Xi(function(r){var o,i,s=!1,u=!1,c=!1,h=!1,a=new tn,p=new tn;return $t(t)&&(t=Xn(t)),a.setDisposable(n.subscribe(function(t){c=!0,o=t},function(t){p.dispose(),r.onError(t)},function(){if(s=!0,u)if(c)if(h){var t=Yt(e)(o,i);if(t===Xt)return r.onError(Fe);r.onNext(t),r.onCompleted()}else r.onCompleted();else r.onCompleted()})),p.setDisposable(t.subscribe(function(t){h=!0,i=t},function(t){a.dispose(),r.onError(t)},function(){if(u=!0,s)if(c)if(h){var t=Yt(e)(o,i);if(t===Xt)return r.onError(t.e);r.onNext(t),r.onCompleted()}else r.onCompleted();else r.onCompleted()})),new nn(a,p)},n)},qn.manySelect=qn.extend=function(t,e){hn(e)||(e=dn);var n=this;return tr(function(){var r;return n.map(function(t){var e=new mi(t);return r&&r.onNext(t),r=e,e}).tap(Vt,function(t){r&&r.onError(t)},function(){r&&r.onCompleted()}).observeOn(e).map(t)},n)};var mi=function(t){function e(e){t.call(this),this.head=e,this.tail=new ns}return ze(e,t),Be(e.prototype,jn,{_subscribe:function(t){var e=new Ke;return e.add(bn.schedule(this,function(n,r){t.onNext(r.head),e.add(r.tail.mergeAll().subscribe(t))})),e},onCompleted:function(){this.onNext(Ln.empty())},onError:function(t){this.onNext(Ln["throw"](t))},onNext:function(t){this.tail.onNext(t),this.tail.onCompleted()}}),e}(Ln),yi=zt.Map||function(){function t(){this.size=0,this._values=[],this._keys=[]}return t.prototype["delete"]=function(t){var e=this._keys.indexOf(t);return-1===e?!1:(this._values.splice(e,1),this._keys.splice(e,1),this.size--,!0)},t.prototype.get=function(t){var e=this._keys.indexOf(t);return-1===e?s:this._values[e]},t.prototype.set=function(t,e){var n=this._keys.indexOf(t);return-1===n?(this._keys.push(t),this._values.push(e),this.size++):this._values[n]=e,this},t.prototype.forEach=function(t,e){for(var n=0;n<this.size;n++)t.call(e,this._values[n],this._keys[n])},t}();bt.prototype.and=function(t){return new bt(this.patterns.concat(t))},bt.prototype.thenDo=function(t){return new _t(this,t)},_t.prototype.activate=function(t,e,n){for(var r=this,o=[],i=0,s=this.expression.patterns.length;s>i;i++)o.push(mt(t,this.expression.patterns[i],e.onError.bind(e)));var u=new yt(o,function(){var t;try{t=r.selector.apply(r,arguments)}catch(n){return void e.onError(n)}e.onNext(t)},function(){for(var t=0,e=o.length;e>t;t++)o[t].removeActivePlan(u);n(u)});for(i=0,s=o.length;s>i;i++)o[i].addActivePlan(u);return u},yt.prototype.dequeue=function(){this.joinObservers.forEach(function(t){t.queue.shift()})},yt.prototype.match=function(){var t,e,n=!0;for(t=0,e=this.joinObserverArray.length;e>t;t++)if(0===this.joinObserverArray[t].queue.length){n=!1;break}if(n){var r=[],o=!1;for(t=0,e=this.joinObserverArray.length;e>t;t++)r.push(this.joinObserverArray[t].queue[0]),"C"===this.joinObserverArray[t].queue[0].kind&&(o=!0);if(o)this.onCompleted();else{this.dequeue();var i=[];for(t=0,e=r.length;t<r.length;t++)i.push(r[t].value);this.onNext.apply(this,i)}}};var wi=function(t){function e(e,n){t.call(this),this.source=e,this.onError=n,this.queue=[],this.activePlans=[],this.subscription=new tn,this.isDisposed=!1}ze(e,t);var n=e.prototype;return n.next=function(t){if(!this.isDisposed){if("E"===t.kind)return this.onError(t.error);this.queue.push(t);for(var e=this.activePlans.slice(0),n=0,r=e.length;r>n;n++)e[n].match()}},n.error=Vt,n.completed=Vt,n.addActivePlan=function(t){this.activePlans.push(t)},n.subscribe=function(){this.subscription.setDisposable(this.source.materialize().subscribe(this))},n.removeActivePlan=function(t){this.activePlans.splice(this.activePlans.indexOf(t),1),0===this.activePlans.length&&this.dispose()},n.dispose=function(){t.prototype.dispose.call(this),this.isDisposed||(this.isDisposed=!0,this.subscription.dispose())},e}(Tn);qn.and=function(t){return new bt([this,t])},qn.thenDo=function(t){return new bt([this]).thenDo(t)},Ln.when=function(){var t,e=arguments.length;if(Array.isArray(arguments[0]))t=arguments[0];else{t=new Array(e);for(var n=0;e>n;n++)t[n]=arguments[n]}return new Xi(function(e){var n=[],r=new yi,o=kn(function(t){e.onNext(t)},function(t){r.forEach(function(e){e.onError(t)}),e.onError(t)},function(t){e.onCompleted()});try{for(var i=0,s=t.length;s>i;i++)n.push(t[i].activate(r,o,function(t){var r=n.indexOf(t);n.splice(r,1),
0===n.length&&e.onCompleted()}))}catch(u){wr(u).subscribe(e)}var c=new Ke;return r.forEach(function(t){t.subscribe(),c.add(t)}),c})};var gi=function(t){function e(e,n){this._dt=e,this._s=n,t.call(this)}function n(t,e){e.onNext(0),e.onCompleted()}return ze(e,t),e.prototype.subscribeCore=function(t){return this._s.scheduleFuture(t,this._dt,n)},e}(In),Ei=Ln.interval=function(t,e){return Et(t,t,hn(e)?e:gn)};Ln.timer=function(t,e,n){var r;return hn(n)||(n=gn),null!=e&&"number"==typeof e?r=e:hn(e)&&(n=e),(t instanceof Date||"number"==typeof t)&&r===s?wt(t,n):t instanceof Date&&r!==s?gt(t.getTime(),e,n):Et(t,r,n)};qn.delay=function(){var t=arguments[0];if("number"==typeof t||t instanceof Date){var e=t,n=arguments[1];return hn(n)||(n=gn),e instanceof Date?xt(this,e,n):Ct(this,e,n)}if(Ln.isObservable(t)||Gt(t))return Nt(this,t,arguments[1]);throw new Error("Invalid arguments")};var Ci=function(t){function e(e,n,r){hn(r)||(r=gn),this.source=e,this._dt=n,this._s=r,t.call(this)}return ze(e,t),e.prototype.subscribeCore=function(t){var e=new en;return new nn(this.source.subscribe(new xi(t,this.source,this._dt,this._s,e)),e)},e}(In),xi=function(t){function e(e,n,r,o,i){this._o=e,this._s=n,this._d=r,this._scheduler=o,this._c=i,this._v=null,this._hv=!1,this._id=0,t.call(this)}return ze(e,t),e.prototype.next=function(t){this._hv=!0,this._v=t;var e=++this._id,n=new tn;this._c.setDisposable(n),n.setDisposable(this._scheduler.scheduleFuture(this,this._d,function(n,r){r._hv&&r._id===e&&r._o.onNext(t),r._hv=!1}))},e.prototype.error=function(t){this._c.dispose(),this._o.onError(t),this._hv=!1,this._id++},e.prototype.completed=function(){this._c.dispose(),this._hv&&this._o.onNext(this._v),this._o.onCompleted(),this._hv=!1,this._id++},e}(Tn);qn.debounce=function(){if(Gt(arguments[0]))return Ot(this,arguments[0]);if("number"==typeof arguments[0])return new Ci(this,arguments[0],arguments[1]);throw new Error("Invalid arguments")},qn.windowWithTime=function(t,e,n){var r,o=this;return null==e&&(r=t),hn(n)||(n=gn),"number"==typeof e?r=e:hn(e)&&(r=t,n=e),new Xi(function(e){function i(){var t=new tn,o=!1,s=!1;p.setDisposable(t),h===c?(o=!0,s=!0):c>h?o=!0:s=!0;var l=o?h:c,d=l-f;f=l,o&&(h+=r),s&&(c+=r),t.setDisposable(n.scheduleFuture(null,d,function(){if(s){var t=new es;a.push(t),e.onNext(Ve(t,u))}o&&a.shift().onCompleted(),i()}))}var s,u,c=r,h=t,a=[],p=new en,f=0;return s=new Ke(p),u=new on(s),a.push(new es),e.onNext(Ve(a[0],u)),i(),s.add(o.subscribe(function(t){for(var e=0,n=a.length;n>e;e++)a[e].onNext(t)},function(t){for(var n=0,r=a.length;r>n;n++)a[n].onError(t);e.onError(t)},function(){for(var t=0,n=a.length;n>t;t++)a[t].onCompleted();e.onCompleted()})),u},o)},qn.windowWithTimeOrCount=function(t,e,n){var r=this;return hn(n)||(n=gn),new Xi(function(o){function i(e){var r=new tn;s.setDisposable(r),r.setDisposable(n.scheduleFuture(null,t,function(){if(e===a){h=0;var t=++a;p.onCompleted(),p=new es,o.onNext(Ve(p,c)),i(t)}}))}var s=new en,u=new Ke(s),c=new on(u),h=0,a=0,p=new es;return o.onNext(Ve(p,c)),i(0),u.add(r.subscribe(function(t){var n=0,r=!1;p.onNext(t),++h===e&&(r=!0,h=0,n=++a,p.onCompleted(),p=new es,o.onNext(Ve(p,c))),r&&i(n)},function(t){p.onError(t),o.onError(t)},function(){p.onCompleted(),o.onCompleted()})),c},r)},qn.bufferWithTime=function(t,e,n){return this.windowWithTime(t,e,n).flatMap(V)},qn.bufferWithTimeOrCount=function(t,e,n){return this.windowWithTimeOrCount(t,e,n).flatMap(V)};var Ni=function(t){function e(e,n){this.source=e,this._s=n,t.call(this)}return ze(e,t),e.prototype.subscribeCore=function(t){return this.source.subscribe(new Oi(t,this._s))},e}(In),Oi=function(t){function e(e,n){this._o=e,this._s=n,this._l=n.now(),t.call(this)}return ze(e,t),e.prototype.next=function(t){var e=this._s.now(),n=e-this._l;this._l=e,this._o.onNext({value:t,interval:n})},e.prototype.error=function(t){this._o.onError(t)},e.prototype.completed=function(){this._o.onCompleted()},e}(Tn);qn.timeInterval=function(t){return hn(t)||(t=gn),new Ni(this,t)};var Di=function(t){function e(e,n){this.source=e,this._s=n,t.call(this)}return ze(e,t),e.prototype.subscribeCore=function(t){return this.source.subscribe(new Si(t,this._s))},e}(In),Si=function(t){function e(e,n){this._o=e,this._s=n,t.call(this)}return ze(e,t),e.prototype.next=function(t){this._o.onNext({value:t,timestamp:this._s.now()})},e.prototype.error=function(t){this._o.onError(t)},e.prototype.completed=function(){this._o.onCompleted()},e}(Tn);qn.timestamp=function(t){return hn(t)||(t=gn),new Di(this,t)},qn.sample=qn.throttleLatest=function(t,e){return hn(e)||(e=gn),"number"==typeof t?Dt(this,Ei(t,e)):Dt(this,t)};var Ai=Bt.TimeoutError=function(t){this.message=t||"Timeout has occurred",this.name="TimeoutError",Error.call(this)};Ai.prototype=Object.create(Error.prototype),qn.timeout=function(){var t=arguments[0];if(t instanceof Date||"number"==typeof t)return At(this,t,arguments[1],arguments[2]);if(Ln.isObservable(t)||Gt(t))return St(this,t,arguments[1],arguments[2]);throw new Error("Invalid arguments")};var ji=function(t){function e(e,n,r,o,i,s){this._state=e,this._cndFn=n,this._itrFn=r,this._resFn=o,this._timeFn=i,this._s=s,this._first=!0,this._hasResult=!1,t.call(this)}function n(t,e){if(t._hasResult&&t._o.onNext(t._state),t._first)t._first=!1;else if(t._state=Yt(t._itrFn)(t._state),t._state===Xt)return t._o.onError(t._state.e);if(t._hasResult=Yt(t._cndFn)(t._state),t._hasResult===Xt)return t._o.onError(t._hasResult.e);if(t._hasResult){var n=Yt(t._resFn)(t._state);if(n===Xt)return t._o.onError(n.e);var r=Yt(t._timeFn)(t._state);if(r===Xt)return t._o.onError(r.e);e(t,r)}else t._o.onCompleted()}return ze(e,t),e.prototype.subscribeCore=function(t){return this._o=t,this._s.scheduleRecursiveFuture(this,new Date(this._s.now()),n)},e}(In);Ln.generateWithAbsoluteTime=function(t,e,n,r,o,i){return hn(i)||(i=gn),new ji(t,e,n,r,o,i)};var ki=function(t){function e(e,n,r,o,i,s){this._state=e,this._cndFn=n,this._itrFn=r,this._resFn=o,this._timeFn=i,this._s=s,this._first=!0,this._hasResult=!1,t.call(this)}function n(t,e){if(t._hasResult&&t._o.onNext(t._state),t._first)t._first=!1;else if(t._state=Yt(t._itrFn)(t._state),t._state===Xt)return t._o.onError(t._state.e);if(t._hasResult=Yt(t._cndFn)(t._state),t._hasResult===Xt)return t._o.onError(t._hasResult.e);if(t._hasResult){var n=Yt(t._resFn)(t._state);if(n===Xt)return t._o.onError(n.e);var r=Yt(t._timeFn)(t._state);if(r===Xt)return t._o.onError(r.e);e(t,r)}else t._o.onCompleted()}return ze(e,t),e.prototype.subscribeCore=function(t){return this._o=t,this._s.scheduleRecursiveFuture(this,0,n)},e}(In);Ln.generateWithRelativeTime=function(t,e,n,r,o,i){return hn(i)||(i=gn),new ki(t,e,n,r,o,i)};var qi=function(t){function e(e,n,r){this.source=e,this._dt=n,this._s=r,t.call(this)}function n(t,e){var n=e[0],r=e[1],o=e[2];o.setDisposable(n.subscribe(r))}return ze(e,t),e.prototype.subscribeCore=function(t){var e=new en;return e.setDisposable(this._s.scheduleFuture([this.source,t,e],this._dt,n)),e},e}(In);qn.delaySubscription=function(t,e){return hn(e)||(e=gn),new qi(this,t,e)};var Ti=function(t){function e(e,n,r){this.source=e,this._d=n,this._s=r,t.call(this)}return ze(e,t),e.prototype.subscribeCore=function(t){return this.source.subscribe(new Pi(t,this))},e}(In),Pi=function(t){function e(e,n){this._o=e,this._s=n._s,this._d=n._d,this._q=[],t.call(this)}return ze(e,t),e.prototype.next=function(t){var e=this._s.now();for(this._q.push({interval:e,value:t});this._q.length>0&&e-this._q[0].interval>=this._d;)this._o.onNext(this._q.shift().value)},e.prototype.error=function(t){this._o.onError(t)},e.prototype.completed=function(){for(var t=this._s.now();this._q.length>0&&t-this._q[0].interval>=this._d;)this._o.onNext(this._q.shift().value);this._o.onCompleted()},e}(Tn);qn.skipLastWithTime=function(t,e){return hn(e)||(e=gn),new Ti(this,t,e)};var Fi=function(t){function e(e,n,r){this.source=e,this._d=n,this._s=r,t.call(this)}return ze(e,t),e.prototype.subscribeCore=function(t){return this.source.subscribe(new Ri(t,this._d,this._s))},e}(In),Ri=function(t){function e(e,n,r){this._o=e,this._d=n,this._s=r,this._q=[],t.call(this)}return ze(e,t),e.prototype.next=function(t){var e=this._s.now();for(this._q.push({interval:e,value:t});this._q.length>0&&e-this._q[0].interval>=this._d;)this._q.shift()},e.prototype.error=function(t){this._o.onError(t)},e.prototype.completed=function(){for(var t=this._s.now();this._q.length>0;){var e=this._q.shift();t-e.interval<=this._d&&this._o.onNext(e.value)}this._o.onCompleted()},e}(Tn);qn.takeLastWithTime=function(t,e){return hn(e)||(e=gn),new Fi(this,t,e)},qn.takeLastBufferWithTime=function(t,e){var n=this;return hn(e)||(e=gn),new Xi(function(r){var o=[];return n.subscribe(function(n){var r=e.now();for(o.push({interval:r,value:n});o.length>0&&r-o[0].interval>=t;)o.shift()},function(t){r.onError(t)},function(){for(var n=e.now(),i=[];o.length>0;){var s=o.shift();n-s.interval<=t&&i.push(s.value)}r.onNext(i),r.onCompleted()})},n)};var Mi=function(t){function e(e,n,r){this.source=e,this._d=n,this._s=r,t.call(this)}function n(t,e){e.onCompleted()}return ze(e,t),e.prototype.subscribeCore=function(t){return new nn(this._s.scheduleFuture(t,this._d,n),this.source.subscribe(t))},e}(In);qn.takeWithTime=function(t,e){return hn(e)||(e=gn),new Mi(this,t,e)};var Li=function(t){function e(e,n,r){this.source=e,this._d=n,this._s=r,this._open=!1,t.call(this)}function n(t,e){e._open=!0}return ze(e,t),e.prototype.subscribeCore=function(t){return new nn(this._s.scheduleFuture(this,this._d,n),this.source.subscribe(new Ii(t,this)))},e}(In),Ii=function(t){function e(e,n){this._o=e,this._p=n,t.call(this)}return ze(e,t),e.prototype.next=function(t){this._p._open&&this._o.onNext(t)},e.prototype.error=function(t){this._o.onError(t)},e.prototype.completed=function(){this._o.onCompleted()},e}(Tn);qn.skipWithTime=function(t,e){return hn(e)||(e=gn),new Li(this,t,e)};var Wi=function(t){function e(e,n,r){this.source=e,this._st=n,this._s=r,t.call(this)}function n(t,e){e._open=!0}return ze(e,t),e.prototype.subscribeCore=function(t){return this._open=!1,new nn(this._s.scheduleFuture(this,this._st,n),this.source.subscribe(new zi(t,this)))},e}(In),zi=function(t){function e(e,n){this._o=e,this._p=n,t.call(this)}return ze(e,t),e.prototype.next=function(t){this._p._open&&this._o.onNext(t)},e.prototype.error=function(t){this._o.onError(t)},e.prototype.completed=function(){this._o.onCompleted()},e}(Tn);qn.skipUntilWithTime=function(t,e){return hn(e)||(e=gn),new Wi(this,t,e)},qn.takeUntilWithTime=function(t,e){hn(e)||(e=gn);var n=this;return new Xi(function(r){return new nn(e.scheduleFuture(r,t,function(t,e){e.onCompleted()}),n.subscribe(r))},n)},qn.throttle=function(t,e){hn(e)||(e=gn);var n=+t||0;if(0>=n)throw new RangeError("windowDuration cannot be less or equal zero.");var r=this;return new Xi(function(t){var o=0;return r.subscribe(function(r){var i=e.now();(0===o||i-o>=n)&&(o=i,t.onNext(r))},function(e){t.onError(e)},function(){t.onCompleted()})},r)};var Bi=function(t){function e(e,n){this._o=e,this._xform=n,t.call(this)}return ze(e,t),e.prototype.next=function(t){var e=Yt(this._xform["@@transducer/step"]).call(this._xform,this._o,t);e===Xt&&this._o.onError(e.e)},e.prototype.error=function(t){this._o.onError(t)},e.prototype.completed=function(){this._xform["@@transducer/result"](this._o)},e}(Tn);qn.transduce=function(t){var e=this;return new Xi(function(n){var r=t(jt(n));return e.subscribe(new Bi(n,r))},e)},qn.switchFirst=function(){var t=this;return new Xi(function(e){var n=!1,r=!1,o=new tn,i=new Ke;return i.add(o),o.setDisposable(t.subscribe(function(t){if(!n){n=!0,$t(t)&&(t=Xn(t));var o=new tn;i.add(o),o.setDisposable(t.subscribe(function(t){e.onNext(t)},function(t){e.onError(t)},function(){i.remove(o),n=!1,r&&1===i.length&&e.onCompleted()}))}},function(t){e.onError(t)},function(){r=!0,!n&&1===i.length&&e.onCompleted()})),i},this)},qn.flatMapFirst=qn.selectManyFirst=function(t,e,n){return new Wn(this,t,e,n).switchFirst()},Bt.Observable.prototype.flatMapWithMaxConcurrent=function(t,e,n,r){return new Wn(this,e,n,r).merge(t)};var Vi=Bt.VirtualTimeScheduler=function(t){function e(e,n){this.clock=e,this.comparer=n,this.isEnabled=!1,this.queue=new Ue(1024),t.call(this)}ze(e,t);var n=e.prototype;return n.now=function(){return this.toAbsoluteTime(this.clock)},n.schedule=function(t,e){return this.scheduleAbsolute(t,this.clock,e)},n.scheduleFuture=function(t,e,n){var r=e instanceof Date?this.toRelativeTime(e-this.now()):this.toRelativeTime(e);return this.scheduleRelative(t,r,n)},n.add=he,n.toAbsoluteTime=he,n.toRelativeTime=he,n.schedulePeriodic=function(t,e,n){var r=new fn(this,t,e,n);return r.start()},n.scheduleRelative=function(t,e,n){var r=this.add(this.clock,e);return this.scheduleAbsolute(t,r,n)},n.start=function(){if(!this.isEnabled){this.isEnabled=!0;do{var t=this.getNext();null!==t?(this.comparer(t.dueTime,this.clock)>0&&(this.clock=t.dueTime),t.invoke()):this.isEnabled=!1}while(this.isEnabled)}},n.stop=function(){this.isEnabled=!1},n.advanceTo=function(t){var e=this.comparer(this.clock,t);if(this.comparer(this.clock,t)>0)throw new se;if(0!==e&&!this.isEnabled){this.isEnabled=!0;do{var n=this.getNext();null!==n&&this.comparer(n.dueTime,t)<=0?(this.comparer(n.dueTime,this.clock)>0&&(this.clock=n.dueTime),n.invoke()):this.isEnabled=!1}while(this.isEnabled);this.clock=t}},n.advanceBy=function(t){var e=this.add(this.clock,t),n=this.comparer(this.clock,e);if(n>0)throw new se;0!==n&&this.advanceTo(e)},n.sleep=function(t){var e=this.add(this.clock,t);if(this.comparer(this.clock,e)>=0)throw new se;this.clock=e},n.getNext=function(){for(;this.queue.length>0;){var t=this.queue.peek();if(!t.isCancelled())return t;this.queue.dequeue()}return null},n.scheduleAbsolute=function(t,e,n){function r(t,e){return o.queue.remove(i),n(t,e)}var o=this,i=new sn(this,t,r,e,this.comparer);return this.queue.enqueue(i),i.disposable},e}(un);Bt.HistoricalScheduler=function(t){function e(e,n){var r=null==e?0:e,o=n||Jt;t.call(this,r,o)}ze(e,t);var n=e.prototype;return n.add=function(t,e){return t+e},n.toAbsoluteTime=function(t){return new Date(t).getTime()},n.toRelativeTime=function(t){return t},e}(Bt.VirtualTimeScheduler),kt.prototype.equals=function(t){return t===this?!0:null==t?!1:"N"!==t.kind?!1:this.predicate(t.value)},qt.prototype.equals=function(t){return t===this?!0:null==t?!1:"E"!==t.kind?!1:this.predicate(t.error)};var Ui=Bt.ReactiveTest={created:100,subscribed:200,disposed:1e3,onNext:function(t,e){return"function"==typeof e?new Hi(t,new kt(e)):new Hi(t,Cn.createOnNext(e))},onError:function(t,e){return"function"==typeof e?new Hi(t,new qt(e)):new Hi(t,Cn.createOnError(e))},onCompleted:function(t){return new Hi(t,Cn.createOnCompleted())},subscribe:function(t,e){return new Ki(t,e)}},Hi=Bt.Recorded=function(t,e,n){this.time=t,this.value=e,this.comparer=n||Kt};Hi.prototype.equals=function(t){return this.time===t.time&&this.comparer(this.value,t.value)},Hi.prototype.toString=function(){return this.value.toString()+"@"+this.time};var Ki=Bt.Subscription=function(t,e){this.subscribe=t,this.unsubscribe=e||Number.MAX_VALUE};Ki.prototype.equals=function(t){return this.subscribe===t.subscribe&&this.unsubscribe===t.unsubscribe},Ki.prototype.toString=function(){return"("+this.subscribe+", "+(this.unsubscribe===Number.MAX_VALUE?"Infinite":this.unsubscribe)+")"};var Ji=Bt.MockDisposable=function(t){this.scheduler=t,this.disposes=[],this.disposes.push(this.scheduler.clock)};Ji.prototype.dispose=function(){this.disposes.push(this.scheduler.clock)};var Qi=function(t){function e(e){t.call(this),this.scheduler=e,this.messages=[]}ze(e,t);var n=e.prototype;return n.onNext=function(t){this.messages.push(new Hi(this.scheduler.clock,Cn.createOnNext(t)))},n.onError=function(t){this.messages.push(new Hi(this.scheduler.clock,Cn.createOnError(t)))},n.onCompleted=function(){this.messages.push(new Hi(this.scheduler.clock,Cn.createOnCompleted()))},e}(jn);Tt.prototype.then=function(t,e){var n=this;this.subscriptions.push(new Ki(this.scheduler.clock));var r,o=this.subscriptions.length-1,i=Bt.Observer.create(function(e){var u=t(e);if(u&&"function"==typeof u.then)r=u;else{var c=n.scheduler.clock;r=new Tt(n.scheduler,[Bt.ReactiveTest.onNext(c,s),Bt.ReactiveTest.onCompleted(c)])}var h=n.observers.indexOf(i);n.observers.splice(h,1),n.subscriptions[o]=new Ki(n.subscriptions[o].subscribe,n.scheduler.clock)},function(t){e(t);var r=n.observers.indexOf(i);n.observers.splice(r,1),n.subscriptions[o]=new Ki(n.subscriptions[o].subscribe,n.scheduler.clock)});return this.observers.push(i),r||new Tt(this.scheduler,this.messages)};var $i=function(t){function e(e,n){t.call(this);var r,o,i=this;this.scheduler=e,this.messages=n,this.subscriptions=[],this.observers=[];for(var s=0,u=this.messages.length;u>s;s++)r=this.messages[s],o=r.value,function(t){e.scheduleAbsolute(null,r.time,function(){for(var e=i.observers.slice(0),n=0,r=e.length;r>n;n++)t.accept(e[n]);return Ge})}(o)}return ze(e,t),e.prototype._subscribe=function(t){var e=this;this.observers.push(t),this.subscriptions.push(new Ki(this.scheduler.clock));var n=this.subscriptions.length-1;return $e(function(){var r=e.observers.indexOf(t);e.observers.splice(r,1),e.subscriptions[n]=new Ki(e.subscriptions[n].subscribe,e.scheduler.clock)})},e}(Ln),Gi=function(t){function e(e,n){t.call(this),this.scheduler=e,this.messages=n,this.subscriptions=[]}return ze(e,t),e.prototype._subscribe=function(t){var e,n,r=this;this.subscriptions.push(new Ki(this.scheduler.clock));for(var o=this.subscriptions.length-1,i=new Ke,s=0,u=this.messages.length;u>s;s++)e=this.messages[s],n=e.value,function(n){i.add(r.scheduler.scheduleRelative(null,e.time,function(){return n.accept(t),Ge}))}(n);return $e(function(){r.subscriptions[o]=new Ki(r.subscriptions[o].subscribe,r.scheduler.clock),i.dispose()})},e}(Ln);Bt.TestScheduler=function(t){function e(t,e){return t>e?1:e>t?-1:0}function n(){t.call(this,0,e)}return ze(n,t),n.prototype.scheduleAbsolute=function(e,n,r){return n<=this.clock&&(n=this.clock+1),t.prototype.scheduleAbsolute.call(this,e,n,r)},n.prototype.add=function(t,e){return t+e},n.prototype.toAbsoluteTime=function(t){return new Date(t).getTime()},n.prototype.toRelativeTime=function(t){return t},n.prototype.startScheduler=function(t,e){e||(e={}),null==e.created&&(e.created=Ui.created),null==e.subscribed&&(e.subscribed=Ui.subscribed),null==e.disposed&&(e.disposed=Ui.disposed);var n,r,o=this.createObserver();return this.scheduleAbsolute(null,e.created,function(){return n=t(),Ge}),this.scheduleAbsolute(null,e.subscribed,function(){return r=n.subscribe(o),Ge}),this.scheduleAbsolute(null,e.disposed,function(){return r.dispose(),Ge}),this.start(),o},n.prototype.createHotObservable=function(){var t,e=arguments.length;if(Array.isArray(arguments[0]))t=arguments[0];else{t=new Array(e);for(var n=0;e>n;n++)t[n]=arguments[n]}return new $i(this,t)},n.prototype.createColdObservable=function(){var t,e=arguments.length;if(Array.isArray(arguments[0]))t=arguments[0];else{t=new Array(e);for(var n=0;e>n;n++)t[n]=arguments[n]}return new Gi(this,t)},n.prototype.createResolvedPromise=function(t,e){return new Tt(this,[Bt.ReactiveTest.onNext(t,e),Bt.ReactiveTest.onCompleted(t)])},n.prototype.createRejectedPromise=function(t,e){return new Tt(this,[Bt.ReactiveTest.onError(t,e)])},n.prototype.createObserver=function(){return new Qi(this)},n}(Vi);var Xi=Bt.AnonymousObservable=function(t){function e(t){return t&&Gt(t.dispose)?t:Gt(t)?$e(t):Ge}function n(t,n){var r=n[0],o=n[1],i=Yt(o.__subscribe).call(o,r);i!==Xt||r.fail(Xt.e)||h(Xt.e),r.setDisposable(e(i))}function r(e,n){this.source=n,this.__subscribe=e,t.call(this)}return ze(r,t),r.prototype._subscribe=function(t){var e=new Yi(t),r=[e,this];return bn.scheduleRequired()?bn.schedule(r,n):n(null,r),e},r}(Ln),Yi=function(t){function e(e){t.call(this),this.observer=e,this.m=new tn}ze(e,t);var n=e.prototype;return n.next=function(t){var e=Yt(this.observer.onNext).call(this.observer,t);e===Xt&&(this.dispose(),h(e.e))},n.error=function(t){var e=Yt(this.observer.onError).call(this.observer,t);this.dispose(),e===Xt&&h(e.e)},n.completed=function(){var t=Yt(this.observer.onCompleted).call(this.observer);this.dispose(),t===Xt&&h(t.e)},n.setDisposable=function(t){this.m.setDisposable(t)},n.getDisposable=function(){return this.m.getDisposable()},n.dispose=function(){t.prototype.dispose.call(this),this.m.dispose()},e}(Tn),Zi=function(t){function e(e,n){this._m=e,this._u=n,t.call(this)}return ze(e,t),e.prototype.subscribeCore=function(t){return new nn(this._m.getDisposable(),this._u.subscribe(t))},e}(In),ts=function(t){function e(e,n,r){t.call(this),this.key=e,this.underlyingObservable=r?new Zi(r,n):n}return ze(e,t),e.prototype._subscribe=function(t){return this.underlyingObservable.subscribe(t)},e}(Ln),es=Bt.Subject=function(t){function e(){t.call(this),this.isDisposed=!1,this.isStopped=!1,this.observers=[],this.hasError=!1}return ze(e,t),Be(e.prototype,jn.prototype,{_subscribe:function(t){return Ye(this),this.isStopped?this.hasError?(t.onError(this.error),Ge):(t.onCompleted(),Ge):(this.observers.push(t),new pi(this,t))},hasObservers:function(){return this.observers.length>0},onCompleted:function(){if(Ye(this),!this.isStopped){this.isStopped=!0;for(var t=0,e=u(this.observers),n=e.length;n>t;t++)e[t].onCompleted();this.observers.length=0}},onError:function(t){if(Ye(this),!this.isStopped){this.isStopped=!0,this.error=t,this.hasError=!0;for(var e=0,n=u(this.observers),r=n.length;r>e;e++)n[e].onError(t);this.observers.length=0}},onNext:function(t){if(Ye(this),!this.isStopped)for(var e=0,n=u(this.observers),r=n.length;r>e;e++)n[e].onNext(t)},dispose:function(){this.isDisposed=!0,this.observers=null}}),e.create=function(t,e){return new rs(t,e)},e}(Ln),ns=Bt.AsyncSubject=function(t){function e(){t.call(this),this.isDisposed=!1,this.isStopped=!1,this.hasValue=!1,this.observers=[],this.hasError=!1}return ze(e,t),Be(e.prototype,jn,{_subscribe:function(t){return Ye(this),this.isStopped?(this.hasError?t.onError(this.error):this.hasValue?(t.onNext(this.value),t.onCompleted()):t.onCompleted(),Ge):(this.observers.push(t),new pi(this,t))},hasObservers:function(){return Ye(this),this.observers.length>0},onCompleted:function(){var t,e;if(Ye(this),!this.isStopped){this.isStopped=!0;var n=u(this.observers),e=n.length;if(this.hasValue)for(t=0;e>t;t++){var r=n[t];r.onNext(this.value),r.onCompleted()}else for(t=0;e>t;t++)n[t].onCompleted();this.observers.length=0}},onError:function(t){if(Ye(this),!this.isStopped){this.isStopped=!0,this.hasError=!0,this.error=t;for(var e=0,n=u(this.observers),r=n.length;r>e;e++)n[e].onError(t);this.observers.length=0}},onNext:function(t){Ye(this),this.isStopped||(this.value=t,this.hasValue=!0)},dispose:function(){this.isDisposed=!0,this.observers=null,this.error=null,this.value=null}}),e}(Ln),rs=Bt.AnonymousSubject=function(t){function e(e,n){this.observer=e,this.observable=n,t.call(this)}return ze(e,t),Be(e.prototype,jn.prototype,{_subscribe:function(t){return this.observable.subscribe(t)},onCompleted:function(){this.observer.onCompleted()},onError:function(t){this.observer.onError(t)},onNext:function(t){this.observer.onNext(t)}}),e}(Ln);Bt.Pauser=function(t){function e(){t.call(this)}return ze(e,t),e.prototype.pause=function(){this.onNext(!1)},e.prototype.resume=function(){this.onNext(!0)},e}(es),zt.Rx=Bt,r=function(){return Bt}.call(e,n,e,t),!(r!==s&&(t.exports=r));var os=d()}).call(this)}).call(e,n(11)(t),function(){return this}(),n(12))},function(t,e){t.exports=function(t){return t.webpackPolyfill||(t.deprecate=function(){},t.paths=[],t.children=[],t.webpackPolyfill=1),t}},function(t,e){function n(){h=!1,s.length?c=s.concat(c):a=-1,c.length&&r()}function r(){if(!h){var t=setTimeout(n);h=!0;for(var e=c.length;e;){for(s=c,c=[];++a<e;)s&&s[a].run();a=-1,e=c.length}s=null,h=!1,clearTimeout(t)}}function o(t,e){this.fun=t,this.array=e}function i(){}var s,u=t.exports={},c=[],h=!1,a=-1;u.nextTick=function(t){var e=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)e[n-1]=arguments[n];c.push(new o(t,e)),1!==c.length||h||setTimeout(r,0)},o.prototype.run=function(){this.fun.apply(null,this.array)},u.title="browser",u.browser=!0,u.env={},u.argv=[],u.version="",u.versions={},u.on=i,u.addListener=i,u.once=i,u.off=i,u.removeListener=i,u.removeAllListeners=i,u.emit=i,u.binding=function(t){throw new Error("process.binding is not supported")},u.cwd=function(){return"/"},u.chdir=function(t){throw new Error("process.chdir is not supported")},u.umask=function(){return 0}}]);
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vcmVhY3QtY2xpbWItc29jaWFsLmpzIiwid2VicGFjazovLy93ZWJwYWNrL2Jvb3RzdHJhcCA1MTA2NGVhMDg2Y2FlZjI1ZGFkYSIsIndlYnBhY2s6Ly8vLi9zcmMvaW5kZXguanMiLCJ3ZWJwYWNrOi8vL2V4dGVybmFsIFwiUmVhY3RcIiIsIndlYnBhY2s6Ly8vLi9zcmMvY29tcG9uZW50cy9BdXRob3IuanN4Iiwid2VicGFjazovLy8uL3NyYy9jb21wb25lbnRzL0ltYWdlLmpzeCIsIndlYnBhY2s6Ly8vLi9zcmMvY29tcG9uZW50cy9JbnRlcmFjdGlvbi5qc3giLCJ3ZWJwYWNrOi8vLy4vc3JjL2NvbXBvbmVudHMvTWVzc2FnZS5qc3giLCJ3ZWJwYWNrOi8vLy4vc3JjL2NvbXBvbmVudHMvVGlsZS5qc3giLCJ3ZWJwYWNrOi8vLy4vc3JjL2NvbXBvbmVudHMvV2FsbC5qc3giLCJ3ZWJwYWNrOi8vLy4vc3JjL3V0aWxzL2NsaW1iLmpzIiwid2VicGFjazovLy8uL34vZmV0Y2gtanNvbnAvYnVpbGQvZmV0Y2gtanNvbnAuanMiLCJ3ZWJwYWNrOi8vLy4vfi9yeC9kaXN0L3J4LmFsbC5qcyIsIndlYnBhY2s6Ly8vKHdlYnBhY2spL2J1aWxkaW4vbW9kdWxlLmpzIiwid2VicGFjazovLy8od2VicGFjaykvfi9ub2RlLWxpYnMtYnJvd3Nlci9+L3Byb2Nlc3MvYnJvd3Nlci5qcyJdLCJuYW1lcyI6WyJtb2R1bGVzIiwiX193ZWJwYWNrX3JlcXVpcmVfXyIsIm1vZHVsZUlkIiwiaW5zdGFsbGVkTW9kdWxlcyIsImV4cG9ydHMiLCJtb2R1bGUiLCJpZCIsImxvYWRlZCIsImNhbGwiLCJtIiwiYyIsInAiLCJfaW50ZXJvcFJlcXVpcmVEZWZhdWx0Iiwib2JqIiwiX19lc01vZHVsZSIsImRlZmF1bHQiLCJPYmplY3QiLCJkZWZpbmVQcm9wZXJ0eSIsInZhbHVlIiwiX3JlYWN0IiwiX3JlYWN0MiIsIl9jb21wb25lbnRzV2FsbEpzeCIsIl9jb21wb25lbnRzV2FsbEpzeDIiLCJ3aW5kb3ciLCJDbGltYiIsIiR0YXJnZXRzIiwiZG9jdW1lbnQiLCJxdWVyeVNlbGVjdG9yQWxsIiwiaSIsImxlbmd0aCIsIiRpdGVtIiwiY29sbGVjdGlvbklkIiwiZGF0YXNldCIsImxpbWl0IiwicmVuZGVyIiwiY3JlYXRlRWxlbWVudCIsIlJlYWN0IiwiX2NsYXNzQ2FsbENoZWNrIiwiaW5zdGFuY2UiLCJDb25zdHJ1Y3RvciIsIlR5cGVFcnJvciIsIl9pbmhlcml0cyIsInN1YkNsYXNzIiwic3VwZXJDbGFzcyIsInByb3RvdHlwZSIsImNyZWF0ZSIsImNvbnN0cnVjdG9yIiwiZW51bWVyYWJsZSIsIndyaXRhYmxlIiwiY29uZmlndXJhYmxlIiwic2V0UHJvdG90eXBlT2YiLCJfX3Byb3RvX18iLCJfY3JlYXRlQ2xhc3MiLCJkZWZpbmVQcm9wZXJ0aWVzIiwidGFyZ2V0IiwicHJvcHMiLCJkZXNjcmlwdG9yIiwia2V5IiwicHJvdG9Qcm9wcyIsInN0YXRpY1Byb3BzIiwiX2dldCIsIl94IiwiX3gyIiwiX3gzIiwiX2FnYWluIiwib2JqZWN0IiwicHJvcGVydHkiLCJyZWNlaXZlciIsImRlc2MiLCJwYXJlbnQiLCJnZXR0ZXIiLCJ1bmRlZmluZWQiLCJGdW5jdGlvbiIsImdldE93blByb3BlcnR5RGVzY3JpcHRvciIsImdldCIsImdldFByb3RvdHlwZU9mIiwiQXV0aG9yIiwiX1JlYWN0JENvbXBvbmVudCIsInRoaXMiLCJhcHBseSIsImFyZ3VtZW50cyIsImNsYXNzTmFtZSIsImhyZWYiLCJsaW5rIiwic3JjIiwicGljdHVyZSIsImFsdCIsIm5hbWUiLCJ1c2VybmFtZSIsImZvbGxvd2Vyc19jb3VudCIsIkNvbXBvbmVudCIsInByb3BUeXBlcyIsIkltYWdlIiwiZGF0YS13aWR0aCIsIndpZHRoIiwiZGF0YS1oZWlnaHQiLCJoZWlnaHQiLCJQcm9wVHlwZXMiLCJzdHJpbmciLCJpc1JlcXVpcmVkIiwibnVtYmVyIiwiSW50ZXJhY3Rpb24iLCJib2R5IiwiTWVzc2FnZSIsImRhbmdlcm91c2x5U2V0SW5uZXJIVE1MIiwiX19odG1sIiwiX0ltYWdlIiwiX0ltYWdlMiIsIl9NZXNzYWdlIiwiX01lc3NhZ2UyIiwiX0F1dGhvciIsIl9BdXRob3IyIiwiX0ludGVyYWN0aW9uIiwiX0ludGVyYWN0aW9uMiIsIlRpbGUiLCJjcmVhdGVJbWFnZSIsImJpbmQiLCJjcmVhdGVNZXNzYWdlIiwiY3JlYXRlSW50ZXJhY3Rpb24iLCJjcmVhdGVDbGFzc1N0cmluZyIsImltYWdlIiwiX3Byb3BzJGltYWdlIiwidXJsIiwibWVzc2FnZSIsImNsYXNzU3RyaW5nIiwic291cmNlX3R5cGUiLCJ2aWRlb191cmwiLCJpbnRlcmFjdGlvbiIsImF1dGhvciIsInRpbWVzdGFtcCIsInNoYXBlIiwidmlkZW9fc3JjIiwiX29iamVjdFdpdGhvdXRQcm9wZXJ0aWVzIiwia2V5cyIsImluZGV4T2YiLCJoYXNPd25Qcm9wZXJ0eSIsIl9leHRlbmRzIiwiYXNzaWduIiwic291cmNlIiwiX3V0aWxzQ2xpbWIiLCJfdXRpbHNDbGltYjIiLCJfVGlsZSIsIl9UaWxlMiIsIldhbGwiLCJzdGF0ZSIsIml0ZW1zIiwiX3RoaXMiLCJnZXRTdHJlYW0iLCJzdWJzY3JpYmUiLCJtYXhTaXplIiwic2V0U3RhdGUiLCJzcGxpY2UiLCJpbml0IiwiY2IiLCJvblVwZGF0ZSIsInRpbGVzIiwibWFwIiwiaXRlbSIsIm90aGVyUHJvcHMiLCJwdXNoIiwiZGlzcGxheU5hbWUiLCJfcngiLCJfcngyIiwiX2ZldGNoSnNvbnAiLCJfZmV0Y2hKc29ucDIiLCJwb2xsUmF0ZSIsInJlcXVlc3RTdHJlYW0iLCJPYnNlcnZhYmxlIiwianVzdCIsInVwZGF0ZVN0cmVhbSIsImludGVydmFsIiwic3RhcnRXaXRoIiwicmVzcG9uc2VTdHJlYW0iLCJjb21iaW5lTGF0ZXN0IiwidGljayIsImZsYXRNYXAiLCJiYXNlVXJsIiwicmVxdWVzdFVybCIsImZyb21Qcm9taXNlIiwidGhlbiIsInJlc3AiLCJqc29uIiwiY2xpbWIiLCJfX1dFQlBBQ0tfQU1EX0RFRklORV9GQUNUT1JZX18iLCJfX1dFQlBBQ0tfQU1EX0RFRklORV9BUlJBWV9fIiwiX19XRUJQQUNLX0FNRF9ERUZJTkVfUkVTVUxUX18iLCJnbG9iYWwiLCJmYWN0b3J5IiwiZ2VuZXJhdGVDYWxsYmFja0Z1bmN0aW9uIiwiRGF0ZSIsIm5vdyIsIk1hdGgiLCJjZWlsIiwicmFuZG9tIiwiY2xlYXJGdW5jdGlvbiIsImZ1bmN0aW9uTmFtZSIsImUiLCJyZW1vdmVTY3JpcHQiLCJzY3JpcHRJZCIsInNjcmlwdCIsImdldEVsZW1lbnRCeUlkIiwiZ2V0RWxlbWVudHNCeVRhZ05hbWUiLCJyZW1vdmVDaGlsZCIsImRlZmF1bHRPcHRpb25zIiwidGltZW91dCIsImpzb25wQ2FsbGJhY2siLCJmZXRjaEpzb25wIiwib3B0aW9ucyIsInRpbWVvdXRJZCIsIlByb21pc2UiLCJyZXNvbHZlIiwicmVqZWN0IiwiY2FsbGJhY2tGdW5jdGlvbiIsInJlc3BvbnNlIiwib2siLCJjbGVhclRpbWVvdXQiLCJqc29ucFNjcmlwdCIsInNldEF0dHJpYnV0ZSIsImFwcGVuZENoaWxkIiwic2V0VGltZW91dCIsIkVycm9yIiwicHJvY2VzcyIsImNsb25lQXJyYXkiLCJhcnIiLCJhIiwibGVuIiwidHJ5Q2F0Y2hlckdlbiIsInRyeUNhdGNoVGFyZ2V0IiwiZXJyb3JPYmoiLCJ0aHJvd2VyIiwibWFrZVN0YWNrVHJhY2VMb25nIiwiZXJyb3IiLCJvYnNlcnZhYmxlIiwiaGFzU3RhY2tzIiwic3RhY2siLCJTVEFDS19KVU1QX1NFUEFSQVRPUiIsInN0YWNrcyIsIm8iLCJ1bnNoaWZ0IiwiY29uY2F0ZWRTdGFja3MiLCJqb2luIiwiZmlsdGVyU3RhY2tTdHJpbmciLCJzdGFja1N0cmluZyIsImxpbmVzIiwic3BsaXQiLCJkZXNpcmVkTGluZXMiLCJsaW5lIiwiaXNJbnRlcm5hbEZyYW1lIiwiaXNOb2RlRnJhbWUiLCJzdGFja0xpbmUiLCJmaWxlTmFtZUFuZExpbmVOdW1iZXIiLCJnZXRGaWxlTmFtZUFuZExpbmVOdW1iZXIiLCJmaWxlTmFtZSIsImxpbmVOdW1iZXIiLCJyRmlsZU5hbWUiLCJyU3RhcnRpbmdMaW5lIiwickVuZGluZ0xpbmUiLCJjYXB0dXJlTGluZSIsImZpcnN0TGluZSIsImF0dGVtcHQxIiwiZXhlYyIsIk51bWJlciIsImF0dGVtcHQyIiwiYXR0ZW1wdDMiLCJrZXlzSW4iLCJyZXN1bHQiLCJpc09iamVjdCIsInN1cHBvcnQiLCJub25FbnVtQXJncyIsImlzQXJndW1lbnRzIiwic2xpY2UiLCJza2lwUHJvdG8iLCJlbnVtUHJvdG90eXBlcyIsInNraXBFcnJvclByb3BzIiwiZW51bUVycm9yUHJvcHMiLCJlcnJvclByb3RvIiwibm9uRW51bVNoYWRvd3MiLCJvYmplY3RQcm90byIsImN0b3IiLCJpbmRleCIsImRvbnRFbnVtc0xlbmd0aCIsInN0cmluZ1Byb3RvIiwic3RyaW5nQ2xhc3MiLCJlcnJvckNsYXNzIiwidG9TdHJpbmciLCJub25FbnVtIiwibm9uRW51bVByb3BzIiwiZG9udEVudW1zIiwiaW50ZXJuYWxGb3IiLCJjYWxsYmFjayIsImtleXNGdW5jIiwiaW50ZXJuYWxGb3JJbiIsImlzTm9kZSIsImRlZXBFcXVhbHMiLCJiIiwic3RhY2tBIiwic3RhY2tCIiwidHlwZSIsIm90aGVyVHlwZSIsIm90aGVyQ2xhc3MiLCJhcmdzQ2xhc3MiLCJvYmplY3RDbGFzcyIsImJvb2xDbGFzcyIsImRhdGVDbGFzcyIsIm51bWJlckNsYXNzIiwicmVnZXhwQ2xhc3MiLCJTdHJpbmciLCJpc0FyciIsImFycmF5Q2xhc3MiLCJub2RlQ2xhc3MiLCJjdG9yQSIsImFyZ3NPYmplY3QiLCJjdG9yQiIsImlzRnVuY3Rpb24iLCJzaXplIiwicG9wIiwiYXJyYXlJbml0aWFsaXplIiwiY291bnQiLCJBcnJheSIsIkluZGV4ZWRJdGVtIiwiU2NoZWR1bGVkRGlzcG9zYWJsZSIsInNjaGVkdWxlciIsImRpc3Bvc2FibGUiLCJpc0Rpc3Bvc2VkIiwic2NoZWR1bGVJdGVtIiwicyIsInNlbGYiLCJkaXNwb3NlIiwiSXNEaXNwb3NlZERpc3Bvc2FibGUiLCJfcyIsIlN0cmluZ0l0ZXJhYmxlIiwiU3RyaW5nSXRlcmF0b3IiLCJfbCIsIl9pIiwiQXJyYXlJdGVyYWJsZSIsIl9hIiwiQXJyYXlJdGVyYXRvciIsInRvTGVuZ3RoIiwibnVtYmVySXNGaW5pdGUiLCJyb290IiwiaXNGaW5pdGUiLCJnZXRJdGVyYWJsZSIsIml0IiwiJGl0ZXJhdG9yJCIsInNpZ24iLCJpc05hTiIsImZsb29yIiwiYWJzIiwibWF4U2FmZUludGVnZXIiLCJGcm9tQXJyYXlTaW5rIiwib2JzZXJ2ZXIiLCJvYnNlcnZhYmxlT2YiLCJhcnJheSIsImlzU2NoZWR1bGVyIiwiY3VycmVudFRocmVhZFNjaGVkdWxlciIsIkZyb21BcnJheU9ic2VydmFibGUiLCJQYWlyc1NpbmsiLCJSZXBlYXRTaW5rIiwiYW1iIiwiZmFsc2VGYWN0b3J5IiwiYXJndW1lbnRzVG9BcnJheSIsImFyZ3MiLCJlbXB0eUFycmF5RmFjdG9yeSIsImFzT2JzZXJ2YWJsZSIsInRvQXJyYXkiLCJ4Iiwibm90RW1wdHkiLCJjb25jYXRNYXAiLCJzZWxlY3RvciIsInRoaXNBcmciLCJzZWxlY3RvckZ1bmMiLCJiaW5kQ2FsbGJhY2siLCJpc1Byb21pc2UiLCJvYnNlcnZhYmxlRnJvbVByb21pc2UiLCJpc0FycmF5TGlrZSIsImlzSXRlcmFibGUiLCJvYnNlcnZhYmxlRnJvbSIsImNvbmNhdEFsbCIsImFycmF5SW5kZXhPZkNvbXBhcmVyIiwiY29tcGFyZXIiLCJIYXNoU2V0Iiwic2V0IiwicGx1Y2tlciIsImN1cnJlbnRQcm9wIiwiZmlyc3RPbmx5IiwiRW1wdHlFcnJvciIsImZpbmRWYWx1ZSIsInByZWRpY2F0ZSIsInlpZWxkSW5kZXgiLCJBbm9ueW1vdXNPYnNlcnZhYmxlIiwiRmluZFZhbHVlT2JzZXJ2ZXIiLCJ0b09ic2VydmFibGUiLCJpc09ic2VydmFibGUiLCJpc0dlbmVyYXRvckZ1bmN0aW9uIiwiaXNHZW5lcmF0b3IiLCJzcGF3biIsInRodW5rVG9PYnNlcnZhYmxlIiwiYXJyYXlUb09ic2VydmFibGUiLCJvYmplY3RUb09ic2VydmFibGUiLCJmcm9tIiwiZGVmZXIiLCJyZXN1bHRzIiwib2JzZXJ2YWJsZXMiLCJuZXh0IiwiZm9ya0pvaW4iLCJmbiIsImVyciIsInJlcyIsIm9uRXJyb3IiLCJvbk5leHQiLCJvbkNvbXBsZXRlZCIsInZhbCIsImNyZWF0ZUNiT2JzZXJ2YWJsZSIsImN0eCIsIkFzeW5jU3ViamVjdCIsImNyZWF0ZUNiSGFuZGxlciIsInRyeUNhdGNoIiwiY3JlYXRlTm9kZU9ic2VydmFibGUiLCJjcmVhdGVOb2RlSGFuZGxlciIsIkxpc3RlbkRpc3Bvc2FibGUiLCJuIiwiX2UiLCJfbiIsIl9mbiIsImFkZEV2ZW50TGlzdGVuZXIiLCJjcmVhdGVFdmVudExpc3RlbmVyIiwiZWwiLCJldmVudE5hbWUiLCJoYW5kbGVyIiwiZGlzcG9zYWJsZXMiLCJDb21wb3NpdGVEaXNwb3NhYmxlIiwiZWxlbVRvU3RyaW5nIiwiYWRkIiwiZXZlbnRIYW5kbGVyIiwiY29tYmluZUxhdGVzdFNvdXJjZSIsInN1YmplY3QiLCJyZXN1bHRTZWxlY3RvciIsInZhbHVlcyIsImhhc1ZhbHVlIiwiaGFzVmFsdWVBbGwiLCJldmVyeSIsImlkZW50aXR5IiwiaXNEb25lIiwiQmluYXJ5RGlzcG9zYWJsZSIsIm9ic2VydmFibGVXaW5kb3dXaXRoT3BlbmluZ3MiLCJ3aW5kb3dPcGVuaW5ncyIsIndpbmRvd0Nsb3NpbmdTZWxlY3RvciIsImdyb3VwSm9pbiIsIm9ic2VydmFibGVFbXB0eSIsIl8iLCJ3aW4iLCJvYnNlcnZhYmxlV2luZG93V2l0aEJvdW5kYXJpZXMiLCJ3aW5kb3dCb3VuZGFyaWVzIiwiU3ViamVjdCIsImQiLCJyIiwiUmVmQ291bnREaXNwb3NhYmxlIiwiYWRkUmVmIiwidyIsIm9ic2VydmFibGVXaW5kb3dXaXRoQ2xvc2luZ1NlbGVjdG9yIiwiY3JlYXRlV2luZG93Q2xvc2UiLCJ3aW5kb3dDbG9zZSIsIm0xIiwiU2luZ2xlQXNzaWdubWVudERpc3Bvc2FibGUiLCJzZXREaXNwb3NhYmxlIiwidGFrZSIsIm5vb3AiLCJTZXJpYWxEaXNwb3NhYmxlIiwiZW51bWVyYWJsZVdoaWxlIiwiY29uZGl0aW9uIiwiV2hpbGVFbnVtZXJhYmxlIiwiUGF0dGVybiIsInBhdHRlcm5zIiwiUGxhbiIsImV4cHJlc3Npb24iLCJwbGFuQ3JlYXRlT2JzZXJ2ZXIiLCJleHRlcm5hbFN1YnNjcmlwdGlvbnMiLCJlbnRyeSIsIkpvaW5PYnNlcnZlciIsIkFjdGl2ZVBsYW4iLCJqb2luT2JzZXJ2ZXJBcnJheSIsImpvaW5PYnNlcnZlcnMiLCJNYXAiLCJqb2luT2JzZXJ2ZXIiLCJfb2JzZXJ2YWJsZVRpbWVyIiwiZHVlVGltZSIsIlRpbWVyT2JzZXJ2YWJsZSIsIm9ic2VydmFibGVUaW1lckRhdGVBbmRQZXJpb2QiLCJwZXJpb2QiLCJub3JtYWxpemVUaW1lIiwic2NoZWR1bGVSZWN1cnNpdmVGdXR1cmUiLCJvYnNlcnZhYmxlVGltZXJUaW1lU3BhbkFuZFBlcmlvZCIsInNjaGVkdWxlUGVyaW9kaWMiLCJvYnNlcnZhYmxlRGVmZXIiLCJvYnNlcnZhYmxlRGVsYXlSZWxhdGl2ZSIsInN1YnNjcmlwdGlvbiIsImFjdGl2ZSIsImNhbmNlbGFibGUiLCJleGNlcHRpb24iLCJxIiwicnVubmluZyIsIm1hdGVyaWFsaXplIiwibm90aWZpY2F0aW9uIiwic2hvdWxkUnVuIiwia2luZCIsInJlY3Vyc2VEdWVUaW1lIiwic2hvdWxkUmVjdXJzZSIsInNoaWZ0IiwiYWNjZXB0IiwibWF4Iiwib2JzZXJ2YWJsZURlbGF5QWJzb2x1dGUiLCJkZWxheVdpdGhTZWxlY3RvciIsInN1YnNjcmlwdGlvbkRlbGF5IiwiZGVsYXlEdXJhdGlvblNlbGVjdG9yIiwic3ViRGVsYXkiLCJzdGFydCIsImRlbGF5IiwiZGVsYXlzIiwicmVtb3ZlIiwiZG9uZSIsImF0RW5kIiwiZGVib3VuY2VXaXRoU2VsZWN0b3IiLCJkdXJhdGlvblNlbGVjdG9yIiwidGhyb3R0bGUiLCJjdXJyZW50aWQiLCJzYW1wbGVPYnNlcnZhYmxlIiwic2FtcGxlciIsInNhbXBsZVN1YnNjcmliZSIsInNvdXJjZVN1YnNjcmlwdGlvbiIsIm5ld1ZhbHVlIiwidGltZW91dFdpdGhTZWxlY3RvciIsImZpcnN0VGltZW91dCIsInRpbWVvdXREdXJhdGlvblNlbGVjdG9yIiwib3RoZXIiLCJvYnNlcnZhYmxlTmV2ZXIiLCJvYnNlcnZhYmxlVGhyb3ciLCJUaW1lb3V0RXJyb3IiLCJzZXRUaW1lciIsInRpbWVyV2lucyIsInN3aXRjaGVkIiwibXlJZCIsInRpbWVyIiwib1dpbnMiLCJvcmlnaW5hbCIsImRlZmF1bHRTY2hlZHVsZXIiLCJjcmVhdGVUaW1lciIsInNjaGVkdWxlRnV0dXJlIiwidHJhbnNmb3JtRm9yT2JzZXJ2ZXIiLCJAQHRyYW5zZHVjZXIvaW5pdCIsIkBAdHJhbnNkdWNlci9zdGVwIiwib2JzIiwiaW5wdXQiLCJAQHRyYW5zZHVjZXIvcmVzdWx0IiwiT25OZXh0UHJlZGljYXRlIiwiT25FcnJvclByZWRpY2F0ZSIsIk1vY2tQcm9taXNlIiwibWVzc2FnZXMiLCJzdWJzY3JpcHRpb25zIiwib2JzZXJ2ZXJzIiwiaW5uZXJOb3RpZmljYXRpb24iLCJzY2hlZHVsZUFic29sdXRlIiwidGltZSIsImoiLCJqTGVuIiwiZGlzcG9zYWJsZUVtcHR5Iiwib2JqZWN0VHlwZXMiLCJmdW5jdGlvbiIsImZyZWVFeHBvcnRzIiwibm9kZVR5cGUiLCJmcmVlU2VsZiIsImZyZWVXaW5kb3ciLCJmcmVlTW9kdWxlIiwibW9kdWxlRXhwb3J0cyIsImZyZWVHbG9iYWwiLCJSeCIsImludGVybmFscyIsImNvbmZpZyIsImhlbHBlcnMiLCJkZWZhdWx0Tm93IiwiZGVmYXVsdENvbXBhcmVyIiwieSIsImlzRXF1YWwiLCJkZWZhdWx0U3ViQ29tcGFyZXIiLCJkZWZhdWx0RXJyb3IiLCJkZWZhdWx0S2V5U2VyaWFsaXplciIsImlzRm4iLCJsb25nU3RhY2tTdXBwb3J0IiwiT2JqZWN0RGlzcG9zZWRFcnJvciIsIkFyZ3VtZW50T3V0T2ZSYW5nZUVycm9yIiwiTm90U3VwcG9ydGVkRXJyb3IiLCJOb3RJbXBsZW1lbnRlZEVycm9yIiwibm90SW1wbGVtZW50ZWQiLCJub3RTdXBwb3J0ZWQiLCJTeW1ib2wiLCJpdGVyYXRvciIsIlNldCIsImRvbmVFbnVtZXJhdG9yIiwic3VwcG9ydE5vZGVDbGFzcyIsImZ1bmMiLCJhcmdDb3VudCIsImFyZyIsImNvbGxlY3Rpb24iLCJmdW5jQ2xhc3MiLCJzdXBwb3J0c0FyZ3NDbGFzcyIsInByb3BlcnR5SXNFbnVtZXJhYmxlIiwidG9Mb2NhbGVTdHJpbmciLCJ2YWx1ZU9mIiwidGVzdCIsImluaGVyaXRzIiwiY2hpbGQiLCJfXyIsImFkZFByb3BlcnRpZXMiLCJzb3VyY2VzIiwiaWR4IiwibG4iLCJwcm9wIiwieHMiLCJnZXREaXNwb3NhYmxlIiwiY29tcGFyZVRvIiwiUHJpb3JpdHlRdWV1ZSIsImNhcGFjaXR5IiwicHJpb3JpdHlQcm90byIsImlzSGlnaGVyUHJpb3JpdHkiLCJsZWZ0IiwicmlnaHQiLCJwZXJjb2xhdGUiLCJ0ZW1wIiwiaGVhcGlmeSIsImZpcnN0IiwicGVlayIsInJlbW92ZUF0IiwiZGVxdWV1ZSIsImVucXVldWUiLCJpc0FycmF5IiwiQ29tcG9zaXRlRGlzcG9zYWJsZVByb3RvdHlwZSIsInNob3VsZERpc3Bvc2UiLCJjdXJyZW50RGlzcG9zYWJsZXMiLCJEaXNwb3NhYmxlIiwiYWN0aW9uIiwiZGlzcG9zYWJsZUNyZWF0ZSIsImVtcHR5IiwiaXNEaXNwb3NhYmxlIiwiY2hlY2tEaXNwb3NlZCIsImRpc3Bvc2FibGVGaXh1cCIsIl9maXh1cCIsImN1cnJlbnQiLCJvbGQiLCJzZWNvbmQiLCJfZmlyc3QiLCJfc2Vjb25kIiwib2xkMSIsIm9sZDIiLCJOQXJ5RGlzcG9zYWJsZSIsIl9kaXNwb3NhYmxlcyIsIklubmVyRGlzcG9zYWJsZSIsImlzSW5uZXJEaXNwb3NlZCIsInVuZGVybHlpbmdEaXNwb3NhYmxlIiwiaXNQcmltYXJ5RGlzcG9zZWQiLCJzY2hlZHVsZSIsIlNjaGVkdWxlZEl0ZW0iLCJpbnZva2UiLCJpbnZva2VDb3JlIiwiaXNDYW5jZWxsZWQiLCJTY2hlZHVsZXIiLCJzY2hlZHVsZXJQcm90byIsImR0Iiwibm9ybWFsaXplIiwiX3NjaGVkdWxlRnV0dXJlIiwidGltZVNwYW4iLCJpbnZva2VSZWNJbW1lZGlhdGUiLCJwYWlyIiwiaW5uZXJBY3Rpb24iLCJzdGF0ZTIiLCJzY2hlZHVsZVdvcmsiLCJzdGF0ZTMiLCJpc0FkZGVkIiwiZ3JvdXAiLCJpbnZva2VSZWNEYXRlIiwiZHVlVGltZTEiLCJzY2hlZHVsZVJlY3Vyc2l2ZSIsInNldEludGVydmFsIiwiY2xlYXJJbnRlcnZhbCIsImNhdGNoRXJyb3IiLCJDYXRjaFNjaGVkdWxlciIsInNjaGVkdWxlTWV0aG9kIiwiY2xlYXJNZXRob2QiLCJTY2hlZHVsZVBlcmlvZGljUmVjdXJzaXZlIiwiY29tbWFuZCIsInJlY3Vyc2UiLCJfcGVyaW9kIiwiX3N0YXRlIiwiX2FjdGlvbiIsIl9jYW5jZWwiLCJfc2NoZWR1bGVyIiwiSW1tZWRpYXRlU2NoZWR1bGVyIiwiX19zdXBlcl9fIiwiaW1tZWRpYXRlU2NoZWR1bGVyIiwiaW1tZWRpYXRlIiwiQ3VycmVudFRocmVhZFNjaGVkdWxlciIsInJ1blRyYW1wb2xpbmUiLCJxdWV1ZSIsInNpIiwic2NoZWR1bGVSZXF1aXJlZCIsImN1cnJlbnRUaHJlYWQiLCJsb2NhbFRpbWVyIiwibG9jYWxTZXRUaW1lb3V0IiwibG9jYWxDbGVhclRpbWVvdXQiLCJXU2NyaXB0IiwiU2xlZXAiLCJydW5UYXNrIiwiaGFuZGxlIiwiY3VycmVudGx5UnVubmluZyIsInRhc2siLCJ0YXNrc0J5SGFuZGxlIiwicG9zdE1lc3NhZ2VTdXBwb3J0ZWQiLCJwb3N0TWVzc2FnZSIsImltcG9ydFNjcmlwdHMiLCJpc0FzeW5jIiwib2xkSGFuZGxlciIsIm9ubWVzc2FnZSIsIm9uR2xvYmFsUG9zdE1lc3NhZ2UiLCJldmVudCIsImRhdGEiLCJzdWJzdHJpbmciLCJNU0dfUFJFRklYIiwibmV4dEhhbmRsZSIsInJlTmF0aXZlIiwiUmVnRXhwIiwicmVwbGFjZSIsInNldEltbWVkaWF0ZSIsIm5leHRUaWNrIiwiYXR0YWNoRXZlbnQiLCJjdXJyZW50SWQiLCJNZXNzYWdlQ2hhbm5lbCIsImNoYW5uZWwiLCJwb3J0MSIsInBvcnQyIiwic2NyaXB0RWxlbWVudCIsIm9ucmVhZHlzdGF0ZWNoYW5nZSIsInBhcmVudE5vZGUiLCJkb2N1bWVudEVsZW1lbnQiLCJEZWZhdWx0U2NoZWR1bGVyIiwiRGVmYXVsdFNjaGVkdWxlckRpc3Bvc2FibGUiLCJfaWQiLCJhc3luYyIsIl9oYW5kbGVyIiwiX3JlY3Vyc2l2ZU9yaWdpbmFsIiwiX3JlY3Vyc2l2ZVdyYXBwZXIiLCJfd3JhcCIsIl9jbG9uZSIsIl9nZXRSZWN1cnNpdmVXcmFwcGVyIiwicmV0Iiwid3JhcHBlciIsImZhaWxlZCIsInN0YXRlMSIsIk5vdGlmaWNhdGlvbiIsIl9hY2NlcHQiLCJfYWNjZXB0T2JzZXJ2YWJsZSIsIm9ic2VydmVyT3JPbk5leHQiLCJPbk5leHROb3RpZmljYXRpb24iLCJPbkVycm9yTm90aWZpY2F0aW9uIiwiT25Db21wbGV0ZWROb3RpZmljYXRpb24iLCJub3RpZmljYXRpb25DcmVhdGVPbk5leHQiLCJjcmVhdGVPbk5leHQiLCJub3RpZmljYXRpb25DcmVhdGVPbkVycm9yIiwiY3JlYXRlT25FcnJvciIsIm5vdGlmaWNhdGlvbkNyZWF0ZU9uQ29tcGxldGVkIiwiY3JlYXRlT25Db21wbGV0ZWQiLCJPYnNlcnZlciIsInRvTm90aWZpZXIiLCJhc09ic2VydmVyIiwiQW5vbnltb3VzT2JzZXJ2ZXIiLCJjaGVja2VkIiwiQ2hlY2tlZE9ic2VydmVyIiwib2JzZXJ2ZXJDcmVhdGUiLCJmcm9tTm90aWZpZXIiLCJub3RpZnlPbiIsIk9ic2VydmVPbk9ic2VydmVyIiwibWFrZVNhZmUiLCJBbm9ueW1vdXNTYWZlT2JzZXJ2ZXIiLCJfb25OZXh0IiwiX29uRXJyb3IiLCJfb25Db21wbGV0ZWQiLCJvYnNlcnZhYmxlUHJvdG8iLCJBYnN0cmFjdE9ic2VydmVyIiwiaXNTdG9wcGVkIiwiY29tcGxldGVkIiwiZmFpbCIsIl9vYnNlcnZlciIsIkNoZWNrZWRPYnNlcnZlclByb3RvdHlwZSIsImNoZWNrQWNjZXNzIiwiU2NoZWR1bGVkT2JzZXJ2ZXIiLCJpc0FjcXVpcmVkIiwiaGFzRmF1bHRlZCIsImVuc3VyZUFjdGl2ZSIsImlzT3duZXIiLCJ3b3JrIiwiY2FuY2VsIiwibWFrZVN1YnNjcmliZSIsIm9sZE9uRXJyb3IiLCJvbGRTdWJzY3JpYmUiLCJfc3Vic2NyaWJlIiwiZm9yRWFjaCIsIm9Pck9uTmV4dCIsInN1YnNjcmliZU9uTmV4dCIsInN1YnNjcmliZU9uRXJyb3IiLCJzdWJzY3JpYmVPbkNvbXBsZXRlZCIsIk9ic2VydmFibGVCYXNlIiwiZml4U3Vic2NyaWJlciIsInN1YnNjcmliZXIiLCJhZG8iLCJzdWIiLCJzdWJzY3JpYmVDb3JlIiwiQXV0b0RldGFjaE9ic2VydmVyIiwiRmxhdE1hcE9ic2VydmFibGUiLCJJbm5lck9ic2VydmVyIiwiX3dyYXBSZXN1bHQiLCJpMiIsIkVudW1lcmFibGUiLCJDb25jYXRFbnVtZXJhYmxlT2JzZXJ2YWJsZSIsIl9vIiwiY3VycmVudEl0ZW0iLCJjdXJyZW50VmFsdWUiLCJjb25jYXQiLCJDYXRjaEVycm9yT2JzZXJ2YWJsZSIsIl9yZWN1cnNlIiwibGFzdEV4Y2VwdGlvbiIsImNhdGNoRXJyb3JXaGVuIiwibm90aWZpY2F0aW9uSGFuZGxlciIsImV4Y2VwdGlvbnMiLCJub3RpZmllciIsImhhbmRsZWQiLCJub3RpZmljYXRpb25EaXNwb3NhYmxlIiwib3V0ZXIiLCJpbm5lciIsImV4biIsImV4IiwiUmVwZWF0RW51bWVyYWJsZSIsInYiLCJSZXBlYXRFbnVtZXJhdG9yIiwibCIsImVudW1lcmFibGVSZXBlYXQiLCJyZXBlYXQiLCJyZXBlYXRDb3VudCIsIk9mRW51bWVyYWJsZSIsIk9mRW51bWVyYXRvciIsImVudW1lcmFibGVPZiIsIm9mIiwiT2JzZXJ2ZU9uT2JzZXJ2YWJsZSIsIm9ic2VydmVPbiIsIlN1YnNjcmliZU9uT2JzZXJ2YWJsZSIsInN1YnNjcmliZU9uIiwiRnJvbVByb21pc2VPYnNlcnZhYmxlIiwicHJvbWlzZSIsInRvUHJvbWlzZSIsInByb21pc2VDdG9yIiwiVG9BcnJheU9ic2VydmFibGUiLCJEZWZlciIsIl9mIiwib2JzZXJ2YWJsZUZhY3RvcnkiLCJFbXB0eU9ic2VydmFibGUiLCJFbXB0eVNpbmsiLCJzaW5rIiwicnVuIiwiRU1QVFlfT0JTRVJWQUJMRSIsIkZyb21PYnNlcnZhYmxlIiwiaXRlcmFibGUiLCJtYXBwZXIiLCJGcm9tU2luayIsImxvb3BSZWN1cnNpdmUiLCJsaXN0IiwicG93IiwiY2hhckF0IiwibWFwRm4iLCJvYnNlcnZhYmxlRnJvbUFycmF5IiwiZnJvbUFycmF5IiwiR2VuZXJhdGVPYnNlcnZhYmxlIiwiY25kRm4iLCJpdHJGbiIsInJlc0ZuIiwiX2NuZEZuIiwiX2l0ckZuIiwiX3Jlc0ZuIiwiaGFzUmVzdWx0IiwiZ2VuZXJhdGUiLCJpbml0aWFsU3RhdGUiLCJpdGVyYXRlIiwib2ZXaXRoU2NoZWR1bGVyIiwib2ZBcnJheUNoYW5nZXMiLCJvYnNlcnZlIiwidW5vYnNlcnZlIiwib2JzZXJ2ZXJGbiIsImNoYW5nZXMiLCJvZk9iamVjdENoYW5nZXMiLCJOZXZlck9ic2VydmFibGUiLCJORVZFUl9PQlNFUlZBQkxFIiwibmV2ZXIiLCJQYWlyc09ic2VydmFibGUiLCJwYWlycyIsIlJhbmdlT2JzZXJ2YWJsZSIsInJhbmdlQ291bnQiLCJSYW5nZVNpbmsiLCJyYW5nZSIsIlJlcGVhdE9ic2VydmFibGUiLCJKdXN0T2JzZXJ2YWJsZSIsIkp1c3RTaW5rIiwiVGhyb3dPYnNlcnZhYmxlIiwiVGhyb3dTaW5rIiwiVXNpbmdPYnNlcnZhYmxlIiwib2JzRm4iLCJfb2JzRm4iLCJyZXNvdXJjZSIsInVzaW5nIiwicmVzb3VyY2VGYWN0b3J5IiwicmlnaHRTb3VyY2UiLCJsZWZ0U291cmNlIiwiY2hvaWNlTCIsImNob2ljZSIsImxlZnRDaG9pY2UiLCJyaWdodFN1YnNjcmlwdGlvbiIsImNob2ljZVIiLCJyaWdodENob2ljZSIsImxlZnRTdWJzY3JpcHRpb24iLCJsZWZ0U3Vic2NyaWJlIiwicmlnaHRTdWJzY3JpYmUiLCJhY2MiLCJDYXRjaE9ic2VydmFibGUiLCJkMSIsIkNhdGNoT2JzZXJ2ZXIiLCJoYW5kbGVyT3JTZWNvbmQiLCJvYnNlcnZhYmxlQ2F0Y2giLCJDb21iaW5lTGF0ZXN0T2JzZXJ2YWJsZSIsInBhcmFtcyIsIl9wYXJhbXMiLCJfY2IiLCJfaHYiLCJfaHZBbGwiLCJfZG9uZSIsIl92Iiwic2FkIiwiQ29tYmluZUxhdGVzdE9ic2VydmVyIiwiX3AiLCJmaWx0ZXIiLCJvYnNlcnZhYmxlQ29uY2F0IiwiQ29uY2F0T2JzZXJ2YWJsZSIsIkNvbmNhdFNpbmsiLCJtZXJnZSIsIk1lcmdlT2JzZXJ2YWJsZSIsIm1heENvbmN1cnJlbnQiLCJnIiwiTWVyZ2VPYnNlcnZlciIsImFjdGl2ZUNvdW50IiwiaGFuZGxlU3Vic2NyaWJlIiwiaW5uZXJTb3VyY2UiLCJtYXhDb25jdXJyZW50T3JPdGhlciIsIm9ic2VydmFibGVNZXJnZSIsIm1lcmdlQWxsIiwiTWVyZ2VBbGxPYnNlcnZhYmxlIiwiTWVyZ2VBbGxPYnNlcnZlciIsIkNvbXBvc2l0ZUVycm9yIiwiZXJyb3JzIiwiaW5uZXJFcnJvcnMiLCJtZXJnZURlbGF5RXJyb3IiLCJzZXRDb21wbGV0aW9uIiwiaW5uZXJTdWJzY3JpcHRpb24iLCJvbkVycm9yUmVzdW1lTmV4dCIsInBvcyIsIlNraXBVbnRpbE9ic2VydmFibGUiLCJfb3BlbiIsIlNraXBVbnRpbFNvdXJjZU9ic2VydmVyIiwiU2tpcFVudGlsT3RoZXJPYnNlcnZlciIsIl9yIiwic2tpcFVudGlsIiwiU3dpdGNoT2JzZXJ2YWJsZSIsIlN3aXRjaE9ic2VydmVyIiwic3RvcHBlZCIsImxhdGVzdCIsImhhc0xhdGVzdCIsInN3aXRjaExhdGVzdCIsIlRha2VVbnRpbE9ic2VydmFibGUiLCJUYWtlVW50aWxPYnNlcnZlciIsInRha2VVbnRpbCIsIldpdGhMYXRlc3RGcm9tT2JzZXJ2YWJsZSIsIl9zcyIsIldpdGhMYXRlc3RGcm9tT3RoZXJPYnNlcnZlciIsIldpdGhMYXRlc3RGcm9tU291cmNlT2JzZXJ2ZXIiLCJhbGxWYWx1ZXMiLCJ3aXRoTGF0ZXN0RnJvbSIsIlppcE9ic2VydmFibGUiLCJfcSIsIlppcE9ic2VydmVyIiwicXVldWVkVmFsdWVzIiwiemlwIiwiemlwSXRlcmFibGUiLCJxdWV1ZXMiLCJidWZmZXJXaXRoQ291bnQiLCJza2lwIiwid2luZG93V2l0aENvdW50IiwiRGVtYXRlcmlhbGl6ZU9ic2VydmFibGUiLCJEZW1hdGVyaWFsaXplT2JzZXJ2ZXIiLCJkZW1hdGVyaWFsaXplIiwiRGlzdGluY3RVbnRpbENoYW5nZWRPYnNlcnZhYmxlIiwia2V5Rm4iLCJEaXN0aW5jdFVudGlsQ2hhbmdlZE9ic2VydmVyIiwiaGFzQ3VycmVudEtleSIsImN1cnJlbnRLZXkiLCJjb21wYXJlckVxdWFscyIsImRpc3RpbmN0VW50aWxDaGFuZ2VkIiwiVGFwT2JzZXJ2YWJsZSIsIl9vTiIsIl9vRSIsIl9vQyIsInQiLCJ0YXAiLCJkb0FjdGlvbiIsImRvT25OZXh0IiwidGFwT25OZXh0IiwiZG9PbkVycm9yIiwidGFwT25FcnJvciIsImRvT25Db21wbGV0ZWQiLCJ0YXBPbkNvbXBsZXRlZCIsIklnbm9yZUVsZW1lbnRzT2JzZXJ2YWJsZSIsImlnbm9yZUVsZW1lbnRzIiwiTWF0ZXJpYWxpemVPYnNlcnZhYmxlIiwiTWF0ZXJpYWxpemVPYnNlcnZlciIsInJldHJ5IiwicmV0cnlDb3VudCIsInJldHJ5V2hlbiIsIlNjYW5PYnNlcnZhYmxlIiwiYWNjdW11bGF0b3IiLCJoYXNTZWVkIiwic2VlZCIsIlNjYW5PYnNlcnZlciIsIl9ocyIsIl9oYSIsInNjYW4iLCJTa2lwTGFzdE9ic2VydmFibGUiLCJfYyIsIlNraXBMYXN0T2JzZXJ2ZXIiLCJza2lwTGFzdCIsIlRha2VMYXN0T2JzZXJ2ZXIiLCJ0YWtlTGFzdCIsIlRha2VMYXN0QnVmZmVyT2JzZXJ2ZXIiLCJ0YWtlTGFzdEJ1ZmZlciIsIkluZmluaXR5IiwiY3JlYXRlV2luZG93IiwicmVmQ291bnREaXNwb3NhYmxlIiwic2VsZWN0Q29uY2F0Iiwic2VsZWN0b3JSZXN1bHQiLCJjb25jYXRNYXBPYnNlcnZlciIsInNlbGVjdENvbmNhdE9ic2VydmVyIiwib25OZXh0RnVuYyIsIm9uRXJyb3JGdW5jIiwib25Db21wbGV0ZWRGdW5jIiwiRGVmYXVsdElmRW1wdHlPYnNlcnZlciIsIl9kIiwiZGVmYXVsdFZhbHVlIiwiZGVmYXVsdElmRW1wdHkiLCJyZXRWYWx1ZSIsIkRpc3RpbmN0T2JzZXJ2YWJsZSIsImNtcEZuIiwiX2tleUZuIiwiX2NtcEZuIiwiRGlzdGluY3RPYnNlcnZlciIsIl9oIiwiZGlzdGluY3QiLCJrZXlTZWxlY3RvciIsImdyb3VwQnkiLCJlbGVtZW50U2VsZWN0b3IiLCJncm91cEJ5VW50aWwiLCJncm91cERpc3Bvc2FibGUiLCJoYW5kbGVFcnJvciIsImZpcmVOZXdNYXBFbnRyeSIsIndyaXRlciIsIkdyb3VwZWRPYnNlcnZhYmxlIiwiZHVyYXRpb25Hcm91cCIsImR1cmF0aW9uIiwibWQiLCJlbGVtZW50IiwiTWFwT2JzZXJ2YWJsZSIsImlubmVyTWFwIiwiaW50ZXJuYWxNYXAiLCJzZWxlY3QiLCJzZWxlY3RvckZuIiwicGx1Y2siLCJzZWxlY3RNYW55IiwiZmxhdE1hcE9ic2VydmVyIiwic2VsZWN0TWFueU9ic2VydmVyIiwiZmxhdE1hcExhdGVzdCIsIlNraXBPYnNlcnZhYmxlIiwic2tpcENvdW50IiwiU2tpcFdoaWxlT2JzZXJ2YWJsZSIsIlNraXBXaGlsZU9ic2VydmVyIiwic2tpcFdoaWxlIiwiVGFrZU9ic2VydmFibGUiLCJ0YWtlQ291bnQiLCJUYWtlV2hpbGVPYnNlcnZhYmxlIiwiVGFrZVdoaWxlT2JzZXJ2ZXIiLCJ0YWtlV2hpbGUiLCJGaWx0ZXJPYnNlcnZhYmxlIiwiaW5uZXJQcmVkaWNhdGUiLCJpbnRlcm5hbEZpbHRlciIsInNob3VsZFlpZWxkIiwid2hlcmUiLCJFeHRyZW1hQnlPYnNlcnZhYmxlIiwiayIsIl9rIiwiRXh0cmVtYUJ5T2JzZXJ2ZXIiLCJjb21wYXJpc29uIiwiUmVkdWNlT2JzZXJ2YWJsZSIsIlJlZHVjZU9ic2VydmVyIiwicmVkdWNlIiwiU29tZU9ic2VydmFibGUiLCJTb21lT2JzZXJ2ZXIiLCJCb29sZWFuIiwic29tZSIsIklzRW1wdHlPYnNlcnZhYmxlIiwiSXNFbXB0eU9ic2VydmVyIiwiaXNFbXB0eSIsIkV2ZXJ5T2JzZXJ2YWJsZSIsIkV2ZXJ5T2JzZXJ2ZXIiLCJJbmNsdWRlc09ic2VydmFibGUiLCJlbGVtIiwiX2VsZW0iLCJJbmNsdWRlc09ic2VydmVyIiwiaW5jbHVkZXMiLCJzZWFyY2hFbGVtZW50IiwiZnJvbUluZGV4IiwiQ291bnRPYnNlcnZhYmxlIiwiQ291bnRPYnNlcnZlciIsIkluZGV4T2ZPYnNlcnZhYmxlIiwiSW5kZXhPZk9ic2VydmVyIiwiU3VtT2JzZXJ2YWJsZSIsIlN1bU9ic2VydmVyIiwic3VtIiwibWluQnkiLCJtaW4iLCJtYXhCeSIsIkF2ZXJhZ2VPYnNlcnZhYmxlIiwiQXZlcmFnZU9ic2VydmVyIiwiX3QiLCJhdmVyYWdlIiwic2VxdWVuY2VFcXVhbCIsImRvbmVsIiwiZG9uZXIiLCJxbCIsInFyIiwic3Vic2NyaXB0aW9uMSIsImVxdWFsIiwic3Vic2NyaXB0aW9uMiIsIkVsZW1lbnRBdE9ic2VydmFibGUiLCJFbGVtZW50QXRPYnNlcnZlciIsImVsZW1lbnRBdCIsIlNpbmdsZU9ic2VydmVyIiwiX29iaiIsInNpbmdsZSIsIkZpcnN0T2JzZXJ2YWJsZSIsIkZpcnN0T2JzZXJ2ZXIiLCJMYXN0T2JzZXJ2YWJsZSIsIkxhc3RPYnNlcnZlciIsImxhc3QiLCJfeSIsImZpbmQiLCJmaW5kSW5kZXgiLCJUb1NldE9ic2VydmFibGUiLCJUb1NldE9ic2VydmVyIiwidG9TZXQiLCJUb01hcE9ic2VydmFibGUiLCJUb01hcE9ic2VydmVyIiwiX20iLCJ0b01hcCIsIlNsaWNlT2JzZXJ2YWJsZSIsIl9iIiwiU2xpY2VPYnNlcnZlciIsImJlZ2luIiwiZW5kIiwiTGFzdEluZGV4T2ZPYnNlcnZhYmxlIiwiTGFzdEluZGV4T2ZPYnNlcnZlciIsImxhc3RJbmRleE9mIiwid3JhcCIsImNyZWF0ZU9ic2VydmFibGUiLCJfX2dlbmVyYXRvckZ1bmN0aW9uX18iLCJnZW4iLCJwcm9jZXNzR2VuZXJhdG9yIiwiY29udGV4dCIsIm9ic2VydmFibGVUb0FzeW5jIiwidG9Bc3luYyIsImZyb21DYWxsYmFjayIsImZyb21Ob2RlQ2FsbGJhY2siLCJyZW1vdmVFdmVudExpc3RlbmVyIiwidXNlTmF0aXZlRXZlbnRzIiwiZnJvbUV2ZW50IiwiYWRkTGlzdGVuZXIiLCJmcm9tRXZlbnRQYXR0ZXJuIiwiaCIsInJlbW92ZUxpc3RlbmVyIiwib24iLCJvZmYiLCJwdWJsaXNoIiwicmVmQ291bnQiLCJhZGRIYW5kbGVyIiwicmVtb3ZlSGFuZGxlciIsImlubmVySGFuZGxlciIsInJldHVyblZhbHVlIiwic3RhcnRBc3luYyIsImZ1bmN0aW9uQXN5bmMiLCJQYXVzYWJsZU9ic2VydmFibGUiLCJwYXVzZXIiLCJjb250cm9sbGVyIiwiY29ubiIsImNvbm5lY3Rpb24iLCJwYXVzYWJsZSIsImNvbm5lY3QiLCJwYXVzZSIsInJlc3VtZSIsIlBhdXNhYmxlQnVmZmVyZWRPYnNlcnZhYmxlIiwiZHJhaW5RdWV1ZSIsInByZXZpb3VzU2hvdWxkRmlyZSIsInNob3VsZEZpcmUiLCJwYXVzYWJsZUJ1ZmZlcmVkIiwiQ29udHJvbGxlZE9ic2VydmFibGUiLCJlbmFibGVRdWV1ZSIsIkNvbnRyb2xsZWRTdWJqZWN0IiwibXVsdGljYXN0IiwicmVxdWVzdCIsIm51bWJlck9mSXRlbXMiLCJyZXF1ZXN0ZWRDb3VudCIsInJlcXVlc3RlZERpc3Bvc2FibGUiLCJoYXNGYWlsZWQiLCJoYXNDb21wbGV0ZWQiLCJkaXNwb3NlQ3VycmVudFJlcXVlc3QiLCJfcHJvY2Vzc1JlcXVlc3QiLCJyZW1haW5pbmciLCJjb250cm9sbGVkIiwiU3RvcEFuZFdhaXRPYnNlcnZhYmxlIiwiU3RvcEFuZFdhaXRPYnNlcnZlciIsIl9fc3ViX18iLCJzY2hlZHVsZURpc3Bvc2FibGUiLCJpbm5lclNjaGVkdWxlTWV0aG9kIiwic3RvcEFuZFdhaXQiLCJXaW5kb3dlZE9ic2VydmFibGUiLCJ3aW5kb3dTaXplIiwiV2luZG93ZWRPYnNlcnZlciIsInJlY2VpdmVkIiwid2luZG93ZWQiLCJwaXBlIiwiZGVzdCIsIm9uRHJhaW4iLCJ3cml0ZSIsImVtaXQiLCJfaXNTdGRpbyIsIk11bHRpY2FzdE9ic2VydmFibGUiLCJmbjEiLCJmbjIiLCJfZm4xIiwiX2ZuMiIsImNvbm5lY3RhYmxlIiwic3ViamVjdE9yU3ViamVjdFNlbGVjdG9yIiwiQ29ubmVjdGFibGVPYnNlcnZhYmxlIiwic2hhcmUiLCJwdWJsaXNoTGFzdCIsInB1Ymxpc2hWYWx1ZSIsImluaXRpYWxWYWx1ZU9yU2VsZWN0b3IiLCJpbml0aWFsVmFsdWUiLCJCZWhhdmlvclN1YmplY3QiLCJzaGFyZVZhbHVlIiwicmVwbGF5IiwiYnVmZmVyU2l6ZSIsIlJlcGxheVN1YmplY3QiLCJzaGFyZVJlcGxheSIsIklubmVyU3Vic2NyaXB0aW9uIiwiaGFzRXJyb3IiLCJnZXRWYWx1ZSIsImhhc09ic2VydmVycyIsIm9zIiwiY3JlYXRlUmVtb3ZhYmxlRGlzcG9zYWJsZSIsInNvIiwiX3RyaW0iLCJSZWZDb3VudE9ic2VydmFibGUiLCJfY291bnQiLCJfY29ubmVjdGFibGVTdWJzY3JpcHRpb24iLCJzaG91bGRDb25uZWN0IiwiX2hhc1N1YnNjcmlwdGlvbiIsIl9zdWJzY3JpcHRpb24iLCJfc291cmNlT2JzZXJ2YWJsZSIsIl9zdWJqZWN0IiwiQ29ubmVjdERpc3Bvc2FibGUiLCJzaW5nbGVJbnN0YW5jZSIsImdldE9ic2VydmFibGUiLCJoYXNPYnNlcnZhYmxlIiwibGVmdER1cmF0aW9uU2VsZWN0b3IiLCJyaWdodER1cmF0aW9uU2VsZWN0b3IiLCJsZWZ0RG9uZSIsInJpZ2h0RG9uZSIsImxlZnRJZCIsInJpZ2h0SWQiLCJsZWZ0TWFwIiwicmlnaHRNYXAiLCJidWZmZXIiLCJ3aW5kb3dPcGVuaW5nc09yQ2xvc2luZ1NlbGVjdG9yIiwicGFpcndpc2UiLCJwcmV2aW91cyIsImhhc1ByZXZpb3VzIiwicGFydGl0aW9uIiwibGV0QmluZCIsInRoZW5Tb3VyY2UiLCJlbHNlU291cmNlT3JTY2hlZHVsZXIiLCJmb3JJbiIsIm9ic2VydmFibGVXaGlsZURvIiwid2hpbGVEbyIsImRvV2hpbGUiLCJkZWZhdWx0U291cmNlT3JTY2hlZHVsZXIiLCJleHBhbmQiLCJhbGxTb3VyY2VzIiwiZmluaXNoZWQiLCJoYXNSZXN1bHRzIiwiaXgiLCJsYXN0TGVmdCIsImxhc3RSaWdodCIsImxlZnRTdG9wcGVkIiwicmlnaHRTdG9wcGVkIiwiaGFzTGVmdCIsImhhc1JpZ2h0IiwibWFueVNlbGVjdCIsImV4dGVuZCIsImNoYWluIiwiY3VyciIsIkNoYWluT2JzZXJ2YWJsZSIsImhlYWQiLCJ0YWlsIiwiX3ZhbHVlcyIsIl9rZXlzIiwiYW5kIiwidGhlbkRvIiwiYWN0aXZhdGUiLCJkZWFjdGl2YXRlIiwiYWN0aXZlUGxhbiIsImpsZW4iLCJyZW1vdmVBY3RpdmVQbGFuIiwiYWRkQWN0aXZlUGxhbiIsIm1hdGNoIiwiaGFzVmFsdWVzIiwiZmlyc3RWYWx1ZXMiLCJpc0NvbXBsZXRlZCIsImFjdGl2ZVBsYW5zIiwiSm9pbk9ic2VydmVyUHJvdG90eXBlIiwid2hlbiIsInBsYW5zIiwib3V0T2JzZXJ2ZXIiLCJfZHQiLCJvYnNlcnZhYmxlaW50ZXJ2YWwiLCJwZXJpb2RPclNjaGVkdWxlciIsImdldFRpbWUiLCJmaXJzdEFyZyIsIkRlYm91bmNlT2JzZXJ2YWJsZSIsIkRlYm91bmNlT2JzZXJ2ZXIiLCJkZWJvdW5jZSIsIndpbmRvd1dpdGhUaW1lIiwidGltZVNoaWZ0T3JTY2hlZHVsZXIiLCJ0aW1lU2hpZnQiLCJpc1NwYW4iLCJpc1NoaWZ0IiwidGltZXJEIiwibmV4dFNwYW4iLCJuZXh0U2hpZnQiLCJuZXdUb3RhbFRpbWUiLCJ0cyIsInRvdGFsVGltZSIsIndpbmRvd1dpdGhUaW1lT3JDb3VudCIsIndpbmRvd0lkIiwibmV3SWQiLCJuZXdXaW5kb3ciLCJidWZmZXJXaXRoVGltZSIsImJ1ZmZlcldpdGhUaW1lT3JDb3VudCIsIlRpbWVJbnRlcnZhbE9ic2VydmFibGUiLCJUaW1lSW50ZXJ2YWxPYnNlcnZlciIsInNwYW4iLCJ0aW1lSW50ZXJ2YWwiLCJUaW1lc3RhbXBPYnNlcnZhYmxlIiwiVGltZXN0YW1wT2JzZXJ2ZXIiLCJzYW1wbGUiLCJ0aHJvdHRsZUxhdGVzdCIsImludGVydmFsT3JTYW1wbGVyIiwiR2VuZXJhdGVBYnNvbHV0ZU9ic2VydmFibGUiLCJ0aW1lRm4iLCJfdGltZUZuIiwiX2hhc1Jlc3VsdCIsImdlbmVyYXRlV2l0aEFic29sdXRlVGltZSIsInRpbWVTZWxlY3RvciIsIkdlbmVyYXRlUmVsYXRpdmVPYnNlcnZhYmxlIiwiZ2VuZXJhdGVXaXRoUmVsYXRpdmVUaW1lIiwiRGVsYXlTdWJzY3JpcHRpb24iLCJkZWxheVN1YnNjcmlwdGlvbiIsIlNraXBMYXN0V2l0aFRpbWVPYnNlcnZhYmxlIiwiU2tpcExhc3RXaXRoVGltZU9ic2VydmVyIiwic2tpcExhc3RXaXRoVGltZSIsIlRha2VMYXN0V2l0aFRpbWVPYnNlcnZhYmxlIiwiVGFrZUxhc3RXaXRoVGltZU9ic2VydmVyIiwidGFrZUxhc3RXaXRoVGltZSIsInRha2VMYXN0QnVmZmVyV2l0aFRpbWUiLCJUYWtlV2l0aFRpbWVPYnNlcnZhYmxlIiwidGFrZVdpdGhUaW1lIiwiU2tpcFdpdGhUaW1lT2JzZXJ2YWJsZSIsIlNraXBXaXRoVGltZU9ic2VydmVyIiwic2tpcFdpdGhUaW1lIiwiU2tpcFVudGlsV2l0aFRpbWVPYnNlcnZhYmxlIiwic3RhcnRUaW1lIiwiX3N0IiwiU2tpcFVudGlsV2l0aFRpbWVPYnNlcnZlciIsInNraXBVbnRpbFdpdGhUaW1lIiwidGFrZVVudGlsV2l0aFRpbWUiLCJlbmRUaW1lIiwid2luZG93RHVyYXRpb24iLCJSYW5nZUVycm9yIiwibGFzdE9uTmV4dCIsIlRyYW5zZHVjZU9ic2VydmVyIiwieGZvcm0iLCJfeGZvcm0iLCJ0cmFuc2R1Y2UiLCJ0cmFuc2R1Y2VyIiwic3dpdGNoRmlyc3QiLCJoYXNDdXJyZW50IiwiZmxhdE1hcEZpcnN0Iiwic2VsZWN0TWFueUZpcnN0IiwiZmxhdE1hcFdpdGhNYXhDb25jdXJyZW50IiwiVmlydHVhbFRpbWVTY2hlZHVsZXIiLCJpbml0aWFsQ2xvY2siLCJjbG9jayIsImlzRW5hYmxlZCIsIlZpcnR1YWxUaW1lU2NoZWR1bGVyUHJvdG90eXBlIiwidG9BYnNvbHV0ZVRpbWUiLCJ0b1JlbGF0aXZlVGltZSIsInNjaGVkdWxlUmVsYXRpdmUiLCJydW5BdCIsImdldE5leHQiLCJzdG9wIiwiYWR2YW5jZVRvIiwiZHVlVG9DbG9jayIsImFkdmFuY2VCeSIsInNsZWVwIiwiSGlzdG9yaWNhbFNjaGVkdWxlciIsImNtcCIsIkhpc3RvcmljYWxTY2hlZHVsZXJQcm90byIsImFic29sdXRlIiwicmVsYXRpdmUiLCJlcXVhbHMiLCJSZWFjdGl2ZVRlc3QiLCJjcmVhdGVkIiwic3Vic2NyaWJlZCIsImRpc3Bvc2VkIiwidGlja3MiLCJSZWNvcmRlZCIsIlN1YnNjcmlwdGlvbiIsInVuc3Vic2NyaWJlIiwiTUFYX1ZBTFVFIiwiTW9ja0Rpc3Bvc2FibGUiLCJkaXNwb3NlcyIsIk1vY2tPYnNlcnZlciIsIk1vY2tPYnNlcnZlclByb3RvdHlwZSIsIm9uUmVzb2x2ZWQiLCJvblJlamVjdGVkIiwibmV3UHJvbWlzZSIsIkhvdE9ic2VydmFibGUiLCJDb2xkT2JzZXJ2YWJsZSIsIlRlc3RTY2hlZHVsZXIiLCJiYXNlQ29tcGFyZXIiLCJzdGFydFNjaGVkdWxlciIsImNyZWF0ZUZuIiwic2V0dGluZ3MiLCJjcmVhdGVPYnNlcnZlciIsImNyZWF0ZUhvdE9ic2VydmFibGUiLCJjcmVhdGVDb2xkT2JzZXJ2YWJsZSIsImNyZWF0ZVJlc29sdmVkUHJvbWlzZSIsImNyZWF0ZVJlamVjdGVkUHJvbWlzZSIsInJlYXNvbiIsIl9fc3Vic2NyaWJlIiwiQXV0b0RldGFjaE9ic2VydmVyUHJvdG90eXBlIiwiVW5kZXJseWluZ09ic2VydmFibGUiLCJ1IiwiX3UiLCJ1bmRlcmx5aW5nT2JzZXJ2YWJsZSIsIm1lcmdlZERpc3Bvc2FibGUiLCJBbm9ueW1vdXNTdWJqZWN0IiwiUGF1c2VyIiwid2VicGFja1BvbHlmaWxsIiwiZGVwcmVjYXRlIiwicGF0aHMiLCJjaGlsZHJlbiIsImNsZWFuVXBOZXh0VGljayIsImRyYWluaW5nIiwiY3VycmVudFF1ZXVlIiwicXVldWVJbmRleCIsIkl0ZW0iLCJmdW4iLCJ0aXRsZSIsImJyb3dzZXIiLCJlbnYiLCJhcmd2IiwidmVyc2lvbiIsInZlcnNpb25zIiwib25jZSIsInJlbW92ZUFsbExpc3RlbmVycyIsImJpbmRpbmciLCJjd2QiLCJjaGRpciIsImRpciIsInVtYXNrIl0sIm1hcHBpbmdzIjoiQ0FBUyxTQUFVQSxHQ0luQixRQUFBQyxHQUFBQyxHQUdBLEdBQUFDLEVBQUFELEdBQ0EsTUFBQUMsR0FBQUQsR0FBQUUsT0FHQSxJQUFBQyxHQUFBRixFQUFBRCxJQUNBRSxXQUNBRSxHQUFBSixFQUNBSyxRQUFBLEVBVUEsT0FOQVAsR0FBQUUsR0FBQU0sS0FBQUgsRUFBQUQsUUFBQUMsSUFBQUQsUUFBQUgsR0FHQUksRUFBQUUsUUFBQSxFQUdBRixFQUFBRCxRQXZCQSxHQUFBRCxLQXFDQSxPQVRBRixHQUFBUSxFQUFBVCxFQUdBQyxFQUFBUyxFQUFBUCxFQUdBRixFQUFBVSxFQUFBLElBR0FWLEVBQUEsS0RNTSxTQUFTSSxFQUFRRCxFQUFTSCxHQUUvQixZQU1BLFNBQVNXLEdBQXVCQyxHQUFPLE1BQU9BLElBQU9BLEVBQUlDLFdBQWFELEdBQVFFLFVBQVdGLEdBSnpGRyxPQUFPQyxlQUFlYixFQUFTLGNBQzNCYyxPQUFPLEdBS1gsSUFBSUMsR0FBU2xCLEVFdERJLEdGd0RibUIsRUFBVVIsRUFBdUJPLEdBRWpDRSxFQUFxQnBCLEVFekRULEdGMkRacUIsRUFBc0JWLEVBQXVCUyxFRXpEbEQsSUFBSUUsT0FBUSxDQUNSQSxPQUFPQyxNQUFRRCxPQUFP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QSxFQUVBRSxFQUFBLEVBc0NBdHZDLEdBQUE2ZixTQUFBLFNBQUEydkIsR0FDQSxHQUFBNW1DLEdBQUEsR0FBQTNDLE9BQUE5TyxVQUFBbkQsT0FBQSxFQUNBLElBQUFtRCxVQUFBbkQsT0FBQSxFQUNBLE9BQUFELEdBQUEsRUFBdUJBLEVBQUFvRCxVQUFBbkQsT0FBc0JELElBQzdDNlUsRUFBQTdVLEVBQUEsR0FBQW9ELFVBQUFwRCxFQUdBZ3FCLEdBQUE3aEIsS0FBQSxHQUFBcXpDLEdBQUFDLEVBQUE1bUMsSUFDQSxJQUFBbVYsRUFBQS9wQixRQUFBbzdDLEdBQ0F0dkMsV0FBQXErQixFQUFBLElBU0FvUixFQUFBeDZDLFVBQUFtekIsSUFBQSxXQUNBanhCLEtBQUF1NEMsSUFBQXQ0QyxNQUFBLEtBQUFELEtBQUFrUixRQUVBbkksRUFBQXl2QyxNQUFBLFVBQ0F6dkMsRUFBQTB2QyxTQUFBLEVBQ0ExdkMsRUFBQTJ2QyxPQUNBM3ZDLEVBQUE0dkMsUUFDQTV2QyxFQUFBNnZDLFFBQUEsR0FDQTd2QyxFQUFBOHZDLFlBSUE5dkMsRUFBQSs4QixHQUFBMXRCLEVBQ0FyUCxFQUFBMjhCLFlBQUF0dEIsRUFDQXJQLEVBQUErdkMsS0FBQTFnQyxFQUNBclAsRUFBQWc5QixJQUFBM3RCLEVBQ0FyUCxFQUFBODhCLGVBQUF6dEIsRUFDQXJQLEVBQUFnd0MsbUJBQUEzZ0MsRUFDQXJQLEVBQUFvZ0MsS0FBQS93QixFQUVBclAsRUFBQWl3QyxRQUFBLFNBQUF2NEMsR0FDQSxTQUFBcUksT0FBQSxxQ0FHQUMsRUFBQWt3QyxJQUFBLFdBQTJCLFdBQzNCbHdDLEVBQUFtd0MsTUFBQSxTQUFBQyxHQUNBLFNBQUFyd0MsT0FBQSxtQ0FFQUMsRUFBQXF3QyxNQUFBLFdBQTRCIiwiZmlsZSI6InJlYWN0LWNsaW1iLXNvY2lhbC5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8qKioqKiovIChmdW5jdGlvbihtb2R1bGVzKSB7IC8vIHdlYnBhY2tCb290c3RyYXBcbi8qKioqKiovIFx0Ly8gVGhlIG1vZHVsZSBjYWNoZVxuLyoqKioqKi8gXHR2YXIgaW5zdGFsbGVkTW9kdWxlcyA9IHt9O1xuLyoqKioqKi9cbi8qKioqKiovIFx0Ly8gVGhlIHJlcXVpcmUgZnVuY3Rpb25cbi8qKioqKiovIFx0ZnVuY3Rpb24gX193ZWJwYWNrX3JlcXVpcmVfXyhtb2R1bGVJZCkge1xuLyoqKioqKi9cbi8qKioqKiovIFx0XHQvLyBDaGVjayBpZiBtb2R1bGUgaXMgaW4gY2FjaGVcbi8qKioqKiovIFx0XHRpZihpbnN0YWxsZWRNb2R1bGVzW21vZHVsZUlkXSlcbi8qKioqKiovIFx0XHRcdHJldHVybiBpbnN0YWxsZWRNb2R1bGVzW21vZHVsZUlkXS5leHBvcnRzO1xuLyoqKioqKi9cbi8qKioqKiovIFx0XHQvLyBDcmVhdGUgYSBuZXcgbW9kdWxlIChhbmQgcHV0IGl0IGludG8gdGhlIGNhY2hlKVxuLyoqKioqKi8gXHRcdHZhciBtb2R1bGUgPSBpbnN0YWxsZWRNb2R1bGVzW21vZHVsZUlkXSA9IHtcbi8qKioqKiovIFx0XHRcdGV4cG9ydHM6IHt9LFxuLyoqKioqKi8gXHRcdFx0aWQ6IG1vZHVsZUlkLFxuLyoqKioqKi8gXHRcdFx0bG9hZGVkOiBmYWxzZVxuLyoqKioqKi8gXHRcdH07XG4vKioqKioqL1xuLyoqKioqKi8gXHRcdC8vIEV4ZWN1dGUgdGhlIG1vZHVsZSBmdW5jdGlvblxuLyoqKioqKi8gXHRcdG1vZHVsZXNbbW9kdWxlSWRdLmNhbGwobW9kdWxlLmV4cG9ydHMsIG1vZHVsZSwgbW9kdWxlLmV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pO1xuLyoqKioqKi9cbi8qKioqKiovIFx0XHQvLyBGbGFnIHRoZSBtb2R1bGUgYXMgbG9hZGVkXG4vKioqKioqLyBcdFx0bW9kdWxlLmxvYWRlZCA9IHRydWU7XG4vKioqKioqL1xuLyoqKioqKi8gXHRcdC8vIFJldHVybiB0aGUgZXhwb3J0cyBvZiB0aGUgbW9kdWxlXG4vKioqKioqLyBcdFx0cmV0dXJuIG1vZHVsZS5leHBvcnRzO1xuLyoqKioqKi8gXHR9XG4vKioqKioqL1xuLyoqKioqKi9cbi8qKioqKiovIFx0Ly8gZXhwb3NlIHRoZSBtb2R1bGVzIG9iamVjdCAoX193ZWJwYWNrX21vZHVsZXNfXylcbi8qKioqKiovIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5tID0gbW9kdWxlcztcbi8qKioqKiovXG4vKioqKioqLyBcdC8vIGV4cG9zZSB0aGUgbW9kdWxlIGNhY2hlXG4vKioqKioqLyBcdF9fd2VicGFja19yZXF1aXJlX18uYyA9IGluc3RhbGxlZE1vZHVsZXM7XG4vKioqKioqL1xuLyoqKioqKi8gXHQvLyBfX3dlYnBhY2tfcHVibGljX3BhdGhfX1xuLyoqKioqKi8gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLnAgPSBcIi9cIjtcbi8qKioqKiovXG4vKioqKioqLyBcdC8vIExvYWQgZW50cnkgbW9kdWxlIGFuZCByZXR1cm4gZXhwb3J0c1xuLyoqKioqKi8gXHRyZXR1cm4gX193ZWJwYWNrX3JlcXVpcmVfXygwKTtcbi8qKioqKiovIH0pXG4vKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqL1xuLyoqKioqKi8gKFtcbi8qIDAgKi9cbi8qKiovIGZ1bmN0aW9uKG1vZHVsZSwgZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykge1xuXG5cdCd1c2Ugc3RyaWN0Jztcblx0XG5cdE9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCAnX19lc01vZHVsZScsIHtcblx0ICAgIHZhbHVlOiB0cnVlXG5cdH0pO1xuXHRcblx0ZnVuY3Rpb24gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChvYmopIHsgcmV0dXJuIG9iaiAmJiBvYmouX19lc01vZHVsZSA/IG9iaiA6IHsgJ2RlZmF1bHQnOiBvYmogfTsgfVxuXHRcblx0dmFyIF9yZWFjdCA9IF9fd2VicGFja19yZXF1aXJlX18oMSk7XG5cdFxuXHR2YXIgX3JlYWN0MiA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQoX3JlYWN0KTtcblx0XG5cdHZhciBfY29tcG9uZW50c1dhbGxKc3ggPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDcpO1xuXHRcblx0dmFyIF9jb21wb25lbnRzV2FsbEpzeDIgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KF9jb21wb25lbnRzV2FsbEpzeCk7XG5cdFxuXHRpZiAod2luZG93KSB7XG5cdCAgICB3aW5kb3cuQ2xpbWIgPSB3aW5kb3cuQ2xpbWIgfHwge307XG5cdFxuXHQgICAgdmFyICR0YXJnZXRzID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLmNsaW1iLXdhbGwnKTtcblx0XG5cdCAgICBmb3IgKHZhciBpID0gMDsgaSA8ICR0YXJnZXRzLmxlbmd0aDsgKytpKSB7XG5cdCAgICAgICAgdmFyICRpdGVtID0gJHRhcmdldHNbaV07XG5cdCAgICAgICAgdmFyIGNvbGxlY3Rpb25JZCA9ICRpdGVtLmRhdGFzZXQuY29sbGVjdGlvbklkO1xuXHQgICAgICAgIHZhciBsaW1pdCA9ICRpdGVtLmRhdGFzZXQubGltaXQ7XG5cdFxuXHQgICAgICAgIF9yZWFjdDJbJ2RlZmF1bHQnXS5yZW5kZXIoX3JlYWN0MlsnZGVmYXVsdCddLmNyZWF0ZUVsZW1lbnQoX2NvbXBvbmVudHNXYWxsSnN4MlsnZGVmYXVsdCddLCB7IGNvbGxlY3Rpb25JZDogY29sbGVjdGlvbklkLCBsaW1pdDogbGltaXQgfSksICRpdGVtKTtcblx0ICAgIH1cblx0fVxuXHRcblx0ZXhwb3J0c1snZGVmYXVsdCddID0gX2NvbXBvbmVudHNXYWxsSnN4MlsnZGVmYXVsdCddO1xuXHRtb2R1bGUuZXhwb3J0cyA9IGV4cG9ydHNbJ2RlZmF1bHQnXTtcblxuLyoqKi8gfSxcbi8qIDEgKi9cbi8qKiovIGZ1bmN0aW9uKG1vZHVsZSwgZXhwb3J0cykge1xuXG5cdG1vZHVsZS5leHBvcnRzID0gUmVhY3Q7XG5cbi8qKiovIH0sXG4vKiAyICovXG4vKioqLyBmdW5jdGlvbihtb2R1bGUsIGV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pIHtcblxuXHRcInVzZSBzdHJpY3RcIjtcblx0XG5cdE9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwge1xuXHQgICAgdmFsdWU6IHRydWVcblx0fSk7XG5cdFxuXHR2YXIgX2NyZWF0ZUNsYXNzID0gKGZ1bmN0aW9uICgpIHsgZnVuY3Rpb24gZGVmaW5lUHJvcGVydGllcyh0YXJnZXQsIHByb3BzKSB7IGZvciAodmFyIGkgPSAwOyBpIDwgcHJvcHMubGVuZ3RoOyBpKyspIHsgdmFyIGRlc2NyaXB0b3IgPSBwcm9wc1tpXTsgZGVzY3JpcHRvci5lbnVtZXJhYmxlID0gZGVzY3JpcHRvci5lbnVtZXJhYmxlIHx8IGZhbHNlOyBkZXNjcmlwdG9yLmNvbmZpZ3VyYWJsZSA9IHRydWU7IGlmIChcInZhbHVlXCIgaW4gZGVzY3JpcHRvcikgZGVzY3JpcHRvci53cml0YWJsZSA9IHRydWU7IE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0YXJnZXQsIGRlc2NyaXB0b3Iua2V5LCBkZXNjcmlwdG9yKTsgfSB9IHJldHVybiBmdW5jdGlvbiAoQ29uc3RydWN0b3IsIHByb3RvUHJvcHMsIHN0YXRpY1Byb3BzKSB7IGlmIChwcm90b1Byb3BzKSBkZWZpbmVQcm9wZXJ0aWVzKENvbnN0cnVjdG9yLnByb3RvdHlwZSwgcHJvdG9Qcm9wcyk7IGlmIChzdGF0aWNQcm9wcykgZGVmaW5lUHJvcGVydGllcyhDb25zdHJ1Y3Rvciwgc3RhdGljUHJvcHMpOyByZXR1cm4gQ29uc3RydWN0b3I7IH07IH0pKCk7XG5cdFxuXHR2YXIgX2dldCA9IGZ1bmN0aW9uIGdldChfeCwgX3gyLCBfeDMpIHsgdmFyIF9hZ2FpbiA9IHRydWU7IF9mdW5jdGlvbjogd2hpbGUgKF9hZ2FpbikgeyB2YXIgb2JqZWN0ID0gX3gsIHByb3BlcnR5ID0gX3gyLCByZWNlaXZlciA9IF94MzsgZGVzYyA9IHBhcmVudCA9IGdldHRlciA9IHVuZGVmaW5lZDsgX2FnYWluID0gZmFsc2U7IGlmIChvYmplY3QgPT09IG51bGwpIG9iamVjdCA9IEZ1bmN0aW9uLnByb3RvdHlwZTsgdmFyIGRlc2MgPSBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKG9iamVjdCwgcHJvcGVydHkpOyBpZiAoZGVzYyA9PT0gdW5kZWZpbmVkKSB7IHZhciBwYXJlbnQgPSBPYmplY3QuZ2V0UHJvdG90eXBlT2Yob2JqZWN0KTsgaWYgKHBhcmVudCA9PT0gbnVsbCkgeyByZXR1cm4gdW5kZWZpbmVkOyB9IGVsc2UgeyBfeCA9IHBhcmVudDsgX3gyID0gcHJvcGVydHk7IF94MyA9IHJlY2VpdmVyOyBfYWdhaW4gPSB0cnVlOyBjb250aW51ZSBfZnVuY3Rpb247IH0gfSBlbHNlIGlmIChcInZhbHVlXCIgaW4gZGVzYykgeyByZXR1cm4gZGVzYy52YWx1ZTsgfSBlbHNlIHsgdmFyIGdldHRlciA9IGRlc2MuZ2V0OyBpZiAoZ2V0dGVyID09PSB1bmRlZmluZWQpIHsgcmV0dXJuIHVuZGVmaW5lZDsgfSByZXR1cm4gZ2V0dGVyLmNhbGwocmVjZWl2ZXIpOyB9IH0gfTtcblx0XG5cdGZ1bmN0aW9uIF9pbnRlcm9wUmVxdWlyZURlZmF1bHQob2JqKSB7IHJldHVybiBvYmogJiYgb2JqLl9fZXNNb2R1bGUgPyBvYmogOiB7IFwiZGVmYXVsdFwiOiBvYmogfTsgfVxuXHRcblx0ZnVuY3Rpb24gX2NsYXNzQ2FsbENoZWNrKGluc3RhbmNlLCBDb25zdHJ1Y3RvcikgeyBpZiAoIShpbnN0YW5jZSBpbnN0YW5jZW9mIENvbnN0cnVjdG9yKSkgeyB0aHJvdyBuZXcgVHlwZUVycm9yKFwiQ2Fubm90IGNhbGwgYSBjbGFzcyBhcyBhIGZ1bmN0aW9uXCIpOyB9IH1cblx0XG5cdGZ1bmN0aW9uIF9pbmhlcml0cyhzdWJDbGFzcywgc3VwZXJDbGFzcykgeyBpZiAodHlwZW9mIHN1cGVyQ2xhc3MgIT09IFwiZnVuY3Rpb25cIiAmJiBzdXBlckNsYXNzICE9PSBudWxsKSB7IHRocm93IG5ldyBUeXBlRXJyb3IoXCJTdXBlciBleHByZXNzaW9uIG11c3QgZWl0aGVyIGJlIG51bGwgb3IgYSBmdW5jdGlvbiwgbm90IFwiICsgdHlwZW9mIHN1cGVyQ2xhc3MpOyB9IHN1YkNsYXNzLnByb3RvdHlwZSA9IE9iamVjdC5jcmVhdGUoc3VwZXJDbGFzcyAmJiBzdXBlckNsYXNzLnByb3RvdHlwZSwgeyBjb25zdHJ1Y3RvcjogeyB2YWx1ZTogc3ViQ2xhc3MsIGVudW1lcmFibGU6IGZhbHNlLCB3cml0YWJsZTogdHJ1ZSwgY29uZmlndXJhYmxlOiB0cnVlIH0gfSk7IGlmIChzdXBlckNsYXNzKSBPYmplY3Quc2V0UHJvdG90eXBlT2YgPyBPYmplY3Quc2V0UHJvdG90eXBlT2Yoc3ViQ2xhc3MsIHN1cGVyQ2xhc3MpIDogc3ViQ2xhc3MuX19wcm90b19fID0gc3VwZXJDbGFzczsgfVxuXHRcblx0dmFyIF9yZWFjdCA9IF9fd2VicGFja19yZXF1aXJlX18oMSk7XG5cdFxuXHR2YXIgX3JlYWN0MiA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQoX3JlYWN0KTtcblx0XG5cdHZhciBBdXRob3IgPSAoZnVuY3Rpb24gKF9SZWFjdCRDb21wb25lbnQpIHtcblx0ICAgIF9pbmhlcml0cyhBdXRob3IsIF9SZWFjdCRDb21wb25lbnQpO1xuXHRcblx0ICAgIGZ1bmN0aW9uIEF1dGhvcigpIHtcblx0ICAgICAgICBfY2xhc3NDYWxsQ2hlY2sodGhpcywgQXV0aG9yKTtcblx0XG5cdCAgICAgICAgX2dldChPYmplY3QuZ2V0UHJvdG90eXBlT2YoQXV0aG9yLnByb3RvdHlwZSksIFwiY29uc3RydWN0b3JcIiwgdGhpcykuYXBwbHkodGhpcywgYXJndW1lbnRzKTtcblx0ICAgIH1cblx0XG5cdCAgICBfY3JlYXRlQ2xhc3MoQXV0aG9yLCBbe1xuXHQgICAgICAgIGtleTogXCJyZW5kZXJcIixcblx0ICAgICAgICB2YWx1ZTogZnVuY3Rpb24gcmVuZGVyKCkge1xuXHRcblx0ICAgICAgICAgICAgcmV0dXJuIF9yZWFjdDJbXCJkZWZhdWx0XCJdLmNyZWF0ZUVsZW1lbnQoXG5cdCAgICAgICAgICAgICAgICBcImFcIixcblx0ICAgICAgICAgICAgICAgIHsgY2xhc3NOYW1lOiBcImNsaW1iX190aWxlX19hdXRob3JcIixcblx0ICAgICAgICAgICAgICAgICAgICBocmVmOiB0aGlzLnByb3BzLmxpbmsgfSxcblx0ICAgICAgICAgICAgICAgIF9yZWFjdDJbXCJkZWZhdWx0XCJdLmNyZWF0ZUVsZW1lbnQoXCJpbWdcIiwgeyBzcmM6IHRoaXMucHJvcHMucGljdHVyZSxcblx0ICAgICAgICAgICAgICAgICAgICBhbHQ6IFwiUHJvZmlsZSBwaWMgb2YgXCIgKyB0aGlzLnByb3BzLm5hbWUgfSksXG5cdCAgICAgICAgICAgICAgICBfcmVhY3QyW1wiZGVmYXVsdFwiXS5jcmVhdGVFbGVtZW50KFxuXHQgICAgICAgICAgICAgICAgICAgIFwiaDRcIixcblx0ICAgICAgICAgICAgICAgICAgICB7IGNsYXNzTmFtZTogXCJjbGltYl9fdGlsZV9fYXV0aG9yX191c2VybmFtZVwiIH0sXG5cdCAgICAgICAgICAgICAgICAgICAgdGhpcy5wcm9wcy51c2VybmFtZVxuXHQgICAgICAgICAgICAgICAgKSxcblx0ICAgICAgICAgICAgICAgIF9yZWFjdDJbXCJkZWZhdWx0XCJdLmNyZWF0ZUVsZW1lbnQoXG5cdCAgICAgICAgICAgICAgICAgICAgXCJoNFwiLFxuXHQgICAgICAgICAgICAgICAgICAgIHsgY2xhc3NOYW1lOiBcImNsaW1iX190aWxlX19hdXRob3JfX2ZvbGxvd2Vyc1wiIH0sXG5cdCAgICAgICAgICAgICAgICAgICAgdGhpcy5wcm9wcy5mb2xsb3dlcnNfY291bnRcblx0ICAgICAgICAgICAgICAgIClcblx0ICAgICAgICAgICAgKTtcblx0ICAgICAgICB9XG5cdCAgICB9XSk7XG5cdFxuXHQgICAgcmV0dXJuIEF1dGhvcjtcblx0fSkoX3JlYWN0MltcImRlZmF1bHRcIl0uQ29tcG9uZW50KTtcblx0XG5cdEF1dGhvci5wcm9wVHlwZXMgPSB7fTtcblx0XG5cdGV4cG9ydHNbXCJkZWZhdWx0XCJdID0gQXV0aG9yO1xuXHRtb2R1bGUuZXhwb3J0cyA9IGV4cG9ydHNbXCJkZWZhdWx0XCJdO1xuXG4vKioqLyB9LFxuLyogMyAqL1xuLyoqKi8gZnVuY3Rpb24obW9kdWxlLCBleHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSB7XG5cblx0XCJ1c2Ugc3RyaWN0XCI7XG5cdFxuXHRPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHtcblx0ICAgIHZhbHVlOiB0cnVlXG5cdH0pO1xuXHRcblx0dmFyIF9jcmVhdGVDbGFzcyA9IChmdW5jdGlvbiAoKSB7IGZ1bmN0aW9uIGRlZmluZVByb3BlcnRpZXModGFyZ2V0LCBwcm9wcykgeyBmb3IgKHZhciBpID0gMDsgaSA8IHByb3BzLmxlbmd0aDsgaSsrKSB7IHZhciBkZXNjcmlwdG9yID0gcHJvcHNbaV07IGRlc2NyaXB0b3IuZW51bWVyYWJsZSA9IGRlc2NyaXB0b3IuZW51bWVyYWJsZSB8fCBmYWxzZTsgZGVzY3JpcHRvci5jb25maWd1cmFibGUgPSB0cnVlOyBpZiAoXCJ2YWx1ZVwiIGluIGRlc2NyaXB0b3IpIGRlc2NyaXB0b3Iud3JpdGFibGUgPSB0cnVlOyBPYmplY3QuZGVmaW5lUHJvcGVydHkodGFyZ2V0LCBkZXNjcmlwdG9yLmtleSwgZGVzY3JpcHRvcik7IH0gfSByZXR1cm4gZnVuY3Rpb24gKENvbnN0cnVjdG9yLCBwcm90b1Byb3BzLCBzdGF0aWNQcm9wcykgeyBpZiAocHJvdG9Qcm9wcykgZGVmaW5lUHJvcGVydGllcyhDb25zdHJ1Y3Rvci5wcm90b3R5cGUsIHByb3RvUHJvcHMpOyBpZiAoc3RhdGljUHJvcHMpIGRlZmluZVByb3BlcnRpZXMoQ29uc3RydWN0b3IsIHN0YXRpY1Byb3BzKTsgcmV0dXJuIENvbnN0cnVjdG9yOyB9OyB9KSgpO1xuXHRcblx0dmFyIF9nZXQgPSBmdW5jdGlvbiBnZXQoX3gsIF94MiwgX3gzKSB7IHZhciBfYWdhaW4gPSB0cnVlOyBfZnVuY3Rpb246IHdoaWxlIChfYWdhaW4pIHsgdmFyIG9iamVjdCA9IF94LCBwcm9wZXJ0eSA9IF94MiwgcmVjZWl2ZXIgPSBfeDM7IGRlc2MgPSBwYXJlbnQgPSBnZXR0ZXIgPSB1bmRlZmluZWQ7IF9hZ2FpbiA9IGZhbHNlOyBpZiAob2JqZWN0ID09PSBudWxsKSBvYmplY3QgPSBGdW5jdGlvbi5wcm90b3R5cGU7IHZhciBkZXNjID0gT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcihvYmplY3QsIHByb3BlcnR5KTsgaWYgKGRlc2MgPT09IHVuZGVmaW5lZCkgeyB2YXIgcGFyZW50ID0gT2JqZWN0LmdldFByb3RvdHlwZU9mKG9iamVjdCk7IGlmIChwYXJlbnQgPT09IG51bGwpIHsgcmV0dXJuIHVuZGVmaW5lZDsgfSBlbHNlIHsgX3ggPSBwYXJlbnQ7IF94MiA9IHByb3BlcnR5OyBfeDMgPSByZWNlaXZlcjsgX2FnYWluID0gdHJ1ZTsgY29udGludWUgX2Z1bmN0aW9uOyB9IH0gZWxzZSBpZiAoXCJ2YWx1ZVwiIGluIGRlc2MpIHsgcmV0dXJuIGRlc2MudmFsdWU7IH0gZWxzZSB7IHZhciBnZXR0ZXIgPSBkZXNjLmdldDsgaWYgKGdldHRlciA9PT0gdW5kZWZpbmVkKSB7IHJldHVybiB1bmRlZmluZWQ7IH0gcmV0dXJuIGdldHRlci5jYWxsKHJlY2VpdmVyKTsgfSB9IH07XG5cdFxuXHRmdW5jdGlvbiBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KG9iaikgeyByZXR1cm4gb2JqICYmIG9iai5fX2VzTW9kdWxlID8gb2JqIDogeyBcImRlZmF1bHRcIjogb2JqIH07IH1cblx0XG5cdGZ1bmN0aW9uIF9jbGFzc0NhbGxDaGVjayhpbnN0YW5jZSwgQ29uc3RydWN0b3IpIHsgaWYgKCEoaW5zdGFuY2UgaW5zdGFuY2VvZiBDb25zdHJ1Y3RvcikpIHsgdGhyb3cgbmV3IFR5cGVFcnJvcihcIkNhbm5vdCBjYWxsIGEgY2xhc3MgYXMgYSBmdW5jdGlvblwiKTsgfSB9XG5cdFxuXHRmdW5jdGlvbiBfaW5oZXJpdHMoc3ViQ2xhc3MsIHN1cGVyQ2xhc3MpIHsgaWYgKHR5cGVvZiBzdXBlckNsYXNzICE9PSBcImZ1bmN0aW9uXCIgJiYgc3VwZXJDbGFzcyAhPT0gbnVsbCkgeyB0aHJvdyBuZXcgVHlwZUVycm9yKFwiU3VwZXIgZXhwcmVzc2lvbiBtdXN0IGVpdGhlciBiZSBudWxsIG9yIGEgZnVuY3Rpb24sIG5vdCBcIiArIHR5cGVvZiBzdXBlckNsYXNzKTsgfSBzdWJDbGFzcy5wcm90b3R5cGUgPSBPYmplY3QuY3JlYXRlKHN1cGVyQ2xhc3MgJiYgc3VwZXJDbGFzcy5wcm90b3R5cGUsIHsgY29uc3RydWN0b3I6IHsgdmFsdWU6IHN1YkNsYXNzLCBlbnVtZXJhYmxlOiBmYWxzZSwgd3JpdGFibGU6IHRydWUsIGNvbmZpZ3VyYWJsZTogdHJ1ZSB9IH0pOyBpZiAoc3VwZXJDbGFzcykgT2JqZWN0LnNldFByb3RvdHlwZU9mID8gT2JqZWN0LnNldFByb3RvdHlwZU9mKHN1YkNsYXNzLCBzdXBlckNsYXNzKSA6IHN1YkNsYXNzLl9fcHJvdG9fXyA9IHN1cGVyQ2xhc3M7IH1cblx0XG5cdHZhciBfcmVhY3QgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDEpO1xuXHRcblx0dmFyIF9yZWFjdDIgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KF9yZWFjdCk7XG5cdFxuXHR2YXIgSW1hZ2UgPSAoZnVuY3Rpb24gKF9SZWFjdCRDb21wb25lbnQpIHtcblx0ICAgIF9pbmhlcml0cyhJbWFnZSwgX1JlYWN0JENvbXBvbmVudCk7XG5cdFxuXHQgICAgZnVuY3Rpb24gSW1hZ2UoKSB7XG5cdCAgICAgICAgX2NsYXNzQ2FsbENoZWNrKHRoaXMsIEltYWdlKTtcblx0XG5cdCAgICAgICAgX2dldChPYmplY3QuZ2V0UHJvdG90eXBlT2YoSW1hZ2UucHJvdG90eXBlKSwgXCJjb25zdHJ1Y3RvclwiLCB0aGlzKS5hcHBseSh0aGlzLCBhcmd1bWVudHMpO1xuXHQgICAgfVxuXHRcblx0ICAgIF9jcmVhdGVDbGFzcyhJbWFnZSwgW3tcblx0ICAgICAgICBrZXk6IFwicmVuZGVyXCIsXG5cdCAgICAgICAgdmFsdWU6IGZ1bmN0aW9uIHJlbmRlcigpIHtcblx0ICAgICAgICAgICAgcmV0dXJuIF9yZWFjdDJbXCJkZWZhdWx0XCJdLmNyZWF0ZUVsZW1lbnQoXCJpbWdcIiwgeyBjbGFzc05hbWU6IFwiY2xpbWJfX3RpbGVfX2ltYWdlXCIsXG5cdCAgICAgICAgICAgICAgICBzcmM6IHRoaXMucHJvcHMuc3JjLCBcImRhdGEtd2lkdGhcIjogdGhpcy5wcm9wcy53aWR0aCwgXCJkYXRhLWhlaWdodFwiOiB0aGlzLnByb3BzLmhlaWdodCB9KTtcblx0ICAgICAgICB9XG5cdCAgICB9XSk7XG5cdFxuXHQgICAgcmV0dXJuIEltYWdlO1xuXHR9KShfcmVhY3QyW1wiZGVmYXVsdFwiXS5Db21wb25lbnQpO1xuXHRcblx0SW1hZ2UucHJvcFR5cGVzID0ge1xuXHQgICAgc3JjOiBfcmVhY3QyW1wiZGVmYXVsdFwiXS5Qcm9wVHlwZXMuc3RyaW5nLmlzUmVxdWlyZWQsXG5cdCAgICB3aWR0aDogX3JlYWN0MltcImRlZmF1bHRcIl0uUHJvcFR5cGVzLm51bWJlcixcblx0ICAgIGhlaWdodDogX3JlYWN0MltcImRlZmF1bHRcIl0uUHJvcFR5cGVzLm51bWJlclxuXHR9O1xuXHRcblx0ZXhwb3J0c1tcImRlZmF1bHRcIl0gPSBJbWFnZTtcblx0bW9kdWxlLmV4cG9ydHMgPSBleHBvcnRzW1wiZGVmYXVsdFwiXTtcblxuLyoqKi8gfSxcbi8qIDQgKi9cbi8qKiovIGZ1bmN0aW9uKG1vZHVsZSwgZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykge1xuXG5cdCd1c2Ugc3RyaWN0Jztcblx0XG5cdE9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCAnX19lc01vZHVsZScsIHtcblx0ICAgIHZhbHVlOiB0cnVlXG5cdH0pO1xuXHRcblx0dmFyIF9jcmVhdGVDbGFzcyA9IChmdW5jdGlvbiAoKSB7IGZ1bmN0aW9uIGRlZmluZVByb3BlcnRpZXModGFyZ2V0LCBwcm9wcykgeyBmb3IgKHZhciBpID0gMDsgaSA8IHByb3BzLmxlbmd0aDsgaSsrKSB7IHZhciBkZXNjcmlwdG9yID0gcHJvcHNbaV07IGRlc2NyaXB0b3IuZW51bWVyYWJsZSA9IGRlc2NyaXB0b3IuZW51bWVyYWJsZSB8fCBmYWxzZTsgZGVzY3JpcHRvci5jb25maWd1cmFibGUgPSB0cnVlOyBpZiAoJ3ZhbHVlJyBpbiBkZXNjcmlwdG9yKSBkZXNjcmlwdG9yLndyaXRhYmxlID0gdHJ1ZTsgT2JqZWN0LmRlZmluZVByb3BlcnR5KHRhcmdldCwgZGVzY3JpcHRvci5rZXksIGRlc2NyaXB0b3IpOyB9IH0gcmV0dXJuIGZ1bmN0aW9uIChDb25zdHJ1Y3RvciwgcHJvdG9Qcm9wcywgc3RhdGljUHJvcHMpIHsgaWYgKHByb3RvUHJvcHMpIGRlZmluZVByb3BlcnRpZXMoQ29uc3RydWN0b3IucHJvdG90eXBlLCBwcm90b1Byb3BzKTsgaWYgKHN0YXRpY1Byb3BzKSBkZWZpbmVQcm9wZXJ0aWVzKENvbnN0cnVjdG9yLCBzdGF0aWNQcm9wcyk7IHJldHVybiBDb25zdHJ1Y3RvcjsgfTsgfSkoKTtcblx0XG5cdHZhciBfZ2V0ID0gZnVuY3Rpb24gZ2V0KF94LCBfeDIsIF94MykgeyB2YXIgX2FnYWluID0gdHJ1ZTsgX2Z1bmN0aW9uOiB3aGlsZSAoX2FnYWluKSB7IHZhciBvYmplY3QgPSBfeCwgcHJvcGVydHkgPSBfeDIsIHJlY2VpdmVyID0gX3gzOyBkZXNjID0gcGFyZW50ID0gZ2V0dGVyID0gdW5kZWZpbmVkOyBfYWdhaW4gPSBmYWxzZTsgaWYgKG9iamVjdCA9PT0gbnVsbCkgb2JqZWN0ID0gRnVuY3Rpb24ucHJvdG90eXBlOyB2YXIgZGVzYyA9IE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3Iob2JqZWN0LCBwcm9wZXJ0eSk7IGlmIChkZXNjID09PSB1bmRlZmluZWQpIHsgdmFyIHBhcmVudCA9IE9iamVjdC5nZXRQcm90b3R5cGVPZihvYmplY3QpOyBpZiAocGFyZW50ID09PSBudWxsKSB7IHJldHVybiB1bmRlZmluZWQ7IH0gZWxzZSB7IF94ID0gcGFyZW50OyBfeDIgPSBwcm9wZXJ0eTsgX3gzID0gcmVjZWl2ZXI7IF9hZ2FpbiA9IHRydWU7IGNvbnRpbnVlIF9mdW5jdGlvbjsgfSB9IGVsc2UgaWYgKCd2YWx1ZScgaW4gZGVzYykgeyByZXR1cm4gZGVzYy52YWx1ZTsgfSBlbHNlIHsgdmFyIGdldHRlciA9IGRlc2MuZ2V0OyBpZiAoZ2V0dGVyID09PSB1bmRlZmluZWQpIHsgcmV0dXJuIHVuZGVmaW5lZDsgfSByZXR1cm4gZ2V0dGVyLmNhbGwocmVjZWl2ZXIpOyB9IH0gfTtcblx0XG5cdGZ1bmN0aW9uIF9pbnRlcm9wUmVxdWlyZURlZmF1bHQob2JqKSB7IHJldHVybiBvYmogJiYgb2JqLl9fZXNNb2R1bGUgPyBvYmogOiB7ICdkZWZhdWx0Jzogb2JqIH07IH1cblx0XG5cdGZ1bmN0aW9uIF9jbGFzc0NhbGxDaGVjayhpbnN0YW5jZSwgQ29uc3RydWN0b3IpIHsgaWYgKCEoaW5zdGFuY2UgaW5zdGFuY2VvZiBDb25zdHJ1Y3RvcikpIHsgdGhyb3cgbmV3IFR5cGVFcnJvcignQ2Fubm90IGNhbGwgYSBjbGFzcyBhcyBhIGZ1bmN0aW9uJyk7IH0gfVxuXHRcblx0ZnVuY3Rpb24gX2luaGVyaXRzKHN1YkNsYXNzLCBzdXBlckNsYXNzKSB7IGlmICh0eXBlb2Ygc3VwZXJDbGFzcyAhPT0gJ2Z1bmN0aW9uJyAmJiBzdXBlckNsYXNzICE9PSBudWxsKSB7IHRocm93IG5ldyBUeXBlRXJyb3IoJ1N1cGVyIGV4cHJlc3Npb24gbXVzdCBlaXRoZXIgYmUgbnVsbCBvciBhIGZ1bmN0aW9uLCBub3QgJyArIHR5cGVvZiBzdXBlckNsYXNzKTsgfSBzdWJDbGFzcy5wcm90b3R5cGUgPSBPYmplY3QuY3JlYXRlKHN1cGVyQ2xhc3MgJiYgc3VwZXJDbGFzcy5wcm90b3R5cGUsIHsgY29uc3RydWN0b3I6IHsgdmFsdWU6IHN1YkNsYXNzLCBlbnVtZXJhYmxlOiBmYWxzZSwgd3JpdGFibGU6IHRydWUsIGNvbmZpZ3VyYWJsZTogdHJ1ZSB9IH0pOyBpZiAoc3VwZXJDbGFzcykgT2JqZWN0LnNldFByb3RvdHlwZU9mID8gT2JqZWN0LnNldFByb3RvdHlwZU9mKHN1YkNsYXNzLCBzdXBlckNsYXNzKSA6IHN1YkNsYXNzLl9fcHJvdG9fXyA9IHN1cGVyQ2xhc3M7IH1cblx0XG5cdHZhciBfcmVhY3QgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDEpO1xuXHRcblx0dmFyIF9yZWFjdDIgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KF9yZWFjdCk7XG5cdFxuXHR2YXIgSW50ZXJhY3Rpb24gPSAoZnVuY3Rpb24gKF9SZWFjdCRDb21wb25lbnQpIHtcblx0ICAgIF9pbmhlcml0cyhJbnRlcmFjdGlvbiwgX1JlYWN0JENvbXBvbmVudCk7XG5cdFxuXHQgICAgZnVuY3Rpb24gSW50ZXJhY3Rpb24oKSB7XG5cdCAgICAgICAgX2NsYXNzQ2FsbENoZWNrKHRoaXMsIEludGVyYWN0aW9uKTtcblx0XG5cdCAgICAgICAgX2dldChPYmplY3QuZ2V0UHJvdG90eXBlT2YoSW50ZXJhY3Rpb24ucHJvdG90eXBlKSwgJ2NvbnN0cnVjdG9yJywgdGhpcykuYXBwbHkodGhpcywgYXJndW1lbnRzKTtcblx0ICAgIH1cblx0XG5cdCAgICBfY3JlYXRlQ2xhc3MoSW50ZXJhY3Rpb24sIFt7XG5cdCAgICAgICAga2V5OiAncmVuZGVyJyxcblx0ICAgICAgICB2YWx1ZTogZnVuY3Rpb24gcmVuZGVyKCkge1xuXHRcblx0ICAgICAgICAgICAgcmV0dXJuIF9yZWFjdDJbJ2RlZmF1bHQnXS5jcmVhdGVFbGVtZW50KCd1bCcsIG51bGwpO1xuXHQgICAgICAgIH1cblx0ICAgIH1dKTtcblx0XG5cdCAgICByZXR1cm4gSW50ZXJhY3Rpb247XG5cdH0pKF9yZWFjdDJbJ2RlZmF1bHQnXS5Db21wb25lbnQpO1xuXHRcblx0SW50ZXJhY3Rpb24ucHJvcFR5cGVzID0ge1xuXHQgICAgYm9keTogX3JlYWN0MlsnZGVmYXVsdCddLlByb3BUeXBlcy5zdHJpbmcuaXNSZXF1aXJlZFxuXHR9O1xuXHRcblx0ZXhwb3J0c1snZGVmYXVsdCddID0gSW50ZXJhY3Rpb247XG5cdG1vZHVsZS5leHBvcnRzID0gZXhwb3J0c1snZGVmYXVsdCddO1xuXG4vKioqLyB9LFxuLyogNSAqL1xuLyoqKi8gZnVuY3Rpb24obW9kdWxlLCBleHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSB7XG5cblx0XCJ1c2Ugc3RyaWN0XCI7XG5cdFxuXHRPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHtcblx0ICAgIHZhbHVlOiB0cnVlXG5cdH0pO1xuXHRcblx0dmFyIF9jcmVhdGVDbGFzcyA9IChmdW5jdGlvbiAoKSB7IGZ1bmN0aW9uIGRlZmluZVByb3BlcnRpZXModGFyZ2V0LCBwcm9wcykgeyBmb3IgKHZhciBpID0gMDsgaSA8IHByb3BzLmxlbmd0aDsgaSsrKSB7IHZhciBkZXNjcmlwdG9yID0gcHJvcHNbaV07IGRlc2NyaXB0b3IuZW51bWVyYWJsZSA9IGRlc2NyaXB0b3IuZW51bWVyYWJsZSB8fCBmYWxzZTsgZGVzY3JpcHRvci5jb25maWd1cmFibGUgPSB0cnVlOyBpZiAoXCJ2YWx1ZVwiIGluIGRlc2NyaXB0b3IpIGRlc2NyaXB0b3Iud3JpdGFibGUgPSB0cnVlOyBPYmplY3QuZGVmaW5lUHJvcGVydHkodGFyZ2V0LCBkZXNjcmlwdG9yLmtleSwgZGVzY3JpcHRvcik7IH0gfSByZXR1cm4gZnVuY3Rpb24gKENvbnN0cnVjdG9yLCBwcm90b1Byb3BzLCBzdGF0aWNQcm9wcykgeyBpZiAocHJvdG9Qcm9wcykgZGVmaW5lUHJvcGVydGllcyhDb25zdHJ1Y3Rvci5wcm90b3R5cGUsIHByb3RvUHJvcHMpOyBpZiAoc3RhdGljUHJvcHMpIGRlZmluZVByb3BlcnRpZXMoQ29uc3RydWN0b3IsIHN0YXRpY1Byb3BzKTsgcmV0dXJuIENvbnN0cnVjdG9yOyB9OyB9KSgpO1xuXHRcblx0dmFyIF9nZXQgPSBmdW5jdGlvbiBnZXQoX3gsIF94MiwgX3gzKSB7IHZhciBfYWdhaW4gPSB0cnVlOyBfZnVuY3Rpb246IHdoaWxlIChfYWdhaW4pIHsgdmFyIG9iamVjdCA9IF94LCBwcm9wZXJ0eSA9IF94MiwgcmVjZWl2ZXIgPSBfeDM7IGRlc2MgPSBwYXJlbnQgPSBnZXR0ZXIgPSB1bmRlZmluZWQ7IF9hZ2FpbiA9IGZhbHNlOyBpZiAob2JqZWN0ID09PSBudWxsKSBvYmplY3QgPSBGdW5jdGlvbi5wcm90b3R5cGU7IHZhciBkZXNjID0gT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcihvYmplY3QsIHByb3BlcnR5KTsgaWYgKGRlc2MgPT09IHVuZGVmaW5lZCkgeyB2YXIgcGFyZW50ID0gT2JqZWN0LmdldFByb3RvdHlwZU9mKG9iamVjdCk7IGlmIChwYXJlbnQgPT09IG51bGwpIHsgcmV0dXJuIHVuZGVmaW5lZDsgfSBlbHNlIHsgX3ggPSBwYXJlbnQ7IF94MiA9IHByb3BlcnR5OyBfeDMgPSByZWNlaXZlcjsgX2FnYWluID0gdHJ1ZTsgY29udGludWUgX2Z1bmN0aW9uOyB9IH0gZWxzZSBpZiAoXCJ2YWx1ZVwiIGluIGRlc2MpIHsgcmV0dXJuIGRlc2MudmFsdWU7IH0gZWxzZSB7IHZhciBnZXR0ZXIgPSBkZXNjLmdldDsgaWYgKGdldHRlciA9PT0gdW5kZWZpbmVkKSB7IHJldHVybiB1bmRlZmluZWQ7IH0gcmV0dXJuIGdldHRlci5jYWxsKHJlY2VpdmVyKTsgfSB9IH07XG5cdFxuXHRmdW5jdGlvbiBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KG9iaikgeyByZXR1cm4gb2JqICYmIG9iai5fX2VzTW9kdWxlID8gb2JqIDogeyBcImRlZmF1bHRcIjogb2JqIH07IH1cblx0XG5cdGZ1bmN0aW9uIF9jbGFzc0NhbGxDaGVjayhpbnN0YW5jZSwgQ29uc3RydWN0b3IpIHsgaWYgKCEoaW5zdGFuY2UgaW5zdGFuY2VvZiBDb25zdHJ1Y3RvcikpIHsgdGhyb3cgbmV3IFR5cGVFcnJvcihcIkNhbm5vdCBjYWxsIGEgY2xhc3MgYXMgYSBmdW5jdGlvblwiKTsgfSB9XG5cdFxuXHRmdW5jdGlvbiBfaW5oZXJpdHMoc3ViQ2xhc3MsIHN1cGVyQ2xhc3MpIHsgaWYgKHR5cGVvZiBzdXBlckNsYXNzICE9PSBcImZ1bmN0aW9uXCIgJiYgc3VwZXJDbGFzcyAhPT0gbnVsbCkgeyB0aHJvdyBuZXcgVHlwZUVycm9yKFwiU3VwZXIgZXhwcmVzc2lvbiBtdXN0IGVpdGhlciBiZSBudWxsIG9yIGEgZnVuY3Rpb24sIG5vdCBcIiArIHR5cGVvZiBzdXBlckNsYXNzKTsgfSBzdWJDbGFzcy5wcm90b3R5cGUgPSBPYmplY3QuY3JlYXRlKHN1cGVyQ2xhc3MgJiYgc3VwZXJDbGFzcy5wcm90b3R5cGUsIHsgY29uc3RydWN0b3I6IHsgdmFsdWU6IHN1YkNsYXNzLCBlbnVtZXJhYmxlOiBmYWxzZSwgd3JpdGFibGU6IHRydWUsIGNvbmZpZ3VyYWJsZTogdHJ1ZSB9IH0pOyBpZiAoc3VwZXJDbGFzcykgT2JqZWN0LnNldFByb3RvdHlwZU9mID8gT2JqZWN0LnNldFByb3RvdHlwZU9mKHN1YkNsYXNzLCBzdXBlckNsYXNzKSA6IHN1YkNsYXNzLl9fcHJvdG9fXyA9IHN1cGVyQ2xhc3M7IH1cblx0XG5cdHZhciBfcmVhY3QgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDEpO1xuXHRcblx0dmFyIF9yZWFjdDIgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KF9yZWFjdCk7XG5cdFxuXHR2YXIgTWVzc2FnZSA9IChmdW5jdGlvbiAoX1JlYWN0JENvbXBvbmVudCkge1xuXHQgICAgX2luaGVyaXRzKE1lc3NhZ2UsIF9SZWFjdCRDb21wb25lbnQpO1xuXHRcblx0ICAgIGZ1bmN0aW9uIE1lc3NhZ2UoKSB7XG5cdCAgICAgICAgX2NsYXNzQ2FsbENoZWNrKHRoaXMsIE1lc3NhZ2UpO1xuXHRcblx0ICAgICAgICBfZ2V0KE9iamVjdC5nZXRQcm90b3R5cGVPZihNZXNzYWdlLnByb3RvdHlwZSksIFwiY29uc3RydWN0b3JcIiwgdGhpcykuYXBwbHkodGhpcywgYXJndW1lbnRzKTtcblx0ICAgIH1cblx0XG5cdCAgICBfY3JlYXRlQ2xhc3MoTWVzc2FnZSwgW3tcblx0ICAgICAgICBrZXk6IFwicmVuZGVyXCIsXG5cdCAgICAgICAgdmFsdWU6IGZ1bmN0aW9uIHJlbmRlcigpIHtcblx0ICAgICAgICAgICAgcmV0dXJuIF9yZWFjdDJbXCJkZWZhdWx0XCJdLmNyZWF0ZUVsZW1lbnQoXCJkaXZcIiwgeyBjbGFzc05hbWU6IFwiY2xpbWJfX3RpbGVfX21lc3NhZ2VcIixcblx0ICAgICAgICAgICAgICAgIGRhbmdlcm91c2x5U2V0SW5uZXJIVE1MOiB7IF9faHRtbDogdGhpcy5wcm9wcy5ib2R5IH0gfSk7XG5cdCAgICAgICAgfVxuXHQgICAgfV0pO1xuXHRcblx0ICAgIHJldHVybiBNZXNzYWdlO1xuXHR9KShfcmVhY3QyW1wiZGVmYXVsdFwiXS5Db21wb25lbnQpO1xuXHRcblx0TWVzc2FnZS5wcm9wVHlwZXMgPSB7XG5cdCAgICBib2R5OiBfcmVhY3QyW1wiZGVmYXVsdFwiXS5Qcm9wVHlwZXMuc3RyaW5nLmlzUmVxdWlyZWRcblx0fTtcblx0XG5cdGV4cG9ydHNbXCJkZWZhdWx0XCJdID0gTWVzc2FnZTtcblx0bW9kdWxlLmV4cG9ydHMgPSBleHBvcnRzW1wiZGVmYXVsdFwiXTtcblxuLyoqKi8gfSxcbi8qIDYgKi9cbi8qKiovIGZ1bmN0aW9uKG1vZHVsZSwgZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykge1xuXG5cdCd1c2Ugc3RyaWN0Jztcblx0XG5cdE9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCAnX19lc01vZHVsZScsIHtcblx0ICAgIHZhbHVlOiB0cnVlXG5cdH0pO1xuXHRcblx0dmFyIF9jcmVhdGVDbGFzcyA9IChmdW5jdGlvbiAoKSB7IGZ1bmN0aW9uIGRlZmluZVByb3BlcnRpZXModGFyZ2V0LCBwcm9wcykgeyBmb3IgKHZhciBpID0gMDsgaSA8IHByb3BzLmxlbmd0aDsgaSsrKSB7IHZhciBkZXNjcmlwdG9yID0gcHJvcHNbaV07IGRlc2NyaXB0b3IuZW51bWVyYWJsZSA9IGRlc2NyaXB0b3IuZW51bWVyYWJsZSB8fCBmYWxzZTsgZGVzY3JpcHRvci5jb25maWd1cmFibGUgPSB0cnVlOyBpZiAoJ3ZhbHVlJyBpbiBkZXNjcmlwdG9yKSBkZXNjcmlwdG9yLndyaXRhYmxlID0gdHJ1ZTsgT2JqZWN0LmRlZmluZVByb3BlcnR5KHRhcmdldCwgZGVzY3JpcHRvci5rZXksIGRlc2NyaXB0b3IpOyB9IH0gcmV0dXJuIGZ1bmN0aW9uIChDb25zdHJ1Y3RvciwgcHJvdG9Qcm9wcywgc3RhdGljUHJvcHMpIHsgaWYgKHByb3RvUHJvcHMpIGRlZmluZVByb3BlcnRpZXMoQ29uc3RydWN0b3IucHJvdG90eXBlLCBwcm90b1Byb3BzKTsgaWYgKHN0YXRpY1Byb3BzKSBkZWZpbmVQcm9wZXJ0aWVzKENvbnN0cnVjdG9yLCBzdGF0aWNQcm9wcyk7IHJldHVybiBDb25zdHJ1Y3RvcjsgfTsgfSkoKTtcblx0XG5cdHZhciBfZ2V0ID0gZnVuY3Rpb24gZ2V0KF94LCBfeDIsIF94MykgeyB2YXIgX2FnYWluID0gdHJ1ZTsgX2Z1bmN0aW9uOiB3aGlsZSAoX2FnYWluKSB7IHZhciBvYmplY3QgPSBfeCwgcHJvcGVydHkgPSBfeDIsIHJlY2VpdmVyID0gX3gzOyBkZXNjID0gcGFyZW50ID0gZ2V0dGVyID0gdW5kZWZpbmVkOyBfYWdhaW4gPSBmYWxzZTsgaWYgKG9iamVjdCA9PT0gbnVsbCkgb2JqZWN0ID0gRnVuY3Rpb24ucHJvdG90eXBlOyB2YXIgZGVzYyA9IE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3Iob2JqZWN0LCBwcm9wZXJ0eSk7IGlmIChkZXNjID09PSB1bmRlZmluZWQpIHsgdmFyIHBhcmVudCA9IE9iamVjdC5nZXRQcm90b3R5cGVPZihvYmplY3QpOyBpZiAocGFyZW50ID09PSBudWxsKSB7IHJldHVybiB1bmRlZmluZWQ7IH0gZWxzZSB7IF94ID0gcGFyZW50OyBfeDIgPSBwcm9wZXJ0eTsgX3gzID0gcmVjZWl2ZXI7IF9hZ2FpbiA9IHRydWU7IGNvbnRpbnVlIF9mdW5jdGlvbjsgfSB9IGVsc2UgaWYgKCd2YWx1ZScgaW4gZGVzYykgeyByZXR1cm4gZGVzYy52YWx1ZTsgfSBlbHNlIHsgdmFyIGdldHRlciA9IGRlc2MuZ2V0OyBpZiAoZ2V0dGVyID09PSB1bmRlZmluZWQpIHsgcmV0dXJuIHVuZGVmaW5lZDsgfSByZXR1cm4gZ2V0dGVyLmNhbGwocmVjZWl2ZXIpOyB9IH0gfTtcblx0XG5cdGZ1bmN0aW9uIF9pbnRlcm9wUmVxdWlyZURlZmF1bHQob2JqKSB7IHJldHVybiBvYmogJiYgb2JqLl9fZXNNb2R1bGUgPyBvYmogOiB7ICdkZWZhdWx0Jzogb2JqIH07IH1cblx0XG5cdGZ1bmN0aW9uIF9jbGFzc0NhbGxDaGVjayhpbnN0YW5jZSwgQ29uc3RydWN0b3IpIHsgaWYgKCEoaW5zdGFuY2UgaW5zdGFuY2VvZiBDb25zdHJ1Y3RvcikpIHsgdGhyb3cgbmV3IFR5cGVFcnJvcignQ2Fubm90IGNhbGwgYSBjbGFzcyBhcyBhIGZ1bmN0aW9uJyk7IH0gfVxuXHRcblx0ZnVuY3Rpb24gX2luaGVyaXRzKHN1YkNsYXNzLCBzdXBlckNsYXNzKSB7IGlmICh0eXBlb2Ygc3VwZXJDbGFzcyAhPT0gJ2Z1bmN0aW9uJyAmJiBzdXBlckNsYXNzICE9PSBudWxsKSB7IHRocm93IG5ldyBUeXBlRXJyb3IoJ1N1cGVyIGV4cHJlc3Npb24gbXVzdCBlaXRoZXIgYmUgbnVsbCBvciBhIGZ1bmN0aW9uLCBub3QgJyArIHR5cGVvZiBzdXBlckNsYXNzKTsgfSBzdWJDbGFzcy5wcm90b3R5cGUgPSBPYmplY3QuY3JlYXRlKHN1cGVyQ2xhc3MgJiYgc3VwZXJDbGFzcy5wcm90b3R5cGUsIHsgY29uc3RydWN0b3I6IHsgdmFsdWU6IHN1YkNsYXNzLCBlbnVtZXJhYmxlOiBmYWxzZSwgd3JpdGFibGU6IHRydWUsIGNvbmZpZ3VyYWJsZTogdHJ1ZSB9IH0pOyBpZiAoc3VwZXJDbGFzcykgT2JqZWN0LnNldFByb3RvdHlwZU9mID8gT2JqZWN0LnNldFByb3RvdHlwZU9mKHN1YkNsYXNzLCBzdXBlckNsYXNzKSA6IHN1YkNsYXNzLl9fcHJvdG9fXyA9IHN1cGVyQ2xhc3M7IH1cblx0XG5cdHZhciBfcmVhY3QgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDEpO1xuXHRcblx0dmFyIF9yZWFjdDIgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KF9yZWFjdCk7XG5cdFxuXHR2YXIgX0ltYWdlID0gX193ZWJwYWNrX3JlcXVpcmVfXygzKTtcblx0XG5cdHZhciBfSW1hZ2UyID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChfSW1hZ2UpO1xuXHRcblx0dmFyIF9NZXNzYWdlID0gX193ZWJwYWNrX3JlcXVpcmVfXyg1KTtcblx0XG5cdHZhciBfTWVzc2FnZTIgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KF9NZXNzYWdlKTtcblx0XG5cdHZhciBfQXV0aG9yID0gX193ZWJwYWNrX3JlcXVpcmVfXygyKTtcblx0XG5cdHZhciBfQXV0aG9yMiA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQoX0F1dGhvcik7XG5cdFxuXHR2YXIgX0ludGVyYWN0aW9uID0gX193ZWJwYWNrX3JlcXVpcmVfXyg0KTtcblx0XG5cdHZhciBfSW50ZXJhY3Rpb24yID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChfSW50ZXJhY3Rpb24pO1xuXHRcblx0dmFyIFRpbGUgPSAoZnVuY3Rpb24gKF9SZWFjdCRDb21wb25lbnQpIHtcblx0ICAgIF9pbmhlcml0cyhUaWxlLCBfUmVhY3QkQ29tcG9uZW50KTtcblx0XG5cdCAgICBmdW5jdGlvbiBUaWxlKHByb3BzKSB7XG5cdCAgICAgICAgX2NsYXNzQ2FsbENoZWNrKHRoaXMsIFRpbGUpO1xuXHRcblx0ICAgICAgICBfZ2V0KE9iamVjdC5nZXRQcm90b3R5cGVPZihUaWxlLnByb3RvdHlwZSksICdjb25zdHJ1Y3RvcicsIHRoaXMpLmNhbGwodGhpcywgcHJvcHMpO1xuXHQgICAgICAgIHRoaXMuY3JlYXRlSW1hZ2UuYmluZCh0aGlzKTtcblx0ICAgICAgICB0aGlzLmNyZWF0ZU1lc3NhZ2UuYmluZCh0aGlzKTtcblx0ICAgICAgICB0aGlzLmNyZWF0ZUludGVyYWN0aW9uLmJpbmQodGhpcyk7XG5cdCAgICAgICAgdGhpcy5jcmVhdGVDbGFzc1N0cmluZy5iaW5kKHRoaXMpO1xuXHQgICAgfVxuXHRcblx0ICAgIF9jcmVhdGVDbGFzcyhUaWxlLCBbe1xuXHQgICAgICAgIGtleTogJ2NyZWF0ZUltYWdlJyxcblx0ICAgICAgICB2YWx1ZTogZnVuY3Rpb24gY3JlYXRlSW1hZ2UoKSB7XG5cdFxuXHQgICAgICAgICAgICBpZiAodGhpcy5wcm9wcy5pbWFnZSAhPT0gbnVsbCkge1xuXHQgICAgICAgICAgICAgICAgdmFyIF9wcm9wcyRpbWFnZSA9IHRoaXMucHJvcHMuaW1hZ2U7XG5cdCAgICAgICAgICAgICAgICB2YXIgc3JjID0gX3Byb3BzJGltYWdlLnVybDtcblx0ICAgICAgICAgICAgICAgIHZhciB3aWR0aCA9IF9wcm9wcyRpbWFnZS53aWR0aDtcblx0ICAgICAgICAgICAgICAgIHZhciBoZWlnaHQgPSBfcHJvcHMkaW1hZ2UuaGVpZ2h0O1xuXHRcblx0ICAgICAgICAgICAgICAgIHJldHVybiBfcmVhY3QyWydkZWZhdWx0J10uY3JlYXRlRWxlbWVudChfSW1hZ2UyWydkZWZhdWx0J10sIHsgc3JjOiBzcmMsXG5cdCAgICAgICAgICAgICAgICAgICAgd2lkdGg6IHdpZHRoLFxuXHQgICAgICAgICAgICAgICAgICAgIGhlaWdodDogaGVpZ2h0IH0pO1xuXHQgICAgICAgICAgICB9XG5cdCAgICAgICAgICAgIHJldHVybiBudWxsO1xuXHQgICAgICAgIH1cblx0ICAgIH0sIHtcblx0ICAgICAgICBrZXk6ICdjcmVhdGVNZXNzYWdlJyxcblx0ICAgICAgICB2YWx1ZTogZnVuY3Rpb24gY3JlYXRlTWVzc2FnZSgpIHtcblx0XG5cdCAgICAgICAgICAgIGlmICh0aGlzLnByb3BzLm1lc3NhZ2UpIHtcblx0ICAgICAgICAgICAgICAgIHJldHVybiBfcmVhY3QyWydkZWZhdWx0J10uY3JlYXRlRWxlbWVudChfTWVzc2FnZTJbJ2RlZmF1bHQnXSwgeyBib2R5OiB0aGlzLnByb3BzLm1lc3NhZ2UgfSk7XG5cdCAgICAgICAgICAgIH1cblx0ICAgICAgICAgICAgcmV0dXJuIG51bGw7XG5cdCAgICAgICAgfVxuXHQgICAgfSwge1xuXHQgICAgICAgIGtleTogJ2NyZWF0ZUludGVyYWN0aW9uJyxcblx0ICAgICAgICB2YWx1ZTogZnVuY3Rpb24gY3JlYXRlSW50ZXJhY3Rpb24oKSB7XG5cdCAgICAgICAgICAgIGlmICh0aGlzLnByb3BzLmxpbmspIHtcblx0ICAgICAgICAgICAgICAgIHJldHVybiBfcmVhY3QyWydkZWZhdWx0J10uY3JlYXRlRWxlbWVudChfSW50ZXJhY3Rpb24yWydkZWZhdWx0J10sIHsgYm9keTogdGhpcy5wcm9wcyB9KTtcblx0ICAgICAgICAgICAgfVxuXHQgICAgICAgICAgICByZXR1cm4gbnVsbDtcblx0ICAgICAgICB9XG5cdCAgICB9LCB7XG5cdCAgICAgICAga2V5OiAnY3JlYXRlQ2xhc3NTdHJpbmcnLFxuXHQgICAgICAgIHZhbHVlOiBmdW5jdGlvbiBjcmVhdGVDbGFzc1N0cmluZygpIHtcblx0XG5cdCAgICAgICAgICAgIHZhciBjbGFzc1N0cmluZyA9ICdjbGltYl9fdGlsZSBjbGltYl9fdGlsZS0tJyArIHRoaXMucHJvcHMuc291cmNlX3R5cGU7XG5cdFxuXHQgICAgICAgICAgICBpZiAodGhpcy5wcm9wcy5pbWFnZSkge1xuXHQgICAgICAgICAgICAgICAgY2xhc3NTdHJpbmcgKz0gJyBjbGltYl9fdGlsZS0taGFzLW1lZGlhIGNsaW1iX190aWxlLS1oYXMtaW1hZ2UnO1xuXHQgICAgICAgICAgICB9XG5cdFxuXHQgICAgICAgICAgICBpZiAodGhpcy5wcm9wcy52aWRlb191cmwpIHtcblx0ICAgICAgICAgICAgICAgIGNsYXNzU3RyaW5nICs9ICcgY2xpbWJfX3RpbGUtLWhhcy1tZWRpYSBjbGltYl9fdGlsZS0taGFzLXZpZGVvJztcblx0ICAgICAgICAgICAgfVxuXHRcblx0ICAgICAgICAgICAgcmV0dXJuIGNsYXNzU3RyaW5nO1xuXHQgICAgICAgIH1cblx0ICAgIH0sIHtcblx0ICAgICAgICBrZXk6ICdyZW5kZXInLFxuXHQgICAgICAgIHZhbHVlOiBmdW5jdGlvbiByZW5kZXIoKSB7XG5cdFxuXHQgICAgICAgICAgICB2YXIgaW1hZ2UgPSB0aGlzLmNyZWF0ZUltYWdlKCk7XG5cdCAgICAgICAgICAgIHZhciBtZXNzYWdlID0gdGhpcy5jcmVhdGVNZXNzYWdlKCk7XG5cdCAgICAgICAgICAgIHZhciBpbnRlcmFjdGlvbiA9IHRoaXMuY3JlYXRlSW50ZXJhY3Rpb24oKTtcblx0ICAgICAgICAgICAgdmFyIGNsYXNzU3RyaW5nID0gdGhpcy5jcmVhdGVDbGFzc1N0cmluZygpO1xuXHQgICAgICAgICAgICB2YXIgYXV0aG9yID0gdGhpcy5wcm9wcy5hdXRob3I7XG5cdFxuXHQgICAgICAgICAgICByZXR1cm4gX3JlYWN0MlsnZGVmYXVsdCddLmNyZWF0ZUVsZW1lbnQoXG5cdCAgICAgICAgICAgICAgICAnZGl2Jyxcblx0ICAgICAgICAgICAgICAgIHsgY2xhc3NOYW1lOiBjbGFzc1N0cmluZyB9LFxuXHQgICAgICAgICAgICAgICAgX3JlYWN0MlsnZGVmYXVsdCddLmNyZWF0ZUVsZW1lbnQoXG5cdCAgICAgICAgICAgICAgICAgICAgJ2EnLFxuXHQgICAgICAgICAgICAgICAgICAgIHsgaHJlZjogdGhpcy5wcm9wcy5saW5rIH0sXG5cdCAgICAgICAgICAgICAgICAgICAgaW1hZ2Vcblx0ICAgICAgICAgICAgICAgICksXG5cdCAgICAgICAgICAgICAgICBfcmVhY3QyWydkZWZhdWx0J10uY3JlYXRlRWxlbWVudChcblx0ICAgICAgICAgICAgICAgICAgICAnZGl2Jyxcblx0ICAgICAgICAgICAgICAgICAgICB7IGNsYXNzTmFtZTogJ2NsaW1iX190aWxlX19jb250ZW50JyB9LFxuXHQgICAgICAgICAgICAgICAgICAgIG1lc3NhZ2Vcblx0ICAgICAgICAgICAgICAgICksXG5cdCAgICAgICAgICAgICAgICBfcmVhY3QyWydkZWZhdWx0J10uY3JlYXRlRWxlbWVudChfQXV0aG9yMlsnZGVmYXVsdCddLCBhdXRob3IpLFxuXHQgICAgICAgICAgICAgICAgX3JlYWN0MlsnZGVmYXVsdCddLmNyZWF0ZUVsZW1lbnQoXG5cdCAgICAgICAgICAgICAgICAgICAgJ2RpdicsXG5cdCAgICAgICAgICAgICAgICAgICAgeyBjbGFzc05hbWU6ICdjbGltYl9fdGlsZV9faW50ZXJhY3Rpb24nIH0sXG5cdCAgICAgICAgICAgICAgICAgICAgaW50ZXJhY3Rpb25cblx0ICAgICAgICAgICAgICAgIClcblx0ICAgICAgICAgICAgKTtcblx0ICAgICAgICB9XG5cdCAgICB9XSk7XG5cdFxuXHQgICAgcmV0dXJuIFRpbGU7XG5cdH0pKF9yZWFjdDJbJ2RlZmF1bHQnXS5Db21wb25lbnQpO1xuXHRcblx0VGlsZS5wcm9wVHlwZXMgPSB7XG5cdFxuXHQgICAgLy8gUmVxdWlyZWQgYXR0cnNcblx0ICAgIGxpbms6IF9yZWFjdDJbJ2RlZmF1bHQnXS5Qcm9wVHlwZXMuc3RyaW5nLmlzUmVxdWlyZWQsXG5cdCAgICBzb3VyY2VfdHlwZTogX3JlYWN0MlsnZGVmYXVsdCddLlByb3BUeXBlcy5zdHJpbmcuaXNSZXF1aXJlZCxcblx0ICAgIHRpbWVzdGFtcDogX3JlYWN0MlsnZGVmYXVsdCddLlByb3BUeXBlcy5udW1iZXIuaXNSZXF1aXJlZCxcblx0ICAgIGF1dGhvcjogX3JlYWN0MlsnZGVmYXVsdCddLlByb3BUeXBlcy5zaGFwZSh7XG5cdCAgICAgICAgdXNlcm5hbWU6IF9yZWFjdDJbJ2RlZmF1bHQnXS5Qcm9wVHlwZXMuc3RyaW5nLmlzUmVxdWlyZWQsXG5cdCAgICAgICAgcGljdHVyZTogX3JlYWN0MlsnZGVmYXVsdCddLlByb3BUeXBlcy5zdHJpbmcuaXNSZXF1aXJlZCxcblx0ICAgICAgICBsaW5rOiBfcmVhY3QyWydkZWZhdWx0J10uUHJvcFR5cGVzLnN0cmluZy5pc1JlcXVpcmVkXG5cdCAgICB9KSxcblx0XG5cdCAgICAvLyBPcHRpb25hbCBhdHRyc1xuXHQgICAgbWVzc2FnZTogX3JlYWN0MlsnZGVmYXVsdCddLlByb3BUeXBlcy5zdHJpbmcsXG5cdCAgICB2aWRlb19zcmM6IF9yZWFjdDJbJ2RlZmF1bHQnXS5Qcm9wVHlwZXMuc3RyaW5nLFxuXHQgICAgaW1hZ2U6IF9yZWFjdDJbJ2RlZmF1bHQnXS5Qcm9wVHlwZXMuc2hhcGUoe1xuXHQgICAgICAgIHVybDogX3JlYWN0MlsnZGVmYXVsdCddLlByb3BUeXBlcy5zdHJpbmcuaXNSZXF1aXJlZCxcblx0ICAgICAgICB3aWR0aDogX3JlYWN0MlsnZGVmYXVsdCddLlByb3BUeXBlcy5udW1iZXIuaXNSZXF1aXJlZCxcblx0ICAgICAgICBoZWlnaHQ6IF9yZWFjdDJbJ2RlZmF1bHQnXS5Qcm9wVHlwZXMubnVtYmVyLmlzUmVxdWlyZWRcblx0ICAgIH0pXG5cdFxuXHR9O1xuXHRcblx0ZXhwb3J0c1snZGVmYXVsdCddID0gVGlsZTtcblx0bW9kdWxlLmV4cG9ydHMgPSBleHBvcnRzWydkZWZhdWx0J107XG5cbi8qKiovIH0sXG4vKiA3ICovXG4vKioqLyBmdW5jdGlvbihtb2R1bGUsIGV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pIHtcblxuXHQndXNlIHN0cmljdCc7XG5cdFxuXHRPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgJ19fZXNNb2R1bGUnLCB7XG5cdCAgICB2YWx1ZTogdHJ1ZVxuXHR9KTtcblx0XG5cdHZhciBfZXh0ZW5kcyA9IE9iamVjdC5hc3NpZ24gfHwgZnVuY3Rpb24gKHRhcmdldCkgeyBmb3IgKHZhciBpID0gMTsgaSA8IGFyZ3VtZW50cy5sZW5ndGg7IGkrKykgeyB2YXIgc291cmNlID0gYXJndW1lbnRzW2ldOyBmb3IgKHZhciBrZXkgaW4gc291cmNlKSB7IGlmIChPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwoc291cmNlLCBrZXkpKSB7IHRhcmdldFtrZXldID0gc291cmNlW2tleV07IH0gfSB9IHJldHVybiB0YXJnZXQ7IH07XG5cdFxuXHR2YXIgX2NyZWF0ZUNsYXNzID0gKGZ1bmN0aW9uICgpIHsgZnVuY3Rpb24gZGVmaW5lUHJvcGVydGllcyh0YXJnZXQsIHByb3BzKSB7IGZvciAodmFyIGkgPSAwOyBpIDwgcHJvcHMubGVuZ3RoOyBpKyspIHsgdmFyIGRlc2NyaXB0b3IgPSBwcm9wc1tpXTsgZGVzY3JpcHRvci5lbnVtZXJhYmxlID0gZGVzY3JpcHRvci5lbnVtZXJhYmxlIHx8IGZhbHNlOyBkZXNjcmlwdG9yLmNvbmZpZ3VyYWJsZSA9IHRydWU7IGlmICgndmFsdWUnIGluIGRlc2NyaXB0b3IpIGRlc2NyaXB0b3Iud3JpdGFibGUgPSB0cnVlOyBPYmplY3QuZGVmaW5lUHJvcGVydHkodGFyZ2V0LCBkZXNjcmlwdG9yLmtleSwgZGVzY3JpcHRvcik7IH0gfSByZXR1cm4gZnVuY3Rpb24gKENvbnN0cnVjdG9yLCBwcm90b1Byb3BzLCBzdGF0aWNQcm9wcykgeyBpZiAocHJvdG9Qcm9wcykgZGVmaW5lUHJvcGVydGllcyhDb25zdHJ1Y3Rvci5wcm90b3R5cGUsIHByb3RvUHJvcHMpOyBpZiAoc3RhdGljUHJvcHMpIGRlZmluZVByb3BlcnRpZXMoQ29uc3RydWN0b3IsIHN0YXRpY1Byb3BzKTsgcmV0dXJuIENvbnN0cnVjdG9yOyB9OyB9KSgpO1xuXHRcblx0dmFyIF9nZXQgPSBmdW5jdGlvbiBnZXQoX3gsIF94MiwgX3gzKSB7IHZhciBfYWdhaW4gPSB0cnVlOyBfZnVuY3Rpb246IHdoaWxlIChfYWdhaW4pIHsgdmFyIG9iamVjdCA9IF94LCBwcm9wZXJ0eSA9IF94MiwgcmVjZWl2ZXIgPSBfeDM7IGRlc2MgPSBwYXJlbnQgPSBnZXR0ZXIgPSB1bmRlZmluZWQ7IF9hZ2FpbiA9IGZhbHNlOyBpZiAob2JqZWN0ID09PSBudWxsKSBvYmplY3QgPSBGdW5jdGlvbi5wcm90b3R5cGU7IHZhciBkZXNjID0gT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcihvYmplY3QsIHByb3BlcnR5KTsgaWYgKGRlc2MgPT09IHVuZGVmaW5lZCkgeyB2YXIgcGFyZW50ID0gT2JqZWN0LmdldFByb3RvdHlwZU9mKG9iamVjdCk7IGlmIChwYXJlbnQgPT09IG51bGwpIHsgcmV0dXJuIHVuZGVmaW5lZDsgfSBlbHNlIHsgX3ggPSBwYXJlbnQ7IF94MiA9IHByb3BlcnR5OyBfeDMgPSByZWNlaXZlcjsgX2FnYWluID0gdHJ1ZTsgY29udGludWUgX2Z1bmN0aW9uOyB9IH0gZWxzZSBpZiAoJ3ZhbHVlJyBpbiBkZXNjKSB7IHJldHVybiBkZXNjLnZhbHVlOyB9IGVsc2UgeyB2YXIgZ2V0dGVyID0gZGVzYy5nZXQ7IGlmIChnZXR0ZXIgPT09IHVuZGVmaW5lZCkgeyByZXR1cm4gdW5kZWZpbmVkOyB9IHJldHVybiBnZXR0ZXIuY2FsbChyZWNlaXZlcik7IH0gfSB9O1xuXHRcblx0ZnVuY3Rpb24gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChvYmopIHsgcmV0dXJuIG9iaiAmJiBvYmouX19lc01vZHVsZSA/IG9iaiA6IHsgJ2RlZmF1bHQnOiBvYmogfTsgfVxuXHRcblx0ZnVuY3Rpb24gX29iamVjdFdpdGhvdXRQcm9wZXJ0aWVzKG9iaiwga2V5cykgeyB2YXIgdGFyZ2V0ID0ge307IGZvciAodmFyIGkgaW4gb2JqKSB7IGlmIChrZXlzLmluZGV4T2YoaSkgPj0gMCkgY29udGludWU7IGlmICghT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKG9iaiwgaSkpIGNvbnRpbnVlOyB0YXJnZXRbaV0gPSBvYmpbaV07IH0gcmV0dXJuIHRhcmdldDsgfVxuXHRcblx0ZnVuY3Rpb24gX2NsYXNzQ2FsbENoZWNrKGluc3RhbmNlLCBDb25zdHJ1Y3RvcikgeyBpZiAoIShpbnN0YW5jZSBpbnN0YW5jZW9mIENvbnN0cnVjdG9yKSkgeyB0aHJvdyBuZXcgVHlwZUVycm9yKCdDYW5ub3QgY2FsbCBhIGNsYXNzIGFzIGEgZnVuY3Rpb24nKTsgfSB9XG5cdFxuXHRmdW5jdGlvbiBfaW5oZXJpdHMoc3ViQ2xhc3MsIHN1cGVyQ2xhc3MpIHsgaWYgKHR5cGVvZiBzdXBlckNsYXNzICE9PSAnZnVuY3Rpb24nICYmIHN1cGVyQ2xhc3MgIT09IG51bGwpIHsgdGhyb3cgbmV3IFR5cGVFcnJvcignU3VwZXIgZXhwcmVzc2lvbiBtdXN0IGVpdGhlciBiZSBudWxsIG9yIGEgZnVuY3Rpb24sIG5vdCAnICsgdHlwZW9mIHN1cGVyQ2xhc3MpOyB9IHN1YkNsYXNzLnByb3RvdHlwZSA9IE9iamVjdC5jcmVhdGUoc3VwZXJDbGFzcyAmJiBzdXBlckNsYXNzLnByb3RvdHlwZSwgeyBjb25zdHJ1Y3RvcjogeyB2YWx1ZTogc3ViQ2xhc3MsIGVudW1lcmFibGU6IGZhbHNlLCB3cml0YWJsZTogdHJ1ZSwgY29uZmlndXJhYmxlOiB0cnVlIH0gfSk7IGlmIChzdXBlckNsYXNzKSBPYmplY3Quc2V0UHJvdG90eXBlT2YgPyBPYmplY3Quc2V0UHJvdG90eXBlT2Yoc3ViQ2xhc3MsIHN1cGVyQ2xhc3MpIDogc3ViQ2xhc3MuX19wcm90b19fID0gc3VwZXJDbGFzczsgfVxuXHRcblx0dmFyIF9yZWFjdCA9IF9fd2VicGFja19yZXF1aXJlX18oMSk7XG5cdFxuXHR2YXIgX3JlYWN0MiA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQoX3JlYWN0KTtcblx0XG5cdHZhciBfdXRpbHNDbGltYiA9IF9fd2VicGFja19yZXF1aXJlX18oOCk7XG5cdFxuXHR2YXIgX3V0aWxzQ2xpbWIyID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChfdXRpbHNDbGltYik7XG5cdFxuXHR2YXIgX1RpbGUgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDYpO1xuXHRcblx0dmFyIF9UaWxlMiA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQoX1RpbGUpO1xuXHRcblx0dmFyIFdhbGwgPSAoZnVuY3Rpb24gKF9SZWFjdCRDb21wb25lbnQpIHtcblx0ICAgIF9pbmhlcml0cyhXYWxsLCBfUmVhY3QkQ29tcG9uZW50KTtcblx0XG5cdCAgICBmdW5jdGlvbiBXYWxsKHByb3BzKSB7XG5cdCAgICAgICAgX2NsYXNzQ2FsbENoZWNrKHRoaXMsIFdhbGwpO1xuXHRcblx0ICAgICAgICBfZ2V0KE9iamVjdC5nZXRQcm90b3R5cGVPZihXYWxsLnByb3RvdHlwZSksICdjb25zdHJ1Y3RvcicsIHRoaXMpLmNhbGwodGhpcywgcHJvcHMpO1xuXHQgICAgICAgIHRoaXMuc3RhdGUgPSB7XG5cdCAgICAgICAgICAgIGl0ZW1zOiBbXVxuXHQgICAgICAgIH07XG5cdCAgICB9XG5cdFxuXHQgICAgX2NyZWF0ZUNsYXNzKFdhbGwsIFt7XG5cdCAgICAgICAga2V5OiAnaW5pdCcsXG5cdCAgICAgICAgdmFsdWU6IGZ1bmN0aW9uIGluaXQoKSB7XG5cdCAgICAgICAgICAgIHZhciBfdGhpcyA9IHRoaXM7XG5cdFxuXHQgICAgICAgICAgICBpZiAoIXRoaXMucHJvcHMuY29sbGVjdGlvbklkKSB7XG5cdCAgICAgICAgICAgICAgICByZXR1cm47XG5cdCAgICAgICAgICAgIH1cblx0XG5cdCAgICAgICAgICAgIF91dGlsc0NsaW1iMlsnZGVmYXVsdCddLmdldFN0cmVhbSh0aGlzLnByb3BzLmNvbGxlY3Rpb25JZCkuc3Vic2NyaWJlKGZ1bmN0aW9uIChpdGVtcykge1xuXHRcblx0ICAgICAgICAgICAgICAgIHZhciBtYXhTaXplID0gMzA7XG5cdFxuXHQgICAgICAgICAgICAgICAgX3RoaXMuc2V0U3RhdGUoe1xuXHQgICAgICAgICAgICAgICAgICAgIGl0ZW1zOiBpdGVtcy5zcGxpY2UoMCwgbWF4U2l6ZSlcblx0ICAgICAgICAgICAgICAgIH0pO1xuXHQgICAgICAgICAgICB9KTtcblx0ICAgICAgICB9XG5cdCAgICB9LCB7XG5cdCAgICAgICAga2V5OiAnY29tcG9uZW50RGlkTW91bnQnLFxuXHQgICAgICAgIHZhbHVlOiBmdW5jdGlvbiBjb21wb25lbnREaWRNb3VudCgpIHtcblx0ICAgICAgICAgICAgdGhpcy5pbml0KCk7XG5cdCAgICAgICAgfVxuXHQgICAgfSwge1xuXHQgICAgICAgIGtleTogJ2NvbXBvbmVudERpZFVwZGF0ZScsXG5cdCAgICAgICAgdmFsdWU6IGZ1bmN0aW9uIGNvbXBvbmVudERpZFVwZGF0ZSgpIHtcblx0ICAgICAgICAgICAgdmFyIGNiID0gdW5kZWZpbmVkO1xuXHQgICAgICAgICAgICBpZiAod2luZG93LkNsaW1iICYmIHdpbmRvdy5DbGltYi5vblVwZGF0ZSkge1xuXHQgICAgICAgICAgICAgICAgY2IgPSB3aW5kb3cuQ2xpbWIub25VcGRhdGU7XG5cdCAgICAgICAgICAgIH0gZWxzZSB7XG5cdCAgICAgICAgICAgICAgICAvLyBub29wXG5cdCAgICAgICAgICAgICAgICBjYiA9IGZ1bmN0aW9uICgpIHt9O1xuXHQgICAgICAgICAgICB9XG5cdCAgICAgICAgICAgIGNiKCk7XG5cdCAgICAgICAgfVxuXHQgICAgfSwge1xuXHQgICAgICAgIGtleTogJ3JlbmRlcicsXG5cdCAgICAgICAgdmFsdWU6IGZ1bmN0aW9uIHJlbmRlcigpIHtcblx0ICAgICAgICAgICAgdmFyIHRpbGVzID0gW107XG5cdCAgICAgICAgICAgIHRoaXMuc3RhdGUuaXRlbXMubWFwKGZ1bmN0aW9uIChpdGVtKSB7XG5cdFxuXHQgICAgICAgICAgICAgICAgLy8gV2hhdCdzIHdpdGggdGhlIGAuLi5gP1xuXHQgICAgICAgICAgICAgICAgLy8gSXQncyBFUzYuXG5cdCAgICAgICAgICAgICAgICAvLyBodHRwczovL2ZhY2Vib29rLmdpdGh1Yi5pby9yZWFjdC9kb2NzL3RyYW5zZmVycmluZy1wcm9wcy5odG1sI3RyYW5zZmVycmluZy13aXRoLS4uLi1pbi1qc3hcblx0ICAgICAgICAgICAgICAgIHZhciBpZCA9IGl0ZW0uaWQ7XG5cdFxuXHQgICAgICAgICAgICAgICAgdmFyIG90aGVyUHJvcHMgPSBfb2JqZWN0V2l0aG91dFByb3BlcnRpZXMoaXRlbSwgWydpZCddKTtcblx0XG5cdCAgICAgICAgICAgICAgICB0aWxlcy5wdXNoKF9yZWFjdDJbJ2RlZmF1bHQnXS5jcmVhdGVFbGVtZW50KF9UaWxlMlsnZGVmYXVsdCddLCBfZXh0ZW5kcyh7IGtleTogaWRcblx0ICAgICAgICAgICAgICAgIH0sIG90aGVyUHJvcHMpKSk7XG5cdCAgICAgICAgICAgIH0pO1xuXHRcblx0ICAgICAgICAgICAgcmV0dXJuIF9yZWFjdDJbJ2RlZmF1bHQnXS5jcmVhdGVFbGVtZW50KFxuXHQgICAgICAgICAgICAgICAgJ2RpdicsXG5cdCAgICAgICAgICAgICAgICB7IGNsYXNzTmFtZTogJ2NsaW1iX193YWxsJyB9LFxuXHQgICAgICAgICAgICAgICAgdGlsZXNcblx0ICAgICAgICAgICAgKTtcblx0ICAgICAgICB9XG5cdCAgICB9XSk7XG5cdFxuXHQgICAgcmV0dXJuIFdhbGw7XG5cdH0pKF9yZWFjdDJbJ2RlZmF1bHQnXS5Db21wb25lbnQpO1xuXHRcblx0V2FsbC5kaXNwbGF5TmFtZSA9ICdXYWxsJztcblx0V2FsbC5wcm9wVHlwZXMgPSB7XG5cdCAgICBjb2xsZWN0aW9uSWQ6IF9yZWFjdDJbJ2RlZmF1bHQnXS5Qcm9wVHlwZXMuc3RyaW5nLmlzUmVxdWlyZWQsXG5cdCAgICBsaW1pdDogX3JlYWN0MlsnZGVmYXVsdCddLlByb3BUeXBlcy5udW1iZXJcblx0fTtcblx0XG5cdGV4cG9ydHNbJ2RlZmF1bHQnXSA9IFdhbGw7XG5cdG1vZHVsZS5leHBvcnRzID0gZXhwb3J0c1snZGVmYXVsdCddO1xuXG4vKioqLyB9LFxuLyogOCAqL1xuLyoqKi8gZnVuY3Rpb24obW9kdWxlLCBleHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSB7XG5cblx0J3VzZSBzdHJpY3QnO1xuXHRcblx0T2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICdfX2VzTW9kdWxlJywge1xuXHQgICAgdmFsdWU6IHRydWVcblx0fSk7XG5cdFxuXHRmdW5jdGlvbiBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KG9iaikgeyByZXR1cm4gb2JqICYmIG9iai5fX2VzTW9kdWxlID8gb2JqIDogeyAnZGVmYXVsdCc6IG9iaiB9OyB9XG5cdFxuXHR2YXIgX3J4ID0gX193ZWJwYWNrX3JlcXVpcmVfXygxMCk7XG5cdFxuXHR2YXIgX3J4MiA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQoX3J4KTtcblx0XG5cdHZhciBfZmV0Y2hKc29ucCA9IF9fd2VicGFja19yZXF1aXJlX18oOSk7XG5cdFxuXHR2YXIgX2ZldGNoSnNvbnAyID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChfZmV0Y2hKc29ucCk7XG5cdFxuXHR2YXIgZ2V0U3RyZWFtID0gZnVuY3Rpb24gZ2V0U3RyZWFtKGNvbGxlY3Rpb25JZCkge1xuXHRcblx0ICAgIHZhciBwb2xsUmF0ZSA9IDUgKiAxMDAwO1xuXHRcblx0ICAgIHZhciByZXF1ZXN0U3RyZWFtID0gX3J4MlsnZGVmYXVsdCddLk9ic2VydmFibGUuanVzdCgnaHR0cDovL2FwcC5jbGltYi5zb2NpYWwvYXBpL3YxL2NvbGxlY3Rpb25zLycgKyBjb2xsZWN0aW9uSWQpO1xuXHRcblx0ICAgIHZhciB1cGRhdGVTdHJlYW0gPSBfcngyWydkZWZhdWx0J10uT2JzZXJ2YWJsZS5pbnRlcnZhbChwb2xsUmF0ZSkuc3RhcnRXaXRoKG51bGwpO1xuXHRcblx0ICAgIHZhciByZXNwb25zZVN0cmVhbSA9IHVwZGF0ZVN0cmVhbS5jb21iaW5lTGF0ZXN0KHJlcXVlc3RTdHJlYW0sIGZ1bmN0aW9uICh0aWNrLCB1cmwpIHtcblx0ICAgICAgICByZXR1cm4gdXJsO1xuXHQgICAgfSkuZmxhdE1hcChmdW5jdGlvbiAoYmFzZVVybCkge1xuXHRcblx0ICAgICAgICB2YXIgcmVxdWVzdFVybCA9ICcnICsgYmFzZVVybDtcblx0XG5cdCAgICAgICAgcmV0dXJuIF9yeDJbJ2RlZmF1bHQnXS5PYnNlcnZhYmxlLmZyb21Qcm9taXNlKCgwLCBfZmV0Y2hKc29ucDJbJ2RlZmF1bHQnXSkocmVxdWVzdFVybCkudGhlbihmdW5jdGlvbiAocmVzcCkge1xuXHQgICAgICAgICAgICByZXR1cm4gcmVzcC5qc29uKCk7XG5cdCAgICAgICAgfSkpO1xuXHQgICAgfSk7XG5cdFxuXHQgICAgcmV0dXJuIHJlc3BvbnNlU3RyZWFtO1xuXHR9O1xuXHRcblx0dmFyIGNsaW1iID0ge1xuXHQgICAgZ2V0U3RyZWFtOiBnZXRTdHJlYW1cblx0fTtcblx0XG5cdGV4cG9ydHNbJ2RlZmF1bHQnXSA9IGNsaW1iO1xuXHRtb2R1bGUuZXhwb3J0cyA9IGV4cG9ydHNbJ2RlZmF1bHQnXTtcblxuLyoqKi8gfSxcbi8qIDkgKi9cbi8qKiovIGZ1bmN0aW9uKG1vZHVsZSwgZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykge1xuXG5cdHZhciBfX1dFQlBBQ0tfQU1EX0RFRklORV9GQUNUT1JZX18sIF9fV0VCUEFDS19BTURfREVGSU5FX0FSUkFZX18sIF9fV0VCUEFDS19BTURfREVGSU5FX1JFU1VMVF9fOyhmdW5jdGlvbiAoZ2xvYmFsLCBmYWN0b3J5KSB7XG5cdCAgaWYgKHRydWUpIHtcblx0ICAgICEoX19XRUJQQUNLX0FNRF9ERUZJTkVfQVJSQVlfXyA9IFtleHBvcnRzLCBtb2R1bGVdLCBfX1dFQlBBQ0tfQU1EX0RFRklORV9GQUNUT1JZX18gPSAoZmFjdG9yeSksIF9fV0VCUEFDS19BTURfREVGSU5FX1JFU1VMVF9fID0gKHR5cGVvZiBfX1dFQlBBQ0tfQU1EX0RFRklORV9GQUNUT1JZX18gPT09ICdmdW5jdGlvbicgPyAoX19XRUJQQUNLX0FNRF9ERUZJTkVfRkFDVE9SWV9fLmFwcGx5KGV4cG9ydHMsIF9fV0VCUEFDS19BTURfREVGSU5FX0FSUkFZX18pKSA6IF9fV0VCUEFDS19BTURfREVGSU5FX0ZBQ1RPUllfXyksIF9fV0VCUEFDS19BTURfREVGSU5FX1JFU1VMVF9fICE9PSB1bmRlZmluZWQgJiYgKG1vZHVsZS5leHBvcnRzID0gX19XRUJQQUNLX0FNRF9ERUZJTkVfUkVTVUxUX18pKTtcblx0ICB9IGVsc2UgaWYgKHR5cGVvZiBleHBvcnRzICE9PSAndW5kZWZpbmVkJyAmJiB0eXBlb2YgbW9kdWxlICE9PSAndW5kZWZpbmVkJykge1xuXHQgICAgZmFjdG9yeShleHBvcnRzLCBtb2R1bGUpO1xuXHQgIH0gZWxzZSB7XG5cdCAgICB2YXIgbW9kID0ge1xuXHQgICAgICBleHBvcnRzOiB7fVxuXHQgICAgfTtcblx0ICAgIGZhY3RvcnkobW9kLmV4cG9ydHMsIG1vZCk7XG5cdCAgICBnbG9iYWwuZmV0Y2hKc29ucCA9IG1vZC5leHBvcnRzO1xuXHQgIH1cblx0fSkodGhpcywgZnVuY3Rpb24gKGV4cG9ydHMsIG1vZHVsZSkge1xuXHQgICd1c2Ugc3RyaWN0Jztcblx0XG5cdCAgdmFyIGRlZmF1bHRPcHRpb25zID0ge1xuXHQgICAgdGltZW91dDogNTAwMCxcblx0ICAgIGpzb25wQ2FsbGJhY2s6ICdjYWxsYmFjaydcblx0ICB9O1xuXHRcblx0ICBmdW5jdGlvbiBnZW5lcmF0ZUNhbGxiYWNrRnVuY3Rpb24oKSB7XG5cdCAgICByZXR1cm4gJ2pzb25wXycgKyBEYXRlLm5vdygpICsgJ18nICsgTWF0aC5jZWlsKE1hdGgucmFuZG9tKCkgKiAxMDAwMDApO1xuXHQgIH1cblx0XG5cdCAgLy8gS25vd24gaXNzdWU6IFdpbGwgdGhyb3cgJ1VuY2F1Z2h0IFJlZmVyZW5jZUVycm9yOiBjYWxsYmFja18qKiogaXMgbm90IGRlZmluZWQnIGVycm9yIGlmIHJlcXVlc3QgdGltZW91dFxuXHQgIGZ1bmN0aW9uIGNsZWFyRnVuY3Rpb24oZnVuY3Rpb25OYW1lKSB7XG5cdCAgICAvLyBJRTggdGhyb3dzIGFuIGV4Y2VwdGlvbiB3aGVuIHlvdSB0cnkgdG8gZGVsZXRlIGEgcHJvcGVydHkgb24gd2luZG93XG5cdCAgICAvLyBodHRwOi8vc3RhY2tvdmVyZmxvdy5jb20vYS8xODI0MjI4Lzc1MTA4OVxuXHQgICAgdHJ5IHtcblx0ICAgICAgZGVsZXRlIHdpbmRvd1tmdW5jdGlvbk5hbWVdO1xuXHQgICAgfSBjYXRjaCAoZSkge1xuXHQgICAgICB3aW5kb3dbZnVuY3Rpb25OYW1lXSA9IHVuZGVmaW5lZDtcblx0ICAgIH1cblx0ICB9XG5cdFxuXHQgIGZ1bmN0aW9uIHJlbW92ZVNjcmlwdChzY3JpcHRJZCkge1xuXHQgICAgdmFyIHNjcmlwdCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKHNjcmlwdElkKTtcblx0ICAgIGRvY3VtZW50LmdldEVsZW1lbnRzQnlUYWdOYW1lKFwiaGVhZFwiKVswXS5yZW1vdmVDaGlsZChzY3JpcHQpO1xuXHQgIH1cblx0XG5cdCAgdmFyIGZldGNoSnNvbnAgPSBmdW5jdGlvbiBmZXRjaEpzb25wKHVybCkge1xuXHQgICAgdmFyIG9wdGlvbnMgPSBhcmd1bWVudHMubGVuZ3RoIDw9IDEgfHwgYXJndW1lbnRzWzFdID09PSB1bmRlZmluZWQgPyB7fSA6IGFyZ3VtZW50c1sxXTtcblx0XG5cdCAgICB2YXIgdGltZW91dCA9IG9wdGlvbnMudGltZW91dCAhPSBudWxsID8gb3B0aW9ucy50aW1lb3V0IDogZGVmYXVsdE9wdGlvbnMudGltZW91dDtcblx0ICAgIHZhciBqc29ucENhbGxiYWNrID0gb3B0aW9ucy5qc29ucENhbGxiYWNrICE9IG51bGwgPyBvcHRpb25zLmpzb25wQ2FsbGJhY2sgOiBkZWZhdWx0T3B0aW9ucy5qc29ucENhbGxiYWNrO1xuXHRcblx0ICAgIHZhciB0aW1lb3V0SWQgPSB1bmRlZmluZWQ7XG5cdFxuXHQgICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHtcblx0ICAgICAgdmFyIGNhbGxiYWNrRnVuY3Rpb24gPSBnZW5lcmF0ZUNhbGxiYWNrRnVuY3Rpb24oKTtcblx0XG5cdCAgICAgIHdpbmRvd1tjYWxsYmFja0Z1bmN0aW9uXSA9IGZ1bmN0aW9uIChyZXNwb25zZSkge1xuXHQgICAgICAgIHJlc29sdmUoe1xuXHQgICAgICAgICAgb2s6IHRydWUsXG5cdCAgICAgICAgICAvLyBrZWVwIGNvbnNpc3RlbnQgd2l0aCBmZXRjaCBBUElcblx0ICAgICAgICAgIGpzb246IGZ1bmN0aW9uIGpzb24oKSB7XG5cdCAgICAgICAgICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUocmVzcG9uc2UpO1xuXHQgICAgICAgICAgfVxuXHQgICAgICAgIH0pO1xuXHRcblx0ICAgICAgICBpZiAodGltZW91dElkKSBjbGVhclRpbWVvdXQodGltZW91dElkKTtcblx0XG5cdCAgICAgICAgcmVtb3ZlU2NyaXB0KGpzb25wQ2FsbGJhY2sgKyAnXycgKyBjYWxsYmFja0Z1bmN0aW9uKTtcblx0XG5cdCAgICAgICAgY2xlYXJGdW5jdGlvbihjYWxsYmFja0Z1bmN0aW9uKTtcblx0ICAgICAgfTtcblx0XG5cdCAgICAgIC8vIENoZWNrIGlmIHRoZSB1c2VyIHNldCB0aGVpciBvd24gcGFyYW1zLCBhbmQgaWYgbm90IGFkZCBhID8gdG8gc3RhcnQgYSBsaXN0IG9mIHBhcmFtc1xuXHQgICAgICB1cmwgKz0gdXJsLmluZGV4T2YoJz8nKSA9PT0gLTEgPyAnPycgOiAnJic7XG5cdFxuXHQgICAgICB2YXIganNvbnBTY3JpcHQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdzY3JpcHQnKTtcblx0ICAgICAganNvbnBTY3JpcHQuc2V0QXR0cmlidXRlKFwic3JjXCIsIHVybCArIGpzb25wQ2FsbGJhY2sgKyAnPScgKyBjYWxsYmFja0Z1bmN0aW9uKTtcblx0ICAgICAganNvbnBTY3JpcHQuaWQgPSBqc29ucENhbGxiYWNrICsgJ18nICsgY2FsbGJhY2tGdW5jdGlvbjtcblx0ICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudHNCeVRhZ05hbWUoXCJoZWFkXCIpWzBdLmFwcGVuZENoaWxkKGpzb25wU2NyaXB0KTtcblx0XG5cdCAgICAgIHRpbWVvdXRJZCA9IHNldFRpbWVvdXQoZnVuY3Rpb24gKCkge1xuXHQgICAgICAgIHJlamVjdChuZXcgRXJyb3IoJ0pTT05QIHJlcXVlc3QgdG8gJyArIHVybCArICcgdGltZWQgb3V0JykpO1xuXHRcblx0ICAgICAgICBjbGVhckZ1bmN0aW9uKGNhbGxiYWNrRnVuY3Rpb24pO1xuXHQgICAgICAgIHJlbW92ZVNjcmlwdChqc29ucENhbGxiYWNrICsgJ18nICsgY2FsbGJhY2tGdW5jdGlvbik7XG5cdCAgICAgIH0sIHRpbWVvdXQpO1xuXHQgICAgfSk7XG5cdCAgfTtcblx0XG5cdCAgLy8gZXhwb3J0IGFzIGdsb2JhbCBmdW5jdGlvblxuXHQgIC8qXG5cdCAgbGV0IGxvY2FsO1xuXHQgIGlmICh0eXBlb2YgZ2xvYmFsICE9PSAndW5kZWZpbmVkJykge1xuXHQgICAgbG9jYWwgPSBnbG9iYWw7XG5cdCAgfSBlbHNlIGlmICh0eXBlb2Ygc2VsZiAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0ICAgIGxvY2FsID0gc2VsZjtcblx0ICB9IGVsc2Uge1xuXHQgICAgdHJ5IHtcblx0ICAgICAgbG9jYWwgPSBGdW5jdGlvbigncmV0dXJuIHRoaXMnKSgpO1xuXHQgICAgfSBjYXRjaCAoZSkge1xuXHQgICAgICB0aHJvdyBuZXcgRXJyb3IoJ3BvbHlmaWxsIGZhaWxlZCBiZWNhdXNlIGdsb2JhbCBvYmplY3QgaXMgdW5hdmFpbGFibGUgaW4gdGhpcyBlbnZpcm9ubWVudCcpO1xuXHQgICAgfVxuXHQgIH1cblx0ICBcblx0ICBsb2NhbC5mZXRjaEpzb25wID0gZmV0Y2hKc29ucDtcblx0ICAqL1xuXHRcblx0ICBtb2R1bGUuZXhwb3J0cyA9IGZldGNoSnNvbnA7XG5cdH0pO1xuXG4vKioqLyB9LFxuLyogMTAgKi9cbi8qKiovIGZ1bmN0aW9uKG1vZHVsZSwgZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykge1xuXG5cdHZhciBfX1dFQlBBQ0tfQU1EX0RFRklORV9SRVNVTFRfXzsvKiBXRUJQQUNLIFZBUiBJTkpFQ1RJT04gKi8oZnVuY3Rpb24obW9kdWxlLCBnbG9iYWwsIHByb2Nlc3MpIHsvLyBDb3B5cmlnaHQgKGMpIE1pY3Jvc29mdCBPcGVuIFRlY2hub2xvZ2llcywgSW5jLiBBbGwgcmlnaHRzIHJlc2VydmVkLiBTZWUgTGljZW5zZS50eHQgaW4gdGhlIHByb2plY3Qgcm9vdCBmb3IgbGljZW5zZSBpbmZvcm1hdGlvbi5cblx0XG5cdDsoZnVuY3Rpb24gKHVuZGVmaW5lZCkge1xuXHRcblx0ICB2YXIgb2JqZWN0VHlwZXMgPSB7XG5cdCAgICAnZnVuY3Rpb24nOiB0cnVlLFxuXHQgICAgJ29iamVjdCc6IHRydWVcblx0ICB9O1xuXHRcblx0ICB2YXJcblx0ICAgIGZyZWVFeHBvcnRzID0gb2JqZWN0VHlwZXNbdHlwZW9mIGV4cG9ydHNdICYmIGV4cG9ydHMgJiYgIWV4cG9ydHMubm9kZVR5cGUgJiYgZXhwb3J0cyxcblx0ICAgIGZyZWVTZWxmID0gb2JqZWN0VHlwZXNbdHlwZW9mIHNlbGZdICYmIHNlbGYuT2JqZWN0ICYmIHNlbGYsXG5cdCAgICBmcmVlV2luZG93ID0gb2JqZWN0VHlwZXNbdHlwZW9mIHdpbmRvd10gJiYgd2luZG93ICYmIHdpbmRvdy5PYmplY3QgJiYgd2luZG93LFxuXHQgICAgZnJlZU1vZHVsZSA9IG9iamVjdFR5cGVzW3R5cGVvZiBtb2R1bGVdICYmIG1vZHVsZSAmJiAhbW9kdWxlLm5vZGVUeXBlICYmIG1vZHVsZSxcblx0ICAgIG1vZHVsZUV4cG9ydHMgPSBmcmVlTW9kdWxlICYmIGZyZWVNb2R1bGUuZXhwb3J0cyA9PT0gZnJlZUV4cG9ydHMgJiYgZnJlZUV4cG9ydHMsXG5cdCAgICBmcmVlR2xvYmFsID0gZnJlZUV4cG9ydHMgJiYgZnJlZU1vZHVsZSAmJiB0eXBlb2YgZ2xvYmFsID09ICdvYmplY3QnICYmIGdsb2JhbCAmJiBnbG9iYWwuT2JqZWN0ICYmIGdsb2JhbDtcblx0XG5cdCAgdmFyIHJvb3QgPSByb290ID0gZnJlZUdsb2JhbCB8fCAoKGZyZWVXaW5kb3cgIT09ICh0aGlzICYmIHRoaXMud2luZG93KSkgJiYgZnJlZVdpbmRvdykgfHwgZnJlZVNlbGYgfHwgdGhpcztcblx0XG5cdCAgdmFyIFJ4ID0ge1xuXHQgICAgaW50ZXJuYWxzOiB7fSxcblx0ICAgIGNvbmZpZzoge1xuXHQgICAgICBQcm9taXNlOiByb290LlByb21pc2Vcblx0ICAgIH0sXG5cdCAgICBoZWxwZXJzOiB7IH1cblx0ICB9O1xuXHRcblx0ICAvLyBEZWZhdWx0c1xuXHQgIHZhciBub29wID0gUnguaGVscGVycy5ub29wID0gZnVuY3Rpb24gKCkgeyB9LFxuXHQgICAgaWRlbnRpdHkgPSBSeC5oZWxwZXJzLmlkZW50aXR5ID0gZnVuY3Rpb24gKHgpIHsgcmV0dXJuIHg7IH0sXG5cdCAgICBkZWZhdWx0Tm93ID0gUnguaGVscGVycy5kZWZhdWx0Tm93ID0gRGF0ZS5ub3csXG5cdCAgICBkZWZhdWx0Q29tcGFyZXIgPSBSeC5oZWxwZXJzLmRlZmF1bHRDb21wYXJlciA9IGZ1bmN0aW9uICh4LCB5KSB7IHJldHVybiBpc0VxdWFsKHgsIHkpOyB9LFxuXHQgICAgZGVmYXVsdFN1YkNvbXBhcmVyID0gUnguaGVscGVycy5kZWZhdWx0U3ViQ29tcGFyZXIgPSBmdW5jdGlvbiAoeCwgeSkgeyByZXR1cm4geCA+IHkgPyAxIDogKHggPCB5ID8gLTEgOiAwKTsgfSxcblx0ICAgIGRlZmF1bHRLZXlTZXJpYWxpemVyID0gUnguaGVscGVycy5kZWZhdWx0S2V5U2VyaWFsaXplciA9IGZ1bmN0aW9uICh4KSB7IHJldHVybiB4LnRvU3RyaW5nKCk7IH0sXG5cdCAgICBkZWZhdWx0RXJyb3IgPSBSeC5oZWxwZXJzLmRlZmF1bHRFcnJvciA9IGZ1bmN0aW9uIChlcnIpIHsgdGhyb3cgZXJyOyB9LFxuXHQgICAgaXNQcm9taXNlID0gUnguaGVscGVycy5pc1Byb21pc2UgPSBmdW5jdGlvbiAocCkgeyByZXR1cm4gISFwICYmIHR5cGVvZiBwLnN1YnNjcmliZSAhPT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YgcC50aGVuID09PSAnZnVuY3Rpb24nOyB9LFxuXHQgICAgaXNGdW5jdGlvbiA9IFJ4LmhlbHBlcnMuaXNGdW5jdGlvbiA9IChmdW5jdGlvbiAoKSB7XG5cdFxuXHQgICAgICB2YXIgaXNGbiA9IGZ1bmN0aW9uICh2YWx1ZSkge1xuXHQgICAgICAgIHJldHVybiB0eXBlb2YgdmFsdWUgPT0gJ2Z1bmN0aW9uJyB8fCBmYWxzZTtcblx0ICAgICAgfVxuXHRcblx0ICAgICAgLy8gZmFsbGJhY2sgZm9yIG9sZGVyIHZlcnNpb25zIG9mIENocm9tZSBhbmQgU2FmYXJpXG5cdCAgICAgIGlmIChpc0ZuKC94LykpIHtcblx0ICAgICAgICBpc0ZuID0gZnVuY3Rpb24odmFsdWUpIHtcblx0ICAgICAgICAgIHJldHVybiB0eXBlb2YgdmFsdWUgPT0gJ2Z1bmN0aW9uJyAmJiB0b1N0cmluZy5jYWxsKHZhbHVlKSA9PSAnW29iamVjdCBGdW5jdGlvbl0nO1xuXHQgICAgICAgIH07XG5cdCAgICAgIH1cblx0XG5cdCAgICAgIHJldHVybiBpc0ZuO1xuXHQgICAgfSgpKTtcblx0XG5cdCAgZnVuY3Rpb24gY2xvbmVBcnJheShhcnIpIHsgZm9yKHZhciBhID0gW10sIGkgPSAwLCBsZW4gPSBhcnIubGVuZ3RoOyBpIDwgbGVuOyBpKyspIHsgYS5wdXNoKGFycltpXSk7IH0gcmV0dXJuIGE7fVxuXHRcblx0ICB2YXIgZXJyb3JPYmogPSB7ZToge319O1xuXHQgIFxuXHQgIGZ1bmN0aW9uIHRyeUNhdGNoZXJHZW4odHJ5Q2F0Y2hUYXJnZXQpIHtcblx0ICAgIHJldHVybiBmdW5jdGlvbiB0cnlDYXRjaGVyKCkge1xuXHQgICAgICB0cnkge1xuXHQgICAgICAgIHJldHVybiB0cnlDYXRjaFRhcmdldC5hcHBseSh0aGlzLCBhcmd1bWVudHMpO1xuXHQgICAgICB9IGNhdGNoIChlKSB7XG5cdCAgICAgICAgZXJyb3JPYmouZSA9IGU7XG5cdCAgICAgICAgcmV0dXJuIGVycm9yT2JqO1xuXHQgICAgICB9XG5cdCAgICB9O1xuXHQgIH1cblx0XG5cdCAgdmFyIHRyeUNhdGNoID0gUnguaW50ZXJuYWxzLnRyeUNhdGNoID0gZnVuY3Rpb24gdHJ5Q2F0Y2goZm4pIHtcblx0ICAgIGlmICghaXNGdW5jdGlvbihmbikpIHsgdGhyb3cgbmV3IFR5cGVFcnJvcignZm4gbXVzdCBiZSBhIGZ1bmN0aW9uJyk7IH1cblx0ICAgIHJldHVybiB0cnlDYXRjaGVyR2VuKGZuKTtcblx0ICB9O1xuXHRcblx0ICBmdW5jdGlvbiB0aHJvd2VyKGUpIHtcblx0ICAgIHRocm93IGU7XG5cdCAgfVxuXHRcblx0ICBSeC5jb25maWcubG9uZ1N0YWNrU3VwcG9ydCA9IGZhbHNlO1xuXHQgIHZhciBoYXNTdGFja3MgPSBmYWxzZSwgc3RhY2tzID0gdHJ5Q2F0Y2goZnVuY3Rpb24gKCkgeyB0aHJvdyBuZXcgRXJyb3IoKTsgfSkoKTtcblx0ICBoYXNTdGFja3MgPSAhIXN0YWNrcy5lICYmICEhc3RhY2tzLmUuc3RhY2s7XG5cdFxuXHQgIC8vIEFsbCBjb2RlIGFmdGVyIHRoaXMgcG9pbnQgd2lsbCBiZSBmaWx0ZXJlZCBmcm9tIHN0YWNrIHRyYWNlcyByZXBvcnRlZCBieSBSeEpTXG5cdCAgdmFyIHJTdGFydGluZ0xpbmUgPSBjYXB0dXJlTGluZSgpLCByRmlsZU5hbWU7XG5cdFxuXHQgIHZhciBTVEFDS19KVU1QX1NFUEFSQVRPUiA9ICdGcm9tIHByZXZpb3VzIGV2ZW50Oic7XG5cdFxuXHQgIGZ1bmN0aW9uIG1ha2VTdGFja1RyYWNlTG9uZyhlcnJvciwgb2JzZXJ2YWJsZSkge1xuXHQgICAgLy8gSWYgcG9zc2libGUsIHRyYW5zZm9ybSB0aGUgZXJyb3Igc3RhY2sgdHJhY2UgYnkgcmVtb3ZpbmcgTm9kZSBhbmQgUnhKU1xuXHQgICAgLy8gY3J1ZnQsIHRoZW4gY29uY2F0ZW5hdGluZyB3aXRoIHRoZSBzdGFjayB0cmFjZSBvZiBgb2JzZXJ2YWJsZWAuXG5cdCAgICBpZiAoaGFzU3RhY2tzICYmXG5cdCAgICAgICAgb2JzZXJ2YWJsZS5zdGFjayAmJlxuXHQgICAgICAgIHR5cGVvZiBlcnJvciA9PT0gJ29iamVjdCcgJiZcblx0ICAgICAgICBlcnJvciAhPT0gbnVsbCAmJlxuXHQgICAgICAgIGVycm9yLnN0YWNrICYmXG5cdCAgICAgICAgZXJyb3Iuc3RhY2suaW5kZXhPZihTVEFDS19KVU1QX1NFUEFSQVRPUikgPT09IC0xXG5cdCAgICApIHtcblx0ICAgICAgdmFyIHN0YWNrcyA9IFtdO1xuXHQgICAgICBmb3IgKHZhciBvID0gb2JzZXJ2YWJsZTsgISFvOyBvID0gby5zb3VyY2UpIHtcblx0ICAgICAgICBpZiAoby5zdGFjaykge1xuXHQgICAgICAgICAgc3RhY2tzLnVuc2hpZnQoby5zdGFjayk7XG5cdCAgICAgICAgfVxuXHQgICAgICB9XG5cdCAgICAgIHN0YWNrcy51bnNoaWZ0KGVycm9yLnN0YWNrKTtcblx0XG5cdCAgICAgIHZhciBjb25jYXRlZFN0YWNrcyA9IHN0YWNrcy5qb2luKCdcXG4nICsgU1RBQ0tfSlVNUF9TRVBBUkFUT1IgKyAnXFxuJyk7XG5cdCAgICAgIGVycm9yLnN0YWNrID0gZmlsdGVyU3RhY2tTdHJpbmcoY29uY2F0ZWRTdGFja3MpO1xuXHQgICAgfVxuXHQgIH1cblx0XG5cdCAgZnVuY3Rpb24gZmlsdGVyU3RhY2tTdHJpbmcoc3RhY2tTdHJpbmcpIHtcblx0ICAgIHZhciBsaW5lcyA9IHN0YWNrU3RyaW5nLnNwbGl0KCdcXG4nKSwgZGVzaXJlZExpbmVzID0gW107XG5cdCAgICBmb3IgKHZhciBpID0gMCwgbGVuID0gbGluZXMubGVuZ3RoOyBpIDwgbGVuOyBpKyspIHtcblx0ICAgICAgdmFyIGxpbmUgPSBsaW5lc1tpXTtcblx0XG5cdCAgICAgIGlmICghaXNJbnRlcm5hbEZyYW1lKGxpbmUpICYmICFpc05vZGVGcmFtZShsaW5lKSAmJiBsaW5lKSB7XG5cdCAgICAgICAgZGVzaXJlZExpbmVzLnB1c2gobGluZSk7XG5cdCAgICAgIH1cblx0ICAgIH1cblx0ICAgIHJldHVybiBkZXNpcmVkTGluZXMuam9pbignXFxuJyk7XG5cdCAgfVxuXHRcblx0ICBmdW5jdGlvbiBpc0ludGVybmFsRnJhbWUoc3RhY2tMaW5lKSB7XG5cdCAgICB2YXIgZmlsZU5hbWVBbmRMaW5lTnVtYmVyID0gZ2V0RmlsZU5hbWVBbmRMaW5lTnVtYmVyKHN0YWNrTGluZSk7XG5cdCAgICBpZiAoIWZpbGVOYW1lQW5kTGluZU51bWJlcikge1xuXHQgICAgICByZXR1cm4gZmFsc2U7XG5cdCAgICB9XG5cdCAgICB2YXIgZmlsZU5hbWUgPSBmaWxlTmFtZUFuZExpbmVOdW1iZXJbMF0sIGxpbmVOdW1iZXIgPSBmaWxlTmFtZUFuZExpbmVOdW1iZXJbMV07XG5cdFxuXHQgICAgcmV0dXJuIGZpbGVOYW1lID09PSByRmlsZU5hbWUgJiZcblx0ICAgICAgbGluZU51bWJlciA+PSByU3RhcnRpbmdMaW5lICYmXG5cdCAgICAgIGxpbmVOdW1iZXIgPD0gckVuZGluZ0xpbmU7XG5cdCAgfVxuXHRcblx0ICBmdW5jdGlvbiBpc05vZGVGcmFtZShzdGFja0xpbmUpIHtcblx0ICAgIHJldHVybiBzdGFja0xpbmUuaW5kZXhPZignKG1vZHVsZS5qczonKSAhPT0gLTEgfHxcblx0ICAgICAgc3RhY2tMaW5lLmluZGV4T2YoJyhub2RlLmpzOicpICE9PSAtMTtcblx0ICB9XG5cdFxuXHQgIGZ1bmN0aW9uIGNhcHR1cmVMaW5lKCkge1xuXHQgICAgaWYgKCFoYXNTdGFja3MpIHsgcmV0dXJuOyB9XG5cdFxuXHQgICAgdHJ5IHtcblx0ICAgICAgdGhyb3cgbmV3IEVycm9yKCk7XG5cdCAgICB9IGNhdGNoIChlKSB7XG5cdCAgICAgIHZhciBsaW5lcyA9IGUuc3RhY2suc3BsaXQoJ1xcbicpO1xuXHQgICAgICB2YXIgZmlyc3RMaW5lID0gbGluZXNbMF0uaW5kZXhPZignQCcpID4gMCA/IGxpbmVzWzFdIDogbGluZXNbMl07XG5cdCAgICAgIHZhciBmaWxlTmFtZUFuZExpbmVOdW1iZXIgPSBnZXRGaWxlTmFtZUFuZExpbmVOdW1iZXIoZmlyc3RMaW5lKTtcblx0ICAgICAgaWYgKCFmaWxlTmFtZUFuZExpbmVOdW1iZXIpIHsgcmV0dXJuOyB9XG5cdFxuXHQgICAgICByRmlsZU5hbWUgPSBmaWxlTmFtZUFuZExpbmVOdW1iZXJbMF07XG5cdCAgICAgIHJldHVybiBmaWxlTmFtZUFuZExpbmVOdW1iZXJbMV07XG5cdCAgICB9XG5cdCAgfVxuXHRcblx0ICBmdW5jdGlvbiBnZXRGaWxlTmFtZUFuZExpbmVOdW1iZXIoc3RhY2tMaW5lKSB7XG5cdCAgICAvLyBOYW1lZCBmdW5jdGlvbnM6ICdhdCBmdW5jdGlvbk5hbWUgKGZpbGVuYW1lOmxpbmVOdW1iZXI6Y29sdW1uTnVtYmVyKSdcblx0ICAgIHZhciBhdHRlbXB0MSA9IC9hdCAuKyBcXCgoLispOihcXGQrKTooPzpcXGQrKVxcKSQvLmV4ZWMoc3RhY2tMaW5lKTtcblx0ICAgIGlmIChhdHRlbXB0MSkgeyByZXR1cm4gW2F0dGVtcHQxWzFdLCBOdW1iZXIoYXR0ZW1wdDFbMl0pXTsgfVxuXHRcblx0ICAgIC8vIEFub255bW91cyBmdW5jdGlvbnM6ICdhdCBmaWxlbmFtZTpsaW5lTnVtYmVyOmNvbHVtbk51bWJlcidcblx0ICAgIHZhciBhdHRlbXB0MiA9IC9hdCAoW14gXSspOihcXGQrKTooPzpcXGQrKSQvLmV4ZWMoc3RhY2tMaW5lKTtcblx0ICAgIGlmIChhdHRlbXB0MikgeyByZXR1cm4gW2F0dGVtcHQyWzFdLCBOdW1iZXIoYXR0ZW1wdDJbMl0pXTsgfVxuXHRcblx0ICAgIC8vIEZpcmVmb3ggc3R5bGU6ICdmdW5jdGlvbkBmaWxlbmFtZTpsaW5lTnVtYmVyIG9yIEBmaWxlbmFtZTpsaW5lTnVtYmVyJ1xuXHQgICAgdmFyIGF0dGVtcHQzID0gLy4qQCguKyk6KFxcZCspJC8uZXhlYyhzdGFja0xpbmUpO1xuXHQgICAgaWYgKGF0dGVtcHQzKSB7IHJldHVybiBbYXR0ZW1wdDNbMV0sIE51bWJlcihhdHRlbXB0M1syXSldOyB9XG5cdCAgfVxuXHRcblx0ICB2YXIgRW1wdHlFcnJvciA9IFJ4LkVtcHR5RXJyb3IgPSBmdW5jdGlvbigpIHtcblx0ICAgIHRoaXMubWVzc2FnZSA9ICdTZXF1ZW5jZSBjb250YWlucyBubyBlbGVtZW50cy4nO1xuXHQgICAgdGhpcy5uYW1lID0gJ0VtcHR5RXJyb3InO1xuXHQgICAgRXJyb3IuY2FsbCh0aGlzKTtcblx0ICB9O1xuXHQgIEVtcHR5RXJyb3IucHJvdG90eXBlID0gT2JqZWN0LmNyZWF0ZShFcnJvci5wcm90b3R5cGUpO1xuXHRcblx0ICB2YXIgT2JqZWN0RGlzcG9zZWRFcnJvciA9IFJ4Lk9iamVjdERpc3Bvc2VkRXJyb3IgPSBmdW5jdGlvbigpIHtcblx0ICAgIHRoaXMubWVzc2FnZSA9ICdPYmplY3QgaGFzIGJlZW4gZGlzcG9zZWQnO1xuXHQgICAgdGhpcy5uYW1lID0gJ09iamVjdERpc3Bvc2VkRXJyb3InO1xuXHQgICAgRXJyb3IuY2FsbCh0aGlzKTtcblx0ICB9O1xuXHQgIE9iamVjdERpc3Bvc2VkRXJyb3IucHJvdG90eXBlID0gT2JqZWN0LmNyZWF0ZShFcnJvci5wcm90b3R5cGUpO1xuXHRcblx0ICB2YXIgQXJndW1lbnRPdXRPZlJhbmdlRXJyb3IgPSBSeC5Bcmd1bWVudE91dE9mUmFuZ2VFcnJvciA9IGZ1bmN0aW9uICgpIHtcblx0ICAgIHRoaXMubWVzc2FnZSA9ICdBcmd1bWVudCBvdXQgb2YgcmFuZ2UnO1xuXHQgICAgdGhpcy5uYW1lID0gJ0FyZ3VtZW50T3V0T2ZSYW5nZUVycm9yJztcblx0ICAgIEVycm9yLmNhbGwodGhpcyk7XG5cdCAgfTtcblx0ICBBcmd1bWVudE91dE9mUmFuZ2VFcnJvci5wcm90b3R5cGUgPSBPYmplY3QuY3JlYXRlKEVycm9yLnByb3RvdHlwZSk7XG5cdFxuXHQgIHZhciBOb3RTdXBwb3J0ZWRFcnJvciA9IFJ4Lk5vdFN1cHBvcnRlZEVycm9yID0gZnVuY3Rpb24gKG1lc3NhZ2UpIHtcblx0ICAgIHRoaXMubWVzc2FnZSA9IG1lc3NhZ2UgfHwgJ1RoaXMgb3BlcmF0aW9uIGlzIG5vdCBzdXBwb3J0ZWQnO1xuXHQgICAgdGhpcy5uYW1lID0gJ05vdFN1cHBvcnRlZEVycm9yJztcblx0ICAgIEVycm9yLmNhbGwodGhpcyk7XG5cdCAgfTtcblx0ICBOb3RTdXBwb3J0ZWRFcnJvci5wcm90b3R5cGUgPSBPYmplY3QuY3JlYXRlKEVycm9yLnByb3RvdHlwZSk7XG5cdFxuXHQgIHZhciBOb3RJbXBsZW1lbnRlZEVycm9yID0gUnguTm90SW1wbGVtZW50ZWRFcnJvciA9IGZ1bmN0aW9uIChtZXNzYWdlKSB7XG5cdCAgICB0aGlzLm1lc3NhZ2UgPSBtZXNzYWdlIHx8ICdUaGlzIG9wZXJhdGlvbiBpcyBub3QgaW1wbGVtZW50ZWQnO1xuXHQgICAgdGhpcy5uYW1lID0gJ05vdEltcGxlbWVudGVkRXJyb3InO1xuXHQgICAgRXJyb3IuY2FsbCh0aGlzKTtcblx0ICB9O1xuXHQgIE5vdEltcGxlbWVudGVkRXJyb3IucHJvdG90eXBlID0gT2JqZWN0LmNyZWF0ZShFcnJvci5wcm90b3R5cGUpO1xuXHRcblx0ICB2YXIgbm90SW1wbGVtZW50ZWQgPSBSeC5oZWxwZXJzLm5vdEltcGxlbWVudGVkID0gZnVuY3Rpb24gKCkge1xuXHQgICAgdGhyb3cgbmV3IE5vdEltcGxlbWVudGVkRXJyb3IoKTtcblx0ICB9O1xuXHRcblx0ICB2YXIgbm90U3VwcG9ydGVkID0gUnguaGVscGVycy5ub3RTdXBwb3J0ZWQgPSBmdW5jdGlvbiAoKSB7XG5cdCAgICB0aHJvdyBuZXcgTm90U3VwcG9ydGVkRXJyb3IoKTtcblx0ICB9O1xuXHRcblx0ICAvLyBTaGltIGluIGl0ZXJhdG9yIHN1cHBvcnRcblx0ICB2YXIgJGl0ZXJhdG9yJCA9ICh0eXBlb2YgU3ltYm9sID09PSAnZnVuY3Rpb24nICYmIFN5bWJvbC5pdGVyYXRvcikgfHxcblx0ICAgICdfZXM2c2hpbV9pdGVyYXRvcl8nO1xuXHQgIC8vIEJ1ZyBmb3IgbW96aWxsYSB2ZXJzaW9uXG5cdCAgaWYgKHJvb3QuU2V0ICYmIHR5cGVvZiBuZXcgcm9vdC5TZXQoKVsnQEBpdGVyYXRvciddID09PSAnZnVuY3Rpb24nKSB7XG5cdCAgICAkaXRlcmF0b3IkID0gJ0BAaXRlcmF0b3InO1xuXHQgIH1cblx0XG5cdCAgdmFyIGRvbmVFbnVtZXJhdG9yID0gUnguZG9uZUVudW1lcmF0b3IgPSB7IGRvbmU6IHRydWUsIHZhbHVlOiB1bmRlZmluZWQgfTtcblx0XG5cdCAgdmFyIGlzSXRlcmFibGUgPSBSeC5oZWxwZXJzLmlzSXRlcmFibGUgPSBmdW5jdGlvbiAobykge1xuXHQgICAgcmV0dXJuIG9bJGl0ZXJhdG9yJF0gIT09IHVuZGVmaW5lZDtcblx0ICB9XG5cdFxuXHQgIHZhciBpc0FycmF5TGlrZSA9IFJ4LmhlbHBlcnMuaXNBcnJheUxpa2UgPSBmdW5jdGlvbiAobykge1xuXHQgICAgcmV0dXJuIG8gJiYgby5sZW5ndGggIT09IHVuZGVmaW5lZDtcblx0ICB9XG5cdFxuXHQgIFJ4LmhlbHBlcnMuaXRlcmF0b3IgPSAkaXRlcmF0b3IkO1xuXHRcblx0ICB2YXIgYmluZENhbGxiYWNrID0gUnguaW50ZXJuYWxzLmJpbmRDYWxsYmFjayA9IGZ1bmN0aW9uIChmdW5jLCB0aGlzQXJnLCBhcmdDb3VudCkge1xuXHQgICAgaWYgKHR5cGVvZiB0aGlzQXJnID09PSAndW5kZWZpbmVkJykgeyByZXR1cm4gZnVuYzsgfVxuXHQgICAgc3dpdGNoKGFyZ0NvdW50KSB7XG5cdCAgICAgIGNhc2UgMDpcblx0ICAgICAgICByZXR1cm4gZnVuY3Rpb24oKSB7XG5cdCAgICAgICAgICByZXR1cm4gZnVuYy5jYWxsKHRoaXNBcmcpXG5cdCAgICAgICAgfTtcblx0ICAgICAgY2FzZSAxOlxuXHQgICAgICAgIHJldHVybiBmdW5jdGlvbihhcmcpIHtcblx0ICAgICAgICAgIHJldHVybiBmdW5jLmNhbGwodGhpc0FyZywgYXJnKTtcblx0ICAgICAgICB9XG5cdCAgICAgIGNhc2UgMjpcblx0ICAgICAgICByZXR1cm4gZnVuY3Rpb24odmFsdWUsIGluZGV4KSB7XG5cdCAgICAgICAgICByZXR1cm4gZnVuYy5jYWxsKHRoaXNBcmcsIHZhbHVlLCBpbmRleCk7XG5cdCAgICAgICAgfTtcblx0ICAgICAgY2FzZSAzOlxuXHQgICAgICAgIHJldHVybiBmdW5jdGlvbih2YWx1ZSwgaW5kZXgsIGNvbGxlY3Rpb24pIHtcblx0ICAgICAgICAgIHJldHVybiBmdW5jLmNhbGwodGhpc0FyZywgdmFsdWUsIGluZGV4LCBjb2xsZWN0aW9uKTtcblx0ICAgICAgICB9O1xuXHQgICAgfVxuXHRcblx0ICAgIHJldHVybiBmdW5jdGlvbigpIHtcblx0ICAgICAgcmV0dXJuIGZ1bmMuYXBwbHkodGhpc0FyZywgYXJndW1lbnRzKTtcblx0ICAgIH07XG5cdCAgfTtcblx0XG5cdCAgLyoqIFVzZWQgdG8gZGV0ZXJtaW5lIGlmIHZhbHVlcyBhcmUgb2YgdGhlIGxhbmd1YWdlIHR5cGUgT2JqZWN0ICovXG5cdCAgdmFyIGRvbnRFbnVtcyA9IFsndG9TdHJpbmcnLFxuXHQgICAgJ3RvTG9jYWxlU3RyaW5nJyxcblx0ICAgICd2YWx1ZU9mJyxcblx0ICAgICdoYXNPd25Qcm9wZXJ0eScsXG5cdCAgICAnaXNQcm90b3R5cGVPZicsXG5cdCAgICAncHJvcGVydHlJc0VudW1lcmFibGUnLFxuXHQgICAgJ2NvbnN0cnVjdG9yJ10sXG5cdCAgZG9udEVudW1zTGVuZ3RoID0gZG9udEVudW1zLmxlbmd0aDtcblx0XG5cdCAgLyoqIGBPYmplY3QjdG9TdHJpbmdgIHJlc3VsdCBzaG9ydGN1dHMgKi9cblx0ICB2YXIgYXJnc0NsYXNzID0gJ1tvYmplY3QgQXJndW1lbnRzXScsXG5cdCAgICBhcnJheUNsYXNzID0gJ1tvYmplY3QgQXJyYXldJyxcblx0ICAgIGJvb2xDbGFzcyA9ICdbb2JqZWN0IEJvb2xlYW5dJyxcblx0ICAgIGRhdGVDbGFzcyA9ICdbb2JqZWN0IERhdGVdJyxcblx0ICAgIGVycm9yQ2xhc3MgPSAnW29iamVjdCBFcnJvcl0nLFxuXHQgICAgZnVuY0NsYXNzID0gJ1tvYmplY3QgRnVuY3Rpb25dJyxcblx0ICAgIG51bWJlckNsYXNzID0gJ1tvYmplY3QgTnVtYmVyXScsXG5cdCAgICBvYmplY3RDbGFzcyA9ICdbb2JqZWN0IE9iamVjdF0nLFxuXHQgICAgcmVnZXhwQ2xhc3MgPSAnW29iamVjdCBSZWdFeHBdJyxcblx0ICAgIHN0cmluZ0NsYXNzID0gJ1tvYmplY3QgU3RyaW5nXSc7XG5cdFxuXHQgIHZhciB0b1N0cmluZyA9IE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcsXG5cdCAgICBoYXNPd25Qcm9wZXJ0eSA9IE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHksXG5cdCAgICBzdXBwb3J0c0FyZ3NDbGFzcyA9IHRvU3RyaW5nLmNhbGwoYXJndW1lbnRzKSA9PSBhcmdzQ2xhc3MsIC8vIEZvciBsZXNzIDxJRTkgJiYgRkY8NFxuXHQgICAgc3VwcG9ydE5vZGVDbGFzcyxcblx0ICAgIGVycm9yUHJvdG8gPSBFcnJvci5wcm90b3R5cGUsXG5cdCAgICBvYmplY3RQcm90byA9IE9iamVjdC5wcm90b3R5cGUsXG5cdCAgICBzdHJpbmdQcm90byA9IFN0cmluZy5wcm90b3R5cGUsXG5cdCAgICBwcm9wZXJ0eUlzRW51bWVyYWJsZSA9IG9iamVjdFByb3RvLnByb3BlcnR5SXNFbnVtZXJhYmxlO1xuXHRcblx0ICB0cnkge1xuXHQgICAgc3VwcG9ydE5vZGVDbGFzcyA9ICEodG9TdHJpbmcuY2FsbChkb2N1bWVudCkgPT0gb2JqZWN0Q2xhc3MgJiYgISh7ICd0b1N0cmluZyc6IDAgfSArICcnKSk7XG5cdCAgfSBjYXRjaCAoZSkge1xuXHQgICAgc3VwcG9ydE5vZGVDbGFzcyA9IHRydWU7XG5cdCAgfVxuXHRcblx0ICB2YXIgbm9uRW51bVByb3BzID0ge307XG5cdCAgbm9uRW51bVByb3BzW2FycmF5Q2xhc3NdID0gbm9uRW51bVByb3BzW2RhdGVDbGFzc10gPSBub25FbnVtUHJvcHNbbnVtYmVyQ2xhc3NdID0geyAnY29uc3RydWN0b3InOiB0cnVlLCAndG9Mb2NhbGVTdHJpbmcnOiB0cnVlLCAndG9TdHJpbmcnOiB0cnVlLCAndmFsdWVPZic6IHRydWUgfTtcblx0ICBub25FbnVtUHJvcHNbYm9vbENsYXNzXSA9IG5vbkVudW1Qcm9wc1tzdHJpbmdDbGFzc10gPSB7ICdjb25zdHJ1Y3Rvcic6IHRydWUsICd0b1N0cmluZyc6IHRydWUsICd2YWx1ZU9mJzogdHJ1ZSB9O1xuXHQgIG5vbkVudW1Qcm9wc1tlcnJvckNsYXNzXSA9IG5vbkVudW1Qcm9wc1tmdW5jQ2xhc3NdID0gbm9uRW51bVByb3BzW3JlZ2V4cENsYXNzXSA9IHsgJ2NvbnN0cnVjdG9yJzogdHJ1ZSwgJ3RvU3RyaW5nJzogdHJ1ZSB9O1xuXHQgIG5vbkVudW1Qcm9wc1tvYmplY3RDbGFzc10gPSB7ICdjb25zdHJ1Y3Rvcic6IHRydWUgfTtcblx0XG5cdCAgdmFyIHN1cHBvcnQgPSB7fTtcblx0ICAoZnVuY3Rpb24gKCkge1xuXHQgICAgdmFyIGN0b3IgPSBmdW5jdGlvbigpIHsgdGhpcy54ID0gMTsgfSxcblx0ICAgICAgcHJvcHMgPSBbXTtcblx0XG5cdCAgICBjdG9yLnByb3RvdHlwZSA9IHsgJ3ZhbHVlT2YnOiAxLCAneSc6IDEgfTtcblx0ICAgIGZvciAodmFyIGtleSBpbiBuZXcgY3RvcikgeyBwcm9wcy5wdXNoKGtleSk7IH1cblx0ICAgIGZvciAoa2V5IGluIGFyZ3VtZW50cykgeyB9XG5cdFxuXHQgICAgLy8gRGV0ZWN0IGlmIGBuYW1lYCBvciBgbWVzc2FnZWAgcHJvcGVydGllcyBvZiBgRXJyb3IucHJvdG90eXBlYCBhcmUgZW51bWVyYWJsZSBieSBkZWZhdWx0LlxuXHQgICAgc3VwcG9ydC5lbnVtRXJyb3JQcm9wcyA9IHByb3BlcnR5SXNFbnVtZXJhYmxlLmNhbGwoZXJyb3JQcm90bywgJ21lc3NhZ2UnKSB8fCBwcm9wZXJ0eUlzRW51bWVyYWJsZS5jYWxsKGVycm9yUHJvdG8sICduYW1lJyk7XG5cdFxuXHQgICAgLy8gRGV0ZWN0IGlmIGBwcm90b3R5cGVgIHByb3BlcnRpZXMgYXJlIGVudW1lcmFibGUgYnkgZGVmYXVsdC5cblx0ICAgIHN1cHBvcnQuZW51bVByb3RvdHlwZXMgPSBwcm9wZXJ0eUlzRW51bWVyYWJsZS5jYWxsKGN0b3IsICdwcm90b3R5cGUnKTtcblx0XG5cdCAgICAvLyBEZXRlY3QgaWYgYGFyZ3VtZW50c2Agb2JqZWN0IGluZGV4ZXMgYXJlIG5vbi1lbnVtZXJhYmxlXG5cdCAgICBzdXBwb3J0Lm5vbkVudW1BcmdzID0ga2V5ICE9IDA7XG5cdFxuXHQgICAgLy8gRGV0ZWN0IGlmIHByb3BlcnRpZXMgc2hhZG93aW5nIHRob3NlIG9uIGBPYmplY3QucHJvdG90eXBlYCBhcmUgbm9uLWVudW1lcmFibGUuXG5cdCAgICBzdXBwb3J0Lm5vbkVudW1TaGFkb3dzID0gIS92YWx1ZU9mLy50ZXN0KHByb3BzKTtcblx0ICB9KDEpKTtcblx0XG5cdCAgdmFyIGlzT2JqZWN0ID0gUnguaW50ZXJuYWxzLmlzT2JqZWN0ID0gZnVuY3Rpb24odmFsdWUpIHtcblx0ICAgIHZhciB0eXBlID0gdHlwZW9mIHZhbHVlO1xuXHQgICAgcmV0dXJuIHZhbHVlICYmICh0eXBlID09ICdmdW5jdGlvbicgfHwgdHlwZSA9PSAnb2JqZWN0JykgfHwgZmFsc2U7XG5cdCAgfTtcblx0XG5cdCAgZnVuY3Rpb24ga2V5c0luKG9iamVjdCkge1xuXHQgICAgdmFyIHJlc3VsdCA9IFtdO1xuXHQgICAgaWYgKCFpc09iamVjdChvYmplY3QpKSB7XG5cdCAgICAgIHJldHVybiByZXN1bHQ7XG5cdCAgICB9XG5cdCAgICBpZiAoc3VwcG9ydC5ub25FbnVtQXJncyAmJiBvYmplY3QubGVuZ3RoICYmIGlzQXJndW1lbnRzKG9iamVjdCkpIHtcblx0ICAgICAgb2JqZWN0ID0gc2xpY2UuY2FsbChvYmplY3QpO1xuXHQgICAgfVxuXHQgICAgdmFyIHNraXBQcm90byA9IHN1cHBvcnQuZW51bVByb3RvdHlwZXMgJiYgdHlwZW9mIG9iamVjdCA9PSAnZnVuY3Rpb24nLFxuXHQgICAgICAgIHNraXBFcnJvclByb3BzID0gc3VwcG9ydC5lbnVtRXJyb3JQcm9wcyAmJiAob2JqZWN0ID09PSBlcnJvclByb3RvIHx8IG9iamVjdCBpbnN0YW5jZW9mIEVycm9yKTtcblx0XG5cdCAgICBmb3IgKHZhciBrZXkgaW4gb2JqZWN0KSB7XG5cdCAgICAgIGlmICghKHNraXBQcm90byAmJiBrZXkgPT0gJ3Byb3RvdHlwZScpICYmXG5cdCAgICAgICAgICAhKHNraXBFcnJvclByb3BzICYmIChrZXkgPT0gJ21lc3NhZ2UnIHx8IGtleSA9PSAnbmFtZScpKSkge1xuXHQgICAgICAgIHJlc3VsdC5wdXNoKGtleSk7XG5cdCAgICAgIH1cblx0ICAgIH1cblx0XG5cdCAgICBpZiAoc3VwcG9ydC5ub25FbnVtU2hhZG93cyAmJiBvYmplY3QgIT09IG9iamVjdFByb3RvKSB7XG5cdCAgICAgIHZhciBjdG9yID0gb2JqZWN0LmNvbnN0cnVjdG9yLFxuXHQgICAgICAgICAgaW5kZXggPSAtMSxcblx0ICAgICAgICAgIGxlbmd0aCA9IGRvbnRFbnVtc0xlbmd0aDtcblx0XG5cdCAgICAgIGlmIChvYmplY3QgPT09IChjdG9yICYmIGN0b3IucHJvdG90eXBlKSkge1xuXHQgICAgICAgIHZhciBjbGFzc05hbWUgPSBvYmplY3QgPT09IHN0cmluZ1Byb3RvID8gc3RyaW5nQ2xhc3MgOiBvYmplY3QgPT09IGVycm9yUHJvdG8gPyBlcnJvckNsYXNzIDogdG9TdHJpbmcuY2FsbChvYmplY3QpLFxuXHQgICAgICAgICAgICBub25FbnVtID0gbm9uRW51bVByb3BzW2NsYXNzTmFtZV07XG5cdCAgICAgIH1cblx0ICAgICAgd2hpbGUgKCsraW5kZXggPCBsZW5ndGgpIHtcblx0ICAgICAgICBrZXkgPSBkb250RW51bXNbaW5kZXhdO1xuXHQgICAgICAgIGlmICghKG5vbkVudW0gJiYgbm9uRW51bVtrZXldKSAmJiBoYXNPd25Qcm9wZXJ0eS5jYWxsKG9iamVjdCwga2V5KSkge1xuXHQgICAgICAgICAgcmVzdWx0LnB1c2goa2V5KTtcblx0ICAgICAgICB9XG5cdCAgICAgIH1cblx0ICAgIH1cblx0ICAgIHJldHVybiByZXN1bHQ7XG5cdCAgfVxuXHRcblx0ICBmdW5jdGlvbiBpbnRlcm5hbEZvcihvYmplY3QsIGNhbGxiYWNrLCBrZXlzRnVuYykge1xuXHQgICAgdmFyIGluZGV4ID0gLTEsXG5cdCAgICAgIHByb3BzID0ga2V5c0Z1bmMob2JqZWN0KSxcblx0ICAgICAgbGVuZ3RoID0gcHJvcHMubGVuZ3RoO1xuXHRcblx0ICAgIHdoaWxlICgrK2luZGV4IDwgbGVuZ3RoKSB7XG5cdCAgICAgIHZhciBrZXkgPSBwcm9wc1tpbmRleF07XG5cdCAgICAgIGlmIChjYWxsYmFjayhvYmplY3Rba2V5XSwga2V5LCBvYmplY3QpID09PSBmYWxzZSkge1xuXHQgICAgICAgIGJyZWFrO1xuXHQgICAgICB9XG5cdCAgICB9XG5cdCAgICByZXR1cm4gb2JqZWN0O1xuXHQgIH1cblx0XG5cdCAgZnVuY3Rpb24gaW50ZXJuYWxGb3JJbihvYmplY3QsIGNhbGxiYWNrKSB7XG5cdCAgICByZXR1cm4gaW50ZXJuYWxGb3Iob2JqZWN0LCBjYWxsYmFjaywga2V5c0luKTtcblx0ICB9XG5cdFxuXHQgIGZ1bmN0aW9uIGlzTm9kZSh2YWx1ZSkge1xuXHQgICAgLy8gSUUgPCA5IHByZXNlbnRzIERPTSBub2RlcyBhcyBgT2JqZWN0YCBvYmplY3RzIGV4Y2VwdCB0aGV5IGhhdmUgYHRvU3RyaW5nYFxuXHQgICAgLy8gbWV0aG9kcyB0aGF0IGFyZSBgdHlwZW9mYCBcInN0cmluZ1wiIGFuZCBzdGlsbCBjYW4gY29lcmNlIG5vZGVzIHRvIHN0cmluZ3Ncblx0ICAgIHJldHVybiB0eXBlb2YgdmFsdWUudG9TdHJpbmcgIT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YgKHZhbHVlICsgJycpID09ICdzdHJpbmcnO1xuXHQgIH1cblx0XG5cdCAgdmFyIGlzQXJndW1lbnRzID0gZnVuY3Rpb24odmFsdWUpIHtcblx0ICAgIHJldHVybiAodmFsdWUgJiYgdHlwZW9mIHZhbHVlID09ICdvYmplY3QnKSA/IHRvU3RyaW5nLmNhbGwodmFsdWUpID09IGFyZ3NDbGFzcyA6IGZhbHNlO1xuXHQgIH1cblx0XG5cdCAgLy8gZmFsbGJhY2sgZm9yIGJyb3dzZXJzIHRoYXQgY2FuJ3QgZGV0ZWN0IGBhcmd1bWVudHNgIG9iamVjdHMgYnkgW1tDbGFzc11dXG5cdCAgaWYgKCFzdXBwb3J0c0FyZ3NDbGFzcykge1xuXHQgICAgaXNBcmd1bWVudHMgPSBmdW5jdGlvbih2YWx1ZSkge1xuXHQgICAgICByZXR1cm4gKHZhbHVlICYmIHR5cGVvZiB2YWx1ZSA9PSAnb2JqZWN0JykgPyBoYXNPd25Qcm9wZXJ0eS5jYWxsKHZhbHVlLCAnY2FsbGVlJykgOiBmYWxzZTtcblx0ICAgIH07XG5cdCAgfVxuXHRcblx0ICB2YXIgaXNFcXVhbCA9IFJ4LmludGVybmFscy5pc0VxdWFsID0gZnVuY3Rpb24gKHgsIHkpIHtcblx0ICAgIHJldHVybiBkZWVwRXF1YWxzKHgsIHksIFtdLCBbXSk7XG5cdCAgfTtcblx0XG5cdCAgLyoqIEBwcml2YXRlXG5cdCAgICogVXNlZCBmb3IgZGVlcCBjb21wYXJpc29uXG5cdCAgICoqL1xuXHQgIGZ1bmN0aW9uIGRlZXBFcXVhbHMoYSwgYiwgc3RhY2tBLCBzdGFja0IpIHtcblx0ICAgIC8vIGV4aXQgZWFybHkgZm9yIGlkZW50aWNhbCB2YWx1ZXNcblx0ICAgIGlmIChhID09PSBiKSB7XG5cdCAgICAgIC8vIHRyZWF0IGArMGAgdnMuIGAtMGAgYXMgbm90IGVxdWFsXG5cdCAgICAgIHJldHVybiBhICE9PSAwIHx8ICgxIC8gYSA9PSAxIC8gYik7XG5cdCAgICB9XG5cdFxuXHQgICAgdmFyIHR5cGUgPSB0eXBlb2YgYSxcblx0ICAgICAgICBvdGhlclR5cGUgPSB0eXBlb2YgYjtcblx0XG5cdCAgICAvLyBleGl0IGVhcmx5IGZvciB1bmxpa2UgcHJpbWl0aXZlIHZhbHVlc1xuXHQgICAgaWYgKGEgPT09IGEgJiYgKGEgPT0gbnVsbCB8fCBiID09IG51bGwgfHxcblx0ICAgICAgICAodHlwZSAhPSAnZnVuY3Rpb24nICYmIHR5cGUgIT0gJ29iamVjdCcgJiYgb3RoZXJUeXBlICE9ICdmdW5jdGlvbicgJiYgb3RoZXJUeXBlICE9ICdvYmplY3QnKSkpIHtcblx0ICAgICAgcmV0dXJuIGZhbHNlO1xuXHQgICAgfVxuXHRcblx0ICAgIC8vIGNvbXBhcmUgW1tDbGFzc11dIG5hbWVzXG5cdCAgICB2YXIgY2xhc3NOYW1lID0gdG9TdHJpbmcuY2FsbChhKSxcblx0ICAgICAgICBvdGhlckNsYXNzID0gdG9TdHJpbmcuY2FsbChiKTtcblx0XG5cdCAgICBpZiAoY2xhc3NOYW1lID09IGFyZ3NDbGFzcykge1xuXHQgICAgICBjbGFzc05hbWUgPSBvYmplY3RDbGFzcztcblx0ICAgIH1cblx0ICAgIGlmIChvdGhlckNsYXNzID09IGFyZ3NDbGFzcykge1xuXHQgICAgICBvdGhlckNsYXNzID0gb2JqZWN0Q2xhc3M7XG5cdCAgICB9XG5cdCAgICBpZiAoY2xhc3NOYW1lICE9IG90aGVyQ2xhc3MpIHtcblx0ICAgICAgcmV0dXJuIGZhbHNlO1xuXHQgICAgfVxuXHQgICAgc3dpdGNoIChjbGFzc05hbWUpIHtcblx0ICAgICAgY2FzZSBib29sQ2xhc3M6XG5cdCAgICAgIGNhc2UgZGF0ZUNsYXNzOlxuXHQgICAgICAgIC8vIGNvZXJjZSBkYXRlcyBhbmQgYm9vbGVhbnMgdG8gbnVtYmVycywgZGF0ZXMgdG8gbWlsbGlzZWNvbmRzIGFuZCBib29sZWFuc1xuXHQgICAgICAgIC8vIHRvIGAxYCBvciBgMGAgdHJlYXRpbmcgaW52YWxpZCBkYXRlcyBjb2VyY2VkIHRvIGBOYU5gIGFzIG5vdCBlcXVhbFxuXHQgICAgICAgIHJldHVybiArYSA9PSArYjtcblx0XG5cdCAgICAgIGNhc2UgbnVtYmVyQ2xhc3M6XG5cdCAgICAgICAgLy8gdHJlYXQgYE5hTmAgdnMuIGBOYU5gIGFzIGVxdWFsXG5cdCAgICAgICAgcmV0dXJuIChhICE9ICthKSA/XG5cdCAgICAgICAgICBiICE9ICtiIDpcblx0ICAgICAgICAgIC8vIGJ1dCB0cmVhdCBgLTBgIHZzLiBgKzBgIGFzIG5vdCBlcXVhbFxuXHQgICAgICAgICAgKGEgPT0gMCA/ICgxIC8gYSA9PSAxIC8gYikgOiBhID09ICtiKTtcblx0XG5cdCAgICAgIGNhc2UgcmVnZXhwQ2xhc3M6XG5cdCAgICAgIGNhc2Ugc3RyaW5nQ2xhc3M6XG5cdCAgICAgICAgLy8gY29lcmNlIHJlZ2V4ZXMgdG8gc3RyaW5ncyAoaHR0cDovL2VzNS5naXRodWIuaW8vI3gxNS4xMC42LjQpXG5cdCAgICAgICAgLy8gdHJlYXQgc3RyaW5nIHByaW1pdGl2ZXMgYW5kIHRoZWlyIGNvcnJlc3BvbmRpbmcgb2JqZWN0IGluc3RhbmNlcyBhcyBlcXVhbFxuXHQgICAgICAgIHJldHVybiBhID09IFN0cmluZyhiKTtcblx0ICAgIH1cblx0ICAgIHZhciBpc0FyciA9IGNsYXNzTmFtZSA9PSBhcnJheUNsYXNzO1xuXHQgICAgaWYgKCFpc0Fycikge1xuXHRcblx0ICAgICAgLy8gZXhpdCBmb3IgZnVuY3Rpb25zIGFuZCBET00gbm9kZXNcblx0ICAgICAgaWYgKGNsYXNzTmFtZSAhPSBvYmplY3RDbGFzcyB8fCAoIXN1cHBvcnQubm9kZUNsYXNzICYmIChpc05vZGUoYSkgfHwgaXNOb2RlKGIpKSkpIHtcblx0ICAgICAgICByZXR1cm4gZmFsc2U7XG5cdCAgICAgIH1cblx0ICAgICAgLy8gaW4gb2xkZXIgdmVyc2lvbnMgb2YgT3BlcmEsIGBhcmd1bWVudHNgIG9iamVjdHMgaGF2ZSBgQXJyYXlgIGNvbnN0cnVjdG9yc1xuXHQgICAgICB2YXIgY3RvckEgPSAhc3VwcG9ydC5hcmdzT2JqZWN0ICYmIGlzQXJndW1lbnRzKGEpID8gT2JqZWN0IDogYS5jb25zdHJ1Y3Rvcixcblx0ICAgICAgICAgIGN0b3JCID0gIXN1cHBvcnQuYXJnc09iamVjdCAmJiBpc0FyZ3VtZW50cyhiKSA/IE9iamVjdCA6IGIuY29uc3RydWN0b3I7XG5cdFxuXHQgICAgICAvLyBub24gYE9iamVjdGAgb2JqZWN0IGluc3RhbmNlcyB3aXRoIGRpZmZlcmVudCBjb25zdHJ1Y3RvcnMgYXJlIG5vdCBlcXVhbFxuXHQgICAgICBpZiAoY3RvckEgIT0gY3RvckIgJiZcblx0ICAgICAgICAgICAgIShoYXNPd25Qcm9wZXJ0eS5jYWxsKGEsICdjb25zdHJ1Y3RvcicpICYmIGhhc093blByb3BlcnR5LmNhbGwoYiwgJ2NvbnN0cnVjdG9yJykpICYmXG5cdCAgICAgICAgICAgICEoaXNGdW5jdGlvbihjdG9yQSkgJiYgY3RvckEgaW5zdGFuY2VvZiBjdG9yQSAmJiBpc0Z1bmN0aW9uKGN0b3JCKSAmJiBjdG9yQiBpbnN0YW5jZW9mIGN0b3JCKSAmJlxuXHQgICAgICAgICAgICAoJ2NvbnN0cnVjdG9yJyBpbiBhICYmICdjb25zdHJ1Y3RvcicgaW4gYilcblx0ICAgICAgICAgICkge1xuXHQgICAgICAgIHJldHVybiBmYWxzZTtcblx0ICAgICAgfVxuXHQgICAgfVxuXHQgICAgLy8gYXNzdW1lIGN5Y2xpYyBzdHJ1Y3R1cmVzIGFyZSBlcXVhbFxuXHQgICAgLy8gdGhlIGFsZ29yaXRobSBmb3IgZGV0ZWN0aW5nIGN5Y2xpYyBzdHJ1Y3R1cmVzIGlzIGFkYXB0ZWQgZnJvbSBFUyA1LjFcblx0ICAgIC8vIHNlY3Rpb24gMTUuMTIuMywgYWJzdHJhY3Qgb3BlcmF0aW9uIGBKT2AgKGh0dHA6Ly9lczUuZ2l0aHViLmlvLyN4MTUuMTIuMylcblx0ICAgIHZhciBpbml0ZWRTdGFjayA9ICFzdGFja0E7XG5cdCAgICBzdGFja0EgfHwgKHN0YWNrQSA9IFtdKTtcblx0ICAgIHN0YWNrQiB8fCAoc3RhY2tCID0gW10pO1xuXHRcblx0ICAgIHZhciBsZW5ndGggPSBzdGFja0EubGVuZ3RoO1xuXHQgICAgd2hpbGUgKGxlbmd0aC0tKSB7XG5cdCAgICAgIGlmIChzdGFja0FbbGVuZ3RoXSA9PSBhKSB7XG5cdCAgICAgICAgcmV0dXJuIHN0YWNrQltsZW5ndGhdID09IGI7XG5cdCAgICAgIH1cblx0ICAgIH1cblx0ICAgIHZhciBzaXplID0gMDtcblx0ICAgIHZhciByZXN1bHQgPSB0cnVlO1xuXHRcblx0ICAgIC8vIGFkZCBgYWAgYW5kIGBiYCB0byB0aGUgc3RhY2sgb2YgdHJhdmVyc2VkIG9iamVjdHNcblx0ICAgIHN0YWNrQS5wdXNoKGEpO1xuXHQgICAgc3RhY2tCLnB1c2goYik7XG5cdFxuXHQgICAgLy8gcmVjdXJzaXZlbHkgY29tcGFyZSBvYmplY3RzIGFuZCBhcnJheXMgKHN1c2NlcHRpYmxlIHRvIGNhbGwgc3RhY2sgbGltaXRzKVxuXHQgICAgaWYgKGlzQXJyKSB7XG5cdCAgICAgIC8vIGNvbXBhcmUgbGVuZ3RocyB0byBkZXRlcm1pbmUgaWYgYSBkZWVwIGNvbXBhcmlzb24gaXMgbmVjZXNzYXJ5XG5cdCAgICAgIGxlbmd0aCA9IGEubGVuZ3RoO1xuXHQgICAgICBzaXplID0gYi5sZW5ndGg7XG5cdCAgICAgIHJlc3VsdCA9IHNpemUgPT0gbGVuZ3RoO1xuXHRcblx0ICAgICAgaWYgKHJlc3VsdCkge1xuXHQgICAgICAgIC8vIGRlZXAgY29tcGFyZSB0aGUgY29udGVudHMsIGlnbm9yaW5nIG5vbi1udW1lcmljIHByb3BlcnRpZXNcblx0ICAgICAgICB3aGlsZSAoc2l6ZS0tKSB7XG5cdCAgICAgICAgICB2YXIgaW5kZXggPSBsZW5ndGgsXG5cdCAgICAgICAgICAgICAgdmFsdWUgPSBiW3NpemVdO1xuXHRcblx0ICAgICAgICAgIGlmICghKHJlc3VsdCA9IGRlZXBFcXVhbHMoYVtzaXplXSwgdmFsdWUsIHN0YWNrQSwgc3RhY2tCKSkpIHtcblx0ICAgICAgICAgICAgYnJlYWs7XG5cdCAgICAgICAgICB9XG5cdCAgICAgICAgfVxuXHQgICAgICB9XG5cdCAgICB9XG5cdCAgICBlbHNlIHtcblx0ICAgICAgLy8gZGVlcCBjb21wYXJlIG9iamVjdHMgdXNpbmcgYGZvckluYCwgaW5zdGVhZCBvZiBgZm9yT3duYCwgdG8gYXZvaWQgYE9iamVjdC5rZXlzYFxuXHQgICAgICAvLyB3aGljaCwgaW4gdGhpcyBjYXNlLCBpcyBtb3JlIGNvc3RseVxuXHQgICAgICBpbnRlcm5hbEZvckluKGIsIGZ1bmN0aW9uKHZhbHVlLCBrZXksIGIpIHtcblx0ICAgICAgICBpZiAoaGFzT3duUHJvcGVydHkuY2FsbChiLCBrZXkpKSB7XG5cdCAgICAgICAgICAvLyBjb3VudCB0aGUgbnVtYmVyIG9mIHByb3BlcnRpZXMuXG5cdCAgICAgICAgICBzaXplKys7XG5cdCAgICAgICAgICAvLyBkZWVwIGNvbXBhcmUgZWFjaCBwcm9wZXJ0eSB2YWx1ZS5cblx0ICAgICAgICAgIHJldHVybiAocmVzdWx0ID0gaGFzT3duUHJvcGVydHkuY2FsbChhLCBrZXkpICYmIGRlZXBFcXVhbHMoYVtrZXldLCB2YWx1ZSwgc3RhY2tBLCBzdGFja0IpKTtcblx0ICAgICAgICB9XG5cdCAgICAgIH0pO1xuXHRcblx0ICAgICAgaWYgKHJlc3VsdCkge1xuXHQgICAgICAgIC8vIGVuc3VyZSBib3RoIG9iamVjdHMgaGF2ZSB0aGUgc2FtZSBudW1iZXIgb2YgcHJvcGVydGllc1xuXHQgICAgICAgIGludGVybmFsRm9ySW4oYSwgZnVuY3Rpb24odmFsdWUsIGtleSwgYSkge1xuXHQgICAgICAgICAgaWYgKGhhc093blByb3BlcnR5LmNhbGwoYSwga2V5KSkge1xuXHQgICAgICAgICAgICAvLyBgc2l6ZWAgd2lsbCBiZSBgLTFgIGlmIGBhYCBoYXMgbW9yZSBwcm9wZXJ0aWVzIHRoYW4gYGJgXG5cdCAgICAgICAgICAgIHJldHVybiAocmVzdWx0ID0gLS1zaXplID4gLTEpO1xuXHQgICAgICAgICAgfVxuXHQgICAgICAgIH0pO1xuXHQgICAgICB9XG5cdCAgICB9XG5cdCAgICBzdGFja0EucG9wKCk7XG5cdCAgICBzdGFja0IucG9wKCk7XG5cdFxuXHQgICAgcmV0dXJuIHJlc3VsdDtcblx0ICB9XG5cdFxuXHQgIHZhciBoYXNQcm9wID0ge30uaGFzT3duUHJvcGVydHksXG5cdCAgICAgIHNsaWNlID0gQXJyYXkucHJvdG90eXBlLnNsaWNlO1xuXHRcblx0ICB2YXIgaW5oZXJpdHMgPSBSeC5pbnRlcm5hbHMuaW5oZXJpdHMgPSBmdW5jdGlvbiAoY2hpbGQsIHBhcmVudCkge1xuXHQgICAgZnVuY3Rpb24gX18oKSB7IHRoaXMuY29uc3RydWN0b3IgPSBjaGlsZDsgfVxuXHQgICAgX18ucHJvdG90eXBlID0gcGFyZW50LnByb3RvdHlwZTtcblx0ICAgIGNoaWxkLnByb3RvdHlwZSA9IG5ldyBfXygpO1xuXHQgIH07XG5cdFxuXHQgIHZhciBhZGRQcm9wZXJ0aWVzID0gUnguaW50ZXJuYWxzLmFkZFByb3BlcnRpZXMgPSBmdW5jdGlvbiAob2JqKSB7XG5cdCAgICBmb3IodmFyIHNvdXJjZXMgPSBbXSwgaSA9IDEsIGxlbiA9IGFyZ3VtZW50cy5sZW5ndGg7IGkgPCBsZW47IGkrKykgeyBzb3VyY2VzLnB1c2goYXJndW1lbnRzW2ldKTsgfVxuXHQgICAgZm9yICh2YXIgaWR4ID0gMCwgbG4gPSBzb3VyY2VzLmxlbmd0aDsgaWR4IDwgbG47IGlkeCsrKSB7XG5cdCAgICAgIHZhciBzb3VyY2UgPSBzb3VyY2VzW2lkeF07XG5cdCAgICAgIGZvciAodmFyIHByb3AgaW4gc291cmNlKSB7XG5cdCAgICAgICAgb2JqW3Byb3BdID0gc291cmNlW3Byb3BdO1xuXHQgICAgICB9XG5cdCAgICB9XG5cdCAgfTtcblx0XG5cdCAgLy8gUnggVXRpbHNcblx0ICB2YXIgYWRkUmVmID0gUnguaW50ZXJuYWxzLmFkZFJlZiA9IGZ1bmN0aW9uICh4cywgcikge1xuXHQgICAgcmV0dXJuIG5ldyBBbm9ueW1vdXNPYnNlcnZhYmxlKGZ1bmN0aW9uIChvYnNlcnZlcikge1xuXHQgICAgICByZXR1cm4gbmV3IEJpbmFyeURpc3Bvc2FibGUoci5nZXREaXNwb3NhYmxlKCksIHhzLnN1YnNjcmliZShvYnNlcnZlcikpO1xuXHQgICAgfSk7XG5cdCAgfTtcblx0XG5cdCAgZnVuY3Rpb24gYXJyYXlJbml0aWFsaXplKGNvdW50LCBmYWN0b3J5KSB7XG5cdCAgICB2YXIgYSA9IG5ldyBBcnJheShjb3VudCk7XG5cdCAgICBmb3IgKHZhciBpID0gMDsgaSA8IGNvdW50OyBpKyspIHtcblx0ICAgICAgYVtpXSA9IGZhY3RvcnkoKTtcblx0ICAgIH1cblx0ICAgIHJldHVybiBhO1xuXHQgIH1cblx0XG5cdCAgZnVuY3Rpb24gSW5kZXhlZEl0ZW0oaWQsIHZhbHVlKSB7XG5cdCAgICB0aGlzLmlkID0gaWQ7XG5cdCAgICB0aGlzLnZhbHVlID0gdmFsdWU7XG5cdCAgfVxuXHRcblx0ICBJbmRleGVkSXRlbS5wcm90b3R5cGUuY29tcGFyZVRvID0gZnVuY3Rpb24gKG90aGVyKSB7XG5cdCAgICB2YXIgYyA9IHRoaXMudmFsdWUuY29tcGFyZVRvKG90aGVyLnZhbHVlKTtcblx0ICAgIGMgPT09IDAgJiYgKGMgPSB0aGlzLmlkIC0gb3RoZXIuaWQpO1xuXHQgICAgcmV0dXJuIGM7XG5cdCAgfTtcblx0XG5cdCAgdmFyIFByaW9yaXR5UXVldWUgPSBSeC5pbnRlcm5hbHMuUHJpb3JpdHlRdWV1ZSA9IGZ1bmN0aW9uIChjYXBhY2l0eSkge1xuXHQgICAgdGhpcy5pdGVtcyA9IG5ldyBBcnJheShjYXBhY2l0eSk7XG5cdCAgICB0aGlzLmxlbmd0aCA9IDA7XG5cdCAgfTtcblx0XG5cdCAgdmFyIHByaW9yaXR5UHJvdG8gPSBQcmlvcml0eVF1ZXVlLnByb3RvdHlwZTtcblx0ICBwcmlvcml0eVByb3RvLmlzSGlnaGVyUHJpb3JpdHkgPSBmdW5jdGlvbiAobGVmdCwgcmlnaHQpIHtcblx0ICAgIHJldHVybiB0aGlzLml0ZW1zW2xlZnRdLmNvbXBhcmVUbyh0aGlzLml0ZW1zW3JpZ2h0XSkgPCAwO1xuXHQgIH07XG5cdFxuXHQgIHByaW9yaXR5UHJvdG8ucGVyY29sYXRlID0gZnVuY3Rpb24gKGluZGV4KSB7XG5cdCAgICBpZiAoaW5kZXggPj0gdGhpcy5sZW5ndGggfHwgaW5kZXggPCAwKSB7IHJldHVybjsgfVxuXHQgICAgdmFyIHBhcmVudCA9IGluZGV4IC0gMSA+PiAxO1xuXHQgICAgaWYgKHBhcmVudCA8IDAgfHwgcGFyZW50ID09PSBpbmRleCkgeyByZXR1cm47IH1cblx0ICAgIGlmICh0aGlzLmlzSGlnaGVyUHJpb3JpdHkoaW5kZXgsIHBhcmVudCkpIHtcblx0ICAgICAgdmFyIHRlbXAgPSB0aGlzLml0ZW1zW2luZGV4XTtcblx0ICAgICAgdGhpcy5pdGVtc1tpbmRleF0gPSB0aGlzLml0ZW1zW3BhcmVudF07XG5cdCAgICAgIHRoaXMuaXRlbXNbcGFyZW50XSA9IHRlbXA7XG5cdCAgICAgIHRoaXMucGVyY29sYXRlKHBhcmVudCk7XG5cdCAgICB9XG5cdCAgfTtcblx0XG5cdCAgcHJpb3JpdHlQcm90by5oZWFwaWZ5ID0gZnVuY3Rpb24gKGluZGV4KSB7XG5cdCAgICAraW5kZXggfHwgKGluZGV4ID0gMCk7XG5cdCAgICBpZiAoaW5kZXggPj0gdGhpcy5sZW5ndGggfHwgaW5kZXggPCAwKSB7IHJldHVybjsgfVxuXHQgICAgdmFyIGxlZnQgPSAyICogaW5kZXggKyAxLFxuXHQgICAgICAgIHJpZ2h0ID0gMiAqIGluZGV4ICsgMixcblx0ICAgICAgICBmaXJzdCA9IGluZGV4O1xuXHQgICAgaWYgKGxlZnQgPCB0aGlzLmxlbmd0aCAmJiB0aGlzLmlzSGlnaGVyUHJpb3JpdHkobGVmdCwgZmlyc3QpKSB7XG5cdCAgICAgIGZpcnN0ID0gbGVmdDtcblx0ICAgIH1cblx0ICAgIGlmIChyaWdodCA8IHRoaXMubGVuZ3RoICYmIHRoaXMuaXNIaWdoZXJQcmlvcml0eShyaWdodCwgZmlyc3QpKSB7XG5cdCAgICAgIGZpcnN0ID0gcmlnaHQ7XG5cdCAgICB9XG5cdCAgICBpZiAoZmlyc3QgIT09IGluZGV4KSB7XG5cdCAgICAgIHZhciB0ZW1wID0gdGhpcy5pdGVtc1tpbmRleF07XG5cdCAgICAgIHRoaXMuaXRlbXNbaW5kZXhdID0gdGhpcy5pdGVtc1tmaXJzdF07XG5cdCAgICAgIHRoaXMuaXRlbXNbZmlyc3RdID0gdGVtcDtcblx0ICAgICAgdGhpcy5oZWFwaWZ5KGZpcnN0KTtcblx0ICAgIH1cblx0ICB9O1xuXHRcblx0ICBwcmlvcml0eVByb3RvLnBlZWsgPSBmdW5jdGlvbiAoKSB7IHJldHVybiB0aGlzLml0ZW1zWzBdLnZhbHVlOyB9O1xuXHRcblx0ICBwcmlvcml0eVByb3RvLnJlbW92ZUF0ID0gZnVuY3Rpb24gKGluZGV4KSB7XG5cdCAgICB0aGlzLml0ZW1zW2luZGV4XSA9IHRoaXMuaXRlbXNbLS10aGlzLmxlbmd0aF07XG5cdCAgICB0aGlzLml0ZW1zW3RoaXMubGVuZ3RoXSA9IHVuZGVmaW5lZDtcblx0ICAgIHRoaXMuaGVhcGlmeSgpO1xuXHQgIH07XG5cdFxuXHQgIHByaW9yaXR5UHJvdG8uZGVxdWV1ZSA9IGZ1bmN0aW9uICgpIHtcblx0ICAgIHZhciByZXN1bHQgPSB0aGlzLnBlZWsoKTtcblx0ICAgIHRoaXMucmVtb3ZlQXQoMCk7XG5cdCAgICByZXR1cm4gcmVzdWx0O1xuXHQgIH07XG5cdFxuXHQgIHByaW9yaXR5UHJvdG8uZW5xdWV1ZSA9IGZ1bmN0aW9uIChpdGVtKSB7XG5cdCAgICB2YXIgaW5kZXggPSB0aGlzLmxlbmd0aCsrO1xuXHQgICAgdGhpcy5pdGVtc1tpbmRleF0gPSBuZXcgSW5kZXhlZEl0ZW0oUHJpb3JpdHlRdWV1ZS5jb3VudCsrLCBpdGVtKTtcblx0ICAgIHRoaXMucGVyY29sYXRlKGluZGV4KTtcblx0ICB9O1xuXHRcblx0ICBwcmlvcml0eVByb3RvLnJlbW92ZSA9IGZ1bmN0aW9uIChpdGVtKSB7XG5cdCAgICBmb3IgKHZhciBpID0gMDsgaSA8IHRoaXMubGVuZ3RoOyBpKyspIHtcblx0ICAgICAgaWYgKHRoaXMuaXRlbXNbaV0udmFsdWUgPT09IGl0ZW0pIHtcblx0ICAgICAgICB0aGlzLnJlbW92ZUF0KGkpO1xuXHQgICAgICAgIHJldHVybiB0cnVlO1xuXHQgICAgICB9XG5cdCAgICB9XG5cdCAgICByZXR1cm4gZmFsc2U7XG5cdCAgfTtcblx0ICBQcmlvcml0eVF1ZXVlLmNvdW50ID0gMDtcblx0XG5cdCAgLyoqXG5cdCAgICogUmVwcmVzZW50cyBhIGdyb3VwIG9mIGRpc3Bvc2FibGUgcmVzb3VyY2VzIHRoYXQgYXJlIGRpc3Bvc2VkIHRvZ2V0aGVyLlxuXHQgICAqIEBjb25zdHJ1Y3RvclxuXHQgICAqL1xuXHQgIHZhciBDb21wb3NpdGVEaXNwb3NhYmxlID0gUnguQ29tcG9zaXRlRGlzcG9zYWJsZSA9IGZ1bmN0aW9uICgpIHtcblx0ICAgIHZhciBhcmdzID0gW10sIGksIGxlbjtcblx0ICAgIGlmIChBcnJheS5pc0FycmF5KGFyZ3VtZW50c1swXSkpIHtcblx0ICAgICAgYXJncyA9IGFyZ3VtZW50c1swXTtcblx0ICAgICAgbGVuID0gYXJncy5sZW5ndGg7XG5cdCAgICB9IGVsc2Uge1xuXHQgICAgICBsZW4gPSBhcmd1bWVudHMubGVuZ3RoO1xuXHQgICAgICBhcmdzID0gbmV3IEFycmF5KGxlbik7XG5cdCAgICAgIGZvcihpID0gMDsgaSA8IGxlbjsgaSsrKSB7IGFyZ3NbaV0gPSBhcmd1bWVudHNbaV07IH1cblx0ICAgIH1cblx0ICAgIHRoaXMuZGlzcG9zYWJsZXMgPSBhcmdzO1xuXHQgICAgdGhpcy5pc0Rpc3Bvc2VkID0gZmFsc2U7XG5cdCAgICB0aGlzLmxlbmd0aCA9IGFyZ3MubGVuZ3RoO1xuXHQgIH07XG5cdFxuXHQgIHZhciBDb21wb3NpdGVEaXNwb3NhYmxlUHJvdG90eXBlID0gQ29tcG9zaXRlRGlzcG9zYWJsZS5wcm90b3R5cGU7XG5cdFxuXHQgIC8qKlxuXHQgICAqIEFkZHMgYSBkaXNwb3NhYmxlIHRvIHRoZSBDb21wb3NpdGVEaXNwb3NhYmxlIG9yIGRpc3Bvc2VzIHRoZSBkaXNwb3NhYmxlIGlmIHRoZSBDb21wb3NpdGVEaXNwb3NhYmxlIGlzIGRpc3Bvc2VkLlxuXHQgICAqIEBwYXJhbSB7TWl4ZWR9IGl0ZW0gRGlzcG9zYWJsZSB0byBhZGQuXG5cdCAgICovXG5cdCAgQ29tcG9zaXRlRGlzcG9zYWJsZVByb3RvdHlwZS5hZGQgPSBmdW5jdGlvbiAoaXRlbSkge1xuXHQgICAgaWYgKHRoaXMuaXNEaXNwb3NlZCkge1xuXHQgICAgICBpdGVtLmRpc3Bvc2UoKTtcblx0ICAgIH0gZWxzZSB7XG5cdCAgICAgIHRoaXMuZGlzcG9zYWJsZXMucHVzaChpdGVtKTtcblx0ICAgICAgdGhpcy5sZW5ndGgrKztcblx0ICAgIH1cblx0ICB9O1xuXHRcblx0ICAvKipcblx0ICAgKiBSZW1vdmVzIGFuZCBkaXNwb3NlcyB0aGUgZmlyc3Qgb2NjdXJyZW5jZSBvZiBhIGRpc3Bvc2FibGUgZnJvbSB0aGUgQ29tcG9zaXRlRGlzcG9zYWJsZS5cblx0ICAgKiBAcGFyYW0ge01peGVkfSBpdGVtIERpc3Bvc2FibGUgdG8gcmVtb3ZlLlxuXHQgICAqIEByZXR1cm5zIHtCb29sZWFufSB0cnVlIGlmIGZvdW5kOyBmYWxzZSBvdGhlcndpc2UuXG5cdCAgICovXG5cdCAgQ29tcG9zaXRlRGlzcG9zYWJsZVByb3RvdHlwZS5yZW1vdmUgPSBmdW5jdGlvbiAoaXRlbSkge1xuXHQgICAgdmFyIHNob3VsZERpc3Bvc2UgPSBmYWxzZTtcblx0ICAgIGlmICghdGhpcy5pc0Rpc3Bvc2VkKSB7XG5cdCAgICAgIHZhciBpZHggPSB0aGlzLmRpc3Bvc2FibGVzLmluZGV4T2YoaXRlbSk7XG5cdCAgICAgIGlmIChpZHggIT09IC0xKSB7XG5cdCAgICAgICAgc2hvdWxkRGlzcG9zZSA9IHRydWU7XG5cdCAgICAgICAgdGhpcy5kaXNwb3NhYmxlcy5zcGxpY2UoaWR4LCAxKTtcblx0ICAgICAgICB0aGlzLmxlbmd0aC0tO1xuXHQgICAgICAgIGl0ZW0uZGlzcG9zZSgpO1xuXHQgICAgICB9XG5cdCAgICB9XG5cdCAgICByZXR1cm4gc2hvdWxkRGlzcG9zZTtcblx0ICB9O1xuXHRcblx0ICAvKipcblx0ICAgKiAgRGlzcG9zZXMgYWxsIGRpc3Bvc2FibGVzIGluIHRoZSBncm91cCBhbmQgcmVtb3ZlcyB0aGVtIGZyb20gdGhlIGdyb3VwLlxuXHQgICAqL1xuXHQgIENvbXBvc2l0ZURpc3Bvc2FibGVQcm90b3R5cGUuZGlzcG9zZSA9IGZ1bmN0aW9uICgpIHtcblx0ICAgIGlmICghdGhpcy5pc0Rpc3Bvc2VkKSB7XG5cdCAgICAgIHRoaXMuaXNEaXNwb3NlZCA9IHRydWU7XG5cdCAgICAgIHZhciBsZW4gPSB0aGlzLmRpc3Bvc2FibGVzLmxlbmd0aCwgY3VycmVudERpc3Bvc2FibGVzID0gbmV3IEFycmF5KGxlbik7XG5cdCAgICAgIGZvcih2YXIgaSA9IDA7IGkgPCBsZW47IGkrKykgeyBjdXJyZW50RGlzcG9zYWJsZXNbaV0gPSB0aGlzLmRpc3Bvc2FibGVzW2ldOyB9XG5cdCAgICAgIHRoaXMuZGlzcG9zYWJsZXMgPSBbXTtcblx0ICAgICAgdGhpcy5sZW5ndGggPSAwO1xuXHRcblx0ICAgICAgZm9yIChpID0gMDsgaSA8IGxlbjsgaSsrKSB7XG5cdCAgICAgICAgY3VycmVudERpc3Bvc2FibGVzW2ldLmRpc3Bvc2UoKTtcblx0ICAgICAgfVxuXHQgICAgfVxuXHQgIH07XG5cdFxuXHQgIC8qKlxuXHQgICAqIFByb3ZpZGVzIGEgc2V0IG9mIHN0YXRpYyBtZXRob2RzIGZvciBjcmVhdGluZyBEaXNwb3NhYmxlcy5cblx0ICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBkaXNwb3NlIEFjdGlvbiB0byBydW4gZHVyaW5nIHRoZSBmaXJzdCBjYWxsIHRvIGRpc3Bvc2UuIFRoZSBhY3Rpb24gaXMgZ3VhcmFudGVlZCB0byBiZSBydW4gYXQgbW9zdCBvbmNlLlxuXHQgICAqL1xuXHQgIHZhciBEaXNwb3NhYmxlID0gUnguRGlzcG9zYWJsZSA9IGZ1bmN0aW9uIChhY3Rpb24pIHtcblx0ICAgIHRoaXMuaXNEaXNwb3NlZCA9IGZhbHNlO1xuXHQgICAgdGhpcy5hY3Rpb24gPSBhY3Rpb24gfHwgbm9vcDtcblx0ICB9O1xuXHRcblx0ICAvKiogUGVyZm9ybXMgdGhlIHRhc2sgb2YgY2xlYW5pbmcgdXAgcmVzb3VyY2VzLiAqL1xuXHQgIERpc3Bvc2FibGUucHJvdG90eXBlLmRpc3Bvc2UgPSBmdW5jdGlvbiAoKSB7XG5cdCAgICBpZiAoIXRoaXMuaXNEaXNwb3NlZCkge1xuXHQgICAgICB0aGlzLmFjdGlvbigpO1xuXHQgICAgICB0aGlzLmlzRGlzcG9zZWQgPSB0cnVlO1xuXHQgICAgfVxuXHQgIH07XG5cdFxuXHQgIC8qKlxuXHQgICAqIENyZWF0ZXMgYSBkaXNwb3NhYmxlIG9iamVjdCB0aGF0IGludm9rZXMgdGhlIHNwZWNpZmllZCBhY3Rpb24gd2hlbiBkaXNwb3NlZC5cblx0ICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBkaXNwb3NlIEFjdGlvbiB0byBydW4gZHVyaW5nIHRoZSBmaXJzdCBjYWxsIHRvIGRpc3Bvc2UuIFRoZSBhY3Rpb24gaXMgZ3VhcmFudGVlZCB0byBiZSBydW4gYXQgbW9zdCBvbmNlLlxuXHQgICAqIEByZXR1cm4ge0Rpc3Bvc2FibGV9IFRoZSBkaXNwb3NhYmxlIG9iamVjdCB0aGF0IHJ1bnMgdGhlIGdpdmVuIGFjdGlvbiB1cG9uIGRpc3Bvc2FsLlxuXHQgICAqL1xuXHQgIHZhciBkaXNwb3NhYmxlQ3JlYXRlID0gRGlzcG9zYWJsZS5jcmVhdGUgPSBmdW5jdGlvbiAoYWN0aW9uKSB7IHJldHVybiBuZXcgRGlzcG9zYWJsZShhY3Rpb24pOyB9O1xuXHRcblx0ICAvKipcblx0ICAgKiBHZXRzIHRoZSBkaXNwb3NhYmxlIHRoYXQgZG9lcyBub3RoaW5nIHdoZW4gZGlzcG9zZWQuXG5cdCAgICovXG5cdCAgdmFyIGRpc3Bvc2FibGVFbXB0eSA9IERpc3Bvc2FibGUuZW1wdHkgPSB7IGRpc3Bvc2U6IG5vb3AgfTtcblx0XG5cdCAgLyoqXG5cdCAgICogVmFsaWRhdGVzIHdoZXRoZXIgdGhlIGdpdmVuIG9iamVjdCBpcyBhIGRpc3Bvc2FibGVcblx0ICAgKiBAcGFyYW0ge09iamVjdH0gT2JqZWN0IHRvIHRlc3Qgd2hldGhlciBpdCBoYXMgYSBkaXNwb3NlIG1ldGhvZFxuXHQgICAqIEByZXR1cm5zIHtCb29sZWFufSB0cnVlIGlmIGEgZGlzcG9zYWJsZSBvYmplY3QsIGVsc2UgZmFsc2UuXG5cdCAgICovXG5cdCAgdmFyIGlzRGlzcG9zYWJsZSA9IERpc3Bvc2FibGUuaXNEaXNwb3NhYmxlID0gZnVuY3Rpb24gKGQpIHtcblx0ICAgIHJldHVybiBkICYmIGlzRnVuY3Rpb24oZC5kaXNwb3NlKTtcblx0ICB9O1xuXHRcblx0ICB2YXIgY2hlY2tEaXNwb3NlZCA9IERpc3Bvc2FibGUuY2hlY2tEaXNwb3NlZCA9IGZ1bmN0aW9uIChkaXNwb3NhYmxlKSB7XG5cdCAgICBpZiAoZGlzcG9zYWJsZS5pc0Rpc3Bvc2VkKSB7IHRocm93IG5ldyBPYmplY3REaXNwb3NlZEVycm9yKCk7IH1cblx0ICB9O1xuXHRcblx0ICB2YXIgZGlzcG9zYWJsZUZpeHVwID0gRGlzcG9zYWJsZS5fZml4dXAgPSBmdW5jdGlvbiAocmVzdWx0KSB7XG5cdCAgICByZXR1cm4gaXNEaXNwb3NhYmxlKHJlc3VsdCkgPyByZXN1bHQgOiBkaXNwb3NhYmxlRW1wdHk7XG5cdCAgfTtcblx0XG5cdCAgLy8gU2luZ2xlIGFzc2lnbm1lbnRcblx0ICB2YXIgU2luZ2xlQXNzaWdubWVudERpc3Bvc2FibGUgPSBSeC5TaW5nbGVBc3NpZ25tZW50RGlzcG9zYWJsZSA9IGZ1bmN0aW9uICgpIHtcblx0ICAgIHRoaXMuaXNEaXNwb3NlZCA9IGZhbHNlO1xuXHQgICAgdGhpcy5jdXJyZW50ID0gbnVsbDtcblx0ICB9O1xuXHQgIFNpbmdsZUFzc2lnbm1lbnREaXNwb3NhYmxlLnByb3RvdHlwZS5nZXREaXNwb3NhYmxlID0gZnVuY3Rpb24gKCkge1xuXHQgICAgcmV0dXJuIHRoaXMuY3VycmVudDtcblx0ICB9O1xuXHQgIFNpbmdsZUFzc2lnbm1lbnREaXNwb3NhYmxlLnByb3RvdHlwZS5zZXREaXNwb3NhYmxlID0gZnVuY3Rpb24gKHZhbHVlKSB7XG5cdCAgICBpZiAodGhpcy5jdXJyZW50KSB7IHRocm93IG5ldyBFcnJvcignRGlzcG9zYWJsZSBoYXMgYWxyZWFkeSBiZWVuIGFzc2lnbmVkJyk7IH1cblx0ICAgIHZhciBzaG91bGREaXNwb3NlID0gdGhpcy5pc0Rpc3Bvc2VkO1xuXHQgICAgIXNob3VsZERpc3Bvc2UgJiYgKHRoaXMuY3VycmVudCA9IHZhbHVlKTtcblx0ICAgIHNob3VsZERpc3Bvc2UgJiYgdmFsdWUgJiYgdmFsdWUuZGlzcG9zZSgpO1xuXHQgIH07XG5cdCAgU2luZ2xlQXNzaWdubWVudERpc3Bvc2FibGUucHJvdG90eXBlLmRpc3Bvc2UgPSBmdW5jdGlvbiAoKSB7XG5cdCAgICBpZiAoIXRoaXMuaXNEaXNwb3NlZCkge1xuXHQgICAgICB0aGlzLmlzRGlzcG9zZWQgPSB0cnVlO1xuXHQgICAgICB2YXIgb2xkID0gdGhpcy5jdXJyZW50O1xuXHQgICAgICB0aGlzLmN1cnJlbnQgPSBudWxsO1xuXHQgICAgICBvbGQgJiYgb2xkLmRpc3Bvc2UoKTtcblx0ICAgIH1cblx0ICB9O1xuXHRcblx0ICAvLyBNdWx0aXBsZSBhc3NpZ25tZW50IGRpc3Bvc2FibGVcblx0ICB2YXIgU2VyaWFsRGlzcG9zYWJsZSA9IFJ4LlNlcmlhbERpc3Bvc2FibGUgPSBmdW5jdGlvbiAoKSB7XG5cdCAgICB0aGlzLmlzRGlzcG9zZWQgPSBmYWxzZTtcblx0ICAgIHRoaXMuY3VycmVudCA9IG51bGw7XG5cdCAgfTtcblx0ICBTZXJpYWxEaXNwb3NhYmxlLnByb3RvdHlwZS5nZXREaXNwb3NhYmxlID0gZnVuY3Rpb24gKCkge1xuXHQgICAgcmV0dXJuIHRoaXMuY3VycmVudDtcblx0ICB9O1xuXHQgIFNlcmlhbERpc3Bvc2FibGUucHJvdG90eXBlLnNldERpc3Bvc2FibGUgPSBmdW5jdGlvbiAodmFsdWUpIHtcblx0ICAgIHZhciBzaG91bGREaXNwb3NlID0gdGhpcy5pc0Rpc3Bvc2VkO1xuXHQgICAgaWYgKCFzaG91bGREaXNwb3NlKSB7XG5cdCAgICAgIHZhciBvbGQgPSB0aGlzLmN1cnJlbnQ7XG5cdCAgICAgIHRoaXMuY3VycmVudCA9IHZhbHVlO1xuXHQgICAgfVxuXHQgICAgb2xkICYmIG9sZC5kaXNwb3NlKCk7XG5cdCAgICBzaG91bGREaXNwb3NlICYmIHZhbHVlICYmIHZhbHVlLmRpc3Bvc2UoKTtcblx0ICB9O1xuXHQgIFNlcmlhbERpc3Bvc2FibGUucHJvdG90eXBlLmRpc3Bvc2UgPSBmdW5jdGlvbiAoKSB7XG5cdCAgICBpZiAoIXRoaXMuaXNEaXNwb3NlZCkge1xuXHQgICAgICB0aGlzLmlzRGlzcG9zZWQgPSB0cnVlO1xuXHQgICAgICB2YXIgb2xkID0gdGhpcy5jdXJyZW50O1xuXHQgICAgICB0aGlzLmN1cnJlbnQgPSBudWxsO1xuXHQgICAgfVxuXHQgICAgb2xkICYmIG9sZC5kaXNwb3NlKCk7XG5cdCAgfTtcblx0XG5cdCAgdmFyIEJpbmFyeURpc3Bvc2FibGUgPSBSeC5CaW5hcnlEaXNwb3NhYmxlID0gZnVuY3Rpb24gKGZpcnN0LCBzZWNvbmQpIHtcblx0ICAgIHRoaXMuX2ZpcnN0ID0gZmlyc3Q7XG5cdCAgICB0aGlzLl9zZWNvbmQgPSBzZWNvbmQ7XG5cdCAgICB0aGlzLmlzRGlzcG9zZWQgPSBmYWxzZTtcblx0ICB9O1xuXHRcblx0ICBCaW5hcnlEaXNwb3NhYmxlLnByb3RvdHlwZS5kaXNwb3NlID0gZnVuY3Rpb24gKCkge1xuXHQgICAgaWYgKCF0aGlzLmlzRGlzcG9zZWQpIHtcblx0ICAgICAgdGhpcy5pc0Rpc3Bvc2VkID0gdHJ1ZTtcblx0ICAgICAgdmFyIG9sZDEgPSB0aGlzLl9maXJzdDtcblx0ICAgICAgdGhpcy5fZmlyc3QgPSBudWxsO1xuXHQgICAgICBvbGQxICYmIG9sZDEuZGlzcG9zZSgpO1xuXHQgICAgICB2YXIgb2xkMiA9IHRoaXMuX3NlY29uZDtcblx0ICAgICAgdGhpcy5fc2Vjb25kID0gbnVsbDtcblx0ICAgICAgb2xkMiAmJiBvbGQyLmRpc3Bvc2UoKTtcblx0ICAgIH1cblx0ICB9O1xuXHRcblx0ICB2YXIgTkFyeURpc3Bvc2FibGUgPSBSeC5OQXJ5RGlzcG9zYWJsZSA9IGZ1bmN0aW9uIChkaXNwb3NhYmxlcykge1xuXHQgICAgdGhpcy5fZGlzcG9zYWJsZXMgPSBkaXNwb3NhYmxlcztcblx0ICAgIHRoaXMuaXNEaXNwb3NlZCA9IGZhbHNlO1xuXHQgIH07XG5cdFxuXHQgIE5BcnlEaXNwb3NhYmxlLnByb3RvdHlwZS5kaXNwb3NlID0gZnVuY3Rpb24gKCkge1xuXHQgICAgaWYgKCF0aGlzLmlzRGlzcG9zZWQpIHtcblx0ICAgICAgdGhpcy5pc0Rpc3Bvc2VkID0gdHJ1ZTtcblx0ICAgICAgZm9yICh2YXIgaSA9IDAsIGxlbiA9IHRoaXMuX2Rpc3Bvc2FibGVzLmxlbmd0aDsgaSA8IGxlbjsgaSsrKSB7XG5cdCAgICAgICAgdGhpcy5fZGlzcG9zYWJsZXNbaV0uZGlzcG9zZSgpO1xuXHQgICAgICB9XG5cdCAgICAgIHRoaXMuX2Rpc3Bvc2FibGVzLmxlbmd0aCA9IDA7XG5cdCAgICB9XG5cdCAgfTtcblx0XG5cdCAgLyoqXG5cdCAgICogUmVwcmVzZW50cyBhIGRpc3Bvc2FibGUgcmVzb3VyY2UgdGhhdCBvbmx5IGRpc3Bvc2VzIGl0cyB1bmRlcmx5aW5nIGRpc3Bvc2FibGUgcmVzb3VyY2Ugd2hlbiBhbGwgZGVwZW5kZW50IGRpc3Bvc2FibGUgb2JqZWN0cyBoYXZlIGJlZW4gZGlzcG9zZWQuXG5cdCAgICovXG5cdCAgdmFyIFJlZkNvdW50RGlzcG9zYWJsZSA9IFJ4LlJlZkNvdW50RGlzcG9zYWJsZSA9IChmdW5jdGlvbiAoKSB7XG5cdFxuXHQgICAgZnVuY3Rpb24gSW5uZXJEaXNwb3NhYmxlKGRpc3Bvc2FibGUpIHtcblx0ICAgICAgdGhpcy5kaXNwb3NhYmxlID0gZGlzcG9zYWJsZTtcblx0ICAgICAgdGhpcy5kaXNwb3NhYmxlLmNvdW50Kys7XG5cdCAgICAgIHRoaXMuaXNJbm5lckRpc3Bvc2VkID0gZmFsc2U7XG5cdCAgICB9XG5cdFxuXHQgICAgSW5uZXJEaXNwb3NhYmxlLnByb3RvdHlwZS5kaXNwb3NlID0gZnVuY3Rpb24gKCkge1xuXHQgICAgICBpZiAoIXRoaXMuZGlzcG9zYWJsZS5pc0Rpc3Bvc2VkICYmICF0aGlzLmlzSW5uZXJEaXNwb3NlZCkge1xuXHQgICAgICAgIHRoaXMuaXNJbm5lckRpc3Bvc2VkID0gdHJ1ZTtcblx0ICAgICAgICB0aGlzLmRpc3Bvc2FibGUuY291bnQtLTtcblx0ICAgICAgICBpZiAodGhpcy5kaXNwb3NhYmxlLmNvdW50ID09PSAwICYmIHRoaXMuZGlzcG9zYWJsZS5pc1ByaW1hcnlEaXNwb3NlZCkge1xuXHQgICAgICAgICAgdGhpcy5kaXNwb3NhYmxlLmlzRGlzcG9zZWQgPSB0cnVlO1xuXHQgICAgICAgICAgdGhpcy5kaXNwb3NhYmxlLnVuZGVybHlpbmdEaXNwb3NhYmxlLmRpc3Bvc2UoKTtcblx0ICAgICAgICB9XG5cdCAgICAgIH1cblx0ICAgIH07XG5cdFxuXHQgICAgLyoqXG5cdCAgICAgKiBJbml0aWFsaXplcyBhIG5ldyBpbnN0YW5jZSBvZiB0aGUgUmVmQ291bnREaXNwb3NhYmxlIHdpdGggdGhlIHNwZWNpZmllZCBkaXNwb3NhYmxlLlxuXHQgICAgICogQGNvbnN0cnVjdG9yXG5cdCAgICAgKiBAcGFyYW0ge0Rpc3Bvc2FibGV9IGRpc3Bvc2FibGUgVW5kZXJseWluZyBkaXNwb3NhYmxlLlxuXHQgICAgICAqL1xuXHQgICAgZnVuY3Rpb24gUmVmQ291bnREaXNwb3NhYmxlKGRpc3Bvc2FibGUpIHtcblx0ICAgICAgdGhpcy51bmRlcmx5aW5nRGlzcG9zYWJsZSA9IGRpc3Bvc2FibGU7XG5cdCAgICAgIHRoaXMuaXNEaXNwb3NlZCA9IGZhbHNlO1xuXHQgICAgICB0aGlzLmlzUHJpbWFyeURpc3Bvc2VkID0gZmFsc2U7XG5cdCAgICAgIHRoaXMuY291bnQgPSAwO1xuXHQgICAgfVxuXHRcblx0ICAgIC8qKlxuXHQgICAgICogRGlzcG9zZXMgdGhlIHVuZGVybHlpbmcgZGlzcG9zYWJsZSBvbmx5IHdoZW4gYWxsIGRlcGVuZGVudCBkaXNwb3NhYmxlcyBoYXZlIGJlZW4gZGlzcG9zZWRcblx0ICAgICAqL1xuXHQgICAgUmVmQ291bnREaXNwb3NhYmxlLnByb3RvdHlwZS5kaXNwb3NlID0gZnVuY3Rpb24gKCkge1xuXHQgICAgICBpZiAoIXRoaXMuaXNEaXNwb3NlZCAmJiAhdGhpcy5pc1ByaW1hcnlEaXNwb3NlZCkge1xuXHQgICAgICAgIHRoaXMuaXNQcmltYXJ5RGlzcG9zZWQgPSB0cnVlO1xuXHQgICAgICAgIGlmICh0aGlzLmNvdW50ID09PSAwKSB7XG5cdCAgICAgICAgICB0aGlzLmlzRGlzcG9zZWQgPSB0cnVlO1xuXHQgICAgICAgICAgdGhpcy51bmRlcmx5aW5nRGlzcG9zYWJsZS5kaXNwb3NlKCk7XG5cdCAgICAgICAgfVxuXHQgICAgICB9XG5cdCAgICB9O1xuXHRcblx0ICAgIC8qKlxuXHQgICAgICogUmV0dXJucyBhIGRlcGVuZGVudCBkaXNwb3NhYmxlIHRoYXQgd2hlbiBkaXNwb3NlZCBkZWNyZWFzZXMgdGhlIHJlZmNvdW50IG9uIHRoZSB1bmRlcmx5aW5nIGRpc3Bvc2FibGUuXG5cdCAgICAgKiBAcmV0dXJucyB7RGlzcG9zYWJsZX0gQSBkZXBlbmRlbnQgZGlzcG9zYWJsZSBjb250cmlidXRpbmcgdG8gdGhlIHJlZmVyZW5jZSBjb3VudCB0aGF0IG1hbmFnZXMgdGhlIHVuZGVybHlpbmcgZGlzcG9zYWJsZSdzIGxpZmV0aW1lLlxuXHQgICAgICovXG5cdCAgICBSZWZDb3VudERpc3Bvc2FibGUucHJvdG90eXBlLmdldERpc3Bvc2FibGUgPSBmdW5jdGlvbiAoKSB7XG5cdCAgICAgIHJldHVybiB0aGlzLmlzRGlzcG9zZWQgPyBkaXNwb3NhYmxlRW1wdHkgOiBuZXcgSW5uZXJEaXNwb3NhYmxlKHRoaXMpO1xuXHQgICAgfTtcblx0XG5cdCAgICByZXR1cm4gUmVmQ291bnREaXNwb3NhYmxlO1xuXHQgIH0pKCk7XG5cdFxuXHQgIGZ1bmN0aW9uIFNjaGVkdWxlZERpc3Bvc2FibGUoc2NoZWR1bGVyLCBkaXNwb3NhYmxlKSB7XG5cdCAgICB0aGlzLnNjaGVkdWxlciA9IHNjaGVkdWxlcjtcblx0ICAgIHRoaXMuZGlzcG9zYWJsZSA9IGRpc3Bvc2FibGU7XG5cdCAgICB0aGlzLmlzRGlzcG9zZWQgPSBmYWxzZTtcblx0ICB9XG5cdFxuXHQgIGZ1bmN0aW9uIHNjaGVkdWxlSXRlbShzLCBzZWxmKSB7XG5cdCAgICBpZiAoIXNlbGYuaXNEaXNwb3NlZCkge1xuXHQgICAgICBzZWxmLmlzRGlzcG9zZWQgPSB0cnVlO1xuXHQgICAgICBzZWxmLmRpc3Bvc2FibGUuZGlzcG9zZSgpO1xuXHQgICAgfVxuXHQgIH1cblx0XG5cdCAgU2NoZWR1bGVkRGlzcG9zYWJsZS5wcm90b3R5cGUuZGlzcG9zZSA9IGZ1bmN0aW9uICgpIHtcblx0ICAgIHRoaXMuc2NoZWR1bGVyLnNjaGVkdWxlKHRoaXMsIHNjaGVkdWxlSXRlbSk7XG5cdCAgfTtcblx0XG5cdCAgdmFyIFNjaGVkdWxlZEl0ZW0gPSBSeC5pbnRlcm5hbHMuU2NoZWR1bGVkSXRlbSA9IGZ1bmN0aW9uIChzY2hlZHVsZXIsIHN0YXRlLCBhY3Rpb24sIGR1ZVRpbWUsIGNvbXBhcmVyKSB7XG5cdCAgICB0aGlzLnNjaGVkdWxlciA9IHNjaGVkdWxlcjtcblx0ICAgIHRoaXMuc3RhdGUgPSBzdGF0ZTtcblx0ICAgIHRoaXMuYWN0aW9uID0gYWN0aW9uO1xuXHQgICAgdGhpcy5kdWVUaW1lID0gZHVlVGltZTtcblx0ICAgIHRoaXMuY29tcGFyZXIgPSBjb21wYXJlciB8fCBkZWZhdWx0U3ViQ29tcGFyZXI7XG5cdCAgICB0aGlzLmRpc3Bvc2FibGUgPSBuZXcgU2luZ2xlQXNzaWdubWVudERpc3Bvc2FibGUoKTtcblx0ICB9XG5cdFxuXHQgIFNjaGVkdWxlZEl0ZW0ucHJvdG90eXBlLmludm9rZSA9IGZ1bmN0aW9uICgpIHtcblx0ICAgIHRoaXMuZGlzcG9zYWJsZS5zZXREaXNwb3NhYmxlKHRoaXMuaW52b2tlQ29yZSgpKTtcblx0ICB9O1xuXHRcblx0ICBTY2hlZHVsZWRJdGVtLnByb3RvdHlwZS5jb21wYXJlVG8gPSBmdW5jdGlvbiAob3RoZXIpIHtcblx0ICAgIHJldHVybiB0aGlzLmNvbXBhcmVyKHRoaXMuZHVlVGltZSwgb3RoZXIuZHVlVGltZSk7XG5cdCAgfTtcblx0XG5cdCAgU2NoZWR1bGVkSXRlbS5wcm90b3R5cGUuaXNDYW5jZWxsZWQgPSBmdW5jdGlvbiAoKSB7XG5cdCAgICByZXR1cm4gdGhpcy5kaXNwb3NhYmxlLmlzRGlzcG9zZWQ7XG5cdCAgfTtcblx0XG5cdCAgU2NoZWR1bGVkSXRlbS5wcm90b3R5cGUuaW52b2tlQ29yZSA9IGZ1bmN0aW9uICgpIHtcblx0ICAgIHJldHVybiBkaXNwb3NhYmxlRml4dXAodGhpcy5hY3Rpb24odGhpcy5zY2hlZHVsZXIsIHRoaXMuc3RhdGUpKTtcblx0ICB9O1xuXHRcblx0ICAvKiogUHJvdmlkZXMgYSBzZXQgb2Ygc3RhdGljIHByb3BlcnRpZXMgdG8gYWNjZXNzIGNvbW1vbmx5IHVzZWQgc2NoZWR1bGVycy4gKi9cblx0ICB2YXIgU2NoZWR1bGVyID0gUnguU2NoZWR1bGVyID0gKGZ1bmN0aW9uICgpIHtcblx0XG5cdCAgICBmdW5jdGlvbiBTY2hlZHVsZXIoKSB7IH1cblx0XG5cdCAgICAvKiogRGV0ZXJtaW5lcyB3aGV0aGVyIHRoZSBnaXZlbiBvYmplY3QgaXMgYSBzY2hlZHVsZXIgKi9cblx0ICAgIFNjaGVkdWxlci5pc1NjaGVkdWxlciA9IGZ1bmN0aW9uIChzKSB7XG5cdCAgICAgIHJldHVybiBzIGluc3RhbmNlb2YgU2NoZWR1bGVyO1xuXHQgICAgfTtcblx0XG5cdCAgICB2YXIgc2NoZWR1bGVyUHJvdG8gPSBTY2hlZHVsZXIucHJvdG90eXBlO1xuXHRcblx0ICAgIC8qKlxuXHQgICAqIFNjaGVkdWxlcyBhbiBhY3Rpb24gdG8gYmUgZXhlY3V0ZWQuXG5cdCAgICogQHBhcmFtIHN0YXRlIFN0YXRlIHBhc3NlZCB0byB0aGUgYWN0aW9uIHRvIGJlIGV4ZWN1dGVkLlxuXHQgICAqIEBwYXJhbSB7RnVuY3Rpb259IGFjdGlvbiBBY3Rpb24gdG8gYmUgZXhlY3V0ZWQuXG5cdCAgICogQHJldHVybnMge0Rpc3Bvc2FibGV9IFRoZSBkaXNwb3NhYmxlIG9iamVjdCB1c2VkIHRvIGNhbmNlbCB0aGUgc2NoZWR1bGVkIGFjdGlvbiAoYmVzdCBlZmZvcnQpLlxuXHQgICAqL1xuXHQgICAgc2NoZWR1bGVyUHJvdG8uc2NoZWR1bGUgPSBmdW5jdGlvbiAoc3RhdGUsIGFjdGlvbikge1xuXHQgICAgICB0aHJvdyBuZXcgTm90SW1wbGVtZW50ZWRFcnJvcigpO1xuXHQgICAgfTtcblx0XG5cdCAgLyoqXG5cdCAgICogU2NoZWR1bGVzIGFuIGFjdGlvbiB0byBiZSBleGVjdXRlZCBhZnRlciBkdWVUaW1lLlxuXHQgICAqIEBwYXJhbSBzdGF0ZSBTdGF0ZSBwYXNzZWQgdG8gdGhlIGFjdGlvbiB0byBiZSBleGVjdXRlZC5cblx0ICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBhY3Rpb24gQWN0aW9uIHRvIGJlIGV4ZWN1dGVkLlxuXHQgICAqIEBwYXJhbSB7TnVtYmVyfSBkdWVUaW1lIFJlbGF0aXZlIHRpbWUgYWZ0ZXIgd2hpY2ggdG8gZXhlY3V0ZSB0aGUgYWN0aW9uLlxuXHQgICAqIEByZXR1cm5zIHtEaXNwb3NhYmxlfSBUaGUgZGlzcG9zYWJsZSBvYmplY3QgdXNlZCB0byBjYW5jZWwgdGhlIHNjaGVkdWxlZCBhY3Rpb24gKGJlc3QgZWZmb3J0KS5cblx0ICAgKi9cblx0ICAgIHNjaGVkdWxlclByb3RvLnNjaGVkdWxlRnV0dXJlID0gZnVuY3Rpb24gKHN0YXRlLCBkdWVUaW1lLCBhY3Rpb24pIHtcblx0ICAgICAgdmFyIGR0ID0gZHVlVGltZTtcblx0ICAgICAgZHQgaW5zdGFuY2VvZiBEYXRlICYmIChkdCA9IGR0IC0gdGhpcy5ub3coKSk7XG5cdCAgICAgIGR0ID0gU2NoZWR1bGVyLm5vcm1hbGl6ZShkdCk7XG5cdFxuXHQgICAgICBpZiAoZHQgPT09IDApIHsgcmV0dXJuIHRoaXMuc2NoZWR1bGUoc3RhdGUsIGFjdGlvbik7IH1cblx0XG5cdCAgICAgIHJldHVybiB0aGlzLl9zY2hlZHVsZUZ1dHVyZShzdGF0ZSwgZHQsIGFjdGlvbik7XG5cdCAgICB9O1xuXHRcblx0ICAgIHNjaGVkdWxlclByb3RvLl9zY2hlZHVsZUZ1dHVyZSA9IGZ1bmN0aW9uIChzdGF0ZSwgZHVlVGltZSwgYWN0aW9uKSB7XG5cdCAgICAgIHRocm93IG5ldyBOb3RJbXBsZW1lbnRlZEVycm9yKCk7XG5cdCAgICB9O1xuXHRcblx0ICAgIC8qKiBHZXRzIHRoZSBjdXJyZW50IHRpbWUgYWNjb3JkaW5nIHRvIHRoZSBsb2NhbCBtYWNoaW5lJ3Mgc3lzdGVtIGNsb2NrLiAqL1xuXHQgICAgU2NoZWR1bGVyLm5vdyA9IGRlZmF1bHROb3c7XG5cdFxuXHQgICAgLyoqIEdldHMgdGhlIGN1cnJlbnQgdGltZSBhY2NvcmRpbmcgdG8gdGhlIGxvY2FsIG1hY2hpbmUncyBzeXN0ZW0gY2xvY2suICovXG5cdCAgICBTY2hlZHVsZXIucHJvdG90eXBlLm5vdyA9IGRlZmF1bHROb3c7XG5cdFxuXHQgICAgLyoqXG5cdCAgICAgKiBOb3JtYWxpemVzIHRoZSBzcGVjaWZpZWQgVGltZVNwYW4gdmFsdWUgdG8gYSBwb3NpdGl2ZSB2YWx1ZS5cblx0ICAgICAqIEBwYXJhbSB7TnVtYmVyfSB0aW1lU3BhbiBUaGUgdGltZSBzcGFuIHZhbHVlIHRvIG5vcm1hbGl6ZS5cblx0ICAgICAqIEByZXR1cm5zIHtOdW1iZXJ9IFRoZSBzcGVjaWZpZWQgVGltZVNwYW4gdmFsdWUgaWYgaXQgaXMgemVybyBvciBwb3NpdGl2ZTsgb3RoZXJ3aXNlLCAwXG5cdCAgICAgKi9cblx0ICAgIFNjaGVkdWxlci5ub3JtYWxpemUgPSBmdW5jdGlvbiAodGltZVNwYW4pIHtcblx0ICAgICAgdGltZVNwYW4gPCAwICYmICh0aW1lU3BhbiA9IDApO1xuXHQgICAgICByZXR1cm4gdGltZVNwYW47XG5cdCAgICB9O1xuXHRcblx0ICAgIHJldHVybiBTY2hlZHVsZXI7XG5cdCAgfSgpKTtcblx0XG5cdCAgdmFyIG5vcm1hbGl6ZVRpbWUgPSBTY2hlZHVsZXIubm9ybWFsaXplLCBpc1NjaGVkdWxlciA9IFNjaGVkdWxlci5pc1NjaGVkdWxlcjtcblx0XG5cdCAgKGZ1bmN0aW9uIChzY2hlZHVsZXJQcm90bykge1xuXHRcblx0ICAgIGZ1bmN0aW9uIGludm9rZVJlY0ltbWVkaWF0ZShzY2hlZHVsZXIsIHBhaXIpIHtcblx0ICAgICAgdmFyIHN0YXRlID0gcGFpclswXSwgYWN0aW9uID0gcGFpclsxXSwgZ3JvdXAgPSBuZXcgQ29tcG9zaXRlRGlzcG9zYWJsZSgpO1xuXHQgICAgICBhY3Rpb24oc3RhdGUsIGlubmVyQWN0aW9uKTtcblx0ICAgICAgcmV0dXJuIGdyb3VwO1xuXHRcblx0ICAgICAgZnVuY3Rpb24gaW5uZXJBY3Rpb24oc3RhdGUyKSB7XG5cdCAgICAgICAgdmFyIGlzQWRkZWQgPSBmYWxzZSwgaXNEb25lID0gZmFsc2U7XG5cdFxuXHQgICAgICAgIHZhciBkID0gc2NoZWR1bGVyLnNjaGVkdWxlKHN0YXRlMiwgc2NoZWR1bGVXb3JrKTtcblx0ICAgICAgICBpZiAoIWlzRG9uZSkge1xuXHQgICAgICAgICAgZ3JvdXAuYWRkKGQpO1xuXHQgICAgICAgICAgaXNBZGRlZCA9IHRydWU7XG5cdCAgICAgICAgfVxuXHRcblx0ICAgICAgICBmdW5jdGlvbiBzY2hlZHVsZVdvcmsoXywgc3RhdGUzKSB7XG5cdCAgICAgICAgICBpZiAoaXNBZGRlZCkge1xuXHQgICAgICAgICAgICBncm91cC5yZW1vdmUoZCk7XG5cdCAgICAgICAgICB9IGVsc2Uge1xuXHQgICAgICAgICAgICBpc0RvbmUgPSB0cnVlO1xuXHQgICAgICAgICAgfVxuXHQgICAgICAgICAgYWN0aW9uKHN0YXRlMywgaW5uZXJBY3Rpb24pO1xuXHQgICAgICAgICAgcmV0dXJuIGRpc3Bvc2FibGVFbXB0eTtcblx0ICAgICAgICB9XG5cdCAgICAgIH1cblx0ICAgIH1cblx0XG5cdCAgICBmdW5jdGlvbiBpbnZva2VSZWNEYXRlKHNjaGVkdWxlciwgcGFpcikge1xuXHQgICAgICB2YXIgc3RhdGUgPSBwYWlyWzBdLCBhY3Rpb24gPSBwYWlyWzFdLCBncm91cCA9IG5ldyBDb21wb3NpdGVEaXNwb3NhYmxlKCk7XG5cdCAgICAgIGFjdGlvbihzdGF0ZSwgaW5uZXJBY3Rpb24pO1xuXHQgICAgICByZXR1cm4gZ3JvdXA7XG5cdFxuXHQgICAgICBmdW5jdGlvbiBpbm5lckFjdGlvbihzdGF0ZTIsIGR1ZVRpbWUxKSB7XG5cdCAgICAgICAgdmFyIGlzQWRkZWQgPSBmYWxzZSwgaXNEb25lID0gZmFsc2U7XG5cdFxuXHQgICAgICAgIHZhciBkID0gc2NoZWR1bGVyLnNjaGVkdWxlRnV0dXJlKHN0YXRlMiwgZHVlVGltZTEsIHNjaGVkdWxlV29yayk7XG5cdCAgICAgICAgaWYgKCFpc0RvbmUpIHtcblx0ICAgICAgICAgIGdyb3VwLmFkZChkKTtcblx0ICAgICAgICAgIGlzQWRkZWQgPSB0cnVlO1xuXHQgICAgICAgIH1cblx0XG5cdCAgICAgICAgZnVuY3Rpb24gc2NoZWR1bGVXb3JrKF8sIHN0YXRlMykge1xuXHQgICAgICAgICAgaWYgKGlzQWRkZWQpIHtcblx0ICAgICAgICAgICAgZ3JvdXAucmVtb3ZlKGQpO1xuXHQgICAgICAgICAgfSBlbHNlIHtcblx0ICAgICAgICAgICAgaXNEb25lID0gdHJ1ZTtcblx0ICAgICAgICAgIH1cblx0ICAgICAgICAgIGFjdGlvbihzdGF0ZTMsIGlubmVyQWN0aW9uKTtcblx0ICAgICAgICAgIHJldHVybiBkaXNwb3NhYmxlRW1wdHk7XG5cdCAgICAgICAgfVxuXHQgICAgICB9XG5cdCAgICB9XG5cdFxuXHQgICAgLyoqXG5cdCAgICAgKiBTY2hlZHVsZXMgYW4gYWN0aW9uIHRvIGJlIGV4ZWN1dGVkIHJlY3Vyc2l2ZWx5LlxuXHQgICAgICogQHBhcmFtIHtNaXhlZH0gc3RhdGUgU3RhdGUgcGFzc2VkIHRvIHRoZSBhY3Rpb24gdG8gYmUgZXhlY3V0ZWQuXG5cdCAgICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBhY3Rpb24gQWN0aW9uIHRvIGV4ZWN1dGUgcmVjdXJzaXZlbHkuIFRoZSBsYXN0IHBhcmFtZXRlciBwYXNzZWQgdG8gdGhlIGFjdGlvbiBpcyB1c2VkIHRvIHRyaWdnZXIgcmVjdXJzaXZlIHNjaGVkdWxpbmcgb2YgdGhlIGFjdGlvbiwgcGFzc2luZyBpbiByZWN1cnNpdmUgaW52b2NhdGlvbiBzdGF0ZS5cblx0ICAgICAqIEByZXR1cm5zIHtEaXNwb3NhYmxlfSBUaGUgZGlzcG9zYWJsZSBvYmplY3QgdXNlZCB0byBjYW5jZWwgdGhlIHNjaGVkdWxlZCBhY3Rpb24gKGJlc3QgZWZmb3J0KS5cblx0ICAgICAqL1xuXHQgICAgc2NoZWR1bGVyUHJvdG8uc2NoZWR1bGVSZWN1cnNpdmUgPSBmdW5jdGlvbiAoc3RhdGUsIGFjdGlvbikge1xuXHQgICAgICByZXR1cm4gdGhpcy5zY2hlZHVsZShbc3RhdGUsIGFjdGlvbl0sIGludm9rZVJlY0ltbWVkaWF0ZSk7XG5cdCAgICB9O1xuXHRcblx0ICAgIC8qKlxuXHQgICAgICogU2NoZWR1bGVzIGFuIGFjdGlvbiB0byBiZSBleGVjdXRlZCByZWN1cnNpdmVseSBhZnRlciBhIHNwZWNpZmllZCByZWxhdGl2ZSBvciBhYnNvbHV0ZSBkdWUgdGltZS5cblx0ICAgICAqIEBwYXJhbSB7TWl4ZWR9IHN0YXRlIFN0YXRlIHBhc3NlZCB0byB0aGUgYWN0aW9uIHRvIGJlIGV4ZWN1dGVkLlxuXHQgICAgICogQHBhcmFtIHtGdW5jdGlvbn0gYWN0aW9uIEFjdGlvbiB0byBleGVjdXRlIHJlY3Vyc2l2ZWx5LiBUaGUgbGFzdCBwYXJhbWV0ZXIgcGFzc2VkIHRvIHRoZSBhY3Rpb24gaXMgdXNlZCB0byB0cmlnZ2VyIHJlY3Vyc2l2ZSBzY2hlZHVsaW5nIG9mIHRoZSBhY3Rpb24sIHBhc3NpbmcgaW4gdGhlIHJlY3Vyc2l2ZSBkdWUgdGltZSBhbmQgaW52b2NhdGlvbiBzdGF0ZS5cblx0ICAgICAqIEBwYXJhbSB7TnVtYmVyIHwgRGF0ZX0gZHVlVGltZSBSZWxhdGl2ZSBvciBhYnNvbHV0ZSB0aW1lIGFmdGVyIHdoaWNoIHRvIGV4ZWN1dGUgdGhlIGFjdGlvbiBmb3IgdGhlIGZpcnN0IHRpbWUuXG5cdCAgICAgKiBAcmV0dXJucyB7RGlzcG9zYWJsZX0gVGhlIGRpc3Bvc2FibGUgb2JqZWN0IHVzZWQgdG8gY2FuY2VsIHRoZSBzY2hlZHVsZWQgYWN0aW9uIChiZXN0IGVmZm9ydCkuXG5cdCAgICAgKi9cblx0ICAgIHNjaGVkdWxlclByb3RvLnNjaGVkdWxlUmVjdXJzaXZlRnV0dXJlID0gZnVuY3Rpb24gKHN0YXRlLCBkdWVUaW1lLCBhY3Rpb24pIHtcblx0ICAgICAgcmV0dXJuIHRoaXMuc2NoZWR1bGVGdXR1cmUoW3N0YXRlLCBhY3Rpb25dLCBkdWVUaW1lLCBpbnZva2VSZWNEYXRlKTtcblx0ICAgIH07XG5cdFxuXHQgIH0oU2NoZWR1bGVyLnByb3RvdHlwZSkpO1xuXHRcblx0ICAoZnVuY3Rpb24gKHNjaGVkdWxlclByb3RvKSB7XG5cdFxuXHQgICAgLyoqXG5cdCAgICAgKiBTY2hlZHVsZXMgYSBwZXJpb2RpYyBwaWVjZSBvZiB3b3JrIGJ5IGR5bmFtaWNhbGx5IGRpc2NvdmVyaW5nIHRoZSBzY2hlZHVsZXIncyBjYXBhYmlsaXRpZXMuIFRoZSBwZXJpb2RpYyB0YXNrIHdpbGwgYmUgc2NoZWR1bGVkIHVzaW5nIHdpbmRvdy5zZXRJbnRlcnZhbCBmb3IgdGhlIGJhc2UgaW1wbGVtZW50YXRpb24uXG5cdCAgICAgKiBAcGFyYW0ge01peGVkfSBzdGF0ZSBJbml0aWFsIHN0YXRlIHBhc3NlZCB0byB0aGUgYWN0aW9uIHVwb24gdGhlIGZpcnN0IGl0ZXJhdGlvbi5cblx0ICAgICAqIEBwYXJhbSB7TnVtYmVyfSBwZXJpb2QgUGVyaW9kIGZvciBydW5uaW5nIHRoZSB3b3JrIHBlcmlvZGljYWxseS5cblx0ICAgICAqIEBwYXJhbSB7RnVuY3Rpb259IGFjdGlvbiBBY3Rpb24gdG8gYmUgZXhlY3V0ZWQsIHBvdGVudGlhbGx5IHVwZGF0aW5nIHRoZSBzdGF0ZS5cblx0ICAgICAqIEByZXR1cm5zIHtEaXNwb3NhYmxlfSBUaGUgZGlzcG9zYWJsZSBvYmplY3QgdXNlZCB0byBjYW5jZWwgdGhlIHNjaGVkdWxlZCByZWN1cnJpbmcgYWN0aW9uIChiZXN0IGVmZm9ydCkuXG5cdCAgICAgKi9cblx0ICAgIFNjaGVkdWxlci5wcm90b3R5cGUuc2NoZWR1bGVQZXJpb2RpYyA9IGZ1bmN0aW9uKHN0YXRlLCBwZXJpb2QsIGFjdGlvbikge1xuXHQgICAgICBpZiAodHlwZW9mIHJvb3Quc2V0SW50ZXJ2YWwgPT09ICd1bmRlZmluZWQnKSB7IHRocm93IG5ldyBOb3RTdXBwb3J0ZWRFcnJvcigpOyB9XG5cdCAgICAgIHBlcmlvZCA9IG5vcm1hbGl6ZVRpbWUocGVyaW9kKTtcblx0ICAgICAgdmFyIHMgPSBzdGF0ZSwgaWQgPSByb290LnNldEludGVydmFsKGZ1bmN0aW9uICgpIHsgcyA9IGFjdGlvbihzKTsgfSwgcGVyaW9kKTtcblx0ICAgICAgcmV0dXJuIGRpc3Bvc2FibGVDcmVhdGUoZnVuY3Rpb24gKCkgeyByb290LmNsZWFySW50ZXJ2YWwoaWQpOyB9KTtcblx0ICAgIH07XG5cdFxuXHQgIH0oU2NoZWR1bGVyLnByb3RvdHlwZSkpO1xuXHRcblx0ICAoZnVuY3Rpb24gKHNjaGVkdWxlclByb3RvKSB7XG5cdCAgICAvKipcblx0ICAgICAqIFJldHVybnMgYSBzY2hlZHVsZXIgdGhhdCB3cmFwcyB0aGUgb3JpZ2luYWwgc2NoZWR1bGVyLCBhZGRpbmcgZXhjZXB0aW9uIGhhbmRsaW5nIGZvciBzY2hlZHVsZWQgYWN0aW9ucy5cblx0ICAgICAqIEBwYXJhbSB7RnVuY3Rpb259IGhhbmRsZXIgSGFuZGxlciB0aGF0J3MgcnVuIGlmIGFuIGV4Y2VwdGlvbiBpcyBjYXVnaHQuIFRoZSBleGNlcHRpb24gd2lsbCBiZSByZXRocm93biBpZiB0aGUgaGFuZGxlciByZXR1cm5zIGZhbHNlLlxuXHQgICAgICogQHJldHVybnMge1NjaGVkdWxlcn0gV3JhcHBlciBhcm91bmQgdGhlIG9yaWdpbmFsIHNjaGVkdWxlciwgZW5mb3JjaW5nIGV4Y2VwdGlvbiBoYW5kbGluZy5cblx0ICAgICAqL1xuXHQgICAgc2NoZWR1bGVyUHJvdG8uY2F0Y2hFcnJvciA9IHNjaGVkdWxlclByb3RvWydjYXRjaCddID0gZnVuY3Rpb24gKGhhbmRsZXIpIHtcblx0ICAgICAgcmV0dXJuIG5ldyBDYXRjaFNjaGVkdWxlcih0aGlzLCBoYW5kbGVyKTtcblx0ICAgIH07XG5cdCAgfShTY2hlZHVsZXIucHJvdG90eXBlKSk7XG5cdFxuXHQgIHZhciBTY2hlZHVsZVBlcmlvZGljUmVjdXJzaXZlID0gUnguaW50ZXJuYWxzLlNjaGVkdWxlUGVyaW9kaWNSZWN1cnNpdmUgPSAoZnVuY3Rpb24gKCkge1xuXHQgICAgZnVuY3Rpb24gdGljayhjb21tYW5kLCByZWN1cnNlKSB7XG5cdCAgICAgIHJlY3Vyc2UoMCwgdGhpcy5fcGVyaW9kKTtcblx0ICAgICAgdHJ5IHtcblx0ICAgICAgICB0aGlzLl9zdGF0ZSA9IHRoaXMuX2FjdGlvbih0aGlzLl9zdGF0ZSk7XG5cdCAgICAgIH0gY2F0Y2ggKGUpIHtcblx0ICAgICAgICB0aGlzLl9jYW5jZWwuZGlzcG9zZSgpO1xuXHQgICAgICAgIHRocm93IGU7XG5cdCAgICAgIH1cblx0ICAgIH1cblx0XG5cdCAgICBmdW5jdGlvbiBTY2hlZHVsZVBlcmlvZGljUmVjdXJzaXZlKHNjaGVkdWxlciwgc3RhdGUsIHBlcmlvZCwgYWN0aW9uKSB7XG5cdCAgICAgIHRoaXMuX3NjaGVkdWxlciA9IHNjaGVkdWxlcjtcblx0ICAgICAgdGhpcy5fc3RhdGUgPSBzdGF0ZTtcblx0ICAgICAgdGhpcy5fcGVyaW9kID0gcGVyaW9kO1xuXHQgICAgICB0aGlzLl9hY3Rpb24gPSBhY3Rpb247XG5cdCAgICB9XG5cdFxuXHQgICAgU2NoZWR1bGVQZXJpb2RpY1JlY3Vyc2l2ZS5wcm90b3R5cGUuc3RhcnQgPSBmdW5jdGlvbiAoKSB7XG5cdCAgICAgIHZhciBkID0gbmV3IFNpbmdsZUFzc2lnbm1lbnREaXNwb3NhYmxlKCk7XG5cdCAgICAgIHRoaXMuX2NhbmNlbCA9IGQ7XG5cdCAgICAgIGQuc2V0RGlzcG9zYWJsZSh0aGlzLl9zY2hlZHVsZXIuc2NoZWR1bGVSZWN1cnNpdmVGdXR1cmUoMCwgdGhpcy5fcGVyaW9kLCB0aWNrLmJpbmQodGhpcykpKTtcblx0XG5cdCAgICAgIHJldHVybiBkO1xuXHQgICAgfTtcblx0XG5cdCAgICByZXR1cm4gU2NoZWR1bGVQZXJpb2RpY1JlY3Vyc2l2ZTtcblx0ICB9KCkpO1xuXHRcblx0ICAvKiogR2V0cyBhIHNjaGVkdWxlciB0aGF0IHNjaGVkdWxlcyB3b3JrIGltbWVkaWF0ZWx5IG9uIHRoZSBjdXJyZW50IHRocmVhZC4gKi9cblx0ICAgdmFyIEltbWVkaWF0ZVNjaGVkdWxlciA9IChmdW5jdGlvbiAoX19zdXBlcl9fKSB7XG5cdCAgICBpbmhlcml0cyhJbW1lZGlhdGVTY2hlZHVsZXIsIF9fc3VwZXJfXyk7XG5cdCAgICBmdW5jdGlvbiBJbW1lZGlhdGVTY2hlZHVsZXIoKSB7XG5cdCAgICAgIF9fc3VwZXJfXy5jYWxsKHRoaXMpO1xuXHQgICAgfVxuXHRcblx0ICAgIEltbWVkaWF0ZVNjaGVkdWxlci5wcm90b3R5cGUuc2NoZWR1bGUgPSBmdW5jdGlvbiAoc3RhdGUsIGFjdGlvbikge1xuXHQgICAgICByZXR1cm4gZGlzcG9zYWJsZUZpeHVwKGFjdGlvbih0aGlzLCBzdGF0ZSkpO1xuXHQgICAgfTtcblx0XG5cdCAgICByZXR1cm4gSW1tZWRpYXRlU2NoZWR1bGVyO1xuXHQgIH0oU2NoZWR1bGVyKSk7XG5cdFxuXHQgIHZhciBpbW1lZGlhdGVTY2hlZHVsZXIgPSBTY2hlZHVsZXIuaW1tZWRpYXRlID0gbmV3IEltbWVkaWF0ZVNjaGVkdWxlcigpO1xuXHRcblx0ICAvKipcblx0ICAgKiBHZXRzIGEgc2NoZWR1bGVyIHRoYXQgc2NoZWR1bGVzIHdvcmsgYXMgc29vbiBhcyBwb3NzaWJsZSBvbiB0aGUgY3VycmVudCB0aHJlYWQuXG5cdCAgICovXG5cdCAgdmFyIEN1cnJlbnRUaHJlYWRTY2hlZHVsZXIgPSAoZnVuY3Rpb24gKF9fc3VwZXJfXykge1xuXHQgICAgdmFyIHF1ZXVlO1xuXHRcblx0ICAgIGZ1bmN0aW9uIHJ1blRyYW1wb2xpbmUgKCkge1xuXHQgICAgICB3aGlsZSAocXVldWUubGVuZ3RoID4gMCkge1xuXHQgICAgICAgIHZhciBpdGVtID0gcXVldWUuZGVxdWV1ZSgpO1xuXHQgICAgICAgICFpdGVtLmlzQ2FuY2VsbGVkKCkgJiYgaXRlbS5pbnZva2UoKTtcblx0ICAgICAgfVxuXHQgICAgfVxuXHRcblx0ICAgIGluaGVyaXRzKEN1cnJlbnRUaHJlYWRTY2hlZHVsZXIsIF9fc3VwZXJfXyk7XG5cdCAgICBmdW5jdGlvbiBDdXJyZW50VGhyZWFkU2NoZWR1bGVyKCkge1xuXHQgICAgICBfX3N1cGVyX18uY2FsbCh0aGlzKTtcblx0ICAgIH1cblx0XG5cdCAgICBDdXJyZW50VGhyZWFkU2NoZWR1bGVyLnByb3RvdHlwZS5zY2hlZHVsZSA9IGZ1bmN0aW9uIChzdGF0ZSwgYWN0aW9uKSB7XG5cdCAgICAgIHZhciBzaSA9IG5ldyBTY2hlZHVsZWRJdGVtKHRoaXMsIHN0YXRlLCBhY3Rpb24sIHRoaXMubm93KCkpO1xuXHRcblx0ICAgICAgaWYgKCFxdWV1ZSkge1xuXHQgICAgICAgIHF1ZXVlID0gbmV3IFByaW9yaXR5UXVldWUoNCk7XG5cdCAgICAgICAgcXVldWUuZW5xdWV1ZShzaSk7XG5cdFxuXHQgICAgICAgIHZhciByZXN1bHQgPSB0cnlDYXRjaChydW5UcmFtcG9saW5lKSgpO1xuXHQgICAgICAgIHF1ZXVlID0gbnVsbDtcblx0ICAgICAgICBpZiAocmVzdWx0ID09PSBlcnJvck9iaikgeyB0aHJvd2VyKHJlc3VsdC5lKTsgfVxuXHQgICAgICB9IGVsc2Uge1xuXHQgICAgICAgIHF1ZXVlLmVucXVldWUoc2kpO1xuXHQgICAgICB9XG5cdCAgICAgIHJldHVybiBzaS5kaXNwb3NhYmxlO1xuXHQgICAgfTtcblx0XG5cdCAgICBDdXJyZW50VGhyZWFkU2NoZWR1bGVyLnByb3RvdHlwZS5zY2hlZHVsZVJlcXVpcmVkID0gZnVuY3Rpb24gKCkgeyByZXR1cm4gIXF1ZXVlOyB9O1xuXHRcblx0ICAgIHJldHVybiBDdXJyZW50VGhyZWFkU2NoZWR1bGVyO1xuXHQgIH0oU2NoZWR1bGVyKSk7XG5cdFxuXHQgIHZhciBjdXJyZW50VGhyZWFkU2NoZWR1bGVyID0gU2NoZWR1bGVyLmN1cnJlbnRUaHJlYWQgPSBuZXcgQ3VycmVudFRocmVhZFNjaGVkdWxlcigpO1xuXHRcblx0ICB2YXIgc2NoZWR1bGVNZXRob2QsIGNsZWFyTWV0aG9kO1xuXHRcblx0ICB2YXIgbG9jYWxUaW1lciA9IChmdW5jdGlvbiAoKSB7XG5cdCAgICB2YXIgbG9jYWxTZXRUaW1lb3V0LCBsb2NhbENsZWFyVGltZW91dCA9IG5vb3A7XG5cdCAgICBpZiAoISFyb290LnNldFRpbWVvdXQpIHtcblx0ICAgICAgbG9jYWxTZXRUaW1lb3V0ID0gcm9vdC5zZXRUaW1lb3V0O1xuXHQgICAgICBsb2NhbENsZWFyVGltZW91dCA9IHJvb3QuY2xlYXJUaW1lb3V0O1xuXHQgICAgfSBlbHNlIGlmICghIXJvb3QuV1NjcmlwdCkge1xuXHQgICAgICBsb2NhbFNldFRpbWVvdXQgPSBmdW5jdGlvbiAoZm4sIHRpbWUpIHtcblx0ICAgICAgICByb290LldTY3JpcHQuU2xlZXAodGltZSk7XG5cdCAgICAgICAgZm4oKTtcblx0ICAgICAgfTtcblx0ICAgIH0gZWxzZSB7XG5cdCAgICAgIHRocm93IG5ldyBOb3RTdXBwb3J0ZWRFcnJvcigpO1xuXHQgICAgfVxuXHRcblx0ICAgIHJldHVybiB7XG5cdCAgICAgIHNldFRpbWVvdXQ6IGxvY2FsU2V0VGltZW91dCxcblx0ICAgICAgY2xlYXJUaW1lb3V0OiBsb2NhbENsZWFyVGltZW91dFxuXHQgICAgfTtcblx0ICB9KCkpO1xuXHQgIHZhciBsb2NhbFNldFRpbWVvdXQgPSBsb2NhbFRpbWVyLnNldFRpbWVvdXQsXG5cdCAgICBsb2NhbENsZWFyVGltZW91dCA9IGxvY2FsVGltZXIuY2xlYXJUaW1lb3V0O1xuXHRcblx0ICAoZnVuY3Rpb24gKCkge1xuXHRcblx0ICAgIHZhciBuZXh0SGFuZGxlID0gMSwgdGFza3NCeUhhbmRsZSA9IHt9LCBjdXJyZW50bHlSdW5uaW5nID0gZmFsc2U7XG5cdFxuXHQgICAgY2xlYXJNZXRob2QgPSBmdW5jdGlvbiAoaGFuZGxlKSB7XG5cdCAgICAgIGRlbGV0ZSB0YXNrc0J5SGFuZGxlW2hhbmRsZV07XG5cdCAgICB9O1xuXHRcblx0ICAgIGZ1bmN0aW9uIHJ1blRhc2soaGFuZGxlKSB7XG5cdCAgICAgIGlmIChjdXJyZW50bHlSdW5uaW5nKSB7XG5cdCAgICAgICAgbG9jYWxTZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHsgcnVuVGFzayhoYW5kbGUpOyB9LCAwKTtcblx0ICAgICAgfSBlbHNlIHtcblx0ICAgICAgICB2YXIgdGFzayA9IHRhc2tzQnlIYW5kbGVbaGFuZGxlXTtcblx0ICAgICAgICBpZiAodGFzaykge1xuXHQgICAgICAgICAgY3VycmVudGx5UnVubmluZyA9IHRydWU7XG5cdCAgICAgICAgICB2YXIgcmVzdWx0ID0gdHJ5Q2F0Y2godGFzaykoKTtcblx0ICAgICAgICAgIGNsZWFyTWV0aG9kKGhhbmRsZSk7XG5cdCAgICAgICAgICBjdXJyZW50bHlSdW5uaW5nID0gZmFsc2U7XG5cdCAgICAgICAgICBpZiAocmVzdWx0ID09PSBlcnJvck9iaikgeyB0aHJvd2VyKHJlc3VsdC5lKTsgfVxuXHQgICAgICAgIH1cblx0ICAgICAgfVxuXHQgICAgfVxuXHRcblx0ICAgIHZhciByZU5hdGl2ZSA9IG5ldyBSZWdFeHAoJ14nICtcblx0ICAgICAgU3RyaW5nKHRvU3RyaW5nKVxuXHQgICAgICAgIC5yZXBsYWNlKC9bLiorP14ke30oKXxbXFxdXFxcXF0vZywgJ1xcXFwkJicpXG5cdCAgICAgICAgLnJlcGxhY2UoL3RvU3RyaW5nfCBmb3IgW15cXF1dKy9nLCAnLio/JykgKyAnJCdcblx0ICAgICk7XG5cdFxuXHQgICAgdmFyIHNldEltbWVkaWF0ZSA9IHR5cGVvZiAoc2V0SW1tZWRpYXRlID0gZnJlZUdsb2JhbCAmJiBtb2R1bGVFeHBvcnRzICYmIGZyZWVHbG9iYWwuc2V0SW1tZWRpYXRlKSA9PSAnZnVuY3Rpb24nICYmXG5cdCAgICAgICFyZU5hdGl2ZS50ZXN0KHNldEltbWVkaWF0ZSkgJiYgc2V0SW1tZWRpYXRlO1xuXHRcblx0ICAgIGZ1bmN0aW9uIHBvc3RNZXNzYWdlU3VwcG9ydGVkICgpIHtcblx0ICAgICAgLy8gRW5zdXJlIG5vdCBpbiBhIHdvcmtlclxuXHQgICAgICBpZiAoIXJvb3QucG9zdE1lc3NhZ2UgfHwgcm9vdC5pbXBvcnRTY3JpcHRzKSB7IHJldHVybiBmYWxzZTsgfVxuXHQgICAgICB2YXIgaXNBc3luYyA9IGZhbHNlLCBvbGRIYW5kbGVyID0gcm9vdC5vbm1lc3NhZ2U7XG5cdCAgICAgIC8vIFRlc3QgZm9yIGFzeW5jXG5cdCAgICAgIHJvb3Qub25tZXNzYWdlID0gZnVuY3Rpb24gKCkgeyBpc0FzeW5jID0gdHJ1ZTsgfTtcblx0ICAgICAgcm9vdC5wb3N0TWVzc2FnZSgnJywgJyonKTtcblx0ICAgICAgcm9vdC5vbm1lc3NhZ2UgPSBvbGRIYW5kbGVyO1xuXHRcblx0ICAgICAgcmV0dXJuIGlzQXN5bmM7XG5cdCAgICB9XG5cdFxuXHQgICAgLy8gVXNlIGluIG9yZGVyLCBzZXRJbW1lZGlhdGUsIG5leHRUaWNrLCBwb3N0TWVzc2FnZSwgTWVzc2FnZUNoYW5uZWwsIHNjcmlwdCByZWFkeXN0YXRlY2hhbmdlZCwgc2V0VGltZW91dFxuXHQgICAgaWYgKGlzRnVuY3Rpb24oc2V0SW1tZWRpYXRlKSkge1xuXHQgICAgICBzY2hlZHVsZU1ldGhvZCA9IGZ1bmN0aW9uIChhY3Rpb24pIHtcblx0ICAgICAgICB2YXIgaWQgPSBuZXh0SGFuZGxlKys7XG5cdCAgICAgICAgdGFza3NCeUhhbmRsZVtpZF0gPSBhY3Rpb247XG5cdCAgICAgICAgc2V0SW1tZWRpYXRlKGZ1bmN0aW9uICgpIHsgcnVuVGFzayhpZCk7IH0pO1xuXHRcblx0ICAgICAgICByZXR1cm4gaWQ7XG5cdCAgICAgIH07XG5cdCAgICB9IGVsc2UgaWYgKHR5cGVvZiBwcm9jZXNzICE9PSAndW5kZWZpbmVkJyAmJiB7fS50b1N0cmluZy5jYWxsKHByb2Nlc3MpID09PSAnW29iamVjdCBwcm9jZXNzXScpIHtcblx0ICAgICAgc2NoZWR1bGVNZXRob2QgPSBmdW5jdGlvbiAoYWN0aW9uKSB7XG5cdCAgICAgICAgdmFyIGlkID0gbmV4dEhhbmRsZSsrO1xuXHQgICAgICAgIHRhc2tzQnlIYW5kbGVbaWRdID0gYWN0aW9uO1xuXHQgICAgICAgIHByb2Nlc3MubmV4dFRpY2soZnVuY3Rpb24gKCkgeyBydW5UYXNrKGlkKTsgfSk7XG5cdFxuXHQgICAgICAgIHJldHVybiBpZDtcblx0ICAgICAgfTtcblx0ICAgIH0gZWxzZSBpZiAocG9zdE1lc3NhZ2VTdXBwb3J0ZWQoKSkge1xuXHQgICAgICB2YXIgTVNHX1BSRUZJWCA9ICdtcy5yeC5zY2hlZHVsZScgKyBNYXRoLnJhbmRvbSgpO1xuXHRcblx0ICAgICAgZnVuY3Rpb24gb25HbG9iYWxQb3N0TWVzc2FnZShldmVudCkge1xuXHQgICAgICAgIC8vIE9ubHkgaWYgd2UncmUgYSBtYXRjaCB0byBhdm9pZCBhbnkgb3RoZXIgZ2xvYmFsIGV2ZW50c1xuXHQgICAgICAgIGlmICh0eXBlb2YgZXZlbnQuZGF0YSA9PT0gJ3N0cmluZycgJiYgZXZlbnQuZGF0YS5zdWJzdHJpbmcoMCwgTVNHX1BSRUZJWC5sZW5ndGgpID09PSBNU0dfUFJFRklYKSB7XG5cdCAgICAgICAgICBydW5UYXNrKGV2ZW50LmRhdGEuc3Vic3RyaW5nKE1TR19QUkVGSVgubGVuZ3RoKSk7XG5cdCAgICAgICAgfVxuXHQgICAgICB9XG5cdFxuXHQgICAgICBpZiAocm9vdC5hZGRFdmVudExpc3RlbmVyKSB7XG5cdCAgICAgICAgcm9vdC5hZGRFdmVudExpc3RlbmVyKCdtZXNzYWdlJywgb25HbG9iYWxQb3N0TWVzc2FnZSwgZmFsc2UpO1xuXHQgICAgICB9IGVsc2UgaWYgKHJvb3QuYXR0YWNoRXZlbnQpIHtcblx0ICAgICAgICByb290LmF0dGFjaEV2ZW50KCdvbm1lc3NhZ2UnLCBvbkdsb2JhbFBvc3RNZXNzYWdlKTtcblx0ICAgICAgfSBlbHNlIHtcblx0ICAgICAgICByb290Lm9ubWVzc2FnZSA9IG9uR2xvYmFsUG9zdE1lc3NhZ2U7XG5cdCAgICAgIH1cblx0XG5cdCAgICAgIHNjaGVkdWxlTWV0aG9kID0gZnVuY3Rpb24gKGFjdGlvbikge1xuXHQgICAgICAgIHZhciBpZCA9IG5leHRIYW5kbGUrKztcblx0ICAgICAgICB0YXNrc0J5SGFuZGxlW2lkXSA9IGFjdGlvbjtcblx0ICAgICAgICByb290LnBvc3RNZXNzYWdlKE1TR19QUkVGSVggKyBjdXJyZW50SWQsICcqJyk7XG5cdCAgICAgICAgcmV0dXJuIGlkO1xuXHQgICAgICB9O1xuXHQgICAgfSBlbHNlIGlmICghIXJvb3QuTWVzc2FnZUNoYW5uZWwpIHtcblx0ICAgICAgdmFyIGNoYW5uZWwgPSBuZXcgcm9vdC5NZXNzYWdlQ2hhbm5lbCgpO1xuXHRcblx0ICAgICAgY2hhbm5lbC5wb3J0MS5vbm1lc3NhZ2UgPSBmdW5jdGlvbiAoZSkgeyBydW5UYXNrKGUuZGF0YSk7IH07XG5cdFxuXHQgICAgICBzY2hlZHVsZU1ldGhvZCA9IGZ1bmN0aW9uIChhY3Rpb24pIHtcblx0ICAgICAgICB2YXIgaWQgPSBuZXh0SGFuZGxlKys7XG5cdCAgICAgICAgdGFza3NCeUhhbmRsZVtpZF0gPSBhY3Rpb247XG5cdCAgICAgICAgY2hhbm5lbC5wb3J0Mi5wb3N0TWVzc2FnZShpZCk7XG5cdCAgICAgICAgcmV0dXJuIGlkO1xuXHQgICAgICB9O1xuXHQgICAgfSBlbHNlIGlmICgnZG9jdW1lbnQnIGluIHJvb3QgJiYgJ29ucmVhZHlzdGF0ZWNoYW5nZScgaW4gcm9vdC5kb2N1bWVudC5jcmVhdGVFbGVtZW50KCdzY3JpcHQnKSkge1xuXHRcblx0ICAgICAgc2NoZWR1bGVNZXRob2QgPSBmdW5jdGlvbiAoYWN0aW9uKSB7XG5cdCAgICAgICAgdmFyIHNjcmlwdEVsZW1lbnQgPSByb290LmRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3NjcmlwdCcpO1xuXHQgICAgICAgIHZhciBpZCA9IG5leHRIYW5kbGUrKztcblx0ICAgICAgICB0YXNrc0J5SGFuZGxlW2lkXSA9IGFjdGlvbjtcblx0XG5cdCAgICAgICAgc2NyaXB0RWxlbWVudC5vbnJlYWR5c3RhdGVjaGFuZ2UgPSBmdW5jdGlvbiAoKSB7XG5cdCAgICAgICAgICBydW5UYXNrKGlkKTtcblx0ICAgICAgICAgIHNjcmlwdEVsZW1lbnQub25yZWFkeXN0YXRlY2hhbmdlID0gbnVsbDtcblx0ICAgICAgICAgIHNjcmlwdEVsZW1lbnQucGFyZW50Tm9kZS5yZW1vdmVDaGlsZChzY3JpcHRFbGVtZW50KTtcblx0ICAgICAgICAgIHNjcmlwdEVsZW1lbnQgPSBudWxsO1xuXHQgICAgICAgIH07XG5cdCAgICAgICAgcm9vdC5kb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuYXBwZW5kQ2hpbGQoc2NyaXB0RWxlbWVudCk7XG5cdCAgICAgICAgcmV0dXJuIGlkO1xuXHQgICAgICB9O1xuXHRcblx0ICAgIH0gZWxzZSB7XG5cdCAgICAgIHNjaGVkdWxlTWV0aG9kID0gZnVuY3Rpb24gKGFjdGlvbikge1xuXHQgICAgICAgIHZhciBpZCA9IG5leHRIYW5kbGUrKztcblx0ICAgICAgICB0YXNrc0J5SGFuZGxlW2lkXSA9IGFjdGlvbjtcblx0ICAgICAgICBsb2NhbFNldFRpbWVvdXQoZnVuY3Rpb24gKCkge1xuXHQgICAgICAgICAgcnVuVGFzayhpZCk7XG5cdCAgICAgICAgfSwgMCk7XG5cdFxuXHQgICAgICAgIHJldHVybiBpZDtcblx0ICAgICAgfTtcblx0ICAgIH1cblx0ICB9KCkpO1xuXHRcblx0ICAvKipcblx0ICAgKiBHZXRzIGEgc2NoZWR1bGVyIHRoYXQgc2NoZWR1bGVzIHdvcmsgdmlhIGEgdGltZWQgY2FsbGJhY2sgYmFzZWQgdXBvbiBwbGF0Zm9ybS5cblx0ICAgKi9cblx0ICAgdmFyIERlZmF1bHRTY2hlZHVsZXIgPSAoZnVuY3Rpb24gKF9fc3VwZXJfXykge1xuXHQgICAgIGluaGVyaXRzKERlZmF1bHRTY2hlZHVsZXIsIF9fc3VwZXJfXyk7XG5cdCAgICAgZnVuY3Rpb24gRGVmYXVsdFNjaGVkdWxlcigpIHtcblx0ICAgICAgIF9fc3VwZXJfXy5jYWxsKHRoaXMpO1xuXHQgICAgIH1cblx0XG5cdCAgICAgZnVuY3Rpb24gRGVmYXVsdFNjaGVkdWxlckRpc3Bvc2FibGUoaWQpIHtcblx0ICAgICAgIHRoaXMuX2lkID0gaWQ7XG5cdCAgICAgICB0aGlzLmlzRGlzcG9zZWQgPSBmYWxzZTtcblx0ICAgICB9XG5cdFxuXHQgICAgIERlZmF1bHRTY2hlZHVsZXJEaXNwb3NhYmxlLnByb3RvdHlwZS5kaXNwb3NlID0gZnVuY3Rpb24gKCkge1xuXHQgICAgICAgaWYgKCF0aGlzLmlzRGlzcG9zZWQpIHtcblx0ICAgICAgICAgdGhpcy5pc0Rpc3Bvc2VkID0gdHJ1ZTtcblx0ICAgICAgICAgbG9jYWxDbGVhclRpbWVvdXQodGhpcy5faWQpO1xuXHQgICAgICAgfVxuXHQgICAgIH07XG5cdFxuXHQgICAgRGVmYXVsdFNjaGVkdWxlci5wcm90b3R5cGUuc2NoZWR1bGUgPSBmdW5jdGlvbiAoc3RhdGUsIGFjdGlvbikge1xuXHQgICAgICB2YXIgc2NoZWR1bGVyID0gdGhpcywgZGlzcG9zYWJsZSA9IG5ldyBTaW5nbGVBc3NpZ25tZW50RGlzcG9zYWJsZSgpO1xuXHQgICAgICB2YXIgaWQgPSBzY2hlZHVsZU1ldGhvZChmdW5jdGlvbiAoKSB7XG5cdCAgICAgICAgIWRpc3Bvc2FibGUuaXNEaXNwb3NlZCAmJiBkaXNwb3NhYmxlLnNldERpc3Bvc2FibGUoZGlzcG9zYWJsZUZpeHVwKGFjdGlvbihzY2hlZHVsZXIsIHN0YXRlKSkpO1xuXHQgICAgICB9KTtcblx0ICAgICAgcmV0dXJuIG5ldyBCaW5hcnlEaXNwb3NhYmxlKGRpc3Bvc2FibGUsIG5ldyBEZWZhdWx0U2NoZWR1bGVyRGlzcG9zYWJsZShpZCkpO1xuXHQgICAgfTtcblx0XG5cdCAgICBEZWZhdWx0U2NoZWR1bGVyLnByb3RvdHlwZS5fc2NoZWR1bGVGdXR1cmUgPSBmdW5jdGlvbiAoc3RhdGUsIGR1ZVRpbWUsIGFjdGlvbikge1xuXHQgICAgICB2YXIgc2NoZWR1bGVyID0gdGhpcywgZHQgPSBTY2hlZHVsZXIubm9ybWFsaXplKGR1ZVRpbWUpLCBkaXNwb3NhYmxlID0gbmV3IFNpbmdsZUFzc2lnbm1lbnREaXNwb3NhYmxlKCk7XG5cdCAgICAgIGlmIChkdCA9PT0gMCkgeyByZXR1cm4gc2NoZWR1bGVyLnNjaGVkdWxlKHN0YXRlLCBhY3Rpb24pOyB9XG5cdCAgICAgIHZhciBpZCA9IGxvY2FsU2V0VGltZW91dChmdW5jdGlvbiAoKSB7XG5cdCAgICAgICAgIWRpc3Bvc2FibGUuaXNEaXNwb3NlZCAmJiBkaXNwb3NhYmxlLnNldERpc3Bvc2FibGUoZGlzcG9zYWJsZUZpeHVwKGFjdGlvbihzY2hlZHVsZXIsIHN0YXRlKSkpO1xuXHQgICAgICB9LCBkdCk7XG5cdCAgICAgIHJldHVybiBuZXcgQmluYXJ5RGlzcG9zYWJsZShkaXNwb3NhYmxlLCBuZXcgRGVmYXVsdFNjaGVkdWxlckRpc3Bvc2FibGUoaWQpKTtcblx0ICAgIH07XG5cdFxuXHQgICAgcmV0dXJuIERlZmF1bHRTY2hlZHVsZXI7XG5cdCAgfShTY2hlZHVsZXIpKTtcblx0XG5cdCAgdmFyIGRlZmF1bHRTY2hlZHVsZXIgPSBTY2hlZHVsZXJbJ2RlZmF1bHQnXSA9IFNjaGVkdWxlci5hc3luYyA9IG5ldyBEZWZhdWx0U2NoZWR1bGVyKCk7XG5cdFxuXHQgIHZhciBDYXRjaFNjaGVkdWxlciA9IChmdW5jdGlvbiAoX19zdXBlcl9fKSB7XG5cdCAgICBpbmhlcml0cyhDYXRjaFNjaGVkdWxlciwgX19zdXBlcl9fKTtcblx0XG5cdCAgICBmdW5jdGlvbiBDYXRjaFNjaGVkdWxlcihzY2hlZHVsZXIsIGhhbmRsZXIpIHtcblx0ICAgICAgdGhpcy5fc2NoZWR1bGVyID0gc2NoZWR1bGVyO1xuXHQgICAgICB0aGlzLl9oYW5kbGVyID0gaGFuZGxlcjtcblx0ICAgICAgdGhpcy5fcmVjdXJzaXZlT3JpZ2luYWwgPSBudWxsO1xuXHQgICAgICB0aGlzLl9yZWN1cnNpdmVXcmFwcGVyID0gbnVsbDtcblx0ICAgICAgX19zdXBlcl9fLmNhbGwodGhpcyk7XG5cdCAgICB9XG5cdFxuXHQgICAgQ2F0Y2hTY2hlZHVsZXIucHJvdG90eXBlLnNjaGVkdWxlID0gZnVuY3Rpb24gKHN0YXRlLCBhY3Rpb24pIHtcblx0ICAgICAgcmV0dXJuIHRoaXMuX3NjaGVkdWxlci5zY2hlZHVsZShzdGF0ZSwgdGhpcy5fd3JhcChhY3Rpb24pKTtcblx0ICAgIH07XG5cdFxuXHQgICAgQ2F0Y2hTY2hlZHVsZXIucHJvdG90eXBlLl9zY2hlZHVsZUZ1dHVyZSA9IGZ1bmN0aW9uIChzdGF0ZSwgZHVlVGltZSwgYWN0aW9uKSB7XG5cdCAgICAgIHJldHVybiB0aGlzLl9zY2hlZHVsZXIuc2NoZWR1bGUoc3RhdGUsIGR1ZVRpbWUsIHRoaXMuX3dyYXAoYWN0aW9uKSk7XG5cdCAgICB9O1xuXHRcblx0ICAgIENhdGNoU2NoZWR1bGVyLnByb3RvdHlwZS5ub3cgPSBmdW5jdGlvbiAoKSB7IHJldHVybiB0aGlzLl9zY2hlZHVsZXIubm93KCk7IH07XG5cdFxuXHQgICAgQ2F0Y2hTY2hlZHVsZXIucHJvdG90eXBlLl9jbG9uZSA9IGZ1bmN0aW9uIChzY2hlZHVsZXIpIHtcblx0ICAgICAgICByZXR1cm4gbmV3IENhdGNoU2NoZWR1bGVyKHNjaGVkdWxlciwgdGhpcy5faGFuZGxlcik7XG5cdCAgICB9O1xuXHRcblx0ICAgIENhdGNoU2NoZWR1bGVyLnByb3RvdHlwZS5fd3JhcCA9IGZ1bmN0aW9uIChhY3Rpb24pIHtcblx0ICAgICAgdmFyIHBhcmVudCA9IHRoaXM7XG5cdCAgICAgIHJldHVybiBmdW5jdGlvbiAoc2VsZiwgc3RhdGUpIHtcblx0ICAgICAgICB2YXIgcmVzID0gdHJ5Q2F0Y2goYWN0aW9uKShwYXJlbnQuX2dldFJlY3Vyc2l2ZVdyYXBwZXIoc2VsZiksIHN0YXRlKTtcblx0ICAgICAgICBpZiAocmVzID09PSBlcnJvck9iaikge1xuXHQgICAgICAgICAgaWYgKCFwYXJlbnQuX2hhbmRsZXIocmVzLmUpKSB7IHRocm93ZXIocmVzLmUpOyB9XG5cdCAgICAgICAgICByZXR1cm4gZGlzcG9zYWJsZUVtcHR5O1xuXHQgICAgICAgIH1cblx0ICAgICAgICByZXR1cm4gZGlzcG9zYWJsZUZpeHVwKHJldCk7XG5cdCAgICAgIH07XG5cdCAgICB9O1xuXHRcblx0ICAgIENhdGNoU2NoZWR1bGVyLnByb3RvdHlwZS5fZ2V0UmVjdXJzaXZlV3JhcHBlciA9IGZ1bmN0aW9uIChzY2hlZHVsZXIpIHtcblx0ICAgICAgaWYgKHRoaXMuX3JlY3Vyc2l2ZU9yaWdpbmFsICE9PSBzY2hlZHVsZXIpIHtcblx0ICAgICAgICB0aGlzLl9yZWN1cnNpdmVPcmlnaW5hbCA9IHNjaGVkdWxlcjtcblx0ICAgICAgICB2YXIgd3JhcHBlciA9IHRoaXMuX2Nsb25lKHNjaGVkdWxlcik7XG5cdCAgICAgICAgd3JhcHBlci5fcmVjdXJzaXZlT3JpZ2luYWwgPSBzY2hlZHVsZXI7XG5cdCAgICAgICAgd3JhcHBlci5fcmVjdXJzaXZlV3JhcHBlciA9IHdyYXBwZXI7XG5cdCAgICAgICAgdGhpcy5fcmVjdXJzaXZlV3JhcHBlciA9IHdyYXBwZXI7XG5cdCAgICAgIH1cblx0ICAgICAgcmV0dXJuIHRoaXMuX3JlY3Vyc2l2ZVdyYXBwZXI7XG5cdCAgICB9O1xuXHRcblx0ICAgIENhdGNoU2NoZWR1bGVyLnByb3RvdHlwZS5zY2hlZHVsZVBlcmlvZGljID0gZnVuY3Rpb24gKHN0YXRlLCBwZXJpb2QsIGFjdGlvbikge1xuXHQgICAgICB2YXIgc2VsZiA9IHRoaXMsIGZhaWxlZCA9IGZhbHNlLCBkID0gbmV3IFNpbmdsZUFzc2lnbm1lbnREaXNwb3NhYmxlKCk7XG5cdFxuXHQgICAgICBkLnNldERpc3Bvc2FibGUodGhpcy5fc2NoZWR1bGVyLnNjaGVkdWxlUGVyaW9kaWMoc3RhdGUsIHBlcmlvZCwgZnVuY3Rpb24gKHN0YXRlMSkge1xuXHQgICAgICAgIGlmIChmYWlsZWQpIHsgcmV0dXJuIG51bGw7IH1cblx0ICAgICAgICB2YXIgcmVzID0gdHJ5Q2F0Y2goYWN0aW9uKShzdGF0ZTEpO1xuXHQgICAgICAgIGlmIChyZXMgPT09IGVycm9yT2JqKSB7XG5cdCAgICAgICAgICBmYWlsZWQgPSB0cnVlO1xuXHQgICAgICAgICAgaWYgKCFzZWxmLl9oYW5kbGVyKHJlcy5lKSkgeyB0aHJvd2VyKHJlcy5lKTsgfVxuXHQgICAgICAgICAgZC5kaXNwb3NlKCk7XG5cdCAgICAgICAgICByZXR1cm4gbnVsbDtcblx0ICAgICAgICB9XG5cdCAgICAgICAgcmV0dXJuIHJldDtcblx0ICAgICAgfSkpO1xuXHRcblx0ICAgICAgcmV0dXJuIGQ7XG5cdCAgICB9O1xuXHRcblx0ICAgIHJldHVybiBDYXRjaFNjaGVkdWxlcjtcblx0ICB9KFNjaGVkdWxlcikpO1xuXHRcblx0ICAvKipcblx0ICAgKiAgUmVwcmVzZW50cyBhIG5vdGlmaWNhdGlvbiB0byBhbiBvYnNlcnZlci5cblx0ICAgKi9cblx0ICB2YXIgTm90aWZpY2F0aW9uID0gUnguTm90aWZpY2F0aW9uID0gKGZ1bmN0aW9uICgpIHtcblx0ICAgIGZ1bmN0aW9uIE5vdGlmaWNhdGlvbigpIHtcblx0XG5cdCAgICB9XG5cdFxuXHQgICAgTm90aWZpY2F0aW9uLnByb3RvdHlwZS5fYWNjZXB0ID0gZnVuY3Rpb24gKG9uTmV4dCwgb25FcnJvciwgb25Db21wbGV0ZWQpIHtcblx0ICAgICAgdGhyb3cgbmV3IE5vdEltcGxlbWVudGVkRXJyb3IoKTtcblx0ICAgIH07XG5cdFxuXHQgICAgTm90aWZpY2F0aW9uLnByb3RvdHlwZS5fYWNjZXB0T2JzZXJ2YWJsZSA9IGZ1bmN0aW9uIChvbk5leHQsIG9uRXJyb3IsIG9uQ29tcGxldGVkKSB7XG5cdCAgICAgIHRocm93IG5ldyBOb3RJbXBsZW1lbnRlZEVycm9yKCk7XG5cdCAgICB9O1xuXHRcblx0ICAgIC8qKlxuXHQgICAgICogSW52b2tlcyB0aGUgZGVsZWdhdGUgY29ycmVzcG9uZGluZyB0byB0aGUgbm90aWZpY2F0aW9uIG9yIHRoZSBvYnNlcnZlcidzIG1ldGhvZCBjb3JyZXNwb25kaW5nIHRvIHRoZSBub3RpZmljYXRpb24gYW5kIHJldHVybnMgdGhlIHByb2R1Y2VkIHJlc3VsdC5cblx0ICAgICAqXG5cdCAgICAgKiBAbWVtYmVyT2YgTm90aWZpY2F0aW9uXG5cdCAgICAgKiBAcGFyYW0ge0FueX0gb2JzZXJ2ZXJPck9uTmV4dCBEZWxlZ2F0ZSB0byBpbnZva2UgZm9yIGFuIE9uTmV4dCBub3RpZmljYXRpb24gb3IgT2JzZXJ2ZXIgdG8gaW52b2tlIHRoZSBub3RpZmljYXRpb24gb24uLlxuXHQgICAgICogQHBhcmFtIHtGdW5jdGlvbn0gb25FcnJvciBEZWxlZ2F0ZSB0byBpbnZva2UgZm9yIGFuIE9uRXJyb3Igbm90aWZpY2F0aW9uLlxuXHQgICAgICogQHBhcmFtIHtGdW5jdGlvbn0gb25Db21wbGV0ZWQgRGVsZWdhdGUgdG8gaW52b2tlIGZvciBhbiBPbkNvbXBsZXRlZCBub3RpZmljYXRpb24uXG5cdCAgICAgKiBAcmV0dXJucyB7QW55fSBSZXN1bHQgcHJvZHVjZWQgYnkgdGhlIG9ic2VydmF0aW9uLlxuXHQgICAgICovXG5cdCAgICBOb3RpZmljYXRpb24ucHJvdG90eXBlLmFjY2VwdCA9IGZ1bmN0aW9uIChvYnNlcnZlck9yT25OZXh0LCBvbkVycm9yLCBvbkNvbXBsZXRlZCkge1xuXHQgICAgICByZXR1cm4gb2JzZXJ2ZXJPck9uTmV4dCAmJiB0eXBlb2Ygb2JzZXJ2ZXJPck9uTmV4dCA9PT0gJ29iamVjdCcgP1xuXHQgICAgICAgIHRoaXMuX2FjY2VwdE9ic2VydmFibGUob2JzZXJ2ZXJPck9uTmV4dCkgOlxuXHQgICAgICAgIHRoaXMuX2FjY2VwdChvYnNlcnZlck9yT25OZXh0LCBvbkVycm9yLCBvbkNvbXBsZXRlZCk7XG5cdCAgICB9O1xuXHRcblx0ICAgIC8qKlxuXHQgICAgICogUmV0dXJucyBhbiBvYnNlcnZhYmxlIHNlcXVlbmNlIHdpdGggYSBzaW5nbGUgbm90aWZpY2F0aW9uLlxuXHQgICAgICpcblx0ICAgICAqIEBtZW1iZXJPZiBOb3RpZmljYXRpb25zXG5cdCAgICAgKiBAcGFyYW0ge1NjaGVkdWxlcn0gW3NjaGVkdWxlcl0gU2NoZWR1bGVyIHRvIHNlbmQgb3V0IHRoZSBub3RpZmljYXRpb24gY2FsbHMgb24uXG5cdCAgICAgKiBAcmV0dXJucyB7T2JzZXJ2YWJsZX0gVGhlIG9ic2VydmFibGUgc2VxdWVuY2UgdGhhdCBzdXJmYWNlcyB0aGUgYmVoYXZpb3Igb2YgdGhlIG5vdGlmaWNhdGlvbiB1cG9uIHN1YnNjcmlwdGlvbi5cblx0ICAgICAqL1xuXHQgICAgTm90aWZpY2F0aW9uLnByb3RvdHlwZS50b09ic2VydmFibGUgPSBmdW5jdGlvbiAoc2NoZWR1bGVyKSB7XG5cdCAgICAgIHZhciBzZWxmID0gdGhpcztcblx0ICAgICAgaXNTY2hlZHVsZXIoc2NoZWR1bGVyKSB8fCAoc2NoZWR1bGVyID0gaW1tZWRpYXRlU2NoZWR1bGVyKTtcblx0ICAgICAgcmV0dXJuIG5ldyBBbm9ueW1vdXNPYnNlcnZhYmxlKGZ1bmN0aW9uIChvKSB7XG5cdCAgICAgICAgcmV0dXJuIHNjaGVkdWxlci5zY2hlZHVsZShzZWxmLCBmdW5jdGlvbiAoXywgbm90aWZpY2F0aW9uKSB7XG5cdCAgICAgICAgICBub3RpZmljYXRpb24uX2FjY2VwdE9ic2VydmFibGUobyk7XG5cdCAgICAgICAgICBub3RpZmljYXRpb24ua2luZCA9PT0gJ04nICYmIG8ub25Db21wbGV0ZWQoKTtcblx0ICAgICAgICB9KTtcblx0ICAgICAgfSk7XG5cdCAgICB9O1xuXHRcblx0ICAgIHJldHVybiBOb3RpZmljYXRpb247XG5cdCAgfSkoKTtcblx0XG5cdCAgdmFyIE9uTmV4dE5vdGlmaWNhdGlvbiA9IChmdW5jdGlvbiAoX19zdXBlcl9fKSB7XG5cdCAgICBpbmhlcml0cyhPbk5leHROb3RpZmljYXRpb24sIF9fc3VwZXJfXyk7XG5cdCAgICBmdW5jdGlvbiBPbk5leHROb3RpZmljYXRpb24odmFsdWUpIHtcblx0ICAgICAgdGhpcy52YWx1ZSA9IHZhbHVlO1xuXHQgICAgICB0aGlzLmtpbmQgPSAnTic7XG5cdCAgICB9XG5cdFxuXHQgICAgT25OZXh0Tm90aWZpY2F0aW9uLnByb3RvdHlwZS5fYWNjZXB0ID0gZnVuY3Rpb24gKG9uTmV4dCkge1xuXHQgICAgICByZXR1cm4gb25OZXh0KHRoaXMudmFsdWUpO1xuXHQgICAgfTtcblx0XG5cdCAgICBPbk5leHROb3RpZmljYXRpb24ucHJvdG90eXBlLl9hY2NlcHRPYnNlcnZhYmxlID0gZnVuY3Rpb24gKG8pIHtcblx0ICAgICAgcmV0dXJuIG8ub25OZXh0KHRoaXMudmFsdWUpO1xuXHQgICAgfTtcblx0XG5cdCAgICBPbk5leHROb3RpZmljYXRpb24ucHJvdG90eXBlLnRvU3RyaW5nID0gZnVuY3Rpb24gKCkge1xuXHQgICAgICByZXR1cm4gJ09uTmV4dCgnICsgdGhpcy52YWx1ZSArICcpJztcblx0ICAgIH07XG5cdFxuXHQgICAgcmV0dXJuIE9uTmV4dE5vdGlmaWNhdGlvbjtcblx0ICB9KE5vdGlmaWNhdGlvbikpO1xuXHRcblx0ICB2YXIgT25FcnJvck5vdGlmaWNhdGlvbiA9IChmdW5jdGlvbiAoX19zdXBlcl9fKSB7XG5cdCAgICBpbmhlcml0cyhPbkVycm9yTm90aWZpY2F0aW9uLCBfX3N1cGVyX18pO1xuXHQgICAgZnVuY3Rpb24gT25FcnJvck5vdGlmaWNhdGlvbihlcnJvcikge1xuXHQgICAgICB0aGlzLmVycm9yID0gZXJyb3I7XG5cdCAgICAgIHRoaXMua2luZCA9ICdFJztcblx0ICAgIH1cblx0XG5cdCAgICBPbkVycm9yTm90aWZpY2F0aW9uLnByb3RvdHlwZS5fYWNjZXB0ID0gZnVuY3Rpb24gKG9uTmV4dCwgb25FcnJvcikge1xuXHQgICAgICByZXR1cm4gb25FcnJvcih0aGlzLmVycm9yKTtcblx0ICAgIH07XG5cdFxuXHQgICAgT25FcnJvck5vdGlmaWNhdGlvbi5wcm90b3R5cGUuX2FjY2VwdE9ic2VydmFibGUgPSBmdW5jdGlvbiAobykge1xuXHQgICAgICByZXR1cm4gby5vbkVycm9yKHRoaXMuZXJyb3IpO1xuXHQgICAgfTtcblx0XG5cdCAgICBPbkVycm9yTm90aWZpY2F0aW9uLnByb3RvdHlwZS50b1N0cmluZyA9IGZ1bmN0aW9uICgpIHtcblx0ICAgICAgcmV0dXJuICdPbkVycm9yKCcgKyB0aGlzLmVycm9yICsgJyknO1xuXHQgICAgfTtcblx0XG5cdCAgICByZXR1cm4gT25FcnJvck5vdGlmaWNhdGlvbjtcblx0ICB9KE5vdGlmaWNhdGlvbikpO1xuXHRcblx0ICB2YXIgT25Db21wbGV0ZWROb3RpZmljYXRpb24gPSAoZnVuY3Rpb24gKF9fc3VwZXJfXykge1xuXHQgICAgaW5oZXJpdHMoT25Db21wbGV0ZWROb3RpZmljYXRpb24sIF9fc3VwZXJfXyk7XG5cdCAgICBmdW5jdGlvbiBPbkNvbXBsZXRlZE5vdGlmaWNhdGlvbigpIHtcblx0ICAgICAgdGhpcy5raW5kID0gJ0MnO1xuXHQgICAgfVxuXHRcblx0ICAgIE9uQ29tcGxldGVkTm90aWZpY2F0aW9uLnByb3RvdHlwZS5fYWNjZXB0ID0gZnVuY3Rpb24gKG9uTmV4dCwgb25FcnJvciwgb25Db21wbGV0ZWQpIHtcblx0ICAgICAgcmV0dXJuIG9uQ29tcGxldGVkKCk7XG5cdCAgICB9O1xuXHRcblx0ICAgIE9uQ29tcGxldGVkTm90aWZpY2F0aW9uLnByb3RvdHlwZS5fYWNjZXB0T2JzZXJ2YWJsZSA9IGZ1bmN0aW9uIChvKSB7XG5cdCAgICAgIHJldHVybiBvLm9uQ29tcGxldGVkKCk7XG5cdCAgICB9O1xuXHRcblx0ICAgIE9uQ29tcGxldGVkTm90aWZpY2F0aW9uLnByb3RvdHlwZS50b1N0cmluZyA9IGZ1bmN0aW9uICgpIHtcblx0ICAgICAgcmV0dXJuICdPbkNvbXBsZXRlZCgpJztcblx0ICAgIH07XG5cdFxuXHQgICAgcmV0dXJuIE9uQ29tcGxldGVkTm90aWZpY2F0aW9uO1xuXHQgIH0oTm90aWZpY2F0aW9uKSk7XG5cdFxuXHQgIC8qKlxuXHQgICAqIENyZWF0ZXMgYW4gb2JqZWN0IHRoYXQgcmVwcmVzZW50cyBhbiBPbk5leHQgbm90aWZpY2F0aW9uIHRvIGFuIG9ic2VydmVyLlxuXHQgICAqIEBwYXJhbSB7QW55fSB2YWx1ZSBUaGUgdmFsdWUgY29udGFpbmVkIGluIHRoZSBub3RpZmljYXRpb24uXG5cdCAgICogQHJldHVybnMge05vdGlmaWNhdGlvbn0gVGhlIE9uTmV4dCBub3RpZmljYXRpb24gY29udGFpbmluZyB0aGUgdmFsdWUuXG5cdCAgICovXG5cdCAgdmFyIG5vdGlmaWNhdGlvbkNyZWF0ZU9uTmV4dCA9IE5vdGlmaWNhdGlvbi5jcmVhdGVPbk5leHQgPSBmdW5jdGlvbiAodmFsdWUpIHtcblx0ICAgIHJldHVybiBuZXcgT25OZXh0Tm90aWZpY2F0aW9uKHZhbHVlKTtcblx0ICB9O1xuXHRcblx0ICAvKipcblx0ICAgKiBDcmVhdGVzIGFuIG9iamVjdCB0aGF0IHJlcHJlc2VudHMgYW4gT25FcnJvciBub3RpZmljYXRpb24gdG8gYW4gb2JzZXJ2ZXIuXG5cdCAgICogQHBhcmFtIHtBbnl9IGVycm9yIFRoZSBleGNlcHRpb24gY29udGFpbmVkIGluIHRoZSBub3RpZmljYXRpb24uXG5cdCAgICogQHJldHVybnMge05vdGlmaWNhdGlvbn0gVGhlIE9uRXJyb3Igbm90aWZpY2F0aW9uIGNvbnRhaW5pbmcgdGhlIGV4Y2VwdGlvbi5cblx0ICAgKi9cblx0ICB2YXIgbm90aWZpY2F0aW9uQ3JlYXRlT25FcnJvciA9IE5vdGlmaWNhdGlvbi5jcmVhdGVPbkVycm9yID0gZnVuY3Rpb24gKGVycm9yKSB7XG5cdCAgICByZXR1cm4gbmV3IE9uRXJyb3JOb3RpZmljYXRpb24oZXJyb3IpO1xuXHQgIH07XG5cdFxuXHQgIC8qKlxuXHQgICAqIENyZWF0ZXMgYW4gb2JqZWN0IHRoYXQgcmVwcmVzZW50cyBhbiBPbkNvbXBsZXRlZCBub3RpZmljYXRpb24gdG8gYW4gb2JzZXJ2ZXIuXG5cdCAgICogQHJldHVybnMge05vdGlmaWNhdGlvbn0gVGhlIE9uQ29tcGxldGVkIG5vdGlmaWNhdGlvbi5cblx0ICAgKi9cblx0ICB2YXIgbm90aWZpY2F0aW9uQ3JlYXRlT25Db21wbGV0ZWQgPSBOb3RpZmljYXRpb24uY3JlYXRlT25Db21wbGV0ZWQgPSBmdW5jdGlvbiAoKSB7XG5cdCAgICByZXR1cm4gbmV3IE9uQ29tcGxldGVkTm90aWZpY2F0aW9uKCk7XG5cdCAgfTtcblx0XG5cdCAgLyoqXG5cdCAgICogU3VwcG9ydHMgcHVzaC1zdHlsZSBpdGVyYXRpb24gb3ZlciBhbiBvYnNlcnZhYmxlIHNlcXVlbmNlLlxuXHQgICAqL1xuXHQgIHZhciBPYnNlcnZlciA9IFJ4Lk9ic2VydmVyID0gZnVuY3Rpb24gKCkgeyB9O1xuXHRcblx0ICAvKipcblx0ICAgKiAgQ3JlYXRlcyBhIG5vdGlmaWNhdGlvbiBjYWxsYmFjayBmcm9tIGFuIG9ic2VydmVyLlxuXHQgICAqIEByZXR1cm5zIFRoZSBhY3Rpb24gdGhhdCBmb3J3YXJkcyBpdHMgaW5wdXQgbm90aWZpY2F0aW9uIHRvIHRoZSB1bmRlcmx5aW5nIG9ic2VydmVyLlxuXHQgICAqL1xuXHQgIE9ic2VydmVyLnByb3RvdHlwZS50b05vdGlmaWVyID0gZnVuY3Rpb24gKCkge1xuXHQgICAgdmFyIG9ic2VydmVyID0gdGhpcztcblx0ICAgIHJldHVybiBmdW5jdGlvbiAobikgeyByZXR1cm4gbi5hY2NlcHQob2JzZXJ2ZXIpOyB9O1xuXHQgIH07XG5cdFxuXHQgIC8qKlxuXHQgICAqICBIaWRlcyB0aGUgaWRlbnRpdHkgb2YgYW4gb2JzZXJ2ZXIuXG5cdCAgICogQHJldHVybnMgQW4gb2JzZXJ2ZXIgdGhhdCBoaWRlcyB0aGUgaWRlbnRpdHkgb2YgdGhlIHNwZWNpZmllZCBvYnNlcnZlci5cblx0ICAgKi9cblx0ICBPYnNlcnZlci5wcm90b3R5cGUuYXNPYnNlcnZlciA9IGZ1bmN0aW9uICgpIHtcblx0ICAgIHZhciBzZWxmID0gdGhpcztcblx0ICAgIHJldHVybiBuZXcgQW5vbnltb3VzT2JzZXJ2ZXIoXG5cdCAgICAgIGZ1bmN0aW9uICh4KSB7IHNlbGYub25OZXh0KHgpOyB9LFxuXHQgICAgICBmdW5jdGlvbiAoZXJyKSB7IHNlbGYub25FcnJvcihlcnIpOyB9LFxuXHQgICAgICBmdW5jdGlvbiAoKSB7IHNlbGYub25Db21wbGV0ZWQoKTsgfSk7XG5cdCAgfTtcblx0XG5cdCAgLyoqXG5cdCAgICogIENoZWNrcyBhY2Nlc3MgdG8gdGhlIG9ic2VydmVyIGZvciBncmFtbWFyIHZpb2xhdGlvbnMuIFRoaXMgaW5jbHVkZXMgY2hlY2tpbmcgZm9yIG11bHRpcGxlIE9uRXJyb3Igb3IgT25Db21wbGV0ZWQgY2FsbHMsIGFzIHdlbGwgYXMgcmVlbnRyYW5jeSBpbiBhbnkgb2YgdGhlIG9ic2VydmVyIG1ldGhvZHMuXG5cdCAgICogIElmIGEgdmlvbGF0aW9uIGlzIGRldGVjdGVkLCBhbiBFcnJvciBpcyB0aHJvd24gZnJvbSB0aGUgb2ZmZW5kaW5nIG9ic2VydmVyIG1ldGhvZCBjYWxsLlxuXHQgICAqIEByZXR1cm5zIEFuIG9ic2VydmVyIHRoYXQgY2hlY2tzIGNhbGxiYWNrcyBpbnZvY2F0aW9ucyBhZ2FpbnN0IHRoZSBvYnNlcnZlciBncmFtbWFyIGFuZCwgaWYgdGhlIGNoZWNrcyBwYXNzLCBmb3J3YXJkcyB0aG9zZSB0byB0aGUgc3BlY2lmaWVkIG9ic2VydmVyLlxuXHQgICAqL1xuXHQgIE9ic2VydmVyLnByb3RvdHlwZS5jaGVja2VkID0gZnVuY3Rpb24gKCkgeyByZXR1cm4gbmV3IENoZWNrZWRPYnNlcnZlcih0aGlzKTsgfTtcblx0XG5cdCAgLyoqXG5cdCAgICogIENyZWF0ZXMgYW4gb2JzZXJ2ZXIgZnJvbSB0aGUgc3BlY2lmaWVkIE9uTmV4dCwgYWxvbmcgd2l0aCBvcHRpb25hbCBPbkVycm9yLCBhbmQgT25Db21wbGV0ZWQgYWN0aW9ucy5cblx0ICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBbb25OZXh0XSBPYnNlcnZlcidzIE9uTmV4dCBhY3Rpb24gaW1wbGVtZW50YXRpb24uXG5cdCAgICogQHBhcmFtIHtGdW5jdGlvbn0gW29uRXJyb3JdIE9ic2VydmVyJ3MgT25FcnJvciBhY3Rpb24gaW1wbGVtZW50YXRpb24uXG5cdCAgICogQHBhcmFtIHtGdW5jdGlvbn0gW29uQ29tcGxldGVkXSBPYnNlcnZlcidzIE9uQ29tcGxldGVkIGFjdGlvbiBpbXBsZW1lbnRhdGlvbi5cblx0ICAgKiBAcmV0dXJucyB7T2JzZXJ2ZXJ9IFRoZSBvYnNlcnZlciBvYmplY3QgaW1wbGVtZW50ZWQgdXNpbmcgdGhlIGdpdmVuIGFjdGlvbnMuXG5cdCAgICovXG5cdCAgdmFyIG9ic2VydmVyQ3JlYXRlID0gT2JzZXJ2ZXIuY3JlYXRlID0gZnVuY3Rpb24gKG9uTmV4dCwgb25FcnJvciwgb25Db21wbGV0ZWQpIHtcblx0ICAgIG9uTmV4dCB8fCAob25OZXh0ID0gbm9vcCk7XG5cdCAgICBvbkVycm9yIHx8IChvbkVycm9yID0gZGVmYXVsdEVycm9yKTtcblx0ICAgIG9uQ29tcGxldGVkIHx8IChvbkNvbXBsZXRlZCA9IG5vb3ApO1xuXHQgICAgcmV0dXJuIG5ldyBBbm9ueW1vdXNPYnNlcnZlcihvbk5leHQsIG9uRXJyb3IsIG9uQ29tcGxldGVkKTtcblx0ICB9O1xuXHRcblx0ICAvKipcblx0ICAgKiAgQ3JlYXRlcyBhbiBvYnNlcnZlciBmcm9tIGEgbm90aWZpY2F0aW9uIGNhbGxiYWNrLlxuXHQgICAqIEBwYXJhbSB7RnVuY3Rpb259IGhhbmRsZXIgQWN0aW9uIHRoYXQgaGFuZGxlcyBhIG5vdGlmaWNhdGlvbi5cblx0ICAgKiBAcmV0dXJucyBUaGUgb2JzZXJ2ZXIgb2JqZWN0IHRoYXQgaW52b2tlcyB0aGUgc3BlY2lmaWVkIGhhbmRsZXIgdXNpbmcgYSBub3RpZmljYXRpb24gY29ycmVzcG9uZGluZyB0byBlYWNoIG1lc3NhZ2UgaXQgcmVjZWl2ZXMuXG5cdCAgICovXG5cdCAgT2JzZXJ2ZXIuZnJvbU5vdGlmaWVyID0gZnVuY3Rpb24gKGhhbmRsZXIsIHRoaXNBcmcpIHtcblx0ICAgIHZhciBjYiA9IGJpbmRDYWxsYmFjayhoYW5kbGVyLCB0aGlzQXJnLCAxKTtcblx0ICAgIHJldHVybiBuZXcgQW5vbnltb3VzT2JzZXJ2ZXIoZnVuY3Rpb24gKHgpIHtcblx0ICAgICAgcmV0dXJuIGNiKG5vdGlmaWNhdGlvbkNyZWF0ZU9uTmV4dCh4KSk7XG5cdCAgICB9LCBmdW5jdGlvbiAoZSkge1xuXHQgICAgICByZXR1cm4gY2Iobm90aWZpY2F0aW9uQ3JlYXRlT25FcnJvcihlKSk7XG5cdCAgICB9LCBmdW5jdGlvbiAoKSB7XG5cdCAgICAgIHJldHVybiBjYihub3RpZmljYXRpb25DcmVhdGVPbkNvbXBsZXRlZCgpKTtcblx0ICAgIH0pO1xuXHQgIH07XG5cdFxuXHQgIC8qKlxuXHQgICAqIFNjaGVkdWxlcyB0aGUgaW52b2NhdGlvbiBvZiBvYnNlcnZlciBtZXRob2RzIG9uIHRoZSBnaXZlbiBzY2hlZHVsZXIuXG5cdCAgICogQHBhcmFtIHtTY2hlZHVsZXJ9IHNjaGVkdWxlciBTY2hlZHVsZXIgdG8gc2NoZWR1bGUgb2JzZXJ2ZXIgbWVzc2FnZXMgb24uXG5cdCAgICogQHJldHVybnMge09ic2VydmVyfSBPYnNlcnZlciB3aG9zZSBtZXNzYWdlcyBhcmUgc2NoZWR1bGVkIG9uIHRoZSBnaXZlbiBzY2hlZHVsZXIuXG5cdCAgICovXG5cdCAgT2JzZXJ2ZXIucHJvdG90eXBlLm5vdGlmeU9uID0gZnVuY3Rpb24gKHNjaGVkdWxlcikge1xuXHQgICAgcmV0dXJuIG5ldyBPYnNlcnZlT25PYnNlcnZlcihzY2hlZHVsZXIsIHRoaXMpO1xuXHQgIH07XG5cdFxuXHQgIE9ic2VydmVyLnByb3RvdHlwZS5tYWtlU2FmZSA9IGZ1bmN0aW9uKGRpc3Bvc2FibGUpIHtcblx0ICAgIHJldHVybiBuZXcgQW5vbnltb3VzU2FmZU9ic2VydmVyKHRoaXMuX29uTmV4dCwgdGhpcy5fb25FcnJvciwgdGhpcy5fb25Db21wbGV0ZWQsIGRpc3Bvc2FibGUpO1xuXHQgIH07XG5cdFxuXHQgIC8qKlxuXHQgICAqIEFic3RyYWN0IGJhc2UgY2xhc3MgZm9yIGltcGxlbWVudGF0aW9ucyBvZiB0aGUgT2JzZXJ2ZXIgY2xhc3MuXG5cdCAgICogVGhpcyBiYXNlIGNsYXNzIGVuZm9yY2VzIHRoZSBncmFtbWFyIG9mIG9ic2VydmVycyB3aGVyZSBPbkVycm9yIGFuZCBPbkNvbXBsZXRlZCBhcmUgdGVybWluYWwgbWVzc2FnZXMuXG5cdCAgICovXG5cdCAgdmFyIEFic3RyYWN0T2JzZXJ2ZXIgPSBSeC5pbnRlcm5hbHMuQWJzdHJhY3RPYnNlcnZlciA9IChmdW5jdGlvbiAoX19zdXBlcl9fKSB7XG5cdCAgICBpbmhlcml0cyhBYnN0cmFjdE9ic2VydmVyLCBfX3N1cGVyX18pO1xuXHRcblx0ICAgIC8qKlxuXHQgICAgICogQ3JlYXRlcyBhIG5ldyBvYnNlcnZlciBpbiBhIG5vbi1zdG9wcGVkIHN0YXRlLlxuXHQgICAgICovXG5cdCAgICBmdW5jdGlvbiBBYnN0cmFjdE9ic2VydmVyKCkge1xuXHQgICAgICB0aGlzLmlzU3RvcHBlZCA9IGZhbHNlO1xuXHQgICAgfVxuXHRcblx0ICAgIC8vIE11c3QgYmUgaW1wbGVtZW50ZWQgYnkgb3RoZXIgb2JzZXJ2ZXJzXG5cdCAgICBBYnN0cmFjdE9ic2VydmVyLnByb3RvdHlwZS5uZXh0ID0gbm90SW1wbGVtZW50ZWQ7XG5cdCAgICBBYnN0cmFjdE9ic2VydmVyLnByb3RvdHlwZS5lcnJvciA9IG5vdEltcGxlbWVudGVkO1xuXHQgICAgQWJzdHJhY3RPYnNlcnZlci5wcm90b3R5cGUuY29tcGxldGVkID0gbm90SW1wbGVtZW50ZWQ7XG5cdFxuXHQgICAgLyoqXG5cdCAgICAgKiBOb3RpZmllcyB0aGUgb2JzZXJ2ZXIgb2YgYSBuZXcgZWxlbWVudCBpbiB0aGUgc2VxdWVuY2UuXG5cdCAgICAgKiBAcGFyYW0ge0FueX0gdmFsdWUgTmV4dCBlbGVtZW50IGluIHRoZSBzZXF1ZW5jZS5cblx0ICAgICAqL1xuXHQgICAgQWJzdHJhY3RPYnNlcnZlci5wcm90b3R5cGUub25OZXh0ID0gZnVuY3Rpb24gKHZhbHVlKSB7XG5cdCAgICAgICF0aGlzLmlzU3RvcHBlZCAmJiB0aGlzLm5leHQodmFsdWUpO1xuXHQgICAgfTtcblx0XG5cdCAgICAvKipcblx0ICAgICAqIE5vdGlmaWVzIHRoZSBvYnNlcnZlciB0aGF0IGFuIGV4Y2VwdGlvbiBoYXMgb2NjdXJyZWQuXG5cdCAgICAgKiBAcGFyYW0ge0FueX0gZXJyb3IgVGhlIGVycm9yIHRoYXQgaGFzIG9jY3VycmVkLlxuXHQgICAgICovXG5cdCAgICBBYnN0cmFjdE9ic2VydmVyLnByb3RvdHlwZS5vbkVycm9yID0gZnVuY3Rpb24gKGVycm9yKSB7XG5cdCAgICAgIGlmICghdGhpcy5pc1N0b3BwZWQpIHtcblx0ICAgICAgICB0aGlzLmlzU3RvcHBlZCA9IHRydWU7XG5cdCAgICAgICAgdGhpcy5lcnJvcihlcnJvcik7XG5cdCAgICAgIH1cblx0ICAgIH07XG5cdFxuXHQgICAgLyoqXG5cdCAgICAgKiBOb3RpZmllcyB0aGUgb2JzZXJ2ZXIgb2YgdGhlIGVuZCBvZiB0aGUgc2VxdWVuY2UuXG5cdCAgICAgKi9cblx0ICAgIEFic3RyYWN0T2JzZXJ2ZXIucHJvdG90eXBlLm9uQ29tcGxldGVkID0gZnVuY3Rpb24gKCkge1xuXHQgICAgICBpZiAoIXRoaXMuaXNTdG9wcGVkKSB7XG5cdCAgICAgICAgdGhpcy5pc1N0b3BwZWQgPSB0cnVlO1xuXHQgICAgICAgIHRoaXMuY29tcGxldGVkKCk7XG5cdCAgICAgIH1cblx0ICAgIH07XG5cdFxuXHQgICAgLyoqXG5cdCAgICAgKiBEaXNwb3NlcyB0aGUgb2JzZXJ2ZXIsIGNhdXNpbmcgaXQgdG8gdHJhbnNpdGlvbiB0byB0aGUgc3RvcHBlZCBzdGF0ZS5cblx0ICAgICAqL1xuXHQgICAgQWJzdHJhY3RPYnNlcnZlci5wcm90b3R5cGUuZGlzcG9zZSA9IGZ1bmN0aW9uICgpIHsgdGhpcy5pc1N0b3BwZWQgPSB0cnVlOyB9O1xuXHRcblx0ICAgIEFic3RyYWN0T2JzZXJ2ZXIucHJvdG90eXBlLmZhaWwgPSBmdW5jdGlvbiAoZSkge1xuXHQgICAgICBpZiAoIXRoaXMuaXNTdG9wcGVkKSB7XG5cdCAgICAgICAgdGhpcy5pc1N0b3BwZWQgPSB0cnVlO1xuXHQgICAgICAgIHRoaXMuZXJyb3IoZSk7XG5cdCAgICAgICAgcmV0dXJuIHRydWU7XG5cdCAgICAgIH1cblx0XG5cdCAgICAgIHJldHVybiBmYWxzZTtcblx0ICAgIH07XG5cdFxuXHQgICAgcmV0dXJuIEFic3RyYWN0T2JzZXJ2ZXI7XG5cdCAgfShPYnNlcnZlcikpO1xuXHRcblx0ICAvKipcblx0ICAgKiBDbGFzcyB0byBjcmVhdGUgYW4gT2JzZXJ2ZXIgaW5zdGFuY2UgZnJvbSBkZWxlZ2F0ZS1iYXNlZCBpbXBsZW1lbnRhdGlvbnMgb2YgdGhlIG9uKiBtZXRob2RzLlxuXHQgICAqL1xuXHQgIHZhciBBbm9ueW1vdXNPYnNlcnZlciA9IFJ4LkFub255bW91c09ic2VydmVyID0gKGZ1bmN0aW9uIChfX3N1cGVyX18pIHtcblx0ICAgIGluaGVyaXRzKEFub255bW91c09ic2VydmVyLCBfX3N1cGVyX18pO1xuXHRcblx0ICAgIC8qKlxuXHQgICAgICogQ3JlYXRlcyBhbiBvYnNlcnZlciBmcm9tIHRoZSBzcGVjaWZpZWQgT25OZXh0LCBPbkVycm9yLCBhbmQgT25Db21wbGV0ZWQgYWN0aW9ucy5cblx0ICAgICAqIEBwYXJhbSB7QW55fSBvbk5leHQgT2JzZXJ2ZXIncyBPbk5leHQgYWN0aW9uIGltcGxlbWVudGF0aW9uLlxuXHQgICAgICogQHBhcmFtIHtBbnl9IG9uRXJyb3IgT2JzZXJ2ZXIncyBPbkVycm9yIGFjdGlvbiBpbXBsZW1lbnRhdGlvbi5cblx0ICAgICAqIEBwYXJhbSB7QW55fSBvbkNvbXBsZXRlZCBPYnNlcnZlcidzIE9uQ29tcGxldGVkIGFjdGlvbiBpbXBsZW1lbnRhdGlvbi5cblx0ICAgICAqL1xuXHQgICAgZnVuY3Rpb24gQW5vbnltb3VzT2JzZXJ2ZXIob25OZXh0LCBvbkVycm9yLCBvbkNvbXBsZXRlZCkge1xuXHQgICAgICBfX3N1cGVyX18uY2FsbCh0aGlzKTtcblx0ICAgICAgdGhpcy5fb25OZXh0ID0gb25OZXh0O1xuXHQgICAgICB0aGlzLl9vbkVycm9yID0gb25FcnJvcjtcblx0ICAgICAgdGhpcy5fb25Db21wbGV0ZWQgPSBvbkNvbXBsZXRlZDtcblx0ICAgIH1cblx0XG5cdCAgICAvKipcblx0ICAgICAqIENhbGxzIHRoZSBvbk5leHQgYWN0aW9uLlxuXHQgICAgICogQHBhcmFtIHtBbnl9IHZhbHVlIE5leHQgZWxlbWVudCBpbiB0aGUgc2VxdWVuY2UuXG5cdCAgICAgKi9cblx0ICAgIEFub255bW91c09ic2VydmVyLnByb3RvdHlwZS5uZXh0ID0gZnVuY3Rpb24gKHZhbHVlKSB7XG5cdCAgICAgIHRoaXMuX29uTmV4dCh2YWx1ZSk7XG5cdCAgICB9O1xuXHRcblx0ICAgIC8qKlxuXHQgICAgICogQ2FsbHMgdGhlIG9uRXJyb3IgYWN0aW9uLlxuXHQgICAgICogQHBhcmFtIHtBbnl9IGVycm9yIFRoZSBlcnJvciB0aGF0IGhhcyBvY2N1cnJlZC5cblx0ICAgICAqL1xuXHQgICAgQW5vbnltb3VzT2JzZXJ2ZXIucHJvdG90eXBlLmVycm9yID0gZnVuY3Rpb24gKGVycm9yKSB7XG5cdCAgICAgIHRoaXMuX29uRXJyb3IoZXJyb3IpO1xuXHQgICAgfTtcblx0XG5cdCAgICAvKipcblx0ICAgICAqICBDYWxscyB0aGUgb25Db21wbGV0ZWQgYWN0aW9uLlxuXHQgICAgICovXG5cdCAgICBBbm9ueW1vdXNPYnNlcnZlci5wcm90b3R5cGUuY29tcGxldGVkID0gZnVuY3Rpb24gKCkge1xuXHQgICAgICB0aGlzLl9vbkNvbXBsZXRlZCgpO1xuXHQgICAgfTtcblx0XG5cdCAgICByZXR1cm4gQW5vbnltb3VzT2JzZXJ2ZXI7XG5cdCAgfShBYnN0cmFjdE9ic2VydmVyKSk7XG5cdFxuXHQgIHZhciBDaGVja2VkT2JzZXJ2ZXIgPSAoZnVuY3Rpb24gKF9fc3VwZXJfXykge1xuXHQgICAgaW5oZXJpdHMoQ2hlY2tlZE9ic2VydmVyLCBfX3N1cGVyX18pO1xuXHRcblx0ICAgIGZ1bmN0aW9uIENoZWNrZWRPYnNlcnZlcihvYnNlcnZlcikge1xuXHQgICAgICBfX3N1cGVyX18uY2FsbCh0aGlzKTtcblx0ICAgICAgdGhpcy5fb2JzZXJ2ZXIgPSBvYnNlcnZlcjtcblx0ICAgICAgdGhpcy5fc3RhdGUgPSAwOyAvLyAwIC0gaWRsZSwgMSAtIGJ1c3ksIDIgLSBkb25lXG5cdCAgICB9XG5cdFxuXHQgICAgdmFyIENoZWNrZWRPYnNlcnZlclByb3RvdHlwZSA9IENoZWNrZWRPYnNlcnZlci5wcm90b3R5cGU7XG5cdFxuXHQgICAgQ2hlY2tlZE9ic2VydmVyUHJvdG90eXBlLm9uTmV4dCA9IGZ1bmN0aW9uICh2YWx1ZSkge1xuXHQgICAgICB0aGlzLmNoZWNrQWNjZXNzKCk7XG5cdCAgICAgIHZhciByZXMgPSB0cnlDYXRjaCh0aGlzLl9vYnNlcnZlci5vbk5leHQpLmNhbGwodGhpcy5fb2JzZXJ2ZXIsIHZhbHVlKTtcblx0ICAgICAgdGhpcy5fc3RhdGUgPSAwO1xuXHQgICAgICByZXMgPT09IGVycm9yT2JqICYmIHRocm93ZXIocmVzLmUpO1xuXHQgICAgfTtcblx0XG5cdCAgICBDaGVja2VkT2JzZXJ2ZXJQcm90b3R5cGUub25FcnJvciA9IGZ1bmN0aW9uIChlcnIpIHtcblx0ICAgICAgdGhpcy5jaGVja0FjY2VzcygpO1xuXHQgICAgICB2YXIgcmVzID0gdHJ5Q2F0Y2godGhpcy5fb2JzZXJ2ZXIub25FcnJvcikuY2FsbCh0aGlzLl9vYnNlcnZlciwgZXJyKTtcblx0ICAgICAgdGhpcy5fc3RhdGUgPSAyO1xuXHQgICAgICByZXMgPT09IGVycm9yT2JqICYmIHRocm93ZXIocmVzLmUpO1xuXHQgICAgfTtcblx0XG5cdCAgICBDaGVja2VkT2JzZXJ2ZXJQcm90b3R5cGUub25Db21wbGV0ZWQgPSBmdW5jdGlvbiAoKSB7XG5cdCAgICAgIHRoaXMuY2hlY2tBY2Nlc3MoKTtcblx0ICAgICAgdmFyIHJlcyA9IHRyeUNhdGNoKHRoaXMuX29ic2VydmVyLm9uQ29tcGxldGVkKS5jYWxsKHRoaXMuX29ic2VydmVyKTtcblx0ICAgICAgdGhpcy5fc3RhdGUgPSAyO1xuXHQgICAgICByZXMgPT09IGVycm9yT2JqICYmIHRocm93ZXIocmVzLmUpO1xuXHQgICAgfTtcblx0XG5cdCAgICBDaGVja2VkT2JzZXJ2ZXJQcm90b3R5cGUuY2hlY2tBY2Nlc3MgPSBmdW5jdGlvbiAoKSB7XG5cdCAgICAgIGlmICh0aGlzLl9zdGF0ZSA9PT0gMSkgeyB0aHJvdyBuZXcgRXJyb3IoJ1JlLWVudHJhbmN5IGRldGVjdGVkJyk7IH1cblx0ICAgICAgaWYgKHRoaXMuX3N0YXRlID09PSAyKSB7IHRocm93IG5ldyBFcnJvcignT2JzZXJ2ZXIgY29tcGxldGVkJyk7IH1cblx0ICAgICAgaWYgKHRoaXMuX3N0YXRlID09PSAwKSB7IHRoaXMuX3N0YXRlID0gMTsgfVxuXHQgICAgfTtcblx0XG5cdCAgICByZXR1cm4gQ2hlY2tlZE9ic2VydmVyO1xuXHQgIH0oT2JzZXJ2ZXIpKTtcblx0XG5cdCAgdmFyIFNjaGVkdWxlZE9ic2VydmVyID0gUnguaW50ZXJuYWxzLlNjaGVkdWxlZE9ic2VydmVyID0gKGZ1bmN0aW9uIChfX3N1cGVyX18pIHtcblx0ICAgIGluaGVyaXRzKFNjaGVkdWxlZE9ic2VydmVyLCBfX3N1cGVyX18pO1xuXHRcblx0ICAgIGZ1bmN0aW9uIFNjaGVkdWxlZE9ic2VydmVyKHNjaGVkdWxlciwgb2JzZXJ2ZXIpIHtcblx0ICAgICAgX19zdXBlcl9fLmNhbGwodGhpcyk7XG5cdCAgICAgIHRoaXMuc2NoZWR1bGVyID0gc2NoZWR1bGVyO1xuXHQgICAgICB0aGlzLm9ic2VydmVyID0gb2JzZXJ2ZXI7XG5cdCAgICAgIHRoaXMuaXNBY3F1aXJlZCA9IGZhbHNlO1xuXHQgICAgICB0aGlzLmhhc0ZhdWx0ZWQgPSBmYWxzZTtcblx0ICAgICAgdGhpcy5xdWV1ZSA9IFtdO1xuXHQgICAgICB0aGlzLmRpc3Bvc2FibGUgPSBuZXcgU2VyaWFsRGlzcG9zYWJsZSgpO1xuXHQgICAgfVxuXHRcblx0ICAgIFNjaGVkdWxlZE9ic2VydmVyLnByb3RvdHlwZS5uZXh0ID0gZnVuY3Rpb24gKHZhbHVlKSB7XG5cdCAgICAgIHZhciBzZWxmID0gdGhpcztcblx0ICAgICAgdGhpcy5xdWV1ZS5wdXNoKGZ1bmN0aW9uICgpIHsgc2VsZi5vYnNlcnZlci5vbk5leHQodmFsdWUpOyB9KTtcblx0ICAgIH07XG5cdFxuXHQgICAgU2NoZWR1bGVkT2JzZXJ2ZXIucHJvdG90eXBlLmVycm9yID0gZnVuY3Rpb24gKGUpIHtcblx0ICAgICAgdmFyIHNlbGYgPSB0aGlzO1xuXHQgICAgICB0aGlzLnF1ZXVlLnB1c2goZnVuY3Rpb24gKCkgeyBzZWxmLm9ic2VydmVyLm9uRXJyb3IoZSk7IH0pO1xuXHQgICAgfTtcblx0XG5cdCAgICBTY2hlZHVsZWRPYnNlcnZlci5wcm90b3R5cGUuY29tcGxldGVkID0gZnVuY3Rpb24gKCkge1xuXHQgICAgICB2YXIgc2VsZiA9IHRoaXM7XG5cdCAgICAgIHRoaXMucXVldWUucHVzaChmdW5jdGlvbiAoKSB7IHNlbGYub2JzZXJ2ZXIub25Db21wbGV0ZWQoKTsgfSk7XG5cdCAgICB9O1xuXHRcblx0ICAgIFNjaGVkdWxlZE9ic2VydmVyLnByb3RvdHlwZS5lbnN1cmVBY3RpdmUgPSBmdW5jdGlvbiAoKSB7XG5cdCAgICAgIHZhciBpc093bmVyID0gZmFsc2U7XG5cdCAgICAgIGlmICghdGhpcy5oYXNGYXVsdGVkICYmIHRoaXMucXVldWUubGVuZ3RoID4gMCkge1xuXHQgICAgICAgIGlzT3duZXIgPSAhdGhpcy5pc0FjcXVpcmVkO1xuXHQgICAgICAgIHRoaXMuaXNBY3F1aXJlZCA9IHRydWU7XG5cdCAgICAgIH1cblx0ICAgICAgaWYgKGlzT3duZXIpIHtcblx0ICAgICAgICB0aGlzLmRpc3Bvc2FibGUuc2V0RGlzcG9zYWJsZSh0aGlzLnNjaGVkdWxlci5zY2hlZHVsZVJlY3Vyc2l2ZSh0aGlzLCBmdW5jdGlvbiAocGFyZW50LCBzZWxmKSB7XG5cdCAgICAgICAgICB2YXIgd29yaztcblx0ICAgICAgICAgIGlmIChwYXJlbnQucXVldWUubGVuZ3RoID4gMCkge1xuXHQgICAgICAgICAgICB3b3JrID0gcGFyZW50LnF1ZXVlLnNoaWZ0KCk7XG5cdCAgICAgICAgICB9IGVsc2Uge1xuXHQgICAgICAgICAgICBwYXJlbnQuaXNBY3F1aXJlZCA9IGZhbHNlO1xuXHQgICAgICAgICAgICByZXR1cm47XG5cdCAgICAgICAgICB9XG5cdCAgICAgICAgICB2YXIgcmVzID0gdHJ5Q2F0Y2god29yaykoKTtcblx0ICAgICAgICAgIGlmIChyZXMgPT09IGVycm9yT2JqKSB7XG5cdCAgICAgICAgICAgIHBhcmVudC5xdWV1ZSA9IFtdO1xuXHQgICAgICAgICAgICBwYXJlbnQuaGFzRmF1bHRlZCA9IHRydWU7XG5cdCAgICAgICAgICAgIHJldHVybiB0aHJvd2VyKHJlcy5lKTtcblx0ICAgICAgICAgIH1cblx0ICAgICAgICAgIHNlbGYocGFyZW50KTtcblx0ICAgICAgICB9KSk7XG5cdCAgICAgIH1cblx0ICAgIH07XG5cdFxuXHQgICAgU2NoZWR1bGVkT2JzZXJ2ZXIucHJvdG90eXBlLmRpc3Bvc2UgPSBmdW5jdGlvbiAoKSB7XG5cdCAgICAgIF9fc3VwZXJfXy5wcm90b3R5cGUuZGlzcG9zZS5jYWxsKHRoaXMpO1xuXHQgICAgICB0aGlzLmRpc3Bvc2FibGUuZGlzcG9zZSgpO1xuXHQgICAgfTtcblx0XG5cdCAgICByZXR1cm4gU2NoZWR1bGVkT2JzZXJ2ZXI7XG5cdCAgfShBYnN0cmFjdE9ic2VydmVyKSk7XG5cdFxuXHQgIHZhciBPYnNlcnZlT25PYnNlcnZlciA9IChmdW5jdGlvbiAoX19zdXBlcl9fKSB7XG5cdCAgICBpbmhlcml0cyhPYnNlcnZlT25PYnNlcnZlciwgX19zdXBlcl9fKTtcblx0XG5cdCAgICBmdW5jdGlvbiBPYnNlcnZlT25PYnNlcnZlcihzY2hlZHVsZXIsIG9ic2VydmVyLCBjYW5jZWwpIHtcblx0ICAgICAgX19zdXBlcl9fLmNhbGwodGhpcywgc2NoZWR1bGVyLCBvYnNlcnZlcik7XG5cdCAgICAgIHRoaXMuX2NhbmNlbCA9IGNhbmNlbDtcblx0ICAgIH1cblx0XG5cdCAgICBPYnNlcnZlT25PYnNlcnZlci5wcm90b3R5cGUubmV4dCA9IGZ1bmN0aW9uICh2YWx1ZSkge1xuXHQgICAgICBfX3N1cGVyX18ucHJvdG90eXBlLm5leHQuY2FsbCh0aGlzLCB2YWx1ZSk7XG5cdCAgICAgIHRoaXMuZW5zdXJlQWN0aXZlKCk7XG5cdCAgICB9O1xuXHRcblx0ICAgIE9ic2VydmVPbk9ic2VydmVyLnByb3RvdHlwZS5lcnJvciA9IGZ1bmN0aW9uIChlKSB7XG5cdCAgICAgIF9fc3VwZXJfXy5wcm90b3R5cGUuZXJyb3IuY2FsbCh0aGlzLCBlKTtcblx0ICAgICAgdGhpcy5lbnN1cmVBY3RpdmUoKTtcblx0ICAgIH07XG5cdFxuXHQgICAgT2JzZXJ2ZU9uT2JzZXJ2ZXIucHJvdG90eXBlLmNvbXBsZXRlZCA9IGZ1bmN0aW9uICgpIHtcblx0ICAgICAgX19zdXBlcl9fLnByb3RvdHlwZS5jb21wbGV0ZWQuY2FsbCh0aGlzKTtcblx0ICAgICAgdGhpcy5lbnN1cmVBY3RpdmUoKTtcblx0ICAgIH07XG5cdFxuXHQgICAgT2JzZXJ2ZU9uT2JzZXJ2ZXIucHJvdG90eXBlLmRpc3Bvc2UgPSBmdW5jdGlvbiAoKSB7XG5cdCAgICAgIF9fc3VwZXJfXy5wcm90b3R5cGUuZGlzcG9zZS5jYWxsKHRoaXMpO1xuXHQgICAgICB0aGlzLl9jYW5jZWwgJiYgdGhpcy5fY2FuY2VsLmRpc3Bvc2UoKTtcblx0ICAgICAgdGhpcy5fY2FuY2VsID0gbnVsbDtcblx0ICAgIH07XG5cdFxuXHQgICAgcmV0dXJuIE9ic2VydmVPbk9ic2VydmVyO1xuXHQgIH0pKFNjaGVkdWxlZE9ic2VydmVyKTtcblx0XG5cdCAgdmFyIG9ic2VydmFibGVQcm90bztcblx0XG5cdCAgLyoqXG5cdCAgICogUmVwcmVzZW50cyBhIHB1c2gtc3R5bGUgY29sbGVjdGlvbi5cblx0ICAgKi9cblx0ICB2YXIgT2JzZXJ2YWJsZSA9IFJ4Lk9ic2VydmFibGUgPSAoZnVuY3Rpb24gKCkge1xuXHRcblx0ICAgIGZ1bmN0aW9uIG1ha2VTdWJzY3JpYmUoc2VsZiwgc3Vic2NyaWJlKSB7XG5cdCAgICAgIHJldHVybiBmdW5jdGlvbiAobykge1xuXHQgICAgICAgIHZhciBvbGRPbkVycm9yID0gby5vbkVycm9yO1xuXHQgICAgICAgIG8ub25FcnJvciA9IGZ1bmN0aW9uIChlKSB7XG5cdCAgICAgICAgICBtYWtlU3RhY2tUcmFjZUxvbmcoZSwgc2VsZik7XG5cdCAgICAgICAgICBvbGRPbkVycm9yLmNhbGwobywgZSk7XG5cdCAgICAgICAgfTtcblx0XG5cdCAgICAgICAgcmV0dXJuIHN1YnNjcmliZS5jYWxsKHNlbGYsIG8pO1xuXHQgICAgICB9O1xuXHQgICAgfVxuXHRcblx0ICAgIGZ1bmN0aW9uIE9ic2VydmFibGUoKSB7XG5cdCAgICAgIGlmIChSeC5jb25maWcubG9uZ1N0YWNrU3VwcG9ydCAmJiBoYXNTdGFja3MpIHtcblx0ICAgICAgICB2YXIgb2xkU3Vic2NyaWJlID0gdGhpcy5fc3Vic2NyaWJlO1xuXHQgICAgICAgIHZhciBlID0gdHJ5Q2F0Y2godGhyb3dlcikobmV3IEVycm9yKCkpLmU7XG5cdCAgICAgICAgdGhpcy5zdGFjayA9IGUuc3RhY2suc3Vic3RyaW5nKGUuc3RhY2suaW5kZXhPZignXFxuJykgKyAxKTtcblx0ICAgICAgICB0aGlzLl9zdWJzY3JpYmUgPSBtYWtlU3Vic2NyaWJlKHRoaXMsIG9sZFN1YnNjcmliZSk7XG5cdCAgICAgIH1cblx0ICAgIH1cblx0XG5cdCAgICBvYnNlcnZhYmxlUHJvdG8gPSBPYnNlcnZhYmxlLnByb3RvdHlwZTtcblx0XG5cdCAgICAvKipcblx0ICAgICogRGV0ZXJtaW5lcyB3aGV0aGVyIHRoZSBnaXZlbiBvYmplY3QgaXMgYW4gT2JzZXJ2YWJsZVxuXHQgICAgKiBAcGFyYW0ge0FueX0gQW4gb2JqZWN0IHRvIGRldGVybWluZSB3aGV0aGVyIGl0IGlzIGFuIE9ic2VydmFibGVcblx0ICAgICogQHJldHVybnMge0Jvb2xlYW59IHRydWUgaWYgYW4gT2JzZXJ2YWJsZSwgZWxzZSBmYWxzZS5cblx0ICAgICovXG5cdCAgICBPYnNlcnZhYmxlLmlzT2JzZXJ2YWJsZSA9IGZ1bmN0aW9uIChvKSB7XG5cdCAgICAgIHJldHVybiBvICYmIGlzRnVuY3Rpb24oby5zdWJzY3JpYmUpO1xuXHQgICAgfTtcblx0XG5cdCAgICAvKipcblx0ICAgICAqICBTdWJzY3JpYmVzIGFuIG8gdG8gdGhlIG9ic2VydmFibGUgc2VxdWVuY2UuXG5cdCAgICAgKiAgQHBhcmFtIHtNaXhlZH0gW29Pck9uTmV4dF0gVGhlIG9iamVjdCB0aGF0IGlzIHRvIHJlY2VpdmUgbm90aWZpY2F0aW9ucyBvciBhbiBhY3Rpb24gdG8gaW52b2tlIGZvciBlYWNoIGVsZW1lbnQgaW4gdGhlIG9ic2VydmFibGUgc2VxdWVuY2UuXG5cdCAgICAgKiAgQHBhcmFtIHtGdW5jdGlvbn0gW29uRXJyb3JdIEFjdGlvbiB0byBpbnZva2UgdXBvbiBleGNlcHRpb25hbCB0ZXJtaW5hdGlvbiBvZiB0aGUgb2JzZXJ2YWJsZSBzZXF1ZW5jZS5cblx0ICAgICAqICBAcGFyYW0ge0Z1bmN0aW9ufSBbb25Db21wbGV0ZWRdIEFjdGlvbiB0byBpbnZva2UgdXBvbiBncmFjZWZ1bCB0ZXJtaW5hdGlvbiBvZiB0aGUgb2JzZXJ2YWJsZSBzZXF1ZW5jZS5cblx0ICAgICAqICBAcmV0dXJucyB7RGlwb3NhYmxlfSBBIGRpc3Bvc2FibGUgaGFuZGxpbmcgdGhlIHN1YnNjcmlwdGlvbnMgYW5kIHVuc3Vic2NyaXB0aW9ucy5cblx0ICAgICAqL1xuXHQgICAgb2JzZXJ2YWJsZVByb3RvLnN1YnNjcmliZSA9IG9ic2VydmFibGVQcm90by5mb3JFYWNoID0gZnVuY3Rpb24gKG9Pck9uTmV4dCwgb25FcnJvciwgb25Db21wbGV0ZWQpIHtcblx0ICAgICAgcmV0dXJuIHRoaXMuX3N1YnNjcmliZSh0eXBlb2Ygb09yT25OZXh0ID09PSAnb2JqZWN0JyA/XG5cdCAgICAgICAgb09yT25OZXh0IDpcblx0ICAgICAgICBvYnNlcnZlckNyZWF0ZShvT3JPbk5leHQsIG9uRXJyb3IsIG9uQ29tcGxldGVkKSk7XG5cdCAgICB9O1xuXHRcblx0ICAgIC8qKlxuXHQgICAgICogU3Vic2NyaWJlcyB0byB0aGUgbmV4dCB2YWx1ZSBpbiB0aGUgc2VxdWVuY2Ugd2l0aCBhbiBvcHRpb25hbCBcInRoaXNcIiBhcmd1bWVudC5cblx0ICAgICAqIEBwYXJhbSB7RnVuY3Rpb259IG9uTmV4dCBUaGUgZnVuY3Rpb24gdG8gaW52b2tlIG9uIGVhY2ggZWxlbWVudCBpbiB0aGUgb2JzZXJ2YWJsZSBzZXF1ZW5jZS5cblx0ICAgICAqIEBwYXJhbSB7QW55fSBbdGhpc0FyZ10gT2JqZWN0IHRvIHVzZSBhcyB0aGlzIHdoZW4gZXhlY3V0aW5nIGNhbGxiYWNrLlxuXHQgICAgICogQHJldHVybnMge0Rpc3Bvc2FibGV9IEEgZGlzcG9zYWJsZSBoYW5kbGluZyB0aGUgc3Vic2NyaXB0aW9ucyBhbmQgdW5zdWJzY3JpcHRpb25zLlxuXHQgICAgICovXG5cdCAgICBvYnNlcnZhYmxlUHJvdG8uc3Vic2NyaWJlT25OZXh0ID0gZnVuY3Rpb24gKG9uTmV4dCwgdGhpc0FyZykge1xuXHQgICAgICByZXR1cm4gdGhpcy5fc3Vic2NyaWJlKG9ic2VydmVyQ3JlYXRlKHR5cGVvZiB0aGlzQXJnICE9PSAndW5kZWZpbmVkJyA/IGZ1bmN0aW9uKHgpIHsgb25OZXh0LmNhbGwodGhpc0FyZywgeCk7IH0gOiBvbk5leHQpKTtcblx0ICAgIH07XG5cdFxuXHQgICAgLyoqXG5cdCAgICAgKiBTdWJzY3JpYmVzIHRvIGFuIGV4Y2VwdGlvbmFsIGNvbmRpdGlvbiBpbiB0aGUgc2VxdWVuY2Ugd2l0aCBhbiBvcHRpb25hbCBcInRoaXNcIiBhcmd1bWVudC5cblx0ICAgICAqIEBwYXJhbSB7RnVuY3Rpb259IG9uRXJyb3IgVGhlIGZ1bmN0aW9uIHRvIGludm9rZSB1cG9uIGV4Y2VwdGlvbmFsIHRlcm1pbmF0aW9uIG9mIHRoZSBvYnNlcnZhYmxlIHNlcXVlbmNlLlxuXHQgICAgICogQHBhcmFtIHtBbnl9IFt0aGlzQXJnXSBPYmplY3QgdG8gdXNlIGFzIHRoaXMgd2hlbiBleGVjdXRpbmcgY2FsbGJhY2suXG5cdCAgICAgKiBAcmV0dXJucyB7RGlzcG9zYWJsZX0gQSBkaXNwb3NhYmxlIGhhbmRsaW5nIHRoZSBzdWJzY3JpcHRpb25zIGFuZCB1bnN1YnNjcmlwdGlvbnMuXG5cdCAgICAgKi9cblx0ICAgIG9ic2VydmFibGVQcm90by5zdWJzY3JpYmVPbkVycm9yID0gZnVuY3Rpb24gKG9uRXJyb3IsIHRoaXNBcmcpIHtcblx0ICAgICAgcmV0dXJuIHRoaXMuX3N1YnNjcmliZShvYnNlcnZlckNyZWF0ZShudWxsLCB0eXBlb2YgdGhpc0FyZyAhPT0gJ3VuZGVmaW5lZCcgPyBmdW5jdGlvbihlKSB7IG9uRXJyb3IuY2FsbCh0aGlzQXJnLCBlKTsgfSA6IG9uRXJyb3IpKTtcblx0ICAgIH07XG5cdFxuXHQgICAgLyoqXG5cdCAgICAgKiBTdWJzY3JpYmVzIHRvIHRoZSBuZXh0IHZhbHVlIGluIHRoZSBzZXF1ZW5jZSB3aXRoIGFuIG9wdGlvbmFsIFwidGhpc1wiIGFyZ3VtZW50LlxuXHQgICAgICogQHBhcmFtIHtGdW5jdGlvbn0gb25Db21wbGV0ZWQgVGhlIGZ1bmN0aW9uIHRvIGludm9rZSB1cG9uIGdyYWNlZnVsIHRlcm1pbmF0aW9uIG9mIHRoZSBvYnNlcnZhYmxlIHNlcXVlbmNlLlxuXHQgICAgICogQHBhcmFtIHtBbnl9IFt0aGlzQXJnXSBPYmplY3QgdG8gdXNlIGFzIHRoaXMgd2hlbiBleGVjdXRpbmcgY2FsbGJhY2suXG5cdCAgICAgKiBAcmV0dXJucyB7RGlzcG9zYWJsZX0gQSBkaXNwb3NhYmxlIGhhbmRsaW5nIHRoZSBzdWJzY3JpcHRpb25zIGFuZCB1bnN1YnNjcmlwdGlvbnMuXG5cdCAgICAgKi9cblx0ICAgIG9ic2VydmFibGVQcm90by5zdWJzY3JpYmVPbkNvbXBsZXRlZCA9IGZ1bmN0aW9uIChvbkNvbXBsZXRlZCwgdGhpc0FyZykge1xuXHQgICAgICByZXR1cm4gdGhpcy5fc3Vic2NyaWJlKG9ic2VydmVyQ3JlYXRlKG51bGwsIG51bGwsIHR5cGVvZiB0aGlzQXJnICE9PSAndW5kZWZpbmVkJyA/IGZ1bmN0aW9uKCkgeyBvbkNvbXBsZXRlZC5jYWxsKHRoaXNBcmcpOyB9IDogb25Db21wbGV0ZWQpKTtcblx0ICAgIH07XG5cdFxuXHQgICAgcmV0dXJuIE9ic2VydmFibGU7XG5cdCAgfSkoKTtcblx0XG5cdCAgdmFyIE9ic2VydmFibGVCYXNlID0gUnguT2JzZXJ2YWJsZUJhc2UgPSAoZnVuY3Rpb24gKF9fc3VwZXJfXykge1xuXHQgICAgaW5oZXJpdHMoT2JzZXJ2YWJsZUJhc2UsIF9fc3VwZXJfXyk7XG5cdFxuXHQgICAgZnVuY3Rpb24gZml4U3Vic2NyaWJlcihzdWJzY3JpYmVyKSB7XG5cdCAgICAgIHJldHVybiBzdWJzY3JpYmVyICYmIGlzRnVuY3Rpb24oc3Vic2NyaWJlci5kaXNwb3NlKSA/IHN1YnNjcmliZXIgOlxuXHQgICAgICAgIGlzRnVuY3Rpb24oc3Vic2NyaWJlcikgPyBkaXNwb3NhYmxlQ3JlYXRlKHN1YnNjcmliZXIpIDogZGlzcG9zYWJsZUVtcHR5O1xuXHQgICAgfVxuXHRcblx0ICAgIGZ1bmN0aW9uIHNldERpc3Bvc2FibGUocywgc3RhdGUpIHtcblx0ICAgICAgdmFyIGFkbyA9IHN0YXRlWzBdLCBzZWxmID0gc3RhdGVbMV07XG5cdCAgICAgIHZhciBzdWIgPSB0cnlDYXRjaChzZWxmLnN1YnNjcmliZUNvcmUpLmNhbGwoc2VsZiwgYWRvKTtcblx0ICAgICAgaWYgKHN1YiA9PT0gZXJyb3JPYmogJiYgIWFkby5mYWlsKGVycm9yT2JqLmUpKSB7IHRocm93ZXIoZXJyb3JPYmouZSk7IH1cblx0ICAgICAgYWRvLnNldERpc3Bvc2FibGUoZml4U3Vic2NyaWJlcihzdWIpKTtcblx0ICAgIH1cblx0XG5cdCAgICBmdW5jdGlvbiBPYnNlcnZhYmxlQmFzZSgpIHtcblx0ICAgICAgX19zdXBlcl9fLmNhbGwodGhpcyk7XG5cdCAgICB9XG5cdFxuXHQgICAgT2JzZXJ2YWJsZUJhc2UucHJvdG90eXBlLl9zdWJzY3JpYmUgPSBmdW5jdGlvbiAobykge1xuXHQgICAgICB2YXIgYWRvID0gbmV3IEF1dG9EZXRhY2hPYnNlcnZlcihvKSwgc3RhdGUgPSBbYWRvLCB0aGlzXTtcblx0XG5cdCAgICAgIGlmIChjdXJyZW50VGhyZWFkU2NoZWR1bGVyLnNjaGVkdWxlUmVxdWlyZWQoKSkge1xuXHQgICAgICAgIGN1cnJlbnRUaHJlYWRTY2hlZHVsZXIuc2NoZWR1bGUoc3RhdGUsIHNldERpc3Bvc2FibGUpO1xuXHQgICAgICB9IGVsc2Uge1xuXHQgICAgICAgIHNldERpc3Bvc2FibGUobnVsbCwgc3RhdGUpO1xuXHQgICAgICB9XG5cdCAgICAgIHJldHVybiBhZG87XG5cdCAgICB9O1xuXHRcblx0ICAgIE9ic2VydmFibGVCYXNlLnByb3RvdHlwZS5zdWJzY3JpYmVDb3JlID0gbm90SW1wbGVtZW50ZWQ7XG5cdFxuXHQgICAgcmV0dXJuIE9ic2VydmFibGVCYXNlO1xuXHQgIH0oT2JzZXJ2YWJsZSkpO1xuXHRcblx0dmFyIEZsYXRNYXBPYnNlcnZhYmxlID0gUnguRmxhdE1hcE9ic2VydmFibGUgPSAoZnVuY3Rpb24oX19zdXBlcl9fKSB7XG5cdFxuXHQgICAgaW5oZXJpdHMoRmxhdE1hcE9ic2VydmFibGUsIF9fc3VwZXJfXyk7XG5cdFxuXHQgICAgZnVuY3Rpb24gRmxhdE1hcE9ic2VydmFibGUoc291cmNlLCBzZWxlY3RvciwgcmVzdWx0U2VsZWN0b3IsIHRoaXNBcmcpIHtcblx0ICAgICAgdGhpcy5yZXN1bHRTZWxlY3RvciA9IGlzRnVuY3Rpb24ocmVzdWx0U2VsZWN0b3IpID8gcmVzdWx0U2VsZWN0b3IgOiBudWxsO1xuXHQgICAgICB0aGlzLnNlbGVjdG9yID0gYmluZENhbGxiYWNrKGlzRnVuY3Rpb24oc2VsZWN0b3IpID8gc2VsZWN0b3IgOiBmdW5jdGlvbigpIHsgcmV0dXJuIHNlbGVjdG9yOyB9LCB0aGlzQXJnLCAzKTtcblx0ICAgICAgdGhpcy5zb3VyY2UgPSBzb3VyY2U7XG5cdCAgICAgIF9fc3VwZXJfXy5jYWxsKHRoaXMpO1xuXHQgICAgfVxuXHRcblx0ICAgIEZsYXRNYXBPYnNlcnZhYmxlLnByb3RvdHlwZS5zdWJzY3JpYmVDb3JlID0gZnVuY3Rpb24obykge1xuXHQgICAgICByZXR1cm4gdGhpcy5zb3VyY2Uuc3Vic2NyaWJlKG5ldyBJbm5lck9ic2VydmVyKG8sIHRoaXMuc2VsZWN0b3IsIHRoaXMucmVzdWx0U2VsZWN0b3IsIHRoaXMpKTtcblx0ICAgIH07XG5cdFxuXHQgICAgaW5oZXJpdHMoSW5uZXJPYnNlcnZlciwgQWJzdHJhY3RPYnNlcnZlcik7XG5cdCAgICBmdW5jdGlvbiBJbm5lck9ic2VydmVyKG9ic2VydmVyLCBzZWxlY3RvciwgcmVzdWx0U2VsZWN0b3IsIHNvdXJjZSkge1xuXHQgICAgICB0aGlzLmkgPSAwO1xuXHQgICAgICB0aGlzLnNlbGVjdG9yID0gc2VsZWN0b3I7XG5cdCAgICAgIHRoaXMucmVzdWx0U2VsZWN0b3IgPSByZXN1bHRTZWxlY3Rvcjtcblx0ICAgICAgdGhpcy5zb3VyY2UgPSBzb3VyY2U7XG5cdCAgICAgIHRoaXMubyA9IG9ic2VydmVyO1xuXHQgICAgICBBYnN0cmFjdE9ic2VydmVyLmNhbGwodGhpcyk7XG5cdCAgICB9XG5cdFxuXHQgICAgSW5uZXJPYnNlcnZlci5wcm90b3R5cGUuX3dyYXBSZXN1bHQgPSBmdW5jdGlvbihyZXN1bHQsIHgsIGkpIHtcblx0ICAgICAgcmV0dXJuIHRoaXMucmVzdWx0U2VsZWN0b3IgP1xuXHQgICAgICAgIHJlc3VsdC5tYXAoZnVuY3Rpb24oeSwgaTIpIHsgcmV0dXJuIHRoaXMucmVzdWx0U2VsZWN0b3IoeCwgeSwgaSwgaTIpOyB9LCB0aGlzKSA6XG5cdCAgICAgICAgcmVzdWx0O1xuXHQgICAgfTtcblx0XG5cdCAgICBJbm5lck9ic2VydmVyLnByb3RvdHlwZS5uZXh0ID0gZnVuY3Rpb24oeCkge1xuXHQgICAgICB2YXIgaSA9IHRoaXMuaSsrO1xuXHQgICAgICB2YXIgcmVzdWx0ID0gdHJ5Q2F0Y2godGhpcy5zZWxlY3RvcikoeCwgaSwgdGhpcy5zb3VyY2UpO1xuXHQgICAgICBpZiAocmVzdWx0ID09PSBlcnJvck9iaikgeyByZXR1cm4gdGhpcy5vLm9uRXJyb3IocmVzdWx0LmUpOyB9XG5cdFxuXHQgICAgICBpc1Byb21pc2UocmVzdWx0KSAmJiAocmVzdWx0ID0gb2JzZXJ2YWJsZUZyb21Qcm9taXNlKHJlc3VsdCkpO1xuXHQgICAgICAoaXNBcnJheUxpa2UocmVzdWx0KSB8fCBpc0l0ZXJhYmxlKHJlc3VsdCkpICYmIChyZXN1bHQgPSBPYnNlcnZhYmxlLmZyb20ocmVzdWx0KSk7XG5cdCAgICAgIHRoaXMuby5vbk5leHQodGhpcy5fd3JhcFJlc3VsdChyZXN1bHQsIHgsIGkpKTtcblx0ICAgIH07XG5cdFxuXHQgICAgSW5uZXJPYnNlcnZlci5wcm90b3R5cGUuZXJyb3IgPSBmdW5jdGlvbihlKSB7IHRoaXMuby5vbkVycm9yKGUpOyB9O1xuXHRcblx0ICAgIElubmVyT2JzZXJ2ZXIucHJvdG90eXBlLm9uQ29tcGxldGVkID0gZnVuY3Rpb24oKSB7IHRoaXMuby5vbkNvbXBsZXRlZCgpOyB9O1xuXHRcblx0ICAgIHJldHVybiBGbGF0TWFwT2JzZXJ2YWJsZTtcblx0XG5cdH0oT2JzZXJ2YWJsZUJhc2UpKTtcblx0XG5cdCAgdmFyIEVudW1lcmFibGUgPSBSeC5pbnRlcm5hbHMuRW51bWVyYWJsZSA9IGZ1bmN0aW9uICgpIHsgfTtcblx0XG5cdCAgZnVuY3Rpb24gSXNEaXNwb3NlZERpc3Bvc2FibGUoc3RhdGUpIHtcblx0ICAgIHRoaXMuX3MgPSBzdGF0ZTtcblx0ICAgIHRoaXMuaXNEaXNwb3NlZCA9IGZhbHNlO1xuXHQgIH1cblx0XG5cdCAgSXNEaXNwb3NlZERpc3Bvc2FibGUucHJvdG90eXBlLmRpc3Bvc2UgPSBmdW5jdGlvbiAoKSB7XG5cdCAgICBpZiAoIXRoaXMuaXNEaXNwb3NlZCkge1xuXHQgICAgICB0aGlzLmlzRGlzcG9zZWQgPSB0cnVlO1xuXHQgICAgICB0aGlzLl9zLmlzRGlzcG9zZWQgPSB0cnVlO1xuXHQgICAgfVxuXHQgIH07XG5cdFxuXHQgIHZhciBDb25jYXRFbnVtZXJhYmxlT2JzZXJ2YWJsZSA9IChmdW5jdGlvbihfX3N1cGVyX18pIHtcblx0ICAgIGluaGVyaXRzKENvbmNhdEVudW1lcmFibGVPYnNlcnZhYmxlLCBfX3N1cGVyX18pO1xuXHQgICAgZnVuY3Rpb24gQ29uY2F0RW51bWVyYWJsZU9ic2VydmFibGUoc291cmNlcykge1xuXHQgICAgICB0aGlzLnNvdXJjZXMgPSBzb3VyY2VzO1xuXHQgICAgICBfX3N1cGVyX18uY2FsbCh0aGlzKTtcblx0ICAgIH1cblx0XG5cdCAgICBDb25jYXRFbnVtZXJhYmxlT2JzZXJ2YWJsZS5wcm90b3R5cGUuc3Vic2NyaWJlQ29yZSA9IGZ1bmN0aW9uIChvKSB7XG5cdCAgICAgIHZhciBzdGF0ZSA9IHsgaXNEaXNwb3NlZDogZmFsc2UgfSwgc3Vic2NyaXB0aW9uID0gbmV3IFNlcmlhbERpc3Bvc2FibGUoKTtcblx0ICAgICAgdmFyIGNhbmNlbGFibGUgPSBjdXJyZW50VGhyZWFkU2NoZWR1bGVyLnNjaGVkdWxlUmVjdXJzaXZlKHRoaXMuc291cmNlc1skaXRlcmF0b3IkXSgpLCBmdW5jdGlvbiAoZSwgc2VsZikge1xuXHQgICAgICAgIGlmIChzdGF0ZS5pc0Rpc3Bvc2VkKSB7IHJldHVybjsgfVxuXHQgICAgICAgIHZhciBjdXJyZW50SXRlbSA9IHRyeUNhdGNoKGUubmV4dCkuY2FsbChlKTtcblx0ICAgICAgICBpZiAoY3VycmVudEl0ZW0gPT09IGVycm9yT2JqKSB7IHJldHVybiBvLm9uRXJyb3IoY3VycmVudEl0ZW0uZSk7IH1cblx0XG5cdCAgICAgICAgaWYgKGN1cnJlbnRJdGVtLmRvbmUpIHtcblx0ICAgICAgICAgIHJldHVybiBvLm9uQ29tcGxldGVkKCk7XG5cdCAgICAgICAgfVxuXHRcblx0ICAgICAgICAvLyBDaGVjayBpZiBwcm9taXNlXG5cdCAgICAgICAgdmFyIGN1cnJlbnRWYWx1ZSA9IGN1cnJlbnRJdGVtLnZhbHVlO1xuXHQgICAgICAgIGlzUHJvbWlzZShjdXJyZW50VmFsdWUpICYmIChjdXJyZW50VmFsdWUgPSBvYnNlcnZhYmxlRnJvbVByb21pc2UoY3VycmVudFZhbHVlKSk7XG5cdFxuXHQgICAgICAgIHZhciBkID0gbmV3IFNpbmdsZUFzc2lnbm1lbnREaXNwb3NhYmxlKCk7XG5cdCAgICAgICAgc3Vic2NyaXB0aW9uLnNldERpc3Bvc2FibGUoZCk7XG5cdCAgICAgICAgZC5zZXREaXNwb3NhYmxlKGN1cnJlbnRWYWx1ZS5zdWJzY3JpYmUobmV3IElubmVyT2JzZXJ2ZXIobywgc2VsZiwgZSkpKTtcblx0ICAgICAgfSk7XG5cdFxuXHQgICAgICByZXR1cm4gbmV3IE5BcnlEaXNwb3NhYmxlKFtzdWJzY3JpcHRpb24sIGNhbmNlbGFibGUsIG5ldyBJc0Rpc3Bvc2VkRGlzcG9zYWJsZShzdGF0ZSldKTtcblx0ICAgIH07XG5cdFxuXHQgICAgaW5oZXJpdHMoSW5uZXJPYnNlcnZlciwgQWJzdHJhY3RPYnNlcnZlcik7XG5cdCAgICBmdW5jdGlvbiBJbm5lck9ic2VydmVyKG8sIHMsIGUpIHtcblx0ICAgICAgdGhpcy5fbyA9IG87XG5cdCAgICAgIHRoaXMuX3MgPSBzO1xuXHQgICAgICB0aGlzLl9lID0gZTtcblx0ICAgICAgQWJzdHJhY3RPYnNlcnZlci5jYWxsKHRoaXMpO1xuXHQgICAgfVxuXHQgICAgSW5uZXJPYnNlcnZlci5wcm90b3R5cGUub25OZXh0ID0gZnVuY3Rpb24gKHgpIHsgdGhpcy5fby5vbk5leHQoeCk7IH07XG5cdCAgICBJbm5lck9ic2VydmVyLnByb3RvdHlwZS5vbkVycm9yID0gZnVuY3Rpb24gKGUpIHsgdGhpcy5fby5vbkVycm9yKGUpOyB9O1xuXHQgICAgSW5uZXJPYnNlcnZlci5wcm90b3R5cGUub25Db21wbGV0ZWQgPSBmdW5jdGlvbiAoKSB7IHRoaXMuX3ModGhpcy5fZSk7IH07XG5cdFxuXHQgICAgcmV0dXJuIENvbmNhdEVudW1lcmFibGVPYnNlcnZhYmxlO1xuXHQgIH0oT2JzZXJ2YWJsZUJhc2UpKTtcblx0XG5cdCAgRW51bWVyYWJsZS5wcm90b3R5cGUuY29uY2F0ID0gZnVuY3Rpb24gKCkge1xuXHQgICAgcmV0dXJuIG5ldyBDb25jYXRFbnVtZXJhYmxlT2JzZXJ2YWJsZSh0aGlzKTtcblx0ICB9O1xuXHRcblx0ICB2YXIgQ2F0Y2hFcnJvck9ic2VydmFibGUgPSAoZnVuY3Rpb24oX19zdXBlcl9fKSB7XG5cdCAgICBpbmhlcml0cyhDYXRjaEVycm9yT2JzZXJ2YWJsZSwgX19zdXBlcl9fKTtcblx0ICAgIGZ1bmN0aW9uIENhdGNoRXJyb3JPYnNlcnZhYmxlKHNvdXJjZXMpIHtcblx0ICAgICAgdGhpcy5zb3VyY2VzID0gc291cmNlcztcblx0ICAgICAgX19zdXBlcl9fLmNhbGwodGhpcyk7XG5cdCAgICB9XG5cdFxuXHQgICAgQ2F0Y2hFcnJvck9ic2VydmFibGUucHJvdG90eXBlLnN1YnNjcmliZUNvcmUgPSBmdW5jdGlvbiAobykge1xuXHQgICAgICB2YXIgZSA9IHRoaXMuc291cmNlc1skaXRlcmF0b3IkXSgpO1xuXHRcblx0ICAgICAgdmFyIHN0YXRlID0geyBpc0Rpc3Bvc2VkOiBmYWxzZSB9LCBzdWJzY3JpcHRpb24gPSBuZXcgU2VyaWFsRGlzcG9zYWJsZSgpO1xuXHQgICAgICB2YXIgY2FuY2VsYWJsZSA9IGN1cnJlbnRUaHJlYWRTY2hlZHVsZXIuc2NoZWR1bGVSZWN1cnNpdmUobnVsbCwgZnVuY3Rpb24gKGxhc3RFeGNlcHRpb24sIHNlbGYpIHtcblx0ICAgICAgICBpZiAoc3RhdGUuaXNEaXNwb3NlZCkgeyByZXR1cm47IH1cblx0ICAgICAgICB2YXIgY3VycmVudEl0ZW0gPSB0cnlDYXRjaChlLm5leHQpLmNhbGwoZSk7XG5cdCAgICAgICAgaWYgKGN1cnJlbnRJdGVtID09PSBlcnJvck9iaikgeyByZXR1cm4gby5vbkVycm9yKGN1cnJlbnRJdGVtLmUpOyB9XG5cdFxuXHQgICAgICAgIGlmIChjdXJyZW50SXRlbS5kb25lKSB7XG5cdCAgICAgICAgICByZXR1cm4gbGFzdEV4Y2VwdGlvbiAhPT0gbnVsbCA/IG8ub25FcnJvcihsYXN0RXhjZXB0aW9uKSA6IG8ub25Db21wbGV0ZWQoKTtcblx0ICAgICAgICB9XG5cdFxuXHQgICAgICAgIC8vIENoZWNrIGlmIHByb21pc2Vcblx0ICAgICAgICB2YXIgY3VycmVudFZhbHVlID0gY3VycmVudEl0ZW0udmFsdWU7XG5cdCAgICAgICAgaXNQcm9taXNlKGN1cnJlbnRWYWx1ZSkgJiYgKGN1cnJlbnRWYWx1ZSA9IG9ic2VydmFibGVGcm9tUHJvbWlzZShjdXJyZW50VmFsdWUpKTtcblx0XG5cdCAgICAgICAgdmFyIGQgPSBuZXcgU2luZ2xlQXNzaWdubWVudERpc3Bvc2FibGUoKTtcblx0ICAgICAgICBzdWJzY3JpcHRpb24uc2V0RGlzcG9zYWJsZShkKTtcblx0ICAgICAgICBkLnNldERpc3Bvc2FibGUoY3VycmVudFZhbHVlLnN1YnNjcmliZShuZXcgSW5uZXJPYnNlcnZlcihvLCBzZWxmKSkpO1xuXHQgICAgICB9KTtcblx0ICAgICAgcmV0dXJuIG5ldyBOQXJ5RGlzcG9zYWJsZShbc3Vic2NyaXB0aW9uLCBjYW5jZWxhYmxlLCBuZXcgSXNEaXNwb3NlZERpc3Bvc2FibGUoc3RhdGUpXSk7XG5cdCAgICB9O1xuXHRcblx0ICAgIGluaGVyaXRzKElubmVyT2JzZXJ2ZXIsIEFic3RyYWN0T2JzZXJ2ZXIpO1xuXHQgICAgZnVuY3Rpb24gSW5uZXJPYnNlcnZlcihvLCByZWN1cnNlKSB7XG5cdCAgICAgIHRoaXMuX28gPSBvO1xuXHQgICAgICB0aGlzLl9yZWN1cnNlID0gcmVjdXJzZTtcblx0ICAgICAgQWJzdHJhY3RPYnNlcnZlci5jYWxsKHRoaXMpO1xuXHQgICAgfVxuXHRcblx0ICAgIElubmVyT2JzZXJ2ZXIucHJvdG90eXBlLm5leHQgPSBmdW5jdGlvbiAoeCkgeyB0aGlzLl9vLm9uTmV4dCh4KTsgfTtcblx0ICAgIElubmVyT2JzZXJ2ZXIucHJvdG90eXBlLmVycm9yID0gZnVuY3Rpb24gKGUpIHsgdGhpcy5fcmVjdXJzZShlKTsgfTtcblx0ICAgIElubmVyT2JzZXJ2ZXIucHJvdG90eXBlLmNvbXBsZXRlZCA9IGZ1bmN0aW9uICgpIHsgdGhpcy5fby5vbkNvbXBsZXRlZCgpOyB9O1xuXHRcblx0ICAgIHJldHVybiBDYXRjaEVycm9yT2JzZXJ2YWJsZTtcblx0ICB9KE9ic2VydmFibGVCYXNlKSk7XG5cdFxuXHQgIEVudW1lcmFibGUucHJvdG90eXBlLmNhdGNoRXJyb3IgPSBmdW5jdGlvbiAoKSB7XG5cdCAgICByZXR1cm4gbmV3IENhdGNoRXJyb3JPYnNlcnZhYmxlKHRoaXMpO1xuXHQgIH07XG5cdFxuXHQgIEVudW1lcmFibGUucHJvdG90eXBlLmNhdGNoRXJyb3JXaGVuID0gZnVuY3Rpb24gKG5vdGlmaWNhdGlvbkhhbmRsZXIpIHtcblx0ICAgIHZhciBzb3VyY2VzID0gdGhpcztcblx0ICAgIHJldHVybiBuZXcgQW5vbnltb3VzT2JzZXJ2YWJsZShmdW5jdGlvbiAobykge1xuXHQgICAgICB2YXIgZXhjZXB0aW9ucyA9IG5ldyBTdWJqZWN0KCksXG5cdCAgICAgICAgbm90aWZpZXIgPSBuZXcgU3ViamVjdCgpLFxuXHQgICAgICAgIGhhbmRsZWQgPSBub3RpZmljYXRpb25IYW5kbGVyKGV4Y2VwdGlvbnMpLFxuXHQgICAgICAgIG5vdGlmaWNhdGlvbkRpc3Bvc2FibGUgPSBoYW5kbGVkLnN1YnNjcmliZShub3RpZmllcik7XG5cdFxuXHQgICAgICB2YXIgZSA9IHNvdXJjZXNbJGl0ZXJhdG9yJF0oKTtcblx0XG5cdCAgICAgIHZhciBzdGF0ZSA9IHsgaXNEaXNwb3NlZDogZmFsc2UgfSxcblx0ICAgICAgICBsYXN0RXhjZXB0aW9uLFxuXHQgICAgICAgIHN1YnNjcmlwdGlvbiA9IG5ldyBTZXJpYWxEaXNwb3NhYmxlKCk7XG5cdCAgICAgIHZhciBjYW5jZWxhYmxlID0gY3VycmVudFRocmVhZFNjaGVkdWxlci5zY2hlZHVsZVJlY3Vyc2l2ZShudWxsLCBmdW5jdGlvbiAoXywgc2VsZikge1xuXHQgICAgICAgIGlmIChzdGF0ZS5pc0Rpc3Bvc2VkKSB7IHJldHVybjsgfVxuXHQgICAgICAgIHZhciBjdXJyZW50SXRlbSA9IHRyeUNhdGNoKGUubmV4dCkuY2FsbChlKTtcblx0ICAgICAgICBpZiAoY3VycmVudEl0ZW0gPT09IGVycm9yT2JqKSB7IHJldHVybiBvLm9uRXJyb3IoY3VycmVudEl0ZW0uZSk7IH1cblx0XG5cdCAgICAgICAgaWYgKGN1cnJlbnRJdGVtLmRvbmUpIHtcblx0ICAgICAgICAgIGlmIChsYXN0RXhjZXB0aW9uKSB7XG5cdCAgICAgICAgICAgIG8ub25FcnJvcihsYXN0RXhjZXB0aW9uKTtcblx0ICAgICAgICAgIH0gZWxzZSB7XG5cdCAgICAgICAgICAgIG8ub25Db21wbGV0ZWQoKTtcblx0ICAgICAgICAgIH1cblx0ICAgICAgICAgIHJldHVybjtcblx0ICAgICAgICB9XG5cdFxuXHQgICAgICAgIC8vIENoZWNrIGlmIHByb21pc2Vcblx0ICAgICAgICB2YXIgY3VycmVudFZhbHVlID0gY3VycmVudEl0ZW0udmFsdWU7XG5cdCAgICAgICAgaXNQcm9taXNlKGN1cnJlbnRWYWx1ZSkgJiYgKGN1cnJlbnRWYWx1ZSA9IG9ic2VydmFibGVGcm9tUHJvbWlzZShjdXJyZW50VmFsdWUpKTtcblx0XG5cdCAgICAgICAgdmFyIG91dGVyID0gbmV3IFNpbmdsZUFzc2lnbm1lbnREaXNwb3NhYmxlKCk7XG5cdCAgICAgICAgdmFyIGlubmVyID0gbmV3IFNpbmdsZUFzc2lnbm1lbnREaXNwb3NhYmxlKCk7XG5cdCAgICAgICAgc3Vic2NyaXB0aW9uLnNldERpc3Bvc2FibGUobmV3IEJpbmFyeURpc3Bvc2FibGUoaW5uZXIsIG91dGVyKSk7XG5cdCAgICAgICAgb3V0ZXIuc2V0RGlzcG9zYWJsZShjdXJyZW50VmFsdWUuc3Vic2NyaWJlKFxuXHQgICAgICAgICAgZnVuY3Rpb24oeCkgeyBvLm9uTmV4dCh4KTsgfSxcblx0ICAgICAgICAgIGZ1bmN0aW9uIChleG4pIHtcblx0ICAgICAgICAgICAgaW5uZXIuc2V0RGlzcG9zYWJsZShub3RpZmllci5zdWJzY3JpYmUoc2VsZiwgZnVuY3Rpb24oZXgpIHtcblx0ICAgICAgICAgICAgICBvLm9uRXJyb3IoZXgpO1xuXHQgICAgICAgICAgICB9LCBmdW5jdGlvbigpIHtcblx0ICAgICAgICAgICAgICBvLm9uQ29tcGxldGVkKCk7XG5cdCAgICAgICAgICAgIH0pKTtcblx0XG5cdCAgICAgICAgICAgIGV4Y2VwdGlvbnMub25OZXh0KGV4bik7XG5cdCAgICAgICAgICB9LFxuXHQgICAgICAgICAgZnVuY3Rpb24oKSB7IG8ub25Db21wbGV0ZWQoKTsgfSkpO1xuXHQgICAgICB9KTtcblx0XG5cdCAgICAgIHJldHVybiBuZXcgTkFyeURpc3Bvc2FibGUoW25vdGlmaWNhdGlvbkRpc3Bvc2FibGUsIHN1YnNjcmlwdGlvbiwgY2FuY2VsYWJsZSwgbmV3IElzRGlzcG9zZWREaXNwb3NhYmxlKHN0YXRlKV0pO1xuXHQgICAgfSk7XG5cdCAgfTtcblx0XG5cdCAgdmFyIFJlcGVhdEVudW1lcmFibGUgPSAoZnVuY3Rpb24gKF9fc3VwZXJfXykge1xuXHQgICAgaW5oZXJpdHMoUmVwZWF0RW51bWVyYWJsZSwgX19zdXBlcl9fKTtcblx0XG5cdCAgICBmdW5jdGlvbiBSZXBlYXRFbnVtZXJhYmxlKHYsIGMpIHtcblx0ICAgICAgdGhpcy52ID0gdjtcblx0ICAgICAgdGhpcy5jID0gYyA9PSBudWxsID8gLTEgOiBjO1xuXHQgICAgfVxuXHQgICAgUmVwZWF0RW51bWVyYWJsZS5wcm90b3R5cGVbJGl0ZXJhdG9yJF0gPSBmdW5jdGlvbiAoKSB7XG5cdCAgICAgIHJldHVybiBuZXcgUmVwZWF0RW51bWVyYXRvcih0aGlzKTtcblx0ICAgIH07XG5cdFxuXHQgICAgZnVuY3Rpb24gUmVwZWF0RW51bWVyYXRvcihwKSB7XG5cdCAgICAgIHRoaXMudiA9IHAudjtcblx0ICAgICAgdGhpcy5sID0gcC5jO1xuXHQgICAgfVxuXHQgICAgUmVwZWF0RW51bWVyYXRvci5wcm90b3R5cGUubmV4dCA9IGZ1bmN0aW9uICgpIHtcblx0ICAgICAgaWYgKHRoaXMubCA9PT0gMCkgeyByZXR1cm4gZG9uZUVudW1lcmF0b3I7IH1cblx0ICAgICAgaWYgKHRoaXMubCA+IDApIHsgdGhpcy5sLS07IH1cblx0ICAgICAgcmV0dXJuIHsgZG9uZTogZmFsc2UsIHZhbHVlOiB0aGlzLnYgfTtcblx0ICAgIH07XG5cdFxuXHQgICAgcmV0dXJuIFJlcGVhdEVudW1lcmFibGU7XG5cdCAgfShFbnVtZXJhYmxlKSk7XG5cdFxuXHQgIHZhciBlbnVtZXJhYmxlUmVwZWF0ID0gRW51bWVyYWJsZS5yZXBlYXQgPSBmdW5jdGlvbiAodmFsdWUsIHJlcGVhdENvdW50KSB7XG5cdCAgICByZXR1cm4gbmV3IFJlcGVhdEVudW1lcmFibGUodmFsdWUsIHJlcGVhdENvdW50KTtcblx0ICB9O1xuXHRcblx0ICB2YXIgT2ZFbnVtZXJhYmxlID0gKGZ1bmN0aW9uKF9fc3VwZXJfXykge1xuXHQgICAgaW5oZXJpdHMoT2ZFbnVtZXJhYmxlLCBfX3N1cGVyX18pO1xuXHQgICAgZnVuY3Rpb24gT2ZFbnVtZXJhYmxlKHMsIGZuLCB0aGlzQXJnKSB7XG5cdCAgICAgIHRoaXMucyA9IHM7XG5cdCAgICAgIHRoaXMuZm4gPSBmbiA/IGJpbmRDYWxsYmFjayhmbiwgdGhpc0FyZywgMykgOiBudWxsO1xuXHQgICAgfVxuXHQgICAgT2ZFbnVtZXJhYmxlLnByb3RvdHlwZVskaXRlcmF0b3IkXSA9IGZ1bmN0aW9uICgpIHtcblx0ICAgICAgcmV0dXJuIG5ldyBPZkVudW1lcmF0b3IodGhpcyk7XG5cdCAgICB9O1xuXHRcblx0ICAgIGZ1bmN0aW9uIE9mRW51bWVyYXRvcihwKSB7XG5cdCAgICAgIHRoaXMuaSA9IC0xO1xuXHQgICAgICB0aGlzLnMgPSBwLnM7XG5cdCAgICAgIHRoaXMubCA9IHRoaXMucy5sZW5ndGg7XG5cdCAgICAgIHRoaXMuZm4gPSBwLmZuO1xuXHQgICAgfVxuXHQgICAgT2ZFbnVtZXJhdG9yLnByb3RvdHlwZS5uZXh0ID0gZnVuY3Rpb24gKCkge1xuXHQgICAgIHJldHVybiArK3RoaXMuaSA8IHRoaXMubCA/XG5cdCAgICAgICB7IGRvbmU6IGZhbHNlLCB2YWx1ZTogIXRoaXMuZm4gPyB0aGlzLnNbdGhpcy5pXSA6IHRoaXMuZm4odGhpcy5zW3RoaXMuaV0sIHRoaXMuaSwgdGhpcy5zKSB9IDpcblx0ICAgICAgIGRvbmVFbnVtZXJhdG9yO1xuXHQgICAgfTtcblx0XG5cdCAgICByZXR1cm4gT2ZFbnVtZXJhYmxlO1xuXHQgIH0oRW51bWVyYWJsZSkpO1xuXHRcblx0ICB2YXIgZW51bWVyYWJsZU9mID0gRW51bWVyYWJsZS5vZiA9IGZ1bmN0aW9uIChzb3VyY2UsIHNlbGVjdG9yLCB0aGlzQXJnKSB7XG5cdCAgICByZXR1cm4gbmV3IE9mRW51bWVyYWJsZShzb3VyY2UsIHNlbGVjdG9yLCB0aGlzQXJnKTtcblx0ICB9O1xuXHRcblx0dmFyIE9ic2VydmVPbk9ic2VydmFibGUgPSAoZnVuY3Rpb24gKF9fc3VwZXJfXykge1xuXHQgIGluaGVyaXRzKE9ic2VydmVPbk9ic2VydmFibGUsIF9fc3VwZXJfXyk7XG5cdCAgZnVuY3Rpb24gT2JzZXJ2ZU9uT2JzZXJ2YWJsZShzb3VyY2UsIHMpIHtcblx0ICAgIHRoaXMuc291cmNlID0gc291cmNlO1xuXHQgICAgdGhpcy5fcyA9IHM7XG5cdCAgICBfX3N1cGVyX18uY2FsbCh0aGlzKTtcblx0ICB9XG5cdFxuXHQgIE9ic2VydmVPbk9ic2VydmFibGUucHJvdG90eXBlLnN1YnNjcmliZUNvcmUgPSBmdW5jdGlvbiAobykge1xuXHQgICAgcmV0dXJuIHRoaXMuc291cmNlLnN1YnNjcmliZShuZXcgT2JzZXJ2ZU9uT2JzZXJ2ZXIodGhpcy5fcywgbykpO1xuXHQgIH07XG5cdFxuXHQgIHJldHVybiBPYnNlcnZlT25PYnNlcnZhYmxlO1xuXHR9KE9ic2VydmFibGVCYXNlKSk7XG5cdFxuXHQgICAvKipcblx0ICAgKiAgV3JhcHMgdGhlIHNvdXJjZSBzZXF1ZW5jZSBpbiBvcmRlciB0byBydW4gaXRzIG9ic2VydmVyIGNhbGxiYWNrcyBvbiB0aGUgc3BlY2lmaWVkIHNjaGVkdWxlci5cblx0ICAgKlxuXHQgICAqICBUaGlzIG9ubHkgaW52b2tlcyBvYnNlcnZlciBjYWxsYmFja3Mgb24gYSBzY2hlZHVsZXIuIEluIGNhc2UgdGhlIHN1YnNjcmlwdGlvbiBhbmQvb3IgdW5zdWJzY3JpcHRpb24gYWN0aW9ucyBoYXZlIHNpZGUtZWZmZWN0c1xuXHQgICAqICB0aGF0IHJlcXVpcmUgdG8gYmUgcnVuIG9uIGEgc2NoZWR1bGVyLCB1c2Ugc3Vic2NyaWJlT24uXG5cdCAgICpcblx0ICAgKiAgQHBhcmFtIHtTY2hlZHVsZXJ9IHNjaGVkdWxlciBTY2hlZHVsZXIgdG8gbm90aWZ5IG9ic2VydmVycyBvbi5cblx0ICAgKiAgQHJldHVybnMge09ic2VydmFibGV9IFRoZSBzb3VyY2Ugc2VxdWVuY2Ugd2hvc2Ugb2JzZXJ2YXRpb25zIGhhcHBlbiBvbiB0aGUgc3BlY2lmaWVkIHNjaGVkdWxlci5cblx0ICAgKi9cblx0ICBvYnNlcnZhYmxlUHJvdG8ub2JzZXJ2ZU9uID0gZnVuY3Rpb24gKHNjaGVkdWxlcikge1xuXHQgICAgcmV0dXJuIG5ldyBPYnNlcnZlT25PYnNlcnZhYmxlKHRoaXMsIHNjaGVkdWxlcik7XG5cdCAgfTtcblx0XG5cdCAgdmFyIFN1YnNjcmliZU9uT2JzZXJ2YWJsZSA9IChmdW5jdGlvbiAoX19zdXBlcl9fKSB7XG5cdCAgICBpbmhlcml0cyhTdWJzY3JpYmVPbk9ic2VydmFibGUsIF9fc3VwZXJfXyk7XG5cdCAgICBmdW5jdGlvbiBTdWJzY3JpYmVPbk9ic2VydmFibGUoc291cmNlLCBzKSB7XG5cdCAgICAgIHRoaXMuc291cmNlID0gc291cmNlO1xuXHQgICAgICB0aGlzLl9zID0gcztcblx0ICAgICAgX19zdXBlcl9fLmNhbGwodGhpcyk7XG5cdCAgICB9XG5cdFxuXHQgICAgZnVuY3Rpb24gc2NoZWR1bGVNZXRob2Qoc2NoZWR1bGVyLCBzdGF0ZSkge1xuXHQgICAgICB2YXIgc291cmNlID0gc3RhdGVbMF0sIGQgPSBzdGF0ZVsxXSwgbyA9IHN0YXRlWzJdO1xuXHQgICAgICBkLnNldERpc3Bvc2FibGUobmV3IFNjaGVkdWxlZERpc3Bvc2FibGUoc2NoZWR1bGVyLCBzb3VyY2Uuc3Vic2NyaWJlKG8pKSk7XG5cdCAgICB9XG5cdFxuXHQgICAgU3Vic2NyaWJlT25PYnNlcnZhYmxlLnByb3RvdHlwZS5zdWJzY3JpYmVDb3JlID0gZnVuY3Rpb24gKG8pIHtcblx0ICAgICAgdmFyIG0gPSBuZXcgU2luZ2xlQXNzaWdubWVudERpc3Bvc2FibGUoKSwgZCA9IG5ldyBTZXJpYWxEaXNwb3NhYmxlKCk7XG5cdCAgICAgIGQuc2V0RGlzcG9zYWJsZShtKTtcblx0ICAgICAgbS5zZXREaXNwb3NhYmxlKHRoaXMuX3Muc2NoZWR1bGUoW3RoaXMuc291cmNlLCBkLCBvXSwgc2NoZWR1bGVNZXRob2QpKTtcblx0ICAgICAgcmV0dXJuIGQ7XG5cdCAgICB9O1xuXHRcblx0ICAgIHJldHVybiBTdWJzY3JpYmVPbk9ic2VydmFibGU7XG5cdCAgfShPYnNlcnZhYmxlQmFzZSkpO1xuXHRcblx0ICAgLyoqXG5cdCAgICogIFdyYXBzIHRoZSBzb3VyY2Ugc2VxdWVuY2UgaW4gb3JkZXIgdG8gcnVuIGl0cyBzdWJzY3JpcHRpb24gYW5kIHVuc3Vic2NyaXB0aW9uIGxvZ2ljIG9uIHRoZSBzcGVjaWZpZWQgc2NoZWR1bGVyLiBUaGlzIG9wZXJhdGlvbiBpcyBub3QgY29tbW9ubHkgdXNlZDtcblx0ICAgKiAgc2VlIHRoZSByZW1hcmtzIHNlY3Rpb24gZm9yIG1vcmUgaW5mb3JtYXRpb24gb24gdGhlIGRpc3RpbmN0aW9uIGJldHdlZW4gc3Vic2NyaWJlT24gYW5kIG9ic2VydmVPbi5cblx0XG5cdCAgICogIFRoaXMgb25seSBwZXJmb3JtcyB0aGUgc2lkZS1lZmZlY3RzIG9mIHN1YnNjcmlwdGlvbiBhbmQgdW5zdWJzY3JpcHRpb24gb24gdGhlIHNwZWNpZmllZCBzY2hlZHVsZXIuIEluIG9yZGVyIHRvIGludm9rZSBvYnNlcnZlclxuXHQgICAqICBjYWxsYmFja3Mgb24gYSBzY2hlZHVsZXIsIHVzZSBvYnNlcnZlT24uXG5cdFxuXHQgICAqICBAcGFyYW0ge1NjaGVkdWxlcn0gc2NoZWR1bGVyIFNjaGVkdWxlciB0byBwZXJmb3JtIHN1YnNjcmlwdGlvbiBhbmQgdW5zdWJzY3JpcHRpb24gYWN0aW9ucyBvbi5cblx0ICAgKiAgQHJldHVybnMge09ic2VydmFibGV9IFRoZSBzb3VyY2Ugc2VxdWVuY2Ugd2hvc2Ugc3Vic2NyaXB0aW9ucyBhbmQgdW5zdWJzY3JpcHRpb25zIGhhcHBlbiBvbiB0aGUgc3BlY2lmaWVkIHNjaGVkdWxlci5cblx0ICAgKi9cblx0ICBvYnNlcnZhYmxlUHJvdG8uc3Vic2NyaWJlT24gPSBmdW5jdGlvbiAoc2NoZWR1bGVyKSB7XG5cdCAgICByZXR1cm4gbmV3IFN1YnNjcmliZU9uT2JzZXJ2YWJsZSh0aGlzLCBzY2hlZHVsZXIpO1xuXHQgIH07XG5cdFxuXHQgIHZhciBGcm9tUHJvbWlzZU9ic2VydmFibGUgPSAoZnVuY3Rpb24oX19zdXBlcl9fKSB7XG5cdCAgICBpbmhlcml0cyhGcm9tUHJvbWlzZU9ic2VydmFibGUsIF9fc3VwZXJfXyk7XG5cdCAgICBmdW5jdGlvbiBGcm9tUHJvbWlzZU9ic2VydmFibGUocCkge1xuXHQgICAgICB0aGlzLnAgPSBwO1xuXHQgICAgICBfX3N1cGVyX18uY2FsbCh0aGlzKTtcblx0ICAgIH1cblx0XG5cdCAgICBGcm9tUHJvbWlzZU9ic2VydmFibGUucHJvdG90eXBlLnN1YnNjcmliZUNvcmUgPSBmdW5jdGlvbihvKSB7XG5cdCAgICAgIHRoaXMucFxuXHQgICAgICAgIC50aGVuKGZ1bmN0aW9uIChkYXRhKSB7XG5cdCAgICAgICAgICBvLm9uTmV4dChkYXRhKTtcblx0ICAgICAgICAgIG8ub25Db21wbGV0ZWQoKTtcblx0ICAgICAgICB9LCBmdW5jdGlvbiAoZXJyKSB7XG5cdCAgICAgICAgICBvLm9uRXJyb3IoZXJyKTtcblx0ICAgICAgICB9KTtcblx0ICAgICAgcmV0dXJuIGRpc3Bvc2FibGVFbXB0eTtcblx0ICAgIH07XG5cdFxuXHQgICAgcmV0dXJuIEZyb21Qcm9taXNlT2JzZXJ2YWJsZTtcblx0ICB9KE9ic2VydmFibGVCYXNlKSk7XG5cdFxuXHQgIC8qKlxuXHQgICogQ29udmVydHMgYSBQcm9taXNlIHRvIGFuIE9ic2VydmFibGUgc2VxdWVuY2Vcblx0ICAqIEBwYXJhbSB7UHJvbWlzZX0gQW4gRVM2IENvbXBsaWFudCBwcm9taXNlLlxuXHQgICogQHJldHVybnMge09ic2VydmFibGV9IEFuIE9ic2VydmFibGUgc2VxdWVuY2Ugd2hpY2ggd3JhcHMgdGhlIGV4aXN0aW5nIHByb21pc2Ugc3VjY2VzcyBhbmQgZmFpbHVyZS5cblx0ICAqL1xuXHQgIHZhciBvYnNlcnZhYmxlRnJvbVByb21pc2UgPSBPYnNlcnZhYmxlLmZyb21Qcm9taXNlID0gZnVuY3Rpb24gKHByb21pc2UpIHtcblx0ICAgIHJldHVybiBuZXcgRnJvbVByb21pc2VPYnNlcnZhYmxlKHByb21pc2UpO1xuXHQgIH07XG5cdFxuXHQgIC8qXG5cdCAgICogQ29udmVydHMgYW4gZXhpc3Rpbmcgb2JzZXJ2YWJsZSBzZXF1ZW5jZSB0byBhbiBFUzYgQ29tcGF0aWJsZSBQcm9taXNlXG5cdCAgICogQGV4YW1wbGVcblx0ICAgKiB2YXIgcHJvbWlzZSA9IFJ4Lk9ic2VydmFibGUucmV0dXJuKDQyKS50b1Byb21pc2UoUlNWUC5Qcm9taXNlKTtcblx0ICAgKlxuXHQgICAqIC8vIFdpdGggY29uZmlnXG5cdCAgICogUnguY29uZmlnLlByb21pc2UgPSBSU1ZQLlByb21pc2U7XG5cdCAgICogdmFyIHByb21pc2UgPSBSeC5PYnNlcnZhYmxlLnJldHVybig0MikudG9Qcm9taXNlKCk7XG5cdCAgICogQHBhcmFtIHtGdW5jdGlvbn0gW3Byb21pc2VDdG9yXSBUaGUgY29uc3RydWN0b3Igb2YgdGhlIHByb21pc2UuIElmIG5vdCBwcm92aWRlZCwgaXQgbG9va3MgZm9yIGl0IGluIFJ4LmNvbmZpZy5Qcm9taXNlLlxuXHQgICAqIEByZXR1cm5zIHtQcm9taXNlfSBBbiBFUzYgY29tcGF0aWJsZSBwcm9taXNlIHdpdGggdGhlIGxhc3QgdmFsdWUgZnJvbSB0aGUgb2JzZXJ2YWJsZSBzZXF1ZW5jZS5cblx0ICAgKi9cblx0ICBvYnNlcnZhYmxlUHJvdG8udG9Qcm9taXNlID0gZnVuY3Rpb24gKHByb21pc2VDdG9yKSB7XG5cdCAgICBwcm9taXNlQ3RvciB8fCAocHJvbWlzZUN0b3IgPSBSeC5jb25maWcuUHJvbWlzZSk7XG5cdCAgICBpZiAoIXByb21pc2VDdG9yKSB7IHRocm93IG5ldyBOb3RTdXBwb3J0ZWRFcnJvcignUHJvbWlzZSB0eXBlIG5vdCBwcm92aWRlZCBub3IgaW4gUnguY29uZmlnLlByb21pc2UnKTsgfVxuXHQgICAgdmFyIHNvdXJjZSA9IHRoaXM7XG5cdCAgICByZXR1cm4gbmV3IHByb21pc2VDdG9yKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHtcblx0ICAgICAgLy8gTm8gY2FuY2VsbGF0aW9uIGNhbiBiZSBkb25lXG5cdCAgICAgIHZhciB2YWx1ZTtcblx0ICAgICAgc291cmNlLnN1YnNjcmliZShmdW5jdGlvbiAodikge1xuXHQgICAgICAgIHZhbHVlID0gdjtcblx0ICAgICAgfSwgcmVqZWN0LCBmdW5jdGlvbiAoKSB7XG5cdCAgICAgICAgcmVzb2x2ZSh2YWx1ZSk7XG5cdCAgICAgIH0pO1xuXHQgICAgfSk7XG5cdCAgfTtcblx0XG5cdCAgdmFyIFRvQXJyYXlPYnNlcnZhYmxlID0gKGZ1bmN0aW9uKF9fc3VwZXJfXykge1xuXHQgICAgaW5oZXJpdHMoVG9BcnJheU9ic2VydmFibGUsIF9fc3VwZXJfXyk7XG5cdCAgICBmdW5jdGlvbiBUb0FycmF5T2JzZXJ2YWJsZShzb3VyY2UpIHtcblx0ICAgICAgdGhpcy5zb3VyY2UgPSBzb3VyY2U7XG5cdCAgICAgIF9fc3VwZXJfXy5jYWxsKHRoaXMpO1xuXHQgICAgfVxuXHRcblx0ICAgIFRvQXJyYXlPYnNlcnZhYmxlLnByb3RvdHlwZS5zdWJzY3JpYmVDb3JlID0gZnVuY3Rpb24obykge1xuXHQgICAgICByZXR1cm4gdGhpcy5zb3VyY2Uuc3Vic2NyaWJlKG5ldyBJbm5lck9ic2VydmVyKG8pKTtcblx0ICAgIH07XG5cdFxuXHQgICAgaW5oZXJpdHMoSW5uZXJPYnNlcnZlciwgQWJzdHJhY3RPYnNlcnZlcik7XG5cdCAgICBmdW5jdGlvbiBJbm5lck9ic2VydmVyKG8pIHtcblx0ICAgICAgdGhpcy5vID0gbztcblx0ICAgICAgdGhpcy5hID0gW107XG5cdCAgICAgIEFic3RyYWN0T2JzZXJ2ZXIuY2FsbCh0aGlzKTtcblx0ICAgIH1cblx0ICAgIFxuXHQgICAgSW5uZXJPYnNlcnZlci5wcm90b3R5cGUubmV4dCA9IGZ1bmN0aW9uICh4KSB7IHRoaXMuYS5wdXNoKHgpOyB9O1xuXHQgICAgSW5uZXJPYnNlcnZlci5wcm90b3R5cGUuZXJyb3IgPSBmdW5jdGlvbiAoZSkgeyB0aGlzLm8ub25FcnJvcihlKTsgIH07XG5cdCAgICBJbm5lck9ic2VydmVyLnByb3RvdHlwZS5jb21wbGV0ZWQgPSBmdW5jdGlvbiAoKSB7IHRoaXMuby5vbk5leHQodGhpcy5hKTsgdGhpcy5vLm9uQ29tcGxldGVkKCk7IH07XG5cdFxuXHQgICAgcmV0dXJuIFRvQXJyYXlPYnNlcnZhYmxlO1xuXHQgIH0oT2JzZXJ2YWJsZUJhc2UpKTtcblx0XG5cdCAgLyoqXG5cdCAgKiBDcmVhdGVzIGFuIGFycmF5IGZyb20gYW4gb2JzZXJ2YWJsZSBzZXF1ZW5jZS5cblx0ICAqIEByZXR1cm5zIHtPYnNlcnZhYmxlfSBBbiBvYnNlcnZhYmxlIHNlcXVlbmNlIGNvbnRhaW5pbmcgYSBzaW5nbGUgZWxlbWVudCB3aXRoIGEgbGlzdCBjb250YWluaW5nIGFsbCB0aGUgZWxlbWVudHMgb2YgdGhlIHNvdXJjZSBzZXF1ZW5jZS5cblx0ICAqL1xuXHQgIG9ic2VydmFibGVQcm90by50b0FycmF5ID0gZnVuY3Rpb24gKCkge1xuXHQgICAgcmV0dXJuIG5ldyBUb0FycmF5T2JzZXJ2YWJsZSh0aGlzKTtcblx0ICB9O1xuXHRcblx0ICAvKipcblx0ICAgKiAgQ3JlYXRlcyBhbiBvYnNlcnZhYmxlIHNlcXVlbmNlIGZyb20gYSBzcGVjaWZpZWQgc3Vic2NyaWJlIG1ldGhvZCBpbXBsZW1lbnRhdGlvbi5cblx0ICAgKiBAZXhhbXBsZVxuXHQgICAqICB2YXIgcmVzID0gUnguT2JzZXJ2YWJsZS5jcmVhdGUoZnVuY3Rpb24gKG9ic2VydmVyKSB7IHJldHVybiBmdW5jdGlvbiAoKSB7IH0gKTtcblx0ICAgKiAgdmFyIHJlcyA9IFJ4Lk9ic2VydmFibGUuY3JlYXRlKGZ1bmN0aW9uIChvYnNlcnZlcikgeyByZXR1cm4gUnguRGlzcG9zYWJsZS5lbXB0eTsgfSApO1xuXHQgICAqICB2YXIgcmVzID0gUnguT2JzZXJ2YWJsZS5jcmVhdGUoZnVuY3Rpb24gKG9ic2VydmVyKSB7IH0gKTtcblx0ICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBzdWJzY3JpYmUgSW1wbGVtZW50YXRpb24gb2YgdGhlIHJlc3VsdGluZyBvYnNlcnZhYmxlIHNlcXVlbmNlJ3Mgc3Vic2NyaWJlIG1ldGhvZCwgcmV0dXJuaW5nIGEgZnVuY3Rpb24gdGhhdCB3aWxsIGJlIHdyYXBwZWQgaW4gYSBEaXNwb3NhYmxlLlxuXHQgICAqIEByZXR1cm5zIHtPYnNlcnZhYmxlfSBUaGUgb2JzZXJ2YWJsZSBzZXF1ZW5jZSB3aXRoIHRoZSBzcGVjaWZpZWQgaW1wbGVtZW50YXRpb24gZm9yIHRoZSBTdWJzY3JpYmUgbWV0aG9kLlxuXHQgICAqL1xuXHQgIE9ic2VydmFibGUuY3JlYXRlID0gZnVuY3Rpb24gKHN1YnNjcmliZSwgcGFyZW50KSB7XG5cdCAgICByZXR1cm4gbmV3IEFub255bW91c09ic2VydmFibGUoc3Vic2NyaWJlLCBwYXJlbnQpO1xuXHQgIH07XG5cdFxuXHQgIHZhciBEZWZlciA9IChmdW5jdGlvbihfX3N1cGVyX18pIHtcblx0ICAgIGluaGVyaXRzKERlZmVyLCBfX3N1cGVyX18pO1xuXHQgICAgZnVuY3Rpb24gRGVmZXIoZmFjdG9yeSkge1xuXHQgICAgICB0aGlzLl9mID0gZmFjdG9yeTtcblx0ICAgICAgX19zdXBlcl9fLmNhbGwodGhpcyk7XG5cdCAgICB9XG5cdFxuXHQgICAgRGVmZXIucHJvdG90eXBlLnN1YnNjcmliZUNvcmUgPSBmdW5jdGlvbiAobykge1xuXHQgICAgICB2YXIgcmVzdWx0ID0gdHJ5Q2F0Y2godGhpcy5fZikoKTtcblx0ICAgICAgaWYgKHJlc3VsdCA9PT0gZXJyb3JPYmopIHsgcmV0dXJuIG9ic2VydmFibGVUaHJvdyhyZXN1bHQuZSkuc3Vic2NyaWJlKG8pO31cblx0ICAgICAgaXNQcm9taXNlKHJlc3VsdCkgJiYgKHJlc3VsdCA9IG9ic2VydmFibGVGcm9tUHJvbWlzZShyZXN1bHQpKTtcblx0ICAgICAgcmV0dXJuIHJlc3VsdC5zdWJzY3JpYmUobyk7XG5cdCAgICB9O1xuXHRcblx0ICAgIHJldHVybiBEZWZlcjtcblx0ICB9KE9ic2VydmFibGVCYXNlKSk7XG5cdFxuXHQgIC8qKlxuXHQgICAqICBSZXR1cm5zIGFuIG9ic2VydmFibGUgc2VxdWVuY2UgdGhhdCBpbnZva2VzIHRoZSBzcGVjaWZpZWQgZmFjdG9yeSBmdW5jdGlvbiB3aGVuZXZlciBhIG5ldyBvYnNlcnZlciBzdWJzY3JpYmVzLlxuXHQgICAqXG5cdCAgICogQGV4YW1wbGVcblx0ICAgKiAgdmFyIHJlcyA9IFJ4Lk9ic2VydmFibGUuZGVmZXIoZnVuY3Rpb24gKCkgeyByZXR1cm4gUnguT2JzZXJ2YWJsZS5mcm9tQXJyYXkoWzEsMiwzXSk7IH0pO1xuXHQgICAqIEBwYXJhbSB7RnVuY3Rpb259IG9ic2VydmFibGVGYWN0b3J5IE9ic2VydmFibGUgZmFjdG9yeSBmdW5jdGlvbiB0byBpbnZva2UgZm9yIGVhY2ggb2JzZXJ2ZXIgdGhhdCBzdWJzY3JpYmVzIHRvIHRoZSByZXN1bHRpbmcgc2VxdWVuY2Ugb3IgUHJvbWlzZS5cblx0ICAgKiBAcmV0dXJucyB7T2JzZXJ2YWJsZX0gQW4gb2JzZXJ2YWJsZSBzZXF1ZW5jZSB3aG9zZSBvYnNlcnZlcnMgdHJpZ2dlciBhbiBpbnZvY2F0aW9uIG9mIHRoZSBnaXZlbiBvYnNlcnZhYmxlIGZhY3RvcnkgZnVuY3Rpb24uXG5cdCAgICovXG5cdCAgdmFyIG9ic2VydmFibGVEZWZlciA9IE9ic2VydmFibGUuZGVmZXIgPSBmdW5jdGlvbiAob2JzZXJ2YWJsZUZhY3RvcnkpIHtcblx0ICAgIHJldHVybiBuZXcgRGVmZXIob2JzZXJ2YWJsZUZhY3RvcnkpO1xuXHQgIH07XG5cdFxuXHQgIHZhciBFbXB0eU9ic2VydmFibGUgPSAoZnVuY3Rpb24oX19zdXBlcl9fKSB7XG5cdCAgICBpbmhlcml0cyhFbXB0eU9ic2VydmFibGUsIF9fc3VwZXJfXyk7XG5cdCAgICBmdW5jdGlvbiBFbXB0eU9ic2VydmFibGUoc2NoZWR1bGVyKSB7XG5cdCAgICAgIHRoaXMuc2NoZWR1bGVyID0gc2NoZWR1bGVyO1xuXHQgICAgICBfX3N1cGVyX18uY2FsbCh0aGlzKTtcblx0ICAgIH1cblx0XG5cdCAgICBFbXB0eU9ic2VydmFibGUucHJvdG90eXBlLnN1YnNjcmliZUNvcmUgPSBmdW5jdGlvbiAob2JzZXJ2ZXIpIHtcblx0ICAgICAgdmFyIHNpbmsgPSBuZXcgRW1wdHlTaW5rKG9ic2VydmVyLCB0aGlzLnNjaGVkdWxlcik7XG5cdCAgICAgIHJldHVybiBzaW5rLnJ1bigpO1xuXHQgICAgfTtcblx0XG5cdCAgICBmdW5jdGlvbiBFbXB0eVNpbmsob2JzZXJ2ZXIsIHNjaGVkdWxlcikge1xuXHQgICAgICB0aGlzLm9ic2VydmVyID0gb2JzZXJ2ZXI7XG5cdCAgICAgIHRoaXMuc2NoZWR1bGVyID0gc2NoZWR1bGVyO1xuXHQgICAgfVxuXHRcblx0ICAgIGZ1bmN0aW9uIHNjaGVkdWxlSXRlbShzLCBzdGF0ZSkge1xuXHQgICAgICBzdGF0ZS5vbkNvbXBsZXRlZCgpO1xuXHQgICAgICByZXR1cm4gZGlzcG9zYWJsZUVtcHR5O1xuXHQgICAgfVxuXHRcblx0ICAgIEVtcHR5U2luay5wcm90b3R5cGUucnVuID0gZnVuY3Rpb24gKCkge1xuXHQgICAgICB2YXIgc3RhdGUgPSB0aGlzLm9ic2VydmVyO1xuXHQgICAgICByZXR1cm4gdGhpcy5zY2hlZHVsZXIgPT09IGltbWVkaWF0ZVNjaGVkdWxlciA/XG5cdCAgICAgICAgc2NoZWR1bGVJdGVtKG51bGwsIHN0YXRlKSA6XG5cdCAgICAgICAgdGhpcy5zY2hlZHVsZXIuc2NoZWR1bGUoc3RhdGUsIHNjaGVkdWxlSXRlbSk7XG5cdCAgICB9O1xuXHRcblx0ICAgIHJldHVybiBFbXB0eU9ic2VydmFibGU7XG5cdCAgfShPYnNlcnZhYmxlQmFzZSkpO1xuXHRcblx0ICB2YXIgRU1QVFlfT0JTRVJWQUJMRSA9IG5ldyBFbXB0eU9ic2VydmFibGUoaW1tZWRpYXRlU2NoZWR1bGVyKTtcblx0XG5cdCAgLyoqXG5cdCAgICogIFJldHVybnMgYW4gZW1wdHkgb2JzZXJ2YWJsZSBzZXF1ZW5jZSwgdXNpbmcgdGhlIHNwZWNpZmllZCBzY2hlZHVsZXIgdG8gc2VuZCBvdXQgdGhlIHNpbmdsZSBPbkNvbXBsZXRlZCBtZXNzYWdlLlxuXHQgICAqXG5cdCAgICogQGV4YW1wbGVcblx0ICAgKiAgdmFyIHJlcyA9IFJ4Lk9ic2VydmFibGUuZW1wdHkoKTtcblx0ICAgKiAgdmFyIHJlcyA9IFJ4Lk9ic2VydmFibGUuZW1wdHkoUnguU2NoZWR1bGVyLnRpbWVvdXQpO1xuXHQgICAqIEBwYXJhbSB7U2NoZWR1bGVyfSBbc2NoZWR1bGVyXSBTY2hlZHVsZXIgdG8gc2VuZCB0aGUgdGVybWluYXRpb24gY2FsbCBvbi5cblx0ICAgKiBAcmV0dXJucyB7T2JzZXJ2YWJsZX0gQW4gb2JzZXJ2YWJsZSBzZXF1ZW5jZSB3aXRoIG5vIGVsZW1lbnRzLlxuXHQgICAqL1xuXHQgIHZhciBvYnNlcnZhYmxlRW1wdHkgPSBPYnNlcnZhYmxlLmVtcHR5ID0gZnVuY3Rpb24gKHNjaGVkdWxlcikge1xuXHQgICAgaXNTY2hlZHVsZXIoc2NoZWR1bGVyKSB8fCAoc2NoZWR1bGVyID0gaW1tZWRpYXRlU2NoZWR1bGVyKTtcblx0ICAgIHJldHVybiBzY2hlZHVsZXIgPT09IGltbWVkaWF0ZVNjaGVkdWxlciA/IEVNUFRZX09CU0VSVkFCTEUgOiBuZXcgRW1wdHlPYnNlcnZhYmxlKHNjaGVkdWxlcik7XG5cdCAgfTtcblx0XG5cdCAgdmFyIEZyb21PYnNlcnZhYmxlID0gKGZ1bmN0aW9uKF9fc3VwZXJfXykge1xuXHQgICAgaW5oZXJpdHMoRnJvbU9ic2VydmFibGUsIF9fc3VwZXJfXyk7XG5cdCAgICBmdW5jdGlvbiBGcm9tT2JzZXJ2YWJsZShpdGVyYWJsZSwgbWFwcGVyLCBzY2hlZHVsZXIpIHtcblx0ICAgICAgdGhpcy5pdGVyYWJsZSA9IGl0ZXJhYmxlO1xuXHQgICAgICB0aGlzLm1hcHBlciA9IG1hcHBlcjtcblx0ICAgICAgdGhpcy5zY2hlZHVsZXIgPSBzY2hlZHVsZXI7XG5cdCAgICAgIF9fc3VwZXJfXy5jYWxsKHRoaXMpO1xuXHQgICAgfVxuXHRcblx0ICAgIEZyb21PYnNlcnZhYmxlLnByb3RvdHlwZS5zdWJzY3JpYmVDb3JlID0gZnVuY3Rpb24gKG8pIHtcblx0ICAgICAgdmFyIHNpbmsgPSBuZXcgRnJvbVNpbmsobywgdGhpcyk7XG5cdCAgICAgIHJldHVybiBzaW5rLnJ1bigpO1xuXHQgICAgfTtcblx0XG5cdCAgICByZXR1cm4gRnJvbU9ic2VydmFibGU7XG5cdCAgfShPYnNlcnZhYmxlQmFzZSkpO1xuXHRcblx0ICB2YXIgRnJvbVNpbmsgPSAoZnVuY3Rpb24gKCkge1xuXHQgICAgZnVuY3Rpb24gRnJvbVNpbmsobywgcGFyZW50KSB7XG5cdCAgICAgIHRoaXMubyA9IG87XG5cdCAgICAgIHRoaXMucGFyZW50ID0gcGFyZW50O1xuXHQgICAgfVxuXHRcblx0ICAgIEZyb21TaW5rLnByb3RvdHlwZS5ydW4gPSBmdW5jdGlvbiAoKSB7XG5cdCAgICAgIHZhciBsaXN0ID0gT2JqZWN0KHRoaXMucGFyZW50Lml0ZXJhYmxlKSxcblx0ICAgICAgICAgIGl0ID0gZ2V0SXRlcmFibGUobGlzdCksXG5cdCAgICAgICAgICBvID0gdGhpcy5vLFxuXHQgICAgICAgICAgbWFwcGVyID0gdGhpcy5wYXJlbnQubWFwcGVyO1xuXHRcblx0ICAgICAgZnVuY3Rpb24gbG9vcFJlY3Vyc2l2ZShpLCByZWN1cnNlKSB7XG5cdCAgICAgICAgdmFyIG5leHQgPSB0cnlDYXRjaChpdC5uZXh0KS5jYWxsKGl0KTtcblx0ICAgICAgICBpZiAobmV4dCA9PT0gZXJyb3JPYmopIHsgcmV0dXJuIG8ub25FcnJvcihuZXh0LmUpOyB9XG5cdCAgICAgICAgaWYgKG5leHQuZG9uZSkgeyByZXR1cm4gby5vbkNvbXBsZXRlZCgpOyB9XG5cdFxuXHQgICAgICAgIHZhciByZXN1bHQgPSBuZXh0LnZhbHVlO1xuXHRcblx0ICAgICAgICBpZiAoaXNGdW5jdGlvbihtYXBwZXIpKSB7XG5cdCAgICAgICAgICByZXN1bHQgPSB0cnlDYXRjaChtYXBwZXIpKHJlc3VsdCwgaSk7XG5cdCAgICAgICAgICBpZiAocmVzdWx0ID09PSBlcnJvck9iaikgeyByZXR1cm4gby5vbkVycm9yKHJlc3VsdC5lKTsgfVxuXHQgICAgICAgIH1cblx0XG5cdCAgICAgICAgby5vbk5leHQocmVzdWx0KTtcblx0ICAgICAgICByZWN1cnNlKGkgKyAxKTtcblx0ICAgICAgfVxuXHRcblx0ICAgICAgcmV0dXJuIHRoaXMucGFyZW50LnNjaGVkdWxlci5zY2hlZHVsZVJlY3Vyc2l2ZSgwLCBsb29wUmVjdXJzaXZlKTtcblx0ICAgIH07XG5cdFxuXHQgICAgcmV0dXJuIEZyb21TaW5rO1xuXHQgIH0oKSk7XG5cdFxuXHQgIHZhciBtYXhTYWZlSW50ZWdlciA9IE1hdGgucG93KDIsIDUzKSAtIDE7XG5cdFxuXHQgIGZ1bmN0aW9uIFN0cmluZ0l0ZXJhYmxlKHMpIHtcblx0ICAgIHRoaXMuX3MgPSBzO1xuXHQgIH1cblx0XG5cdCAgU3RyaW5nSXRlcmFibGUucHJvdG90eXBlWyRpdGVyYXRvciRdID0gZnVuY3Rpb24gKCkge1xuXHQgICAgcmV0dXJuIG5ldyBTdHJpbmdJdGVyYXRvcih0aGlzLl9zKTtcblx0ICB9O1xuXHRcblx0ICBmdW5jdGlvbiBTdHJpbmdJdGVyYXRvcihzKSB7XG5cdCAgICB0aGlzLl9zID0gcztcblx0ICAgIHRoaXMuX2wgPSBzLmxlbmd0aDtcblx0ICAgIHRoaXMuX2kgPSAwO1xuXHQgIH1cblx0XG5cdCAgU3RyaW5nSXRlcmF0b3IucHJvdG90eXBlWyRpdGVyYXRvciRdID0gZnVuY3Rpb24gKCkge1xuXHQgICAgcmV0dXJuIHRoaXM7XG5cdCAgfTtcblx0XG5cdCAgU3RyaW5nSXRlcmF0b3IucHJvdG90eXBlLm5leHQgPSBmdW5jdGlvbiAoKSB7XG5cdCAgICByZXR1cm4gdGhpcy5faSA8IHRoaXMuX2wgPyB7IGRvbmU6IGZhbHNlLCB2YWx1ZTogdGhpcy5fcy5jaGFyQXQodGhpcy5faSsrKSB9IDogZG9uZUVudW1lcmF0b3I7XG5cdCAgfTtcblx0XG5cdCAgZnVuY3Rpb24gQXJyYXlJdGVyYWJsZShhKSB7XG5cdCAgICB0aGlzLl9hID0gYTtcblx0ICB9XG5cdFxuXHQgIEFycmF5SXRlcmFibGUucHJvdG90eXBlWyRpdGVyYXRvciRdID0gZnVuY3Rpb24gKCkge1xuXHQgICAgcmV0dXJuIG5ldyBBcnJheUl0ZXJhdG9yKHRoaXMuX2EpO1xuXHQgIH07XG5cdFxuXHQgIGZ1bmN0aW9uIEFycmF5SXRlcmF0b3IoYSkge1xuXHQgICAgdGhpcy5fYSA9IGE7XG5cdCAgICB0aGlzLl9sID0gdG9MZW5ndGgoYSk7XG5cdCAgICB0aGlzLl9pID0gMDtcblx0ICB9XG5cdFxuXHQgIEFycmF5SXRlcmF0b3IucHJvdG90eXBlWyRpdGVyYXRvciRdID0gZnVuY3Rpb24gKCkge1xuXHQgICAgcmV0dXJuIHRoaXM7XG5cdCAgfTtcblx0XG5cdCAgQXJyYXlJdGVyYXRvci5wcm90b3R5cGUubmV4dCA9IGZ1bmN0aW9uICgpIHtcblx0ICAgIHJldHVybiB0aGlzLl9pIDwgdGhpcy5fbCA/IHsgZG9uZTogZmFsc2UsIHZhbHVlOiB0aGlzLl9hW3RoaXMuX2krK10gfSA6IGRvbmVFbnVtZXJhdG9yO1xuXHQgIH07XG5cdFxuXHQgIGZ1bmN0aW9uIG51bWJlcklzRmluaXRlKHZhbHVlKSB7XG5cdCAgICByZXR1cm4gdHlwZW9mIHZhbHVlID09PSAnbnVtYmVyJyAmJiByb290LmlzRmluaXRlKHZhbHVlKTtcblx0ICB9XG5cdFxuXHQgIGZ1bmN0aW9uIGlzTmFuKG4pIHtcblx0ICAgIHJldHVybiBuICE9PSBuO1xuXHQgIH1cblx0XG5cdCAgZnVuY3Rpb24gZ2V0SXRlcmFibGUobykge1xuXHQgICAgdmFyIGkgPSBvWyRpdGVyYXRvciRdLCBpdDtcblx0ICAgIGlmICghaSAmJiB0eXBlb2YgbyA9PT0gJ3N0cmluZycpIHtcblx0ICAgICAgaXQgPSBuZXcgU3RyaW5nSXRlcmFibGUobyk7XG5cdCAgICAgIHJldHVybiBpdFskaXRlcmF0b3IkXSgpO1xuXHQgICAgfVxuXHQgICAgaWYgKCFpICYmIG8ubGVuZ3RoICE9PSB1bmRlZmluZWQpIHtcblx0ICAgICAgaXQgPSBuZXcgQXJyYXlJdGVyYWJsZShvKTtcblx0ICAgICAgcmV0dXJuIGl0WyRpdGVyYXRvciRdKCk7XG5cdCAgICB9XG5cdCAgICBpZiAoIWkpIHsgdGhyb3cgbmV3IFR5cGVFcnJvcignT2JqZWN0IGlzIG5vdCBpdGVyYWJsZScpOyB9XG5cdCAgICByZXR1cm4gb1skaXRlcmF0b3IkXSgpO1xuXHQgIH1cblx0XG5cdCAgZnVuY3Rpb24gc2lnbih2YWx1ZSkge1xuXHQgICAgdmFyIG51bWJlciA9ICt2YWx1ZTtcblx0ICAgIGlmIChudW1iZXIgPT09IDApIHsgcmV0dXJuIG51bWJlcjsgfVxuXHQgICAgaWYgKGlzTmFOKG51bWJlcikpIHsgcmV0dXJuIG51bWJlcjsgfVxuXHQgICAgcmV0dXJuIG51bWJlciA8IDAgPyAtMSA6IDE7XG5cdCAgfVxuXHRcblx0ICBmdW5jdGlvbiB0b0xlbmd0aChvKSB7XG5cdCAgICB2YXIgbGVuID0gK28ubGVuZ3RoO1xuXHQgICAgaWYgKGlzTmFOKGxlbikpIHsgcmV0dXJuIDA7IH1cblx0ICAgIGlmIChsZW4gPT09IDAgfHwgIW51bWJlcklzRmluaXRlKGxlbikpIHsgcmV0dXJuIGxlbjsgfVxuXHQgICAgbGVuID0gc2lnbihsZW4pICogTWF0aC5mbG9vcihNYXRoLmFicyhsZW4pKTtcblx0ICAgIGlmIChsZW4gPD0gMCkgeyByZXR1cm4gMDsgfVxuXHQgICAgaWYgKGxlbiA+IG1heFNhZmVJbnRlZ2VyKSB7IHJldHVybiBtYXhTYWZlSW50ZWdlcjsgfVxuXHQgICAgcmV0dXJuIGxlbjtcblx0ICB9XG5cdFxuXHQgIC8qKlxuXHQgICogVGhpcyBtZXRob2QgY3JlYXRlcyBhIG5ldyBPYnNlcnZhYmxlIHNlcXVlbmNlIGZyb20gYW4gYXJyYXktbGlrZSBvciBpdGVyYWJsZSBvYmplY3QuXG5cdCAgKiBAcGFyYW0ge0FueX0gYXJyYXlMaWtlIEFuIGFycmF5LWxpa2Ugb3IgaXRlcmFibGUgb2JqZWN0IHRvIGNvbnZlcnQgdG8gYW4gT2JzZXJ2YWJsZSBzZXF1ZW5jZS5cblx0ICAqIEBwYXJhbSB7RnVuY3Rpb259IFttYXBGbl0gTWFwIGZ1bmN0aW9uIHRvIGNhbGwgb24gZXZlcnkgZWxlbWVudCBvZiB0aGUgYXJyYXkuXG5cdCAgKiBAcGFyYW0ge0FueX0gW3RoaXNBcmddIFRoZSBjb250ZXh0IHRvIHVzZSBjYWxsaW5nIHRoZSBtYXBGbiBpZiBwcm92aWRlZC5cblx0ICAqIEBwYXJhbSB7U2NoZWR1bGVyfSBbc2NoZWR1bGVyXSBPcHRpb25hbCBzY2hlZHVsZXIgdG8gdXNlIGZvciBzY2hlZHVsaW5nLiAgSWYgbm90IHByb3ZpZGVkLCBkZWZhdWx0cyB0byBTY2hlZHVsZXIuY3VycmVudFRocmVhZC5cblx0ICAqL1xuXHQgIHZhciBvYnNlcnZhYmxlRnJvbSA9IE9ic2VydmFibGUuZnJvbSA9IGZ1bmN0aW9uIChpdGVyYWJsZSwgbWFwRm4sIHRoaXNBcmcsIHNjaGVkdWxlcikge1xuXHQgICAgaWYgKGl0ZXJhYmxlID09IG51bGwpIHtcblx0ICAgICAgdGhyb3cgbmV3IEVycm9yKCdpdGVyYWJsZSBjYW5ub3QgYmUgbnVsbC4nKVxuXHQgICAgfVxuXHQgICAgaWYgKG1hcEZuICYmICFpc0Z1bmN0aW9uKG1hcEZuKSkge1xuXHQgICAgICB0aHJvdyBuZXcgRXJyb3IoJ21hcEZuIHdoZW4gcHJvdmlkZWQgbXVzdCBiZSBhIGZ1bmN0aW9uJyk7XG5cdCAgICB9XG5cdCAgICBpZiAobWFwRm4pIHtcblx0ICAgICAgdmFyIG1hcHBlciA9IGJpbmRDYWxsYmFjayhtYXBGbiwgdGhpc0FyZywgMik7XG5cdCAgICB9XG5cdCAgICBpc1NjaGVkdWxlcihzY2hlZHVsZXIpIHx8IChzY2hlZHVsZXIgPSBjdXJyZW50VGhyZWFkU2NoZWR1bGVyKTtcblx0ICAgIHJldHVybiBuZXcgRnJvbU9ic2VydmFibGUoaXRlcmFibGUsIG1hcHBlciwgc2NoZWR1bGVyKTtcblx0ICB9XG5cdFxuXHQgIHZhciBGcm9tQXJyYXlPYnNlcnZhYmxlID0gKGZ1bmN0aW9uKF9fc3VwZXJfXykge1xuXHQgICAgaW5oZXJpdHMoRnJvbUFycmF5T2JzZXJ2YWJsZSwgX19zdXBlcl9fKTtcblx0ICAgIGZ1bmN0aW9uIEZyb21BcnJheU9ic2VydmFibGUoYXJncywgc2NoZWR1bGVyKSB7XG5cdCAgICAgIHRoaXMuYXJncyA9IGFyZ3M7XG5cdCAgICAgIHRoaXMuc2NoZWR1bGVyID0gc2NoZWR1bGVyO1xuXHQgICAgICBfX3N1cGVyX18uY2FsbCh0aGlzKTtcblx0ICAgIH1cblx0XG5cdCAgICBGcm9tQXJyYXlPYnNlcnZhYmxlLnByb3RvdHlwZS5zdWJzY3JpYmVDb3JlID0gZnVuY3Rpb24gKG9ic2VydmVyKSB7XG5cdCAgICAgIHZhciBzaW5rID0gbmV3IEZyb21BcnJheVNpbmsob2JzZXJ2ZXIsIHRoaXMpO1xuXHQgICAgICByZXR1cm4gc2luay5ydW4oKTtcblx0ICAgIH07XG5cdFxuXHQgICAgcmV0dXJuIEZyb21BcnJheU9ic2VydmFibGU7XG5cdCAgfShPYnNlcnZhYmxlQmFzZSkpO1xuXHRcblx0ICBmdW5jdGlvbiBGcm9tQXJyYXlTaW5rKG9ic2VydmVyLCBwYXJlbnQpIHtcblx0ICAgIHRoaXMub2JzZXJ2ZXIgPSBvYnNlcnZlcjtcblx0ICAgIHRoaXMucGFyZW50ID0gcGFyZW50O1xuXHQgIH1cblx0XG5cdCAgRnJvbUFycmF5U2luay5wcm90b3R5cGUucnVuID0gZnVuY3Rpb24gKCkge1xuXHQgICAgdmFyIG9ic2VydmVyID0gdGhpcy5vYnNlcnZlciwgYXJncyA9IHRoaXMucGFyZW50LmFyZ3MsIGxlbiA9IGFyZ3MubGVuZ3RoO1xuXHQgICAgZnVuY3Rpb24gbG9vcFJlY3Vyc2l2ZShpLCByZWN1cnNlKSB7XG5cdCAgICAgIGlmIChpIDwgbGVuKSB7XG5cdCAgICAgICAgb2JzZXJ2ZXIub25OZXh0KGFyZ3NbaV0pO1xuXHQgICAgICAgIHJlY3Vyc2UoaSArIDEpO1xuXHQgICAgICB9IGVsc2Uge1xuXHQgICAgICAgIG9ic2VydmVyLm9uQ29tcGxldGVkKCk7XG5cdCAgICAgIH1cblx0ICAgIH1cblx0XG5cdCAgICByZXR1cm4gdGhpcy5wYXJlbnQuc2NoZWR1bGVyLnNjaGVkdWxlUmVjdXJzaXZlKDAsIGxvb3BSZWN1cnNpdmUpO1xuXHQgIH07XG5cdFxuXHQgIC8qKlxuXHQgICogIENvbnZlcnRzIGFuIGFycmF5IHRvIGFuIG9ic2VydmFibGUgc2VxdWVuY2UsIHVzaW5nIGFuIG9wdGlvbmFsIHNjaGVkdWxlciB0byBlbnVtZXJhdGUgdGhlIGFycmF5LlxuXHQgICogQGRlcHJlY2F0ZWQgdXNlIE9ic2VydmFibGUuZnJvbSBvciBPYnNlcnZhYmxlLm9mXG5cdCAgKiBAcGFyYW0ge1NjaGVkdWxlcn0gW3NjaGVkdWxlcl0gU2NoZWR1bGVyIHRvIHJ1biB0aGUgZW51bWVyYXRpb24gb2YgdGhlIGlucHV0IHNlcXVlbmNlIG9uLlxuXHQgICogQHJldHVybnMge09ic2VydmFibGV9IFRoZSBvYnNlcnZhYmxlIHNlcXVlbmNlIHdob3NlIGVsZW1lbnRzIGFyZSBwdWxsZWQgZnJvbSB0aGUgZ2l2ZW4gZW51bWVyYWJsZSBzZXF1ZW5jZS5cblx0ICAqL1xuXHQgIHZhciBvYnNlcnZhYmxlRnJvbUFycmF5ID0gT2JzZXJ2YWJsZS5mcm9tQXJyYXkgPSBmdW5jdGlvbiAoYXJyYXksIHNjaGVkdWxlcikge1xuXHQgICAgaXNTY2hlZHVsZXIoc2NoZWR1bGVyKSB8fCAoc2NoZWR1bGVyID0gY3VycmVudFRocmVhZFNjaGVkdWxlcik7XG5cdCAgICByZXR1cm4gbmV3IEZyb21BcnJheU9ic2VydmFibGUoYXJyYXksIHNjaGVkdWxlcilcblx0ICB9O1xuXHRcblx0ICB2YXIgR2VuZXJhdGVPYnNlcnZhYmxlID0gKGZ1bmN0aW9uIChfX3N1cGVyX18pIHtcblx0ICAgIGluaGVyaXRzKEdlbmVyYXRlT2JzZXJ2YWJsZSwgX19zdXBlcl9fKTtcblx0ICAgIGZ1bmN0aW9uIEdlbmVyYXRlT2JzZXJ2YWJsZShzdGF0ZSwgY25kRm4sIGl0ckZuLCByZXNGbiwgcykge1xuXHQgICAgICB0aGlzLl9zdGF0ZSA9IHN0YXRlO1xuXHQgICAgICB0aGlzLl9jbmRGbiA9IGNuZEZuO1xuXHQgICAgICB0aGlzLl9pdHJGbiA9IGl0ckZuO1xuXHQgICAgICB0aGlzLl9yZXNGbiA9IHJlc0ZuO1xuXHQgICAgICB0aGlzLl9zID0gcztcblx0ICAgICAgdGhpcy5fZmlyc3QgPSB0cnVlO1xuXHQgICAgICBfX3N1cGVyX18uY2FsbCh0aGlzKTtcblx0ICAgIH1cblx0XG5cdCAgICBmdW5jdGlvbiBzY2hlZHVsZVJlY3Vyc2l2ZShzZWxmLCByZWN1cnNlKSB7XG5cdCAgICAgIGlmIChzZWxmLl9maXJzdCkge1xuXHQgICAgICAgIHNlbGYuX2ZpcnN0ID0gZmFsc2U7XG5cdCAgICAgIH0gZWxzZSB7XG5cdCAgICAgICAgc2VsZi5fc3RhdGUgPSB0cnlDYXRjaChzZWxmLl9pdHJGbikoc2VsZi5fc3RhdGUpO1xuXHQgICAgICAgIGlmIChzZWxmLl9zdGF0ZSA9PT0gZXJyb3JPYmopIHsgcmV0dXJuIHNlbGYuX28ub25FcnJvcihzZWxmLl9zdGF0ZS5lKTsgfVxuXHQgICAgICB9XG5cdCAgICAgIHZhciBoYXNSZXN1bHQgPSB0cnlDYXRjaChzZWxmLl9jbmRGbikoc2VsZi5fc3RhdGUpO1xuXHQgICAgICBpZiAoaGFzUmVzdWx0ID09PSBlcnJvck9iaikgeyByZXR1cm4gc2VsZi5fby5vbkVycm9yKGhhc1Jlc3VsdC5lKTsgfVxuXHQgICAgICBpZiAoaGFzUmVzdWx0KSB7XG5cdCAgICAgICAgdmFyIHJlc3VsdCA9IHRyeUNhdGNoKHNlbGYuX3Jlc0ZuKShzZWxmLl9zdGF0ZSk7XG5cdCAgICAgICAgaWYgKHJlc3VsdCA9PT0gZXJyb3JPYmopIHsgcmV0dXJuIHNlbGYuX28ub25FcnJvcihyZXN1bHQuZSk7IH1cblx0ICAgICAgICBzZWxmLl9vLm9uTmV4dChyZXN1bHQpO1xuXHQgICAgICAgIHJlY3Vyc2Uoc2VsZik7XG5cdCAgICAgIH0gZWxzZSB7XG5cdCAgICAgICAgc2VsZi5fby5vbkNvbXBsZXRlZCgpO1xuXHQgICAgICB9XG5cdCAgICB9XG5cdFxuXHQgICAgR2VuZXJhdGVPYnNlcnZhYmxlLnByb3RvdHlwZS5zdWJzY3JpYmVDb3JlID0gZnVuY3Rpb24gKG8pIHtcblx0ICAgICAgdGhpcy5fbyA9IG87XG5cdCAgICAgIHJldHVybiB0aGlzLl9zLnNjaGVkdWxlUmVjdXJzaXZlKHRoaXMsIHNjaGVkdWxlUmVjdXJzaXZlKTtcblx0ICAgIH07XG5cdFxuXHQgICAgcmV0dXJuIEdlbmVyYXRlT2JzZXJ2YWJsZTtcblx0ICB9KE9ic2VydmFibGVCYXNlKSk7XG5cdFxuXHQgIC8qKlxuXHQgICAqICBHZW5lcmF0ZXMgYW4gb2JzZXJ2YWJsZSBzZXF1ZW5jZSBieSBydW5uaW5nIGEgc3RhdGUtZHJpdmVuIGxvb3AgcHJvZHVjaW5nIHRoZSBzZXF1ZW5jZSdzIGVsZW1lbnRzLCB1c2luZyB0aGUgc3BlY2lmaWVkIHNjaGVkdWxlciB0byBzZW5kIG91dCBvYnNlcnZlciBtZXNzYWdlcy5cblx0ICAgKlxuXHQgICAqIEBleGFtcGxlXG5cdCAgICogIHZhciByZXMgPSBSeC5PYnNlcnZhYmxlLmdlbmVyYXRlKDAsIGZ1bmN0aW9uICh4KSB7IHJldHVybiB4IDwgMTA7IH0sIGZ1bmN0aW9uICh4KSB7IHJldHVybiB4ICsgMTsgfSwgZnVuY3Rpb24gKHgpIHsgcmV0dXJuIHg7IH0pO1xuXHQgICAqICB2YXIgcmVzID0gUnguT2JzZXJ2YWJsZS5nZW5lcmF0ZSgwLCBmdW5jdGlvbiAoeCkgeyByZXR1cm4geCA8IDEwOyB9LCBmdW5jdGlvbiAoeCkgeyByZXR1cm4geCArIDE7IH0sIGZ1bmN0aW9uICh4KSB7IHJldHVybiB4OyB9LCBSeC5TY2hlZHVsZXIudGltZW91dCk7XG5cdCAgICogQHBhcmFtIHtNaXhlZH0gaW5pdGlhbFN0YXRlIEluaXRpYWwgc3RhdGUuXG5cdCAgICogQHBhcmFtIHtGdW5jdGlvbn0gY29uZGl0aW9uIENvbmRpdGlvbiB0byB0ZXJtaW5hdGUgZ2VuZXJhdGlvbiAodXBvbiByZXR1cm5pbmcgZmFsc2UpLlxuXHQgICAqIEBwYXJhbSB7RnVuY3Rpb259IGl0ZXJhdGUgSXRlcmF0aW9uIHN0ZXAgZnVuY3Rpb24uXG5cdCAgICogQHBhcmFtIHtGdW5jdGlvbn0gcmVzdWx0U2VsZWN0b3IgU2VsZWN0b3IgZnVuY3Rpb24gZm9yIHJlc3VsdHMgcHJvZHVjZWQgaW4gdGhlIHNlcXVlbmNlLlxuXHQgICAqIEBwYXJhbSB7U2NoZWR1bGVyfSBbc2NoZWR1bGVyXSBTY2hlZHVsZXIgb24gd2hpY2ggdG8gcnVuIHRoZSBnZW5lcmF0b3IgbG9vcC4gSWYgbm90IHByb3ZpZGVkLCBkZWZhdWx0cyB0byBTY2hlZHVsZXIuY3VycmVudFRocmVhZC5cblx0ICAgKiBAcmV0dXJucyB7T2JzZXJ2YWJsZX0gVGhlIGdlbmVyYXRlZCBzZXF1ZW5jZS5cblx0ICAgKi9cblx0ICBPYnNlcnZhYmxlLmdlbmVyYXRlID0gZnVuY3Rpb24gKGluaXRpYWxTdGF0ZSwgY29uZGl0aW9uLCBpdGVyYXRlLCByZXN1bHRTZWxlY3Rvciwgc2NoZWR1bGVyKSB7XG5cdCAgICBpc1NjaGVkdWxlcihzY2hlZHVsZXIpIHx8IChzY2hlZHVsZXIgPSBjdXJyZW50VGhyZWFkU2NoZWR1bGVyKTtcblx0ICAgIHJldHVybiBuZXcgR2VuZXJhdGVPYnNlcnZhYmxlKGluaXRpYWxTdGF0ZSwgY29uZGl0aW9uLCBpdGVyYXRlLCByZXN1bHRTZWxlY3Rvciwgc2NoZWR1bGVyKTtcblx0ICB9O1xuXHRcblx0ICBmdW5jdGlvbiBvYnNlcnZhYmxlT2YgKHNjaGVkdWxlciwgYXJyYXkpIHtcblx0ICAgIGlzU2NoZWR1bGVyKHNjaGVkdWxlcikgfHwgKHNjaGVkdWxlciA9IGN1cnJlbnRUaHJlYWRTY2hlZHVsZXIpO1xuXHQgICAgcmV0dXJuIG5ldyBGcm9tQXJyYXlPYnNlcnZhYmxlKGFycmF5LCBzY2hlZHVsZXIpO1xuXHQgIH1cblx0XG5cdCAgLyoqXG5cdCAgKiAgVGhpcyBtZXRob2QgY3JlYXRlcyBhIG5ldyBPYnNlcnZhYmxlIGluc3RhbmNlIHdpdGggYSB2YXJpYWJsZSBudW1iZXIgb2YgYXJndW1lbnRzLCByZWdhcmRsZXNzIG9mIG51bWJlciBvciB0eXBlIG9mIHRoZSBhcmd1bWVudHMuXG5cdCAgKiBAcmV0dXJucyB7T2JzZXJ2YWJsZX0gVGhlIG9ic2VydmFibGUgc2VxdWVuY2Ugd2hvc2UgZWxlbWVudHMgYXJlIHB1bGxlZCBmcm9tIHRoZSBnaXZlbiBhcmd1bWVudHMuXG5cdCAgKi9cblx0ICBPYnNlcnZhYmxlLm9mID0gZnVuY3Rpb24gKCkge1xuXHQgICAgdmFyIGxlbiA9IGFyZ3VtZW50cy5sZW5ndGgsIGFyZ3MgPSBuZXcgQXJyYXkobGVuKTtcblx0ICAgIGZvcih2YXIgaSA9IDA7IGkgPCBsZW47IGkrKykgeyBhcmdzW2ldID0gYXJndW1lbnRzW2ldOyB9XG5cdCAgICByZXR1cm4gbmV3IEZyb21BcnJheU9ic2VydmFibGUoYXJncywgY3VycmVudFRocmVhZFNjaGVkdWxlcik7XG5cdCAgfTtcblx0XG5cdCAgLyoqXG5cdCAgKiAgVGhpcyBtZXRob2QgY3JlYXRlcyBhIG5ldyBPYnNlcnZhYmxlIGluc3RhbmNlIHdpdGggYSB2YXJpYWJsZSBudW1iZXIgb2YgYXJndW1lbnRzLCByZWdhcmRsZXNzIG9mIG51bWJlciBvciB0eXBlIG9mIHRoZSBhcmd1bWVudHMuXG5cdCAgKiBAcGFyYW0ge1NjaGVkdWxlcn0gc2NoZWR1bGVyIEEgc2NoZWR1bGVyIHRvIHVzZSBmb3Igc2NoZWR1bGluZyB0aGUgYXJndW1lbnRzLlxuXHQgICogQHJldHVybnMge09ic2VydmFibGV9IFRoZSBvYnNlcnZhYmxlIHNlcXVlbmNlIHdob3NlIGVsZW1lbnRzIGFyZSBwdWxsZWQgZnJvbSB0aGUgZ2l2ZW4gYXJndW1lbnRzLlxuXHQgICovXG5cdCAgT2JzZXJ2YWJsZS5vZldpdGhTY2hlZHVsZXIgPSBmdW5jdGlvbiAoc2NoZWR1bGVyKSB7XG5cdCAgICB2YXIgbGVuID0gYXJndW1lbnRzLmxlbmd0aCwgYXJncyA9IG5ldyBBcnJheShsZW4gLSAxKTtcblx0ICAgIGZvcih2YXIgaSA9IDE7IGkgPCBsZW47IGkrKykgeyBhcmdzW2kgLSAxXSA9IGFyZ3VtZW50c1tpXTsgfVxuXHQgICAgcmV0dXJuIG5ldyBGcm9tQXJyYXlPYnNlcnZhYmxlKGFyZ3MsIHNjaGVkdWxlcik7XG5cdCAgfTtcblx0XG5cdCAgLyoqXG5cdCAgICogQ3JlYXRlcyBhbiBPYnNlcnZhYmxlIHNlcXVlbmNlIGZyb20gY2hhbmdlcyB0byBhbiBhcnJheSB1c2luZyBBcnJheS5vYnNlcnZlLlxuXHQgICAqIEBwYXJhbSB7QXJyYXl9IGFycmF5IEFuIGFycmF5IHRvIG9ic2VydmUgY2hhbmdlcy5cblx0ICAgKiBAcmV0dXJucyB7T2JzZXJ2YWJsZX0gQW4gb2JzZXJ2YWJsZSBzZXF1ZW5jZSBjb250YWluaW5nIGNoYW5nZXMgdG8gYW4gYXJyYXkgZnJvbSBBcnJheS5vYnNlcnZlLlxuXHQgICAqL1xuXHQgIE9ic2VydmFibGUub2ZBcnJheUNoYW5nZXMgPSBmdW5jdGlvbihhcnJheSkge1xuXHQgICAgaWYgKCFBcnJheS5pc0FycmF5KGFycmF5KSkgeyB0aHJvdyBuZXcgVHlwZUVycm9yKCdBcnJheS5vYnNlcnZlIG9ubHkgYWNjZXB0cyBhcnJheXMuJyk7IH1cblx0ICAgIGlmICh0eXBlb2YgQXJyYXkub2JzZXJ2ZSAhPT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YgQXJyYXkudW5vYnNlcnZlICE9PSAnZnVuY3Rpb24nKSB7IHRocm93IG5ldyBUeXBlRXJyb3IoJ0FycmF5Lm9ic2VydmUgaXMgbm90IHN1cHBvcnRlZCBvbiB5b3VyIHBsYXRmb3JtJykgfVxuXHQgICAgcmV0dXJuIG5ldyBBbm9ueW1vdXNPYnNlcnZhYmxlKGZ1bmN0aW9uKG9ic2VydmVyKSB7XG5cdCAgICAgIGZ1bmN0aW9uIG9ic2VydmVyRm4oY2hhbmdlcykge1xuXHQgICAgICAgIGZvcih2YXIgaSA9IDAsIGxlbiA9IGNoYW5nZXMubGVuZ3RoOyBpIDwgbGVuOyBpKyspIHtcblx0ICAgICAgICAgIG9ic2VydmVyLm9uTmV4dChjaGFuZ2VzW2ldKTtcblx0ICAgICAgICB9XG5cdCAgICAgIH1cblx0ICAgICAgXG5cdCAgICAgIEFycmF5Lm9ic2VydmUoYXJyYXksIG9ic2VydmVyRm4pO1xuXHRcblx0ICAgICAgcmV0dXJuIGZ1bmN0aW9uICgpIHtcblx0ICAgICAgICBBcnJheS51bm9ic2VydmUoYXJyYXksIG9ic2VydmVyRm4pO1xuXHQgICAgICB9O1xuXHQgICAgfSk7XG5cdCAgfTtcblx0XG5cdCAgLyoqXG5cdCAgICogQ3JlYXRlcyBhbiBPYnNlcnZhYmxlIHNlcXVlbmNlIGZyb20gY2hhbmdlcyB0byBhbiBvYmplY3QgdXNpbmcgT2JqZWN0Lm9ic2VydmUuXG5cdCAgICogQHBhcmFtIHtPYmplY3R9IG9iaiBBbiBvYmplY3QgdG8gb2JzZXJ2ZSBjaGFuZ2VzLlxuXHQgICAqIEByZXR1cm5zIHtPYnNlcnZhYmxlfSBBbiBvYnNlcnZhYmxlIHNlcXVlbmNlIGNvbnRhaW5pbmcgY2hhbmdlcyB0byBhbiBvYmplY3QgZnJvbSBPYmplY3Qub2JzZXJ2ZS5cblx0ICAgKi9cblx0ICBPYnNlcnZhYmxlLm9mT2JqZWN0Q2hhbmdlcyA9IGZ1bmN0aW9uKG9iaikge1xuXHQgICAgaWYgKG9iaiA9PSBudWxsKSB7IHRocm93IG5ldyBUeXBlRXJyb3IoJ29iamVjdCBtdXN0IG5vdCBiZSBudWxsIG9yIHVuZGVmaW5lZC4nKTsgfVxuXHQgICAgaWYgKHR5cGVvZiBPYmplY3Qub2JzZXJ2ZSAhPT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YgT2JqZWN0LnVub2JzZXJ2ZSAhPT0gJ2Z1bmN0aW9uJykgeyB0aHJvdyBuZXcgVHlwZUVycm9yKCdPYmplY3Qub2JzZXJ2ZSBpcyBub3Qgc3VwcG9ydGVkIG9uIHlvdXIgcGxhdGZvcm0nKSB9XG5cdCAgICByZXR1cm4gbmV3IEFub255bW91c09ic2VydmFibGUoZnVuY3Rpb24ob2JzZXJ2ZXIpIHtcblx0ICAgICAgZnVuY3Rpb24gb2JzZXJ2ZXJGbihjaGFuZ2VzKSB7XG5cdCAgICAgICAgZm9yKHZhciBpID0gMCwgbGVuID0gY2hhbmdlcy5sZW5ndGg7IGkgPCBsZW47IGkrKykge1xuXHQgICAgICAgICAgb2JzZXJ2ZXIub25OZXh0KGNoYW5nZXNbaV0pO1xuXHQgICAgICAgIH1cblx0ICAgICAgfVxuXHRcblx0ICAgICAgT2JqZWN0Lm9ic2VydmUob2JqLCBvYnNlcnZlckZuKTtcblx0XG5cdCAgICAgIHJldHVybiBmdW5jdGlvbiAoKSB7XG5cdCAgICAgICAgT2JqZWN0LnVub2JzZXJ2ZShvYmosIG9ic2VydmVyRm4pO1xuXHQgICAgICB9O1xuXHQgICAgfSk7XG5cdCAgfTtcblx0XG5cdCAgdmFyIE5ldmVyT2JzZXJ2YWJsZSA9IChmdW5jdGlvbihfX3N1cGVyX18pIHtcblx0ICAgIGluaGVyaXRzKE5ldmVyT2JzZXJ2YWJsZSwgX19zdXBlcl9fKTtcblx0ICAgIGZ1bmN0aW9uIE5ldmVyT2JzZXJ2YWJsZSgpIHtcblx0ICAgICAgX19zdXBlcl9fLmNhbGwodGhpcyk7XG5cdCAgICB9XG5cdFxuXHQgICAgTmV2ZXJPYnNlcnZhYmxlLnByb3RvdHlwZS5zdWJzY3JpYmVDb3JlID0gZnVuY3Rpb24gKG9ic2VydmVyKSB7XG5cdCAgICAgIHJldHVybiBkaXNwb3NhYmxlRW1wdHk7XG5cdCAgICB9O1xuXHRcblx0ICAgIHJldHVybiBOZXZlck9ic2VydmFibGU7XG5cdCAgfShPYnNlcnZhYmxlQmFzZSkpO1xuXHRcblx0ICB2YXIgTkVWRVJfT0JTRVJWQUJMRSA9IG5ldyBOZXZlck9ic2VydmFibGUoKTtcblx0XG5cdCAgLyoqXG5cdCAgICogUmV0dXJucyBhIG5vbi10ZXJtaW5hdGluZyBvYnNlcnZhYmxlIHNlcXVlbmNlLCB3aGljaCBjYW4gYmUgdXNlZCB0byBkZW5vdGUgYW4gaW5maW5pdGUgZHVyYXRpb24gKGUuZy4gd2hlbiB1c2luZyByZWFjdGl2ZSBqb2lucykuXG5cdCAgICogQHJldHVybnMge09ic2VydmFibGV9IEFuIG9ic2VydmFibGUgc2VxdWVuY2Ugd2hvc2Ugb2JzZXJ2ZXJzIHdpbGwgbmV2ZXIgZ2V0IGNhbGxlZC5cblx0ICAgKi9cblx0ICB2YXIgb2JzZXJ2YWJsZU5ldmVyID0gT2JzZXJ2YWJsZS5uZXZlciA9IGZ1bmN0aW9uICgpIHtcblx0ICAgIHJldHVybiBORVZFUl9PQlNFUlZBQkxFO1xuXHQgIH07XG5cdFxuXHQgIHZhciBQYWlyc09ic2VydmFibGUgPSAoZnVuY3Rpb24oX19zdXBlcl9fKSB7XG5cdCAgICBpbmhlcml0cyhQYWlyc09ic2VydmFibGUsIF9fc3VwZXJfXyk7XG5cdCAgICBmdW5jdGlvbiBQYWlyc09ic2VydmFibGUob2JqLCBzY2hlZHVsZXIpIHtcblx0ICAgICAgdGhpcy5vYmogPSBvYmo7XG5cdCAgICAgIHRoaXMua2V5cyA9IE9iamVjdC5rZXlzKG9iaik7XG5cdCAgICAgIHRoaXMuc2NoZWR1bGVyID0gc2NoZWR1bGVyO1xuXHQgICAgICBfX3N1cGVyX18uY2FsbCh0aGlzKTtcblx0ICAgIH1cblx0XG5cdCAgICBQYWlyc09ic2VydmFibGUucHJvdG90eXBlLnN1YnNjcmliZUNvcmUgPSBmdW5jdGlvbiAob2JzZXJ2ZXIpIHtcblx0ICAgICAgdmFyIHNpbmsgPSBuZXcgUGFpcnNTaW5rKG9ic2VydmVyLCB0aGlzKTtcblx0ICAgICAgcmV0dXJuIHNpbmsucnVuKCk7XG5cdCAgICB9O1xuXHRcblx0ICAgIHJldHVybiBQYWlyc09ic2VydmFibGU7XG5cdCAgfShPYnNlcnZhYmxlQmFzZSkpO1xuXHRcblx0ICBmdW5jdGlvbiBQYWlyc1Npbmsob2JzZXJ2ZXIsIHBhcmVudCkge1xuXHQgICAgdGhpcy5vYnNlcnZlciA9IG9ic2VydmVyO1xuXHQgICAgdGhpcy5wYXJlbnQgPSBwYXJlbnQ7XG5cdCAgfVxuXHRcblx0ICBQYWlyc1NpbmsucHJvdG90eXBlLnJ1biA9IGZ1bmN0aW9uICgpIHtcblx0ICAgIHZhciBvYnNlcnZlciA9IHRoaXMub2JzZXJ2ZXIsIG9iaiA9IHRoaXMucGFyZW50Lm9iaiwga2V5cyA9IHRoaXMucGFyZW50LmtleXMsIGxlbiA9IGtleXMubGVuZ3RoO1xuXHQgICAgZnVuY3Rpb24gbG9vcFJlY3Vyc2l2ZShpLCByZWN1cnNlKSB7XG5cdCAgICAgIGlmIChpIDwgbGVuKSB7XG5cdCAgICAgICAgdmFyIGtleSA9IGtleXNbaV07XG5cdCAgICAgICAgb2JzZXJ2ZXIub25OZXh0KFtrZXksIG9ialtrZXldXSk7XG5cdCAgICAgICAgcmVjdXJzZShpICsgMSk7XG5cdCAgICAgIH0gZWxzZSB7XG5cdCAgICAgICAgb2JzZXJ2ZXIub25Db21wbGV0ZWQoKTtcblx0ICAgICAgfVxuXHQgICAgfVxuXHRcblx0ICAgIHJldHVybiB0aGlzLnBhcmVudC5zY2hlZHVsZXIuc2NoZWR1bGVSZWN1cnNpdmUoMCwgbG9vcFJlY3Vyc2l2ZSk7XG5cdCAgfTtcblx0XG5cdCAgLyoqXG5cdCAgICogQ29udmVydCBhbiBvYmplY3QgaW50byBhbiBvYnNlcnZhYmxlIHNlcXVlbmNlIG9mIFtrZXksIHZhbHVlXSBwYWlycy5cblx0ICAgKiBAcGFyYW0ge09iamVjdH0gb2JqIFRoZSBvYmplY3QgdG8gaW5zcGVjdC5cblx0ICAgKiBAcGFyYW0ge1NjaGVkdWxlcn0gW3NjaGVkdWxlcl0gU2NoZWR1bGVyIHRvIHJ1biB0aGUgZW51bWVyYXRpb24gb2YgdGhlIGlucHV0IHNlcXVlbmNlIG9uLlxuXHQgICAqIEByZXR1cm5zIHtPYnNlcnZhYmxlfSBBbiBvYnNlcnZhYmxlIHNlcXVlbmNlIG9mIFtrZXksIHZhbHVlXSBwYWlycyBmcm9tIHRoZSBvYmplY3QuXG5cdCAgICovXG5cdCAgT2JzZXJ2YWJsZS5wYWlycyA9IGZ1bmN0aW9uIChvYmosIHNjaGVkdWxlcikge1xuXHQgICAgc2NoZWR1bGVyIHx8IChzY2hlZHVsZXIgPSBjdXJyZW50VGhyZWFkU2NoZWR1bGVyKTtcblx0ICAgIHJldHVybiBuZXcgUGFpcnNPYnNlcnZhYmxlKG9iaiwgc2NoZWR1bGVyKTtcblx0ICB9O1xuXHRcblx0ICAgIHZhciBSYW5nZU9ic2VydmFibGUgPSAoZnVuY3Rpb24oX19zdXBlcl9fKSB7XG5cdCAgICBpbmhlcml0cyhSYW5nZU9ic2VydmFibGUsIF9fc3VwZXJfXyk7XG5cdCAgICBmdW5jdGlvbiBSYW5nZU9ic2VydmFibGUoc3RhcnQsIGNvdW50LCBzY2hlZHVsZXIpIHtcblx0ICAgICAgdGhpcy5zdGFydCA9IHN0YXJ0O1xuXHQgICAgICB0aGlzLnJhbmdlQ291bnQgPSBjb3VudDtcblx0ICAgICAgdGhpcy5zY2hlZHVsZXIgPSBzY2hlZHVsZXI7XG5cdCAgICAgIF9fc3VwZXJfXy5jYWxsKHRoaXMpO1xuXHQgICAgfVxuXHRcblx0ICAgIFJhbmdlT2JzZXJ2YWJsZS5wcm90b3R5cGUuc3Vic2NyaWJlQ29yZSA9IGZ1bmN0aW9uIChvYnNlcnZlcikge1xuXHQgICAgICB2YXIgc2luayA9IG5ldyBSYW5nZVNpbmsob2JzZXJ2ZXIsIHRoaXMpO1xuXHQgICAgICByZXR1cm4gc2luay5ydW4oKTtcblx0ICAgIH07XG5cdFxuXHQgICAgcmV0dXJuIFJhbmdlT2JzZXJ2YWJsZTtcblx0ICB9KE9ic2VydmFibGVCYXNlKSk7XG5cdFxuXHQgIHZhciBSYW5nZVNpbmsgPSAoZnVuY3Rpb24gKCkge1xuXHQgICAgZnVuY3Rpb24gUmFuZ2VTaW5rKG9ic2VydmVyLCBwYXJlbnQpIHtcblx0ICAgICAgdGhpcy5vYnNlcnZlciA9IG9ic2VydmVyO1xuXHQgICAgICB0aGlzLnBhcmVudCA9IHBhcmVudDtcblx0ICAgIH1cblx0XG5cdCAgICBSYW5nZVNpbmsucHJvdG90eXBlLnJ1biA9IGZ1bmN0aW9uICgpIHtcblx0ICAgICAgdmFyIHN0YXJ0ID0gdGhpcy5wYXJlbnQuc3RhcnQsIGNvdW50ID0gdGhpcy5wYXJlbnQucmFuZ2VDb3VudCwgb2JzZXJ2ZXIgPSB0aGlzLm9ic2VydmVyO1xuXHQgICAgICBmdW5jdGlvbiBsb29wUmVjdXJzaXZlKGksIHJlY3Vyc2UpIHtcblx0ICAgICAgICBpZiAoaSA8IGNvdW50KSB7XG5cdCAgICAgICAgICBvYnNlcnZlci5vbk5leHQoc3RhcnQgKyBpKTtcblx0ICAgICAgICAgIHJlY3Vyc2UoaSArIDEpO1xuXHQgICAgICAgIH0gZWxzZSB7XG5cdCAgICAgICAgICBvYnNlcnZlci5vbkNvbXBsZXRlZCgpO1xuXHQgICAgICAgIH1cblx0ICAgICAgfVxuXHRcblx0ICAgICAgcmV0dXJuIHRoaXMucGFyZW50LnNjaGVkdWxlci5zY2hlZHVsZVJlY3Vyc2l2ZSgwLCBsb29wUmVjdXJzaXZlKTtcblx0ICAgIH07XG5cdFxuXHQgICAgcmV0dXJuIFJhbmdlU2luaztcblx0ICB9KCkpO1xuXHRcblx0ICAvKipcblx0ICAqICBHZW5lcmF0ZXMgYW4gb2JzZXJ2YWJsZSBzZXF1ZW5jZSBvZiBpbnRlZ3JhbCBudW1iZXJzIHdpdGhpbiBhIHNwZWNpZmllZCByYW5nZSwgdXNpbmcgdGhlIHNwZWNpZmllZCBzY2hlZHVsZXIgdG8gc2VuZCBvdXQgb2JzZXJ2ZXIgbWVzc2FnZXMuXG5cdCAgKiBAcGFyYW0ge051bWJlcn0gc3RhcnQgVGhlIHZhbHVlIG9mIHRoZSBmaXJzdCBpbnRlZ2VyIGluIHRoZSBzZXF1ZW5jZS5cblx0ICAqIEBwYXJhbSB7TnVtYmVyfSBjb3VudCBUaGUgbnVtYmVyIG9mIHNlcXVlbnRpYWwgaW50ZWdlcnMgdG8gZ2VuZXJhdGUuXG5cdCAgKiBAcGFyYW0ge1NjaGVkdWxlcn0gW3NjaGVkdWxlcl0gU2NoZWR1bGVyIHRvIHJ1biB0aGUgZ2VuZXJhdG9yIGxvb3Agb24uIElmIG5vdCBzcGVjaWZpZWQsIGRlZmF1bHRzIHRvIFNjaGVkdWxlci5jdXJyZW50VGhyZWFkLlxuXHQgICogQHJldHVybnMge09ic2VydmFibGV9IEFuIG9ic2VydmFibGUgc2VxdWVuY2UgdGhhdCBjb250YWlucyBhIHJhbmdlIG9mIHNlcXVlbnRpYWwgaW50ZWdyYWwgbnVtYmVycy5cblx0ICAqL1xuXHQgIE9ic2VydmFibGUucmFuZ2UgPSBmdW5jdGlvbiAoc3RhcnQsIGNvdW50LCBzY2hlZHVsZXIpIHtcblx0ICAgIGlzU2NoZWR1bGVyKHNjaGVkdWxlcikgfHwgKHNjaGVkdWxlciA9IGN1cnJlbnRUaHJlYWRTY2hlZHVsZXIpO1xuXHQgICAgcmV0dXJuIG5ldyBSYW5nZU9ic2VydmFibGUoc3RhcnQsIGNvdW50LCBzY2hlZHVsZXIpO1xuXHQgIH07XG5cdFxuXHQgIHZhciBSZXBlYXRPYnNlcnZhYmxlID0gKGZ1bmN0aW9uKF9fc3VwZXJfXykge1xuXHQgICAgaW5oZXJpdHMoUmVwZWF0T2JzZXJ2YWJsZSwgX19zdXBlcl9fKTtcblx0ICAgIGZ1bmN0aW9uIFJlcGVhdE9ic2VydmFibGUodmFsdWUsIHJlcGVhdENvdW50LCBzY2hlZHVsZXIpIHtcblx0ICAgICAgdGhpcy52YWx1ZSA9IHZhbHVlO1xuXHQgICAgICB0aGlzLnJlcGVhdENvdW50ID0gcmVwZWF0Q291bnQgPT0gbnVsbCA/IC0xIDogcmVwZWF0Q291bnQ7XG5cdCAgICAgIHRoaXMuc2NoZWR1bGVyID0gc2NoZWR1bGVyO1xuXHQgICAgICBfX3N1cGVyX18uY2FsbCh0aGlzKTtcblx0ICAgIH1cblx0XG5cdCAgICBSZXBlYXRPYnNlcnZhYmxlLnByb3RvdHlwZS5zdWJzY3JpYmVDb3JlID0gZnVuY3Rpb24gKG9ic2VydmVyKSB7XG5cdCAgICAgIHZhciBzaW5rID0gbmV3IFJlcGVhdFNpbmsob2JzZXJ2ZXIsIHRoaXMpO1xuXHQgICAgICByZXR1cm4gc2luay5ydW4oKTtcblx0ICAgIH07XG5cdFxuXHQgICAgcmV0dXJuIFJlcGVhdE9ic2VydmFibGU7XG5cdCAgfShPYnNlcnZhYmxlQmFzZSkpO1xuXHRcblx0ICBmdW5jdGlvbiBSZXBlYXRTaW5rKG9ic2VydmVyLCBwYXJlbnQpIHtcblx0ICAgIHRoaXMub2JzZXJ2ZXIgPSBvYnNlcnZlcjtcblx0ICAgIHRoaXMucGFyZW50ID0gcGFyZW50O1xuXHQgIH1cblx0XG5cdCAgUmVwZWF0U2luay5wcm90b3R5cGUucnVuID0gZnVuY3Rpb24gKCkge1xuXHQgICAgdmFyIG9ic2VydmVyID0gdGhpcy5vYnNlcnZlciwgdmFsdWUgPSB0aGlzLnBhcmVudC52YWx1ZTtcblx0ICAgIGZ1bmN0aW9uIGxvb3BSZWN1cnNpdmUoaSwgcmVjdXJzZSkge1xuXHQgICAgICBpZiAoaSA9PT0gLTEgfHwgaSA+IDApIHtcblx0ICAgICAgICBvYnNlcnZlci5vbk5leHQodmFsdWUpO1xuXHQgICAgICAgIGkgPiAwICYmIGktLTtcblx0ICAgICAgfVxuXHQgICAgICBpZiAoaSA9PT0gMCkgeyByZXR1cm4gb2JzZXJ2ZXIub25Db21wbGV0ZWQoKTsgfVxuXHQgICAgICByZWN1cnNlKGkpO1xuXHQgICAgfVxuXHRcblx0ICAgIHJldHVybiB0aGlzLnBhcmVudC5zY2hlZHVsZXIuc2NoZWR1bGVSZWN1cnNpdmUodGhpcy5wYXJlbnQucmVwZWF0Q291bnQsIGxvb3BSZWN1cnNpdmUpO1xuXHQgIH07XG5cdFxuXHQgIC8qKlxuXHQgICAqICBHZW5lcmF0ZXMgYW4gb2JzZXJ2YWJsZSBzZXF1ZW5jZSB0aGF0IHJlcGVhdHMgdGhlIGdpdmVuIGVsZW1lbnQgdGhlIHNwZWNpZmllZCBudW1iZXIgb2YgdGltZXMsIHVzaW5nIHRoZSBzcGVjaWZpZWQgc2NoZWR1bGVyIHRvIHNlbmQgb3V0IG9ic2VydmVyIG1lc3NhZ2VzLlxuXHQgICAqIEBwYXJhbSB7TWl4ZWR9IHZhbHVlIEVsZW1lbnQgdG8gcmVwZWF0LlxuXHQgICAqIEBwYXJhbSB7TnVtYmVyfSByZXBlYXRDb3VudCBbT3B0aW9uYV0gTnVtYmVyIG9mIHRpbWVzIHRvIHJlcGVhdCB0aGUgZWxlbWVudC4gSWYgbm90IHNwZWNpZmllZCwgcmVwZWF0cyBpbmRlZmluaXRlbHkuXG5cdCAgICogQHBhcmFtIHtTY2hlZHVsZXJ9IHNjaGVkdWxlciBTY2hlZHVsZXIgdG8gcnVuIHRoZSBwcm9kdWNlciBsb29wIG9uLiBJZiBub3Qgc3BlY2lmaWVkLCBkZWZhdWx0cyB0byBTY2hlZHVsZXIuaW1tZWRpYXRlLlxuXHQgICAqIEByZXR1cm5zIHtPYnNlcnZhYmxlfSBBbiBvYnNlcnZhYmxlIHNlcXVlbmNlIHRoYXQgcmVwZWF0cyB0aGUgZ2l2ZW4gZWxlbWVudCB0aGUgc3BlY2lmaWVkIG51bWJlciBvZiB0aW1lcy5cblx0ICAgKi9cblx0ICBPYnNlcnZhYmxlLnJlcGVhdCA9IGZ1bmN0aW9uICh2YWx1ZSwgcmVwZWF0Q291bnQsIHNjaGVkdWxlcikge1xuXHQgICAgaXNTY2hlZHVsZXIoc2NoZWR1bGVyKSB8fCAoc2NoZWR1bGVyID0gY3VycmVudFRocmVhZFNjaGVkdWxlcik7XG5cdCAgICByZXR1cm4gbmV3IFJlcGVhdE9ic2VydmFibGUodmFsdWUsIHJlcGVhdENvdW50LCBzY2hlZHVsZXIpO1xuXHQgIH07XG5cdFxuXHQgIHZhciBKdXN0T2JzZXJ2YWJsZSA9IChmdW5jdGlvbihfX3N1cGVyX18pIHtcblx0ICAgIGluaGVyaXRzKEp1c3RPYnNlcnZhYmxlLCBfX3N1cGVyX18pO1xuXHQgICAgZnVuY3Rpb24gSnVzdE9ic2VydmFibGUodmFsdWUsIHNjaGVkdWxlcikge1xuXHQgICAgICB0aGlzLnZhbHVlID0gdmFsdWU7XG5cdCAgICAgIHRoaXMuc2NoZWR1bGVyID0gc2NoZWR1bGVyO1xuXHQgICAgICBfX3N1cGVyX18uY2FsbCh0aGlzKTtcblx0ICAgIH1cblx0XG5cdCAgICBKdXN0T2JzZXJ2YWJsZS5wcm90b3R5cGUuc3Vic2NyaWJlQ29yZSA9IGZ1bmN0aW9uIChvYnNlcnZlcikge1xuXHQgICAgICB2YXIgc2luayA9IG5ldyBKdXN0U2luayhvYnNlcnZlciwgdGhpcy52YWx1ZSwgdGhpcy5zY2hlZHVsZXIpO1xuXHQgICAgICByZXR1cm4gc2luay5ydW4oKTtcblx0ICAgIH07XG5cdFxuXHQgICAgZnVuY3Rpb24gSnVzdFNpbmsob2JzZXJ2ZXIsIHZhbHVlLCBzY2hlZHVsZXIpIHtcblx0ICAgICAgdGhpcy5vYnNlcnZlciA9IG9ic2VydmVyO1xuXHQgICAgICB0aGlzLnZhbHVlID0gdmFsdWU7XG5cdCAgICAgIHRoaXMuc2NoZWR1bGVyID0gc2NoZWR1bGVyO1xuXHQgICAgfVxuXHRcblx0ICAgIGZ1bmN0aW9uIHNjaGVkdWxlSXRlbShzLCBzdGF0ZSkge1xuXHQgICAgICB2YXIgdmFsdWUgPSBzdGF0ZVswXSwgb2JzZXJ2ZXIgPSBzdGF0ZVsxXTtcblx0ICAgICAgb2JzZXJ2ZXIub25OZXh0KHZhbHVlKTtcblx0ICAgICAgb2JzZXJ2ZXIub25Db21wbGV0ZWQoKTtcblx0ICAgICAgcmV0dXJuIGRpc3Bvc2FibGVFbXB0eTtcblx0ICAgIH1cblx0XG5cdCAgICBKdXN0U2luay5wcm90b3R5cGUucnVuID0gZnVuY3Rpb24gKCkge1xuXHQgICAgICB2YXIgc3RhdGUgPSBbdGhpcy52YWx1ZSwgdGhpcy5vYnNlcnZlcl07XG5cdCAgICAgIHJldHVybiB0aGlzLnNjaGVkdWxlciA9PT0gaW1tZWRpYXRlU2NoZWR1bGVyID9cblx0ICAgICAgICBzY2hlZHVsZUl0ZW0obnVsbCwgc3RhdGUpIDpcblx0ICAgICAgICB0aGlzLnNjaGVkdWxlci5zY2hlZHVsZShzdGF0ZSwgc2NoZWR1bGVJdGVtKTtcblx0ICAgIH07XG5cdFxuXHQgICAgcmV0dXJuIEp1c3RPYnNlcnZhYmxlO1xuXHQgIH0oT2JzZXJ2YWJsZUJhc2UpKTtcblx0XG5cdCAgLyoqXG5cdCAgICogIFJldHVybnMgYW4gb2JzZXJ2YWJsZSBzZXF1ZW5jZSB0aGF0IGNvbnRhaW5zIGEgc2luZ2xlIGVsZW1lbnQsIHVzaW5nIHRoZSBzcGVjaWZpZWQgc2NoZWR1bGVyIHRvIHNlbmQgb3V0IG9ic2VydmVyIG1lc3NhZ2VzLlxuXHQgICAqICBUaGVyZSBpcyBhbiBhbGlhcyBjYWxsZWQgJ2p1c3QnIG9yIGJyb3dzZXJzIDxJRTkuXG5cdCAgICogQHBhcmFtIHtNaXhlZH0gdmFsdWUgU2luZ2xlIGVsZW1lbnQgaW4gdGhlIHJlc3VsdGluZyBvYnNlcnZhYmxlIHNlcXVlbmNlLlxuXHQgICAqIEBwYXJhbSB7U2NoZWR1bGVyfSBzY2hlZHVsZXIgU2NoZWR1bGVyIHRvIHNlbmQgdGhlIHNpbmdsZSBlbGVtZW50IG9uLiBJZiBub3Qgc3BlY2lmaWVkLCBkZWZhdWx0cyB0byBTY2hlZHVsZXIuaW1tZWRpYXRlLlxuXHQgICAqIEByZXR1cm5zIHtPYnNlcnZhYmxlfSBBbiBvYnNlcnZhYmxlIHNlcXVlbmNlIGNvbnRhaW5pbmcgdGhlIHNpbmdsZSBzcGVjaWZpZWQgZWxlbWVudC5cblx0ICAgKi9cblx0ICB2YXIgb2JzZXJ2YWJsZVJldHVybiA9IE9ic2VydmFibGVbJ3JldHVybiddID0gT2JzZXJ2YWJsZS5qdXN0ID0gZnVuY3Rpb24gKHZhbHVlLCBzY2hlZHVsZXIpIHtcblx0ICAgIGlzU2NoZWR1bGVyKHNjaGVkdWxlcikgfHwgKHNjaGVkdWxlciA9IGltbWVkaWF0ZVNjaGVkdWxlcik7XG5cdCAgICByZXR1cm4gbmV3IEp1c3RPYnNlcnZhYmxlKHZhbHVlLCBzY2hlZHVsZXIpO1xuXHQgIH07XG5cdFxuXHQgIHZhciBUaHJvd09ic2VydmFibGUgPSAoZnVuY3Rpb24oX19zdXBlcl9fKSB7XG5cdCAgICBpbmhlcml0cyhUaHJvd09ic2VydmFibGUsIF9fc3VwZXJfXyk7XG5cdCAgICBmdW5jdGlvbiBUaHJvd09ic2VydmFibGUoZXJyb3IsIHNjaGVkdWxlcikge1xuXHQgICAgICB0aGlzLmVycm9yID0gZXJyb3I7XG5cdCAgICAgIHRoaXMuc2NoZWR1bGVyID0gc2NoZWR1bGVyO1xuXHQgICAgICBfX3N1cGVyX18uY2FsbCh0aGlzKTtcblx0ICAgIH1cblx0XG5cdCAgICBUaHJvd09ic2VydmFibGUucHJvdG90eXBlLnN1YnNjcmliZUNvcmUgPSBmdW5jdGlvbiAobykge1xuXHQgICAgICB2YXIgc2luayA9IG5ldyBUaHJvd1NpbmsobywgdGhpcyk7XG5cdCAgICAgIHJldHVybiBzaW5rLnJ1bigpO1xuXHQgICAgfTtcblx0XG5cdCAgICBmdW5jdGlvbiBUaHJvd1NpbmsobywgcCkge1xuXHQgICAgICB0aGlzLm8gPSBvO1xuXHQgICAgICB0aGlzLnAgPSBwO1xuXHQgICAgfVxuXHRcblx0ICAgIGZ1bmN0aW9uIHNjaGVkdWxlSXRlbShzLCBzdGF0ZSkge1xuXHQgICAgICB2YXIgZSA9IHN0YXRlWzBdLCBvID0gc3RhdGVbMV07XG5cdCAgICAgIG8ub25FcnJvcihlKTtcblx0ICAgIH1cblx0XG5cdCAgICBUaHJvd1NpbmsucHJvdG90eXBlLnJ1biA9IGZ1bmN0aW9uICgpIHtcblx0ICAgICAgcmV0dXJuIHRoaXMucC5zY2hlZHVsZXIuc2NoZWR1bGUoW3RoaXMucC5lcnJvciwgdGhpcy5vXSwgc2NoZWR1bGVJdGVtKTtcblx0ICAgIH07XG5cdFxuXHQgICAgcmV0dXJuIFRocm93T2JzZXJ2YWJsZTtcblx0ICB9KE9ic2VydmFibGVCYXNlKSk7XG5cdFxuXHQgIC8qKlxuXHQgICAqICBSZXR1cm5zIGFuIG9ic2VydmFibGUgc2VxdWVuY2UgdGhhdCB0ZXJtaW5hdGVzIHdpdGggYW4gZXhjZXB0aW9uLCB1c2luZyB0aGUgc3BlY2lmaWVkIHNjaGVkdWxlciB0byBzZW5kIG91dCB0aGUgc2luZ2xlIG9uRXJyb3IgbWVzc2FnZS5cblx0ICAgKiAgVGhlcmUgaXMgYW4gYWxpYXMgdG8gdGhpcyBtZXRob2QgY2FsbGVkICd0aHJvd0Vycm9yJyBmb3IgYnJvd3NlcnMgPElFOS5cblx0ICAgKiBAcGFyYW0ge01peGVkfSBlcnJvciBBbiBvYmplY3QgdXNlZCBmb3IgdGhlIHNlcXVlbmNlJ3MgdGVybWluYXRpb24uXG5cdCAgICogQHBhcmFtIHtTY2hlZHVsZXJ9IHNjaGVkdWxlciBTY2hlZHVsZXIgdG8gc2VuZCB0aGUgZXhjZXB0aW9uYWwgdGVybWluYXRpb24gY2FsbCBvbi4gSWYgbm90IHNwZWNpZmllZCwgZGVmYXVsdHMgdG8gU2NoZWR1bGVyLmltbWVkaWF0ZS5cblx0ICAgKiBAcmV0dXJucyB7T2JzZXJ2YWJsZX0gVGhlIG9ic2VydmFibGUgc2VxdWVuY2UgdGhhdCB0ZXJtaW5hdGVzIGV4Y2VwdGlvbmFsbHkgd2l0aCB0aGUgc3BlY2lmaWVkIGV4Y2VwdGlvbiBvYmplY3QuXG5cdCAgICovXG5cdCAgdmFyIG9ic2VydmFibGVUaHJvdyA9IE9ic2VydmFibGVbJ3Rocm93J10gPSBmdW5jdGlvbiAoZXJyb3IsIHNjaGVkdWxlcikge1xuXHQgICAgaXNTY2hlZHVsZXIoc2NoZWR1bGVyKSB8fCAoc2NoZWR1bGVyID0gaW1tZWRpYXRlU2NoZWR1bGVyKTtcblx0ICAgIHJldHVybiBuZXcgVGhyb3dPYnNlcnZhYmxlKGVycm9yLCBzY2hlZHVsZXIpO1xuXHQgIH07XG5cdFxuXHQgIHZhciBVc2luZ09ic2VydmFibGUgPSAoZnVuY3Rpb24gKF9fc3VwZXJfXykge1xuXHQgICAgaW5oZXJpdHMoVXNpbmdPYnNlcnZhYmxlLCBfX3N1cGVyX18pO1xuXHQgICAgZnVuY3Rpb24gVXNpbmdPYnNlcnZhYmxlKHJlc0ZuLCBvYnNGbikge1xuXHQgICAgICB0aGlzLl9yZXNGbiA9IHJlc0ZuO1xuXHQgICAgICB0aGlzLl9vYnNGbiA9IG9ic0ZuO1xuXHQgICAgICBfX3N1cGVyX18uY2FsbCh0aGlzKTtcblx0ICAgIH1cblx0XG5cdCAgICBVc2luZ09ic2VydmFibGUucHJvdG90eXBlLnN1YnNjcmliZUNvcmUgPSBmdW5jdGlvbiAobykge1xuXHQgICAgICB2YXIgZGlzcG9zYWJsZSA9IGRpc3Bvc2FibGVFbXB0eTtcblx0ICAgICAgdmFyIHJlc291cmNlID0gdHJ5Q2F0Y2godGhpcy5fcmVzRm4pKCk7XG5cdCAgICAgIGlmIChyZXNvdXJjZSA9PT0gZXJyb3JPYmopIHtcblx0ICAgICAgICByZXR1cm4gbmV3IEJpbmFyeURpc3Bvc2FibGUob2JzZXJ2YWJsZVRocm93KHJlc291cmNlLmUpLnN1YnNjcmliZShvKSwgZGlzcG9zYWJsZSk7XG5cdCAgICAgIH1cblx0ICAgICAgcmVzb3VyY2UgJiYgKGRpc3Bvc2FibGUgPSByZXNvdXJjZSk7XG5cdCAgICAgIHZhciBzb3VyY2UgPSB0cnlDYXRjaCh0aGlzLl9vYnNGbikocmVzb3VyY2UpO1xuXHQgICAgICBpZiAoc291cmNlID09PSBlcnJvck9iaikge1xuXHQgICAgICAgIHJldHVybiBuZXcgQmluYXJ5RGlzcG9zYWJsZShvYnNlcnZhYmxlVGhyb3coc291cmNlLmUpLnN1YnNjcmliZShvKSwgZGlzcG9zYWJsZSk7XG5cdCAgICAgIH1cblx0ICAgICAgcmV0dXJuIG5ldyBCaW5hcnlEaXNwb3NhYmxlKHNvdXJjZS5zdWJzY3JpYmUobyksIGRpc3Bvc2FibGUpO1xuXHQgICAgfTtcblx0XG5cdCAgICByZXR1cm4gVXNpbmdPYnNlcnZhYmxlO1xuXHQgIH0oT2JzZXJ2YWJsZUJhc2UpKTtcblx0XG5cdCAgLyoqXG5cdCAgICogQ29uc3RydWN0cyBhbiBvYnNlcnZhYmxlIHNlcXVlbmNlIHRoYXQgZGVwZW5kcyBvbiBhIHJlc291cmNlIG9iamVjdCwgd2hvc2UgbGlmZXRpbWUgaXMgdGllZCB0byB0aGUgcmVzdWx0aW5nIG9ic2VydmFibGUgc2VxdWVuY2UncyBsaWZldGltZS5cblx0ICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSByZXNvdXJjZUZhY3RvcnkgRmFjdG9yeSBmdW5jdGlvbiB0byBvYnRhaW4gYSByZXNvdXJjZSBvYmplY3QuXG5cdCAgICogQHBhcmFtIHtGdW5jdGlvbn0gb2JzZXJ2YWJsZUZhY3RvcnkgRmFjdG9yeSBmdW5jdGlvbiB0byBvYnRhaW4gYW4gb2JzZXJ2YWJsZSBzZXF1ZW5jZSB0aGF0IGRlcGVuZHMgb24gdGhlIG9idGFpbmVkIHJlc291cmNlLlxuXHQgICAqIEByZXR1cm5zIHtPYnNlcnZhYmxlfSBBbiBvYnNlcnZhYmxlIHNlcXVlbmNlIHdob3NlIGxpZmV0aW1lIGNvbnRyb2xzIHRoZSBsaWZldGltZSBvZiB0aGUgZGVwZW5kZW50IHJlc291cmNlIG9iamVjdC5cblx0ICAgKi9cblx0ICBPYnNlcnZhYmxlLnVzaW5nID0gZnVuY3Rpb24gKHJlc291cmNlRmFjdG9yeSwgb2JzZXJ2YWJsZUZhY3RvcnkpIHtcblx0ICAgIHJldHVybiBuZXcgVXNpbmdPYnNlcnZhYmxlKHJlc291cmNlRmFjdG9yeSwgb2JzZXJ2YWJsZUZhY3RvcnkpO1xuXHQgIH07XG5cdFxuXHQgIC8qKlxuXHQgICAqIFByb3BhZ2F0ZXMgdGhlIG9ic2VydmFibGUgc2VxdWVuY2Ugb3IgUHJvbWlzZSB0aGF0IHJlYWN0cyBmaXJzdC5cblx0ICAgKiBAcGFyYW0ge09ic2VydmFibGV9IHJpZ2h0U291cmNlIFNlY29uZCBvYnNlcnZhYmxlIHNlcXVlbmNlIG9yIFByb21pc2UuXG5cdCAgICogQHJldHVybnMge09ic2VydmFibGV9IHtPYnNlcnZhYmxlfSBBbiBvYnNlcnZhYmxlIHNlcXVlbmNlIHRoYXQgc3VyZmFjZXMgZWl0aGVyIG9mIHRoZSBnaXZlbiBzZXF1ZW5jZXMsIHdoaWNoZXZlciByZWFjdGVkIGZpcnN0LlxuXHQgICAqL1xuXHQgIG9ic2VydmFibGVQcm90by5hbWIgPSBmdW5jdGlvbiAocmlnaHRTb3VyY2UpIHtcblx0ICAgIHZhciBsZWZ0U291cmNlID0gdGhpcztcblx0ICAgIHJldHVybiBuZXcgQW5vbnltb3VzT2JzZXJ2YWJsZShmdW5jdGlvbiAob2JzZXJ2ZXIpIHtcblx0ICAgICAgdmFyIGNob2ljZSxcblx0ICAgICAgICBsZWZ0Q2hvaWNlID0gJ0wnLCByaWdodENob2ljZSA9ICdSJyxcblx0ICAgICAgICBsZWZ0U3Vic2NyaXB0aW9uID0gbmV3IFNpbmdsZUFzc2lnbm1lbnREaXNwb3NhYmxlKCksXG5cdCAgICAgICAgcmlnaHRTdWJzY3JpcHRpb24gPSBuZXcgU2luZ2xlQXNzaWdubWVudERpc3Bvc2FibGUoKTtcblx0XG5cdCAgICAgIGlzUHJvbWlzZShyaWdodFNvdXJjZSkgJiYgKHJpZ2h0U291cmNlID0gb2JzZXJ2YWJsZUZyb21Qcm9taXNlKHJpZ2h0U291cmNlKSk7XG5cdFxuXHQgICAgICBmdW5jdGlvbiBjaG9pY2VMKCkge1xuXHQgICAgICAgIGlmICghY2hvaWNlKSB7XG5cdCAgICAgICAgICBjaG9pY2UgPSBsZWZ0Q2hvaWNlO1xuXHQgICAgICAgICAgcmlnaHRTdWJzY3JpcHRpb24uZGlzcG9zZSgpO1xuXHQgICAgICAgIH1cblx0ICAgICAgfVxuXHRcblx0ICAgICAgZnVuY3Rpb24gY2hvaWNlUigpIHtcblx0ICAgICAgICBpZiAoIWNob2ljZSkge1xuXHQgICAgICAgICAgY2hvaWNlID0gcmlnaHRDaG9pY2U7XG5cdCAgICAgICAgICBsZWZ0U3Vic2NyaXB0aW9uLmRpc3Bvc2UoKTtcblx0ICAgICAgICB9XG5cdCAgICAgIH1cblx0XG5cdCAgICAgIHZhciBsZWZ0U3Vic2NyaWJlID0gb2JzZXJ2ZXJDcmVhdGUoXG5cdCAgICAgICAgZnVuY3Rpb24gKGxlZnQpIHtcblx0ICAgICAgICAgIGNob2ljZUwoKTtcblx0ICAgICAgICAgIGNob2ljZSA9PT0gbGVmdENob2ljZSAmJiBvYnNlcnZlci5vbk5leHQobGVmdCk7XG5cdCAgICAgICAgfSxcblx0ICAgICAgICBmdW5jdGlvbiAoZSkge1xuXHQgICAgICAgICAgY2hvaWNlTCgpO1xuXHQgICAgICAgICAgY2hvaWNlID09PSBsZWZ0Q2hvaWNlICYmIG9ic2VydmVyLm9uRXJyb3IoZSk7XG5cdCAgICAgICAgfSxcblx0ICAgICAgICBmdW5jdGlvbiAoKSB7XG5cdCAgICAgICAgICBjaG9pY2VMKCk7XG5cdCAgICAgICAgICBjaG9pY2UgPT09IGxlZnRDaG9pY2UgJiYgb2JzZXJ2ZXIub25Db21wbGV0ZWQoKTtcblx0ICAgICAgICB9XG5cdCAgICAgICk7XG5cdCAgICAgIHZhciByaWdodFN1YnNjcmliZSA9IG9ic2VydmVyQ3JlYXRlKFxuXHQgICAgICAgIGZ1bmN0aW9uIChyaWdodCkge1xuXHQgICAgICAgICAgY2hvaWNlUigpO1xuXHQgICAgICAgICAgY2hvaWNlID09PSByaWdodENob2ljZSAmJiBvYnNlcnZlci5vbk5leHQocmlnaHQpO1xuXHQgICAgICAgIH0sXG5cdCAgICAgICAgZnVuY3Rpb24gKGUpIHtcblx0ICAgICAgICAgIGNob2ljZVIoKTtcblx0ICAgICAgICAgIGNob2ljZSA9PT0gcmlnaHRDaG9pY2UgJiYgb2JzZXJ2ZXIub25FcnJvcihlKTtcblx0ICAgICAgICB9LFxuXHQgICAgICAgIGZ1bmN0aW9uICgpIHtcblx0ICAgICAgICAgIGNob2ljZVIoKTtcblx0ICAgICAgICAgIGNob2ljZSA9PT0gcmlnaHRDaG9pY2UgJiYgb2JzZXJ2ZXIub25Db21wbGV0ZWQoKTtcblx0ICAgICAgICB9XG5cdCAgICAgICk7XG5cdFxuXHQgICAgICBsZWZ0U3Vic2NyaXB0aW9uLnNldERpc3Bvc2FibGUobGVmdFNvdXJjZS5zdWJzY3JpYmUobGVmdFN1YnNjcmliZSkpO1xuXHQgICAgICByaWdodFN1YnNjcmlwdGlvbi5zZXREaXNwb3NhYmxlKHJpZ2h0U291cmNlLnN1YnNjcmliZShyaWdodFN1YnNjcmliZSkpO1xuXHRcblx0ICAgICAgcmV0dXJuIG5ldyBCaW5hcnlEaXNwb3NhYmxlKGxlZnRTdWJzY3JpcHRpb24sIHJpZ2h0U3Vic2NyaXB0aW9uKTtcblx0ICAgIH0pO1xuXHQgIH07XG5cdFxuXHQgIGZ1bmN0aW9uIGFtYihwLCBjKSB7IHJldHVybiBwLmFtYihjKTsgfVxuXHRcblx0ICAvKipcblx0ICAgKiBQcm9wYWdhdGVzIHRoZSBvYnNlcnZhYmxlIHNlcXVlbmNlIG9yIFByb21pc2UgdGhhdCByZWFjdHMgZmlyc3QuXG5cdCAgICogQHJldHVybnMge09ic2VydmFibGV9IEFuIG9ic2VydmFibGUgc2VxdWVuY2UgdGhhdCBzdXJmYWNlcyBhbnkgb2YgdGhlIGdpdmVuIHNlcXVlbmNlcywgd2hpY2hldmVyIHJlYWN0ZWQgZmlyc3QuXG5cdCAgICovXG5cdCAgT2JzZXJ2YWJsZS5hbWIgPSBmdW5jdGlvbiAoKSB7XG5cdCAgICB2YXIgYWNjID0gb2JzZXJ2YWJsZU5ldmVyKCksIGl0ZW1zO1xuXHQgICAgaWYgKEFycmF5LmlzQXJyYXkoYXJndW1lbnRzWzBdKSkge1xuXHQgICAgICBpdGVtcyA9IGFyZ3VtZW50c1swXTtcblx0ICAgIH0gZWxzZSB7XG5cdCAgICAgIHZhciBsZW4gPSBhcmd1bWVudHMubGVuZ3RoO1xuXHQgICAgICBpdGVtcyA9IG5ldyBBcnJheShpdGVtcyk7XG5cdCAgICAgIGZvcih2YXIgaSA9IDA7IGkgPCBsZW47IGkrKykgeyBpdGVtc1tpXSA9IGFyZ3VtZW50c1tpXTsgfVxuXHQgICAgfVxuXHQgICAgZm9yICh2YXIgaSA9IDAsIGxlbiA9IGl0ZW1zLmxlbmd0aDsgaSA8IGxlbjsgaSsrKSB7XG5cdCAgICAgIGFjYyA9IGFtYihhY2MsIGl0ZW1zW2ldKTtcblx0ICAgIH1cblx0ICAgIHJldHVybiBhY2M7XG5cdCAgfTtcblx0XG5cdCAgdmFyIENhdGNoT2JzZXJ2YWJsZSA9IChmdW5jdGlvbiAoX19zdXBlcl9fKSB7XG5cdCAgICBpbmhlcml0cyhDYXRjaE9ic2VydmFibGUsIF9fc3VwZXJfXyk7XG5cdCAgICBmdW5jdGlvbiBDYXRjaE9ic2VydmFibGUoc291cmNlLCBmbikge1xuXHQgICAgICB0aGlzLnNvdXJjZSA9IHNvdXJjZTtcblx0ICAgICAgdGhpcy5fZm4gPSBmbjtcblx0ICAgICAgX19zdXBlcl9fLmNhbGwodGhpcyk7XG5cdCAgICB9XG5cdFxuXHQgICAgQ2F0Y2hPYnNlcnZhYmxlLnByb3RvdHlwZS5zdWJzY3JpYmVDb3JlID0gZnVuY3Rpb24gKG8pIHtcblx0ICAgICAgdmFyIGQxID0gbmV3IFNpbmdsZUFzc2lnbm1lbnREaXNwb3NhYmxlKCksIHN1YnNjcmlwdGlvbiA9IG5ldyBTZXJpYWxEaXNwb3NhYmxlKCk7XG5cdCAgICAgIHN1YnNjcmlwdGlvbi5zZXREaXNwb3NhYmxlKGQxKTtcblx0ICAgICAgZDEuc2V0RGlzcG9zYWJsZSh0aGlzLnNvdXJjZS5zdWJzY3JpYmUobmV3IENhdGNoT2JzZXJ2ZXIobywgc3Vic2NyaXB0aW9uLCB0aGlzLl9mbikpKTtcblx0ICAgICAgcmV0dXJuIHN1YnNjcmlwdGlvbjtcblx0ICAgIH07XG5cdFxuXHQgICAgcmV0dXJuIENhdGNoT2JzZXJ2YWJsZTtcblx0ICB9KE9ic2VydmFibGVCYXNlKSk7XG5cdFxuXHQgIHZhciBDYXRjaE9ic2VydmVyID0gKGZ1bmN0aW9uKF9fc3VwZXJfXykge1xuXHQgICAgaW5oZXJpdHMoQ2F0Y2hPYnNlcnZlciwgX19zdXBlcl9fKTtcblx0ICAgIGZ1bmN0aW9uIENhdGNoT2JzZXJ2ZXIobywgcywgZm4pIHtcblx0ICAgICAgdGhpcy5fbyA9IG87XG5cdCAgICAgIHRoaXMuX3MgPSBzO1xuXHQgICAgICB0aGlzLl9mbiA9IGZuO1xuXHQgICAgICBfX3N1cGVyX18uY2FsbCh0aGlzKTtcblx0ICAgIH1cblx0XG5cdCAgICBDYXRjaE9ic2VydmVyLnByb3RvdHlwZS5uZXh0ID0gZnVuY3Rpb24gKHgpIHsgdGhpcy5fby5vbk5leHQoeCk7IH07XG5cdCAgICBDYXRjaE9ic2VydmVyLnByb3RvdHlwZS5jb21wbGV0ZWQgPSBmdW5jdGlvbiAoKSB7IHJldHVybiB0aGlzLl9vLm9uQ29tcGxldGVkKCk7IH07XG5cdCAgICBDYXRjaE9ic2VydmVyLnByb3RvdHlwZS5lcnJvciA9IGZ1bmN0aW9uIChlKSB7XG5cdCAgICAgIHZhciByZXN1bHQgPSB0cnlDYXRjaCh0aGlzLl9mbikoZSk7XG5cdCAgICAgIGlmIChyZXN1bHQgPT09IGVycm9yT2JqKSB7IHJldHVybiB0aGlzLl9vLm9uRXJyb3IocmVzdWx0LmUpOyB9XG5cdCAgICAgIGlzUHJvbWlzZShyZXN1bHQpICYmIChyZXN1bHQgPSBvYnNlcnZhYmxlRnJvbVByb21pc2UocmVzdWx0KSk7XG5cdFxuXHQgICAgICB2YXIgZCA9IG5ldyBTaW5nbGVBc3NpZ25tZW50RGlzcG9zYWJsZSgpO1xuXHQgICAgICB0aGlzLl9zLnNldERpc3Bvc2FibGUoZCk7XG5cdCAgICAgIGQuc2V0RGlzcG9zYWJsZShyZXN1bHQuc3Vic2NyaWJlKHRoaXMuX28pKTtcblx0ICAgIH07XG5cdFxuXHQgICAgcmV0dXJuIENhdGNoT2JzZXJ2ZXI7XG5cdCAgfShBYnN0cmFjdE9ic2VydmVyKSk7XG5cdFxuXHQgIC8qKlxuXHQgICAqIENvbnRpbnVlcyBhbiBvYnNlcnZhYmxlIHNlcXVlbmNlIHRoYXQgaXMgdGVybWluYXRlZCBieSBhbiBleGNlcHRpb24gd2l0aCB0aGUgbmV4dCBvYnNlcnZhYmxlIHNlcXVlbmNlLlxuXHQgICAqIEBwYXJhbSB7TWl4ZWR9IGhhbmRsZXJPclNlY29uZCBFeGNlcHRpb24gaGFuZGxlciBmdW5jdGlvbiB0aGF0IHJldHVybnMgYW4gb2JzZXJ2YWJsZSBzZXF1ZW5jZSBnaXZlbiB0aGUgZXJyb3IgdGhhdCBvY2N1cnJlZCBpbiB0aGUgZmlyc3Qgc2VxdWVuY2UsIG9yIGEgc2Vjb25kIG9ic2VydmFibGUgc2VxdWVuY2UgdXNlZCB0byBwcm9kdWNlIHJlc3VsdHMgd2hlbiBhbiBlcnJvciBvY2N1cnJlZCBpbiB0aGUgZmlyc3Qgc2VxdWVuY2UuXG5cdCAgICogQHJldHVybnMge09ic2VydmFibGV9IEFuIG9ic2VydmFibGUgc2VxdWVuY2UgY29udGFpbmluZyB0aGUgZmlyc3Qgc2VxdWVuY2UncyBlbGVtZW50cywgZm9sbG93ZWQgYnkgdGhlIGVsZW1lbnRzIG9mIHRoZSBoYW5kbGVyIHNlcXVlbmNlIGluIGNhc2UgYW4gZXhjZXB0aW9uIG9jY3VycmVkLlxuXHQgICAqL1xuXHQgIG9ic2VydmFibGVQcm90b1snY2F0Y2gnXSA9IGZ1bmN0aW9uIChoYW5kbGVyT3JTZWNvbmQpIHtcblx0ICAgIHJldHVybiBpc0Z1bmN0aW9uKGhhbmRsZXJPclNlY29uZCkgPyBuZXcgQ2F0Y2hPYnNlcnZhYmxlKHRoaXMsIGhhbmRsZXJPclNlY29uZCkgOiBvYnNlcnZhYmxlQ2F0Y2goW3RoaXMsIGhhbmRsZXJPclNlY29uZF0pO1xuXHQgIH07XG5cdFxuXHQgIC8qKlxuXHQgICAqIENvbnRpbnVlcyBhbiBvYnNlcnZhYmxlIHNlcXVlbmNlIHRoYXQgaXMgdGVybWluYXRlZCBieSBhbiBleGNlcHRpb24gd2l0aCB0aGUgbmV4dCBvYnNlcnZhYmxlIHNlcXVlbmNlLlxuXHQgICAqIEBwYXJhbSB7QXJyYXkgfCBBcmd1bWVudHN9IGFyZ3MgQXJndW1lbnRzIG9yIGFuIGFycmF5IHRvIHVzZSBhcyB0aGUgbmV4dCBzZXF1ZW5jZSBpZiBhbiBlcnJvciBvY2N1cnMuXG5cdCAgICogQHJldHVybnMge09ic2VydmFibGV9IEFuIG9ic2VydmFibGUgc2VxdWVuY2UgY29udGFpbmluZyBlbGVtZW50cyBmcm9tIGNvbnNlY3V0aXZlIHNvdXJjZSBzZXF1ZW5jZXMgdW50aWwgYSBzb3VyY2Ugc2VxdWVuY2UgdGVybWluYXRlcyBzdWNjZXNzZnVsbHkuXG5cdCAgICovXG5cdCAgdmFyIG9ic2VydmFibGVDYXRjaCA9IE9ic2VydmFibGVbJ2NhdGNoJ10gPSBmdW5jdGlvbiAoKSB7XG5cdCAgICB2YXIgaXRlbXM7XG5cdCAgICBpZiAoQXJyYXkuaXNBcnJheShhcmd1bWVudHNbMF0pKSB7XG5cdCAgICAgIGl0ZW1zID0gYXJndW1lbnRzWzBdO1xuXHQgICAgfSBlbHNlIHtcblx0ICAgICAgdmFyIGxlbiA9IGFyZ3VtZW50cy5sZW5ndGg7XG5cdCAgICAgIGl0ZW1zID0gbmV3IEFycmF5KGxlbik7XG5cdCAgICAgIGZvcih2YXIgaSA9IDA7IGkgPCBsZW47IGkrKykgeyBpdGVtc1tpXSA9IGFyZ3VtZW50c1tpXTsgfVxuXHQgICAgfVxuXHQgICAgcmV0dXJuIGVudW1lcmFibGVPZihpdGVtcykuY2F0Y2hFcnJvcigpO1xuXHQgIH07XG5cdFxuXHQgIC8qKlxuXHQgICAqIE1lcmdlcyB0aGUgc3BlY2lmaWVkIG9ic2VydmFibGUgc2VxdWVuY2VzIGludG8gb25lIG9ic2VydmFibGUgc2VxdWVuY2UgYnkgdXNpbmcgdGhlIHNlbGVjdG9yIGZ1bmN0aW9uIHdoZW5ldmVyIGFueSBvZiB0aGUgb2JzZXJ2YWJsZSBzZXF1ZW5jZXMgb3IgUHJvbWlzZXMgcHJvZHVjZXMgYW4gZWxlbWVudC5cblx0ICAgKiBUaGlzIGNhbiBiZSBpbiB0aGUgZm9ybSBvZiBhbiBhcmd1bWVudCBsaXN0IG9mIG9ic2VydmFibGVzIG9yIGFuIGFycmF5LlxuXHQgICAqXG5cdCAgICogQGV4YW1wbGVcblx0ICAgKiAxIC0gb2JzID0gb2JzZXJ2YWJsZS5jb21iaW5lTGF0ZXN0KG9iczEsIG9iczIsIG9iczMsIGZ1bmN0aW9uIChvMSwgbzIsIG8zKSB7IHJldHVybiBvMSArIG8yICsgbzM7IH0pO1xuXHQgICAqIDIgLSBvYnMgPSBvYnNlcnZhYmxlLmNvbWJpbmVMYXRlc3QoW29iczEsIG9iczIsIG9iczNdLCBmdW5jdGlvbiAobzEsIG8yLCBvMykgeyByZXR1cm4gbzEgKyBvMiArIG8zOyB9KTtcblx0ICAgKiBAcmV0dXJucyB7T2JzZXJ2YWJsZX0gQW4gb2JzZXJ2YWJsZSBzZXF1ZW5jZSBjb250YWluaW5nIHRoZSByZXN1bHQgb2YgY29tYmluaW5nIGVsZW1lbnRzIG9mIHRoZSBzb3VyY2VzIHVzaW5nIHRoZSBzcGVjaWZpZWQgcmVzdWx0IHNlbGVjdG9yIGZ1bmN0aW9uLlxuXHQgICAqL1xuXHQgIG9ic2VydmFibGVQcm90by5jb21iaW5lTGF0ZXN0ID0gZnVuY3Rpb24gKCkge1xuXHQgICAgdmFyIGxlbiA9IGFyZ3VtZW50cy5sZW5ndGgsIGFyZ3MgPSBuZXcgQXJyYXkobGVuKTtcblx0ICAgIGZvcih2YXIgaSA9IDA7IGkgPCBsZW47IGkrKykgeyBhcmdzW2ldID0gYXJndW1lbnRzW2ldOyB9XG5cdCAgICBpZiAoQXJyYXkuaXNBcnJheShhcmdzWzBdKSkge1xuXHQgICAgICBhcmdzWzBdLnVuc2hpZnQodGhpcyk7XG5cdCAgICB9IGVsc2Uge1xuXHQgICAgICBhcmdzLnVuc2hpZnQodGhpcyk7XG5cdCAgICB9XG5cdCAgICByZXR1cm4gY29tYmluZUxhdGVzdC5hcHBseSh0aGlzLCBhcmdzKTtcblx0ICB9O1xuXHRcblx0ICBmdW5jdGlvbiBmYWxzZUZhY3RvcnkoKSB7IHJldHVybiBmYWxzZTsgfVxuXHQgIGZ1bmN0aW9uIGFyZ3VtZW50c1RvQXJyYXkoKSB7XG5cdCAgICB2YXIgbGVuID0gYXJndW1lbnRzLmxlbmd0aCwgYXJncyA9IG5ldyBBcnJheShsZW4pO1xuXHQgICAgZm9yKHZhciBpID0gMDsgaSA8IGxlbjsgaSsrKSB7IGFyZ3NbaV0gPSBhcmd1bWVudHNbaV07IH1cblx0ICAgIHJldHVybiBhcmdzO1xuXHQgIH1cblx0XG5cdCAgdmFyIENvbWJpbmVMYXRlc3RPYnNlcnZhYmxlID0gKGZ1bmN0aW9uKF9fc3VwZXJfXykge1xuXHQgICAgaW5oZXJpdHMoQ29tYmluZUxhdGVzdE9ic2VydmFibGUsIF9fc3VwZXJfXyk7XG5cdCAgICBmdW5jdGlvbiBDb21iaW5lTGF0ZXN0T2JzZXJ2YWJsZShwYXJhbXMsIGNiKSB7XG5cdCAgICAgIHZhciBsZW4gPSBwYXJhbXMubGVuZ3RoO1xuXHQgICAgICB0aGlzLl9wYXJhbXMgPSBwYXJhbXM7XG5cdCAgICAgIHRoaXMuX2NiID0gY2I7XG5cdCAgICAgIHRoaXMuX2h2ID0gYXJyYXlJbml0aWFsaXplKGxlbiwgZmFsc2VGYWN0b3J5KTtcblx0ICAgICAgdGhpcy5faHZBbGwgPSBmYWxzZTtcblx0ICAgICAgdGhpcy5fZG9uZSA9IGFycmF5SW5pdGlhbGl6ZShsZW4sIGZhbHNlRmFjdG9yeSk7XG5cdCAgICAgIHRoaXMuX3YgPSBuZXcgQXJyYXkobGVuKTtcblx0ICAgICAgX19zdXBlcl9fLmNhbGwodGhpcyk7XG5cdCAgICB9XG5cdFxuXHQgICAgQ29tYmluZUxhdGVzdE9ic2VydmFibGUucHJvdG90eXBlLnN1YnNjcmliZUNvcmUgPSBmdW5jdGlvbihvYnNlcnZlcikge1xuXHQgICAgICB2YXIgbGVuID0gdGhpcy5fcGFyYW1zLmxlbmd0aCwgc3Vic2NyaXB0aW9ucyA9IG5ldyBBcnJheShsZW4pO1xuXHRcblx0ICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBsZW47IGkrKykge1xuXHQgICAgICAgIHZhciBzb3VyY2UgPSB0aGlzLl9wYXJhbXNbaV0sIHNhZCA9IG5ldyBTaW5nbGVBc3NpZ25tZW50RGlzcG9zYWJsZSgpO1xuXHQgICAgICAgIHN1YnNjcmlwdGlvbnNbaV0gPSBzYWQ7XG5cdCAgICAgICAgaXNQcm9taXNlKHNvdXJjZSkgJiYgKHNvdXJjZSA9IG9ic2VydmFibGVGcm9tUHJvbWlzZShzb3VyY2UpKTtcblx0ICAgICAgICBzYWQuc2V0RGlzcG9zYWJsZShzb3VyY2Uuc3Vic2NyaWJlKG5ldyBDb21iaW5lTGF0ZXN0T2JzZXJ2ZXIob2JzZXJ2ZXIsIGksIHRoaXMpKSk7XG5cdCAgICAgIH1cblx0XG5cdCAgICAgIHJldHVybiBuZXcgTkFyeURpc3Bvc2FibGUoc3Vic2NyaXB0aW9ucyk7XG5cdCAgICB9O1xuXHRcblx0ICAgIHJldHVybiBDb21iaW5lTGF0ZXN0T2JzZXJ2YWJsZTtcblx0ICB9KE9ic2VydmFibGVCYXNlKSk7XG5cdFxuXHQgIHZhciBDb21iaW5lTGF0ZXN0T2JzZXJ2ZXIgPSAoZnVuY3Rpb24gKF9fc3VwZXJfXykge1xuXHQgICAgaW5oZXJpdHMoQ29tYmluZUxhdGVzdE9ic2VydmVyLCBfX3N1cGVyX18pO1xuXHQgICAgZnVuY3Rpb24gQ29tYmluZUxhdGVzdE9ic2VydmVyKG8sIGksIHApIHtcblx0ICAgICAgdGhpcy5fbyA9IG87XG5cdCAgICAgIHRoaXMuX2kgPSBpO1xuXHQgICAgICB0aGlzLl9wID0gcDtcblx0ICAgICAgX19zdXBlcl9fLmNhbGwodGhpcyk7XG5cdCAgICB9XG5cdFxuXHQgICAgQ29tYmluZUxhdGVzdE9ic2VydmVyLnByb3RvdHlwZS5uZXh0ID0gZnVuY3Rpb24gKHgpIHtcblx0ICAgICAgdGhpcy5fcC5fdlt0aGlzLl9pXSA9IHg7XG5cdCAgICAgIHRoaXMuX3AuX2h2W3RoaXMuX2ldID0gdHJ1ZTtcblx0ICAgICAgaWYgKHRoaXMuX3AuX2h2QWxsIHx8ICh0aGlzLl9wLl9odkFsbCA9IHRoaXMuX3AuX2h2LmV2ZXJ5KGlkZW50aXR5KSkpIHtcblx0ICAgICAgICB2YXIgcmVzID0gdHJ5Q2F0Y2godGhpcy5fcC5fY2IpLmFwcGx5KG51bGwsIHRoaXMuX3AuX3YpO1xuXHQgICAgICAgIGlmIChyZXMgPT09IGVycm9yT2JqKSB7IHJldHVybiB0aGlzLl9vLm9uRXJyb3IocmVzLmUpOyB9XG5cdCAgICAgICAgdGhpcy5fby5vbk5leHQocmVzKTtcblx0ICAgICAgfSBlbHNlIGlmICh0aGlzLl9wLl9kb25lLmZpbHRlcihmdW5jdGlvbiAoeCwgaikgeyByZXR1cm4gaiAhPT0gdGhpcy5faTsgfSwgdGhpcykuZXZlcnkoaWRlbnRpdHkpKSB7XG5cdCAgICAgICAgdGhpcy5fby5vbkNvbXBsZXRlZCgpO1xuXHQgICAgICB9XG5cdCAgICB9O1xuXHRcblx0ICAgIENvbWJpbmVMYXRlc3RPYnNlcnZlci5wcm90b3R5cGUuZXJyb3IgPSBmdW5jdGlvbiAoZSkge1xuXHQgICAgICB0aGlzLl9vLm9uRXJyb3IoZSk7XG5cdCAgICB9O1xuXHRcblx0ICAgIENvbWJpbmVMYXRlc3RPYnNlcnZlci5wcm90b3R5cGUuY29tcGxldGVkID0gZnVuY3Rpb24gKCkge1xuXHQgICAgICB0aGlzLl9wLl9kb25lW3RoaXMuX2ldID0gdHJ1ZTtcblx0ICAgICAgdGhpcy5fcC5fZG9uZS5ldmVyeShpZGVudGl0eSkgJiYgdGhpcy5fby5vbkNvbXBsZXRlZCgpO1xuXHQgICAgfTtcblx0XG5cdCAgICByZXR1cm4gQ29tYmluZUxhdGVzdE9ic2VydmVyO1xuXHQgIH0oQWJzdHJhY3RPYnNlcnZlcikpO1xuXHRcblx0ICAvKipcblx0ICAqIE1lcmdlcyB0aGUgc3BlY2lmaWVkIG9ic2VydmFibGUgc2VxdWVuY2VzIGludG8gb25lIG9ic2VydmFibGUgc2VxdWVuY2UgYnkgdXNpbmcgdGhlIHNlbGVjdG9yIGZ1bmN0aW9uIHdoZW5ldmVyIGFueSBvZiB0aGUgb2JzZXJ2YWJsZSBzZXF1ZW5jZXMgb3IgUHJvbWlzZXMgcHJvZHVjZXMgYW4gZWxlbWVudC5cblx0ICAqXG5cdCAgKiBAZXhhbXBsZVxuXHQgICogMSAtIG9icyA9IFJ4Lk9ic2VydmFibGUuY29tYmluZUxhdGVzdChvYnMxLCBvYnMyLCBvYnMzLCBmdW5jdGlvbiAobzEsIG8yLCBvMykgeyByZXR1cm4gbzEgKyBvMiArIG8zOyB9KTtcblx0ICAqIDIgLSBvYnMgPSBSeC5PYnNlcnZhYmxlLmNvbWJpbmVMYXRlc3QoW29iczEsIG9iczIsIG9iczNdLCBmdW5jdGlvbiAobzEsIG8yLCBvMykgeyByZXR1cm4gbzEgKyBvMiArIG8zOyB9KTtcblx0ICAqIEByZXR1cm5zIHtPYnNlcnZhYmxlfSBBbiBvYnNlcnZhYmxlIHNlcXVlbmNlIGNvbnRhaW5pbmcgdGhlIHJlc3VsdCBvZiBjb21iaW5pbmcgZWxlbWVudHMgb2YgdGhlIHNvdXJjZXMgdXNpbmcgdGhlIHNwZWNpZmllZCByZXN1bHQgc2VsZWN0b3IgZnVuY3Rpb24uXG5cdCAgKi9cblx0ICB2YXIgY29tYmluZUxhdGVzdCA9IE9ic2VydmFibGUuY29tYmluZUxhdGVzdCA9IGZ1bmN0aW9uICgpIHtcblx0ICAgIHZhciBsZW4gPSBhcmd1bWVudHMubGVuZ3RoLCBhcmdzID0gbmV3IEFycmF5KGxlbik7XG5cdCAgICBmb3IodmFyIGkgPSAwOyBpIDwgbGVuOyBpKyspIHsgYXJnc1tpXSA9IGFyZ3VtZW50c1tpXTsgfVxuXHQgICAgdmFyIHJlc3VsdFNlbGVjdG9yID0gaXNGdW5jdGlvbihhcmdzW2xlbiAtIDFdKSA/IGFyZ3MucG9wKCkgOiBhcmd1bWVudHNUb0FycmF5O1xuXHQgICAgQXJyYXkuaXNBcnJheShhcmdzWzBdKSAmJiAoYXJncyA9IGFyZ3NbMF0pO1xuXHQgICAgcmV0dXJuIG5ldyBDb21iaW5lTGF0ZXN0T2JzZXJ2YWJsZShhcmdzLCByZXN1bHRTZWxlY3Rvcik7XG5cdCAgfTtcblx0XG5cdCAgLyoqXG5cdCAgICogQ29uY2F0ZW5hdGVzIGFsbCB0aGUgb2JzZXJ2YWJsZSBzZXF1ZW5jZXMuICBUaGlzIHRha2VzIGluIGVpdGhlciBhbiBhcnJheSBvciB2YXJpYWJsZSBhcmd1bWVudHMgdG8gY29uY2F0ZW5hdGUuXG5cdCAgICogQHJldHVybnMge09ic2VydmFibGV9IEFuIG9ic2VydmFibGUgc2VxdWVuY2UgdGhhdCBjb250YWlucyB0aGUgZWxlbWVudHMgb2YgZWFjaCBnaXZlbiBzZXF1ZW5jZSwgaW4gc2VxdWVudGlhbCBvcmRlci5cblx0ICAgKi9cblx0ICBvYnNlcnZhYmxlUHJvdG8uY29uY2F0ID0gZnVuY3Rpb24gKCkge1xuXHQgICAgZm9yKHZhciBhcmdzID0gW10sIGkgPSAwLCBsZW4gPSBhcmd1bWVudHMubGVuZ3RoOyBpIDwgbGVuOyBpKyspIHsgYXJncy5wdXNoKGFyZ3VtZW50c1tpXSk7IH1cblx0ICAgIGFyZ3MudW5zaGlmdCh0aGlzKTtcblx0ICAgIHJldHVybiBvYnNlcnZhYmxlQ29uY2F0LmFwcGx5KG51bGwsIGFyZ3MpO1xuXHQgIH07XG5cdFxuXHQgIHZhciBDb25jYXRPYnNlcnZhYmxlID0gKGZ1bmN0aW9uKF9fc3VwZXJfXykge1xuXHQgICAgaW5oZXJpdHMoQ29uY2F0T2JzZXJ2YWJsZSwgX19zdXBlcl9fKTtcblx0ICAgIGZ1bmN0aW9uIENvbmNhdE9ic2VydmFibGUoc291cmNlcykge1xuXHQgICAgICB0aGlzLnNvdXJjZXMgPSBzb3VyY2VzO1xuXHQgICAgICBfX3N1cGVyX18uY2FsbCh0aGlzKTtcblx0ICAgIH1cblx0XG5cdCAgICBDb25jYXRPYnNlcnZhYmxlLnByb3RvdHlwZS5zdWJzY3JpYmVDb3JlID0gZnVuY3Rpb24obykge1xuXHQgICAgICB2YXIgc2luayA9IG5ldyBDb25jYXRTaW5rKHRoaXMuc291cmNlcywgbyk7XG5cdCAgICAgIHJldHVybiBzaW5rLnJ1bigpO1xuXHQgICAgfTtcblx0XG5cdCAgICBmdW5jdGlvbiBDb25jYXRTaW5rKHNvdXJjZXMsIG8pIHtcblx0ICAgICAgdGhpcy5zb3VyY2VzID0gc291cmNlcztcblx0ICAgICAgdGhpcy5vID0gbztcblx0ICAgIH1cblx0ICAgIENvbmNhdFNpbmsucHJvdG90eXBlLnJ1biA9IGZ1bmN0aW9uICgpIHtcblx0ICAgICAgdmFyIGlzRGlzcG9zZWQsIHN1YnNjcmlwdGlvbiA9IG5ldyBTZXJpYWxEaXNwb3NhYmxlKCksIHNvdXJjZXMgPSB0aGlzLnNvdXJjZXMsIGxlbmd0aCA9IHNvdXJjZXMubGVuZ3RoLCBvID0gdGhpcy5vO1xuXHQgICAgICB2YXIgY2FuY2VsYWJsZSA9IGltbWVkaWF0ZVNjaGVkdWxlci5zY2hlZHVsZVJlY3Vyc2l2ZSgwLCBmdW5jdGlvbiAoaSwgc2VsZikge1xuXHQgICAgICAgIGlmIChpc0Rpc3Bvc2VkKSB7IHJldHVybjsgfVxuXHQgICAgICAgIGlmIChpID09PSBsZW5ndGgpIHtcblx0ICAgICAgICAgIHJldHVybiBvLm9uQ29tcGxldGVkKCk7XG5cdCAgICAgICAgfVxuXHRcblx0ICAgICAgICAvLyBDaGVjayBpZiBwcm9taXNlXG5cdCAgICAgICAgdmFyIGN1cnJlbnRWYWx1ZSA9IHNvdXJjZXNbaV07XG5cdCAgICAgICAgaXNQcm9taXNlKGN1cnJlbnRWYWx1ZSkgJiYgKGN1cnJlbnRWYWx1ZSA9IG9ic2VydmFibGVGcm9tUHJvbWlzZShjdXJyZW50VmFsdWUpKTtcblx0XG5cdCAgICAgICAgdmFyIGQgPSBuZXcgU2luZ2xlQXNzaWdubWVudERpc3Bvc2FibGUoKTtcblx0ICAgICAgICBzdWJzY3JpcHRpb24uc2V0RGlzcG9zYWJsZShkKTtcblx0ICAgICAgICBkLnNldERpc3Bvc2FibGUoY3VycmVudFZhbHVlLnN1YnNjcmliZShcblx0ICAgICAgICAgIGZ1bmN0aW9uICh4KSB7IG8ub25OZXh0KHgpOyB9LFxuXHQgICAgICAgICAgZnVuY3Rpb24gKGUpIHsgby5vbkVycm9yKGUpOyB9LFxuXHQgICAgICAgICAgZnVuY3Rpb24gKCkgeyBzZWxmKGkgKyAxKTsgfVxuXHQgICAgICAgICkpO1xuXHQgICAgICB9KTtcblx0XG5cdCAgICAgIHJldHVybiBuZXcgQ29tcG9zaXRlRGlzcG9zYWJsZShzdWJzY3JpcHRpb24sIGNhbmNlbGFibGUsIGRpc3Bvc2FibGVDcmVhdGUoZnVuY3Rpb24gKCkge1xuXHQgICAgICAgIGlzRGlzcG9zZWQgPSB0cnVlO1xuXHQgICAgICB9KSk7XG5cdCAgICB9O1xuXHRcblx0XG5cdCAgICByZXR1cm4gQ29uY2F0T2JzZXJ2YWJsZTtcblx0ICB9KE9ic2VydmFibGVCYXNlKSk7XG5cdFxuXHQgIC8qKlxuXHQgICAqIENvbmNhdGVuYXRlcyBhbGwgdGhlIG9ic2VydmFibGUgc2VxdWVuY2VzLlxuXHQgICAqIEBwYXJhbSB7QXJyYXkgfCBBcmd1bWVudHN9IGFyZ3MgQXJndW1lbnRzIG9yIGFuIGFycmF5IHRvIGNvbmNhdCB0byB0aGUgb2JzZXJ2YWJsZSBzZXF1ZW5jZS5cblx0ICAgKiBAcmV0dXJucyB7T2JzZXJ2YWJsZX0gQW4gb2JzZXJ2YWJsZSBzZXF1ZW5jZSB0aGF0IGNvbnRhaW5zIHRoZSBlbGVtZW50cyBvZiBlYWNoIGdpdmVuIHNlcXVlbmNlLCBpbiBzZXF1ZW50aWFsIG9yZGVyLlxuXHQgICAqL1xuXHQgIHZhciBvYnNlcnZhYmxlQ29uY2F0ID0gT2JzZXJ2YWJsZS5jb25jYXQgPSBmdW5jdGlvbiAoKSB7XG5cdCAgICB2YXIgYXJncztcblx0ICAgIGlmIChBcnJheS5pc0FycmF5KGFyZ3VtZW50c1swXSkpIHtcblx0ICAgICAgYXJncyA9IGFyZ3VtZW50c1swXTtcblx0ICAgIH0gZWxzZSB7XG5cdCAgICAgIGFyZ3MgPSBuZXcgQXJyYXkoYXJndW1lbnRzLmxlbmd0aCk7XG5cdCAgICAgIGZvcih2YXIgaSA9IDAsIGxlbiA9IGFyZ3VtZW50cy5sZW5ndGg7IGkgPCBsZW47IGkrKykgeyBhcmdzW2ldID0gYXJndW1lbnRzW2ldOyB9XG5cdCAgICB9XG5cdCAgICByZXR1cm4gbmV3IENvbmNhdE9ic2VydmFibGUoYXJncyk7XG5cdCAgfTtcblx0XG5cdCAgLyoqXG5cdCAgICogQ29uY2F0ZW5hdGVzIGFuIG9ic2VydmFibGUgc2VxdWVuY2Ugb2Ygb2JzZXJ2YWJsZSBzZXF1ZW5jZXMuXG5cdCAgICogQHJldHVybnMge09ic2VydmFibGV9IEFuIG9ic2VydmFibGUgc2VxdWVuY2UgdGhhdCBjb250YWlucyB0aGUgZWxlbWVudHMgb2YgZWFjaCBvYnNlcnZlZCBpbm5lciBzZXF1ZW5jZSwgaW4gc2VxdWVudGlhbCBvcmRlci5cblx0ICAgKi9cblx0ICBvYnNlcnZhYmxlUHJvdG8uY29uY2F0QWxsID0gZnVuY3Rpb24gKCkge1xuXHQgICAgcmV0dXJuIHRoaXMubWVyZ2UoMSk7XG5cdCAgfTtcblx0XG5cdCAgdmFyIE1lcmdlT2JzZXJ2YWJsZSA9IChmdW5jdGlvbiAoX19zdXBlcl9fKSB7XG5cdCAgICBpbmhlcml0cyhNZXJnZU9ic2VydmFibGUsIF9fc3VwZXJfXyk7XG5cdFxuXHQgICAgZnVuY3Rpb24gTWVyZ2VPYnNlcnZhYmxlKHNvdXJjZSwgbWF4Q29uY3VycmVudCkge1xuXHQgICAgICB0aGlzLnNvdXJjZSA9IHNvdXJjZTtcblx0ICAgICAgdGhpcy5tYXhDb25jdXJyZW50ID0gbWF4Q29uY3VycmVudDtcblx0ICAgICAgX19zdXBlcl9fLmNhbGwodGhpcyk7XG5cdCAgICB9XG5cdFxuXHQgICAgTWVyZ2VPYnNlcnZhYmxlLnByb3RvdHlwZS5zdWJzY3JpYmVDb3JlID0gZnVuY3Rpb24ob2JzZXJ2ZXIpIHtcblx0ICAgICAgdmFyIGcgPSBuZXcgQ29tcG9zaXRlRGlzcG9zYWJsZSgpO1xuXHQgICAgICBnLmFkZCh0aGlzLnNvdXJjZS5zdWJzY3JpYmUobmV3IE1lcmdlT2JzZXJ2ZXIob2JzZXJ2ZXIsIHRoaXMubWF4Q29uY3VycmVudCwgZykpKTtcblx0ICAgICAgcmV0dXJuIGc7XG5cdCAgICB9O1xuXHRcblx0ICAgIHJldHVybiBNZXJnZU9ic2VydmFibGU7XG5cdFxuXHQgIH0oT2JzZXJ2YWJsZUJhc2UpKTtcblx0XG5cdCAgdmFyIE1lcmdlT2JzZXJ2ZXIgPSAoZnVuY3Rpb24gKCkge1xuXHQgICAgZnVuY3Rpb24gTWVyZ2VPYnNlcnZlcihvLCBtYXgsIGcpIHtcblx0ICAgICAgdGhpcy5vID0gbztcblx0ICAgICAgdGhpcy5tYXggPSBtYXg7XG5cdCAgICAgIHRoaXMuZyA9IGc7XG5cdCAgICAgIHRoaXMuZG9uZSA9IGZhbHNlO1xuXHQgICAgICB0aGlzLnEgPSBbXTtcblx0ICAgICAgdGhpcy5hY3RpdmVDb3VudCA9IDA7XG5cdCAgICAgIHRoaXMuaXNTdG9wcGVkID0gZmFsc2U7XG5cdCAgICB9XG5cdCAgICBNZXJnZU9ic2VydmVyLnByb3RvdHlwZS5oYW5kbGVTdWJzY3JpYmUgPSBmdW5jdGlvbiAoeHMpIHtcblx0ICAgICAgdmFyIHNhZCA9IG5ldyBTaW5nbGVBc3NpZ25tZW50RGlzcG9zYWJsZSgpO1xuXHQgICAgICB0aGlzLmcuYWRkKHNhZCk7XG5cdCAgICAgIGlzUHJvbWlzZSh4cykgJiYgKHhzID0gb2JzZXJ2YWJsZUZyb21Qcm9taXNlKHhzKSk7XG5cdCAgICAgIHNhZC5zZXREaXNwb3NhYmxlKHhzLnN1YnNjcmliZShuZXcgSW5uZXJPYnNlcnZlcih0aGlzLCBzYWQpKSk7XG5cdCAgICB9O1xuXHQgICAgTWVyZ2VPYnNlcnZlci5wcm90b3R5cGUub25OZXh0ID0gZnVuY3Rpb24gKGlubmVyU291cmNlKSB7XG5cdCAgICAgIGlmICh0aGlzLmlzU3RvcHBlZCkgeyByZXR1cm47IH1cblx0ICAgICAgICBpZih0aGlzLmFjdGl2ZUNvdW50IDwgdGhpcy5tYXgpIHtcblx0ICAgICAgICAgIHRoaXMuYWN0aXZlQ291bnQrKztcblx0ICAgICAgICAgIHRoaXMuaGFuZGxlU3Vic2NyaWJlKGlubmVyU291cmNlKTtcblx0ICAgICAgICB9IGVsc2Uge1xuXHQgICAgICAgICAgdGhpcy5xLnB1c2goaW5uZXJTb3VyY2UpO1xuXHQgICAgICAgIH1cblx0ICAgICAgfTtcblx0ICAgICAgTWVyZ2VPYnNlcnZlci5wcm90b3R5cGUub25FcnJvciA9IGZ1bmN0aW9uIChlKSB7XG5cdCAgICAgICAgaWYgKCF0aGlzLmlzU3RvcHBlZCkge1xuXHQgICAgICAgICAgdGhpcy5pc1N0b3BwZWQgPSB0cnVlO1xuXHQgICAgICAgICAgdGhpcy5vLm9uRXJyb3IoZSk7XG5cdCAgICAgICAgfVxuXHQgICAgICB9O1xuXHQgICAgICBNZXJnZU9ic2VydmVyLnByb3RvdHlwZS5vbkNvbXBsZXRlZCA9IGZ1bmN0aW9uICgpIHtcblx0ICAgICAgICBpZiAoIXRoaXMuaXNTdG9wcGVkKSB7XG5cdCAgICAgICAgICB0aGlzLmlzU3RvcHBlZCA9IHRydWU7XG5cdCAgICAgICAgICB0aGlzLmRvbmUgPSB0cnVlO1xuXHQgICAgICAgICAgdGhpcy5hY3RpdmVDb3VudCA9PT0gMCAmJiB0aGlzLm8ub25Db21wbGV0ZWQoKTtcblx0ICAgICAgICB9XG5cdCAgICAgIH07XG5cdCAgICAgIE1lcmdlT2JzZXJ2ZXIucHJvdG90eXBlLmRpc3Bvc2UgPSBmdW5jdGlvbigpIHsgdGhpcy5pc1N0b3BwZWQgPSB0cnVlOyB9O1xuXHQgICAgICBNZXJnZU9ic2VydmVyLnByb3RvdHlwZS5mYWlsID0gZnVuY3Rpb24gKGUpIHtcblx0ICAgICAgICBpZiAoIXRoaXMuaXNTdG9wcGVkKSB7XG5cdCAgICAgICAgICB0aGlzLmlzU3RvcHBlZCA9IHRydWU7XG5cdCAgICAgICAgICB0aGlzLm8ub25FcnJvcihlKTtcblx0ICAgICAgICAgIHJldHVybiB0cnVlO1xuXHQgICAgICAgIH1cblx0XG5cdCAgICAgICAgcmV0dXJuIGZhbHNlO1xuXHQgICAgICB9O1xuXHRcblx0ICAgICAgZnVuY3Rpb24gSW5uZXJPYnNlcnZlcihwYXJlbnQsIHNhZCkge1xuXHQgICAgICAgIHRoaXMucGFyZW50ID0gcGFyZW50O1xuXHQgICAgICAgIHRoaXMuc2FkID0gc2FkO1xuXHQgICAgICAgIHRoaXMuaXNTdG9wcGVkID0gZmFsc2U7XG5cdCAgICAgIH1cblx0ICAgICAgSW5uZXJPYnNlcnZlci5wcm90b3R5cGUub25OZXh0ID0gZnVuY3Rpb24gKHgpIHsgaWYoIXRoaXMuaXNTdG9wcGVkKSB7IHRoaXMucGFyZW50Lm8ub25OZXh0KHgpOyB9IH07XG5cdCAgICAgIElubmVyT2JzZXJ2ZXIucHJvdG90eXBlLm9uRXJyb3IgPSBmdW5jdGlvbiAoZSkge1xuXHQgICAgICAgIGlmICghdGhpcy5pc1N0b3BwZWQpIHtcblx0ICAgICAgICAgIHRoaXMuaXNTdG9wcGVkID0gdHJ1ZTtcblx0ICAgICAgICAgIHRoaXMucGFyZW50Lm8ub25FcnJvcihlKTtcblx0ICAgICAgICB9XG5cdCAgICAgIH07XG5cdCAgICAgIElubmVyT2JzZXJ2ZXIucHJvdG90eXBlLm9uQ29tcGxldGVkID0gZnVuY3Rpb24gKCkge1xuXHQgICAgICAgIGlmKCF0aGlzLmlzU3RvcHBlZCkge1xuXHQgICAgICAgICAgdGhpcy5pc1N0b3BwZWQgPSB0cnVlO1xuXHQgICAgICAgICAgdmFyIHBhcmVudCA9IHRoaXMucGFyZW50O1xuXHQgICAgICAgICAgcGFyZW50LmcucmVtb3ZlKHRoaXMuc2FkKTtcblx0ICAgICAgICAgIGlmIChwYXJlbnQucS5sZW5ndGggPiAwKSB7XG5cdCAgICAgICAgICAgIHBhcmVudC5oYW5kbGVTdWJzY3JpYmUocGFyZW50LnEuc2hpZnQoKSk7XG5cdCAgICAgICAgICB9IGVsc2Uge1xuXHQgICAgICAgICAgICBwYXJlbnQuYWN0aXZlQ291bnQtLTtcblx0ICAgICAgICAgICAgcGFyZW50LmRvbmUgJiYgcGFyZW50LmFjdGl2ZUNvdW50ID09PSAwICYmIHBhcmVudC5vLm9uQ29tcGxldGVkKCk7XG5cdCAgICAgICAgICB9XG5cdCAgICAgICAgfVxuXHQgICAgICB9O1xuXHQgICAgICBJbm5lck9ic2VydmVyLnByb3RvdHlwZS5kaXNwb3NlID0gZnVuY3Rpb24oKSB7IHRoaXMuaXNTdG9wcGVkID0gdHJ1ZTsgfTtcblx0ICAgICAgSW5uZXJPYnNlcnZlci5wcm90b3R5cGUuZmFpbCA9IGZ1bmN0aW9uIChlKSB7XG5cdCAgICAgICAgaWYgKCF0aGlzLmlzU3RvcHBlZCkge1xuXHQgICAgICAgICAgdGhpcy5pc1N0b3BwZWQgPSB0cnVlO1xuXHQgICAgICAgICAgdGhpcy5wYXJlbnQuby5vbkVycm9yKGUpO1xuXHQgICAgICAgICAgcmV0dXJuIHRydWU7XG5cdCAgICAgICAgfVxuXHRcblx0ICAgICAgICByZXR1cm4gZmFsc2U7XG5cdCAgICAgIH07XG5cdFxuXHQgICAgICByZXR1cm4gTWVyZ2VPYnNlcnZlcjtcblx0ICB9KCkpO1xuXHRcblx0XG5cdFxuXHRcblx0XG5cdCAgLyoqXG5cdCAgKiBNZXJnZXMgYW4gb2JzZXJ2YWJsZSBzZXF1ZW5jZSBvZiBvYnNlcnZhYmxlIHNlcXVlbmNlcyBpbnRvIGFuIG9ic2VydmFibGUgc2VxdWVuY2UsIGxpbWl0aW5nIHRoZSBudW1iZXIgb2YgY29uY3VycmVudCBzdWJzY3JpcHRpb25zIHRvIGlubmVyIHNlcXVlbmNlcy5cblx0ICAqIE9yIG1lcmdlcyB0d28gb2JzZXJ2YWJsZSBzZXF1ZW5jZXMgaW50byBhIHNpbmdsZSBvYnNlcnZhYmxlIHNlcXVlbmNlLlxuXHQgICpcblx0ICAqIEBleGFtcGxlXG5cdCAgKiAxIC0gbWVyZ2VkID0gc291cmNlcy5tZXJnZSgxKTtcblx0ICAqIDIgLSBtZXJnZWQgPSBzb3VyY2UubWVyZ2Uob3RoZXJTb3VyY2UpO1xuXHQgICogQHBhcmFtIHtNaXhlZH0gW21heENvbmN1cnJlbnRPck90aGVyXSBNYXhpbXVtIG51bWJlciBvZiBpbm5lciBvYnNlcnZhYmxlIHNlcXVlbmNlcyBiZWluZyBzdWJzY3JpYmVkIHRvIGNvbmN1cnJlbnRseSBvciB0aGUgc2Vjb25kIG9ic2VydmFibGUgc2VxdWVuY2UuXG5cdCAgKiBAcmV0dXJucyB7T2JzZXJ2YWJsZX0gVGhlIG9ic2VydmFibGUgc2VxdWVuY2UgdGhhdCBtZXJnZXMgdGhlIGVsZW1lbnRzIG9mIHRoZSBpbm5lciBzZXF1ZW5jZXMuXG5cdCAgKi9cblx0ICBvYnNlcnZhYmxlUHJvdG8ubWVyZ2UgPSBmdW5jdGlvbiAobWF4Q29uY3VycmVudE9yT3RoZXIpIHtcblx0ICAgIHJldHVybiB0eXBlb2YgbWF4Q29uY3VycmVudE9yT3RoZXIgIT09ICdudW1iZXInID9cblx0ICAgICAgb2JzZXJ2YWJsZU1lcmdlKHRoaXMsIG1heENvbmN1cnJlbnRPck90aGVyKSA6XG5cdCAgICAgIG5ldyBNZXJnZU9ic2VydmFibGUodGhpcywgbWF4Q29uY3VycmVudE9yT3RoZXIpO1xuXHQgIH07XG5cdFxuXHQgIC8qKlxuXHQgICAqIE1lcmdlcyBhbGwgdGhlIG9ic2VydmFibGUgc2VxdWVuY2VzIGludG8gYSBzaW5nbGUgb2JzZXJ2YWJsZSBzZXF1ZW5jZS5cblx0ICAgKiBUaGUgc2NoZWR1bGVyIGlzIG9wdGlvbmFsIGFuZCBpZiBub3Qgc3BlY2lmaWVkLCB0aGUgaW1tZWRpYXRlIHNjaGVkdWxlciBpcyB1c2VkLlxuXHQgICAqIEByZXR1cm5zIHtPYnNlcnZhYmxlfSBUaGUgb2JzZXJ2YWJsZSBzZXF1ZW5jZSB0aGF0IG1lcmdlcyB0aGUgZWxlbWVudHMgb2YgdGhlIG9ic2VydmFibGUgc2VxdWVuY2VzLlxuXHQgICAqL1xuXHQgIHZhciBvYnNlcnZhYmxlTWVyZ2UgPSBPYnNlcnZhYmxlLm1lcmdlID0gZnVuY3Rpb24gKCkge1xuXHQgICAgdmFyIHNjaGVkdWxlciwgc291cmNlcyA9IFtdLCBpLCBsZW4gPSBhcmd1bWVudHMubGVuZ3RoO1xuXHQgICAgaWYgKCFhcmd1bWVudHNbMF0pIHtcblx0ICAgICAgc2NoZWR1bGVyID0gaW1tZWRpYXRlU2NoZWR1bGVyO1xuXHQgICAgICBmb3IoaSA9IDE7IGkgPCBsZW47IGkrKykgeyBzb3VyY2VzLnB1c2goYXJndW1lbnRzW2ldKTsgfVxuXHQgICAgfSBlbHNlIGlmIChpc1NjaGVkdWxlcihhcmd1bWVudHNbMF0pKSB7XG5cdCAgICAgIHNjaGVkdWxlciA9IGFyZ3VtZW50c1swXTtcblx0ICAgICAgZm9yKGkgPSAxOyBpIDwgbGVuOyBpKyspIHsgc291cmNlcy5wdXNoKGFyZ3VtZW50c1tpXSk7IH1cblx0ICAgIH0gZWxzZSB7XG5cdCAgICAgIHNjaGVkdWxlciA9IGltbWVkaWF0ZVNjaGVkdWxlcjtcblx0ICAgICAgZm9yKGkgPSAwOyBpIDwgbGVuOyBpKyspIHsgc291cmNlcy5wdXNoKGFyZ3VtZW50c1tpXSk7IH1cblx0ICAgIH1cblx0ICAgIGlmIChBcnJheS5pc0FycmF5KHNvdXJjZXNbMF0pKSB7XG5cdCAgICAgIHNvdXJjZXMgPSBzb3VyY2VzWzBdO1xuXHQgICAgfVxuXHQgICAgcmV0dXJuIG9ic2VydmFibGVPZihzY2hlZHVsZXIsIHNvdXJjZXMpLm1lcmdlQWxsKCk7XG5cdCAgfTtcblx0XG5cdCAgdmFyIE1lcmdlQWxsT2JzZXJ2YWJsZSA9IChmdW5jdGlvbiAoX19zdXBlcl9fKSB7XG5cdCAgICBpbmhlcml0cyhNZXJnZUFsbE9ic2VydmFibGUsIF9fc3VwZXJfXyk7XG5cdFxuXHQgICAgZnVuY3Rpb24gTWVyZ2VBbGxPYnNlcnZhYmxlKHNvdXJjZSkge1xuXHQgICAgICB0aGlzLnNvdXJjZSA9IHNvdXJjZTtcblx0ICAgICAgX19zdXBlcl9fLmNhbGwodGhpcyk7XG5cdCAgICB9XG5cdFxuXHQgICAgTWVyZ2VBbGxPYnNlcnZhYmxlLnByb3RvdHlwZS5zdWJzY3JpYmVDb3JlID0gZnVuY3Rpb24gKG9ic2VydmVyKSB7XG5cdCAgICAgIHZhciBnID0gbmV3IENvbXBvc2l0ZURpc3Bvc2FibGUoKSwgbSA9IG5ldyBTaW5nbGVBc3NpZ25tZW50RGlzcG9zYWJsZSgpO1xuXHQgICAgICBnLmFkZChtKTtcblx0ICAgICAgbS5zZXREaXNwb3NhYmxlKHRoaXMuc291cmNlLnN1YnNjcmliZShuZXcgTWVyZ2VBbGxPYnNlcnZlcihvYnNlcnZlciwgZykpKTtcblx0ICAgICAgcmV0dXJuIGc7XG5cdCAgICB9O1xuXHRcblx0ICAgIGZ1bmN0aW9uIE1lcmdlQWxsT2JzZXJ2ZXIobywgZykge1xuXHQgICAgICB0aGlzLm8gPSBvO1xuXHQgICAgICB0aGlzLmcgPSBnO1xuXHQgICAgICB0aGlzLmlzU3RvcHBlZCA9IGZhbHNlO1xuXHQgICAgICB0aGlzLmRvbmUgPSBmYWxzZTtcblx0ICAgIH1cblx0ICAgIE1lcmdlQWxsT2JzZXJ2ZXIucHJvdG90eXBlLm9uTmV4dCA9IGZ1bmN0aW9uKGlubmVyU291cmNlKSB7XG5cdCAgICAgIGlmKHRoaXMuaXNTdG9wcGVkKSB7IHJldHVybjsgfVxuXHQgICAgICB2YXIgc2FkID0gbmV3IFNpbmdsZUFzc2lnbm1lbnREaXNwb3NhYmxlKCk7XG5cdCAgICAgIHRoaXMuZy5hZGQoc2FkKTtcblx0XG5cdCAgICAgIGlzUHJvbWlzZShpbm5lclNvdXJjZSkgJiYgKGlubmVyU291cmNlID0gb2JzZXJ2YWJsZUZyb21Qcm9taXNlKGlubmVyU291cmNlKSk7XG5cdFxuXHQgICAgICBzYWQuc2V0RGlzcG9zYWJsZShpbm5lclNvdXJjZS5zdWJzY3JpYmUobmV3IElubmVyT2JzZXJ2ZXIodGhpcywgc2FkKSkpO1xuXHQgICAgfTtcblx0ICAgIE1lcmdlQWxsT2JzZXJ2ZXIucHJvdG90eXBlLm9uRXJyb3IgPSBmdW5jdGlvbiAoZSkge1xuXHQgICAgICBpZighdGhpcy5pc1N0b3BwZWQpIHtcblx0ICAgICAgICB0aGlzLmlzU3RvcHBlZCA9IHRydWU7XG5cdCAgICAgICAgdGhpcy5vLm9uRXJyb3IoZSk7XG5cdCAgICAgIH1cblx0ICAgIH07XG5cdCAgICBNZXJnZUFsbE9ic2VydmVyLnByb3RvdHlwZS5vbkNvbXBsZXRlZCA9IGZ1bmN0aW9uICgpIHtcblx0ICAgICAgaWYoIXRoaXMuaXNTdG9wcGVkKSB7XG5cdCAgICAgICAgdGhpcy5pc1N0b3BwZWQgPSB0cnVlO1xuXHQgICAgICAgIHRoaXMuZG9uZSA9IHRydWU7XG5cdCAgICAgICAgdGhpcy5nLmxlbmd0aCA9PT0gMSAmJiB0aGlzLm8ub25Db21wbGV0ZWQoKTtcblx0ICAgICAgfVxuXHQgICAgfTtcblx0ICAgIE1lcmdlQWxsT2JzZXJ2ZXIucHJvdG90eXBlLmRpc3Bvc2UgPSBmdW5jdGlvbigpIHsgdGhpcy5pc1N0b3BwZWQgPSB0cnVlOyB9O1xuXHQgICAgTWVyZ2VBbGxPYnNlcnZlci5wcm90b3R5cGUuZmFpbCA9IGZ1bmN0aW9uIChlKSB7XG5cdCAgICAgIGlmICghdGhpcy5pc1N0b3BwZWQpIHtcblx0ICAgICAgICB0aGlzLmlzU3RvcHBlZCA9IHRydWU7XG5cdCAgICAgICAgdGhpcy5vLm9uRXJyb3IoZSk7XG5cdCAgICAgICAgcmV0dXJuIHRydWU7XG5cdCAgICAgIH1cblx0XG5cdCAgICAgIHJldHVybiBmYWxzZTtcblx0ICAgIH07XG5cdFxuXHQgICAgZnVuY3Rpb24gSW5uZXJPYnNlcnZlcihwYXJlbnQsIHNhZCkge1xuXHQgICAgICB0aGlzLnBhcmVudCA9IHBhcmVudDtcblx0ICAgICAgdGhpcy5zYWQgPSBzYWQ7XG5cdCAgICAgIHRoaXMuaXNTdG9wcGVkID0gZmFsc2U7XG5cdCAgICB9XG5cdCAgICBJbm5lck9ic2VydmVyLnByb3RvdHlwZS5vbk5leHQgPSBmdW5jdGlvbiAoeCkgeyBpZiAoIXRoaXMuaXNTdG9wcGVkKSB7IHRoaXMucGFyZW50Lm8ub25OZXh0KHgpOyB9IH07XG5cdCAgICBJbm5lck9ic2VydmVyLnByb3RvdHlwZS5vbkVycm9yID0gZnVuY3Rpb24gKGUpIHtcblx0ICAgICAgaWYoIXRoaXMuaXNTdG9wcGVkKSB7XG5cdCAgICAgICAgdGhpcy5pc1N0b3BwZWQgPSB0cnVlO1xuXHQgICAgICAgIHRoaXMucGFyZW50Lm8ub25FcnJvcihlKTtcblx0ICAgICAgfVxuXHQgICAgfTtcblx0ICAgIElubmVyT2JzZXJ2ZXIucHJvdG90eXBlLm9uQ29tcGxldGVkID0gZnVuY3Rpb24gKCkge1xuXHQgICAgICBpZighdGhpcy5pc1N0b3BwZWQpIHtcblx0ICAgICAgICB2YXIgcGFyZW50ID0gdGhpcy5wYXJlbnQ7XG5cdCAgICAgICAgdGhpcy5pc1N0b3BwZWQgPSB0cnVlO1xuXHQgICAgICAgIHBhcmVudC5nLnJlbW92ZSh0aGlzLnNhZCk7XG5cdCAgICAgICAgcGFyZW50LmRvbmUgJiYgcGFyZW50LmcubGVuZ3RoID09PSAxICYmIHBhcmVudC5vLm9uQ29tcGxldGVkKCk7XG5cdCAgICAgIH1cblx0ICAgIH07XG5cdCAgICBJbm5lck9ic2VydmVyLnByb3RvdHlwZS5kaXNwb3NlID0gZnVuY3Rpb24oKSB7IHRoaXMuaXNTdG9wcGVkID0gdHJ1ZTsgfTtcblx0ICAgIElubmVyT2JzZXJ2ZXIucHJvdG90eXBlLmZhaWwgPSBmdW5jdGlvbiAoZSkge1xuXHQgICAgICBpZiAoIXRoaXMuaXNTdG9wcGVkKSB7XG5cdCAgICAgICAgdGhpcy5pc1N0b3BwZWQgPSB0cnVlO1xuXHQgICAgICAgIHRoaXMucGFyZW50Lm8ub25FcnJvcihlKTtcblx0ICAgICAgICByZXR1cm4gdHJ1ZTtcblx0ICAgICAgfVxuXHRcblx0ICAgICAgcmV0dXJuIGZhbHNlO1xuXHQgICAgfTtcblx0XG5cdCAgICByZXR1cm4gTWVyZ2VBbGxPYnNlcnZhYmxlO1xuXHQgIH0oT2JzZXJ2YWJsZUJhc2UpKTtcblx0XG5cdCAgLyoqXG5cdCAgKiBNZXJnZXMgYW4gb2JzZXJ2YWJsZSBzZXF1ZW5jZSBvZiBvYnNlcnZhYmxlIHNlcXVlbmNlcyBpbnRvIGFuIG9ic2VydmFibGUgc2VxdWVuY2UuXG5cdCAgKiBAcmV0dXJucyB7T2JzZXJ2YWJsZX0gVGhlIG9ic2VydmFibGUgc2VxdWVuY2UgdGhhdCBtZXJnZXMgdGhlIGVsZW1lbnRzIG9mIHRoZSBpbm5lciBzZXF1ZW5jZXMuXG5cdCAgKi9cblx0ICBvYnNlcnZhYmxlUHJvdG8ubWVyZ2VBbGwgPSBmdW5jdGlvbiAoKSB7XG5cdCAgICByZXR1cm4gbmV3IE1lcmdlQWxsT2JzZXJ2YWJsZSh0aGlzKTtcblx0ICB9O1xuXHRcblx0ICB2YXIgQ29tcG9zaXRlRXJyb3IgPSBSeC5Db21wb3NpdGVFcnJvciA9IGZ1bmN0aW9uKGVycm9ycykge1xuXHQgICAgdGhpcy5uYW1lID0gXCJOb3RJbXBsZW1lbnRlZEVycm9yXCI7XG5cdCAgICB0aGlzLmlubmVyRXJyb3JzID0gZXJyb3JzO1xuXHQgICAgdGhpcy5tZXNzYWdlID0gJ1RoaXMgY29udGFpbnMgbXVsdGlwbGUgZXJyb3JzLiBDaGVjayB0aGUgaW5uZXJFcnJvcnMnO1xuXHQgICAgRXJyb3IuY2FsbCh0aGlzKTtcblx0ICB9XG5cdCAgQ29tcG9zaXRlRXJyb3IucHJvdG90eXBlID0gRXJyb3IucHJvdG90eXBlO1xuXHRcblx0ICAvKipcblx0ICAqIEZsYXR0ZW5zIGFuIE9ic2VydmFibGUgdGhhdCBlbWl0cyBPYnNlcnZhYmxlcyBpbnRvIG9uZSBPYnNlcnZhYmxlLCBpbiBhIHdheSB0aGF0IGFsbG93cyBhbiBPYnNlcnZlciB0b1xuXHQgICogcmVjZWl2ZSBhbGwgc3VjY2Vzc2Z1bGx5IGVtaXR0ZWQgaXRlbXMgZnJvbSBhbGwgb2YgdGhlIHNvdXJjZSBPYnNlcnZhYmxlcyB3aXRob3V0IGJlaW5nIGludGVycnVwdGVkIGJ5XG5cdCAgKiBhbiBlcnJvciBub3RpZmljYXRpb24gZnJvbSBvbmUgb2YgdGhlbS5cblx0ICAqXG5cdCAgKiBUaGlzIGJlaGF2ZXMgbGlrZSBPYnNlcnZhYmxlLnByb3RvdHlwZS5tZXJnZUFsbCBleGNlcHQgdGhhdCBpZiBhbnkgb2YgdGhlIG1lcmdlZCBPYnNlcnZhYmxlcyBub3RpZnkgb2YgYW5cblx0ICAqIGVycm9yIHZpYSB0aGUgT2JzZXJ2ZXIncyBvbkVycm9yLCBtZXJnZURlbGF5RXJyb3Igd2lsbCByZWZyYWluIGZyb20gcHJvcGFnYXRpbmcgdGhhdFxuXHQgICogZXJyb3Igbm90aWZpY2F0aW9uIHVudGlsIGFsbCBvZiB0aGUgbWVyZ2VkIE9ic2VydmFibGVzIGhhdmUgZmluaXNoZWQgZW1pdHRpbmcgaXRlbXMuXG5cdCAgKiBAcGFyYW0ge0FycmF5IHwgQXJndW1lbnRzfSBhcmdzIEFyZ3VtZW50cyBvciBhbiBhcnJheSB0byBtZXJnZS5cblx0ICAqIEByZXR1cm5zIHtPYnNlcnZhYmxlfSBhbiBPYnNlcnZhYmxlIHRoYXQgZW1pdHMgYWxsIG9mIHRoZSBpdGVtcyBlbWl0dGVkIGJ5IHRoZSBPYnNlcnZhYmxlcyBlbWl0dGVkIGJ5IHRoZSBPYnNlcnZhYmxlXG5cdCAgKi9cblx0ICBPYnNlcnZhYmxlLm1lcmdlRGVsYXlFcnJvciA9IGZ1bmN0aW9uKCkge1xuXHQgICAgdmFyIGFyZ3M7XG5cdCAgICBpZiAoQXJyYXkuaXNBcnJheShhcmd1bWVudHNbMF0pKSB7XG5cdCAgICAgIGFyZ3MgPSBhcmd1bWVudHNbMF07XG5cdCAgICB9IGVsc2Uge1xuXHQgICAgICB2YXIgbGVuID0gYXJndW1lbnRzLmxlbmd0aDtcblx0ICAgICAgYXJncyA9IG5ldyBBcnJheShsZW4pO1xuXHQgICAgICBmb3IodmFyIGkgPSAwOyBpIDwgbGVuOyBpKyspIHsgYXJnc1tpXSA9IGFyZ3VtZW50c1tpXTsgfVxuXHQgICAgfVxuXHQgICAgdmFyIHNvdXJjZSA9IG9ic2VydmFibGVPZihudWxsLCBhcmdzKTtcblx0XG5cdCAgICByZXR1cm4gbmV3IEFub255bW91c09ic2VydmFibGUoZnVuY3Rpb24gKG8pIHtcblx0ICAgICAgdmFyIGdyb3VwID0gbmV3IENvbXBvc2l0ZURpc3Bvc2FibGUoKSxcblx0ICAgICAgICBtID0gbmV3IFNpbmdsZUFzc2lnbm1lbnREaXNwb3NhYmxlKCksXG5cdCAgICAgICAgaXNTdG9wcGVkID0gZmFsc2UsXG5cdCAgICAgICAgZXJyb3JzID0gW107XG5cdFxuXHQgICAgICBmdW5jdGlvbiBzZXRDb21wbGV0aW9uKCkge1xuXHQgICAgICAgIGlmIChlcnJvcnMubGVuZ3RoID09PSAwKSB7XG5cdCAgICAgICAgICBvLm9uQ29tcGxldGVkKCk7XG5cdCAgICAgICAgfSBlbHNlIGlmIChlcnJvcnMubGVuZ3RoID09PSAxKSB7XG5cdCAgICAgICAgICBvLm9uRXJyb3IoZXJyb3JzWzBdKTtcblx0ICAgICAgICB9IGVsc2Uge1xuXHQgICAgICAgICAgby5vbkVycm9yKG5ldyBDb21wb3NpdGVFcnJvcihlcnJvcnMpKTtcblx0ICAgICAgICB9XG5cdCAgICAgIH1cblx0XG5cdCAgICAgIGdyb3VwLmFkZChtKTtcblx0XG5cdCAgICAgIG0uc2V0RGlzcG9zYWJsZShzb3VyY2Uuc3Vic2NyaWJlKFxuXHQgICAgICAgIGZ1bmN0aW9uIChpbm5lclNvdXJjZSkge1xuXHQgICAgICAgICAgdmFyIGlubmVyU3Vic2NyaXB0aW9uID0gbmV3IFNpbmdsZUFzc2lnbm1lbnREaXNwb3NhYmxlKCk7XG5cdCAgICAgICAgICBncm91cC5hZGQoaW5uZXJTdWJzY3JpcHRpb24pO1xuXHRcblx0ICAgICAgICAgIC8vIENoZWNrIGZvciBwcm9taXNlcyBzdXBwb3J0XG5cdCAgICAgICAgICBpc1Byb21pc2UoaW5uZXJTb3VyY2UpICYmIChpbm5lclNvdXJjZSA9IG9ic2VydmFibGVGcm9tUHJvbWlzZShpbm5lclNvdXJjZSkpO1xuXHRcblx0ICAgICAgICAgIGlubmVyU3Vic2NyaXB0aW9uLnNldERpc3Bvc2FibGUoaW5uZXJTb3VyY2Uuc3Vic2NyaWJlKFxuXHQgICAgICAgICAgICBmdW5jdGlvbiAoeCkgeyBvLm9uTmV4dCh4KTsgfSxcblx0ICAgICAgICAgICAgZnVuY3Rpb24gKGUpIHtcblx0ICAgICAgICAgICAgICBlcnJvcnMucHVzaChlKTtcblx0ICAgICAgICAgICAgICBncm91cC5yZW1vdmUoaW5uZXJTdWJzY3JpcHRpb24pO1xuXHQgICAgICAgICAgICAgIGlzU3RvcHBlZCAmJiBncm91cC5sZW5ndGggPT09IDEgJiYgc2V0Q29tcGxldGlvbigpO1xuXHQgICAgICAgICAgICB9LFxuXHQgICAgICAgICAgICBmdW5jdGlvbiAoKSB7XG5cdCAgICAgICAgICAgICAgZ3JvdXAucmVtb3ZlKGlubmVyU3Vic2NyaXB0aW9uKTtcblx0ICAgICAgICAgICAgICBpc1N0b3BwZWQgJiYgZ3JvdXAubGVuZ3RoID09PSAxICYmIHNldENvbXBsZXRpb24oKTtcblx0ICAgICAgICAgIH0pKTtcblx0ICAgICAgICB9LFxuXHQgICAgICAgIGZ1bmN0aW9uIChlKSB7XG5cdCAgICAgICAgICBlcnJvcnMucHVzaChlKTtcblx0ICAgICAgICAgIGlzU3RvcHBlZCA9IHRydWU7XG5cdCAgICAgICAgICBncm91cC5sZW5ndGggPT09IDEgJiYgc2V0Q29tcGxldGlvbigpO1xuXHQgICAgICAgIH0sXG5cdCAgICAgICAgZnVuY3Rpb24gKCkge1xuXHQgICAgICAgICAgaXNTdG9wcGVkID0gdHJ1ZTtcblx0ICAgICAgICAgIGdyb3VwLmxlbmd0aCA9PT0gMSAmJiBzZXRDb21wbGV0aW9uKCk7XG5cdCAgICAgICAgfSkpO1xuXHQgICAgICByZXR1cm4gZ3JvdXA7XG5cdCAgICB9KTtcblx0ICB9O1xuXHRcblx0ICAvKipcblx0ICAgKiBDb250aW51ZXMgYW4gb2JzZXJ2YWJsZSBzZXF1ZW5jZSB0aGF0IGlzIHRlcm1pbmF0ZWQgbm9ybWFsbHkgb3IgYnkgYW4gZXhjZXB0aW9uIHdpdGggdGhlIG5leHQgb2JzZXJ2YWJsZSBzZXF1ZW5jZS5cblx0ICAgKiBAcGFyYW0ge09ic2VydmFibGV9IHNlY29uZCBTZWNvbmQgb2JzZXJ2YWJsZSBzZXF1ZW5jZSB1c2VkIHRvIHByb2R1Y2UgcmVzdWx0cyBhZnRlciB0aGUgZmlyc3Qgc2VxdWVuY2UgdGVybWluYXRlcy5cblx0ICAgKiBAcmV0dXJucyB7T2JzZXJ2YWJsZX0gQW4gb2JzZXJ2YWJsZSBzZXF1ZW5jZSB0aGF0IGNvbmNhdGVuYXRlcyB0aGUgZmlyc3QgYW5kIHNlY29uZCBzZXF1ZW5jZSwgZXZlbiBpZiB0aGUgZmlyc3Qgc2VxdWVuY2UgdGVybWluYXRlcyBleGNlcHRpb25hbGx5LlxuXHQgICAqL1xuXHQgIG9ic2VydmFibGVQcm90by5vbkVycm9yUmVzdW1lTmV4dCA9IGZ1bmN0aW9uIChzZWNvbmQpIHtcblx0ICAgIGlmICghc2Vjb25kKSB7IHRocm93IG5ldyBFcnJvcignU2Vjb25kIG9ic2VydmFibGUgaXMgcmVxdWlyZWQnKTsgfVxuXHQgICAgcmV0dXJuIG9uRXJyb3JSZXN1bWVOZXh0KFt0aGlzLCBzZWNvbmRdKTtcblx0ICB9O1xuXHRcblx0ICAvKipcblx0ICAgKiBDb250aW51ZXMgYW4gb2JzZXJ2YWJsZSBzZXF1ZW5jZSB0aGF0IGlzIHRlcm1pbmF0ZWQgbm9ybWFsbHkgb3IgYnkgYW4gZXhjZXB0aW9uIHdpdGggdGhlIG5leHQgb2JzZXJ2YWJsZSBzZXF1ZW5jZS5cblx0ICAgKlxuXHQgICAqIEBleGFtcGxlXG5cdCAgICogMSAtIHJlcyA9IFJ4Lk9ic2VydmFibGUub25FcnJvclJlc3VtZU5leHQoeHMsIHlzLCB6cyk7XG5cdCAgICogMSAtIHJlcyA9IFJ4Lk9ic2VydmFibGUub25FcnJvclJlc3VtZU5leHQoW3hzLCB5cywgenNdKTtcblx0ICAgKiBAcmV0dXJucyB7T2JzZXJ2YWJsZX0gQW4gb2JzZXJ2YWJsZSBzZXF1ZW5jZSB0aGF0IGNvbmNhdGVuYXRlcyB0aGUgc291cmNlIHNlcXVlbmNlcywgZXZlbiBpZiBhIHNlcXVlbmNlIHRlcm1pbmF0ZXMgZXhjZXB0aW9uYWxseS5cblx0ICAgKi9cblx0ICB2YXIgb25FcnJvclJlc3VtZU5leHQgPSBPYnNlcnZhYmxlLm9uRXJyb3JSZXN1bWVOZXh0ID0gZnVuY3Rpb24gKCkge1xuXHQgICAgdmFyIHNvdXJjZXMgPSBbXTtcblx0ICAgIGlmIChBcnJheS5pc0FycmF5KGFyZ3VtZW50c1swXSkpIHtcblx0ICAgICAgc291cmNlcyA9IGFyZ3VtZW50c1swXTtcblx0ICAgIH0gZWxzZSB7XG5cdCAgICAgIGZvcih2YXIgaSA9IDAsIGxlbiA9IGFyZ3VtZW50cy5sZW5ndGg7IGkgPCBsZW47IGkrKykgeyBzb3VyY2VzLnB1c2goYXJndW1lbnRzW2ldKTsgfVxuXHQgICAgfVxuXHQgICAgcmV0dXJuIG5ldyBBbm9ueW1vdXNPYnNlcnZhYmxlKGZ1bmN0aW9uIChvYnNlcnZlcikge1xuXHQgICAgICB2YXIgcG9zID0gMCwgc3Vic2NyaXB0aW9uID0gbmV3IFNlcmlhbERpc3Bvc2FibGUoKSxcblx0ICAgICAgY2FuY2VsYWJsZSA9IGltbWVkaWF0ZVNjaGVkdWxlci5zY2hlZHVsZVJlY3Vyc2l2ZShudWxsLCBmdW5jdGlvbiAoXywgc2VsZikge1xuXHQgICAgICAgIHZhciBjdXJyZW50LCBkO1xuXHQgICAgICAgIGlmIChwb3MgPCBzb3VyY2VzLmxlbmd0aCkge1xuXHQgICAgICAgICAgY3VycmVudCA9IHNvdXJjZXNbcG9zKytdO1xuXHQgICAgICAgICAgaXNQcm9taXNlKGN1cnJlbnQpICYmIChjdXJyZW50ID0gb2JzZXJ2YWJsZUZyb21Qcm9taXNlKGN1cnJlbnQpKTtcblx0ICAgICAgICAgIGQgPSBuZXcgU2luZ2xlQXNzaWdubWVudERpc3Bvc2FibGUoKTtcblx0ICAgICAgICAgIHN1YnNjcmlwdGlvbi5zZXREaXNwb3NhYmxlKGQpO1xuXHQgICAgICAgICAgZC5zZXREaXNwb3NhYmxlKGN1cnJlbnQuc3Vic2NyaWJlKG9ic2VydmVyLm9uTmV4dC5iaW5kKG9ic2VydmVyKSwgc2VsZiwgc2VsZikpO1xuXHQgICAgICAgIH0gZWxzZSB7XG5cdCAgICAgICAgICBvYnNlcnZlci5vbkNvbXBsZXRlZCgpO1xuXHQgICAgICAgIH1cblx0ICAgICAgfSk7XG5cdCAgICAgIHJldHVybiBuZXcgQmluYXJ5RGlzcG9zYWJsZShzdWJzY3JpcHRpb24sIGNhbmNlbGFibGUpO1xuXHQgICAgfSk7XG5cdCAgfTtcblx0XG5cdCAgdmFyIFNraXBVbnRpbE9ic2VydmFibGUgPSAoZnVuY3Rpb24oX19zdXBlcl9fKSB7XG5cdCAgICBpbmhlcml0cyhTa2lwVW50aWxPYnNlcnZhYmxlLCBfX3N1cGVyX18pO1xuXHRcblx0ICAgIGZ1bmN0aW9uIFNraXBVbnRpbE9ic2VydmFibGUoc291cmNlLCBvdGhlcikge1xuXHQgICAgICB0aGlzLl9zID0gc291cmNlO1xuXHQgICAgICB0aGlzLl9vID0gaXNQcm9taXNlKG90aGVyKSA/IG9ic2VydmFibGVGcm9tUHJvbWlzZShvdGhlcikgOiBvdGhlcjtcblx0ICAgICAgdGhpcy5fb3BlbiA9IGZhbHNlO1xuXHQgICAgICBfX3N1cGVyX18uY2FsbCh0aGlzKTtcblx0ICAgIH1cblx0XG5cdCAgICBTa2lwVW50aWxPYnNlcnZhYmxlLnByb3RvdHlwZS5zdWJzY3JpYmVDb3JlID0gZnVuY3Rpb24obykge1xuXHQgICAgICB2YXIgbGVmdFN1YnNjcmlwdGlvbiA9IG5ldyBTaW5nbGVBc3NpZ25tZW50RGlzcG9zYWJsZSgpO1xuXHQgICAgICBsZWZ0U3Vic2NyaXB0aW9uLnNldERpc3Bvc2FibGUodGhpcy5fcy5zdWJzY3JpYmUobmV3IFNraXBVbnRpbFNvdXJjZU9ic2VydmVyKG8sIHRoaXMpKSk7XG5cdFxuXHQgICAgICBpc1Byb21pc2UodGhpcy5fbykgJiYgKHRoaXMuX28gPSBvYnNlcnZhYmxlRnJvbVByb21pc2UodGhpcy5fbykpO1xuXHRcblx0ICAgICAgdmFyIHJpZ2h0U3Vic2NyaXB0aW9uID0gbmV3IFNpbmdsZUFzc2lnbm1lbnREaXNwb3NhYmxlKCk7XG5cdCAgICAgIHJpZ2h0U3Vic2NyaXB0aW9uLnNldERpc3Bvc2FibGUodGhpcy5fby5zdWJzY3JpYmUobmV3IFNraXBVbnRpbE90aGVyT2JzZXJ2ZXIobywgdGhpcywgcmlnaHRTdWJzY3JpcHRpb24pKSk7XG5cdFxuXHQgICAgICByZXR1cm4gbmV3IEJpbmFyeURpc3Bvc2FibGUobGVmdFN1YnNjcmlwdGlvbiwgcmlnaHRTdWJzY3JpcHRpb24pO1xuXHQgICAgfTtcblx0XG5cdCAgICByZXR1cm4gU2tpcFVudGlsT2JzZXJ2YWJsZTtcblx0ICB9KE9ic2VydmFibGVCYXNlKSk7XG5cdFxuXHQgIHZhciBTa2lwVW50aWxTb3VyY2VPYnNlcnZlciA9IChmdW5jdGlvbihfX3N1cGVyX18pIHtcblx0ICAgIGluaGVyaXRzKFNraXBVbnRpbFNvdXJjZU9ic2VydmVyLCBfX3N1cGVyX18pO1xuXHQgICAgZnVuY3Rpb24gU2tpcFVudGlsU291cmNlT2JzZXJ2ZXIobywgcCkge1xuXHQgICAgICB0aGlzLl9vID0gbztcblx0ICAgICAgdGhpcy5fcCA9IHA7XG5cdCAgICAgIF9fc3VwZXJfXy5jYWxsKHRoaXMpO1xuXHQgICAgfVxuXHRcblx0ICAgIFNraXBVbnRpbFNvdXJjZU9ic2VydmVyLnByb3RvdHlwZS5uZXh0ID0gZnVuY3Rpb24gKHgpIHtcblx0ICAgICAgdGhpcy5fcC5fb3BlbiAmJiB0aGlzLl9vLm9uTmV4dCh4KTtcblx0ICAgIH07XG5cdFxuXHQgICAgU2tpcFVudGlsU291cmNlT2JzZXJ2ZXIucHJvdG90eXBlLmVycm9yID0gZnVuY3Rpb24gKGVycikge1xuXHQgICAgICB0aGlzLl9vLm9uRXJyb3IoZXJyKTtcblx0ICAgIH07XG5cdFxuXHQgICAgU2tpcFVudGlsU291cmNlT2JzZXJ2ZXIucHJvdG90eXBlLm9uQ29tcGxldGVkID0gZnVuY3Rpb24gKCkge1xuXHQgICAgICB0aGlzLl9wLl9vcGVuICYmIHRoaXMuX28ub25Db21wbGV0ZWQoKTtcblx0ICAgIH07XG5cdFxuXHQgICAgcmV0dXJuIFNraXBVbnRpbFNvdXJjZU9ic2VydmVyO1xuXHQgIH0oQWJzdHJhY3RPYnNlcnZlcikpO1xuXHRcblx0ICB2YXIgU2tpcFVudGlsT3RoZXJPYnNlcnZlciA9IChmdW5jdGlvbihfX3N1cGVyX18pIHtcblx0ICAgIGluaGVyaXRzKFNraXBVbnRpbE90aGVyT2JzZXJ2ZXIsIF9fc3VwZXJfXyk7XG5cdCAgICBmdW5jdGlvbiBTa2lwVW50aWxPdGhlck9ic2VydmVyKG8sIHAsIHIpIHtcblx0ICAgICAgdGhpcy5fbyA9IG87XG5cdCAgICAgIHRoaXMuX3AgPSBwO1xuXHQgICAgICB0aGlzLl9yID0gcjtcblx0ICAgICAgX19zdXBlcl9fLmNhbGwodGhpcyk7XG5cdCAgICB9XG5cdFxuXHQgICAgU2tpcFVudGlsT3RoZXJPYnNlcnZlci5wcm90b3R5cGUubmV4dCA9IGZ1bmN0aW9uICgpIHtcblx0ICAgICAgdGhpcy5fcC5fb3BlbiA9IHRydWU7XG5cdCAgICAgIHRoaXMuX3IuZGlzcG9zZSgpO1xuXHQgICAgfTtcblx0XG5cdCAgICBTa2lwVW50aWxPdGhlck9ic2VydmVyLnByb3RvdHlwZS5lcnJvciA9IGZ1bmN0aW9uIChlcnIpIHtcblx0ICAgICAgdGhpcy5fby5vbkVycm9yKGVycik7XG5cdCAgICB9O1xuXHRcblx0ICAgIFNraXBVbnRpbE90aGVyT2JzZXJ2ZXIucHJvdG90eXBlLm9uQ29tcGxldGVkID0gZnVuY3Rpb24gKCkge1xuXHQgICAgICB0aGlzLl9yLmRpc3Bvc2UoKTtcblx0ICAgIH07XG5cdFxuXHQgICAgcmV0dXJuIFNraXBVbnRpbE90aGVyT2JzZXJ2ZXI7XG5cdCAgfShBYnN0cmFjdE9ic2VydmVyKSk7XG5cdFxuXHQgIC8qKlxuXHQgICAqIFJldHVybnMgdGhlIHZhbHVlcyBmcm9tIHRoZSBzb3VyY2Ugb2JzZXJ2YWJsZSBzZXF1ZW5jZSBvbmx5IGFmdGVyIHRoZSBvdGhlciBvYnNlcnZhYmxlIHNlcXVlbmNlIHByb2R1Y2VzIGEgdmFsdWUuXG5cdCAgICogQHBhcmFtIHtPYnNlcnZhYmxlIHwgUHJvbWlzZX0gb3RoZXIgVGhlIG9ic2VydmFibGUgc2VxdWVuY2Ugb3IgUHJvbWlzZSB0aGF0IHRyaWdnZXJzIHByb3BhZ2F0aW9uIG9mIGVsZW1lbnRzIG9mIHRoZSBzb3VyY2Ugc2VxdWVuY2UuXG5cdCAgICogQHJldHVybnMge09ic2VydmFibGV9IEFuIG9ic2VydmFibGUgc2VxdWVuY2UgY29udGFpbmluZyB0aGUgZWxlbWVudHMgb2YgdGhlIHNvdXJjZSBzZXF1ZW5jZSBzdGFydGluZyBmcm9tIHRoZSBwb2ludCB0aGUgb3RoZXIgc2VxdWVuY2UgdHJpZ2dlcmVkIHByb3BhZ2F0aW9uLlxuXHQgICAqL1xuXHQgIG9ic2VydmFibGVQcm90by5za2lwVW50aWwgPSBmdW5jdGlvbiAob3RoZXIpIHtcblx0ICAgIHJldHVybiBuZXcgU2tpcFVudGlsT2JzZXJ2YWJsZSh0aGlzLCBvdGhlcik7XG5cdCAgfTtcblx0XG5cdCAgdmFyIFN3aXRjaE9ic2VydmFibGUgPSAoZnVuY3Rpb24oX19zdXBlcl9fKSB7XG5cdCAgICBpbmhlcml0cyhTd2l0Y2hPYnNlcnZhYmxlLCBfX3N1cGVyX18pO1xuXHQgICAgZnVuY3Rpb24gU3dpdGNoT2JzZXJ2YWJsZShzb3VyY2UpIHtcblx0ICAgICAgdGhpcy5zb3VyY2UgPSBzb3VyY2U7XG5cdCAgICAgIF9fc3VwZXJfXy5jYWxsKHRoaXMpO1xuXHQgICAgfVxuXHRcblx0ICAgIFN3aXRjaE9ic2VydmFibGUucHJvdG90eXBlLnN1YnNjcmliZUNvcmUgPSBmdW5jdGlvbiAobykge1xuXHQgICAgICB2YXIgaW5uZXIgPSBuZXcgU2VyaWFsRGlzcG9zYWJsZSgpLCBzID0gdGhpcy5zb3VyY2Uuc3Vic2NyaWJlKG5ldyBTd2l0Y2hPYnNlcnZlcihvLCBpbm5lcikpO1xuXHQgICAgICByZXR1cm4gbmV3IEJpbmFyeURpc3Bvc2FibGUocywgaW5uZXIpO1xuXHQgICAgfTtcblx0XG5cdCAgICBpbmhlcml0cyhTd2l0Y2hPYnNlcnZlciwgQWJzdHJhY3RPYnNlcnZlcik7XG5cdCAgICBmdW5jdGlvbiBTd2l0Y2hPYnNlcnZlcihvLCBpbm5lcikge1xuXHQgICAgICB0aGlzLm8gPSBvO1xuXHQgICAgICB0aGlzLmlubmVyID0gaW5uZXI7XG5cdCAgICAgIHRoaXMuc3RvcHBlZCA9IGZhbHNlO1xuXHQgICAgICB0aGlzLmxhdGVzdCA9IDA7XG5cdCAgICAgIHRoaXMuaGFzTGF0ZXN0ID0gZmFsc2U7XG5cdCAgICAgIEFic3RyYWN0T2JzZXJ2ZXIuY2FsbCh0aGlzKTtcblx0ICAgIH1cblx0XG5cdCAgICBTd2l0Y2hPYnNlcnZlci5wcm90b3R5cGUubmV4dCA9IGZ1bmN0aW9uIChpbm5lclNvdXJjZSkge1xuXHQgICAgICB2YXIgZCA9IG5ldyBTaW5nbGVBc3NpZ25tZW50RGlzcG9zYWJsZSgpLCBpZCA9ICsrdGhpcy5sYXRlc3Q7XG5cdCAgICAgIHRoaXMuaGFzTGF0ZXN0ID0gdHJ1ZTtcblx0ICAgICAgdGhpcy5pbm5lci5zZXREaXNwb3NhYmxlKGQpO1xuXHQgICAgICBpc1Byb21pc2UoaW5uZXJTb3VyY2UpICYmIChpbm5lclNvdXJjZSA9IG9ic2VydmFibGVGcm9tUHJvbWlzZShpbm5lclNvdXJjZSkpO1xuXHQgICAgICBkLnNldERpc3Bvc2FibGUoaW5uZXJTb3VyY2Uuc3Vic2NyaWJlKG5ldyBJbm5lck9ic2VydmVyKHRoaXMsIGlkKSkpO1xuXHQgICAgfTtcblx0XG5cdCAgICBTd2l0Y2hPYnNlcnZlci5wcm90b3R5cGUuZXJyb3IgPSBmdW5jdGlvbiAoZSkge1xuXHQgICAgICB0aGlzLm8ub25FcnJvcihlKTtcblx0ICAgIH07XG5cdFxuXHQgICAgU3dpdGNoT2JzZXJ2ZXIucHJvdG90eXBlLmNvbXBsZXRlZCA9IGZ1bmN0aW9uICgpIHtcblx0ICAgICAgdGhpcy5zdG9wcGVkID0gdHJ1ZTtcblx0ICAgICAgIXRoaXMuaGFzTGF0ZXN0ICYmIHRoaXMuby5vbkNvbXBsZXRlZCgpO1xuXHQgICAgfTtcblx0XG5cdCAgICBpbmhlcml0cyhJbm5lck9ic2VydmVyLCBBYnN0cmFjdE9ic2VydmVyKTtcblx0ICAgIGZ1bmN0aW9uIElubmVyT2JzZXJ2ZXIocGFyZW50LCBpZCkge1xuXHQgICAgICB0aGlzLnBhcmVudCA9IHBhcmVudDtcblx0ICAgICAgdGhpcy5pZCA9IGlkO1xuXHQgICAgICBBYnN0cmFjdE9ic2VydmVyLmNhbGwodGhpcyk7XG5cdCAgICB9XG5cdCAgICBJbm5lck9ic2VydmVyLnByb3RvdHlwZS5uZXh0ID0gZnVuY3Rpb24gKHgpIHtcblx0ICAgICAgdGhpcy5wYXJlbnQubGF0ZXN0ID09PSB0aGlzLmlkICYmIHRoaXMucGFyZW50Lm8ub25OZXh0KHgpO1xuXHQgICAgfTtcblx0XG5cdCAgICBJbm5lck9ic2VydmVyLnByb3RvdHlwZS5lcnJvciA9IGZ1bmN0aW9uIChlKSB7XG5cdCAgICAgIHRoaXMucGFyZW50LmxhdGVzdCA9PT0gdGhpcy5pZCAmJiB0aGlzLnBhcmVudC5vLm9uRXJyb3IoZSk7XG5cdCAgICB9O1xuXHRcblx0ICAgIElubmVyT2JzZXJ2ZXIucHJvdG90eXBlLmNvbXBsZXRlZCA9IGZ1bmN0aW9uICgpIHtcblx0ICAgICAgaWYgKHRoaXMucGFyZW50LmxhdGVzdCA9PT0gdGhpcy5pZCkge1xuXHQgICAgICAgIHRoaXMucGFyZW50Lmhhc0xhdGVzdCA9IGZhbHNlO1xuXHQgICAgICAgIHRoaXMucGFyZW50LmlzU3RvcHBlZCAmJiB0aGlzLnBhcmVudC5vLm9uQ29tcGxldGVkKCk7XG5cdCAgICAgIH1cblx0ICAgIH07XG5cdFxuXHQgICAgcmV0dXJuIFN3aXRjaE9ic2VydmFibGU7XG5cdCAgfShPYnNlcnZhYmxlQmFzZSkpO1xuXHRcblx0ICAvKipcblx0ICAqIFRyYW5zZm9ybXMgYW4gb2JzZXJ2YWJsZSBzZXF1ZW5jZSBvZiBvYnNlcnZhYmxlIHNlcXVlbmNlcyBpbnRvIGFuIG9ic2VydmFibGUgc2VxdWVuY2UgcHJvZHVjaW5nIHZhbHVlcyBvbmx5IGZyb20gdGhlIG1vc3QgcmVjZW50IG9ic2VydmFibGUgc2VxdWVuY2UuXG5cdCAgKiBAcmV0dXJucyB7T2JzZXJ2YWJsZX0gVGhlIG9ic2VydmFibGUgc2VxdWVuY2UgdGhhdCBhdCBhbnkgcG9pbnQgaW4gdGltZSBwcm9kdWNlcyB0aGUgZWxlbWVudHMgb2YgdGhlIG1vc3QgcmVjZW50IGlubmVyIG9ic2VydmFibGUgc2VxdWVuY2UgdGhhdCBoYXMgYmVlbiByZWNlaXZlZC5cblx0ICAqL1xuXHQgIG9ic2VydmFibGVQcm90b1snc3dpdGNoJ10gPSBvYnNlcnZhYmxlUHJvdG8uc3dpdGNoTGF0ZXN0ID0gZnVuY3Rpb24gKCkge1xuXHQgICAgcmV0dXJuIG5ldyBTd2l0Y2hPYnNlcnZhYmxlKHRoaXMpO1xuXHQgIH07XG5cdFxuXHQgIHZhciBUYWtlVW50aWxPYnNlcnZhYmxlID0gKGZ1bmN0aW9uKF9fc3VwZXJfXykge1xuXHQgICAgaW5oZXJpdHMoVGFrZVVudGlsT2JzZXJ2YWJsZSwgX19zdXBlcl9fKTtcblx0XG5cdCAgICBmdW5jdGlvbiBUYWtlVW50aWxPYnNlcnZhYmxlKHNvdXJjZSwgb3RoZXIpIHtcblx0ICAgICAgdGhpcy5zb3VyY2UgPSBzb3VyY2U7XG5cdCAgICAgIHRoaXMub3RoZXIgPSBpc1Byb21pc2Uob3RoZXIpID8gb2JzZXJ2YWJsZUZyb21Qcm9taXNlKG90aGVyKSA6IG90aGVyO1xuXHQgICAgICBfX3N1cGVyX18uY2FsbCh0aGlzKTtcblx0ICAgIH1cblx0XG5cdCAgICBUYWtlVW50aWxPYnNlcnZhYmxlLnByb3RvdHlwZS5zdWJzY3JpYmVDb3JlID0gZnVuY3Rpb24obykge1xuXHQgICAgICByZXR1cm4gbmV3IEJpbmFyeURpc3Bvc2FibGUoXG5cdCAgICAgICAgdGhpcy5zb3VyY2Uuc3Vic2NyaWJlKG8pLFxuXHQgICAgICAgIHRoaXMub3RoZXIuc3Vic2NyaWJlKG5ldyBUYWtlVW50aWxPYnNlcnZlcihvKSlcblx0ICAgICAgKTtcblx0ICAgIH07XG5cdFxuXHQgICAgcmV0dXJuIFRha2VVbnRpbE9ic2VydmFibGU7XG5cdCAgfShPYnNlcnZhYmxlQmFzZSkpO1xuXHRcblx0ICB2YXIgVGFrZVVudGlsT2JzZXJ2ZXIgPSAoZnVuY3Rpb24oX19zdXBlcl9fKSB7XG5cdCAgICBpbmhlcml0cyhUYWtlVW50aWxPYnNlcnZlciwgX19zdXBlcl9fKTtcblx0ICAgIGZ1bmN0aW9uIFRha2VVbnRpbE9ic2VydmVyKG8pIHtcblx0ICAgICAgdGhpcy5fbyA9IG87XG5cdCAgICAgIF9fc3VwZXJfXy5jYWxsKHRoaXMpO1xuXHQgICAgfVxuXHRcblx0ICAgIFRha2VVbnRpbE9ic2VydmVyLnByb3RvdHlwZS5uZXh0ID0gZnVuY3Rpb24gKCkge1xuXHQgICAgICB0aGlzLl9vLm9uQ29tcGxldGVkKCk7XG5cdCAgICB9O1xuXHRcblx0ICAgIFRha2VVbnRpbE9ic2VydmVyLnByb3RvdHlwZS5lcnJvciA9IGZ1bmN0aW9uIChlcnIpIHtcblx0ICAgICAgdGhpcy5fby5vbkVycm9yKGVycik7XG5cdCAgICB9O1xuXHRcblx0ICAgIFRha2VVbnRpbE9ic2VydmVyLnByb3RvdHlwZS5vbkNvbXBsZXRlZCA9IG5vb3A7XG5cdFxuXHQgICAgcmV0dXJuIFRha2VVbnRpbE9ic2VydmVyO1xuXHQgIH0oQWJzdHJhY3RPYnNlcnZlcikpO1xuXHRcblx0ICAvKipcblx0ICAgKiBSZXR1cm5zIHRoZSB2YWx1ZXMgZnJvbSB0aGUgc291cmNlIG9ic2VydmFibGUgc2VxdWVuY2UgdW50aWwgdGhlIG90aGVyIG9ic2VydmFibGUgc2VxdWVuY2UgcHJvZHVjZXMgYSB2YWx1ZS5cblx0ICAgKiBAcGFyYW0ge09ic2VydmFibGUgfCBQcm9taXNlfSBvdGhlciBPYnNlcnZhYmxlIHNlcXVlbmNlIG9yIFByb21pc2UgdGhhdCB0ZXJtaW5hdGVzIHByb3BhZ2F0aW9uIG9mIGVsZW1lbnRzIG9mIHRoZSBzb3VyY2Ugc2VxdWVuY2UuXG5cdCAgICogQHJldHVybnMge09ic2VydmFibGV9IEFuIG9ic2VydmFibGUgc2VxdWVuY2UgY29udGFpbmluZyB0aGUgZWxlbWVudHMgb2YgdGhlIHNvdXJjZSBzZXF1ZW5jZSB1cCB0byB0aGUgcG9pbnQgdGhlIG90aGVyIHNlcXVlbmNlIGludGVycnVwdGVkIGZ1cnRoZXIgcHJvcGFnYXRpb24uXG5cdCAgICovXG5cdCAgb2JzZXJ2YWJsZVByb3RvLnRha2VVbnRpbCA9IGZ1bmN0aW9uIChvdGhlcikge1xuXHQgICAgcmV0dXJuIG5ldyBUYWtlVW50aWxPYnNlcnZhYmxlKHRoaXMsIG90aGVyKTtcblx0ICB9O1xuXHRcblx0ICBmdW5jdGlvbiBmYWxzZUZhY3RvcnkoKSB7IHJldHVybiBmYWxzZTsgfVxuXHQgIGZ1bmN0aW9uIGFyZ3VtZW50c1RvQXJyYXkoKSB7XG5cdCAgICB2YXIgbGVuID0gYXJndW1lbnRzLmxlbmd0aCwgYXJncyA9IG5ldyBBcnJheShsZW4pO1xuXHQgICAgZm9yKHZhciBpID0gMDsgaSA8IGxlbjsgaSsrKSB7IGFyZ3NbaV0gPSBhcmd1bWVudHNbaV07IH1cblx0ICAgIHJldHVybiBhcmdzO1xuXHQgIH1cblx0XG5cdCAgdmFyIFdpdGhMYXRlc3RGcm9tT2JzZXJ2YWJsZSA9IChmdW5jdGlvbihfX3N1cGVyX18pIHtcblx0ICAgIGluaGVyaXRzKFdpdGhMYXRlc3RGcm9tT2JzZXJ2YWJsZSwgX19zdXBlcl9fKTtcblx0ICAgIGZ1bmN0aW9uIFdpdGhMYXRlc3RGcm9tT2JzZXJ2YWJsZShzb3VyY2UsIHNvdXJjZXMsIHJlc3VsdFNlbGVjdG9yKSB7XG5cdCAgICAgIHZhciBsZW4gPSBzb3VyY2VzLmxlbmd0aDtcblx0ICAgICAgdGhpcy5fcyA9IHNvdXJjZTtcblx0ICAgICAgdGhpcy5fc3MgPSBzb3VyY2VzO1xuXHQgICAgICB0aGlzLl9jYiA9IHJlc3VsdFNlbGVjdG9yO1xuXHQgICAgICB0aGlzLl9odiA9IGFycmF5SW5pdGlhbGl6ZShsZW4sIGZhbHNlRmFjdG9yeSk7XG5cdCAgICAgIHRoaXMuX2h2QWxsID0gZmFsc2U7XG5cdCAgICAgIHRoaXMuX3YgPSBuZXcgQXJyYXkobGVuKTtcblx0ICAgICAgX19zdXBlcl9fLmNhbGwodGhpcyk7XG5cdCAgICB9XG5cdFxuXHQgICAgV2l0aExhdGVzdEZyb21PYnNlcnZhYmxlLnByb3RvdHlwZS5zdWJzY3JpYmVDb3JlID0gZnVuY3Rpb24gKG8pIHtcblx0ICAgICAgdmFyIG4gPSB0aGlzLl9zcy5sZW5ndGgsIHN1YnNjcmlwdGlvbnMgPSBuZXcgQXJyYXkobiArIDEpO1xuXHQgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IG47IGkrKykge1xuXHQgICAgICAgIHZhciBvdGhlciA9IHRoaXMuX3NzW2ldLCBzYWQgPSBuZXcgU2luZ2xlQXNzaWdubWVudERpc3Bvc2FibGUoKTtcblx0ICAgICAgICBpc1Byb21pc2Uob3RoZXIpICYmIChvdGhlciA9IG9ic2VydmFibGVGcm9tUHJvbWlzZShvdGhlcikpO1xuXHQgICAgICAgIHNhZC5zZXREaXNwb3NhYmxlKG90aGVyLnN1YnNjcmliZShuZXcgV2l0aExhdGVzdEZyb21PdGhlck9ic2VydmVyKG8sIGksIHRoaXMpKSk7XG5cdCAgICAgICAgc3Vic2NyaXB0aW9uc1tpXSA9IHNhZDtcblx0ICAgICAgfVxuXHRcblx0ICAgICAgdmFyIHNhZCA9IG5ldyBTaW5nbGVBc3NpZ25tZW50RGlzcG9zYWJsZSgpO1xuXHQgICAgICBzYWQuc2V0RGlzcG9zYWJsZSh0aGlzLl9zLnN1YnNjcmliZShuZXcgV2l0aExhdGVzdEZyb21Tb3VyY2VPYnNlcnZlcihvLCB0aGlzKSkpO1xuXHQgICAgICBzdWJzY3JpcHRpb25zW25dID0gc2FkO1xuXHRcblx0ICAgICAgcmV0dXJuIG5ldyBOQXJ5RGlzcG9zYWJsZShzdWJzY3JpcHRpb25zKTtcblx0ICAgIH07XG5cdFxuXHQgICAgcmV0dXJuIFdpdGhMYXRlc3RGcm9tT2JzZXJ2YWJsZTtcblx0ICB9KE9ic2VydmFibGVCYXNlKSk7XG5cdFxuXHQgIHZhciBXaXRoTGF0ZXN0RnJvbU90aGVyT2JzZXJ2ZXIgPSAoZnVuY3Rpb24gKF9fc3VwZXJfXykge1xuXHQgICAgaW5oZXJpdHMoV2l0aExhdGVzdEZyb21PdGhlck9ic2VydmVyLCBfX3N1cGVyX18pO1xuXHQgICAgZnVuY3Rpb24gV2l0aExhdGVzdEZyb21PdGhlck9ic2VydmVyKG8sIGksIHApIHtcblx0ICAgICAgdGhpcy5fbyA9IG87XG5cdCAgICAgIHRoaXMuX2kgPSBpO1xuXHQgICAgICB0aGlzLl9wID0gcDtcblx0ICAgICAgX19zdXBlcl9fLmNhbGwodGhpcyk7XG5cdCAgICB9XG5cdFxuXHQgICAgV2l0aExhdGVzdEZyb21PdGhlck9ic2VydmVyLnByb3RvdHlwZS5uZXh0ID0gZnVuY3Rpb24gKHgpIHtcblx0ICAgICAgdGhpcy5fcC5fdlt0aGlzLl9pXSA9IHg7XG5cdCAgICAgIHRoaXMuX3AuX2h2W3RoaXMuX2ldID0gdHJ1ZTtcblx0ICAgICAgdGhpcy5fcC5faHZBbGwgPSB0aGlzLl9wLl9odi5ldmVyeShpZGVudGl0eSk7XG5cdCAgICB9O1xuXHRcblx0ICAgIFdpdGhMYXRlc3RGcm9tT3RoZXJPYnNlcnZlci5wcm90b3R5cGUuZXJyb3IgPSBmdW5jdGlvbiAoZSkge1xuXHQgICAgICB0aGlzLl9vLm9uRXJyb3IoZSk7XG5cdCAgICB9O1xuXHRcblx0ICAgIFdpdGhMYXRlc3RGcm9tT3RoZXJPYnNlcnZlci5wcm90b3R5cGUuY29tcGxldGVkID0gbm9vcDtcblx0XG5cdCAgICByZXR1cm4gV2l0aExhdGVzdEZyb21PdGhlck9ic2VydmVyO1xuXHQgIH0oQWJzdHJhY3RPYnNlcnZlcikpO1xuXHRcblx0ICB2YXIgV2l0aExhdGVzdEZyb21Tb3VyY2VPYnNlcnZlciA9IChmdW5jdGlvbiAoX19zdXBlcl9fKSB7XG5cdCAgICBpbmhlcml0cyhXaXRoTGF0ZXN0RnJvbVNvdXJjZU9ic2VydmVyLCBfX3N1cGVyX18pO1xuXHQgICAgZnVuY3Rpb24gV2l0aExhdGVzdEZyb21Tb3VyY2VPYnNlcnZlcihvLCBwKSB7XG5cdCAgICAgIHRoaXMuX28gPSBvO1xuXHQgICAgICB0aGlzLl9wID0gcDtcblx0ICAgICAgX19zdXBlcl9fLmNhbGwodGhpcyk7XG5cdCAgICB9XG5cdFxuXHQgICAgV2l0aExhdGVzdEZyb21Tb3VyY2VPYnNlcnZlci5wcm90b3R5cGUubmV4dCA9IGZ1bmN0aW9uICh4KSB7XG5cdCAgICAgIHZhciBhbGxWYWx1ZXMgPSBbeF0uY29uY2F0KHRoaXMuX3AuX3YpO1xuXHQgICAgICBpZiAoIXRoaXMuX3AuX2h2QWxsKSB7IHJldHVybjsgfVxuXHQgICAgICB2YXIgcmVzID0gdHJ5Q2F0Y2godGhpcy5fcC5fY2IpLmFwcGx5KG51bGwsIGFsbFZhbHVlcyk7XG5cdCAgICAgIGlmIChyZXMgPT09IGVycm9yT2JqKSB7IHJldHVybiB0aGlzLl9vLm9uRXJyb3IocmVzLmUpOyB9XG5cdCAgICAgIHRoaXMuX28ub25OZXh0KHJlcyk7XG5cdCAgICB9O1xuXHRcblx0ICAgIFdpdGhMYXRlc3RGcm9tU291cmNlT2JzZXJ2ZXIucHJvdG90eXBlLmVycm9yID0gZnVuY3Rpb24gKGUpIHtcblx0ICAgICAgdGhpcy5fby5vbkVycm9yKGUpO1xuXHQgICAgfTtcblx0XG5cdCAgICBXaXRoTGF0ZXN0RnJvbVNvdXJjZU9ic2VydmVyLnByb3RvdHlwZS5jb21wbGV0ZWQgPSBmdW5jdGlvbiAoKSB7XG5cdCAgICAgIHRoaXMuX28ub25Db21wbGV0ZWQoKTtcblx0ICAgIH07XG5cdFxuXHQgICAgcmV0dXJuIFdpdGhMYXRlc3RGcm9tU291cmNlT2JzZXJ2ZXI7XG5cdCAgfShBYnN0cmFjdE9ic2VydmVyKSk7XG5cdFxuXHQgIC8qKlxuXHQgICAqIE1lcmdlcyB0aGUgc3BlY2lmaWVkIG9ic2VydmFibGUgc2VxdWVuY2VzIGludG8gb25lIG9ic2VydmFibGUgc2VxdWVuY2UgYnkgdXNpbmcgdGhlIHNlbGVjdG9yIGZ1bmN0aW9uIG9ubHkgd2hlbiB0aGUgKGZpcnN0KSBzb3VyY2Ugb2JzZXJ2YWJsZSBzZXF1ZW5jZSBwcm9kdWNlcyBhbiBlbGVtZW50LlxuXHQgICAqIEByZXR1cm5zIHtPYnNlcnZhYmxlfSBBbiBvYnNlcnZhYmxlIHNlcXVlbmNlIGNvbnRhaW5pbmcgdGhlIHJlc3VsdCBvZiBjb21iaW5pbmcgZWxlbWVudHMgb2YgdGhlIHNvdXJjZXMgdXNpbmcgdGhlIHNwZWNpZmllZCByZXN1bHQgc2VsZWN0b3IgZnVuY3Rpb24uXG5cdCAgICovXG5cdCAgb2JzZXJ2YWJsZVByb3RvLndpdGhMYXRlc3RGcm9tID0gZnVuY3Rpb24gKCkge1xuXHQgICAgaWYgKGFyZ3VtZW50cy5sZW5ndGggPT09IDApIHsgdGhyb3cgbmV3IEVycm9yKCdpbnZhbGlkIGFyZ3VtZW50cycpOyB9XG5cdFxuXHQgICAgdmFyIGxlbiA9IGFyZ3VtZW50cy5sZW5ndGgsIGFyZ3MgPSBuZXcgQXJyYXkobGVuKTtcblx0ICAgIGZvcih2YXIgaSA9IDA7IGkgPCBsZW47IGkrKykgeyBhcmdzW2ldID0gYXJndW1lbnRzW2ldOyB9XG5cdCAgICB2YXIgcmVzdWx0U2VsZWN0b3IgPSBpc0Z1bmN0aW9uKGFyZ3NbbGVuIC0gMV0pID8gYXJncy5wb3AoKSA6IGFyZ3VtZW50c1RvQXJyYXk7XG5cdCAgICBBcnJheS5pc0FycmF5KGFyZ3NbMF0pICYmIChhcmdzID0gYXJnc1swXSk7XG5cdFxuXHQgICAgcmV0dXJuIG5ldyBXaXRoTGF0ZXN0RnJvbU9ic2VydmFibGUodGhpcywgYXJncywgcmVzdWx0U2VsZWN0b3IpO1xuXHQgIH07XG5cdFxuXHQgIGZ1bmN0aW9uIGZhbHNlRmFjdG9yeSgpIHsgcmV0dXJuIGZhbHNlOyB9XG5cdCAgZnVuY3Rpb24gZW1wdHlBcnJheUZhY3RvcnkoKSB7IHJldHVybiBbXTsgfVxuXHRcblx0ICB2YXIgWmlwT2JzZXJ2YWJsZSA9IChmdW5jdGlvbihfX3N1cGVyX18pIHtcblx0ICAgIGluaGVyaXRzKFppcE9ic2VydmFibGUsIF9fc3VwZXJfXyk7XG5cdCAgICBmdW5jdGlvbiBaaXBPYnNlcnZhYmxlKHNvdXJjZXMsIHJlc3VsdFNlbGVjdG9yKSB7XG5cdCAgICAgIHZhciBsZW4gPSBzb3VyY2VzLmxlbmd0aDtcblx0ICAgICAgdGhpcy5fcyA9IHNvdXJjZXM7XG5cdCAgICAgIHRoaXMuX2NiID0gcmVzdWx0U2VsZWN0b3I7XG5cdCAgICAgIHRoaXMuX2RvbmUgPSBhcnJheUluaXRpYWxpemUobGVuLCBmYWxzZUZhY3RvcnkpO1xuXHQgICAgICB0aGlzLl9xID0gYXJyYXlJbml0aWFsaXplKGxlbiwgZW1wdHlBcnJheUZhY3RvcnkpO1xuXHQgICAgICBfX3N1cGVyX18uY2FsbCh0aGlzKTtcblx0ICAgIH1cblx0XG5cdCAgICBaaXBPYnNlcnZhYmxlLnByb3RvdHlwZS5zdWJzY3JpYmVDb3JlID0gZnVuY3Rpb24ob2JzZXJ2ZXIpIHtcblx0ICAgICAgdmFyIG4gPSB0aGlzLl9zLmxlbmd0aCwgc3Vic2NyaXB0aW9ucyA9IG5ldyBBcnJheShuKTtcblx0XG5cdCAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbjsgaSsrKSB7XG5cdCAgICAgICAgdmFyIHNvdXJjZSA9IHRoaXMuX3NbaV0sIHNhZCA9IG5ldyBTaW5nbGVBc3NpZ25tZW50RGlzcG9zYWJsZSgpO1xuXHQgICAgICAgIHN1YnNjcmlwdGlvbnNbaV0gPSBzYWQ7XG5cdCAgICAgICAgaXNQcm9taXNlKHNvdXJjZSkgJiYgKHNvdXJjZSA9IG9ic2VydmFibGVGcm9tUHJvbWlzZShzb3VyY2UpKTtcblx0ICAgICAgICBzYWQuc2V0RGlzcG9zYWJsZShzb3VyY2Uuc3Vic2NyaWJlKG5ldyBaaXBPYnNlcnZlcihvYnNlcnZlciwgaSwgdGhpcykpKTtcblx0ICAgICAgfVxuXHRcblx0ICAgICAgcmV0dXJuIG5ldyBOQXJ5RGlzcG9zYWJsZShzdWJzY3JpcHRpb25zKTtcblx0ICAgIH07XG5cdFxuXHQgICAgcmV0dXJuIFppcE9ic2VydmFibGU7XG5cdCAgfShPYnNlcnZhYmxlQmFzZSkpO1xuXHRcblx0ICB2YXIgWmlwT2JzZXJ2ZXIgPSAoZnVuY3Rpb24gKF9fc3VwZXJfXykge1xuXHQgICAgaW5oZXJpdHMoWmlwT2JzZXJ2ZXIsIF9fc3VwZXJfXyk7XG5cdCAgICBmdW5jdGlvbiBaaXBPYnNlcnZlcihvLCBpLCBwKSB7XG5cdCAgICAgIHRoaXMuX28gPSBvO1xuXHQgICAgICB0aGlzLl9pID0gaTtcblx0ICAgICAgdGhpcy5fcCA9IHA7XG5cdCAgICAgIF9fc3VwZXJfXy5jYWxsKHRoaXMpO1xuXHQgICAgfVxuXHRcblx0ICAgIFppcE9ic2VydmVyLnByb3RvdHlwZS5uZXh0ID0gZnVuY3Rpb24gKHgpIHtcblx0ICAgICAgdGhpcy5fcC5fcVt0aGlzLl9pXS5wdXNoKHgpO1xuXHQgICAgICBpZiAodGhpcy5fcC5fcS5ldmVyeShmdW5jdGlvbiAoeCkgeyByZXR1cm4geC5sZW5ndGggPiAwOyB9KSkge1xuXHQgICAgICAgIHZhciBxdWV1ZWRWYWx1ZXMgPSB0aGlzLl9wLl9xLm1hcChmdW5jdGlvbiAoeCkgeyByZXR1cm4geC5zaGlmdCgpOyB9KTtcblx0ICAgICAgICB2YXIgcmVzID0gdHJ5Q2F0Y2godGhpcy5fcC5fY2IpLmFwcGx5KG51bGwsIHF1ZXVlZFZhbHVlcyk7XG5cdCAgICAgICAgaWYgKHJlcyA9PT0gZXJyb3JPYmopIHsgcmV0dXJuIHRoaXMuX28ub25FcnJvcihyZXMuZSk7IH1cblx0ICAgICAgICB0aGlzLl9vLm9uTmV4dChyZXMpO1xuXHQgICAgICB9IGVsc2UgaWYgKHRoaXMuX3AuX2RvbmUuZmlsdGVyKGZ1bmN0aW9uICh4LCBqKSB7IHJldHVybiBqICE9PSB0aGlzLl9pOyB9LCB0aGlzKS5ldmVyeShpZGVudGl0eSkpIHtcblx0ICAgICAgICB0aGlzLl9vLm9uQ29tcGxldGVkKCk7XG5cdCAgICAgIH1cblx0ICAgIH07XG5cdFxuXHQgICAgWmlwT2JzZXJ2ZXIucHJvdG90eXBlLmVycm9yID0gZnVuY3Rpb24gKGUpIHtcblx0ICAgICAgdGhpcy5fby5vbkVycm9yKGUpO1xuXHQgICAgfTtcblx0XG5cdCAgICBaaXBPYnNlcnZlci5wcm90b3R5cGUuY29tcGxldGVkID0gZnVuY3Rpb24gKCkge1xuXHQgICAgICB0aGlzLl9wLl9kb25lW3RoaXMuX2ldID0gdHJ1ZTtcblx0ICAgICAgdGhpcy5fcC5fZG9uZS5ldmVyeShpZGVudGl0eSkgJiYgdGhpcy5fby5vbkNvbXBsZXRlZCgpO1xuXHQgICAgfTtcblx0XG5cdCAgICByZXR1cm4gWmlwT2JzZXJ2ZXI7XG5cdCAgfShBYnN0cmFjdE9ic2VydmVyKSk7XG5cdFxuXHQgIC8qKlxuXHQgICAqIE1lcmdlcyB0aGUgc3BlY2lmaWVkIG9ic2VydmFibGUgc2VxdWVuY2VzIGludG8gb25lIG9ic2VydmFibGUgc2VxdWVuY2UgYnkgdXNpbmcgdGhlIHNlbGVjdG9yIGZ1bmN0aW9uIHdoZW5ldmVyIGFsbCBvZiB0aGUgb2JzZXJ2YWJsZSBzZXF1ZW5jZXMgb3IgYW4gYXJyYXkgaGF2ZSBwcm9kdWNlZCBhbiBlbGVtZW50IGF0IGEgY29ycmVzcG9uZGluZyBpbmRleC5cblx0ICAgKiBUaGUgbGFzdCBlbGVtZW50IGluIHRoZSBhcmd1bWVudHMgbXVzdCBiZSBhIGZ1bmN0aW9uIHRvIGludm9rZSBmb3IgZWFjaCBzZXJpZXMgb2YgZWxlbWVudHMgYXQgY29ycmVzcG9uZGluZyBpbmRleGVzIGluIHRoZSBhcmdzLlxuXHQgICAqIEByZXR1cm5zIHtPYnNlcnZhYmxlfSBBbiBvYnNlcnZhYmxlIHNlcXVlbmNlIGNvbnRhaW5pbmcgdGhlIHJlc3VsdCBvZiBjb21iaW5pbmcgZWxlbWVudHMgb2YgdGhlIGFyZ3MgdXNpbmcgdGhlIHNwZWNpZmllZCByZXN1bHQgc2VsZWN0b3IgZnVuY3Rpb24uXG5cdCAgICovXG5cdCAgb2JzZXJ2YWJsZVByb3RvLnppcCA9IGZ1bmN0aW9uICgpIHtcblx0ICAgIGlmIChhcmd1bWVudHMubGVuZ3RoID09PSAwKSB7IHRocm93IG5ldyBFcnJvcignaW52YWxpZCBhcmd1bWVudHMnKTsgfVxuXHRcblx0ICAgIHZhciBsZW4gPSBhcmd1bWVudHMubGVuZ3RoLCBhcmdzID0gbmV3IEFycmF5KGxlbik7XG5cdCAgICBmb3IodmFyIGkgPSAwOyBpIDwgbGVuOyBpKyspIHsgYXJnc1tpXSA9IGFyZ3VtZW50c1tpXTsgfVxuXHQgICAgdmFyIHJlc3VsdFNlbGVjdG9yID0gaXNGdW5jdGlvbihhcmdzW2xlbiAtIDFdKSA/IGFyZ3MucG9wKCkgOiBhcmd1bWVudHNUb0FycmF5O1xuXHQgICAgQXJyYXkuaXNBcnJheShhcmdzWzBdKSAmJiAoYXJncyA9IGFyZ3NbMF0pO1xuXHRcblx0ICAgIHZhciBwYXJlbnQgPSB0aGlzO1xuXHQgICAgYXJncy51bnNoaWZ0KHBhcmVudCk7XG5cdFxuXHQgICAgcmV0dXJuIG5ldyBaaXBPYnNlcnZhYmxlKGFyZ3MsIHJlc3VsdFNlbGVjdG9yKTtcblx0ICB9O1xuXHRcblx0ICAvKipcblx0ICAgKiBNZXJnZXMgdGhlIHNwZWNpZmllZCBvYnNlcnZhYmxlIHNlcXVlbmNlcyBpbnRvIG9uZSBvYnNlcnZhYmxlIHNlcXVlbmNlIGJ5IHVzaW5nIHRoZSBzZWxlY3RvciBmdW5jdGlvbiB3aGVuZXZlciBhbGwgb2YgdGhlIG9ic2VydmFibGUgc2VxdWVuY2VzIGhhdmUgcHJvZHVjZWQgYW4gZWxlbWVudCBhdCBhIGNvcnJlc3BvbmRpbmcgaW5kZXguXG5cdCAgICogQHBhcmFtIGFyZ3VtZW50cyBPYnNlcnZhYmxlIHNvdXJjZXMuXG5cdCAgICogQHBhcmFtIHtGdW5jdGlvbn0gcmVzdWx0U2VsZWN0b3IgRnVuY3Rpb24gdG8gaW52b2tlIGZvciBlYWNoIHNlcmllcyBvZiBlbGVtZW50cyBhdCBjb3JyZXNwb25kaW5nIGluZGV4ZXMgaW4gdGhlIHNvdXJjZXMuXG5cdCAgICogQHJldHVybnMge09ic2VydmFibGV9IEFuIG9ic2VydmFibGUgc2VxdWVuY2UgY29udGFpbmluZyB0aGUgcmVzdWx0IG9mIGNvbWJpbmluZyBlbGVtZW50cyBvZiB0aGUgc291cmNlcyB1c2luZyB0aGUgc3BlY2lmaWVkIHJlc3VsdCBzZWxlY3RvciBmdW5jdGlvbi5cblx0ICAgKi9cblx0ICBPYnNlcnZhYmxlLnppcCA9IGZ1bmN0aW9uICgpIHtcblx0ICAgIHZhciBsZW4gPSBhcmd1bWVudHMubGVuZ3RoLCBhcmdzID0gbmV3IEFycmF5KGxlbik7XG5cdCAgICBmb3IodmFyIGkgPSAwOyBpIDwgbGVuOyBpKyspIHsgYXJnc1tpXSA9IGFyZ3VtZW50c1tpXTsgfVxuXHQgICAgaWYgKEFycmF5LmlzQXJyYXkoYXJnc1swXSkpIHtcblx0ICAgICAgYXJncyA9IGlzRnVuY3Rpb24oYXJnc1sxXSkgPyBhcmdzWzBdLmNvbmNhdChhcmdzWzFdKSA6IGFyZ3NbMF07XG5cdCAgICB9XG5cdCAgICB2YXIgZmlyc3QgPSBhcmdzLnNoaWZ0KCk7XG5cdCAgICByZXR1cm4gZmlyc3QuemlwLmFwcGx5KGZpcnN0LCBhcmdzKTtcblx0ICB9O1xuXHRcblx0ZnVuY3Rpb24gZmFsc2VGYWN0b3J5KCkgeyByZXR1cm4gZmFsc2U7IH1cblx0ZnVuY3Rpb24gZW1wdHlBcnJheUZhY3RvcnkoKSB7IHJldHVybiBbXTsgfVxuXHRmdW5jdGlvbiBhcmd1bWVudHNUb0FycmF5KCkge1xuXHQgIHZhciBsZW4gPSBhcmd1bWVudHMubGVuZ3RoLCBhcmdzID0gbmV3IEFycmF5KGxlbik7XG5cdCAgZm9yKHZhciBpID0gMDsgaSA8IGxlbjsgaSsrKSB7IGFyZ3NbaV0gPSBhcmd1bWVudHNbaV07IH1cblx0ICByZXR1cm4gYXJncztcblx0fVxuXHRcblx0LyoqXG5cdCAqIE1lcmdlcyB0aGUgc3BlY2lmaWVkIG9ic2VydmFibGUgc2VxdWVuY2VzIGludG8gb25lIG9ic2VydmFibGUgc2VxdWVuY2UgYnkgdXNpbmcgdGhlIHNlbGVjdG9yIGZ1bmN0aW9uIHdoZW5ldmVyIGFsbCBvZiB0aGUgb2JzZXJ2YWJsZSBzZXF1ZW5jZXMgb3IgYW4gYXJyYXkgaGF2ZSBwcm9kdWNlZCBhbiBlbGVtZW50IGF0IGEgY29ycmVzcG9uZGluZyBpbmRleC5cblx0ICogVGhlIGxhc3QgZWxlbWVudCBpbiB0aGUgYXJndW1lbnRzIG11c3QgYmUgYSBmdW5jdGlvbiB0byBpbnZva2UgZm9yIGVhY2ggc2VyaWVzIG9mIGVsZW1lbnRzIGF0IGNvcnJlc3BvbmRpbmcgaW5kZXhlcyBpbiB0aGUgYXJncy5cblx0ICogQHJldHVybnMge09ic2VydmFibGV9IEFuIG9ic2VydmFibGUgc2VxdWVuY2UgY29udGFpbmluZyB0aGUgcmVzdWx0IG9mIGNvbWJpbmluZyBlbGVtZW50cyBvZiB0aGUgYXJncyB1c2luZyB0aGUgc3BlY2lmaWVkIHJlc3VsdCBzZWxlY3RvciBmdW5jdGlvbi5cblx0ICovXG5cdG9ic2VydmFibGVQcm90by56aXBJdGVyYWJsZSA9IGZ1bmN0aW9uICgpIHtcblx0ICBpZiAoYXJndW1lbnRzLmxlbmd0aCA9PT0gMCkgeyB0aHJvdyBuZXcgRXJyb3IoJ2ludmFsaWQgYXJndW1lbnRzJyk7IH1cblx0XG5cdCAgdmFyIGxlbiA9IGFyZ3VtZW50cy5sZW5ndGgsIGFyZ3MgPSBuZXcgQXJyYXkobGVuKTtcblx0ICBmb3IodmFyIGkgPSAwOyBpIDwgbGVuOyBpKyspIHsgYXJnc1tpXSA9IGFyZ3VtZW50c1tpXTsgfVxuXHQgIHZhciByZXN1bHRTZWxlY3RvciA9IGlzRnVuY3Rpb24oYXJnc1tsZW4gLSAxXSkgPyBhcmdzLnBvcCgpIDogYXJndW1lbnRzVG9BcnJheTtcblx0XG5cdCAgdmFyIHBhcmVudCA9IHRoaXM7XG5cdCAgYXJncy51bnNoaWZ0KHBhcmVudCk7XG5cdCAgcmV0dXJuIG5ldyBBbm9ueW1vdXNPYnNlcnZhYmxlKGZ1bmN0aW9uIChvKSB7XG5cdCAgICB2YXIgbiA9IGFyZ3MubGVuZ3RoLFxuXHQgICAgICBxdWV1ZXMgPSBhcnJheUluaXRpYWxpemUobiwgZW1wdHlBcnJheUZhY3RvcnkpLFxuXHQgICAgICBpc0RvbmUgPSBhcnJheUluaXRpYWxpemUobiwgZmFsc2VGYWN0b3J5KTtcblx0XG5cdCAgICB2YXIgc3Vic2NyaXB0aW9ucyA9IG5ldyBBcnJheShuKTtcblx0ICAgIGZvciAodmFyIGlkeCA9IDA7IGlkeCA8IG47IGlkeCsrKSB7XG5cdCAgICAgIChmdW5jdGlvbiAoaSkge1xuXHQgICAgICAgIHZhciBzb3VyY2UgPSBhcmdzW2ldLCBzYWQgPSBuZXcgU2luZ2xlQXNzaWdubWVudERpc3Bvc2FibGUoKTtcblx0XG5cdCAgICAgICAgKGlzQXJyYXlMaWtlKHNvdXJjZSkgfHwgaXNJdGVyYWJsZShzb3VyY2UpKSAmJiAoc291cmNlID0gb2JzZXJ2YWJsZUZyb20oc291cmNlKSk7XG5cdFxuXHQgICAgICAgIHNhZC5zZXREaXNwb3NhYmxlKHNvdXJjZS5zdWJzY3JpYmUoZnVuY3Rpb24gKHgpIHtcblx0ICAgICAgICAgIHF1ZXVlc1tpXS5wdXNoKHgpO1xuXHQgICAgICAgICAgaWYgKHF1ZXVlcy5ldmVyeShmdW5jdGlvbiAoeCkgeyByZXR1cm4geC5sZW5ndGggPiAwOyB9KSkge1xuXHQgICAgICAgICAgICB2YXIgcXVldWVkVmFsdWVzID0gcXVldWVzLm1hcChmdW5jdGlvbiAoeCkgeyByZXR1cm4geC5zaGlmdCgpOyB9KSxcblx0ICAgICAgICAgICAgICAgIHJlcyA9IHRyeUNhdGNoKHJlc3VsdFNlbGVjdG9yKS5hcHBseShwYXJlbnQsIHF1ZXVlZFZhbHVlcyk7XG5cdCAgICAgICAgICAgIGlmIChyZXMgPT09IGVycm9yT2JqKSB7IHJldHVybiBvLm9uRXJyb3IocmVzLmUpOyB9XG5cdCAgICAgICAgICAgIG8ub25OZXh0KHJlcyk7XG5cdCAgICAgICAgICB9IGVsc2UgaWYgKGlzRG9uZS5maWx0ZXIoZnVuY3Rpb24gKHgsIGopIHsgcmV0dXJuIGogIT09IGk7IH0pLmV2ZXJ5KGlkZW50aXR5KSkge1xuXHQgICAgICAgICAgICBvLm9uQ29tcGxldGVkKCk7XG5cdCAgICAgICAgICB9XG5cdCAgICAgICAgfSwgZnVuY3Rpb24gKGUpIHsgby5vbkVycm9yKGUpOyB9LCBmdW5jdGlvbiAoKSB7XG5cdCAgICAgICAgICBpc0RvbmVbaV0gPSB0cnVlO1xuXHQgICAgICAgICAgaXNEb25lLmV2ZXJ5KGlkZW50aXR5KSAmJiBvLm9uQ29tcGxldGVkKCk7XG5cdCAgICAgICAgfSkpO1xuXHQgICAgICAgIHN1YnNjcmlwdGlvbnNbaV0gPSBzYWQ7XG5cdCAgICAgIH0pKGlkeCk7XG5cdCAgICB9XG5cdFxuXHQgICAgcmV0dXJuIG5ldyBDb21wb3NpdGVEaXNwb3NhYmxlKHN1YnNjcmlwdGlvbnMpO1xuXHQgIH0sIHBhcmVudCk7XG5cdH07XG5cdFxuXHQgIGZ1bmN0aW9uIGFzT2JzZXJ2YWJsZShzb3VyY2UpIHtcblx0ICAgIHJldHVybiBmdW5jdGlvbiBzdWJzY3JpYmUobykgeyByZXR1cm4gc291cmNlLnN1YnNjcmliZShvKTsgfTtcblx0ICB9XG5cdFxuXHQgIC8qKlxuXHQgICAqICBIaWRlcyB0aGUgaWRlbnRpdHkgb2YgYW4gb2JzZXJ2YWJsZSBzZXF1ZW5jZS5cblx0ICAgKiBAcmV0dXJucyB7T2JzZXJ2YWJsZX0gQW4gb2JzZXJ2YWJsZSBzZXF1ZW5jZSB0aGF0IGhpZGVzIHRoZSBpZGVudGl0eSBvZiB0aGUgc291cmNlIHNlcXVlbmNlLlxuXHQgICAqL1xuXHQgIG9ic2VydmFibGVQcm90by5hc09ic2VydmFibGUgPSBmdW5jdGlvbiAoKSB7XG5cdCAgICByZXR1cm4gbmV3IEFub255bW91c09ic2VydmFibGUoYXNPYnNlcnZhYmxlKHRoaXMpLCB0aGlzKTtcblx0ICB9O1xuXHRcblx0ICBmdW5jdGlvbiB0b0FycmF5KHgpIHsgcmV0dXJuIHgudG9BcnJheSgpOyB9XG5cdCAgZnVuY3Rpb24gbm90RW1wdHkoeCkgeyByZXR1cm4geC5sZW5ndGggPiAwOyB9XG5cdFxuXHQgIC8qKlxuXHQgICAqICBQcm9qZWN0cyBlYWNoIGVsZW1lbnQgb2YgYW4gb2JzZXJ2YWJsZSBzZXF1ZW5jZSBpbnRvIHplcm8gb3IgbW9yZSBidWZmZXJzIHdoaWNoIGFyZSBwcm9kdWNlZCBiYXNlZCBvbiBlbGVtZW50IGNvdW50IGluZm9ybWF0aW9uLlxuXHQgICAqIEBwYXJhbSB7TnVtYmVyfSBjb3VudCBMZW5ndGggb2YgZWFjaCBidWZmZXIuXG5cdCAgICogQHBhcmFtIHtOdW1iZXJ9IFtza2lwXSBOdW1iZXIgb2YgZWxlbWVudHMgdG8gc2tpcCBiZXR3ZWVuIGNyZWF0aW9uIG9mIGNvbnNlY3V0aXZlIGJ1ZmZlcnMuIElmIG5vdCBwcm92aWRlZCwgZGVmYXVsdHMgdG8gdGhlIGNvdW50LlxuXHQgICAqIEByZXR1cm5zIHtPYnNlcnZhYmxlfSBBbiBvYnNlcnZhYmxlIHNlcXVlbmNlIG9mIGJ1ZmZlcnMuXG5cdCAgICovXG5cdCAgb2JzZXJ2YWJsZVByb3RvLmJ1ZmZlcldpdGhDb3VudCA9IGZ1bmN0aW9uIChjb3VudCwgc2tpcCkge1xuXHQgICAgdHlwZW9mIHNraXAgIT09ICdudW1iZXInICYmIChza2lwID0gY291bnQpO1xuXHQgICAgcmV0dXJuIHRoaXMud2luZG93V2l0aENvdW50KGNvdW50LCBza2lwKVxuXHQgICAgICAuZmxhdE1hcCh0b0FycmF5KVxuXHQgICAgICAuZmlsdGVyKG5vdEVtcHR5KTtcblx0ICB9O1xuXHRcblx0ICB2YXIgRGVtYXRlcmlhbGl6ZU9ic2VydmFibGUgPSAoZnVuY3Rpb24gKF9fc3VwZXJfXykge1xuXHQgICAgaW5oZXJpdHMoRGVtYXRlcmlhbGl6ZU9ic2VydmFibGUsIF9fc3VwZXJfXyk7XG5cdCAgICBmdW5jdGlvbiBEZW1hdGVyaWFsaXplT2JzZXJ2YWJsZShzb3VyY2UpIHtcblx0ICAgICAgdGhpcy5zb3VyY2UgPSBzb3VyY2U7XG5cdCAgICAgIF9fc3VwZXJfXy5jYWxsKHRoaXMpO1xuXHQgICAgfVxuXHRcblx0ICAgIERlbWF0ZXJpYWxpemVPYnNlcnZhYmxlLnByb3RvdHlwZS5zdWJzY3JpYmVDb3JlID0gZnVuY3Rpb24gKG8pIHtcblx0ICAgICAgcmV0dXJuIHRoaXMuc291cmNlLnN1YnNjcmliZShuZXcgRGVtYXRlcmlhbGl6ZU9ic2VydmVyKG8pKTtcblx0ICAgIH07XG5cdFxuXHQgICAgcmV0dXJuIERlbWF0ZXJpYWxpemVPYnNlcnZhYmxlO1xuXHQgIH0oT2JzZXJ2YWJsZUJhc2UpKTtcblx0XG5cdCAgdmFyIERlbWF0ZXJpYWxpemVPYnNlcnZlciA9IChmdW5jdGlvbiAoX19zdXBlcl9fKSB7XG5cdCAgICBpbmhlcml0cyhEZW1hdGVyaWFsaXplT2JzZXJ2ZXIsIF9fc3VwZXJfXyk7XG5cdFxuXHQgICAgZnVuY3Rpb24gRGVtYXRlcmlhbGl6ZU9ic2VydmVyKG8pIHtcblx0ICAgICAgdGhpcy5fbyA9IG87XG5cdCAgICAgIF9fc3VwZXJfXy5jYWxsKHRoaXMpO1xuXHQgICAgfVxuXHRcblx0ICAgIERlbWF0ZXJpYWxpemVPYnNlcnZlci5wcm90b3R5cGUubmV4dCA9IGZ1bmN0aW9uICh4KSB7IHguYWNjZXB0KHRoaXMuX28pOyB9O1xuXHQgICAgRGVtYXRlcmlhbGl6ZU9ic2VydmVyLnByb3RvdHlwZS5lcnJvciA9IGZ1bmN0aW9uIChlKSB7IHRoaXMuX28ub25FcnJvcihlKTsgfTtcblx0ICAgIERlbWF0ZXJpYWxpemVPYnNlcnZlci5wcm90b3R5cGUuY29tcGxldGVkID0gZnVuY3Rpb24gKCkgeyB0aGlzLl9vLm9uQ29tcGxldGVkKCk7IH07XG5cdFxuXHQgICAgcmV0dXJuIERlbWF0ZXJpYWxpemVPYnNlcnZlcjtcblx0ICB9KEFic3RyYWN0T2JzZXJ2ZXIpKTtcblx0XG5cdCAgLyoqXG5cdCAgICogRGVtYXRlcmlhbGl6ZXMgdGhlIGV4cGxpY2l0IG5vdGlmaWNhdGlvbiB2YWx1ZXMgb2YgYW4gb2JzZXJ2YWJsZSBzZXF1ZW5jZSBhcyBpbXBsaWNpdCBub3RpZmljYXRpb25zLlxuXHQgICAqIEByZXR1cm5zIHtPYnNlcnZhYmxlfSBBbiBvYnNlcnZhYmxlIHNlcXVlbmNlIGV4aGliaXRpbmcgdGhlIGJlaGF2aW9yIGNvcnJlc3BvbmRpbmcgdG8gdGhlIHNvdXJjZSBzZXF1ZW5jZSdzIG5vdGlmaWNhdGlvbiB2YWx1ZXMuXG5cdCAgICovXG5cdCAgb2JzZXJ2YWJsZVByb3RvLmRlbWF0ZXJpYWxpemUgPSBmdW5jdGlvbiAoKSB7XG5cdCAgICByZXR1cm4gbmV3IERlbWF0ZXJpYWxpemVPYnNlcnZhYmxlKHRoaXMpO1xuXHQgIH07XG5cdFxuXHQgIHZhciBEaXN0aW5jdFVudGlsQ2hhbmdlZE9ic2VydmFibGUgPSAoZnVuY3Rpb24oX19zdXBlcl9fKSB7XG5cdCAgICBpbmhlcml0cyhEaXN0aW5jdFVudGlsQ2hhbmdlZE9ic2VydmFibGUsIF9fc3VwZXJfXyk7XG5cdCAgICBmdW5jdGlvbiBEaXN0aW5jdFVudGlsQ2hhbmdlZE9ic2VydmFibGUoc291cmNlLCBrZXlGbiwgY29tcGFyZXIpIHtcblx0ICAgICAgdGhpcy5zb3VyY2UgPSBzb3VyY2U7XG5cdCAgICAgIHRoaXMua2V5Rm4gPSBrZXlGbjtcblx0ICAgICAgdGhpcy5jb21wYXJlciA9IGNvbXBhcmVyO1xuXHQgICAgICBfX3N1cGVyX18uY2FsbCh0aGlzKTtcblx0ICAgIH1cblx0XG5cdCAgICBEaXN0aW5jdFVudGlsQ2hhbmdlZE9ic2VydmFibGUucHJvdG90eXBlLnN1YnNjcmliZUNvcmUgPSBmdW5jdGlvbiAobykge1xuXHQgICAgICByZXR1cm4gdGhpcy5zb3VyY2Uuc3Vic2NyaWJlKG5ldyBEaXN0aW5jdFVudGlsQ2hhbmdlZE9ic2VydmVyKG8sIHRoaXMua2V5Rm4sIHRoaXMuY29tcGFyZXIpKTtcblx0ICAgIH07XG5cdFxuXHQgICAgcmV0dXJuIERpc3RpbmN0VW50aWxDaGFuZ2VkT2JzZXJ2YWJsZTtcblx0ICB9KE9ic2VydmFibGVCYXNlKSk7XG5cdFxuXHQgIHZhciBEaXN0aW5jdFVudGlsQ2hhbmdlZE9ic2VydmVyID0gKGZ1bmN0aW9uKF9fc3VwZXJfXykge1xuXHQgICAgaW5oZXJpdHMoRGlzdGluY3RVbnRpbENoYW5nZWRPYnNlcnZlciwgX19zdXBlcl9fKTtcblx0ICAgIGZ1bmN0aW9uIERpc3RpbmN0VW50aWxDaGFuZ2VkT2JzZXJ2ZXIobywga2V5Rm4sIGNvbXBhcmVyKSB7XG5cdCAgICAgIHRoaXMubyA9IG87XG5cdCAgICAgIHRoaXMua2V5Rm4gPSBrZXlGbjtcblx0ICAgICAgdGhpcy5jb21wYXJlciA9IGNvbXBhcmVyO1xuXHQgICAgICB0aGlzLmhhc0N1cnJlbnRLZXkgPSBmYWxzZTtcblx0ICAgICAgdGhpcy5jdXJyZW50S2V5ID0gbnVsbDtcblx0ICAgICAgX19zdXBlcl9fLmNhbGwodGhpcyk7XG5cdCAgICB9XG5cdFxuXHQgICAgRGlzdGluY3RVbnRpbENoYW5nZWRPYnNlcnZlci5wcm90b3R5cGUubmV4dCA9IGZ1bmN0aW9uICh4KSB7XG5cdCAgICAgIHZhciBrZXkgPSB4LCBjb21wYXJlckVxdWFscztcblx0ICAgICAgaWYgKGlzRnVuY3Rpb24odGhpcy5rZXlGbikpIHtcblx0ICAgICAgICBrZXkgPSB0cnlDYXRjaCh0aGlzLmtleUZuKSh4KTtcblx0ICAgICAgICBpZiAoa2V5ID09PSBlcnJvck9iaikgeyByZXR1cm4gdGhpcy5vLm9uRXJyb3Ioa2V5LmUpOyB9XG5cdCAgICAgIH1cblx0ICAgICAgaWYgKHRoaXMuaGFzQ3VycmVudEtleSkge1xuXHQgICAgICAgIGNvbXBhcmVyRXF1YWxzID0gdHJ5Q2F0Y2godGhpcy5jb21wYXJlcikodGhpcy5jdXJyZW50S2V5LCBrZXkpO1xuXHQgICAgICAgIGlmIChjb21wYXJlckVxdWFscyA9PT0gZXJyb3JPYmopIHsgcmV0dXJuIHRoaXMuby5vbkVycm9yKGNvbXBhcmVyRXF1YWxzLmUpOyB9XG5cdCAgICAgIH1cblx0ICAgICAgaWYgKCF0aGlzLmhhc0N1cnJlbnRLZXkgfHwgIWNvbXBhcmVyRXF1YWxzKSB7XG5cdCAgICAgICAgdGhpcy5oYXNDdXJyZW50S2V5ID0gdHJ1ZTtcblx0ICAgICAgICB0aGlzLmN1cnJlbnRLZXkgPSBrZXk7XG5cdCAgICAgICAgdGhpcy5vLm9uTmV4dCh4KTtcblx0ICAgICAgfVxuXHQgICAgfTtcblx0ICAgIERpc3RpbmN0VW50aWxDaGFuZ2VkT2JzZXJ2ZXIucHJvdG90eXBlLmVycm9yID0gZnVuY3Rpb24oZSkge1xuXHQgICAgICB0aGlzLm8ub25FcnJvcihlKTtcblx0ICAgIH07XG5cdCAgICBEaXN0aW5jdFVudGlsQ2hhbmdlZE9ic2VydmVyLnByb3RvdHlwZS5jb21wbGV0ZWQgPSBmdW5jdGlvbiAoKSB7XG5cdCAgICAgIHRoaXMuby5vbkNvbXBsZXRlZCgpO1xuXHQgICAgfTtcblx0XG5cdCAgICByZXR1cm4gRGlzdGluY3RVbnRpbENoYW5nZWRPYnNlcnZlcjtcblx0ICB9KEFic3RyYWN0T2JzZXJ2ZXIpKTtcblx0XG5cdCAgLyoqXG5cdCAgKiAgUmV0dXJucyBhbiBvYnNlcnZhYmxlIHNlcXVlbmNlIHRoYXQgY29udGFpbnMgb25seSBkaXN0aW5jdCBjb250aWd1b3VzIGVsZW1lbnRzIGFjY29yZGluZyB0byB0aGUga2V5Rm4gYW5kIHRoZSBjb21wYXJlci5cblx0ICAqIEBwYXJhbSB7RnVuY3Rpb259IFtrZXlGbl0gQSBmdW5jdGlvbiB0byBjb21wdXRlIHRoZSBjb21wYXJpc29uIGtleSBmb3IgZWFjaCBlbGVtZW50LiBJZiBub3QgcHJvdmlkZWQsIGl0IHByb2plY3RzIHRoZSB2YWx1ZS5cblx0ICAqIEBwYXJhbSB7RnVuY3Rpb259IFtjb21wYXJlcl0gRXF1YWxpdHkgY29tcGFyZXIgZm9yIGNvbXB1dGVkIGtleSB2YWx1ZXMuIElmIG5vdCBwcm92aWRlZCwgZGVmYXVsdHMgdG8gYW4gZXF1YWxpdHkgY29tcGFyZXIgZnVuY3Rpb24uXG5cdCAgKiBAcmV0dXJucyB7T2JzZXJ2YWJsZX0gQW4gb2JzZXJ2YWJsZSBzZXF1ZW5jZSBvbmx5IGNvbnRhaW5pbmcgdGhlIGRpc3RpbmN0IGNvbnRpZ3VvdXMgZWxlbWVudHMsIGJhc2VkIG9uIGEgY29tcHV0ZWQga2V5IHZhbHVlLCBmcm9tIHRoZSBzb3VyY2Ugc2VxdWVuY2UuXG5cdCAgKi9cblx0ICBvYnNlcnZhYmxlUHJvdG8uZGlzdGluY3RVbnRpbENoYW5nZWQgPSBmdW5jdGlvbiAoa2V5Rm4sIGNvbXBhcmVyKSB7XG5cdCAgICBjb21wYXJlciB8fCAoY29tcGFyZXIgPSBkZWZhdWx0Q29tcGFyZXIpO1xuXHQgICAgcmV0dXJuIG5ldyBEaXN0aW5jdFVudGlsQ2hhbmdlZE9ic2VydmFibGUodGhpcywga2V5Rm4sIGNvbXBhcmVyKTtcblx0ICB9O1xuXHRcblx0ICB2YXIgVGFwT2JzZXJ2YWJsZSA9IChmdW5jdGlvbihfX3N1cGVyX18pIHtcblx0ICAgIGluaGVyaXRzKFRhcE9ic2VydmFibGUsX19zdXBlcl9fKTtcblx0ICAgIGZ1bmN0aW9uIFRhcE9ic2VydmFibGUoc291cmNlLCBvYnNlcnZlck9yT25OZXh0LCBvbkVycm9yLCBvbkNvbXBsZXRlZCkge1xuXHQgICAgICB0aGlzLnNvdXJjZSA9IHNvdXJjZTtcblx0ICAgICAgdGhpcy5fb04gPSBvYnNlcnZlck9yT25OZXh0O1xuXHQgICAgICB0aGlzLl9vRSA9IG9uRXJyb3I7XG5cdCAgICAgIHRoaXMuX29DID0gb25Db21wbGV0ZWQ7XG5cdCAgICAgIF9fc3VwZXJfXy5jYWxsKHRoaXMpO1xuXHQgICAgfVxuXHRcblx0ICAgIFRhcE9ic2VydmFibGUucHJvdG90eXBlLnN1YnNjcmliZUNvcmUgPSBmdW5jdGlvbihvKSB7XG5cdCAgICAgIHJldHVybiB0aGlzLnNvdXJjZS5zdWJzY3JpYmUobmV3IElubmVyT2JzZXJ2ZXIobywgdGhpcykpO1xuXHQgICAgfTtcblx0XG5cdCAgICBpbmhlcml0cyhJbm5lck9ic2VydmVyLCBBYnN0cmFjdE9ic2VydmVyKTtcblx0ICAgIGZ1bmN0aW9uIElubmVyT2JzZXJ2ZXIobywgcCkge1xuXHQgICAgICB0aGlzLm8gPSBvO1xuXHQgICAgICB0aGlzLnQgPSAhcC5fb04gfHwgaXNGdW5jdGlvbihwLl9vTikgP1xuXHQgICAgICAgIG9ic2VydmVyQ3JlYXRlKHAuX29OIHx8IG5vb3AsIHAuX29FIHx8IG5vb3AsIHAuX29DIHx8IG5vb3ApIDpcblx0ICAgICAgICBwLl9vTjtcblx0ICAgICAgdGhpcy5pc1N0b3BwZWQgPSBmYWxzZTtcblx0ICAgICAgQWJzdHJhY3RPYnNlcnZlci5jYWxsKHRoaXMpO1xuXHQgICAgfVxuXHQgICAgSW5uZXJPYnNlcnZlci5wcm90b3R5cGUubmV4dCA9IGZ1bmN0aW9uKHgpIHtcblx0ICAgICAgdmFyIHJlcyA9IHRyeUNhdGNoKHRoaXMudC5vbk5leHQpLmNhbGwodGhpcy50LCB4KTtcblx0ICAgICAgaWYgKHJlcyA9PT0gZXJyb3JPYmopIHsgdGhpcy5vLm9uRXJyb3IocmVzLmUpOyB9XG5cdCAgICAgIHRoaXMuby5vbk5leHQoeCk7XG5cdCAgICB9O1xuXHQgICAgSW5uZXJPYnNlcnZlci5wcm90b3R5cGUuZXJyb3IgPSBmdW5jdGlvbihlcnIpIHtcblx0ICAgICAgdmFyIHJlcyA9IHRyeUNhdGNoKHRoaXMudC5vbkVycm9yKS5jYWxsKHRoaXMudCwgZXJyKTtcblx0ICAgICAgaWYgKHJlcyA9PT0gZXJyb3JPYmopIHsgcmV0dXJuIHRoaXMuby5vbkVycm9yKHJlcy5lKTsgfVxuXHQgICAgICB0aGlzLm8ub25FcnJvcihlcnIpO1xuXHQgICAgfTtcblx0ICAgIElubmVyT2JzZXJ2ZXIucHJvdG90eXBlLmNvbXBsZXRlZCA9IGZ1bmN0aW9uKCkge1xuXHQgICAgICB2YXIgcmVzID0gdHJ5Q2F0Y2godGhpcy50Lm9uQ29tcGxldGVkKS5jYWxsKHRoaXMudCk7XG5cdCAgICAgIGlmIChyZXMgPT09IGVycm9yT2JqKSB7IHJldHVybiB0aGlzLm8ub25FcnJvcihyZXMuZSk7IH1cblx0ICAgICAgdGhpcy5vLm9uQ29tcGxldGVkKCk7XG5cdCAgICB9O1xuXHRcblx0ICAgIHJldHVybiBUYXBPYnNlcnZhYmxlO1xuXHQgIH0oT2JzZXJ2YWJsZUJhc2UpKTtcblx0XG5cdCAgLyoqXG5cdCAgKiAgSW52b2tlcyBhbiBhY3Rpb24gZm9yIGVhY2ggZWxlbWVudCBpbiB0aGUgb2JzZXJ2YWJsZSBzZXF1ZW5jZSBhbmQgaW52b2tlcyBhbiBhY3Rpb24gdXBvbiBncmFjZWZ1bCBvciBleGNlcHRpb25hbCB0ZXJtaW5hdGlvbiBvZiB0aGUgb2JzZXJ2YWJsZSBzZXF1ZW5jZS5cblx0ICAqICBUaGlzIG1ldGhvZCBjYW4gYmUgdXNlZCBmb3IgZGVidWdnaW5nLCBsb2dnaW5nLCBldGMuIG9mIHF1ZXJ5IGJlaGF2aW9yIGJ5IGludGVyY2VwdGluZyB0aGUgbWVzc2FnZSBzdHJlYW0gdG8gcnVuIGFyYml0cmFyeSBhY3Rpb25zIGZvciBtZXNzYWdlcyBvbiB0aGUgcGlwZWxpbmUuXG5cdCAgKiBAcGFyYW0ge0Z1bmN0aW9uIHwgT2JzZXJ2ZXJ9IG9ic2VydmVyT3JPbk5leHQgQWN0aW9uIHRvIGludm9rZSBmb3IgZWFjaCBlbGVtZW50IGluIHRoZSBvYnNlcnZhYmxlIHNlcXVlbmNlIG9yIGFuIG8uXG5cdCAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBbb25FcnJvcl0gIEFjdGlvbiB0byBpbnZva2UgdXBvbiBleGNlcHRpb25hbCB0ZXJtaW5hdGlvbiBvZiB0aGUgb2JzZXJ2YWJsZSBzZXF1ZW5jZS4gVXNlZCBpZiBvbmx5IHRoZSBvYnNlcnZlck9yT25OZXh0IHBhcmFtZXRlciBpcyBhbHNvIGEgZnVuY3Rpb24uXG5cdCAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBbb25Db21wbGV0ZWRdICBBY3Rpb24gdG8gaW52b2tlIHVwb24gZ3JhY2VmdWwgdGVybWluYXRpb24gb2YgdGhlIG9ic2VydmFibGUgc2VxdWVuY2UuIFVzZWQgaWYgb25seSB0aGUgb2JzZXJ2ZXJPck9uTmV4dCBwYXJhbWV0ZXIgaXMgYWxzbyBhIGZ1bmN0aW9uLlxuXHQgICogQHJldHVybnMge09ic2VydmFibGV9IFRoZSBzb3VyY2Ugc2VxdWVuY2Ugd2l0aCB0aGUgc2lkZS1lZmZlY3RpbmcgYmVoYXZpb3IgYXBwbGllZC5cblx0ICAqL1xuXHQgIG9ic2VydmFibGVQcm90b1snZG8nXSA9IG9ic2VydmFibGVQcm90by50YXAgPSBvYnNlcnZhYmxlUHJvdG8uZG9BY3Rpb24gPSBmdW5jdGlvbiAob2JzZXJ2ZXJPck9uTmV4dCwgb25FcnJvciwgb25Db21wbGV0ZWQpIHtcblx0ICAgIHJldHVybiBuZXcgVGFwT2JzZXJ2YWJsZSh0aGlzLCBvYnNlcnZlck9yT25OZXh0LCBvbkVycm9yLCBvbkNvbXBsZXRlZCk7XG5cdCAgfTtcblx0XG5cdCAgLyoqXG5cdCAgKiAgSW52b2tlcyBhbiBhY3Rpb24gZm9yIGVhY2ggZWxlbWVudCBpbiB0aGUgb2JzZXJ2YWJsZSBzZXF1ZW5jZS5cblx0ICAqICBUaGlzIG1ldGhvZCBjYW4gYmUgdXNlZCBmb3IgZGVidWdnaW5nLCBsb2dnaW5nLCBldGMuIG9mIHF1ZXJ5IGJlaGF2aW9yIGJ5IGludGVyY2VwdGluZyB0aGUgbWVzc2FnZSBzdHJlYW0gdG8gcnVuIGFyYml0cmFyeSBhY3Rpb25zIGZvciBtZXNzYWdlcyBvbiB0aGUgcGlwZWxpbmUuXG5cdCAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBvbk5leHQgQWN0aW9uIHRvIGludm9rZSBmb3IgZWFjaCBlbGVtZW50IGluIHRoZSBvYnNlcnZhYmxlIHNlcXVlbmNlLlxuXHQgICogQHBhcmFtIHtBbnl9IFt0aGlzQXJnXSBPYmplY3QgdG8gdXNlIGFzIHRoaXMgd2hlbiBleGVjdXRpbmcgY2FsbGJhY2suXG5cdCAgKiBAcmV0dXJucyB7T2JzZXJ2YWJsZX0gVGhlIHNvdXJjZSBzZXF1ZW5jZSB3aXRoIHRoZSBzaWRlLWVmZmVjdGluZyBiZWhhdmlvciBhcHBsaWVkLlxuXHQgICovXG5cdCAgb2JzZXJ2YWJsZVByb3RvLmRvT25OZXh0ID0gb2JzZXJ2YWJsZVByb3RvLnRhcE9uTmV4dCA9IGZ1bmN0aW9uIChvbk5leHQsIHRoaXNBcmcpIHtcblx0ICAgIHJldHVybiB0aGlzLnRhcCh0eXBlb2YgdGhpc0FyZyAhPT0gJ3VuZGVmaW5lZCcgPyBmdW5jdGlvbiAoeCkgeyBvbk5leHQuY2FsbCh0aGlzQXJnLCB4KTsgfSA6IG9uTmV4dCk7XG5cdCAgfTtcblx0XG5cdCAgLyoqXG5cdCAgKiAgSW52b2tlcyBhbiBhY3Rpb24gdXBvbiBleGNlcHRpb25hbCB0ZXJtaW5hdGlvbiBvZiB0aGUgb2JzZXJ2YWJsZSBzZXF1ZW5jZS5cblx0ICAqICBUaGlzIG1ldGhvZCBjYW4gYmUgdXNlZCBmb3IgZGVidWdnaW5nLCBsb2dnaW5nLCBldGMuIG9mIHF1ZXJ5IGJlaGF2aW9yIGJ5IGludGVyY2VwdGluZyB0aGUgbWVzc2FnZSBzdHJlYW0gdG8gcnVuIGFyYml0cmFyeSBhY3Rpb25zIGZvciBtZXNzYWdlcyBvbiB0aGUgcGlwZWxpbmUuXG5cdCAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBvbkVycm9yIEFjdGlvbiB0byBpbnZva2UgdXBvbiBleGNlcHRpb25hbCB0ZXJtaW5hdGlvbiBvZiB0aGUgb2JzZXJ2YWJsZSBzZXF1ZW5jZS5cblx0ICAqIEBwYXJhbSB7QW55fSBbdGhpc0FyZ10gT2JqZWN0IHRvIHVzZSBhcyB0aGlzIHdoZW4gZXhlY3V0aW5nIGNhbGxiYWNrLlxuXHQgICogQHJldHVybnMge09ic2VydmFibGV9IFRoZSBzb3VyY2Ugc2VxdWVuY2Ugd2l0aCB0aGUgc2lkZS1lZmZlY3RpbmcgYmVoYXZpb3IgYXBwbGllZC5cblx0ICAqL1xuXHQgIG9ic2VydmFibGVQcm90by5kb09uRXJyb3IgPSBvYnNlcnZhYmxlUHJvdG8udGFwT25FcnJvciA9IGZ1bmN0aW9uIChvbkVycm9yLCB0aGlzQXJnKSB7XG5cdCAgICByZXR1cm4gdGhpcy50YXAobm9vcCwgdHlwZW9mIHRoaXNBcmcgIT09ICd1bmRlZmluZWQnID8gZnVuY3Rpb24gKGUpIHsgb25FcnJvci5jYWxsKHRoaXNBcmcsIGUpOyB9IDogb25FcnJvcik7XG5cdCAgfTtcblx0XG5cdCAgLyoqXG5cdCAgKiAgSW52b2tlcyBhbiBhY3Rpb24gdXBvbiBncmFjZWZ1bCB0ZXJtaW5hdGlvbiBvZiB0aGUgb2JzZXJ2YWJsZSBzZXF1ZW5jZS5cblx0ICAqICBUaGlzIG1ldGhvZCBjYW4gYmUgdXNlZCBmb3IgZGVidWdnaW5nLCBsb2dnaW5nLCBldGMuIG9mIHF1ZXJ5IGJlaGF2aW9yIGJ5IGludGVyY2VwdGluZyB0aGUgbWVzc2FnZSBzdHJlYW0gdG8gcnVuIGFyYml0cmFyeSBhY3Rpb25zIGZvciBtZXNzYWdlcyBvbiB0aGUgcGlwZWxpbmUuXG5cdCAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBvbkNvbXBsZXRlZCBBY3Rpb24gdG8gaW52b2tlIHVwb24gZ3JhY2VmdWwgdGVybWluYXRpb24gb2YgdGhlIG9ic2VydmFibGUgc2VxdWVuY2UuXG5cdCAgKiBAcGFyYW0ge0FueX0gW3RoaXNBcmddIE9iamVjdCB0byB1c2UgYXMgdGhpcyB3aGVuIGV4ZWN1dGluZyBjYWxsYmFjay5cblx0ICAqIEByZXR1cm5zIHtPYnNlcnZhYmxlfSBUaGUgc291cmNlIHNlcXVlbmNlIHdpdGggdGhlIHNpZGUtZWZmZWN0aW5nIGJlaGF2aW9yIGFwcGxpZWQuXG5cdCAgKi9cblx0ICBvYnNlcnZhYmxlUHJvdG8uZG9PbkNvbXBsZXRlZCA9IG9ic2VydmFibGVQcm90by50YXBPbkNvbXBsZXRlZCA9IGZ1bmN0aW9uIChvbkNvbXBsZXRlZCwgdGhpc0FyZykge1xuXHQgICAgcmV0dXJuIHRoaXMudGFwKG5vb3AsIG51bGwsIHR5cGVvZiB0aGlzQXJnICE9PSAndW5kZWZpbmVkJyA/IGZ1bmN0aW9uICgpIHsgb25Db21wbGV0ZWQuY2FsbCh0aGlzQXJnKTsgfSA6IG9uQ29tcGxldGVkKTtcblx0ICB9O1xuXHRcblx0ICAvKipcblx0ICAgKiAgSW52b2tlcyBhIHNwZWNpZmllZCBhY3Rpb24gYWZ0ZXIgdGhlIHNvdXJjZSBvYnNlcnZhYmxlIHNlcXVlbmNlIHRlcm1pbmF0ZXMgZ3JhY2VmdWxseSBvciBleGNlcHRpb25hbGx5LlxuXHQgICAqIEBwYXJhbSB7RnVuY3Rpb259IGZpbmFsbHlBY3Rpb24gQWN0aW9uIHRvIGludm9rZSBhZnRlciB0aGUgc291cmNlIG9ic2VydmFibGUgc2VxdWVuY2UgdGVybWluYXRlcy5cblx0ICAgKiBAcmV0dXJucyB7T2JzZXJ2YWJsZX0gU291cmNlIHNlcXVlbmNlIHdpdGggdGhlIGFjdGlvbi1pbnZva2luZyB0ZXJtaW5hdGlvbiBiZWhhdmlvciBhcHBsaWVkLlxuXHQgICAqL1xuXHQgIG9ic2VydmFibGVQcm90b1snZmluYWxseSddID0gZnVuY3Rpb24gKGFjdGlvbikge1xuXHQgICAgdmFyIHNvdXJjZSA9IHRoaXM7XG5cdCAgICByZXR1cm4gbmV3IEFub255bW91c09ic2VydmFibGUoZnVuY3Rpb24gKG9ic2VydmVyKSB7XG5cdCAgICAgIHZhciBzdWJzY3JpcHRpb24gPSB0cnlDYXRjaChzb3VyY2Uuc3Vic2NyaWJlKS5jYWxsKHNvdXJjZSwgb2JzZXJ2ZXIpO1xuXHQgICAgICBpZiAoc3Vic2NyaXB0aW9uID09PSBlcnJvck9iaikge1xuXHQgICAgICAgIGFjdGlvbigpO1xuXHQgICAgICAgIHJldHVybiB0aHJvd2VyKHN1YnNjcmlwdGlvbi5lKTtcblx0ICAgICAgfVxuXHQgICAgICByZXR1cm4gZGlzcG9zYWJsZUNyZWF0ZShmdW5jdGlvbiAoKSB7XG5cdCAgICAgICAgdmFyIHIgPSB0cnlDYXRjaChzdWJzY3JpcHRpb24uZGlzcG9zZSkuY2FsbChzdWJzY3JpcHRpb24pO1xuXHQgICAgICAgIGFjdGlvbigpO1xuXHQgICAgICAgIHIgPT09IGVycm9yT2JqICYmIHRocm93ZXIoci5lKTtcblx0ICAgICAgfSk7XG5cdCAgICB9LCB0aGlzKTtcblx0ICB9O1xuXHRcblx0ICB2YXIgSWdub3JlRWxlbWVudHNPYnNlcnZhYmxlID0gKGZ1bmN0aW9uKF9fc3VwZXJfXykge1xuXHQgICAgaW5oZXJpdHMoSWdub3JlRWxlbWVudHNPYnNlcnZhYmxlLCBfX3N1cGVyX18pO1xuXHRcblx0ICAgIGZ1bmN0aW9uIElnbm9yZUVsZW1lbnRzT2JzZXJ2YWJsZShzb3VyY2UpIHtcblx0ICAgICAgdGhpcy5zb3VyY2UgPSBzb3VyY2U7XG5cdCAgICAgIF9fc3VwZXJfXy5jYWxsKHRoaXMpO1xuXHQgICAgfVxuXHRcblx0ICAgIElnbm9yZUVsZW1lbnRzT2JzZXJ2YWJsZS5wcm90b3R5cGUuc3Vic2NyaWJlQ29yZSA9IGZ1bmN0aW9uIChvKSB7XG5cdCAgICAgIHJldHVybiB0aGlzLnNvdXJjZS5zdWJzY3JpYmUobmV3IElubmVyT2JzZXJ2ZXIobykpO1xuXHQgICAgfTtcblx0XG5cdCAgICBmdW5jdGlvbiBJbm5lck9ic2VydmVyKG8pIHtcblx0ICAgICAgdGhpcy5vID0gbztcblx0ICAgICAgdGhpcy5pc1N0b3BwZWQgPSBmYWxzZTtcblx0ICAgIH1cblx0ICAgIElubmVyT2JzZXJ2ZXIucHJvdG90eXBlLm9uTmV4dCA9IG5vb3A7XG5cdCAgICBJbm5lck9ic2VydmVyLnByb3RvdHlwZS5vbkVycm9yID0gZnVuY3Rpb24gKGVycikge1xuXHQgICAgICBpZighdGhpcy5pc1N0b3BwZWQpIHtcblx0ICAgICAgICB0aGlzLmlzU3RvcHBlZCA9IHRydWU7XG5cdCAgICAgICAgdGhpcy5vLm9uRXJyb3IoZXJyKTtcblx0ICAgICAgfVxuXHQgICAgfTtcblx0ICAgIElubmVyT2JzZXJ2ZXIucHJvdG90eXBlLm9uQ29tcGxldGVkID0gZnVuY3Rpb24gKCkge1xuXHQgICAgICBpZighdGhpcy5pc1N0b3BwZWQpIHtcblx0ICAgICAgICB0aGlzLmlzU3RvcHBlZCA9IHRydWU7XG5cdCAgICAgICAgdGhpcy5vLm9uQ29tcGxldGVkKCk7XG5cdCAgICAgIH1cblx0ICAgIH07XG5cdCAgICBJbm5lck9ic2VydmVyLnByb3RvdHlwZS5kaXNwb3NlID0gZnVuY3Rpb24oKSB7IHRoaXMuaXNTdG9wcGVkID0gdHJ1ZTsgfTtcblx0ICAgIElubmVyT2JzZXJ2ZXIucHJvdG90eXBlLmZhaWwgPSBmdW5jdGlvbiAoZSkge1xuXHQgICAgICBpZiAoIXRoaXMuaXNTdG9wcGVkKSB7XG5cdCAgICAgICAgdGhpcy5pc1N0b3BwZWQgPSB0cnVlO1xuXHQgICAgICAgIHRoaXMub2JzZXJ2ZXIub25FcnJvcihlKTtcblx0ICAgICAgICByZXR1cm4gdHJ1ZTtcblx0ICAgICAgfVxuXHRcblx0ICAgICAgcmV0dXJuIGZhbHNlO1xuXHQgICAgfTtcblx0XG5cdCAgICByZXR1cm4gSWdub3JlRWxlbWVudHNPYnNlcnZhYmxlO1xuXHQgIH0oT2JzZXJ2YWJsZUJhc2UpKTtcblx0XG5cdCAgLyoqXG5cdCAgICogIElnbm9yZXMgYWxsIGVsZW1lbnRzIGluIGFuIG9ic2VydmFibGUgc2VxdWVuY2UgbGVhdmluZyBvbmx5IHRoZSB0ZXJtaW5hdGlvbiBtZXNzYWdlcy5cblx0ICAgKiBAcmV0dXJucyB7T2JzZXJ2YWJsZX0gQW4gZW1wdHkgb2JzZXJ2YWJsZSBzZXF1ZW5jZSB0aGF0IHNpZ25hbHMgdGVybWluYXRpb24sIHN1Y2Nlc3NmdWwgb3IgZXhjZXB0aW9uYWwsIG9mIHRoZSBzb3VyY2Ugc2VxdWVuY2UuXG5cdCAgICovXG5cdCAgb2JzZXJ2YWJsZVByb3RvLmlnbm9yZUVsZW1lbnRzID0gZnVuY3Rpb24gKCkge1xuXHQgICAgcmV0dXJuIG5ldyBJZ25vcmVFbGVtZW50c09ic2VydmFibGUodGhpcyk7XG5cdCAgfTtcblx0XG5cdCAgdmFyIE1hdGVyaWFsaXplT2JzZXJ2YWJsZSA9IChmdW5jdGlvbiAoX19zdXBlcl9fKSB7XG5cdCAgICBpbmhlcml0cyhNYXRlcmlhbGl6ZU9ic2VydmFibGUsIF9fc3VwZXJfXyk7XG5cdCAgICBmdW5jdGlvbiBNYXRlcmlhbGl6ZU9ic2VydmFibGUoc291cmNlLCBmbikge1xuXHQgICAgICB0aGlzLnNvdXJjZSA9IHNvdXJjZTtcblx0ICAgICAgX19zdXBlcl9fLmNhbGwodGhpcyk7XG5cdCAgICB9XG5cdFxuXHQgICAgTWF0ZXJpYWxpemVPYnNlcnZhYmxlLnByb3RvdHlwZS5zdWJzY3JpYmVDb3JlID0gZnVuY3Rpb24gKG8pIHtcblx0ICAgICAgcmV0dXJuIHRoaXMuc291cmNlLnN1YnNjcmliZShuZXcgTWF0ZXJpYWxpemVPYnNlcnZlcihvKSk7XG5cdCAgICB9O1xuXHRcblx0ICAgIHJldHVybiBNYXRlcmlhbGl6ZU9ic2VydmFibGU7XG5cdCAgfShPYnNlcnZhYmxlQmFzZSkpO1xuXHRcblx0ICB2YXIgTWF0ZXJpYWxpemVPYnNlcnZlciA9IChmdW5jdGlvbiAoX19zdXBlcl9fKSB7XG5cdCAgICBpbmhlcml0cyhNYXRlcmlhbGl6ZU9ic2VydmVyLCBfX3N1cGVyX18pO1xuXHRcblx0ICAgIGZ1bmN0aW9uIE1hdGVyaWFsaXplT2JzZXJ2ZXIobykge1xuXHQgICAgICB0aGlzLl9vID0gbztcblx0ICAgICAgX19zdXBlcl9fLmNhbGwodGhpcyk7XG5cdCAgICB9XG5cdFxuXHQgICAgTWF0ZXJpYWxpemVPYnNlcnZlci5wcm90b3R5cGUubmV4dCA9IGZ1bmN0aW9uICh4KSB7IHRoaXMuX28ub25OZXh0KG5vdGlmaWNhdGlvbkNyZWF0ZU9uTmV4dCh4KSkgfTtcblx0ICAgIE1hdGVyaWFsaXplT2JzZXJ2ZXIucHJvdG90eXBlLmVycm9yID0gZnVuY3Rpb24gKGUpIHsgdGhpcy5fby5vbk5leHQobm90aWZpY2F0aW9uQ3JlYXRlT25FcnJvcihlKSk7IHRoaXMuX28ub25Db21wbGV0ZWQoKTsgfTtcblx0ICAgIE1hdGVyaWFsaXplT2JzZXJ2ZXIucHJvdG90eXBlLmNvbXBsZXRlZCA9IGZ1bmN0aW9uICgpIHsgdGhpcy5fby5vbk5leHQobm90aWZpY2F0aW9uQ3JlYXRlT25Db21wbGV0ZWQoKSk7IHRoaXMuX28ub25Db21wbGV0ZWQoKTsgfTtcblx0XG5cdCAgICByZXR1cm4gTWF0ZXJpYWxpemVPYnNlcnZlcjtcblx0ICB9KEFic3RyYWN0T2JzZXJ2ZXIpKTtcblx0XG5cdCAgLyoqXG5cdCAgICogIE1hdGVyaWFsaXplcyB0aGUgaW1wbGljaXQgbm90aWZpY2F0aW9ucyBvZiBhbiBvYnNlcnZhYmxlIHNlcXVlbmNlIGFzIGV4cGxpY2l0IG5vdGlmaWNhdGlvbiB2YWx1ZXMuXG5cdCAgICogQHJldHVybnMge09ic2VydmFibGV9IEFuIG9ic2VydmFibGUgc2VxdWVuY2UgY29udGFpbmluZyB0aGUgbWF0ZXJpYWxpemVkIG5vdGlmaWNhdGlvbiB2YWx1ZXMgZnJvbSB0aGUgc291cmNlIHNlcXVlbmNlLlxuXHQgICAqL1xuXHQgIG9ic2VydmFibGVQcm90by5tYXRlcmlhbGl6ZSA9IGZ1bmN0aW9uICgpIHtcblx0ICAgIHJldHVybiBuZXcgTWF0ZXJpYWxpemVPYnNlcnZhYmxlKHRoaXMpO1xuXHQgIH07XG5cdFxuXHQgIC8qKlxuXHQgICAqICBSZXBlYXRzIHRoZSBvYnNlcnZhYmxlIHNlcXVlbmNlIGEgc3BlY2lmaWVkIG51bWJlciBvZiB0aW1lcy4gSWYgdGhlIHJlcGVhdCBjb3VudCBpcyBub3Qgc3BlY2lmaWVkLCB0aGUgc2VxdWVuY2UgcmVwZWF0cyBpbmRlZmluaXRlbHkuXG5cdCAgICogQHBhcmFtIHtOdW1iZXJ9IFtyZXBlYXRDb3VudF0gIE51bWJlciBvZiB0aW1lcyB0byByZXBlYXQgdGhlIHNlcXVlbmNlLiBJZiBub3QgcHJvdmlkZWQsIHJlcGVhdHMgdGhlIHNlcXVlbmNlIGluZGVmaW5pdGVseS5cblx0ICAgKiBAcmV0dXJucyB7T2JzZXJ2YWJsZX0gVGhlIG9ic2VydmFibGUgc2VxdWVuY2UgcHJvZHVjaW5nIHRoZSBlbGVtZW50cyBvZiB0aGUgZ2l2ZW4gc2VxdWVuY2UgcmVwZWF0ZWRseS5cblx0ICAgKi9cblx0ICBvYnNlcnZhYmxlUHJvdG8ucmVwZWF0ID0gZnVuY3Rpb24gKHJlcGVhdENvdW50KSB7XG5cdCAgICByZXR1cm4gZW51bWVyYWJsZVJlcGVhdCh0aGlzLCByZXBlYXRDb3VudCkuY29uY2F0KCk7XG5cdCAgfTtcblx0XG5cdCAgLyoqXG5cdCAgICogIFJlcGVhdHMgdGhlIHNvdXJjZSBvYnNlcnZhYmxlIHNlcXVlbmNlIHRoZSBzcGVjaWZpZWQgbnVtYmVyIG9mIHRpbWVzIG9yIHVudGlsIGl0IHN1Y2Nlc3NmdWxseSB0ZXJtaW5hdGVzLiBJZiB0aGUgcmV0cnkgY291bnQgaXMgbm90IHNwZWNpZmllZCwgaXQgcmV0cmllcyBpbmRlZmluaXRlbHkuXG5cdCAgICogIE5vdGUgaWYgeW91IGVuY291bnRlciBhbiBlcnJvciBhbmQgd2FudCBpdCB0byByZXRyeSBvbmNlLCB0aGVuIHlvdSBtdXN0IHVzZSAucmV0cnkoMik7XG5cdCAgICpcblx0ICAgKiBAZXhhbXBsZVxuXHQgICAqICB2YXIgcmVzID0gcmV0cmllZCA9IHJldHJ5LnJlcGVhdCgpO1xuXHQgICAqICB2YXIgcmVzID0gcmV0cmllZCA9IHJldHJ5LnJlcGVhdCgyKTtcblx0ICAgKiBAcGFyYW0ge051bWJlcn0gW3JldHJ5Q291bnRdICBOdW1iZXIgb2YgdGltZXMgdG8gcmV0cnkgdGhlIHNlcXVlbmNlLiBJZiBub3QgcHJvdmlkZWQsIHJldHJ5IHRoZSBzZXF1ZW5jZSBpbmRlZmluaXRlbHkuXG5cdCAgICogQHJldHVybnMge09ic2VydmFibGV9IEFuIG9ic2VydmFibGUgc2VxdWVuY2UgcHJvZHVjaW5nIHRoZSBlbGVtZW50cyBvZiB0aGUgZ2l2ZW4gc2VxdWVuY2UgcmVwZWF0ZWRseSB1bnRpbCBpdCB0ZXJtaW5hdGVzIHN1Y2Nlc3NmdWxseS5cblx0ICAgKi9cblx0ICBvYnNlcnZhYmxlUHJvdG8ucmV0cnkgPSBmdW5jdGlvbiAocmV0cnlDb3VudCkge1xuXHQgICAgcmV0dXJuIGVudW1lcmFibGVSZXBlYXQodGhpcywgcmV0cnlDb3VudCkuY2F0Y2hFcnJvcigpO1xuXHQgIH07XG5cdFxuXHQgIC8qKlxuXHQgICAqICBSZXBlYXRzIHRoZSBzb3VyY2Ugb2JzZXJ2YWJsZSBzZXF1ZW5jZSB1cG9uIGVycm9yIGVhY2ggdGltZSB0aGUgbm90aWZpZXIgZW1pdHMgb3IgdW50aWwgaXQgc3VjY2Vzc2Z1bGx5IHRlcm1pbmF0ZXMuIFxuXHQgICAqICBpZiB0aGUgbm90aWZpZXIgY29tcGxldGVzLCB0aGUgb2JzZXJ2YWJsZSBzZXF1ZW5jZSBjb21wbGV0ZXMuXG5cdCAgICpcblx0ICAgKiBAZXhhbXBsZVxuXHQgICAqICB2YXIgdGltZXIgPSBPYnNlcnZhYmxlLnRpbWVyKDUwMCk7XG5cdCAgICogIHZhciBzb3VyY2UgPSBvYnNlcnZhYmxlLnJldHJ5V2hlbih0aW1lcik7XG5cdCAgICogQHBhcmFtIHtPYnNlcnZhYmxlfSBbbm90aWZpZXJdIEFuIG9ic2VydmFibGUgdGhhdCB0cmlnZ2VycyB0aGUgcmV0cmllcyBvciBjb21wbGV0ZXMgdGhlIG9ic2VydmFibGUgd2l0aCBvbk5leHQgb3Igb25Db21wbGV0ZWQgcmVzcGVjdGl2ZWx5LlxuXHQgICAqIEByZXR1cm5zIHtPYnNlcnZhYmxlfSBBbiBvYnNlcnZhYmxlIHNlcXVlbmNlIHByb2R1Y2luZyB0aGUgZWxlbWVudHMgb2YgdGhlIGdpdmVuIHNlcXVlbmNlIHJlcGVhdGVkbHkgdW50aWwgaXQgdGVybWluYXRlcyBzdWNjZXNzZnVsbHkuXG5cdCAgICovXG5cdCAgb2JzZXJ2YWJsZVByb3RvLnJldHJ5V2hlbiA9IGZ1bmN0aW9uIChub3RpZmllcikge1xuXHQgICAgcmV0dXJuIGVudW1lcmFibGVSZXBlYXQodGhpcykuY2F0Y2hFcnJvcldoZW4obm90aWZpZXIpO1xuXHQgIH07XG5cdCAgdmFyIFNjYW5PYnNlcnZhYmxlID0gKGZ1bmN0aW9uKF9fc3VwZXJfXykge1xuXHQgICAgaW5oZXJpdHMoU2Nhbk9ic2VydmFibGUsIF9fc3VwZXJfXyk7XG5cdCAgICBmdW5jdGlvbiBTY2FuT2JzZXJ2YWJsZShzb3VyY2UsIGFjY3VtdWxhdG9yLCBoYXNTZWVkLCBzZWVkKSB7XG5cdCAgICAgIHRoaXMuc291cmNlID0gc291cmNlO1xuXHQgICAgICB0aGlzLmFjY3VtdWxhdG9yID0gYWNjdW11bGF0b3I7XG5cdCAgICAgIHRoaXMuaGFzU2VlZCA9IGhhc1NlZWQ7XG5cdCAgICAgIHRoaXMuc2VlZCA9IHNlZWQ7XG5cdCAgICAgIF9fc3VwZXJfXy5jYWxsKHRoaXMpO1xuXHQgICAgfVxuXHRcblx0ICAgIFNjYW5PYnNlcnZhYmxlLnByb3RvdHlwZS5zdWJzY3JpYmVDb3JlID0gZnVuY3Rpb24obykge1xuXHQgICAgICByZXR1cm4gdGhpcy5zb3VyY2Uuc3Vic2NyaWJlKG5ldyBTY2FuT2JzZXJ2ZXIobyx0aGlzKSk7XG5cdCAgICB9O1xuXHRcblx0ICAgIHJldHVybiBTY2FuT2JzZXJ2YWJsZTtcblx0ICB9KE9ic2VydmFibGVCYXNlKSk7XG5cdFxuXHQgIHZhciBTY2FuT2JzZXJ2ZXIgPSAoZnVuY3Rpb24gKF9fc3VwZXJfXykge1xuXHQgICAgaW5oZXJpdHMoU2Nhbk9ic2VydmVyLCBfX3N1cGVyX18pO1xuXHQgICAgZnVuY3Rpb24gU2Nhbk9ic2VydmVyKG8sIHBhcmVudCkge1xuXHQgICAgICB0aGlzLl9vID0gbztcblx0ICAgICAgdGhpcy5fcCA9IHBhcmVudDtcblx0ICAgICAgdGhpcy5fZm4gPSBwYXJlbnQuYWNjdW11bGF0b3I7XG5cdCAgICAgIHRoaXMuX2hzID0gcGFyZW50Lmhhc1NlZWQ7XG5cdCAgICAgIHRoaXMuX3MgPSBwYXJlbnQuc2VlZDtcblx0ICAgICAgdGhpcy5faGEgPSBmYWxzZTtcblx0ICAgICAgdGhpcy5fYSA9IG51bGw7XG5cdCAgICAgIHRoaXMuX2h2ID0gZmFsc2U7XG5cdCAgICAgIHRoaXMuX2kgPSAwO1xuXHQgICAgICBfX3N1cGVyX18uY2FsbCh0aGlzKTtcblx0ICAgIH1cblx0XG5cdCAgICBTY2FuT2JzZXJ2ZXIucHJvdG90eXBlLm5leHQgPSBmdW5jdGlvbiAoeCkge1xuXHQgICAgICAhdGhpcy5faHYgJiYgKHRoaXMuX2h2ID0gdHJ1ZSk7XG5cdCAgICAgIGlmICh0aGlzLl9oYSkge1xuXHQgICAgICAgIHRoaXMuX2EgPSB0cnlDYXRjaCh0aGlzLl9mbikodGhpcy5fYSwgeCwgdGhpcy5faSwgdGhpcy5fcCk7XG5cdCAgICAgIH0gZWxzZSB7XG5cdCAgICAgICAgdGhpcy5fYSA9IHRoaXMuX2hzID8gdHJ5Q2F0Y2godGhpcy5fZm4pKHRoaXMuX3MsIHgsIHRoaXMuX2ksIHRoaXMuX3ApIDogeDtcblx0ICAgICAgICB0aGlzLl9oYSA9IHRydWU7XG5cdCAgICAgIH1cblx0ICAgICAgaWYgKHRoaXMuX2EgPT09IGVycm9yT2JqKSB7IHJldHVybiB0aGlzLl9vLm9uRXJyb3IodGhpcy5fYS5lKTsgfVxuXHQgICAgICB0aGlzLl9vLm9uTmV4dCh0aGlzLl9hKTtcblx0ICAgICAgdGhpcy5faSsrO1xuXHQgICAgfTtcblx0XG5cdCAgICBTY2FuT2JzZXJ2ZXIucHJvdG90eXBlLmVycm9yID0gZnVuY3Rpb24gKGUpIHtcblx0ICAgICAgdGhpcy5fby5vbkVycm9yKGUpO1xuXHQgICAgfTtcblx0XG5cdCAgICBTY2FuT2JzZXJ2ZXIucHJvdG90eXBlLmNvbXBsZXRlZCA9IGZ1bmN0aW9uICgpIHtcblx0ICAgICAgIXRoaXMuX2h2ICYmIHRoaXMuX2hzICYmIHRoaXMuX28ub25OZXh0KHRoaXMuX3MpO1xuXHQgICAgICB0aGlzLl9vLm9uQ29tcGxldGVkKCk7XG5cdCAgICB9O1xuXHRcblx0ICAgIHJldHVybiBTY2FuT2JzZXJ2ZXI7XG5cdCAgfShBYnN0cmFjdE9ic2VydmVyKSk7XG5cdFxuXHQgIC8qKlxuXHQgICogIEFwcGxpZXMgYW4gYWNjdW11bGF0b3IgZnVuY3Rpb24gb3ZlciBhbiBvYnNlcnZhYmxlIHNlcXVlbmNlIGFuZCByZXR1cm5zIGVhY2ggaW50ZXJtZWRpYXRlIHJlc3VsdC4gVGhlIG9wdGlvbmFsIHNlZWQgdmFsdWUgaXMgdXNlZCBhcyB0aGUgaW5pdGlhbCBhY2N1bXVsYXRvciB2YWx1ZS5cblx0ICAqICBGb3IgYWdncmVnYXRpb24gYmVoYXZpb3Igd2l0aCBubyBpbnRlcm1lZGlhdGUgcmVzdWx0cywgc2VlIE9ic2VydmFibGUuYWdncmVnYXRlLlxuXHQgICogQHBhcmFtIHtNaXhlZH0gW3NlZWRdIFRoZSBpbml0aWFsIGFjY3VtdWxhdG9yIHZhbHVlLlxuXHQgICogQHBhcmFtIHtGdW5jdGlvbn0gYWNjdW11bGF0b3IgQW4gYWNjdW11bGF0b3IgZnVuY3Rpb24gdG8gYmUgaW52b2tlZCBvbiBlYWNoIGVsZW1lbnQuXG5cdCAgKiBAcmV0dXJucyB7T2JzZXJ2YWJsZX0gQW4gb2JzZXJ2YWJsZSBzZXF1ZW5jZSBjb250YWluaW5nIHRoZSBhY2N1bXVsYXRlZCB2YWx1ZXMuXG5cdCAgKi9cblx0ICBvYnNlcnZhYmxlUHJvdG8uc2NhbiA9IGZ1bmN0aW9uICgpIHtcblx0ICAgIHZhciBoYXNTZWVkID0gZmFsc2UsIHNlZWQsIGFjY3VtdWxhdG9yID0gYXJndW1lbnRzWzBdO1xuXHQgICAgaWYgKGFyZ3VtZW50cy5sZW5ndGggPT09IDIpIHtcblx0ICAgICAgaGFzU2VlZCA9IHRydWU7XG5cdCAgICAgIHNlZWQgPSBhcmd1bWVudHNbMV07XG5cdCAgICB9XG5cdCAgICByZXR1cm4gbmV3IFNjYW5PYnNlcnZhYmxlKHRoaXMsIGFjY3VtdWxhdG9yLCBoYXNTZWVkLCBzZWVkKTtcblx0ICB9O1xuXHRcblx0ICB2YXIgU2tpcExhc3RPYnNlcnZhYmxlID0gKGZ1bmN0aW9uIChfX3N1cGVyX18pIHtcblx0ICAgIGluaGVyaXRzKFNraXBMYXN0T2JzZXJ2YWJsZSwgX19zdXBlcl9fKTtcblx0ICAgIGZ1bmN0aW9uIFNraXBMYXN0T2JzZXJ2YWJsZShzb3VyY2UsIGMpIHtcblx0ICAgICAgdGhpcy5zb3VyY2UgPSBzb3VyY2U7XG5cdCAgICAgIHRoaXMuX2MgPSBjO1xuXHQgICAgICBfX3N1cGVyX18uY2FsbCh0aGlzKTtcblx0ICAgIH1cblx0XG5cdCAgICBTa2lwTGFzdE9ic2VydmFibGUucHJvdG90eXBlLnN1YnNjcmliZUNvcmUgPSBmdW5jdGlvbiAobykge1xuXHQgICAgICByZXR1cm4gdGhpcy5zb3VyY2Uuc3Vic2NyaWJlKG5ldyBTa2lwTGFzdE9ic2VydmVyKG8sIHRoaXMuX2MpKTtcblx0ICAgIH07XG5cdFxuXHQgICAgcmV0dXJuIFNraXBMYXN0T2JzZXJ2YWJsZTtcblx0ICB9KE9ic2VydmFibGVCYXNlKSk7XG5cdFxuXHQgIHZhciBTa2lwTGFzdE9ic2VydmVyID0gKGZ1bmN0aW9uIChfX3N1cGVyX18pIHtcblx0ICAgIGluaGVyaXRzKFNraXBMYXN0T2JzZXJ2ZXIsIF9fc3VwZXJfXyk7XG5cdCAgICBmdW5jdGlvbiBTa2lwTGFzdE9ic2VydmVyKG8sIGMpIHtcblx0ICAgICAgdGhpcy5fbyA9IG87XG5cdCAgICAgIHRoaXMuX2MgPSBjO1xuXHQgICAgICB0aGlzLl9xID0gW107XG5cdCAgICAgIF9fc3VwZXJfXy5jYWxsKHRoaXMpO1xuXHQgICAgfVxuXHRcblx0ICAgIFNraXBMYXN0T2JzZXJ2ZXIucHJvdG90eXBlLm5leHQgPSBmdW5jdGlvbiAoeCkge1xuXHQgICAgICB0aGlzLl9xLnB1c2goeCk7XG5cdCAgICAgIHRoaXMuX3EubGVuZ3RoID4gdGhpcy5fYyAmJiB0aGlzLl9vLm9uTmV4dCh0aGlzLl9xLnNoaWZ0KCkpO1xuXHQgICAgfTtcblx0XG5cdCAgICBTa2lwTGFzdE9ic2VydmVyLnByb3RvdHlwZS5lcnJvciA9IGZ1bmN0aW9uIChlKSB7XG5cdCAgICAgIHRoaXMuX28ub25FcnJvcihlKTtcblx0ICAgIH07XG5cdFxuXHQgICAgU2tpcExhc3RPYnNlcnZlci5wcm90b3R5cGUuY29tcGxldGVkID0gZnVuY3Rpb24gKCkge1xuXHQgICAgICB0aGlzLl9vLm9uQ29tcGxldGVkKCk7XG5cdCAgICB9O1xuXHRcblx0ICAgIHJldHVybiBTa2lwTGFzdE9ic2VydmVyO1xuXHQgIH0oQWJzdHJhY3RPYnNlcnZlcikpO1xuXHRcblx0ICAvKipcblx0ICAgKiAgQnlwYXNzZXMgYSBzcGVjaWZpZWQgbnVtYmVyIG9mIGVsZW1lbnRzIGF0IHRoZSBlbmQgb2YgYW4gb2JzZXJ2YWJsZSBzZXF1ZW5jZS5cblx0ICAgKiBAZGVzY3JpcHRpb25cblx0ICAgKiAgVGhpcyBvcGVyYXRvciBhY2N1bXVsYXRlcyBhIHF1ZXVlIHdpdGggYSBsZW5ndGggZW5vdWdoIHRvIHN0b3JlIHRoZSBmaXJzdCBgY291bnRgIGVsZW1lbnRzLiBBcyBtb3JlIGVsZW1lbnRzIGFyZVxuXHQgICAqICByZWNlaXZlZCwgZWxlbWVudHMgYXJlIHRha2VuIGZyb20gdGhlIGZyb250IG9mIHRoZSBxdWV1ZSBhbmQgcHJvZHVjZWQgb24gdGhlIHJlc3VsdCBzZXF1ZW5jZS4gVGhpcyBjYXVzZXMgZWxlbWVudHMgdG8gYmUgZGVsYXllZC5cblx0ICAgKiBAcGFyYW0gY291bnQgTnVtYmVyIG9mIGVsZW1lbnRzIHRvIGJ5cGFzcyBhdCB0aGUgZW5kIG9mIHRoZSBzb3VyY2Ugc2VxdWVuY2UuXG5cdCAgICogQHJldHVybnMge09ic2VydmFibGV9IEFuIG9ic2VydmFibGUgc2VxdWVuY2UgY29udGFpbmluZyB0aGUgc291cmNlIHNlcXVlbmNlIGVsZW1lbnRzIGV4Y2VwdCBmb3IgdGhlIGJ5cGFzc2VkIG9uZXMgYXQgdGhlIGVuZC5cblx0ICAgKi9cblx0ICBvYnNlcnZhYmxlUHJvdG8uc2tpcExhc3QgPSBmdW5jdGlvbiAoY291bnQpIHtcblx0ICAgIGlmIChjb3VudCA8IDApIHsgdGhyb3cgbmV3IEFyZ3VtZW50T3V0T2ZSYW5nZUVycm9yKCk7IH1cblx0ICAgIHJldHVybiBuZXcgU2tpcExhc3RPYnNlcnZhYmxlKHRoaXMsIGNvdW50KTtcblx0ICB9O1xuXHRcblx0ICAvKipcblx0ICAgKiAgUHJlcGVuZHMgYSBzZXF1ZW5jZSBvZiB2YWx1ZXMgdG8gYW4gb2JzZXJ2YWJsZSBzZXF1ZW5jZSB3aXRoIGFuIG9wdGlvbmFsIHNjaGVkdWxlciBhbmQgYW4gYXJndW1lbnQgbGlzdCBvZiB2YWx1ZXMgdG8gcHJlcGVuZC5cblx0ICAgKiAgQGV4YW1wbGVcblx0ICAgKiAgdmFyIHJlcyA9IHNvdXJjZS5zdGFydFdpdGgoMSwgMiwgMyk7XG5cdCAgICogIHZhciByZXMgPSBzb3VyY2Uuc3RhcnRXaXRoKFJ4LlNjaGVkdWxlci50aW1lb3V0LCAxLCAyLCAzKTtcblx0ICAgKiBAcGFyYW0ge0FyZ3VtZW50c30gYXJncyBUaGUgc3BlY2lmaWVkIHZhbHVlcyB0byBwcmVwZW5kIHRvIHRoZSBvYnNlcnZhYmxlIHNlcXVlbmNlXG5cdCAgICogQHJldHVybnMge09ic2VydmFibGV9IFRoZSBzb3VyY2Ugc2VxdWVuY2UgcHJlcGVuZGVkIHdpdGggdGhlIHNwZWNpZmllZCB2YWx1ZXMuXG5cdCAgICovXG5cdCAgb2JzZXJ2YWJsZVByb3RvLnN0YXJ0V2l0aCA9IGZ1bmN0aW9uICgpIHtcblx0ICAgIHZhciB2YWx1ZXMsIHNjaGVkdWxlciwgc3RhcnQgPSAwO1xuXHQgICAgaWYgKCEhYXJndW1lbnRzLmxlbmd0aCAmJiBpc1NjaGVkdWxlcihhcmd1bWVudHNbMF0pKSB7XG5cdCAgICAgIHNjaGVkdWxlciA9IGFyZ3VtZW50c1swXTtcblx0ICAgICAgc3RhcnQgPSAxO1xuXHQgICAgfSBlbHNlIHtcblx0ICAgICAgc2NoZWR1bGVyID0gaW1tZWRpYXRlU2NoZWR1bGVyO1xuXHQgICAgfVxuXHQgICAgZm9yKHZhciBhcmdzID0gW10sIGkgPSBzdGFydCwgbGVuID0gYXJndW1lbnRzLmxlbmd0aDsgaSA8IGxlbjsgaSsrKSB7IGFyZ3MucHVzaChhcmd1bWVudHNbaV0pOyB9XG5cdCAgICByZXR1cm4gZW51bWVyYWJsZU9mKFtvYnNlcnZhYmxlRnJvbUFycmF5KGFyZ3MsIHNjaGVkdWxlciksIHRoaXNdKS5jb25jYXQoKTtcblx0ICB9O1xuXHRcblx0ICB2YXIgVGFrZUxhc3RPYnNlcnZlciA9IChmdW5jdGlvbiAoX19zdXBlcl9fKSB7XG5cdCAgICBpbmhlcml0cyhUYWtlTGFzdE9ic2VydmVyLCBfX3N1cGVyX18pO1xuXHQgICAgZnVuY3Rpb24gVGFrZUxhc3RPYnNlcnZlcihvLCBjKSB7XG5cdCAgICAgIHRoaXMuX28gPSBvO1xuXHQgICAgICB0aGlzLl9jID0gYztcblx0ICAgICAgdGhpcy5fcSA9IFtdO1xuXHQgICAgICBfX3N1cGVyX18uY2FsbCh0aGlzKTtcblx0ICAgIH1cblx0XG5cdCAgICBUYWtlTGFzdE9ic2VydmVyLnByb3RvdHlwZS5uZXh0ID0gZnVuY3Rpb24gKHgpIHtcblx0ICAgICAgdGhpcy5fcS5wdXNoKHgpO1xuXHQgICAgICB0aGlzLl9xLmxlbmd0aCA+IHRoaXMuX2MgJiYgdGhpcy5fcS5zaGlmdCgpO1xuXHQgICAgfTtcblx0XG5cdCAgICBUYWtlTGFzdE9ic2VydmVyLnByb3RvdHlwZS5lcnJvciA9IGZ1bmN0aW9uIChlKSB7XG5cdCAgICAgIHRoaXMuX28ub25FcnJvcihlKTtcblx0ICAgIH07XG5cdFxuXHQgICAgVGFrZUxhc3RPYnNlcnZlci5wcm90b3R5cGUuY29tcGxldGVkID0gZnVuY3Rpb24gKCkge1xuXHQgICAgICB3aGlsZSAodGhpcy5fcS5sZW5ndGggPiAwKSB7IHRoaXMuX28ub25OZXh0KHRoaXMuX3Euc2hpZnQoKSk7IH1cblx0ICAgICAgdGhpcy5fby5vbkNvbXBsZXRlZCgpO1xuXHQgICAgfTtcblx0XG5cdCAgICByZXR1cm4gVGFrZUxhc3RPYnNlcnZlcjtcblx0ICB9KEFic3RyYWN0T2JzZXJ2ZXIpKTtcblx0XG5cdCAgLyoqXG5cdCAgICogIFJldHVybnMgYSBzcGVjaWZpZWQgbnVtYmVyIG9mIGNvbnRpZ3VvdXMgZWxlbWVudHMgZnJvbSB0aGUgZW5kIG9mIGFuIG9ic2VydmFibGUgc2VxdWVuY2UuXG5cdCAgICogQGRlc2NyaXB0aW9uXG5cdCAgICogIFRoaXMgb3BlcmF0b3IgYWNjdW11bGF0ZXMgYSBidWZmZXIgd2l0aCBhIGxlbmd0aCBlbm91Z2ggdG8gc3RvcmUgZWxlbWVudHMgY291bnQgZWxlbWVudHMuIFVwb24gY29tcGxldGlvbiBvZlxuXHQgICAqICB0aGUgc291cmNlIHNlcXVlbmNlLCB0aGlzIGJ1ZmZlciBpcyBkcmFpbmVkIG9uIHRoZSByZXN1bHQgc2VxdWVuY2UuIFRoaXMgY2F1c2VzIHRoZSBlbGVtZW50cyB0byBiZSBkZWxheWVkLlxuXHQgICAqIEBwYXJhbSB7TnVtYmVyfSBjb3VudCBOdW1iZXIgb2YgZWxlbWVudHMgdG8gdGFrZSBmcm9tIHRoZSBlbmQgb2YgdGhlIHNvdXJjZSBzZXF1ZW5jZS5cblx0ICAgKiBAcmV0dXJucyB7T2JzZXJ2YWJsZX0gQW4gb2JzZXJ2YWJsZSBzZXF1ZW5jZSBjb250YWluaW5nIHRoZSBzcGVjaWZpZWQgbnVtYmVyIG9mIGVsZW1lbnRzIGZyb20gdGhlIGVuZCBvZiB0aGUgc291cmNlIHNlcXVlbmNlLlxuXHQgICAqL1xuXHQgIG9ic2VydmFibGVQcm90by50YWtlTGFzdCA9IGZ1bmN0aW9uIChjb3VudCkge1xuXHQgICAgaWYgKGNvdW50IDwgMCkgeyB0aHJvdyBuZXcgQXJndW1lbnRPdXRPZlJhbmdlRXJyb3IoKTsgfVxuXHQgICAgdmFyIHNvdXJjZSA9IHRoaXM7XG5cdCAgICByZXR1cm4gbmV3IEFub255bW91c09ic2VydmFibGUoZnVuY3Rpb24gKG8pIHtcblx0ICAgICAgcmV0dXJuIHNvdXJjZS5zdWJzY3JpYmUobmV3IFRha2VMYXN0T2JzZXJ2ZXIobywgY291bnQpKTtcblx0ICAgIH0sIHNvdXJjZSk7XG5cdCAgfTtcblx0XG5cdCAgdmFyIFRha2VMYXN0QnVmZmVyT2JzZXJ2ZXIgPSAoZnVuY3Rpb24gKF9fc3VwZXJfXykge1xuXHQgICAgaW5oZXJpdHMoVGFrZUxhc3RCdWZmZXJPYnNlcnZlciwgX19zdXBlcl9fKTtcblx0ICAgIGZ1bmN0aW9uIFRha2VMYXN0QnVmZmVyT2JzZXJ2ZXIobywgYykge1xuXHQgICAgICB0aGlzLl9vID0gbztcblx0ICAgICAgdGhpcy5fYyA9IGM7XG5cdCAgICAgIHRoaXMuX3EgPSBbXTtcblx0ICAgICAgX19zdXBlcl9fLmNhbGwodGhpcyk7XG5cdCAgICB9XG5cdFxuXHQgICAgVGFrZUxhc3RCdWZmZXJPYnNlcnZlci5wcm90b3R5cGUubmV4dCA9IGZ1bmN0aW9uICh4KSB7XG5cdCAgICAgIHRoaXMuX3EucHVzaCh4KTtcblx0ICAgICAgdGhpcy5fcS5sZW5ndGggPiB0aGlzLl9jICYmIHRoaXMuX3Euc2hpZnQoKTtcblx0ICAgIH07XG5cdFxuXHQgICAgVGFrZUxhc3RCdWZmZXJPYnNlcnZlci5wcm90b3R5cGUuZXJyb3IgPSBmdW5jdGlvbiAoZSkge1xuXHQgICAgICB0aGlzLl9vLm9uRXJyb3IoZSk7XG5cdCAgICB9O1xuXHRcblx0ICAgIFRha2VMYXN0QnVmZmVyT2JzZXJ2ZXIucHJvdG90eXBlLmNvbXBsZXRlZCA9IGZ1bmN0aW9uICgpIHtcblx0ICAgICAgdGhpcy5fby5vbk5leHQodGhpcy5fcSk7XG5cdCAgICAgIHRoaXMuX28ub25Db21wbGV0ZWQoKTtcblx0ICAgIH07XG5cdFxuXHQgICAgcmV0dXJuIFRha2VMYXN0QnVmZmVyT2JzZXJ2ZXI7XG5cdCAgfShBYnN0cmFjdE9ic2VydmVyKSk7XG5cdFxuXHQgIC8qKlxuXHQgICAqICBSZXR1cm5zIGFuIGFycmF5IHdpdGggdGhlIHNwZWNpZmllZCBudW1iZXIgb2YgY29udGlndW91cyBlbGVtZW50cyBmcm9tIHRoZSBlbmQgb2YgYW4gb2JzZXJ2YWJsZSBzZXF1ZW5jZS5cblx0ICAgKlxuXHQgICAqIEBkZXNjcmlwdGlvblxuXHQgICAqICBUaGlzIG9wZXJhdG9yIGFjY3VtdWxhdGVzIGEgYnVmZmVyIHdpdGggYSBsZW5ndGggZW5vdWdoIHRvIHN0b3JlIGNvdW50IGVsZW1lbnRzLiBVcG9uIGNvbXBsZXRpb24gb2YgdGhlXG5cdCAgICogIHNvdXJjZSBzZXF1ZW5jZSwgdGhpcyBidWZmZXIgaXMgcHJvZHVjZWQgb24gdGhlIHJlc3VsdCBzZXF1ZW5jZS5cblx0ICAgKiBAcGFyYW0ge051bWJlcn0gY291bnQgTnVtYmVyIG9mIGVsZW1lbnRzIHRvIHRha2UgZnJvbSB0aGUgZW5kIG9mIHRoZSBzb3VyY2Ugc2VxdWVuY2UuXG5cdCAgICogQHJldHVybnMge09ic2VydmFibGV9IEFuIG9ic2VydmFibGUgc2VxdWVuY2UgY29udGFpbmluZyBhIHNpbmdsZSBhcnJheSB3aXRoIHRoZSBzcGVjaWZpZWQgbnVtYmVyIG9mIGVsZW1lbnRzIGZyb20gdGhlIGVuZCBvZiB0aGUgc291cmNlIHNlcXVlbmNlLlxuXHQgICAqL1xuXHQgIG9ic2VydmFibGVQcm90by50YWtlTGFzdEJ1ZmZlciA9IGZ1bmN0aW9uIChjb3VudCkge1xuXHQgICAgaWYgKGNvdW50IDwgMCkgeyB0aHJvdyBuZXcgQXJndW1lbnRPdXRPZlJhbmdlRXJyb3IoKTsgfVxuXHQgICAgdmFyIHNvdXJjZSA9IHRoaXM7XG5cdCAgICByZXR1cm4gbmV3IEFub255bW91c09ic2VydmFibGUoZnVuY3Rpb24gKG8pIHtcblx0ICAgICAgcmV0dXJuIHNvdXJjZS5zdWJzY3JpYmUobmV3IFRha2VMYXN0QnVmZmVyT2JzZXJ2ZXIobywgY291bnQpKTtcblx0ICAgIH0sIHNvdXJjZSk7XG5cdCAgfTtcblx0XG5cdCAgLyoqXG5cdCAgICogIFByb2plY3RzIGVhY2ggZWxlbWVudCBvZiBhbiBvYnNlcnZhYmxlIHNlcXVlbmNlIGludG8gemVybyBvciBtb3JlIHdpbmRvd3Mgd2hpY2ggYXJlIHByb2R1Y2VkIGJhc2VkIG9uIGVsZW1lbnQgY291bnQgaW5mb3JtYXRpb24uXG5cdCAgICogQHBhcmFtIHtOdW1iZXJ9IGNvdW50IExlbmd0aCBvZiBlYWNoIHdpbmRvdy5cblx0ICAgKiBAcGFyYW0ge051bWJlcn0gW3NraXBdIE51bWJlciBvZiBlbGVtZW50cyB0byBza2lwIGJldHdlZW4gY3JlYXRpb24gb2YgY29uc2VjdXRpdmUgd2luZG93cy4gSWYgbm90IHNwZWNpZmllZCwgZGVmYXVsdHMgdG8gdGhlIGNvdW50LlxuXHQgICAqIEByZXR1cm5zIHtPYnNlcnZhYmxlfSBBbiBvYnNlcnZhYmxlIHNlcXVlbmNlIG9mIHdpbmRvd3MuXG5cdCAgICovXG5cdCAgb2JzZXJ2YWJsZVByb3RvLndpbmRvd1dpdGhDb3VudCA9IGZ1bmN0aW9uIChjb3VudCwgc2tpcCkge1xuXHQgICAgdmFyIHNvdXJjZSA9IHRoaXM7XG5cdCAgICArY291bnQgfHwgKGNvdW50ID0gMCk7XG5cdCAgICBNYXRoLmFicyhjb3VudCkgPT09IEluZmluaXR5ICYmIChjb3VudCA9IDApO1xuXHQgICAgaWYgKGNvdW50IDw9IDApIHsgdGhyb3cgbmV3IEFyZ3VtZW50T3V0T2ZSYW5nZUVycm9yKCk7IH1cblx0ICAgIHNraXAgPT0gbnVsbCAmJiAoc2tpcCA9IGNvdW50KTtcblx0ICAgICtza2lwIHx8IChza2lwID0gMCk7XG5cdCAgICBNYXRoLmFicyhza2lwKSA9PT0gSW5maW5pdHkgJiYgKHNraXAgPSAwKTtcblx0XG5cdCAgICBpZiAoc2tpcCA8PSAwKSB7IHRocm93IG5ldyBBcmd1bWVudE91dE9mUmFuZ2VFcnJvcigpOyB9XG5cdCAgICByZXR1cm4gbmV3IEFub255bW91c09ic2VydmFibGUoZnVuY3Rpb24gKG9ic2VydmVyKSB7XG5cdCAgICAgIHZhciBtID0gbmV3IFNpbmdsZUFzc2lnbm1lbnREaXNwb3NhYmxlKCksXG5cdCAgICAgICAgcmVmQ291bnREaXNwb3NhYmxlID0gbmV3IFJlZkNvdW50RGlzcG9zYWJsZShtKSxcblx0ICAgICAgICBuID0gMCxcblx0ICAgICAgICBxID0gW107XG5cdFxuXHQgICAgICBmdW5jdGlvbiBjcmVhdGVXaW5kb3cgKCkge1xuXHQgICAgICAgIHZhciBzID0gbmV3IFN1YmplY3QoKTtcblx0ICAgICAgICBxLnB1c2gocyk7XG5cdCAgICAgICAgb2JzZXJ2ZXIub25OZXh0KGFkZFJlZihzLCByZWZDb3VudERpc3Bvc2FibGUpKTtcblx0ICAgICAgfVxuXHRcblx0ICAgICAgY3JlYXRlV2luZG93KCk7XG5cdFxuXHQgICAgICBtLnNldERpc3Bvc2FibGUoc291cmNlLnN1YnNjcmliZShcblx0ICAgICAgICBmdW5jdGlvbiAoeCkge1xuXHQgICAgICAgICAgZm9yICh2YXIgaSA9IDAsIGxlbiA9IHEubGVuZ3RoOyBpIDwgbGVuOyBpKyspIHsgcVtpXS5vbk5leHQoeCk7IH1cblx0ICAgICAgICAgIHZhciBjID0gbiAtIGNvdW50ICsgMTtcblx0ICAgICAgICAgIGMgPj0gMCAmJiBjICUgc2tpcCA9PT0gMCAmJiBxLnNoaWZ0KCkub25Db21wbGV0ZWQoKTtcblx0ICAgICAgICAgICsrbiAlIHNraXAgPT09IDAgJiYgY3JlYXRlV2luZG93KCk7XG5cdCAgICAgICAgfSxcblx0ICAgICAgICBmdW5jdGlvbiAoZSkge1xuXHQgICAgICAgICAgd2hpbGUgKHEubGVuZ3RoID4gMCkgeyBxLnNoaWZ0KCkub25FcnJvcihlKTsgfVxuXHQgICAgICAgICAgb2JzZXJ2ZXIub25FcnJvcihlKTtcblx0ICAgICAgICB9LFxuXHQgICAgICAgIGZ1bmN0aW9uICgpIHtcblx0ICAgICAgICAgIHdoaWxlIChxLmxlbmd0aCA+IDApIHsgcS5zaGlmdCgpLm9uQ29tcGxldGVkKCk7IH1cblx0ICAgICAgICAgIG9ic2VydmVyLm9uQ29tcGxldGVkKCk7XG5cdCAgICAgICAgfVxuXHQgICAgICApKTtcblx0ICAgICAgcmV0dXJuIHJlZkNvdW50RGlzcG9zYWJsZTtcblx0ICAgIH0sIHNvdXJjZSk7XG5cdCAgfTtcblx0XG5cdCAgZnVuY3Rpb24gY29uY2F0TWFwKHNvdXJjZSwgc2VsZWN0b3IsIHRoaXNBcmcpIHtcblx0ICAgIHZhciBzZWxlY3RvckZ1bmMgPSBiaW5kQ2FsbGJhY2soc2VsZWN0b3IsIHRoaXNBcmcsIDMpO1xuXHQgICAgcmV0dXJuIHNvdXJjZS5tYXAoZnVuY3Rpb24gKHgsIGkpIHtcblx0ICAgICAgdmFyIHJlc3VsdCA9IHNlbGVjdG9yRnVuYyh4LCBpLCBzb3VyY2UpO1xuXHQgICAgICBpc1Byb21pc2UocmVzdWx0KSAmJiAocmVzdWx0ID0gb2JzZXJ2YWJsZUZyb21Qcm9taXNlKHJlc3VsdCkpO1xuXHQgICAgICAoaXNBcnJheUxpa2UocmVzdWx0KSB8fCBpc0l0ZXJhYmxlKHJlc3VsdCkpICYmIChyZXN1bHQgPSBvYnNlcnZhYmxlRnJvbShyZXN1bHQpKTtcblx0ICAgICAgcmV0dXJuIHJlc3VsdDtcblx0ICAgIH0pLmNvbmNhdEFsbCgpO1xuXHQgIH1cblx0XG5cdCAgLyoqXG5cdCAgICogIE9uZSBvZiB0aGUgRm9sbG93aW5nOlxuXHQgICAqICBQcm9qZWN0cyBlYWNoIGVsZW1lbnQgb2YgYW4gb2JzZXJ2YWJsZSBzZXF1ZW5jZSB0byBhbiBvYnNlcnZhYmxlIHNlcXVlbmNlIGFuZCBtZXJnZXMgdGhlIHJlc3VsdGluZyBvYnNlcnZhYmxlIHNlcXVlbmNlcyBpbnRvIG9uZSBvYnNlcnZhYmxlIHNlcXVlbmNlLlxuXHQgICAqXG5cdCAgICogQGV4YW1wbGVcblx0ICAgKiAgdmFyIHJlcyA9IHNvdXJjZS5jb25jYXRNYXAoZnVuY3Rpb24gKHgpIHsgcmV0dXJuIFJ4Lk9ic2VydmFibGUucmFuZ2UoMCwgeCk7IH0pO1xuXHQgICAqICBPcjpcblx0ICAgKiAgUHJvamVjdHMgZWFjaCBlbGVtZW50IG9mIGFuIG9ic2VydmFibGUgc2VxdWVuY2UgdG8gYW4gb2JzZXJ2YWJsZSBzZXF1ZW5jZSwgaW52b2tlcyB0aGUgcmVzdWx0IHNlbGVjdG9yIGZvciB0aGUgc291cmNlIGVsZW1lbnQgYW5kIGVhY2ggb2YgdGhlIGNvcnJlc3BvbmRpbmcgaW5uZXIgc2VxdWVuY2UncyBlbGVtZW50cywgYW5kIG1lcmdlcyB0aGUgcmVzdWx0cyBpbnRvIG9uZSBvYnNlcnZhYmxlIHNlcXVlbmNlLlxuXHQgICAqXG5cdCAgICogIHZhciByZXMgPSBzb3VyY2UuY29uY2F0TWFwKGZ1bmN0aW9uICh4KSB7IHJldHVybiBSeC5PYnNlcnZhYmxlLnJhbmdlKDAsIHgpOyB9LCBmdW5jdGlvbiAoeCwgeSkgeyByZXR1cm4geCArIHk7IH0pO1xuXHQgICAqICBPcjpcblx0ICAgKiAgUHJvamVjdHMgZWFjaCBlbGVtZW50IG9mIHRoZSBzb3VyY2Ugb2JzZXJ2YWJsZSBzZXF1ZW5jZSB0byB0aGUgb3RoZXIgb2JzZXJ2YWJsZSBzZXF1ZW5jZSBhbmQgbWVyZ2VzIHRoZSByZXN1bHRpbmcgb2JzZXJ2YWJsZSBzZXF1ZW5jZXMgaW50byBvbmUgb2JzZXJ2YWJsZSBzZXF1ZW5jZS5cblx0ICAgKlxuXHQgICAqICB2YXIgcmVzID0gc291cmNlLmNvbmNhdE1hcChSeC5PYnNlcnZhYmxlLmZyb21BcnJheShbMSwyLDNdKSk7XG5cdCAgICogQHBhcmFtIHtGdW5jdGlvbn0gc2VsZWN0b3IgQSB0cmFuc2Zvcm0gZnVuY3Rpb24gdG8gYXBwbHkgdG8gZWFjaCBlbGVtZW50IG9yIGFuIG9ic2VydmFibGUgc2VxdWVuY2UgdG8gcHJvamVjdCBlYWNoIGVsZW1lbnQgZnJvbSB0aGVcblx0ICAgKiBzb3VyY2Ugc2VxdWVuY2Ugb250byB3aGljaCBjb3VsZCBiZSBlaXRoZXIgYW4gb2JzZXJ2YWJsZSBvciBQcm9taXNlLlxuXHQgICAqIEBwYXJhbSB7RnVuY3Rpb259IFtyZXN1bHRTZWxlY3Rvcl0gIEEgdHJhbnNmb3JtIGZ1bmN0aW9uIHRvIGFwcGx5IHRvIGVhY2ggZWxlbWVudCBvZiB0aGUgaW50ZXJtZWRpYXRlIHNlcXVlbmNlLlxuXHQgICAqIEByZXR1cm5zIHtPYnNlcnZhYmxlfSBBbiBvYnNlcnZhYmxlIHNlcXVlbmNlIHdob3NlIGVsZW1lbnRzIGFyZSB0aGUgcmVzdWx0IG9mIGludm9raW5nIHRoZSBvbmUtdG8tbWFueSB0cmFuc2Zvcm0gZnVuY3Rpb24gY29sbGVjdGlvblNlbGVjdG9yIG9uIGVhY2ggZWxlbWVudCBvZiB0aGUgaW5wdXQgc2VxdWVuY2UgYW5kIHRoZW4gbWFwcGluZyBlYWNoIG9mIHRob3NlIHNlcXVlbmNlIGVsZW1lbnRzIGFuZCB0aGVpciBjb3JyZXNwb25kaW5nIHNvdXJjZSBlbGVtZW50IHRvIGEgcmVzdWx0IGVsZW1lbnQuXG5cdCAgICovXG5cdCAgb2JzZXJ2YWJsZVByb3RvLnNlbGVjdENvbmNhdCA9IG9ic2VydmFibGVQcm90by5jb25jYXRNYXAgPSBmdW5jdGlvbiAoc2VsZWN0b3IsIHJlc3VsdFNlbGVjdG9yLCB0aGlzQXJnKSB7XG5cdCAgICBpZiAoaXNGdW5jdGlvbihzZWxlY3RvcikgJiYgaXNGdW5jdGlvbihyZXN1bHRTZWxlY3RvcikpIHtcblx0ICAgICAgcmV0dXJuIHRoaXMuY29uY2F0TWFwKGZ1bmN0aW9uICh4LCBpKSB7XG5cdCAgICAgICAgdmFyIHNlbGVjdG9yUmVzdWx0ID0gc2VsZWN0b3IoeCwgaSk7XG5cdCAgICAgICAgaXNQcm9taXNlKHNlbGVjdG9yUmVzdWx0KSAmJiAoc2VsZWN0b3JSZXN1bHQgPSBvYnNlcnZhYmxlRnJvbVByb21pc2Uoc2VsZWN0b3JSZXN1bHQpKTtcblx0ICAgICAgICAoaXNBcnJheUxpa2Uoc2VsZWN0b3JSZXN1bHQpIHx8IGlzSXRlcmFibGUoc2VsZWN0b3JSZXN1bHQpKSAmJiAoc2VsZWN0b3JSZXN1bHQgPSBvYnNlcnZhYmxlRnJvbShzZWxlY3RvclJlc3VsdCkpO1xuXHRcblx0ICAgICAgICByZXR1cm4gc2VsZWN0b3JSZXN1bHQubWFwKGZ1bmN0aW9uICh5LCBpMikge1xuXHQgICAgICAgICAgcmV0dXJuIHJlc3VsdFNlbGVjdG9yKHgsIHksIGksIGkyKTtcblx0ICAgICAgICB9KTtcblx0ICAgICAgfSk7XG5cdCAgICB9XG5cdCAgICByZXR1cm4gaXNGdW5jdGlvbihzZWxlY3RvcikgP1xuXHQgICAgICBjb25jYXRNYXAodGhpcywgc2VsZWN0b3IsIHRoaXNBcmcpIDpcblx0ICAgICAgY29uY2F0TWFwKHRoaXMsIGZ1bmN0aW9uICgpIHsgcmV0dXJuIHNlbGVjdG9yOyB9KTtcblx0ICB9O1xuXHRcblx0ICAvKipcblx0ICAgKiBQcm9qZWN0cyBlYWNoIG5vdGlmaWNhdGlvbiBvZiBhbiBvYnNlcnZhYmxlIHNlcXVlbmNlIHRvIGFuIG9ic2VydmFibGUgc2VxdWVuY2UgYW5kIGNvbmNhdHMgdGhlIHJlc3VsdGluZyBvYnNlcnZhYmxlIHNlcXVlbmNlcyBpbnRvIG9uZSBvYnNlcnZhYmxlIHNlcXVlbmNlLlxuXHQgICAqIEBwYXJhbSB7RnVuY3Rpb259IG9uTmV4dCBBIHRyYW5zZm9ybSBmdW5jdGlvbiB0byBhcHBseSB0byBlYWNoIGVsZW1lbnQ7IHRoZSBzZWNvbmQgcGFyYW1ldGVyIG9mIHRoZSBmdW5jdGlvbiByZXByZXNlbnRzIHRoZSBpbmRleCBvZiB0aGUgc291cmNlIGVsZW1lbnQuXG5cdCAgICogQHBhcmFtIHtGdW5jdGlvbn0gb25FcnJvciBBIHRyYW5zZm9ybSBmdW5jdGlvbiB0byBhcHBseSB3aGVuIGFuIGVycm9yIG9jY3VycyBpbiB0aGUgc291cmNlIHNlcXVlbmNlLlxuXHQgICAqIEBwYXJhbSB7RnVuY3Rpb259IG9uQ29tcGxldGVkIEEgdHJhbnNmb3JtIGZ1bmN0aW9uIHRvIGFwcGx5IHdoZW4gdGhlIGVuZCBvZiB0aGUgc291cmNlIHNlcXVlbmNlIGlzIHJlYWNoZWQuXG5cdCAgICogQHBhcmFtIHtBbnl9IFt0aGlzQXJnXSBBbiBvcHRpb25hbCBcInRoaXNcIiB0byB1c2UgdG8gaW52b2tlIGVhY2ggdHJhbnNmb3JtLlxuXHQgICAqIEByZXR1cm5zIHtPYnNlcnZhYmxlfSBBbiBvYnNlcnZhYmxlIHNlcXVlbmNlIHdob3NlIGVsZW1lbnRzIGFyZSB0aGUgcmVzdWx0IG9mIGludm9raW5nIHRoZSBvbmUtdG8tbWFueSB0cmFuc2Zvcm0gZnVuY3Rpb24gY29ycmVzcG9uZGluZyB0byBlYWNoIG5vdGlmaWNhdGlvbiBpbiB0aGUgaW5wdXQgc2VxdWVuY2UuXG5cdCAgICovXG5cdCAgb2JzZXJ2YWJsZVByb3RvLmNvbmNhdE1hcE9ic2VydmVyID0gb2JzZXJ2YWJsZVByb3RvLnNlbGVjdENvbmNhdE9ic2VydmVyID0gZnVuY3Rpb24ob25OZXh0LCBvbkVycm9yLCBvbkNvbXBsZXRlZCwgdGhpc0FyZykge1xuXHQgICAgdmFyIHNvdXJjZSA9IHRoaXMsXG5cdCAgICAgICAgb25OZXh0RnVuYyA9IGJpbmRDYWxsYmFjayhvbk5leHQsIHRoaXNBcmcsIDIpLFxuXHQgICAgICAgIG9uRXJyb3JGdW5jID0gYmluZENhbGxiYWNrKG9uRXJyb3IsIHRoaXNBcmcsIDEpLFxuXHQgICAgICAgIG9uQ29tcGxldGVkRnVuYyA9IGJpbmRDYWxsYmFjayhvbkNvbXBsZXRlZCwgdGhpc0FyZywgMCk7XG5cdCAgICByZXR1cm4gbmV3IEFub255bW91c09ic2VydmFibGUoZnVuY3Rpb24gKG9ic2VydmVyKSB7XG5cdCAgICAgIHZhciBpbmRleCA9IDA7XG5cdCAgICAgIHJldHVybiBzb3VyY2Uuc3Vic2NyaWJlKFxuXHQgICAgICAgIGZ1bmN0aW9uICh4KSB7XG5cdCAgICAgICAgICB2YXIgcmVzdWx0O1xuXHQgICAgICAgICAgdHJ5IHtcblx0ICAgICAgICAgICAgcmVzdWx0ID0gb25OZXh0RnVuYyh4LCBpbmRleCsrKTtcblx0ICAgICAgICAgIH0gY2F0Y2ggKGUpIHtcblx0ICAgICAgICAgICAgb2JzZXJ2ZXIub25FcnJvcihlKTtcblx0ICAgICAgICAgICAgcmV0dXJuO1xuXHQgICAgICAgICAgfVxuXHQgICAgICAgICAgaXNQcm9taXNlKHJlc3VsdCkgJiYgKHJlc3VsdCA9IG9ic2VydmFibGVGcm9tUHJvbWlzZShyZXN1bHQpKTtcblx0ICAgICAgICAgIG9ic2VydmVyLm9uTmV4dChyZXN1bHQpO1xuXHQgICAgICAgIH0sXG5cdCAgICAgICAgZnVuY3Rpb24gKGVycikge1xuXHQgICAgICAgICAgdmFyIHJlc3VsdDtcblx0ICAgICAgICAgIHRyeSB7XG5cdCAgICAgICAgICAgIHJlc3VsdCA9IG9uRXJyb3JGdW5jKGVycik7XG5cdCAgICAgICAgICB9IGNhdGNoIChlKSB7XG5cdCAgICAgICAgICAgIG9ic2VydmVyLm9uRXJyb3IoZSk7XG5cdCAgICAgICAgICAgIHJldHVybjtcblx0ICAgICAgICAgIH1cblx0ICAgICAgICAgIGlzUHJvbWlzZShyZXN1bHQpICYmIChyZXN1bHQgPSBvYnNlcnZhYmxlRnJvbVByb21pc2UocmVzdWx0KSk7XG5cdCAgICAgICAgICBvYnNlcnZlci5vbk5leHQocmVzdWx0KTtcblx0ICAgICAgICAgIG9ic2VydmVyLm9uQ29tcGxldGVkKCk7XG5cdCAgICAgICAgfSxcblx0ICAgICAgICBmdW5jdGlvbiAoKSB7XG5cdCAgICAgICAgICB2YXIgcmVzdWx0O1xuXHQgICAgICAgICAgdHJ5IHtcblx0ICAgICAgICAgICAgcmVzdWx0ID0gb25Db21wbGV0ZWRGdW5jKCk7XG5cdCAgICAgICAgICB9IGNhdGNoIChlKSB7XG5cdCAgICAgICAgICAgIG9ic2VydmVyLm9uRXJyb3IoZSk7XG5cdCAgICAgICAgICAgIHJldHVybjtcblx0ICAgICAgICAgIH1cblx0ICAgICAgICAgIGlzUHJvbWlzZShyZXN1bHQpICYmIChyZXN1bHQgPSBvYnNlcnZhYmxlRnJvbVByb21pc2UocmVzdWx0KSk7XG5cdCAgICAgICAgICBvYnNlcnZlci5vbk5leHQocmVzdWx0KTtcblx0ICAgICAgICAgIG9ic2VydmVyLm9uQ29tcGxldGVkKCk7XG5cdCAgICAgICAgfSk7XG5cdCAgICB9LCB0aGlzKS5jb25jYXRBbGwoKTtcblx0ICB9O1xuXHRcblx0ICB2YXIgRGVmYXVsdElmRW1wdHlPYnNlcnZlciA9IChmdW5jdGlvbiAoX19zdXBlcl9fKSB7XG5cdCAgICBpbmhlcml0cyhEZWZhdWx0SWZFbXB0eU9ic2VydmVyLCBfX3N1cGVyX18pO1xuXHQgICAgZnVuY3Rpb24gRGVmYXVsdElmRW1wdHlPYnNlcnZlcihvLCBkKSB7XG5cdCAgICAgIHRoaXMuX28gPSBvO1xuXHQgICAgICB0aGlzLl9kID0gZDtcblx0ICAgICAgdGhpcy5fZiA9IGZhbHNlO1xuXHQgICAgICBfX3N1cGVyX18uY2FsbCh0aGlzKTtcblx0ICAgIH1cblx0XG5cdCAgICBEZWZhdWx0SWZFbXB0eU9ic2VydmVyLnByb3RvdHlwZS5uZXh0ID0gZnVuY3Rpb24gKHgpIHtcblx0ICAgICAgdGhpcy5fZiA9IHRydWU7XG5cdCAgICAgIHRoaXMuX28ub25OZXh0KHgpO1xuXHQgICAgfTtcblx0XG5cdCAgICBEZWZhdWx0SWZFbXB0eU9ic2VydmVyLnByb3RvdHlwZS5lcnJvciA9IGZ1bmN0aW9uIChlKSB7XG5cdCAgICAgIHRoaXMuX28ub25FcnJvcihlKTtcblx0ICAgIH07XG5cdFxuXHQgICAgRGVmYXVsdElmRW1wdHlPYnNlcnZlci5wcm90b3R5cGUuY29tcGxldGVkID0gZnVuY3Rpb24gKCkge1xuXHQgICAgICAhdGhpcy5fZiAmJiB0aGlzLl9vLm9uTmV4dChkZWZhdWx0VmFsdWUpO1xuXHQgICAgICB0aGlzLl9vLm9uQ29tcGxldGVkKCk7XG5cdCAgICB9O1xuXHRcblx0ICAgIHJldHVybiBEZWZhdWx0SWZFbXB0eU9ic2VydmVyO1xuXHQgIH0oQWJzdHJhY3RPYnNlcnZlcikpO1xuXHRcblx0ICAvKipcblx0ICAgKiAgUmV0dXJucyB0aGUgZWxlbWVudHMgb2YgdGhlIHNwZWNpZmllZCBzZXF1ZW5jZSBvciB0aGUgc3BlY2lmaWVkIHZhbHVlIGluIGEgc2luZ2xldG9uIHNlcXVlbmNlIGlmIHRoZSBzZXF1ZW5jZSBpcyBlbXB0eS5cblx0ICAgKlxuXHQgICAqICB2YXIgcmVzID0gb2JzID0geHMuZGVmYXVsdElmRW1wdHkoKTtcblx0ICAgKiAgMiAtIG9icyA9IHhzLmRlZmF1bHRJZkVtcHR5KGZhbHNlKTtcblx0ICAgKlxuXHQgICAqIEBtZW1iZXJPZiBPYnNlcnZhYmxlI1xuXHQgICAqIEBwYXJhbSBkZWZhdWx0VmFsdWUgVGhlIHZhbHVlIHRvIHJldHVybiBpZiB0aGUgc2VxdWVuY2UgaXMgZW1wdHkuIElmIG5vdCBwcm92aWRlZCwgdGhpcyBkZWZhdWx0cyB0byBudWxsLlxuXHQgICAqIEByZXR1cm5zIHtPYnNlcnZhYmxlfSBBbiBvYnNlcnZhYmxlIHNlcXVlbmNlIHRoYXQgY29udGFpbnMgdGhlIHNwZWNpZmllZCBkZWZhdWx0IHZhbHVlIGlmIHRoZSBzb3VyY2UgaXMgZW1wdHk7IG90aGVyd2lzZSwgdGhlIGVsZW1lbnRzIG9mIHRoZSBzb3VyY2UgaXRzZWxmLlxuXHQgICAqL1xuXHQgICAgb2JzZXJ2YWJsZVByb3RvLmRlZmF1bHRJZkVtcHR5ID0gZnVuY3Rpb24gKGRlZmF1bHRWYWx1ZSkge1xuXHQgICAgICB2YXIgc291cmNlID0gdGhpcztcblx0ICAgICAgZGVmYXVsdFZhbHVlID09PSB1bmRlZmluZWQgJiYgKGRlZmF1bHRWYWx1ZSA9IG51bGwpO1xuXHQgICAgICByZXR1cm4gbmV3IEFub255bW91c09ic2VydmFibGUoZnVuY3Rpb24gKG8pIHtcblx0ICAgICAgICByZXR1cm4gc291cmNlLnN1YnNjcmliZShuZXcgRGVmYXVsdElmRW1wdHlPYnNlcnZlcihvLCBkZWZhdWx0VmFsdWUpKTtcblx0ICAgICAgfSwgc291cmNlKTtcblx0ICAgIH07XG5cdFxuXHQgIC8vIFN3YXAgb3V0IGZvciBBcnJheS5maW5kSW5kZXhcblx0ICBmdW5jdGlvbiBhcnJheUluZGV4T2ZDb21wYXJlcihhcnJheSwgaXRlbSwgY29tcGFyZXIpIHtcblx0ICAgIGZvciAodmFyIGkgPSAwLCBsZW4gPSBhcnJheS5sZW5ndGg7IGkgPCBsZW47IGkrKykge1xuXHQgICAgICBpZiAoY29tcGFyZXIoYXJyYXlbaV0sIGl0ZW0pKSB7IHJldHVybiBpOyB9XG5cdCAgICB9XG5cdCAgICByZXR1cm4gLTE7XG5cdCAgfVxuXHRcblx0ICBmdW5jdGlvbiBIYXNoU2V0KGNvbXBhcmVyKSB7XG5cdCAgICB0aGlzLmNvbXBhcmVyID0gY29tcGFyZXI7XG5cdCAgICB0aGlzLnNldCA9IFtdO1xuXHQgIH1cblx0ICBIYXNoU2V0LnByb3RvdHlwZS5wdXNoID0gZnVuY3Rpb24odmFsdWUpIHtcblx0ICAgIHZhciByZXRWYWx1ZSA9IGFycmF5SW5kZXhPZkNvbXBhcmVyKHRoaXMuc2V0LCB2YWx1ZSwgdGhpcy5jb21wYXJlcikgPT09IC0xO1xuXHQgICAgcmV0VmFsdWUgJiYgdGhpcy5zZXQucHVzaCh2YWx1ZSk7XG5cdCAgICByZXR1cm4gcmV0VmFsdWU7XG5cdCAgfTtcblx0XG5cdCAgdmFyIERpc3RpbmN0T2JzZXJ2YWJsZSA9IChmdW5jdGlvbiAoX19zdXBlcl9fKSB7XG5cdCAgICBpbmhlcml0cyhEaXN0aW5jdE9ic2VydmFibGUsIF9fc3VwZXJfXyk7XG5cdCAgICBmdW5jdGlvbiBEaXN0aW5jdE9ic2VydmFibGUoc291cmNlLCBrZXlGbiwgY21wRm4pIHtcblx0ICAgICAgdGhpcy5zb3VyY2UgPSBzb3VyY2U7XG5cdCAgICAgIHRoaXMuX2tleUZuID0ga2V5Rm47XG5cdCAgICAgIHRoaXMuX2NtcEZuID0gY21wRm47XG5cdCAgICAgIF9fc3VwZXJfXy5jYWxsKHRoaXMpO1xuXHQgICAgfVxuXHRcblx0ICAgIERpc3RpbmN0T2JzZXJ2YWJsZS5wcm90b3R5cGUuc3Vic2NyaWJlQ29yZSA9IGZ1bmN0aW9uIChvKSB7XG5cdCAgICAgIHJldHVybiB0aGlzLnNvdXJjZS5zdWJzY3JpYmUobmV3IERpc3RpbmN0T2JzZXJ2ZXIobywgdGhpcy5fa2V5Rm4sIHRoaXMuX2NtcEZuKSk7XG5cdCAgICB9O1xuXHRcblx0ICAgIHJldHVybiBEaXN0aW5jdE9ic2VydmFibGU7XG5cdCAgfShPYnNlcnZhYmxlQmFzZSkpO1xuXHRcblx0ICB2YXIgRGlzdGluY3RPYnNlcnZlciA9IChmdW5jdGlvbiAoX19zdXBlcl9fKSB7XG5cdCAgICBpbmhlcml0cyhEaXN0aW5jdE9ic2VydmVyLCBfX3N1cGVyX18pO1xuXHQgICAgZnVuY3Rpb24gRGlzdGluY3RPYnNlcnZlcihvLCBrZXlGbiwgY21wRm4pIHtcblx0ICAgICAgdGhpcy5fbyA9IG87XG5cdCAgICAgIHRoaXMuX2tleUZuID0ga2V5Rm47XG5cdCAgICAgIHRoaXMuX2ggPSBuZXcgSGFzaFNldChjbXBGbik7XG5cdCAgICAgIF9fc3VwZXJfXy5jYWxsKHRoaXMpO1xuXHQgICAgfVxuXHRcblx0ICAgIERpc3RpbmN0T2JzZXJ2ZXIucHJvdG90eXBlLm5leHQgPSBmdW5jdGlvbiAoeCkge1xuXHQgICAgICB2YXIga2V5ID0geDtcblx0ICAgICAgaWYgKGlzRnVuY3Rpb24odGhpcy5fa2V5Rm4pKSB7XG5cdCAgICAgICAga2V5ID0gdHJ5Q2F0Y2godGhpcy5fa2V5Rm4pKHgpO1xuXHQgICAgICAgIGlmIChrZXkgPT09IGVycm9yT2JqKSB7IHJldHVybiB0aGlzLl9vLm9uRXJyb3Ioa2V5LmUpOyB9XG5cdCAgICAgIH1cblx0ICAgICAgdGhpcy5faC5wdXNoKGtleSkgJiYgdGhpcy5fby5vbk5leHQoeCk7XG5cdCAgICB9O1xuXHRcblx0ICAgIERpc3RpbmN0T2JzZXJ2ZXIucHJvdG90eXBlLmVycm9yID0gZnVuY3Rpb24gKGUpIHsgdGhpcy5fby5vbkVycm9yKGUpOyB9O1xuXHQgICAgRGlzdGluY3RPYnNlcnZlci5wcm90b3R5cGUuY29tcGxldGVkID0gZnVuY3Rpb24gKCkgeyB0aGlzLl9vLm9uQ29tcGxldGVkKCk7IH07XG5cdFxuXHQgICAgcmV0dXJuIERpc3RpbmN0T2JzZXJ2ZXI7XG5cdCAgfShBYnN0cmFjdE9ic2VydmVyKSk7XG5cdFxuXHQgIC8qKlxuXHQgICAqICBSZXR1cm5zIGFuIG9ic2VydmFibGUgc2VxdWVuY2UgdGhhdCBjb250YWlucyBvbmx5IGRpc3RpbmN0IGVsZW1lbnRzIGFjY29yZGluZyB0byB0aGUga2V5U2VsZWN0b3IgYW5kIHRoZSBjb21wYXJlci5cblx0ICAgKiAgVXNhZ2Ugb2YgdGhpcyBvcGVyYXRvciBzaG91bGQgYmUgY29uc2lkZXJlZCBjYXJlZnVsbHkgZHVlIHRvIHRoZSBtYWludGVuYW5jZSBvZiBhbiBpbnRlcm5hbCBsb29rdXAgc3RydWN0dXJlIHdoaWNoIGNhbiBncm93IGxhcmdlLlxuXHQgICAqXG5cdCAgICogQGV4YW1wbGVcblx0ICAgKiAgdmFyIHJlcyA9IG9icyA9IHhzLmRpc3RpbmN0KCk7XG5cdCAgICogIDIgLSBvYnMgPSB4cy5kaXN0aW5jdChmdW5jdGlvbiAoeCkgeyByZXR1cm4geC5pZDsgfSk7XG5cdCAgICogIDIgLSBvYnMgPSB4cy5kaXN0aW5jdChmdW5jdGlvbiAoeCkgeyByZXR1cm4geC5pZDsgfSwgZnVuY3Rpb24gKGEsYikgeyByZXR1cm4gYSA9PT0gYjsgfSk7XG5cdCAgICogQHBhcmFtIHtGdW5jdGlvbn0gW2tleVNlbGVjdG9yXSAgQSBmdW5jdGlvbiB0byBjb21wdXRlIHRoZSBjb21wYXJpc29uIGtleSBmb3IgZWFjaCBlbGVtZW50LlxuXHQgICAqIEBwYXJhbSB7RnVuY3Rpb259IFtjb21wYXJlcl0gIFVzZWQgdG8gY29tcGFyZSBpdGVtcyBpbiB0aGUgY29sbGVjdGlvbi5cblx0ICAgKiBAcmV0dXJucyB7T2JzZXJ2YWJsZX0gQW4gb2JzZXJ2YWJsZSBzZXF1ZW5jZSBvbmx5IGNvbnRhaW5pbmcgdGhlIGRpc3RpbmN0IGVsZW1lbnRzLCBiYXNlZCBvbiBhIGNvbXB1dGVkIGtleSB2YWx1ZSwgZnJvbSB0aGUgc291cmNlIHNlcXVlbmNlLlxuXHQgICAqL1xuXHQgIG9ic2VydmFibGVQcm90by5kaXN0aW5jdCA9IGZ1bmN0aW9uIChrZXlTZWxlY3RvciwgY29tcGFyZXIpIHtcblx0ICAgIGNvbXBhcmVyIHx8IChjb21wYXJlciA9IGRlZmF1bHRDb21wYXJlcik7XG5cdCAgICByZXR1cm4gbmV3IERpc3RpbmN0T2JzZXJ2YWJsZSh0aGlzLCBrZXlTZWxlY3RvciwgY29tcGFyZXIpO1xuXHQgIH07XG5cdFxuXHQgIC8qKlxuXHQgICAqICBHcm91cHMgdGhlIGVsZW1lbnRzIG9mIGFuIG9ic2VydmFibGUgc2VxdWVuY2UgYWNjb3JkaW5nIHRvIGEgc3BlY2lmaWVkIGtleSBzZWxlY3RvciBmdW5jdGlvbiBhbmQgY29tcGFyZXIgYW5kIHNlbGVjdHMgdGhlIHJlc3VsdGluZyBlbGVtZW50cyBieSB1c2luZyBhIHNwZWNpZmllZCBmdW5jdGlvbi5cblx0ICAgKlxuXHQgICAqIEBleGFtcGxlXG5cdCAgICogIHZhciByZXMgPSBvYnNlcnZhYmxlLmdyb3VwQnkoZnVuY3Rpb24gKHgpIHsgcmV0dXJuIHguaWQ7IH0pO1xuXHQgICAqICAyIC0gb2JzZXJ2YWJsZS5ncm91cEJ5KGZ1bmN0aW9uICh4KSB7IHJldHVybiB4LmlkOyB9KSwgZnVuY3Rpb24gKHgpIHsgcmV0dXJuIHgubmFtZTsgfSk7XG5cdCAgICogIDMgLSBvYnNlcnZhYmxlLmdyb3VwQnkoZnVuY3Rpb24gKHgpIHsgcmV0dXJuIHguaWQ7IH0pLCBmdW5jdGlvbiAoeCkgeyByZXR1cm4geC5uYW1lOyB9LCBmdW5jdGlvbiAoeCkgeyByZXR1cm4geC50b1N0cmluZygpOyB9KTtcblx0ICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBrZXlTZWxlY3RvciBBIGZ1bmN0aW9uIHRvIGV4dHJhY3QgdGhlIGtleSBmb3IgZWFjaCBlbGVtZW50LlxuXHQgICAqIEBwYXJhbSB7RnVuY3Rpb259IFtlbGVtZW50U2VsZWN0b3JdICBBIGZ1bmN0aW9uIHRvIG1hcCBlYWNoIHNvdXJjZSBlbGVtZW50IHRvIGFuIGVsZW1lbnQgaW4gYW4gb2JzZXJ2YWJsZSBncm91cC5cblx0ICAgKiBAcmV0dXJucyB7T2JzZXJ2YWJsZX0gQSBzZXF1ZW5jZSBvZiBvYnNlcnZhYmxlIGdyb3VwcywgZWFjaCBvZiB3aGljaCBjb3JyZXNwb25kcyB0byBhIHVuaXF1ZSBrZXkgdmFsdWUsIGNvbnRhaW5pbmcgYWxsIGVsZW1lbnRzIHRoYXQgc2hhcmUgdGhhdCBzYW1lIGtleSB2YWx1ZS5cblx0ICAgKi9cblx0ICBvYnNlcnZhYmxlUHJvdG8uZ3JvdXBCeSA9IGZ1bmN0aW9uIChrZXlTZWxlY3RvciwgZWxlbWVudFNlbGVjdG9yKSB7XG5cdCAgICByZXR1cm4gdGhpcy5ncm91cEJ5VW50aWwoa2V5U2VsZWN0b3IsIGVsZW1lbnRTZWxlY3Rvciwgb2JzZXJ2YWJsZU5ldmVyKTtcblx0ICB9O1xuXHRcblx0ICAgIC8qKlxuXHQgICAgICogIEdyb3VwcyB0aGUgZWxlbWVudHMgb2YgYW4gb2JzZXJ2YWJsZSBzZXF1ZW5jZSBhY2NvcmRpbmcgdG8gYSBzcGVjaWZpZWQga2V5IHNlbGVjdG9yIGZ1bmN0aW9uLlxuXHQgICAgICogIEEgZHVyYXRpb24gc2VsZWN0b3IgZnVuY3Rpb24gaXMgdXNlZCB0byBjb250cm9sIHRoZSBsaWZldGltZSBvZiBncm91cHMuIFdoZW4gYSBncm91cCBleHBpcmVzLCBpdCByZWNlaXZlcyBhbiBPbkNvbXBsZXRlZCBub3RpZmljYXRpb24uIFdoZW4gYSBuZXcgZWxlbWVudCB3aXRoIHRoZSBzYW1lXG5cdCAgICAgKiAga2V5IHZhbHVlIGFzIGEgcmVjbGFpbWVkIGdyb3VwIG9jY3VycywgdGhlIGdyb3VwIHdpbGwgYmUgcmVib3JuIHdpdGggYSBuZXcgbGlmZXRpbWUgcmVxdWVzdC5cblx0ICAgICAqXG5cdCAgICAgKiBAZXhhbXBsZVxuXHQgICAgICogIHZhciByZXMgPSBvYnNlcnZhYmxlLmdyb3VwQnlVbnRpbChmdW5jdGlvbiAoeCkgeyByZXR1cm4geC5pZDsgfSwgbnVsbCwgIGZ1bmN0aW9uICgpIHsgcmV0dXJuIFJ4Lk9ic2VydmFibGUubmV2ZXIoKTsgfSk7XG5cdCAgICAgKiAgMiAtIG9ic2VydmFibGUuZ3JvdXBCeShmdW5jdGlvbiAoeCkgeyByZXR1cm4geC5pZDsgfSksIGZ1bmN0aW9uICh4KSB7IHJldHVybiB4Lm5hbWU7IH0sICBmdW5jdGlvbiAoKSB7IHJldHVybiBSeC5PYnNlcnZhYmxlLm5ldmVyKCk7IH0pO1xuXHQgICAgICogIDMgLSBvYnNlcnZhYmxlLmdyb3VwQnkoZnVuY3Rpb24gKHgpIHsgcmV0dXJuIHguaWQ7IH0pLCBmdW5jdGlvbiAoeCkgeyByZXR1cm4geC5uYW1lOyB9LCAgZnVuY3Rpb24gKCkgeyByZXR1cm4gUnguT2JzZXJ2YWJsZS5uZXZlcigpOyB9LCBmdW5jdGlvbiAoeCkgeyByZXR1cm4geC50b1N0cmluZygpOyB9KTtcblx0ICAgICAqIEBwYXJhbSB7RnVuY3Rpb259IGtleVNlbGVjdG9yIEEgZnVuY3Rpb24gdG8gZXh0cmFjdCB0aGUga2V5IGZvciBlYWNoIGVsZW1lbnQuXG5cdCAgICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBkdXJhdGlvblNlbGVjdG9yIEEgZnVuY3Rpb24gdG8gc2lnbmFsIHRoZSBleHBpcmF0aW9uIG9mIGEgZ3JvdXAuXG5cdCAgICAgKiBAcmV0dXJucyB7T2JzZXJ2YWJsZX1cblx0ICAgICAqICBBIHNlcXVlbmNlIG9mIG9ic2VydmFibGUgZ3JvdXBzLCBlYWNoIG9mIHdoaWNoIGNvcnJlc3BvbmRzIHRvIGEgdW5pcXVlIGtleSB2YWx1ZSwgY29udGFpbmluZyBhbGwgZWxlbWVudHMgdGhhdCBzaGFyZSB0aGF0IHNhbWUga2V5IHZhbHVlLlxuXHQgICAgICogIElmIGEgZ3JvdXAncyBsaWZldGltZSBleHBpcmVzLCBhIG5ldyBncm91cCB3aXRoIHRoZSBzYW1lIGtleSB2YWx1ZSBjYW4gYmUgY3JlYXRlZCBvbmNlIGFuIGVsZW1lbnQgd2l0aCBzdWNoIGEga2V5IHZhbHVlIGlzIGVuY291dGVyZWQuXG5cdCAgICAgKlxuXHQgICAgICovXG5cdCAgICBvYnNlcnZhYmxlUHJvdG8uZ3JvdXBCeVVudGlsID0gZnVuY3Rpb24gKGtleVNlbGVjdG9yLCBlbGVtZW50U2VsZWN0b3IsIGR1cmF0aW9uU2VsZWN0b3IpIHtcblx0ICAgICAgdmFyIHNvdXJjZSA9IHRoaXM7XG5cdCAgICAgIHJldHVybiBuZXcgQW5vbnltb3VzT2JzZXJ2YWJsZShmdW5jdGlvbiAobykge1xuXHQgICAgICAgIHZhciBtYXAgPSBuZXcgTWFwKCksXG5cdCAgICAgICAgICBncm91cERpc3Bvc2FibGUgPSBuZXcgQ29tcG9zaXRlRGlzcG9zYWJsZSgpLFxuXHQgICAgICAgICAgcmVmQ291bnREaXNwb3NhYmxlID0gbmV3IFJlZkNvdW50RGlzcG9zYWJsZShncm91cERpc3Bvc2FibGUpLFxuXHQgICAgICAgICAgaGFuZGxlRXJyb3IgPSBmdW5jdGlvbiAoZSkgeyByZXR1cm4gZnVuY3Rpb24gKGl0ZW0pIHsgaXRlbS5vbkVycm9yKGUpOyB9OyB9O1xuXHRcblx0ICAgICAgICBncm91cERpc3Bvc2FibGUuYWRkKFxuXHQgICAgICAgICAgc291cmNlLnN1YnNjcmliZShmdW5jdGlvbiAoeCkge1xuXHQgICAgICAgICAgICB2YXIga2V5ID0gdHJ5Q2F0Y2goa2V5U2VsZWN0b3IpKHgpO1xuXHQgICAgICAgICAgICBpZiAoa2V5ID09PSBlcnJvck9iaikge1xuXHQgICAgICAgICAgICAgIG1hcC5mb3JFYWNoKGhhbmRsZUVycm9yKGtleS5lKSk7XG5cdCAgICAgICAgICAgICAgcmV0dXJuIG8ub25FcnJvcihrZXkuZSk7XG5cdCAgICAgICAgICAgIH1cblx0XG5cdCAgICAgICAgICAgIHZhciBmaXJlTmV3TWFwRW50cnkgPSBmYWxzZSwgd3JpdGVyID0gbWFwLmdldChrZXkpO1xuXHQgICAgICAgICAgICBpZiAod3JpdGVyID09PSB1bmRlZmluZWQpIHtcblx0ICAgICAgICAgICAgICB3cml0ZXIgPSBuZXcgU3ViamVjdCgpO1xuXHQgICAgICAgICAgICAgIG1hcC5zZXQoa2V5LCB3cml0ZXIpO1xuXHQgICAgICAgICAgICAgIGZpcmVOZXdNYXBFbnRyeSA9IHRydWU7XG5cdCAgICAgICAgICAgIH1cblx0XG5cdCAgICAgICAgICAgIGlmIChmaXJlTmV3TWFwRW50cnkpIHtcblx0ICAgICAgICAgICAgICB2YXIgZ3JvdXAgPSBuZXcgR3JvdXBlZE9ic2VydmFibGUoa2V5LCB3cml0ZXIsIHJlZkNvdW50RGlzcG9zYWJsZSksXG5cdCAgICAgICAgICAgICAgICBkdXJhdGlvbkdyb3VwID0gbmV3IEdyb3VwZWRPYnNlcnZhYmxlKGtleSwgd3JpdGVyKTtcblx0ICAgICAgICAgICAgICB2YXIgZHVyYXRpb24gPSB0cnlDYXRjaChkdXJhdGlvblNlbGVjdG9yKShkdXJhdGlvbkdyb3VwKTtcblx0ICAgICAgICAgICAgICBpZiAoZHVyYXRpb24gPT09IGVycm9yT2JqKSB7XG5cdCAgICAgICAgICAgICAgICBtYXAuZm9yRWFjaChoYW5kbGVFcnJvcihkdXJhdGlvbi5lKSk7XG5cdCAgICAgICAgICAgICAgICByZXR1cm4gby5vbkVycm9yKGR1cmF0aW9uLmUpO1xuXHQgICAgICAgICAgICAgIH1cblx0XG5cdCAgICAgICAgICAgICAgby5vbk5leHQoZ3JvdXApO1xuXHRcblx0ICAgICAgICAgICAgICB2YXIgbWQgPSBuZXcgU2luZ2xlQXNzaWdubWVudERpc3Bvc2FibGUoKTtcblx0ICAgICAgICAgICAgICBncm91cERpc3Bvc2FibGUuYWRkKG1kKTtcblx0XG5cdCAgICAgICAgICAgICAgbWQuc2V0RGlzcG9zYWJsZShkdXJhdGlvbi50YWtlKDEpLnN1YnNjcmliZShcblx0ICAgICAgICAgICAgICAgIG5vb3AsXG5cdCAgICAgICAgICAgICAgICBmdW5jdGlvbiAoZSkge1xuXHQgICAgICAgICAgICAgICAgICBtYXAuZm9yRWFjaChoYW5kbGVFcnJvcihlKSk7XG5cdCAgICAgICAgICAgICAgICAgIG8ub25FcnJvcihlKTtcblx0ICAgICAgICAgICAgICAgIH0sXG5cdCAgICAgICAgICAgICAgICBmdW5jdGlvbiAoKSB7XG5cdCAgICAgICAgICAgICAgICAgIGlmIChtYXBbJ2RlbGV0ZSddKGtleSkpIHsgd3JpdGVyLm9uQ29tcGxldGVkKCk7IH1cblx0ICAgICAgICAgICAgICAgICAgZ3JvdXBEaXNwb3NhYmxlLnJlbW92ZShtZCk7XG5cdCAgICAgICAgICAgICAgICB9KSk7XG5cdCAgICAgICAgICAgIH1cblx0XG5cdCAgICAgICAgICAgIHZhciBlbGVtZW50ID0geDtcblx0ICAgICAgICAgICAgaWYgKGlzRnVuY3Rpb24oZWxlbWVudFNlbGVjdG9yKSkge1xuXHQgICAgICAgICAgICAgIGVsZW1lbnQgPSB0cnlDYXRjaChlbGVtZW50U2VsZWN0b3IpKHgpO1xuXHQgICAgICAgICAgICAgIGlmIChlbGVtZW50ID09PSBlcnJvck9iaikge1xuXHQgICAgICAgICAgICAgICAgbWFwLmZvckVhY2goaGFuZGxlRXJyb3IoZWxlbWVudC5lKSk7XG5cdCAgICAgICAgICAgICAgICByZXR1cm4gby5vbkVycm9yKGVsZW1lbnQuZSk7XG5cdCAgICAgICAgICAgICAgfVxuXHQgICAgICAgICAgICB9XG5cdFxuXHQgICAgICAgICAgICB3cml0ZXIub25OZXh0KGVsZW1lbnQpO1xuXHQgICAgICAgIH0sIGZ1bmN0aW9uIChlKSB7XG5cdCAgICAgICAgICBtYXAuZm9yRWFjaChoYW5kbGVFcnJvcihlKSk7XG5cdCAgICAgICAgICBvLm9uRXJyb3IoZSk7XG5cdCAgICAgICAgfSwgZnVuY3Rpb24gKCkge1xuXHQgICAgICAgICAgbWFwLmZvckVhY2goZnVuY3Rpb24gKGl0ZW0pIHsgaXRlbS5vbkNvbXBsZXRlZCgpOyB9KTtcblx0ICAgICAgICAgIG8ub25Db21wbGV0ZWQoKTtcblx0ICAgICAgICB9KSk7XG5cdFxuXHQgICAgICByZXR1cm4gcmVmQ291bnREaXNwb3NhYmxlO1xuXHQgICAgfSwgc291cmNlKTtcblx0ICB9O1xuXHRcblx0ICB2YXIgTWFwT2JzZXJ2YWJsZSA9IChmdW5jdGlvbiAoX19zdXBlcl9fKSB7XG5cdCAgICBpbmhlcml0cyhNYXBPYnNlcnZhYmxlLCBfX3N1cGVyX18pO1xuXHRcblx0ICAgIGZ1bmN0aW9uIE1hcE9ic2VydmFibGUoc291cmNlLCBzZWxlY3RvciwgdGhpc0FyZykge1xuXHQgICAgICB0aGlzLnNvdXJjZSA9IHNvdXJjZTtcblx0ICAgICAgdGhpcy5zZWxlY3RvciA9IGJpbmRDYWxsYmFjayhzZWxlY3RvciwgdGhpc0FyZywgMyk7XG5cdCAgICAgIF9fc3VwZXJfXy5jYWxsKHRoaXMpO1xuXHQgICAgfVxuXHRcblx0ICAgIGZ1bmN0aW9uIGlubmVyTWFwKHNlbGVjdG9yLCBzZWxmKSB7XG5cdCAgICAgIHJldHVybiBmdW5jdGlvbiAoeCwgaSwgbykgeyByZXR1cm4gc2VsZWN0b3IuY2FsbCh0aGlzLCBzZWxmLnNlbGVjdG9yKHgsIGksIG8pLCBpLCBvKTsgfVxuXHQgICAgfVxuXHRcblx0ICAgIE1hcE9ic2VydmFibGUucHJvdG90eXBlLmludGVybmFsTWFwID0gZnVuY3Rpb24gKHNlbGVjdG9yLCB0aGlzQXJnKSB7XG5cdCAgICAgIHJldHVybiBuZXcgTWFwT2JzZXJ2YWJsZSh0aGlzLnNvdXJjZSwgaW5uZXJNYXAoc2VsZWN0b3IsIHRoaXMpLCB0aGlzQXJnKTtcblx0ICAgIH07XG5cdFxuXHQgICAgTWFwT2JzZXJ2YWJsZS5wcm90b3R5cGUuc3Vic2NyaWJlQ29yZSA9IGZ1bmN0aW9uIChvKSB7XG5cdCAgICAgIHJldHVybiB0aGlzLnNvdXJjZS5zdWJzY3JpYmUobmV3IElubmVyT2JzZXJ2ZXIobywgdGhpcy5zZWxlY3RvciwgdGhpcykpO1xuXHQgICAgfTtcblx0XG5cdCAgICBpbmhlcml0cyhJbm5lck9ic2VydmVyLCBBYnN0cmFjdE9ic2VydmVyKTtcblx0ICAgIGZ1bmN0aW9uIElubmVyT2JzZXJ2ZXIobywgc2VsZWN0b3IsIHNvdXJjZSkge1xuXHQgICAgICB0aGlzLm8gPSBvO1xuXHQgICAgICB0aGlzLnNlbGVjdG9yID0gc2VsZWN0b3I7XG5cdCAgICAgIHRoaXMuc291cmNlID0gc291cmNlO1xuXHQgICAgICB0aGlzLmkgPSAwO1xuXHQgICAgICBBYnN0cmFjdE9ic2VydmVyLmNhbGwodGhpcyk7XG5cdCAgICB9XG5cdFxuXHQgICAgSW5uZXJPYnNlcnZlci5wcm90b3R5cGUubmV4dCA9IGZ1bmN0aW9uKHgpIHtcblx0ICAgICAgdmFyIHJlc3VsdCA9IHRyeUNhdGNoKHRoaXMuc2VsZWN0b3IpKHgsIHRoaXMuaSsrLCB0aGlzLnNvdXJjZSk7XG5cdCAgICAgIGlmIChyZXN1bHQgPT09IGVycm9yT2JqKSB7IHJldHVybiB0aGlzLm8ub25FcnJvcihyZXN1bHQuZSk7IH1cblx0ICAgICAgdGhpcy5vLm9uTmV4dChyZXN1bHQpO1xuXHQgICAgfTtcblx0XG5cdCAgICBJbm5lck9ic2VydmVyLnByb3RvdHlwZS5lcnJvciA9IGZ1bmN0aW9uIChlKSB7XG5cdCAgICAgIHRoaXMuby5vbkVycm9yKGUpO1xuXHQgICAgfTtcblx0XG5cdCAgICBJbm5lck9ic2VydmVyLnByb3RvdHlwZS5jb21wbGV0ZWQgPSBmdW5jdGlvbiAoKSB7XG5cdCAgICAgIHRoaXMuby5vbkNvbXBsZXRlZCgpO1xuXHQgICAgfTtcblx0XG5cdCAgICByZXR1cm4gTWFwT2JzZXJ2YWJsZTtcblx0XG5cdCAgfShPYnNlcnZhYmxlQmFzZSkpO1xuXHRcblx0ICAvKipcblx0ICAqIFByb2plY3RzIGVhY2ggZWxlbWVudCBvZiBhbiBvYnNlcnZhYmxlIHNlcXVlbmNlIGludG8gYSBuZXcgZm9ybSBieSBpbmNvcnBvcmF0aW5nIHRoZSBlbGVtZW50J3MgaW5kZXguXG5cdCAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBzZWxlY3RvciBBIHRyYW5zZm9ybSBmdW5jdGlvbiB0byBhcHBseSB0byBlYWNoIHNvdXJjZSBlbGVtZW50OyB0aGUgc2Vjb25kIHBhcmFtZXRlciBvZiB0aGUgZnVuY3Rpb24gcmVwcmVzZW50cyB0aGUgaW5kZXggb2YgdGhlIHNvdXJjZSBlbGVtZW50LlxuXHQgICogQHBhcmFtIHtBbnl9IFt0aGlzQXJnXSBPYmplY3QgdG8gdXNlIGFzIHRoaXMgd2hlbiBleGVjdXRpbmcgY2FsbGJhY2suXG5cdCAgKiBAcmV0dXJucyB7T2JzZXJ2YWJsZX0gQW4gb2JzZXJ2YWJsZSBzZXF1ZW5jZSB3aG9zZSBlbGVtZW50cyBhcmUgdGhlIHJlc3VsdCBvZiBpbnZva2luZyB0aGUgdHJhbnNmb3JtIGZ1bmN0aW9uIG9uIGVhY2ggZWxlbWVudCBvZiBzb3VyY2UuXG5cdCAgKi9cblx0ICBvYnNlcnZhYmxlUHJvdG8ubWFwID0gb2JzZXJ2YWJsZVByb3RvLnNlbGVjdCA9IGZ1bmN0aW9uIChzZWxlY3RvciwgdGhpc0FyZykge1xuXHQgICAgdmFyIHNlbGVjdG9yRm4gPSB0eXBlb2Ygc2VsZWN0b3IgPT09ICdmdW5jdGlvbicgPyBzZWxlY3RvciA6IGZ1bmN0aW9uICgpIHsgcmV0dXJuIHNlbGVjdG9yOyB9O1xuXHQgICAgcmV0dXJuIHRoaXMgaW5zdGFuY2VvZiBNYXBPYnNlcnZhYmxlID9cblx0ICAgICAgdGhpcy5pbnRlcm5hbE1hcChzZWxlY3RvckZuLCB0aGlzQXJnKSA6XG5cdCAgICAgIG5ldyBNYXBPYnNlcnZhYmxlKHRoaXMsIHNlbGVjdG9yRm4sIHRoaXNBcmcpO1xuXHQgIH07XG5cdFxuXHQgIGZ1bmN0aW9uIHBsdWNrZXIoYXJncywgbGVuKSB7XG5cdCAgICByZXR1cm4gZnVuY3Rpb24gbWFwcGVyKHgpIHtcblx0ICAgICAgdmFyIGN1cnJlbnRQcm9wID0geDtcblx0ICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBsZW47IGkrKykge1xuXHQgICAgICAgIHZhciBwID0gY3VycmVudFByb3BbYXJnc1tpXV07XG5cdCAgICAgICAgaWYgKHR5cGVvZiBwICE9PSAndW5kZWZpbmVkJykge1xuXHQgICAgICAgICAgY3VycmVudFByb3AgPSBwO1xuXHQgICAgICAgIH0gZWxzZSB7XG5cdCAgICAgICAgICByZXR1cm4gdW5kZWZpbmVkO1xuXHQgICAgICAgIH1cblx0ICAgICAgfVxuXHQgICAgICByZXR1cm4gY3VycmVudFByb3A7XG5cdCAgICB9XG5cdCAgfVxuXHRcblx0ICAvKipcblx0ICAgKiBSZXRyaWV2ZXMgdGhlIHZhbHVlIG9mIGEgc3BlY2lmaWVkIG5lc3RlZCBwcm9wZXJ0eSBmcm9tIGFsbCBlbGVtZW50cyBpblxuXHQgICAqIHRoZSBPYnNlcnZhYmxlIHNlcXVlbmNlLlxuXHQgICAqIEBwYXJhbSB7QXJndW1lbnRzfSBhcmd1bWVudHMgVGhlIG5lc3RlZCBwcm9wZXJ0aWVzIHRvIHBsdWNrLlxuXHQgICAqIEByZXR1cm5zIHtPYnNlcnZhYmxlfSBSZXR1cm5zIGEgbmV3IE9ic2VydmFibGUgc2VxdWVuY2Ugb2YgcHJvcGVydHkgdmFsdWVzLlxuXHQgICAqL1xuXHQgIG9ic2VydmFibGVQcm90by5wbHVjayA9IGZ1bmN0aW9uICgpIHtcblx0ICAgIHZhciBsZW4gPSBhcmd1bWVudHMubGVuZ3RoLCBhcmdzID0gbmV3IEFycmF5KGxlbik7XG5cdCAgICBpZiAobGVuID09PSAwKSB7IHRocm93IG5ldyBFcnJvcignTGlzdCBvZiBwcm9wZXJ0aWVzIGNhbm5vdCBiZSBlbXB0eS4nKTsgfVxuXHQgICAgZm9yKHZhciBpID0gMDsgaSA8IGxlbjsgaSsrKSB7IGFyZ3NbaV0gPSBhcmd1bWVudHNbaV07IH1cblx0ICAgIHJldHVybiB0aGlzLm1hcChwbHVja2VyKGFyZ3MsIGxlbikpO1xuXHQgIH07XG5cdFxuXHRvYnNlcnZhYmxlUHJvdG8uZmxhdE1hcCA9IG9ic2VydmFibGVQcm90by5zZWxlY3RNYW55ID0gZnVuY3Rpb24oc2VsZWN0b3IsIHJlc3VsdFNlbGVjdG9yLCB0aGlzQXJnKSB7XG5cdCAgICByZXR1cm4gbmV3IEZsYXRNYXBPYnNlcnZhYmxlKHRoaXMsIHNlbGVjdG9yLCByZXN1bHRTZWxlY3RvciwgdGhpc0FyZykubWVyZ2VBbGwoKTtcblx0fTtcblx0XG5cdFxuXHQvL1xuXHQvL1J4Lk9ic2VydmFibGUucHJvdG90eXBlLmZsYXRNYXBXaXRoTWF4Q29uY3VycmVudCA9IGZ1bmN0aW9uKGxpbWl0LCBzZWxlY3RvciwgcmVzdWx0U2VsZWN0b3IsIHRoaXNBcmcpIHtcblx0Ly8gICAgcmV0dXJuIG5ldyBGbGF0TWFwT2JzZXJ2YWJsZSh0aGlzLCBzZWxlY3RvciwgcmVzdWx0U2VsZWN0b3IsIHRoaXNBcmcpLm1lcmdlKGxpbWl0KTtcblx0Ly99O1xuXHQvL1xuXHRcblx0ICAvKipcblx0ICAgKiBQcm9qZWN0cyBlYWNoIG5vdGlmaWNhdGlvbiBvZiBhbiBvYnNlcnZhYmxlIHNlcXVlbmNlIHRvIGFuIG9ic2VydmFibGUgc2VxdWVuY2UgYW5kIG1lcmdlcyB0aGUgcmVzdWx0aW5nIG9ic2VydmFibGUgc2VxdWVuY2VzIGludG8gb25lIG9ic2VydmFibGUgc2VxdWVuY2UuXG5cdCAgICogQHBhcmFtIHtGdW5jdGlvbn0gb25OZXh0IEEgdHJhbnNmb3JtIGZ1bmN0aW9uIHRvIGFwcGx5IHRvIGVhY2ggZWxlbWVudDsgdGhlIHNlY29uZCBwYXJhbWV0ZXIgb2YgdGhlIGZ1bmN0aW9uIHJlcHJlc2VudHMgdGhlIGluZGV4IG9mIHRoZSBzb3VyY2UgZWxlbWVudC5cblx0ICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBvbkVycm9yIEEgdHJhbnNmb3JtIGZ1bmN0aW9uIHRvIGFwcGx5IHdoZW4gYW4gZXJyb3Igb2NjdXJzIGluIHRoZSBzb3VyY2Ugc2VxdWVuY2UuXG5cdCAgICogQHBhcmFtIHtGdW5jdGlvbn0gb25Db21wbGV0ZWQgQSB0cmFuc2Zvcm0gZnVuY3Rpb24gdG8gYXBwbHkgd2hlbiB0aGUgZW5kIG9mIHRoZSBzb3VyY2Ugc2VxdWVuY2UgaXMgcmVhY2hlZC5cblx0ICAgKiBAcGFyYW0ge0FueX0gW3RoaXNBcmddIEFuIG9wdGlvbmFsIFwidGhpc1wiIHRvIHVzZSB0byBpbnZva2UgZWFjaCB0cmFuc2Zvcm0uXG5cdCAgICogQHJldHVybnMge09ic2VydmFibGV9IEFuIG9ic2VydmFibGUgc2VxdWVuY2Ugd2hvc2UgZWxlbWVudHMgYXJlIHRoZSByZXN1bHQgb2YgaW52b2tpbmcgdGhlIG9uZS10by1tYW55IHRyYW5zZm9ybSBmdW5jdGlvbiBjb3JyZXNwb25kaW5nIHRvIGVhY2ggbm90aWZpY2F0aW9uIGluIHRoZSBpbnB1dCBzZXF1ZW5jZS5cblx0ICAgKi9cblx0ICBvYnNlcnZhYmxlUHJvdG8uZmxhdE1hcE9ic2VydmVyID0gb2JzZXJ2YWJsZVByb3RvLnNlbGVjdE1hbnlPYnNlcnZlciA9IGZ1bmN0aW9uIChvbk5leHQsIG9uRXJyb3IsIG9uQ29tcGxldGVkLCB0aGlzQXJnKSB7XG5cdCAgICB2YXIgc291cmNlID0gdGhpcztcblx0ICAgIHJldHVybiBuZXcgQW5vbnltb3VzT2JzZXJ2YWJsZShmdW5jdGlvbiAob2JzZXJ2ZXIpIHtcblx0ICAgICAgdmFyIGluZGV4ID0gMDtcblx0XG5cdCAgICAgIHJldHVybiBzb3VyY2Uuc3Vic2NyaWJlKFxuXHQgICAgICAgIGZ1bmN0aW9uICh4KSB7XG5cdCAgICAgICAgICB2YXIgcmVzdWx0O1xuXHQgICAgICAgICAgdHJ5IHtcblx0ICAgICAgICAgICAgcmVzdWx0ID0gb25OZXh0LmNhbGwodGhpc0FyZywgeCwgaW5kZXgrKyk7XG5cdCAgICAgICAgICB9IGNhdGNoIChlKSB7XG5cdCAgICAgICAgICAgIG9ic2VydmVyLm9uRXJyb3IoZSk7XG5cdCAgICAgICAgICAgIHJldHVybjtcblx0ICAgICAgICAgIH1cblx0ICAgICAgICAgIGlzUHJvbWlzZShyZXN1bHQpICYmIChyZXN1bHQgPSBvYnNlcnZhYmxlRnJvbVByb21pc2UocmVzdWx0KSk7XG5cdCAgICAgICAgICBvYnNlcnZlci5vbk5leHQocmVzdWx0KTtcblx0ICAgICAgICB9LFxuXHQgICAgICAgIGZ1bmN0aW9uIChlcnIpIHtcblx0ICAgICAgICAgIHZhciByZXN1bHQ7XG5cdCAgICAgICAgICB0cnkge1xuXHQgICAgICAgICAgICByZXN1bHQgPSBvbkVycm9yLmNhbGwodGhpc0FyZywgZXJyKTtcblx0ICAgICAgICAgIH0gY2F0Y2ggKGUpIHtcblx0ICAgICAgICAgICAgb2JzZXJ2ZXIub25FcnJvcihlKTtcblx0ICAgICAgICAgICAgcmV0dXJuO1xuXHQgICAgICAgICAgfVxuXHQgICAgICAgICAgaXNQcm9taXNlKHJlc3VsdCkgJiYgKHJlc3VsdCA9IG9ic2VydmFibGVGcm9tUHJvbWlzZShyZXN1bHQpKTtcblx0ICAgICAgICAgIG9ic2VydmVyLm9uTmV4dChyZXN1bHQpO1xuXHQgICAgICAgICAgb2JzZXJ2ZXIub25Db21wbGV0ZWQoKTtcblx0ICAgICAgICB9LFxuXHQgICAgICAgIGZ1bmN0aW9uICgpIHtcblx0ICAgICAgICAgIHZhciByZXN1bHQ7XG5cdCAgICAgICAgICB0cnkge1xuXHQgICAgICAgICAgICByZXN1bHQgPSBvbkNvbXBsZXRlZC5jYWxsKHRoaXNBcmcpO1xuXHQgICAgICAgICAgfSBjYXRjaCAoZSkge1xuXHQgICAgICAgICAgICBvYnNlcnZlci5vbkVycm9yKGUpO1xuXHQgICAgICAgICAgICByZXR1cm47XG5cdCAgICAgICAgICB9XG5cdCAgICAgICAgICBpc1Byb21pc2UocmVzdWx0KSAmJiAocmVzdWx0ID0gb2JzZXJ2YWJsZUZyb21Qcm9taXNlKHJlc3VsdCkpO1xuXHQgICAgICAgICAgb2JzZXJ2ZXIub25OZXh0KHJlc3VsdCk7XG5cdCAgICAgICAgICBvYnNlcnZlci5vbkNvbXBsZXRlZCgpO1xuXHQgICAgICAgIH0pO1xuXHQgICAgfSwgc291cmNlKS5tZXJnZUFsbCgpO1xuXHQgIH07XG5cdFxuXHRSeC5PYnNlcnZhYmxlLnByb3RvdHlwZS5mbGF0TWFwTGF0ZXN0ID0gZnVuY3Rpb24oc2VsZWN0b3IsIHJlc3VsdFNlbGVjdG9yLCB0aGlzQXJnKSB7XG5cdCAgICByZXR1cm4gbmV3IEZsYXRNYXBPYnNlcnZhYmxlKHRoaXMsIHNlbGVjdG9yLCByZXN1bHRTZWxlY3RvciwgdGhpc0FyZykuc3dpdGNoTGF0ZXN0KCk7XG5cdH07XG5cdCAgdmFyIFNraXBPYnNlcnZhYmxlID0gKGZ1bmN0aW9uKF9fc3VwZXJfXykge1xuXHQgICAgaW5oZXJpdHMoU2tpcE9ic2VydmFibGUsIF9fc3VwZXJfXyk7XG5cdCAgICBmdW5jdGlvbiBTa2lwT2JzZXJ2YWJsZShzb3VyY2UsIGNvdW50KSB7XG5cdCAgICAgIHRoaXMuc291cmNlID0gc291cmNlO1xuXHQgICAgICB0aGlzLnNraXBDb3VudCA9IGNvdW50O1xuXHQgICAgICBfX3N1cGVyX18uY2FsbCh0aGlzKTtcblx0ICAgIH1cblx0ICAgIFxuXHQgICAgU2tpcE9ic2VydmFibGUucHJvdG90eXBlLnN1YnNjcmliZUNvcmUgPSBmdW5jdGlvbiAobykge1xuXHQgICAgICByZXR1cm4gdGhpcy5zb3VyY2Uuc3Vic2NyaWJlKG5ldyBJbm5lck9ic2VydmVyKG8sIHRoaXMuc2tpcENvdW50KSk7XG5cdCAgICB9O1xuXHQgICAgXG5cdCAgICBmdW5jdGlvbiBJbm5lck9ic2VydmVyKG8sIGMpIHtcblx0ICAgICAgdGhpcy5jID0gYztcblx0ICAgICAgdGhpcy5yID0gYztcblx0ICAgICAgdGhpcy5vID0gbztcblx0ICAgICAgdGhpcy5pc1N0b3BwZWQgPSBmYWxzZTtcblx0ICAgIH1cblx0ICAgIElubmVyT2JzZXJ2ZXIucHJvdG90eXBlLm9uTmV4dCA9IGZ1bmN0aW9uICh4KSB7XG5cdCAgICAgIGlmICh0aGlzLmlzU3RvcHBlZCkgeyByZXR1cm47IH1cblx0ICAgICAgaWYgKHRoaXMuciA8PSAwKSB7IFxuXHQgICAgICAgIHRoaXMuby5vbk5leHQoeCk7XG5cdCAgICAgIH0gZWxzZSB7XG5cdCAgICAgICAgdGhpcy5yLS07XG5cdCAgICAgIH1cblx0ICAgIH07XG5cdCAgICBJbm5lck9ic2VydmVyLnByb3RvdHlwZS5vbkVycm9yID0gZnVuY3Rpb24oZSkge1xuXHQgICAgICBpZiAoIXRoaXMuaXNTdG9wcGVkKSB7IHRoaXMuaXNTdG9wcGVkID0gdHJ1ZTsgdGhpcy5vLm9uRXJyb3IoZSk7IH1cblx0ICAgIH07XG5cdCAgICBJbm5lck9ic2VydmVyLnByb3RvdHlwZS5vbkNvbXBsZXRlZCA9IGZ1bmN0aW9uKCkge1xuXHQgICAgICBpZiAoIXRoaXMuaXNTdG9wcGVkKSB7IHRoaXMuaXNTdG9wcGVkID0gdHJ1ZTsgdGhpcy5vLm9uQ29tcGxldGVkKCk7IH1cblx0ICAgIH07XG5cdCAgICBJbm5lck9ic2VydmVyLnByb3RvdHlwZS5kaXNwb3NlID0gZnVuY3Rpb24oKSB7IHRoaXMuaXNTdG9wcGVkID0gdHJ1ZTsgfTtcblx0ICAgIElubmVyT2JzZXJ2ZXIucHJvdG90eXBlLmZhaWwgPSBmdW5jdGlvbihlKSB7XG5cdCAgICAgIGlmICghdGhpcy5pc1N0b3BwZWQpIHtcblx0ICAgICAgICB0aGlzLmlzU3RvcHBlZCA9IHRydWU7XG5cdCAgICAgICAgdGhpcy5vLm9uRXJyb3IoZSk7XG5cdCAgICAgICAgcmV0dXJuIHRydWU7XG5cdCAgICAgIH1cblx0ICAgICAgcmV0dXJuIGZhbHNlO1xuXHQgICAgfTtcblx0ICAgIFxuXHQgICAgcmV0dXJuIFNraXBPYnNlcnZhYmxlO1xuXHQgIH0oT2JzZXJ2YWJsZUJhc2UpKTsgIFxuXHQgIFxuXHQgIC8qKlxuXHQgICAqIEJ5cGFzc2VzIGEgc3BlY2lmaWVkIG51bWJlciBvZiBlbGVtZW50cyBpbiBhbiBvYnNlcnZhYmxlIHNlcXVlbmNlIGFuZCB0aGVuIHJldHVybnMgdGhlIHJlbWFpbmluZyBlbGVtZW50cy5cblx0ICAgKiBAcGFyYW0ge051bWJlcn0gY291bnQgVGhlIG51bWJlciBvZiBlbGVtZW50cyB0byBza2lwIGJlZm9yZSByZXR1cm5pbmcgdGhlIHJlbWFpbmluZyBlbGVtZW50cy5cblx0ICAgKiBAcmV0dXJucyB7T2JzZXJ2YWJsZX0gQW4gb2JzZXJ2YWJsZSBzZXF1ZW5jZSB0aGF0IGNvbnRhaW5zIHRoZSBlbGVtZW50cyB0aGF0IG9jY3VyIGFmdGVyIHRoZSBzcGVjaWZpZWQgaW5kZXggaW4gdGhlIGlucHV0IHNlcXVlbmNlLlxuXHQgICAqL1xuXHQgIG9ic2VydmFibGVQcm90by5za2lwID0gZnVuY3Rpb24gKGNvdW50KSB7XG5cdCAgICBpZiAoY291bnQgPCAwKSB7IHRocm93IG5ldyBBcmd1bWVudE91dE9mUmFuZ2VFcnJvcigpOyB9XG5cdCAgICByZXR1cm4gbmV3IFNraXBPYnNlcnZhYmxlKHRoaXMsIGNvdW50KTtcblx0ICB9O1xuXHQgIHZhciBTa2lwV2hpbGVPYnNlcnZhYmxlID0gKGZ1bmN0aW9uIChfX3N1cGVyX18pIHtcblx0ICAgIGluaGVyaXRzKFNraXBXaGlsZU9ic2VydmFibGUsIF9fc3VwZXJfXyk7XG5cdCAgICBmdW5jdGlvbiBTa2lwV2hpbGVPYnNlcnZhYmxlKHNvdXJjZSwgZm4pIHtcblx0ICAgICAgdGhpcy5zb3VyY2UgPSBzb3VyY2U7XG5cdCAgICAgIHRoaXMuX2ZuID0gZm47XG5cdCAgICAgIF9fc3VwZXJfXy5jYWxsKHRoaXMpO1xuXHQgICAgfVxuXHRcblx0ICAgIFNraXBXaGlsZU9ic2VydmFibGUucHJvdG90eXBlLnN1YnNjcmliZUNvcmUgPSBmdW5jdGlvbiAobykge1xuXHQgICAgICByZXR1cm4gdGhpcy5zb3VyY2Uuc3Vic2NyaWJlKG5ldyBTa2lwV2hpbGVPYnNlcnZlcihvLCB0aGlzKSk7XG5cdCAgICB9O1xuXHRcblx0ICAgIHJldHVybiBTa2lwV2hpbGVPYnNlcnZhYmxlO1xuXHQgIH0oT2JzZXJ2YWJsZUJhc2UpKTtcblx0XG5cdCAgdmFyIFNraXBXaGlsZU9ic2VydmVyID0gKGZ1bmN0aW9uIChfX3N1cGVyX18pIHtcblx0ICAgIGluaGVyaXRzKFNraXBXaGlsZU9ic2VydmVyLCBfX3N1cGVyX18pO1xuXHRcblx0ICAgIGZ1bmN0aW9uIFNraXBXaGlsZU9ic2VydmVyKG8sIHApIHtcblx0ICAgICAgdGhpcy5fbyA9IG87XG5cdCAgICAgIHRoaXMuX3AgPSBwO1xuXHQgICAgICB0aGlzLl9pID0gMDtcblx0ICAgICAgdGhpcy5fciA9IGZhbHNlO1xuXHQgICAgICBfX3N1cGVyX18uY2FsbCh0aGlzKTtcblx0ICAgIH1cblx0XG5cdCAgICBTa2lwV2hpbGVPYnNlcnZlci5wcm90b3R5cGUubmV4dCA9IGZ1bmN0aW9uICh4KSB7XG5cdCAgICAgIGlmICghdGhpcy5fcikge1xuXHQgICAgICAgIHZhciByZXMgPSB0cnlDYXRjaCh0aGlzLl9wLl9mbikoeCwgdGhpcy5faSsrLCB0aGlzLl9wKTtcblx0ICAgICAgICBpZiAocmVzID09PSBlcnJvck9iaikgeyByZXR1cm4gdGhpcy5fby5vbkVycm9yKHJlcy5lKTsgfVxuXHQgICAgICAgIHRoaXMuX3IgPSAhcmVzO1xuXHQgICAgICB9XG5cdCAgICAgIHRoaXMuX3IgJiYgdGhpcy5fby5vbk5leHQoeCk7XG5cdCAgICB9O1xuXHQgICAgU2tpcFdoaWxlT2JzZXJ2ZXIucHJvdG90eXBlLmVycm9yID0gZnVuY3Rpb24gKGUpIHsgdGhpcy5fby5vbkVycm9yKGUpOyB9O1xuXHQgICAgU2tpcFdoaWxlT2JzZXJ2ZXIucHJvdG90eXBlLmNvbXBsZXRlZCA9IGZ1bmN0aW9uICgpIHsgdGhpcy5fby5vbkNvbXBsZXRlZCgpOyB9O1xuXHRcblx0ICAgIHJldHVybiBTa2lwV2hpbGVPYnNlcnZlcjtcblx0ICB9KEFic3RyYWN0T2JzZXJ2ZXIpKTtcblx0XG5cdCAgLyoqXG5cdCAgICogIEJ5cGFzc2VzIGVsZW1lbnRzIGluIGFuIG9ic2VydmFibGUgc2VxdWVuY2UgYXMgbG9uZyBhcyBhIHNwZWNpZmllZCBjb25kaXRpb24gaXMgdHJ1ZSBhbmQgdGhlbiByZXR1cm5zIHRoZSByZW1haW5pbmcgZWxlbWVudHMuXG5cdCAgICogIFRoZSBlbGVtZW50J3MgaW5kZXggaXMgdXNlZCBpbiB0aGUgbG9naWMgb2YgdGhlIHByZWRpY2F0ZSBmdW5jdGlvbi5cblx0ICAgKlxuXHQgICAqICB2YXIgcmVzID0gc291cmNlLnNraXBXaGlsZShmdW5jdGlvbiAodmFsdWUpIHsgcmV0dXJuIHZhbHVlIDwgMTA7IH0pO1xuXHQgICAqICB2YXIgcmVzID0gc291cmNlLnNraXBXaGlsZShmdW5jdGlvbiAodmFsdWUsIGluZGV4KSB7IHJldHVybiB2YWx1ZSA8IDEwIHx8IGluZGV4IDwgMTA7IH0pO1xuXHQgICAqIEBwYXJhbSB7RnVuY3Rpb259IHByZWRpY2F0ZSBBIGZ1bmN0aW9uIHRvIHRlc3QgZWFjaCBlbGVtZW50IGZvciBhIGNvbmRpdGlvbjsgdGhlIHNlY29uZCBwYXJhbWV0ZXIgb2YgdGhlIGZ1bmN0aW9uIHJlcHJlc2VudHMgdGhlIGluZGV4IG9mIHRoZSBzb3VyY2UgZWxlbWVudC5cblx0ICAgKiBAcGFyYW0ge0FueX0gW3RoaXNBcmddIE9iamVjdCB0byB1c2UgYXMgdGhpcyB3aGVuIGV4ZWN1dGluZyBjYWxsYmFjay5cblx0ICAgKiBAcmV0dXJucyB7T2JzZXJ2YWJsZX0gQW4gb2JzZXJ2YWJsZSBzZXF1ZW5jZSB0aGF0IGNvbnRhaW5zIHRoZSBlbGVtZW50cyBmcm9tIHRoZSBpbnB1dCBzZXF1ZW5jZSBzdGFydGluZyBhdCB0aGUgZmlyc3QgZWxlbWVudCBpbiB0aGUgbGluZWFyIHNlcmllcyB0aGF0IGRvZXMgbm90IHBhc3MgdGhlIHRlc3Qgc3BlY2lmaWVkIGJ5IHByZWRpY2F0ZS5cblx0ICAgKi9cblx0ICBvYnNlcnZhYmxlUHJvdG8uc2tpcFdoaWxlID0gZnVuY3Rpb24gKHByZWRpY2F0ZSwgdGhpc0FyZykge1xuXHQgICAgdmFyIGZuID0gYmluZENhbGxiYWNrKHByZWRpY2F0ZSwgdGhpc0FyZywgMyk7XG5cdCAgICByZXR1cm4gbmV3IFNraXBXaGlsZU9ic2VydmFibGUodGhpcywgZm4pO1xuXHQgIH07XG5cdFxuXHQgIHZhciBUYWtlT2JzZXJ2YWJsZSA9IChmdW5jdGlvbihfX3N1cGVyX18pIHtcblx0ICAgIGluaGVyaXRzKFRha2VPYnNlcnZhYmxlLCBfX3N1cGVyX18pO1xuXHQgICAgXG5cdCAgICBmdW5jdGlvbiBUYWtlT2JzZXJ2YWJsZShzb3VyY2UsIGNvdW50KSB7XG5cdCAgICAgIHRoaXMuc291cmNlID0gc291cmNlO1xuXHQgICAgICB0aGlzLnRha2VDb3VudCA9IGNvdW50O1xuXHQgICAgICBfX3N1cGVyX18uY2FsbCh0aGlzKTtcblx0ICAgIH1cblx0ICAgIFxuXHQgICAgVGFrZU9ic2VydmFibGUucHJvdG90eXBlLnN1YnNjcmliZUNvcmUgPSBmdW5jdGlvbiAobykge1xuXHQgICAgICByZXR1cm4gdGhpcy5zb3VyY2Uuc3Vic2NyaWJlKG5ldyBJbm5lck9ic2VydmVyKG8sIHRoaXMudGFrZUNvdW50KSk7XG5cdCAgICB9O1xuXHQgICAgXG5cdCAgICBmdW5jdGlvbiBJbm5lck9ic2VydmVyKG8sIGMpIHtcblx0ICAgICAgdGhpcy5vID0gbztcblx0ICAgICAgdGhpcy5jID0gYztcblx0ICAgICAgdGhpcy5yID0gYztcblx0ICAgICAgdGhpcy5pc1N0b3BwZWQgPSBmYWxzZTtcblx0ICAgIH1cblx0ICAgIElubmVyT2JzZXJ2ZXIucHJvdG90eXBlID0ge1xuXHQgICAgICBvbk5leHQ6IGZ1bmN0aW9uICh4KSB7XG5cdCAgICAgICAgaWYgKHRoaXMuaXNTdG9wcGVkKSB7IHJldHVybjsgfVxuXHQgICAgICAgIGlmICh0aGlzLnItLSA+IDApIHtcblx0ICAgICAgICAgIHRoaXMuby5vbk5leHQoeCk7XG5cdCAgICAgICAgICB0aGlzLnIgPD0gMCAmJiB0aGlzLm8ub25Db21wbGV0ZWQoKTtcblx0ICAgICAgICB9XG5cdCAgICAgIH0sXG5cdCAgICAgIG9uRXJyb3I6IGZ1bmN0aW9uIChlcnIpIHtcblx0ICAgICAgICBpZiAoIXRoaXMuaXNTdG9wcGVkKSB7XG5cdCAgICAgICAgICB0aGlzLmlzU3RvcHBlZCA9IHRydWU7XG5cdCAgICAgICAgICB0aGlzLm8ub25FcnJvcihlcnIpO1xuXHQgICAgICAgIH1cblx0ICAgICAgfSxcblx0ICAgICAgb25Db21wbGV0ZWQ6IGZ1bmN0aW9uICgpIHtcblx0ICAgICAgICBpZiAoIXRoaXMuaXNTdG9wcGVkKSB7XG5cdCAgICAgICAgICB0aGlzLmlzU3RvcHBlZCA9IHRydWU7XG5cdCAgICAgICAgICB0aGlzLm8ub25Db21wbGV0ZWQoKTtcblx0ICAgICAgICB9XG5cdCAgICAgIH0sXG5cdCAgICAgIGRpc3Bvc2U6IGZ1bmN0aW9uICgpIHsgdGhpcy5pc1N0b3BwZWQgPSB0cnVlOyB9LFxuXHQgICAgICBmYWlsOiBmdW5jdGlvbiAoZSkge1xuXHQgICAgICAgIGlmICghdGhpcy5pc1N0b3BwZWQpIHtcblx0ICAgICAgICAgIHRoaXMuaXNTdG9wcGVkID0gdHJ1ZTtcblx0ICAgICAgICAgIHRoaXMuby5vbkVycm9yKGUpO1xuXHQgICAgICAgICAgcmV0dXJuIHRydWU7XG5cdCAgICAgICAgfVxuXHQgICAgICAgIHJldHVybiBmYWxzZTtcblx0ICAgICAgfVxuXHQgICAgfTtcblx0ICAgIFxuXHQgICAgcmV0dXJuIFRha2VPYnNlcnZhYmxlO1xuXHQgIH0oT2JzZXJ2YWJsZUJhc2UpKTsgIFxuXHQgIFxuXHQgIC8qKlxuXHQgICAqICBSZXR1cm5zIGEgc3BlY2lmaWVkIG51bWJlciBvZiBjb250aWd1b3VzIGVsZW1lbnRzIGZyb20gdGhlIHN0YXJ0IG9mIGFuIG9ic2VydmFibGUgc2VxdWVuY2UsIHVzaW5nIHRoZSBzcGVjaWZpZWQgc2NoZWR1bGVyIGZvciB0aGUgZWRnZSBjYXNlIG9mIHRha2UoMCkuXG5cdCAgICogQHBhcmFtIHtOdW1iZXJ9IGNvdW50IFRoZSBudW1iZXIgb2YgZWxlbWVudHMgdG8gcmV0dXJuLlxuXHQgICAqIEBwYXJhbSB7U2NoZWR1bGVyfSBbc2NoZWR1bGVyXSBTY2hlZHVsZXIgdXNlZCB0byBwcm9kdWNlIGFuIE9uQ29tcGxldGVkIG1lc3NhZ2UgaW4gY2FzZSA8cGFyYW1yZWYgbmFtZT1cImNvdW50IGNvdW50PC9wYXJhbXJlZj4gaXMgc2V0IHRvIDAuXG5cdCAgICogQHJldHVybnMge09ic2VydmFibGV9IEFuIG9ic2VydmFibGUgc2VxdWVuY2UgdGhhdCBjb250YWlucyB0aGUgc3BlY2lmaWVkIG51bWJlciBvZiBlbGVtZW50cyBmcm9tIHRoZSBzdGFydCBvZiB0aGUgaW5wdXQgc2VxdWVuY2UuXG5cdCAgICovXG5cdCAgb2JzZXJ2YWJsZVByb3RvLnRha2UgPSBmdW5jdGlvbiAoY291bnQsIHNjaGVkdWxlcikge1xuXHQgICAgaWYgKGNvdW50IDwgMCkgeyB0aHJvdyBuZXcgQXJndW1lbnRPdXRPZlJhbmdlRXJyb3IoKTsgfVxuXHQgICAgaWYgKGNvdW50ID09PSAwKSB7IHJldHVybiBvYnNlcnZhYmxlRW1wdHkoc2NoZWR1bGVyKTsgfVxuXHQgICAgcmV0dXJuIG5ldyBUYWtlT2JzZXJ2YWJsZSh0aGlzLCBjb3VudCk7XG5cdCAgfTtcblx0XG5cdCAgdmFyIFRha2VXaGlsZU9ic2VydmFibGUgPSAoZnVuY3Rpb24gKF9fc3VwZXJfXykge1xuXHQgICAgaW5oZXJpdHMoVGFrZVdoaWxlT2JzZXJ2YWJsZSwgX19zdXBlcl9fKTtcblx0ICAgIGZ1bmN0aW9uIFRha2VXaGlsZU9ic2VydmFibGUoc291cmNlLCBmbikge1xuXHQgICAgICB0aGlzLnNvdXJjZSA9IHNvdXJjZTtcblx0ICAgICAgdGhpcy5fZm4gPSBmbjtcblx0ICAgICAgX19zdXBlcl9fLmNhbGwodGhpcyk7XG5cdCAgICB9XG5cdFxuXHQgICAgVGFrZVdoaWxlT2JzZXJ2YWJsZS5wcm90b3R5cGUuc3Vic2NyaWJlQ29yZSA9IGZ1bmN0aW9uIChvKSB7XG5cdCAgICAgIHJldHVybiB0aGlzLnNvdXJjZS5zdWJzY3JpYmUobmV3IFRha2VXaGlsZU9ic2VydmVyKG8sIHRoaXMpKTtcblx0ICAgIH07XG5cdFxuXHQgICAgcmV0dXJuIFRha2VXaGlsZU9ic2VydmFibGU7XG5cdCAgfShPYnNlcnZhYmxlQmFzZSkpO1xuXHRcblx0ICB2YXIgVGFrZVdoaWxlT2JzZXJ2ZXIgPSAoZnVuY3Rpb24gKF9fc3VwZXJfXykge1xuXHQgICAgaW5oZXJpdHMoVGFrZVdoaWxlT2JzZXJ2ZXIsIF9fc3VwZXJfXyk7XG5cdFxuXHQgICAgZnVuY3Rpb24gVGFrZVdoaWxlT2JzZXJ2ZXIobywgcCkge1xuXHQgICAgICB0aGlzLl9vID0gbztcblx0ICAgICAgdGhpcy5fcCA9IHA7XG5cdCAgICAgIHRoaXMuX2kgPSAwO1xuXHQgICAgICB0aGlzLl9yID0gdHJ1ZTtcblx0ICAgICAgX19zdXBlcl9fLmNhbGwodGhpcyk7XG5cdCAgICB9XG5cdFxuXHQgICAgVGFrZVdoaWxlT2JzZXJ2ZXIucHJvdG90eXBlLm5leHQgPSBmdW5jdGlvbiAoeCkge1xuXHQgICAgICBpZiAodGhpcy5fcikge1xuXHQgICAgICAgIHRoaXMuX3IgPSB0cnlDYXRjaCh0aGlzLl9wLl9mbikoeCwgdGhpcy5faSsrLCB0aGlzLl9wKTtcblx0ICAgICAgICBpZiAodGhpcy5fciA9PT0gZXJyb3JPYmopIHsgcmV0dXJuIHRoaXMuX28ub25FcnJvcih0aGlzLl9yLmUpOyB9XG5cdCAgICAgIH1cblx0ICAgICAgaWYgKHRoaXMuX3IpIHtcblx0ICAgICAgICB0aGlzLl9vLm9uTmV4dCh4KTtcblx0ICAgICAgfSBlbHNlIHtcblx0ICAgICAgICB0aGlzLl9vLm9uQ29tcGxldGVkKCk7XG5cdCAgICAgIH1cblx0ICAgIH07XG5cdCAgICBUYWtlV2hpbGVPYnNlcnZlci5wcm90b3R5cGUuZXJyb3IgPSBmdW5jdGlvbiAoZSkgeyB0aGlzLl9vLm9uRXJyb3IoZSk7IH07XG5cdCAgICBUYWtlV2hpbGVPYnNlcnZlci5wcm90b3R5cGUuY29tcGxldGVkID0gZnVuY3Rpb24gKCkgeyB0aGlzLl9vLm9uQ29tcGxldGVkKCk7IH07XG5cdFxuXHQgICAgcmV0dXJuIFRha2VXaGlsZU9ic2VydmVyO1xuXHQgIH0oQWJzdHJhY3RPYnNlcnZlcikpO1xuXHRcblx0ICAvKipcblx0ICAgKiAgUmV0dXJucyBlbGVtZW50cyBmcm9tIGFuIG9ic2VydmFibGUgc2VxdWVuY2UgYXMgbG9uZyBhcyBhIHNwZWNpZmllZCBjb25kaXRpb24gaXMgdHJ1ZS5cblx0ICAgKiAgVGhlIGVsZW1lbnQncyBpbmRleCBpcyB1c2VkIGluIHRoZSBsb2dpYyBvZiB0aGUgcHJlZGljYXRlIGZ1bmN0aW9uLlxuXHQgICAqIEBwYXJhbSB7RnVuY3Rpb259IHByZWRpY2F0ZSBBIGZ1bmN0aW9uIHRvIHRlc3QgZWFjaCBlbGVtZW50IGZvciBhIGNvbmRpdGlvbjsgdGhlIHNlY29uZCBwYXJhbWV0ZXIgb2YgdGhlIGZ1bmN0aW9uIHJlcHJlc2VudHMgdGhlIGluZGV4IG9mIHRoZSBzb3VyY2UgZWxlbWVudC5cblx0ICAgKiBAcGFyYW0ge0FueX0gW3RoaXNBcmddIE9iamVjdCB0byB1c2UgYXMgdGhpcyB3aGVuIGV4ZWN1dGluZyBjYWxsYmFjay5cblx0ICAgKiBAcmV0dXJucyB7T2JzZXJ2YWJsZX0gQW4gb2JzZXJ2YWJsZSBzZXF1ZW5jZSB0aGF0IGNvbnRhaW5zIHRoZSBlbGVtZW50cyBmcm9tIHRoZSBpbnB1dCBzZXF1ZW5jZSB0aGF0IG9jY3VyIGJlZm9yZSB0aGUgZWxlbWVudCBhdCB3aGljaCB0aGUgdGVzdCBubyBsb25nZXIgcGFzc2VzLlxuXHQgICAqL1xuXHQgIG9ic2VydmFibGVQcm90by50YWtlV2hpbGUgPSBmdW5jdGlvbiAocHJlZGljYXRlLCB0aGlzQXJnKSB7XG5cdCAgICB2YXIgZm4gPSBiaW5kQ2FsbGJhY2socHJlZGljYXRlLCB0aGlzQXJnLCAzKTtcblx0ICAgIHJldHVybiBuZXcgVGFrZVdoaWxlT2JzZXJ2YWJsZSh0aGlzLCBmbik7XG5cdCAgfTtcblx0XG5cdCAgdmFyIEZpbHRlck9ic2VydmFibGUgPSAoZnVuY3Rpb24gKF9fc3VwZXJfXykge1xuXHQgICAgaW5oZXJpdHMoRmlsdGVyT2JzZXJ2YWJsZSwgX19zdXBlcl9fKTtcblx0XG5cdCAgICBmdW5jdGlvbiBGaWx0ZXJPYnNlcnZhYmxlKHNvdXJjZSwgcHJlZGljYXRlLCB0aGlzQXJnKSB7XG5cdCAgICAgIHRoaXMuc291cmNlID0gc291cmNlO1xuXHQgICAgICB0aGlzLnByZWRpY2F0ZSA9IGJpbmRDYWxsYmFjayhwcmVkaWNhdGUsIHRoaXNBcmcsIDMpO1xuXHQgICAgICBfX3N1cGVyX18uY2FsbCh0aGlzKTtcblx0ICAgIH1cblx0XG5cdCAgICBGaWx0ZXJPYnNlcnZhYmxlLnByb3RvdHlwZS5zdWJzY3JpYmVDb3JlID0gZnVuY3Rpb24gKG8pIHtcblx0ICAgICAgcmV0dXJuIHRoaXMuc291cmNlLnN1YnNjcmliZShuZXcgSW5uZXJPYnNlcnZlcihvLCB0aGlzLnByZWRpY2F0ZSwgdGhpcykpO1xuXHQgICAgfTtcblx0XG5cdCAgICBmdW5jdGlvbiBpbm5lclByZWRpY2F0ZShwcmVkaWNhdGUsIHNlbGYpIHtcblx0ICAgICAgcmV0dXJuIGZ1bmN0aW9uKHgsIGksIG8pIHsgcmV0dXJuIHNlbGYucHJlZGljYXRlKHgsIGksIG8pICYmIHByZWRpY2F0ZS5jYWxsKHRoaXMsIHgsIGksIG8pOyB9XG5cdCAgICB9XG5cdFxuXHQgICAgRmlsdGVyT2JzZXJ2YWJsZS5wcm90b3R5cGUuaW50ZXJuYWxGaWx0ZXIgPSBmdW5jdGlvbihwcmVkaWNhdGUsIHRoaXNBcmcpIHtcblx0ICAgICAgcmV0dXJuIG5ldyBGaWx0ZXJPYnNlcnZhYmxlKHRoaXMuc291cmNlLCBpbm5lclByZWRpY2F0ZShwcmVkaWNhdGUsIHRoaXMpLCB0aGlzQXJnKTtcblx0ICAgIH07XG5cdFxuXHQgICAgaW5oZXJpdHMoSW5uZXJPYnNlcnZlciwgQWJzdHJhY3RPYnNlcnZlcik7XG5cdCAgICBmdW5jdGlvbiBJbm5lck9ic2VydmVyKG8sIHByZWRpY2F0ZSwgc291cmNlKSB7XG5cdCAgICAgIHRoaXMubyA9IG87XG5cdCAgICAgIHRoaXMucHJlZGljYXRlID0gcHJlZGljYXRlO1xuXHQgICAgICB0aGlzLnNvdXJjZSA9IHNvdXJjZTtcblx0ICAgICAgdGhpcy5pID0gMDtcblx0ICAgICAgQWJzdHJhY3RPYnNlcnZlci5jYWxsKHRoaXMpO1xuXHQgICAgfVxuXHRcblx0ICAgIElubmVyT2JzZXJ2ZXIucHJvdG90eXBlLm5leHQgPSBmdW5jdGlvbih4KSB7XG5cdCAgICAgIHZhciBzaG91bGRZaWVsZCA9IHRyeUNhdGNoKHRoaXMucHJlZGljYXRlKSh4LCB0aGlzLmkrKywgdGhpcy5zb3VyY2UpO1xuXHQgICAgICBpZiAoc2hvdWxkWWllbGQgPT09IGVycm9yT2JqKSB7XG5cdCAgICAgICAgcmV0dXJuIHRoaXMuby5vbkVycm9yKHNob3VsZFlpZWxkLmUpO1xuXHQgICAgICB9XG5cdCAgICAgIHNob3VsZFlpZWxkICYmIHRoaXMuby5vbk5leHQoeCk7XG5cdCAgICB9O1xuXHRcblx0ICAgIElubmVyT2JzZXJ2ZXIucHJvdG90eXBlLmVycm9yID0gZnVuY3Rpb24gKGUpIHtcblx0ICAgICAgdGhpcy5vLm9uRXJyb3IoZSk7XG5cdCAgICB9O1xuXHRcblx0ICAgIElubmVyT2JzZXJ2ZXIucHJvdG90eXBlLmNvbXBsZXRlZCA9IGZ1bmN0aW9uICgpIHtcblx0ICAgICAgdGhpcy5vLm9uQ29tcGxldGVkKCk7XG5cdCAgICB9O1xuXHRcblx0ICAgIHJldHVybiBGaWx0ZXJPYnNlcnZhYmxlO1xuXHRcblx0ICB9KE9ic2VydmFibGVCYXNlKSk7XG5cdFxuXHQgIC8qKlxuXHQgICogIEZpbHRlcnMgdGhlIGVsZW1lbnRzIG9mIGFuIG9ic2VydmFibGUgc2VxdWVuY2UgYmFzZWQgb24gYSBwcmVkaWNhdGUgYnkgaW5jb3Jwb3JhdGluZyB0aGUgZWxlbWVudCdzIGluZGV4LlxuXHQgICogQHBhcmFtIHtGdW5jdGlvbn0gcHJlZGljYXRlIEEgZnVuY3Rpb24gdG8gdGVzdCBlYWNoIHNvdXJjZSBlbGVtZW50IGZvciBhIGNvbmRpdGlvbjsgdGhlIHNlY29uZCBwYXJhbWV0ZXIgb2YgdGhlIGZ1bmN0aW9uIHJlcHJlc2VudHMgdGhlIGluZGV4IG9mIHRoZSBzb3VyY2UgZWxlbWVudC5cblx0ICAqIEBwYXJhbSB7QW55fSBbdGhpc0FyZ10gT2JqZWN0IHRvIHVzZSBhcyB0aGlzIHdoZW4gZXhlY3V0aW5nIGNhbGxiYWNrLlxuXHQgICogQHJldHVybnMge09ic2VydmFibGV9IEFuIG9ic2VydmFibGUgc2VxdWVuY2UgdGhhdCBjb250YWlucyBlbGVtZW50cyBmcm9tIHRoZSBpbnB1dCBzZXF1ZW5jZSB0aGF0IHNhdGlzZnkgdGhlIGNvbmRpdGlvbi5cblx0ICAqL1xuXHQgIG9ic2VydmFibGVQcm90by5maWx0ZXIgPSBvYnNlcnZhYmxlUHJvdG8ud2hlcmUgPSBmdW5jdGlvbiAocHJlZGljYXRlLCB0aGlzQXJnKSB7XG5cdCAgICByZXR1cm4gdGhpcyBpbnN0YW5jZW9mIEZpbHRlck9ic2VydmFibGUgPyB0aGlzLmludGVybmFsRmlsdGVyKHByZWRpY2F0ZSwgdGhpc0FyZykgOlxuXHQgICAgICBuZXcgRmlsdGVyT2JzZXJ2YWJsZSh0aGlzLCBwcmVkaWNhdGUsIHRoaXNBcmcpO1xuXHQgIH07XG5cdFxuXHQgIHZhciBFeHRyZW1hQnlPYnNlcnZhYmxlID0gKGZ1bmN0aW9uIChfX3N1cGVyX18pIHtcblx0ICAgIGluaGVyaXRzKEV4dHJlbWFCeU9ic2VydmFibGUsIF9fc3VwZXJfXyk7XG5cdCAgICBmdW5jdGlvbiBFeHRyZW1hQnlPYnNlcnZhYmxlKHNvdXJjZSwgaywgYykge1xuXHQgICAgICB0aGlzLnNvdXJjZSA9IHNvdXJjZTtcblx0ICAgICAgdGhpcy5fayA9IGs7XG5cdCAgICAgIHRoaXMuX2MgPSBjO1xuXHQgICAgICBfX3N1cGVyX18uY2FsbCh0aGlzKTtcblx0ICAgIH1cblx0XG5cdCAgICBFeHRyZW1hQnlPYnNlcnZhYmxlLnByb3RvdHlwZS5zdWJzY3JpYmVDb3JlID0gZnVuY3Rpb24gKG8pIHtcblx0ICAgICAgcmV0dXJuIHRoaXMuc291cmNlLnN1YnNjcmliZShuZXcgRXh0cmVtYUJ5T2JzZXJ2ZXIobywgdGhpcy5faywgdGhpcy5fYykpO1xuXHQgICAgfTtcblx0XG5cdCAgICByZXR1cm4gRXh0cmVtYUJ5T2JzZXJ2YWJsZTtcblx0ICB9KE9ic2VydmFibGVCYXNlKSk7XG5cdFxuXHQgIHZhciBFeHRyZW1hQnlPYnNlcnZlciA9IChmdW5jdGlvbiAoX19zdXBlcl9fKSB7XG5cdCAgICBpbmhlcml0cyhFeHRyZW1hQnlPYnNlcnZlciwgX19zdXBlcl9fKTtcblx0ICAgIGZ1bmN0aW9uIEV4dHJlbWFCeU9ic2VydmVyKG8sIGssIGMpIHtcblx0ICAgICAgdGhpcy5fbyA9IG87XG5cdCAgICAgIHRoaXMuX2sgPSBrO1xuXHQgICAgICB0aGlzLl9jID0gYztcblx0ICAgICAgdGhpcy5fdiA9IG51bGw7XG5cdCAgICAgIHRoaXMuX2h2ID0gZmFsc2U7XG5cdCAgICAgIHRoaXMuX2wgPSBbXTtcblx0ICAgICAgX19zdXBlcl9fLmNhbGwodGhpcyk7XG5cdCAgICB9XG5cdFxuXHQgICAgRXh0cmVtYUJ5T2JzZXJ2ZXIucHJvdG90eXBlLm5leHQgPSBmdW5jdGlvbiAoeCkge1xuXHQgICAgICB2YXIga2V5ID0gdHJ5Q2F0Y2godGhpcy5faykoeCk7XG5cdCAgICAgIGlmIChrZXkgPT09IGVycm9yT2JqKSB7IHJldHVybiB0aGlzLl9vLm9uRXJyb3Ioa2V5LmUpOyB9XG5cdCAgICAgIHZhciBjb21wYXJpc29uID0gMDtcblx0ICAgICAgaWYgKCF0aGlzLl9odikge1xuXHQgICAgICAgIHRoaXMuX2h2ID0gdHJ1ZTtcblx0ICAgICAgICB0aGlzLl92ID0ga2V5O1xuXHQgICAgICB9IGVsc2Uge1xuXHQgICAgICAgIGNvbXBhcmlzb24gPSB0cnlDYXRjaCh0aGlzLl9jKShrZXksIHRoaXMuX3YpO1xuXHQgICAgICAgIGlmIChjb21wYXJpc29uID09PSBlcnJvck9iaikgeyByZXR1cm4gdGhpcy5fby5vbkVycm9yKGNvbXBhcmlzb24uZSk7IH1cblx0ICAgICAgfVxuXHQgICAgICBpZiAoY29tcGFyaXNvbiA+IDApIHtcblx0ICAgICAgICB0aGlzLl92ID0ga2V5O1xuXHQgICAgICAgIHRoaXMuX2wgPSBbXTtcblx0ICAgICAgfVxuXHQgICAgICBpZiAoY29tcGFyaXNvbiA+PSAwKSB7IHRoaXMuX2wucHVzaCh4KTsgfVxuXHQgICAgfTtcblx0XG5cdCAgICBFeHRyZW1hQnlPYnNlcnZlci5wcm90b3R5cGUuZXJyb3IgPSBmdW5jdGlvbiAoZSkge1xuXHQgICAgICB0aGlzLl9vLm9uRXJyb3IoZSk7XG5cdCAgICB9O1xuXHRcblx0ICAgIEV4dHJlbWFCeU9ic2VydmVyLnByb3RvdHlwZS5jb21wbGV0ZWQgPSBmdW5jdGlvbiAoKSB7XG5cdCAgICAgIHRoaXMuX28ub25OZXh0KHRoaXMuX2wpO1xuXHQgICAgICB0aGlzLl9vLm9uQ29tcGxldGVkKCk7XG5cdCAgICB9O1xuXHRcblx0ICAgIHJldHVybiBFeHRyZW1hQnlPYnNlcnZlcjtcblx0ICB9KEFic3RyYWN0T2JzZXJ2ZXIpKTtcblx0XG5cdCAgZnVuY3Rpb24gZmlyc3RPbmx5KHgpIHtcblx0ICAgIGlmICh4Lmxlbmd0aCA9PT0gMCkgeyB0aHJvdyBuZXcgRW1wdHlFcnJvcigpOyB9XG5cdCAgICByZXR1cm4geFswXTtcblx0ICB9XG5cdFxuXHQgIHZhciBSZWR1Y2VPYnNlcnZhYmxlID0gKGZ1bmN0aW9uKF9fc3VwZXJfXykge1xuXHQgICAgaW5oZXJpdHMoUmVkdWNlT2JzZXJ2YWJsZSwgX19zdXBlcl9fKTtcblx0ICAgIGZ1bmN0aW9uIFJlZHVjZU9ic2VydmFibGUoc291cmNlLCBhY2N1bXVsYXRvciwgaGFzU2VlZCwgc2VlZCkge1xuXHQgICAgICB0aGlzLnNvdXJjZSA9IHNvdXJjZTtcblx0ICAgICAgdGhpcy5hY2N1bXVsYXRvciA9IGFjY3VtdWxhdG9yO1xuXHQgICAgICB0aGlzLmhhc1NlZWQgPSBoYXNTZWVkO1xuXHQgICAgICB0aGlzLnNlZWQgPSBzZWVkO1xuXHQgICAgICBfX3N1cGVyX18uY2FsbCh0aGlzKTtcblx0ICAgIH1cblx0XG5cdCAgICBSZWR1Y2VPYnNlcnZhYmxlLnByb3RvdHlwZS5zdWJzY3JpYmVDb3JlID0gZnVuY3Rpb24ob2JzZXJ2ZXIpIHtcblx0ICAgICAgcmV0dXJuIHRoaXMuc291cmNlLnN1YnNjcmliZShuZXcgUmVkdWNlT2JzZXJ2ZXIob2JzZXJ2ZXIsdGhpcykpO1xuXHQgICAgfTtcblx0XG5cdCAgICByZXR1cm4gUmVkdWNlT2JzZXJ2YWJsZTtcblx0ICB9KE9ic2VydmFibGVCYXNlKSk7XG5cdFxuXHQgIHZhciBSZWR1Y2VPYnNlcnZlciA9IChmdW5jdGlvbiAoX19zdXBlcl9fKSB7XG5cdCAgICBpbmhlcml0cyhSZWR1Y2VPYnNlcnZlciwgX19zdXBlcl9fKTtcblx0ICAgIGZ1bmN0aW9uIFJlZHVjZU9ic2VydmVyKG8sIHBhcmVudCkge1xuXHQgICAgICB0aGlzLl9vID0gbztcblx0ICAgICAgdGhpcy5fcCA9IHBhcmVudDtcblx0ICAgICAgdGhpcy5fZm4gPSBwYXJlbnQuYWNjdW11bGF0b3I7XG5cdCAgICAgIHRoaXMuX2hzID0gcGFyZW50Lmhhc1NlZWQ7XG5cdCAgICAgIHRoaXMuX3MgPSBwYXJlbnQuc2VlZDtcblx0ICAgICAgdGhpcy5faGEgPSBmYWxzZTtcblx0ICAgICAgdGhpcy5fYSA9IG51bGw7XG5cdCAgICAgIHRoaXMuX2h2ID0gZmFsc2U7XG5cdCAgICAgIHRoaXMuX2kgPSAwO1xuXHQgICAgICBfX3N1cGVyX18uY2FsbCh0aGlzKTtcblx0ICAgIH1cblx0XG5cdCAgICBSZWR1Y2VPYnNlcnZlci5wcm90b3R5cGUubmV4dCA9IGZ1bmN0aW9uICh4KSB7XG5cdCAgICAgICF0aGlzLl9odiAmJiAodGhpcy5faHYgPSB0cnVlKTtcblx0ICAgICAgaWYgKHRoaXMuX2hhKSB7XG5cdCAgICAgICAgdGhpcy5fYSA9IHRyeUNhdGNoKHRoaXMuX2ZuKSh0aGlzLl9hLCB4LCB0aGlzLl9pLCB0aGlzLl9wKTtcblx0ICAgICAgfSBlbHNlIHtcblx0ICAgICAgICB0aGlzLl9hID0gdGhpcy5faHMgPyB0cnlDYXRjaCh0aGlzLl9mbikodGhpcy5fcywgeCwgdGhpcy5faSwgdGhpcy5fcCkgOiB4O1xuXHQgICAgICAgIHRoaXMuX2hhID0gdHJ1ZTtcblx0ICAgICAgfVxuXHQgICAgICBpZiAodGhpcy5fYSA9PT0gZXJyb3JPYmopIHsgcmV0dXJuIHRoaXMuX28ub25FcnJvcih0aGlzLl9hLmUpOyB9XG5cdCAgICAgIHRoaXMuX2krKztcblx0ICAgIH07XG5cdFxuXHQgICAgUmVkdWNlT2JzZXJ2ZXIucHJvdG90eXBlLmVycm9yID0gZnVuY3Rpb24gKGUpIHtcblx0ICAgICAgdGhpcy5fby5vbkVycm9yKGUpO1xuXHQgICAgfTtcblx0XG5cdCAgICBSZWR1Y2VPYnNlcnZlci5wcm90b3R5cGUuY29tcGxldGVkID0gZnVuY3Rpb24gKCkge1xuXHQgICAgICB0aGlzLl9odiAmJiB0aGlzLl9vLm9uTmV4dCh0aGlzLl9hKTtcblx0ICAgICAgIXRoaXMuX2h2ICYmIHRoaXMuX2hzICYmIHRoaXMuX28ub25OZXh0KHRoaXMuX3MpO1xuXHQgICAgICAhdGhpcy5faHYgJiYgIXRoaXMuX2hzICYmIHRoaXMuX28ub25FcnJvcihuZXcgRW1wdHlFcnJvcigpKTtcblx0ICAgICAgdGhpcy5fby5vbkNvbXBsZXRlZCgpO1xuXHQgICAgfTtcblx0XG5cdCAgICByZXR1cm4gUmVkdWNlT2JzZXJ2ZXI7XG5cdCAgfShBYnN0cmFjdE9ic2VydmVyKSk7XG5cdFxuXHQgIC8qKlxuXHQgICogQXBwbGllcyBhbiBhY2N1bXVsYXRvciBmdW5jdGlvbiBvdmVyIGFuIG9ic2VydmFibGUgc2VxdWVuY2UsIHJldHVybmluZyB0aGUgcmVzdWx0IG9mIHRoZSBhZ2dyZWdhdGlvbiBhcyBhIHNpbmdsZSBlbGVtZW50IGluIHRoZSByZXN1bHQgc2VxdWVuY2UuIFRoZSBzcGVjaWZpZWQgc2VlZCB2YWx1ZSBpcyB1c2VkIGFzIHRoZSBpbml0aWFsIGFjY3VtdWxhdG9yIHZhbHVlLlxuXHQgICogRm9yIGFnZ3JlZ2F0aW9uIGJlaGF2aW9yIHdpdGggaW5jcmVtZW50YWwgaW50ZXJtZWRpYXRlIHJlc3VsdHMsIHNlZSBPYnNlcnZhYmxlLnNjYW4uXG5cdCAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBhY2N1bXVsYXRvciBBbiBhY2N1bXVsYXRvciBmdW5jdGlvbiB0byBiZSBpbnZva2VkIG9uIGVhY2ggZWxlbWVudC5cblx0ICAqIEBwYXJhbSB7QW55fSBbc2VlZF0gVGhlIGluaXRpYWwgYWNjdW11bGF0b3IgdmFsdWUuXG5cdCAgKiBAcmV0dXJucyB7T2JzZXJ2YWJsZX0gQW4gb2JzZXJ2YWJsZSBzZXF1ZW5jZSBjb250YWluaW5nIGEgc2luZ2xlIGVsZW1lbnQgd2l0aCB0aGUgZmluYWwgYWNjdW11bGF0b3IgdmFsdWUuXG5cdCAgKi9cblx0ICBvYnNlcnZhYmxlUHJvdG8ucmVkdWNlID0gZnVuY3Rpb24gKCkge1xuXHQgICAgdmFyIGhhc1NlZWQgPSBmYWxzZSwgc2VlZCwgYWNjdW11bGF0b3IgPSBhcmd1bWVudHNbMF07XG5cdCAgICBpZiAoYXJndW1lbnRzLmxlbmd0aCA9PT0gMikge1xuXHQgICAgICBoYXNTZWVkID0gdHJ1ZTtcblx0ICAgICAgc2VlZCA9IGFyZ3VtZW50c1sxXTtcblx0ICAgIH1cblx0ICAgIHJldHVybiBuZXcgUmVkdWNlT2JzZXJ2YWJsZSh0aGlzLCBhY2N1bXVsYXRvciwgaGFzU2VlZCwgc2VlZCk7XG5cdCAgfTtcblx0XG5cdCAgdmFyIFNvbWVPYnNlcnZhYmxlID0gKGZ1bmN0aW9uIChfX3N1cGVyX18pIHtcblx0ICAgIGluaGVyaXRzKFNvbWVPYnNlcnZhYmxlLCBfX3N1cGVyX18pO1xuXHQgICAgZnVuY3Rpb24gU29tZU9ic2VydmFibGUoc291cmNlLCBmbikge1xuXHQgICAgICB0aGlzLnNvdXJjZSA9IHNvdXJjZTtcblx0ICAgICAgdGhpcy5fZm4gPSBmbjtcblx0ICAgICAgX19zdXBlcl9fLmNhbGwodGhpcyk7XG5cdCAgICB9XG5cdFxuXHQgICAgU29tZU9ic2VydmFibGUucHJvdG90eXBlLnN1YnNjcmliZUNvcmUgPSBmdW5jdGlvbiAobykge1xuXHQgICAgICByZXR1cm4gdGhpcy5zb3VyY2Uuc3Vic2NyaWJlKG5ldyBTb21lT2JzZXJ2ZXIobywgdGhpcy5fZm4sIHRoaXMuc291cmNlKSk7XG5cdCAgICB9O1xuXHRcblx0ICAgIHJldHVybiBTb21lT2JzZXJ2YWJsZTtcblx0ICB9KE9ic2VydmFibGVCYXNlKSk7XG5cdFxuXHQgIHZhciBTb21lT2JzZXJ2ZXIgPSAoZnVuY3Rpb24gKF9fc3VwZXJfXykge1xuXHQgICAgaW5oZXJpdHMoU29tZU9ic2VydmVyLCBfX3N1cGVyX18pO1xuXHRcblx0ICAgIGZ1bmN0aW9uIFNvbWVPYnNlcnZlcihvLCBmbiwgcykge1xuXHQgICAgICB0aGlzLl9vID0gbztcblx0ICAgICAgdGhpcy5fZm4gPSBmbjtcblx0ICAgICAgdGhpcy5fcyA9IHM7XG5cdCAgICAgIHRoaXMuX2kgPSAwO1xuXHQgICAgICBfX3N1cGVyX18uY2FsbCh0aGlzKTtcblx0ICAgIH1cblx0XG5cdCAgICBTb21lT2JzZXJ2ZXIucHJvdG90eXBlLm5leHQgPSBmdW5jdGlvbiAoeCkge1xuXHQgICAgICB2YXIgcmVzdWx0ID0gdHJ5Q2F0Y2godGhpcy5fZm4pKHgsIHRoaXMuX2krKywgdGhpcy5fcyk7XG5cdCAgICAgIGlmIChyZXN1bHQgPT09IGVycm9yT2JqKSB7IHJldHVybiB0aGlzLl9vLm9uRXJyb3IocmVzdWx0LmUpOyB9XG5cdCAgICAgIGlmIChCb29sZWFuKHJlc3VsdCkpIHtcblx0ICAgICAgICB0aGlzLl9vLm9uTmV4dCh0cnVlKTtcblx0ICAgICAgICB0aGlzLl9vLm9uQ29tcGxldGVkKCk7XG5cdCAgICAgIH1cblx0ICAgIH07XG5cdCAgICBTb21lT2JzZXJ2ZXIucHJvdG90eXBlLmVycm9yID0gZnVuY3Rpb24gKGUpIHsgdGhpcy5fby5vbkVycm9yKGUpOyB9O1xuXHQgICAgU29tZU9ic2VydmVyLnByb3RvdHlwZS5jb21wbGV0ZWQgPSBmdW5jdGlvbiAoKSB7XG5cdCAgICAgIHRoaXMuX28ub25OZXh0KGZhbHNlKTtcblx0ICAgICAgdGhpcy5fby5vbkNvbXBsZXRlZCgpO1xuXHQgICAgfTtcblx0XG5cdCAgICByZXR1cm4gU29tZU9ic2VydmVyO1xuXHQgIH0oQWJzdHJhY3RPYnNlcnZlcikpO1xuXHRcblx0ICAvKipcblx0ICAgKiBEZXRlcm1pbmVzIHdoZXRoZXIgYW55IGVsZW1lbnQgb2YgYW4gb2JzZXJ2YWJsZSBzZXF1ZW5jZSBzYXRpc2ZpZXMgYSBjb25kaXRpb24gaWYgcHJlc2VudCwgZWxzZSBpZiBhbnkgaXRlbXMgYXJlIGluIHRoZSBzZXF1ZW5jZS5cblx0ICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBbcHJlZGljYXRlXSBBIGZ1bmN0aW9uIHRvIHRlc3QgZWFjaCBlbGVtZW50IGZvciBhIGNvbmRpdGlvbi5cblx0ICAgKiBAcmV0dXJucyB7T2JzZXJ2YWJsZX0gQW4gb2JzZXJ2YWJsZSBzZXF1ZW5jZSBjb250YWluaW5nIGEgc2luZ2xlIGVsZW1lbnQgZGV0ZXJtaW5pbmcgd2hldGhlciBhbnkgZWxlbWVudHMgaW4gdGhlIHNvdXJjZSBzZXF1ZW5jZSBwYXNzIHRoZSB0ZXN0IGluIHRoZSBzcGVjaWZpZWQgcHJlZGljYXRlIGlmIGdpdmVuLCBlbHNlIGlmIGFueSBpdGVtcyBhcmUgaW4gdGhlIHNlcXVlbmNlLlxuXHQgICAqL1xuXHQgIG9ic2VydmFibGVQcm90by5zb21lID0gZnVuY3Rpb24gKHByZWRpY2F0ZSwgdGhpc0FyZykge1xuXHQgICAgdmFyIGZuID0gYmluZENhbGxiYWNrKHByZWRpY2F0ZSwgdGhpc0FyZywgMyk7XG5cdCAgICByZXR1cm4gbmV3IFNvbWVPYnNlcnZhYmxlKHRoaXMsIGZuKTtcblx0ICB9O1xuXHRcblx0ICB2YXIgSXNFbXB0eU9ic2VydmFibGUgPSAoZnVuY3Rpb24gKF9fc3VwZXJfXykge1xuXHQgICAgaW5oZXJpdHMoSXNFbXB0eU9ic2VydmFibGUsIF9fc3VwZXJfXyk7XG5cdCAgICBmdW5jdGlvbiBJc0VtcHR5T2JzZXJ2YWJsZShzb3VyY2UpIHtcblx0ICAgICAgdGhpcy5zb3VyY2UgPSBzb3VyY2U7XG5cdCAgICAgIF9fc3VwZXJfXy5jYWxsKHRoaXMpO1xuXHQgICAgfVxuXHRcblx0ICAgIElzRW1wdHlPYnNlcnZhYmxlLnByb3RvdHlwZS5zdWJzY3JpYmVDb3JlID0gZnVuY3Rpb24gKG8pIHtcblx0ICAgICAgcmV0dXJuIHRoaXMuc291cmNlLnN1YnNjcmliZShuZXcgSXNFbXB0eU9ic2VydmVyKG8pKTtcblx0ICAgIH07XG5cdFxuXHQgICAgcmV0dXJuIElzRW1wdHlPYnNlcnZhYmxlO1xuXHQgIH0oT2JzZXJ2YWJsZUJhc2UpKTtcblx0XG5cdCAgdmFyIElzRW1wdHlPYnNlcnZlciA9IChmdW5jdGlvbihfX3N1cGVyX18pIHtcblx0ICAgIGluaGVyaXRzKElzRW1wdHlPYnNlcnZlciwgX19zdXBlcl9fKTtcblx0ICAgIGZ1bmN0aW9uIElzRW1wdHlPYnNlcnZlcihvKSB7XG5cdCAgICAgIHRoaXMuX28gPSBvO1xuXHQgICAgICBfX3N1cGVyX18uY2FsbCh0aGlzKTtcblx0ICAgIH1cblx0XG5cdCAgICBJc0VtcHR5T2JzZXJ2ZXIucHJvdG90eXBlLm5leHQgPSBmdW5jdGlvbiAoKSB7XG5cdCAgICAgIHRoaXMuX28ub25OZXh0KGZhbHNlKTtcblx0ICAgICAgdGhpcy5fby5vbkNvbXBsZXRlZCgpO1xuXHQgICAgfTtcblx0ICAgIElzRW1wdHlPYnNlcnZlci5wcm90b3R5cGUuZXJyb3IgPSBmdW5jdGlvbiAoZSkgeyB0aGlzLl9vLm9uRXJyb3IoZSk7IH07XG5cdCAgICBJc0VtcHR5T2JzZXJ2ZXIucHJvdG90eXBlLmNvbXBsZXRlZCA9IGZ1bmN0aW9uICgpIHtcblx0ICAgICAgdGhpcy5fby5vbk5leHQodHJ1ZSk7XG5cdCAgICAgIHRoaXMuX28ub25Db21wbGV0ZWQoKTtcblx0ICAgIH07XG5cdFxuXHQgICAgcmV0dXJuIElzRW1wdHlPYnNlcnZlcjtcblx0ICB9KEFic3RyYWN0T2JzZXJ2ZXIpKTtcblx0XG5cdCAgLyoqXG5cdCAgICogRGV0ZXJtaW5lcyB3aGV0aGVyIGFuIG9ic2VydmFibGUgc2VxdWVuY2UgaXMgZW1wdHkuXG5cdCAgICogQHJldHVybnMge09ic2VydmFibGV9IEFuIG9ic2VydmFibGUgc2VxdWVuY2UgY29udGFpbmluZyBhIHNpbmdsZSBlbGVtZW50IGRldGVybWluaW5nIHdoZXRoZXIgdGhlIHNvdXJjZSBzZXF1ZW5jZSBpcyBlbXB0eS5cblx0ICAgKi9cblx0ICBvYnNlcnZhYmxlUHJvdG8uaXNFbXB0eSA9IGZ1bmN0aW9uICgpIHtcblx0ICAgIHJldHVybiBuZXcgSXNFbXB0eU9ic2VydmFibGUodGhpcyk7XG5cdCAgfTtcblx0XG5cdCAgdmFyIEV2ZXJ5T2JzZXJ2YWJsZSA9IChmdW5jdGlvbiAoX19zdXBlcl9fKSB7XG5cdCAgICBpbmhlcml0cyhFdmVyeU9ic2VydmFibGUsIF9fc3VwZXJfXyk7XG5cdCAgICBmdW5jdGlvbiBFdmVyeU9ic2VydmFibGUoc291cmNlLCBmbikge1xuXHQgICAgICB0aGlzLnNvdXJjZSA9IHNvdXJjZTtcblx0ICAgICAgdGhpcy5fZm4gPSBmbjtcblx0ICAgICAgX19zdXBlcl9fLmNhbGwodGhpcyk7XG5cdCAgICB9XG5cdFxuXHQgICAgRXZlcnlPYnNlcnZhYmxlLnByb3RvdHlwZS5zdWJzY3JpYmVDb3JlID0gZnVuY3Rpb24gKG8pIHtcblx0ICAgICAgcmV0dXJuIHRoaXMuc291cmNlLnN1YnNjcmliZShuZXcgRXZlcnlPYnNlcnZlcihvLCB0aGlzLl9mbiwgdGhpcy5zb3VyY2UpKTtcblx0ICAgIH07XG5cdFxuXHQgICAgcmV0dXJuIEV2ZXJ5T2JzZXJ2YWJsZTtcblx0ICB9KE9ic2VydmFibGVCYXNlKSk7XG5cdFxuXHQgIHZhciBFdmVyeU9ic2VydmVyID0gKGZ1bmN0aW9uIChfX3N1cGVyX18pIHtcblx0ICAgIGluaGVyaXRzKEV2ZXJ5T2JzZXJ2ZXIsIF9fc3VwZXJfXyk7XG5cdFxuXHQgICAgZnVuY3Rpb24gRXZlcnlPYnNlcnZlcihvLCBmbiwgcykge1xuXHQgICAgICB0aGlzLl9vID0gbztcblx0ICAgICAgdGhpcy5fZm4gPSBmbjtcblx0ICAgICAgdGhpcy5fcyA9IHM7XG5cdCAgICAgIHRoaXMuX2kgPSAwO1xuXHQgICAgICBfX3N1cGVyX18uY2FsbCh0aGlzKTtcblx0ICAgIH1cblx0XG5cdCAgICBFdmVyeU9ic2VydmVyLnByb3RvdHlwZS5uZXh0ID0gZnVuY3Rpb24gKHgpIHtcblx0ICAgICAgdmFyIHJlc3VsdCA9IHRyeUNhdGNoKHRoaXMuX2ZuKSh4LCB0aGlzLl9pKyssIHRoaXMuX3MpO1xuXHQgICAgICBpZiAocmVzdWx0ID09PSBlcnJvck9iaikgeyByZXR1cm4gdGhpcy5fby5vbkVycm9yKHJlc3VsdC5lKTsgfVxuXHQgICAgICBpZiAoIUJvb2xlYW4ocmVzdWx0KSkge1xuXHQgICAgICAgIHRoaXMuX28ub25OZXh0KGZhbHNlKTtcblx0ICAgICAgICB0aGlzLl9vLm9uQ29tcGxldGVkKCk7XG5cdCAgICAgIH1cblx0ICAgIH07XG5cdCAgICBFdmVyeU9ic2VydmVyLnByb3RvdHlwZS5lcnJvciA9IGZ1bmN0aW9uIChlKSB7IHRoaXMuX28ub25FcnJvcihlKTsgfTtcblx0ICAgIEV2ZXJ5T2JzZXJ2ZXIucHJvdG90eXBlLmNvbXBsZXRlZCA9IGZ1bmN0aW9uICgpIHtcblx0ICAgICAgdGhpcy5fby5vbk5leHQodHJ1ZSk7XG5cdCAgICAgIHRoaXMuX28ub25Db21wbGV0ZWQoKTtcblx0ICAgIH07XG5cdFxuXHQgICAgcmV0dXJuIEV2ZXJ5T2JzZXJ2ZXI7XG5cdCAgfShBYnN0cmFjdE9ic2VydmVyKSk7XG5cdFxuXHQgIC8qKlxuXHQgICAqIERldGVybWluZXMgd2hldGhlciBhbGwgZWxlbWVudHMgb2YgYW4gb2JzZXJ2YWJsZSBzZXF1ZW5jZSBzYXRpc2Z5IGEgY29uZGl0aW9uLlxuXHQgICAqIEBwYXJhbSB7RnVuY3Rpb259IFtwcmVkaWNhdGVdIEEgZnVuY3Rpb24gdG8gdGVzdCBlYWNoIGVsZW1lbnQgZm9yIGEgY29uZGl0aW9uLlxuXHQgICAqIEBwYXJhbSB7QW55fSBbdGhpc0FyZ10gT2JqZWN0IHRvIHVzZSBhcyB0aGlzIHdoZW4gZXhlY3V0aW5nIGNhbGxiYWNrLlxuXHQgICAqIEByZXR1cm5zIHtPYnNlcnZhYmxlfSBBbiBvYnNlcnZhYmxlIHNlcXVlbmNlIGNvbnRhaW5pbmcgYSBzaW5nbGUgZWxlbWVudCBkZXRlcm1pbmluZyB3aGV0aGVyIGFsbCBlbGVtZW50cyBpbiB0aGUgc291cmNlIHNlcXVlbmNlIHBhc3MgdGhlIHRlc3QgaW4gdGhlIHNwZWNpZmllZCBwcmVkaWNhdGUuXG5cdCAgICovXG5cdCAgb2JzZXJ2YWJsZVByb3RvLmV2ZXJ5ID0gZnVuY3Rpb24gKHByZWRpY2F0ZSwgdGhpc0FyZykge1xuXHQgICAgdmFyIGZuID0gYmluZENhbGxiYWNrKHByZWRpY2F0ZSwgdGhpc0FyZywgMyk7XG5cdCAgICByZXR1cm4gbmV3IEV2ZXJ5T2JzZXJ2YWJsZSh0aGlzLCBmbik7XG5cdCAgfTtcblx0XG5cdCAgdmFyIEluY2x1ZGVzT2JzZXJ2YWJsZSA9IChmdW5jdGlvbiAoX19zdXBlcl9fKSB7XG5cdCAgICBpbmhlcml0cyhJbmNsdWRlc09ic2VydmFibGUsIF9fc3VwZXJfXyk7XG5cdCAgICBmdW5jdGlvbiBJbmNsdWRlc09ic2VydmFibGUoc291cmNlLCBlbGVtLCBpZHgpIHtcblx0ICAgICAgdmFyIG4gPSAraWR4IHx8IDA7XG5cdCAgICAgIE1hdGguYWJzKG4pID09PSBJbmZpbml0eSAmJiAobiA9IDApO1xuXHRcblx0ICAgICAgdGhpcy5zb3VyY2UgPSBzb3VyY2U7XG5cdCAgICAgIHRoaXMuX2VsZW0gPSBlbGVtO1xuXHQgICAgICB0aGlzLl9uID0gbjtcblx0ICAgICAgX19zdXBlcl9fLmNhbGwodGhpcyk7XG5cdCAgICB9XG5cdFxuXHQgICAgSW5jbHVkZXNPYnNlcnZhYmxlLnByb3RvdHlwZS5zdWJzY3JpYmVDb3JlID0gZnVuY3Rpb24gKG8pIHtcblx0ICAgICAgaWYgKHRoaXMuX24gPCAwKSB7XG5cdCAgICAgICAgby5vbk5leHQoZmFsc2UpO1xuXHQgICAgICAgIG8ub25Db21wbGV0ZWQoKTtcblx0ICAgICAgICByZXR1cm4gZGlzcG9zYWJsZUVtcHR5O1xuXHQgICAgICB9XG5cdFxuXHQgICAgICByZXR1cm4gdGhpcy5zb3VyY2Uuc3Vic2NyaWJlKG5ldyBJbmNsdWRlc09ic2VydmVyKG8sIHRoaXMuX2VsZW0sIHRoaXMuX24pKTtcblx0ICAgIH07XG5cdFxuXHQgICAgcmV0dXJuIEluY2x1ZGVzT2JzZXJ2YWJsZTtcblx0ICB9KE9ic2VydmFibGVCYXNlKSk7XG5cdFxuXHQgIHZhciBJbmNsdWRlc09ic2VydmVyID0gKGZ1bmN0aW9uIChfX3N1cGVyX18pIHtcblx0ICAgIGluaGVyaXRzKEluY2x1ZGVzT2JzZXJ2ZXIsIF9fc3VwZXJfXyk7XG5cdCAgICBmdW5jdGlvbiBJbmNsdWRlc09ic2VydmVyKG8sIGVsZW0sIG4pIHtcblx0ICAgICAgdGhpcy5fbyA9IG87XG5cdCAgICAgIHRoaXMuX2VsZW0gPSBlbGVtO1xuXHQgICAgICB0aGlzLl9uID0gbjtcblx0ICAgICAgdGhpcy5faSA9IDA7XG5cdCAgICAgIF9fc3VwZXJfXy5jYWxsKHRoaXMpO1xuXHQgICAgfVxuXHRcblx0ICAgIGZ1bmN0aW9uIGNvbXBhcmVyKGEsIGIpIHtcblx0ICAgICAgcmV0dXJuIChhID09PSAwICYmIGIgPT09IDApIHx8IChhID09PSBiIHx8IChpc05hTihhKSAmJiBpc05hTihiKSkpO1xuXHQgICAgfVxuXHRcblx0ICAgIEluY2x1ZGVzT2JzZXJ2ZXIucHJvdG90eXBlLm5leHQgPSBmdW5jdGlvbiAoeCkge1xuXHQgICAgICBpZiAodGhpcy5faSsrID49IHRoaXMuX24gJiYgY29tcGFyZXIoeCwgdGhpcy5fZWxlbSkpIHtcblx0ICAgICAgICB0aGlzLl9vLm9uTmV4dCh0cnVlKTtcblx0ICAgICAgICB0aGlzLl9vLm9uQ29tcGxldGVkKCk7XG5cdCAgICAgIH1cblx0ICAgIH07XG5cdCAgICBJbmNsdWRlc09ic2VydmVyLnByb3RvdHlwZS5lcnJvciA9IGZ1bmN0aW9uIChlKSB7IHRoaXMuX28ub25FcnJvcihlKTsgfTtcblx0ICAgIEluY2x1ZGVzT2JzZXJ2ZXIucHJvdG90eXBlLmNvbXBsZXRlZCA9IGZ1bmN0aW9uICgpIHsgdGhpcy5fby5vbk5leHQoZmFsc2UpOyB0aGlzLl9vLm9uQ29tcGxldGVkKCk7IH07XG5cdFxuXHQgICAgcmV0dXJuIEluY2x1ZGVzT2JzZXJ2ZXI7XG5cdCAgfShBYnN0cmFjdE9ic2VydmVyKSk7XG5cdFxuXHQgIC8qKlxuXHQgICAqIERldGVybWluZXMgd2hldGhlciBhbiBvYnNlcnZhYmxlIHNlcXVlbmNlIGluY2x1ZGVzIGEgc3BlY2lmaWVkIGVsZW1lbnQgd2l0aCBhbiBvcHRpb25hbCBlcXVhbGl0eSBjb21wYXJlci5cblx0ICAgKiBAcGFyYW0gc2VhcmNoRWxlbWVudCBUaGUgdmFsdWUgdG8gbG9jYXRlIGluIHRoZSBzb3VyY2Ugc2VxdWVuY2UuXG5cdCAgICogQHBhcmFtIHtOdW1iZXJ9IFtmcm9tSW5kZXhdIEFuIGVxdWFsaXR5IGNvbXBhcmVyIHRvIGNvbXBhcmUgZWxlbWVudHMuXG5cdCAgICogQHJldHVybnMge09ic2VydmFibGV9IEFuIG9ic2VydmFibGUgc2VxdWVuY2UgY29udGFpbmluZyBhIHNpbmdsZSBlbGVtZW50IGRldGVybWluaW5nIHdoZXRoZXIgdGhlIHNvdXJjZSBzZXF1ZW5jZSBpbmNsdWRlcyBhbiBlbGVtZW50IHRoYXQgaGFzIHRoZSBzcGVjaWZpZWQgdmFsdWUgZnJvbSB0aGUgZ2l2ZW4gaW5kZXguXG5cdCAgICovXG5cdCAgb2JzZXJ2YWJsZVByb3RvLmluY2x1ZGVzID0gZnVuY3Rpb24gKHNlYXJjaEVsZW1lbnQsIGZyb21JbmRleCkge1xuXHQgICAgcmV0dXJuIG5ldyBJbmNsdWRlc09ic2VydmFibGUodGhpcywgc2VhcmNoRWxlbWVudCwgZnJvbUluZGV4KTtcblx0ICB9O1xuXHRcblx0ICB2YXIgQ291bnRPYnNlcnZhYmxlID0gKGZ1bmN0aW9uIChfX3N1cGVyX18pIHtcblx0ICAgIGluaGVyaXRzKENvdW50T2JzZXJ2YWJsZSwgX19zdXBlcl9fKTtcblx0ICAgIGZ1bmN0aW9uIENvdW50T2JzZXJ2YWJsZShzb3VyY2UsIGZuKSB7XG5cdCAgICAgIHRoaXMuc291cmNlID0gc291cmNlO1xuXHQgICAgICB0aGlzLl9mbiA9IGZuO1xuXHQgICAgICBfX3N1cGVyX18uY2FsbCh0aGlzKTtcblx0ICAgIH1cblx0XG5cdCAgICBDb3VudE9ic2VydmFibGUucHJvdG90eXBlLnN1YnNjcmliZUNvcmUgPSBmdW5jdGlvbiAobykge1xuXHQgICAgICByZXR1cm4gdGhpcy5zb3VyY2Uuc3Vic2NyaWJlKG5ldyBDb3VudE9ic2VydmVyKG8sIHRoaXMuX2ZuLCB0aGlzLnNvdXJjZSkpO1xuXHQgICAgfTtcblx0XG5cdCAgICByZXR1cm4gQ291bnRPYnNlcnZhYmxlO1xuXHQgIH0oT2JzZXJ2YWJsZUJhc2UpKTtcblx0XG5cdCAgdmFyIENvdW50T2JzZXJ2ZXIgPSAoZnVuY3Rpb24gKF9fc3VwZXJfXykge1xuXHQgICAgaW5oZXJpdHMoQ291bnRPYnNlcnZlciwgX19zdXBlcl9fKTtcblx0XG5cdCAgICBmdW5jdGlvbiBDb3VudE9ic2VydmVyKG8sIGZuLCBzKSB7XG5cdCAgICAgIHRoaXMuX28gPSBvO1xuXHQgICAgICB0aGlzLl9mbiA9IGZuO1xuXHQgICAgICB0aGlzLl9zID0gcztcblx0ICAgICAgdGhpcy5faSA9IDA7XG5cdCAgICAgIHRoaXMuX2MgPSAwO1xuXHQgICAgICBfX3N1cGVyX18uY2FsbCh0aGlzKTtcblx0ICAgIH1cblx0XG5cdCAgICBDb3VudE9ic2VydmVyLnByb3RvdHlwZS5uZXh0ID0gZnVuY3Rpb24gKHgpIHtcblx0ICAgICAgaWYgKHRoaXMuX2ZuKSB7XG5cdCAgICAgICAgdmFyIHJlc3VsdCA9IHRyeUNhdGNoKHRoaXMuX2ZuKSh4LCB0aGlzLl9pKyssIHRoaXMuX3MpO1xuXHQgICAgICAgIGlmIChyZXN1bHQgPT09IGVycm9yT2JqKSB7IHJldHVybiB0aGlzLl9vLm9uRXJyb3IocmVzdWx0LmUpOyB9XG5cdCAgICAgICAgQm9vbGVhbihyZXN1bHQpICYmICh0aGlzLl9jKyspO1xuXHQgICAgICB9IGVsc2Uge1xuXHQgICAgICAgIHRoaXMuX2MrKztcblx0ICAgICAgfVxuXHQgICAgfTtcblx0ICAgIENvdW50T2JzZXJ2ZXIucHJvdG90eXBlLmVycm9yID0gZnVuY3Rpb24gKGUpIHsgdGhpcy5fby5vbkVycm9yKGUpOyB9O1xuXHQgICAgQ291bnRPYnNlcnZlci5wcm90b3R5cGUuY29tcGxldGVkID0gZnVuY3Rpb24gKCkge1xuXHQgICAgICB0aGlzLl9vLm9uTmV4dCh0aGlzLl9jKTtcblx0ICAgICAgdGhpcy5fby5vbkNvbXBsZXRlZCgpO1xuXHQgICAgfTtcblx0XG5cdCAgICByZXR1cm4gQ291bnRPYnNlcnZlcjtcblx0ICB9KEFic3RyYWN0T2JzZXJ2ZXIpKTtcblx0XG5cdCAgLyoqXG5cdCAgICogUmV0dXJucyBhbiBvYnNlcnZhYmxlIHNlcXVlbmNlIGNvbnRhaW5pbmcgYSB2YWx1ZSB0aGF0IHJlcHJlc2VudHMgaG93IG1hbnkgZWxlbWVudHMgaW4gdGhlIHNwZWNpZmllZCBvYnNlcnZhYmxlIHNlcXVlbmNlIHNhdGlzZnkgYSBjb25kaXRpb24gaWYgcHJvdmlkZWQsIGVsc2UgdGhlIGNvdW50IG9mIGl0ZW1zLlxuXHQgICAqIEBleGFtcGxlXG5cdCAgICogcmVzID0gc291cmNlLmNvdW50KCk7XG5cdCAgICogcmVzID0gc291cmNlLmNvdW50KGZ1bmN0aW9uICh4KSB7IHJldHVybiB4ID4gMzsgfSk7XG5cdCAgICogQHBhcmFtIHtGdW5jdGlvbn0gW3ByZWRpY2F0ZV1BIGZ1bmN0aW9uIHRvIHRlc3QgZWFjaCBlbGVtZW50IGZvciBhIGNvbmRpdGlvbi5cblx0ICAgKiBAcGFyYW0ge0FueX0gW3RoaXNBcmddIE9iamVjdCB0byB1c2UgYXMgdGhpcyB3aGVuIGV4ZWN1dGluZyBjYWxsYmFjay5cblx0ICAgKiBAcmV0dXJucyB7T2JzZXJ2YWJsZX0gQW4gb2JzZXJ2YWJsZSBzZXF1ZW5jZSBjb250YWluaW5nIGEgc2luZ2xlIGVsZW1lbnQgd2l0aCBhIG51bWJlciB0aGF0IHJlcHJlc2VudHMgaG93IG1hbnkgZWxlbWVudHMgaW4gdGhlIGlucHV0IHNlcXVlbmNlIHNhdGlzZnkgdGhlIGNvbmRpdGlvbiBpbiB0aGUgcHJlZGljYXRlIGZ1bmN0aW9uIGlmIHByb3ZpZGVkLCBlbHNlIHRoZSBjb3VudCBvZiBpdGVtcyBpbiB0aGUgc2VxdWVuY2UuXG5cdCAgICovXG5cdCAgb2JzZXJ2YWJsZVByb3RvLmNvdW50ID0gZnVuY3Rpb24gKHByZWRpY2F0ZSwgdGhpc0FyZykge1xuXHQgICAgdmFyIGZuID0gYmluZENhbGxiYWNrKHByZWRpY2F0ZSwgdGhpc0FyZywgMyk7XG5cdCAgICByZXR1cm4gbmV3IENvdW50T2JzZXJ2YWJsZSh0aGlzLCBmbik7XG5cdCAgfTtcblx0XG5cdCAgdmFyIEluZGV4T2ZPYnNlcnZhYmxlID0gKGZ1bmN0aW9uIChfX3N1cGVyX18pIHtcblx0ICAgIGluaGVyaXRzKEluZGV4T2ZPYnNlcnZhYmxlLCBfX3N1cGVyX18pO1xuXHQgICAgZnVuY3Rpb24gSW5kZXhPZk9ic2VydmFibGUoc291cmNlLCBlLCBuKSB7XG5cdCAgICAgIHRoaXMuc291cmNlID0gc291cmNlO1xuXHQgICAgICB0aGlzLl9lID0gZTtcblx0ICAgICAgdGhpcy5fbiA9IG47XG5cdCAgICAgIF9fc3VwZXJfXy5jYWxsKHRoaXMpO1xuXHQgICAgfVxuXHRcblx0ICAgIEluZGV4T2ZPYnNlcnZhYmxlLnByb3RvdHlwZS5zdWJzY3JpYmVDb3JlID0gZnVuY3Rpb24gKG8pIHtcblx0ICAgICAgaWYgKHRoaXMuX24gPCAwKSB7XG5cdCAgICAgICAgby5vbk5leHQoLTEpO1xuXHQgICAgICAgIG8ub25Db21wbGV0ZWQoKTtcblx0ICAgICAgICByZXR1cm4gZGlzcG9zYWJsZUVtcHR5O1xuXHQgICAgICB9XG5cdFxuXHQgICAgICByZXR1cm4gdGhpcy5zb3VyY2Uuc3Vic2NyaWJlKG5ldyBJbmRleE9mT2JzZXJ2ZXIobywgdGhpcy5fZSwgdGhpcy5fbikpO1xuXHQgICAgfTtcblx0XG5cdCAgICByZXR1cm4gSW5kZXhPZk9ic2VydmFibGU7XG5cdCAgfShPYnNlcnZhYmxlQmFzZSkpO1xuXHRcblx0ICB2YXIgSW5kZXhPZk9ic2VydmVyID0gKGZ1bmN0aW9uIChfX3N1cGVyX18pIHtcblx0ICAgIGluaGVyaXRzKEluZGV4T2ZPYnNlcnZlciwgX19zdXBlcl9fKTtcblx0ICAgIGZ1bmN0aW9uIEluZGV4T2ZPYnNlcnZlcihvLCBlLCBuKSB7XG5cdCAgICAgIHRoaXMuX28gPSBvO1xuXHQgICAgICB0aGlzLl9lID0gZTtcblx0ICAgICAgdGhpcy5fbiA9IG47XG5cdCAgICAgIHRoaXMuX2kgPSAwO1xuXHQgICAgICBfX3N1cGVyX18uY2FsbCh0aGlzKTtcblx0ICAgIH1cblx0XG5cdCAgICBJbmRleE9mT2JzZXJ2ZXIucHJvdG90eXBlLm5leHQgPSBmdW5jdGlvbiAoeCkge1xuXHQgICAgICBpZiAodGhpcy5faSA+PSB0aGlzLl9uICYmIHggPT09IHRoaXMuX2UpIHtcblx0ICAgICAgICB0aGlzLl9vLm9uTmV4dCh0aGlzLl9pKTtcblx0ICAgICAgICB0aGlzLl9vLm9uQ29tcGxldGVkKCk7XG5cdCAgICAgIH1cblx0ICAgICAgdGhpcy5faSsrO1xuXHQgICAgfTtcblx0ICAgIEluZGV4T2ZPYnNlcnZlci5wcm90b3R5cGUuZXJyb3IgPSBmdW5jdGlvbiAoZSkgeyB0aGlzLl9vLm9uRXJyb3IoZSk7IH07XG5cdCAgICBJbmRleE9mT2JzZXJ2ZXIucHJvdG90eXBlLmNvbXBsZXRlZCA9IGZ1bmN0aW9uICgpIHsgdGhpcy5fby5vbk5leHQoLTEpOyB0aGlzLl9vLm9uQ29tcGxldGVkKCk7IH07XG5cdFxuXHQgICAgcmV0dXJuIEluZGV4T2ZPYnNlcnZlcjtcblx0ICB9KEFic3RyYWN0T2JzZXJ2ZXIpKTtcblx0XG5cdCAgLyoqXG5cdCAgICogUmV0dXJucyB0aGUgZmlyc3QgaW5kZXggYXQgd2hpY2ggYSBnaXZlbiBlbGVtZW50IGNhbiBiZSBmb3VuZCBpbiB0aGUgb2JzZXJ2YWJsZSBzZXF1ZW5jZSwgb3IgLTEgaWYgaXQgaXMgbm90IHByZXNlbnQuXG5cdCAgICogQHBhcmFtIHtBbnl9IHNlYXJjaEVsZW1lbnQgRWxlbWVudCB0byBsb2NhdGUgaW4gdGhlIGFycmF5LlxuXHQgICAqIEBwYXJhbSB7TnVtYmVyfSBbZnJvbUluZGV4XSBUaGUgaW5kZXggdG8gc3RhcnQgdGhlIHNlYXJjaC4gIElmIG5vdCBzcGVjaWZpZWQsIGRlZmF1bHRzIHRvIDAuXG5cdCAgICogQHJldHVybnMge09ic2VydmFibGV9IEFuZCBvYnNlcnZhYmxlIHNlcXVlbmNlIGNvbnRhaW5pbmcgdGhlIGZpcnN0IGluZGV4IGF0IHdoaWNoIGEgZ2l2ZW4gZWxlbWVudCBjYW4gYmUgZm91bmQgaW4gdGhlIG9ic2VydmFibGUgc2VxdWVuY2UsIG9yIC0xIGlmIGl0IGlzIG5vdCBwcmVzZW50LlxuXHQgICAqL1xuXHQgIG9ic2VydmFibGVQcm90by5pbmRleE9mID0gZnVuY3Rpb24oc2VhcmNoRWxlbWVudCwgZnJvbUluZGV4KSB7XG5cdCAgICB2YXIgbiA9ICtmcm9tSW5kZXggfHwgMDtcblx0ICAgIE1hdGguYWJzKG4pID09PSBJbmZpbml0eSAmJiAobiA9IDApO1xuXHQgICAgcmV0dXJuIG5ldyBJbmRleE9mT2JzZXJ2YWJsZSh0aGlzLCBzZWFyY2hFbGVtZW50LCBuKTtcblx0ICB9O1xuXHRcblx0ICB2YXIgU3VtT2JzZXJ2YWJsZSA9IChmdW5jdGlvbiAoX19zdXBlcl9fKSB7XG5cdCAgICBpbmhlcml0cyhTdW1PYnNlcnZhYmxlLCBfX3N1cGVyX18pO1xuXHQgICAgZnVuY3Rpb24gU3VtT2JzZXJ2YWJsZShzb3VyY2UsIGZuKSB7XG5cdCAgICAgIHRoaXMuc291cmNlID0gc291cmNlO1xuXHQgICAgICB0aGlzLl9mbiA9IGZuO1xuXHQgICAgICBfX3N1cGVyX18uY2FsbCh0aGlzKTtcblx0ICAgIH1cblx0XG5cdCAgICBTdW1PYnNlcnZhYmxlLnByb3RvdHlwZS5zdWJzY3JpYmVDb3JlID0gZnVuY3Rpb24gKG8pIHtcblx0ICAgICAgcmV0dXJuIHRoaXMuc291cmNlLnN1YnNjcmliZShuZXcgU3VtT2JzZXJ2ZXIobywgdGhpcy5fZm4sIHRoaXMuc291cmNlKSk7XG5cdCAgICB9O1xuXHRcblx0ICAgIHJldHVybiBTdW1PYnNlcnZhYmxlO1xuXHQgIH0oT2JzZXJ2YWJsZUJhc2UpKTtcblx0XG5cdCAgdmFyIFN1bU9ic2VydmVyID0gKGZ1bmN0aW9uIChfX3N1cGVyX18pIHtcblx0ICAgIGluaGVyaXRzKFN1bU9ic2VydmVyLCBfX3N1cGVyX18pO1xuXHRcblx0ICAgIGZ1bmN0aW9uIFN1bU9ic2VydmVyKG8sIGZuLCBzKSB7XG5cdCAgICAgIHRoaXMuX28gPSBvO1xuXHQgICAgICB0aGlzLl9mbiA9IGZuO1xuXHQgICAgICB0aGlzLl9zID0gcztcblx0ICAgICAgdGhpcy5faSA9IDA7XG5cdCAgICAgIHRoaXMuX2MgPSAwO1xuXHQgICAgICBfX3N1cGVyX18uY2FsbCh0aGlzKTtcblx0ICAgIH1cblx0XG5cdCAgICBTdW1PYnNlcnZlci5wcm90b3R5cGUubmV4dCA9IGZ1bmN0aW9uICh4KSB7XG5cdCAgICAgIGlmICh0aGlzLl9mbikge1xuXHQgICAgICAgIHZhciByZXN1bHQgPSB0cnlDYXRjaCh0aGlzLl9mbikoeCwgdGhpcy5faSsrLCB0aGlzLl9zKTtcblx0ICAgICAgICBpZiAocmVzdWx0ID09PSBlcnJvck9iaikgeyByZXR1cm4gdGhpcy5fby5vbkVycm9yKHJlc3VsdC5lKTsgfVxuXHQgICAgICAgIHRoaXMuX2MgKz0gcmVzdWx0O1xuXHQgICAgICB9IGVsc2Uge1xuXHQgICAgICAgIHRoaXMuX2MgKz0geDtcblx0ICAgICAgfVxuXHQgICAgfTtcblx0ICAgIFN1bU9ic2VydmVyLnByb3RvdHlwZS5lcnJvciA9IGZ1bmN0aW9uIChlKSB7IHRoaXMuX28ub25FcnJvcihlKTsgfTtcblx0ICAgIFN1bU9ic2VydmVyLnByb3RvdHlwZS5jb21wbGV0ZWQgPSBmdW5jdGlvbiAoKSB7XG5cdCAgICAgIHRoaXMuX28ub25OZXh0KHRoaXMuX2MpO1xuXHQgICAgICB0aGlzLl9vLm9uQ29tcGxldGVkKCk7XG5cdCAgICB9O1xuXHRcblx0ICAgIHJldHVybiBTdW1PYnNlcnZlcjtcblx0ICB9KEFic3RyYWN0T2JzZXJ2ZXIpKTtcblx0XG5cdCAgLyoqXG5cdCAgICogQ29tcHV0ZXMgdGhlIHN1bSBvZiBhIHNlcXVlbmNlIG9mIHZhbHVlcyB0aGF0IGFyZSBvYnRhaW5lZCBieSBpbnZva2luZyBhbiBvcHRpb25hbCB0cmFuc2Zvcm0gZnVuY3Rpb24gb24gZWFjaCBlbGVtZW50IG9mIHRoZSBpbnB1dCBzZXF1ZW5jZSwgZWxzZSBpZiBub3Qgc3BlY2lmaWVkIGNvbXB1dGVzIHRoZSBzdW0gb24gZWFjaCBpdGVtIGluIHRoZSBzZXF1ZW5jZS5cblx0ICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBbc2VsZWN0b3JdIEEgdHJhbnNmb3JtIGZ1bmN0aW9uIHRvIGFwcGx5IHRvIGVhY2ggZWxlbWVudC5cblx0ICAgKiBAcGFyYW0ge0FueX0gW3RoaXNBcmddIE9iamVjdCB0byB1c2UgYXMgdGhpcyB3aGVuIGV4ZWN1dGluZyBjYWxsYmFjay5cblx0ICAgKiBAcmV0dXJucyB7T2JzZXJ2YWJsZX0gQW4gb2JzZXJ2YWJsZSBzZXF1ZW5jZSBjb250YWluaW5nIGEgc2luZ2xlIGVsZW1lbnQgd2l0aCB0aGUgc3VtIG9mIHRoZSB2YWx1ZXMgaW4gdGhlIHNvdXJjZSBzZXF1ZW5jZS5cblx0ICAgKi9cblx0ICBvYnNlcnZhYmxlUHJvdG8uc3VtID0gZnVuY3Rpb24gKGtleVNlbGVjdG9yLCB0aGlzQXJnKSB7XG5cdCAgICB2YXIgZm4gPSBiaW5kQ2FsbGJhY2soa2V5U2VsZWN0b3IsIHRoaXNBcmcsIDMpO1xuXHQgICAgcmV0dXJuIG5ldyBTdW1PYnNlcnZhYmxlKHRoaXMsIGZuKTtcblx0ICB9O1xuXHRcblx0ICAvKipcblx0ICAgKiBSZXR1cm5zIHRoZSBlbGVtZW50cyBpbiBhbiBvYnNlcnZhYmxlIHNlcXVlbmNlIHdpdGggdGhlIG1pbmltdW0ga2V5IHZhbHVlIGFjY29yZGluZyB0byB0aGUgc3BlY2lmaWVkIGNvbXBhcmVyLlxuXHQgICAqIEBleGFtcGxlXG5cdCAgICogdmFyIHJlcyA9IHNvdXJjZS5taW5CeShmdW5jdGlvbiAoeCkgeyByZXR1cm4geC52YWx1ZTsgfSk7XG5cdCAgICogdmFyIHJlcyA9IHNvdXJjZS5taW5CeShmdW5jdGlvbiAoeCkgeyByZXR1cm4geC52YWx1ZTsgfSwgZnVuY3Rpb24gKHgsIHkpIHsgcmV0dXJuIHggLSB5OyB9KTtcblx0ICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBrZXlTZWxlY3RvciBLZXkgc2VsZWN0b3IgZnVuY3Rpb24uXG5cdCAgICogQHBhcmFtIHtGdW5jdGlvbn0gW2NvbXBhcmVyXSBDb21wYXJlciB1c2VkIHRvIGNvbXBhcmUga2V5IHZhbHVlcy5cblx0ICAgKiBAcmV0dXJucyB7T2JzZXJ2YWJsZX0gQW4gb2JzZXJ2YWJsZSBzZXF1ZW5jZSBjb250YWluaW5nIGEgbGlzdCBvZiB6ZXJvIG9yIG1vcmUgZWxlbWVudHMgdGhhdCBoYXZlIGEgbWluaW11bSBrZXkgdmFsdWUuXG5cdCAgICovXG5cdCAgb2JzZXJ2YWJsZVByb3RvLm1pbkJ5ID0gZnVuY3Rpb24gKGtleVNlbGVjdG9yLCBjb21wYXJlcikge1xuXHQgICAgY29tcGFyZXIgfHwgKGNvbXBhcmVyID0gZGVmYXVsdFN1YkNvbXBhcmVyKTtcblx0ICAgIHJldHVybiBuZXcgRXh0cmVtYUJ5T2JzZXJ2YWJsZSh0aGlzLCBrZXlTZWxlY3RvciwgZnVuY3Rpb24gKHgsIHkpIHsgcmV0dXJuIGNvbXBhcmVyKHgsIHkpICogLTE7IH0pO1xuXHQgIH07XG5cdFxuXHQgIC8qKlxuXHQgICAqIFJldHVybnMgdGhlIG1pbmltdW0gZWxlbWVudCBpbiBhbiBvYnNlcnZhYmxlIHNlcXVlbmNlIGFjY29yZGluZyB0byB0aGUgb3B0aW9uYWwgY29tcGFyZXIgZWxzZSBhIGRlZmF1bHQgZ3JlYXRlciB0aGFuIGxlc3MgdGhhbiBjaGVjay5cblx0ICAgKiBAZXhhbXBsZVxuXHQgICAqIHZhciByZXMgPSBzb3VyY2UubWluKCk7XG5cdCAgICogdmFyIHJlcyA9IHNvdXJjZS5taW4oZnVuY3Rpb24gKHgsIHkpIHsgcmV0dXJuIHgudmFsdWUgLSB5LnZhbHVlOyB9KTtcblx0ICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBbY29tcGFyZXJdIENvbXBhcmVyIHVzZWQgdG8gY29tcGFyZSBlbGVtZW50cy5cblx0ICAgKiBAcmV0dXJucyB7T2JzZXJ2YWJsZX0gQW4gb2JzZXJ2YWJsZSBzZXF1ZW5jZSBjb250YWluaW5nIGEgc2luZ2xlIGVsZW1lbnQgd2l0aCB0aGUgbWluaW11bSBlbGVtZW50IGluIHRoZSBzb3VyY2Ugc2VxdWVuY2UuXG5cdCAgICovXG5cdCAgb2JzZXJ2YWJsZVByb3RvLm1pbiA9IGZ1bmN0aW9uIChjb21wYXJlcikge1xuXHQgICAgcmV0dXJuIHRoaXMubWluQnkoaWRlbnRpdHksIGNvbXBhcmVyKS5tYXAoZnVuY3Rpb24gKHgpIHsgcmV0dXJuIGZpcnN0T25seSh4KTsgfSk7XG5cdCAgfTtcblx0XG5cdCAgLyoqXG5cdCAgICogUmV0dXJucyB0aGUgZWxlbWVudHMgaW4gYW4gb2JzZXJ2YWJsZSBzZXF1ZW5jZSB3aXRoIHRoZSBtYXhpbXVtICBrZXkgdmFsdWUgYWNjb3JkaW5nIHRvIHRoZSBzcGVjaWZpZWQgY29tcGFyZXIuXG5cdCAgICogQGV4YW1wbGVcblx0ICAgKiB2YXIgcmVzID0gc291cmNlLm1heEJ5KGZ1bmN0aW9uICh4KSB7IHJldHVybiB4LnZhbHVlOyB9KTtcblx0ICAgKiB2YXIgcmVzID0gc291cmNlLm1heEJ5KGZ1bmN0aW9uICh4KSB7IHJldHVybiB4LnZhbHVlOyB9LCBmdW5jdGlvbiAoeCwgeSkgeyByZXR1cm4geCAtIHk7OyB9KTtcblx0ICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBrZXlTZWxlY3RvciBLZXkgc2VsZWN0b3IgZnVuY3Rpb24uXG5cdCAgICogQHBhcmFtIHtGdW5jdGlvbn0gW2NvbXBhcmVyXSAgQ29tcGFyZXIgdXNlZCB0byBjb21wYXJlIGtleSB2YWx1ZXMuXG5cdCAgICogQHJldHVybnMge09ic2VydmFibGV9IEFuIG9ic2VydmFibGUgc2VxdWVuY2UgY29udGFpbmluZyBhIGxpc3Qgb2YgemVybyBvciBtb3JlIGVsZW1lbnRzIHRoYXQgaGF2ZSBhIG1heGltdW0ga2V5IHZhbHVlLlxuXHQgICAqL1xuXHQgIG9ic2VydmFibGVQcm90by5tYXhCeSA9IGZ1bmN0aW9uIChrZXlTZWxlY3RvciwgY29tcGFyZXIpIHtcblx0ICAgIGNvbXBhcmVyIHx8IChjb21wYXJlciA9IGRlZmF1bHRTdWJDb21wYXJlcik7XG5cdCAgICByZXR1cm4gbmV3IEV4dHJlbWFCeU9ic2VydmFibGUodGhpcywga2V5U2VsZWN0b3IsIGNvbXBhcmVyKTtcblx0ICB9O1xuXHRcblx0ICAvKipcblx0ICAgKiBSZXR1cm5zIHRoZSBtYXhpbXVtIHZhbHVlIGluIGFuIG9ic2VydmFibGUgc2VxdWVuY2UgYWNjb3JkaW5nIHRvIHRoZSBzcGVjaWZpZWQgY29tcGFyZXIuXG5cdCAgICogQGV4YW1wbGVcblx0ICAgKiB2YXIgcmVzID0gc291cmNlLm1heCgpO1xuXHQgICAqIHZhciByZXMgPSBzb3VyY2UubWF4KGZ1bmN0aW9uICh4LCB5KSB7IHJldHVybiB4LnZhbHVlIC0geS52YWx1ZTsgfSk7XG5cdCAgICogQHBhcmFtIHtGdW5jdGlvbn0gW2NvbXBhcmVyXSBDb21wYXJlciB1c2VkIHRvIGNvbXBhcmUgZWxlbWVudHMuXG5cdCAgICogQHJldHVybnMge09ic2VydmFibGV9IEFuIG9ic2VydmFibGUgc2VxdWVuY2UgY29udGFpbmluZyBhIHNpbmdsZSBlbGVtZW50IHdpdGggdGhlIG1heGltdW0gZWxlbWVudCBpbiB0aGUgc291cmNlIHNlcXVlbmNlLlxuXHQgICAqL1xuXHQgIG9ic2VydmFibGVQcm90by5tYXggPSBmdW5jdGlvbiAoY29tcGFyZXIpIHtcblx0ICAgIHJldHVybiB0aGlzLm1heEJ5KGlkZW50aXR5LCBjb21wYXJlcikubWFwKGZ1bmN0aW9uICh4KSB7IHJldHVybiBmaXJzdE9ubHkoeCk7IH0pO1xuXHQgIH07XG5cdFxuXHQgIHZhciBBdmVyYWdlT2JzZXJ2YWJsZSA9IChmdW5jdGlvbiAoX19zdXBlcl9fKSB7XG5cdCAgICBpbmhlcml0cyhBdmVyYWdlT2JzZXJ2YWJsZSwgX19zdXBlcl9fKTtcblx0ICAgIGZ1bmN0aW9uIEF2ZXJhZ2VPYnNlcnZhYmxlKHNvdXJjZSwgZm4pIHtcblx0ICAgICAgdGhpcy5zb3VyY2UgPSBzb3VyY2U7XG5cdCAgICAgIHRoaXMuX2ZuID0gZm47XG5cdCAgICAgIF9fc3VwZXJfXy5jYWxsKHRoaXMpO1xuXHQgICAgfVxuXHRcblx0ICAgIEF2ZXJhZ2VPYnNlcnZhYmxlLnByb3RvdHlwZS5zdWJzY3JpYmVDb3JlID0gZnVuY3Rpb24gKG8pIHtcblx0ICAgICAgcmV0dXJuIHRoaXMuc291cmNlLnN1YnNjcmliZShuZXcgQXZlcmFnZU9ic2VydmVyKG8sIHRoaXMuX2ZuLCB0aGlzLnNvdXJjZSkpO1xuXHQgICAgfTtcblx0XG5cdCAgICByZXR1cm4gQXZlcmFnZU9ic2VydmFibGU7XG5cdCAgfShPYnNlcnZhYmxlQmFzZSkpO1xuXHRcblx0ICB2YXIgQXZlcmFnZU9ic2VydmVyID0gKGZ1bmN0aW9uKF9fc3VwZXJfXykge1xuXHQgICAgaW5oZXJpdHMoQXZlcmFnZU9ic2VydmVyLCBfX3N1cGVyX18pO1xuXHQgICAgZnVuY3Rpb24gQXZlcmFnZU9ic2VydmVyKG8sIGZuLCBzKSB7XG5cdCAgICAgIHRoaXMuX28gPSBvO1xuXHQgICAgICB0aGlzLl9mbiA9IGZuO1xuXHQgICAgICB0aGlzLl9zID0gcztcblx0ICAgICAgdGhpcy5fYyA9IDA7XG5cdCAgICAgIHRoaXMuX3QgPSAwO1xuXHQgICAgICBfX3N1cGVyX18uY2FsbCh0aGlzKTtcblx0ICAgIH1cblx0XG5cdCAgICBBdmVyYWdlT2JzZXJ2ZXIucHJvdG90eXBlLm5leHQgPSBmdW5jdGlvbiAoeCkge1xuXHQgICAgICBpZih0aGlzLl9mbikge1xuXHQgICAgICAgIHZhciByID0gdHJ5Q2F0Y2godGhpcy5fZm4pKHgsIHRoaXMuX2MrKywgdGhpcy5fcyk7XG5cdCAgICAgICAgaWYgKHIgPT09IGVycm9yT2JqKSB7IHJldHVybiB0aGlzLl9vLm9uRXJyb3Ioci5lKTsgfVxuXHQgICAgICAgIHRoaXMuX3QgKz0gcjtcblx0ICAgICAgfSBlbHNlIHtcblx0ICAgICAgICB0aGlzLl9jKys7XG5cdCAgICAgICAgdGhpcy5fdCArPSB4O1xuXHQgICAgICB9XG5cdCAgICB9O1xuXHQgICAgQXZlcmFnZU9ic2VydmVyLnByb3RvdHlwZS5lcnJvciA9IGZ1bmN0aW9uIChlKSB7IHRoaXMuX28ub25FcnJvcihlKTsgfTtcblx0ICAgIEF2ZXJhZ2VPYnNlcnZlci5wcm90b3R5cGUuY29tcGxldGVkID0gZnVuY3Rpb24gKCkge1xuXHQgICAgICBpZiAodGhpcy5fYyA9PT0gMCkgeyByZXR1cm4gdGhpcy5fby5vbkVycm9yKG5ldyBFbXB0eUVycm9yKCkpOyB9XG5cdCAgICAgIHRoaXMuX28ub25OZXh0KHRoaXMuX3QgLyB0aGlzLl9jKTtcblx0ICAgICAgdGhpcy5fby5vbkNvbXBsZXRlZCgpO1xuXHQgICAgfTtcblx0XG5cdCAgICByZXR1cm4gQXZlcmFnZU9ic2VydmVyO1xuXHQgIH0oQWJzdHJhY3RPYnNlcnZlcikpO1xuXHRcblx0ICAvKipcblx0ICAgKiBDb21wdXRlcyB0aGUgYXZlcmFnZSBvZiBhbiBvYnNlcnZhYmxlIHNlcXVlbmNlIG9mIHZhbHVlcyB0aGF0IGFyZSBpbiB0aGUgc2VxdWVuY2Ugb3Igb2J0YWluZWQgYnkgaW52b2tpbmcgYSB0cmFuc2Zvcm0gZnVuY3Rpb24gb24gZWFjaCBlbGVtZW50IG9mIHRoZSBpbnB1dCBzZXF1ZW5jZSBpZiBwcmVzZW50LlxuXHQgICAqIEBwYXJhbSB7RnVuY3Rpb259IFtzZWxlY3Rvcl0gQSB0cmFuc2Zvcm0gZnVuY3Rpb24gdG8gYXBwbHkgdG8gZWFjaCBlbGVtZW50LlxuXHQgICAqIEBwYXJhbSB7QW55fSBbdGhpc0FyZ10gT2JqZWN0IHRvIHVzZSBhcyB0aGlzIHdoZW4gZXhlY3V0aW5nIGNhbGxiYWNrLlxuXHQgICAqIEByZXR1cm5zIHtPYnNlcnZhYmxlfSBBbiBvYnNlcnZhYmxlIHNlcXVlbmNlIGNvbnRhaW5pbmcgYSBzaW5nbGUgZWxlbWVudCB3aXRoIHRoZSBhdmVyYWdlIG9mIHRoZSBzZXF1ZW5jZSBvZiB2YWx1ZXMuXG5cdCAgICovXG5cdCAgb2JzZXJ2YWJsZVByb3RvLmF2ZXJhZ2UgPSBmdW5jdGlvbiAoa2V5U2VsZWN0b3IsIHRoaXNBcmcpIHtcblx0ICAgIHZhciBzb3VyY2UgPSB0aGlzLCBmbjtcblx0ICAgIGlmIChpc0Z1bmN0aW9uKGtleVNlbGVjdG9yKSkge1xuXHQgICAgICBmbiA9IGJpbmRDYWxsYmFjayhrZXlTZWxlY3RvciwgdGhpc0FyZywgMyk7XG5cdCAgICB9XG5cdCAgICByZXR1cm4gbmV3IEF2ZXJhZ2VPYnNlcnZhYmxlKHNvdXJjZSwgZm4pO1xuXHQgIH07XG5cdFxuXHQgIC8qKlxuXHQgICAqICBEZXRlcm1pbmVzIHdoZXRoZXIgdHdvIHNlcXVlbmNlcyBhcmUgZXF1YWwgYnkgY29tcGFyaW5nIHRoZSBlbGVtZW50cyBwYWlyd2lzZSB1c2luZyBhIHNwZWNpZmllZCBlcXVhbGl0eSBjb21wYXJlci5cblx0ICAgKlxuXHQgICAqIEBleGFtcGxlXG5cdCAgICogdmFyIHJlcyA9IHJlcyA9IHNvdXJjZS5zZXF1ZW5jZUVxdWFsKFsxLDIsM10pO1xuXHQgICAqIHZhciByZXMgPSByZXMgPSBzb3VyY2Uuc2VxdWVuY2VFcXVhbChbeyB2YWx1ZTogNDIgfV0sIGZ1bmN0aW9uICh4LCB5KSB7IHJldHVybiB4LnZhbHVlID09PSB5LnZhbHVlOyB9KTtcblx0ICAgKiAzIC0gcmVzID0gc291cmNlLnNlcXVlbmNlRXF1YWwoUnguT2JzZXJ2YWJsZS5yZXR1cm5WYWx1ZSg0MikpO1xuXHQgICAqIDQgLSByZXMgPSBzb3VyY2Uuc2VxdWVuY2VFcXVhbChSeC5PYnNlcnZhYmxlLnJldHVyblZhbHVlKHsgdmFsdWU6IDQyIH0pLCBmdW5jdGlvbiAoeCwgeSkgeyByZXR1cm4geC52YWx1ZSA9PT0geS52YWx1ZTsgfSk7XG5cdCAgICogQHBhcmFtIHtPYnNlcnZhYmxlfSBzZWNvbmQgU2Vjb25kIG9ic2VydmFibGUgc2VxdWVuY2Ugb3IgYXJyYXkgdG8gY29tcGFyZS5cblx0ICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBbY29tcGFyZXJdIENvbXBhcmVyIHVzZWQgdG8gY29tcGFyZSBlbGVtZW50cyBvZiBib3RoIHNlcXVlbmNlcy5cblx0ICAgKiBAcmV0dXJucyB7T2JzZXJ2YWJsZX0gQW4gb2JzZXJ2YWJsZSBzZXF1ZW5jZSB0aGF0IGNvbnRhaW5zIGEgc2luZ2xlIGVsZW1lbnQgd2hpY2ggaW5kaWNhdGVzIHdoZXRoZXIgYm90aCBzZXF1ZW5jZXMgYXJlIG9mIGVxdWFsIGxlbmd0aCBhbmQgdGhlaXIgY29ycmVzcG9uZGluZyBlbGVtZW50cyBhcmUgZXF1YWwgYWNjb3JkaW5nIHRvIHRoZSBzcGVjaWZpZWQgZXF1YWxpdHkgY29tcGFyZXIuXG5cdCAgICovXG5cdCAgb2JzZXJ2YWJsZVByb3RvLnNlcXVlbmNlRXF1YWwgPSBmdW5jdGlvbiAoc2Vjb25kLCBjb21wYXJlcikge1xuXHQgICAgdmFyIGZpcnN0ID0gdGhpcztcblx0ICAgIGNvbXBhcmVyIHx8IChjb21wYXJlciA9IGRlZmF1bHRDb21wYXJlcik7XG5cdCAgICByZXR1cm4gbmV3IEFub255bW91c09ic2VydmFibGUoZnVuY3Rpb24gKG8pIHtcblx0ICAgICAgdmFyIGRvbmVsID0gZmFsc2UsIGRvbmVyID0gZmFsc2UsIHFsID0gW10sIHFyID0gW107XG5cdCAgICAgIHZhciBzdWJzY3JpcHRpb24xID0gZmlyc3Quc3Vic2NyaWJlKGZ1bmN0aW9uICh4KSB7XG5cdCAgICAgICAgaWYgKHFyLmxlbmd0aCA+IDApIHtcblx0ICAgICAgICAgIHZhciB2ID0gcXIuc2hpZnQoKTtcblx0ICAgICAgICAgIHZhciBlcXVhbCA9IHRyeUNhdGNoKGNvbXBhcmVyKSh2LCB4KTtcblx0ICAgICAgICAgIGlmIChlcXVhbCA9PT0gZXJyb3JPYmopIHsgcmV0dXJuIG8ub25FcnJvcihlcXVhbC5lKTsgfVxuXHQgICAgICAgICAgaWYgKCFlcXVhbCkge1xuXHQgICAgICAgICAgICBvLm9uTmV4dChmYWxzZSk7XG5cdCAgICAgICAgICAgIG8ub25Db21wbGV0ZWQoKTtcblx0ICAgICAgICAgIH1cblx0ICAgICAgICB9IGVsc2UgaWYgKGRvbmVyKSB7XG5cdCAgICAgICAgICBvLm9uTmV4dChmYWxzZSk7XG5cdCAgICAgICAgICBvLm9uQ29tcGxldGVkKCk7XG5cdCAgICAgICAgfSBlbHNlIHtcblx0ICAgICAgICAgIHFsLnB1c2goeCk7XG5cdCAgICAgICAgfVxuXHQgICAgICB9LCBmdW5jdGlvbihlKSB7IG8ub25FcnJvcihlKTsgfSwgZnVuY3Rpb24gKCkge1xuXHQgICAgICAgIGRvbmVsID0gdHJ1ZTtcblx0ICAgICAgICBpZiAocWwubGVuZ3RoID09PSAwKSB7XG5cdCAgICAgICAgICBpZiAocXIubGVuZ3RoID4gMCkge1xuXHQgICAgICAgICAgICBvLm9uTmV4dChmYWxzZSk7XG5cdCAgICAgICAgICAgIG8ub25Db21wbGV0ZWQoKTtcblx0ICAgICAgICAgIH0gZWxzZSBpZiAoZG9uZXIpIHtcblx0ICAgICAgICAgICAgby5vbk5leHQodHJ1ZSk7XG5cdCAgICAgICAgICAgIG8ub25Db21wbGV0ZWQoKTtcblx0ICAgICAgICAgIH1cblx0ICAgICAgICB9XG5cdCAgICAgIH0pO1xuXHRcblx0ICAgICAgKGlzQXJyYXlMaWtlKHNlY29uZCkgfHwgaXNJdGVyYWJsZShzZWNvbmQpKSAmJiAoc2Vjb25kID0gb2JzZXJ2YWJsZUZyb20oc2Vjb25kKSk7XG5cdCAgICAgIGlzUHJvbWlzZShzZWNvbmQpICYmIChzZWNvbmQgPSBvYnNlcnZhYmxlRnJvbVByb21pc2Uoc2Vjb25kKSk7XG5cdCAgICAgIHZhciBzdWJzY3JpcHRpb24yID0gc2Vjb25kLnN1YnNjcmliZShmdW5jdGlvbiAoeCkge1xuXHQgICAgICAgIGlmIChxbC5sZW5ndGggPiAwKSB7XG5cdCAgICAgICAgICB2YXIgdiA9IHFsLnNoaWZ0KCk7XG5cdCAgICAgICAgICB2YXIgZXF1YWwgPSB0cnlDYXRjaChjb21wYXJlcikodiwgeCk7XG5cdCAgICAgICAgICBpZiAoZXF1YWwgPT09IGVycm9yT2JqKSB7IHJldHVybiBvLm9uRXJyb3IoZXF1YWwuZSk7IH1cblx0ICAgICAgICAgIGlmICghZXF1YWwpIHtcblx0ICAgICAgICAgICAgby5vbk5leHQoZmFsc2UpO1xuXHQgICAgICAgICAgICBvLm9uQ29tcGxldGVkKCk7XG5cdCAgICAgICAgICB9XG5cdCAgICAgICAgfSBlbHNlIGlmIChkb25lbCkge1xuXHQgICAgICAgICAgby5vbk5leHQoZmFsc2UpO1xuXHQgICAgICAgICAgby5vbkNvbXBsZXRlZCgpO1xuXHQgICAgICAgIH0gZWxzZSB7XG5cdCAgICAgICAgICBxci5wdXNoKHgpO1xuXHQgICAgICAgIH1cblx0ICAgICAgfSwgZnVuY3Rpb24oZSkgeyBvLm9uRXJyb3IoZSk7IH0sIGZ1bmN0aW9uICgpIHtcblx0ICAgICAgICBkb25lciA9IHRydWU7XG5cdCAgICAgICAgaWYgKHFyLmxlbmd0aCA9PT0gMCkge1xuXHQgICAgICAgICAgaWYgKHFsLmxlbmd0aCA+IDApIHtcblx0ICAgICAgICAgICAgby5vbk5leHQoZmFsc2UpO1xuXHQgICAgICAgICAgICBvLm9uQ29tcGxldGVkKCk7XG5cdCAgICAgICAgICB9IGVsc2UgaWYgKGRvbmVsKSB7XG5cdCAgICAgICAgICAgIG8ub25OZXh0KHRydWUpO1xuXHQgICAgICAgICAgICBvLm9uQ29tcGxldGVkKCk7XG5cdCAgICAgICAgICB9XG5cdCAgICAgICAgfVxuXHQgICAgICB9KTtcblx0ICAgICAgcmV0dXJuIG5ldyBCaW5hcnlEaXNwb3NhYmxlKHN1YnNjcmlwdGlvbjEsIHN1YnNjcmlwdGlvbjIpO1xuXHQgICAgfSwgZmlyc3QpO1xuXHQgIH07XG5cdFxuXHQgIHZhciBFbGVtZW50QXRPYnNlcnZhYmxlID0gKGZ1bmN0aW9uIChfX3N1cGVyX18pIHtcblx0ICAgIGluaGVyaXRzKEVsZW1lbnRBdE9ic2VydmFibGUsIF9fc3VwZXJfXyk7XG5cdCAgICBmdW5jdGlvbiBFbGVtZW50QXRPYnNlcnZhYmxlKHNvdXJjZSwgaSwgZCkge1xuXHQgICAgICB0aGlzLnNvdXJjZSA9IHNvdXJjZTtcblx0ICAgICAgdGhpcy5faSA9IGk7XG5cdCAgICAgIHRoaXMuX2QgPSBkO1xuXHQgICAgICBfX3N1cGVyX18uY2FsbCh0aGlzKTtcblx0ICAgIH1cblx0XG5cdCAgICBFbGVtZW50QXRPYnNlcnZhYmxlLnByb3RvdHlwZS5zdWJzY3JpYmVDb3JlID0gZnVuY3Rpb24gKG8pIHtcblx0ICAgICAgcmV0dXJuIHRoaXMuc291cmNlLnN1YnNjcmliZShuZXcgRWxlbWVudEF0T2JzZXJ2ZXIobywgdGhpcy5faSwgdGhpcy5fZCkpO1xuXHQgICAgfTtcblx0XG5cdCAgICByZXR1cm4gRWxlbWVudEF0T2JzZXJ2YWJsZTtcblx0ICB9KE9ic2VydmFibGVCYXNlKSk7XG5cdFxuXHQgIHZhciBFbGVtZW50QXRPYnNlcnZlciA9IChmdW5jdGlvbiAoX19zdXBlcl9fKSB7XG5cdCAgICBpbmhlcml0cyhFbGVtZW50QXRPYnNlcnZlciwgX19zdXBlcl9fKTtcblx0XG5cdCAgICBmdW5jdGlvbiBFbGVtZW50QXRPYnNlcnZlcihvLCBpLCBkKSB7XG5cdCAgICAgIHRoaXMuX28gPSBvO1xuXHQgICAgICB0aGlzLl9pID0gaTtcblx0ICAgICAgdGhpcy5fZCA9IGQ7XG5cdCAgICAgIF9fc3VwZXJfXy5jYWxsKHRoaXMpO1xuXHQgICAgfVxuXHRcblx0ICAgIEVsZW1lbnRBdE9ic2VydmVyLnByb3RvdHlwZS5uZXh0ID0gZnVuY3Rpb24gKHgpIHtcblx0ICAgICAgaWYgKHRoaXMuX2ktLSA9PT0gMCkge1xuXHQgICAgICAgIHRoaXMuX28ub25OZXh0KHgpO1xuXHQgICAgICAgIHRoaXMuX28ub25Db21wbGV0ZWQoKTtcblx0ICAgICAgfVxuXHQgICAgfTtcblx0ICAgIEVsZW1lbnRBdE9ic2VydmVyLnByb3RvdHlwZS5lcnJvciA9IGZ1bmN0aW9uIChlKSB7IHRoaXMuX28ub25FcnJvcihlKTsgfTtcblx0ICAgIEVsZW1lbnRBdE9ic2VydmVyLnByb3RvdHlwZS5jb21wbGV0ZWQgPSBmdW5jdGlvbiAoKSB7XG5cdCAgICAgIGlmICh0aGlzLl9kID09PSB1bmRlZmluZWQpIHtcblx0ICAgICAgICB0aGlzLl9vLm9uRXJyb3IobmV3IEFyZ3VtZW50T3V0T2ZSYW5nZUVycm9yKCkpO1xuXHQgICAgICB9IGVsc2Uge1xuXHQgICAgICAgIHRoaXMuX28ub25OZXh0KHRoaXMuX2QpO1xuXHQgICAgICAgIHRoaXMuX28ub25Db21wbGV0ZWQoKTtcblx0ICAgICAgfVxuXHQgICAgfTtcblx0XG5cdCAgICByZXR1cm4gRWxlbWVudEF0T2JzZXJ2ZXI7XG5cdCAgfShBYnN0cmFjdE9ic2VydmVyKSk7XG5cdFxuXHQgIC8qKlxuXHQgICAqIFJldHVybnMgdGhlIGVsZW1lbnQgYXQgYSBzcGVjaWZpZWQgaW5kZXggaW4gYSBzZXF1ZW5jZSBvciBkZWZhdWx0IHZhbHVlIGlmIG5vdCBmb3VuZC5cblx0ICAgKiBAcGFyYW0ge051bWJlcn0gaW5kZXggVGhlIHplcm8tYmFzZWQgaW5kZXggb2YgdGhlIGVsZW1lbnQgdG8gcmV0cmlldmUuXG5cdCAgICogQHBhcmFtIHtBbnl9IFtkZWZhdWx0VmFsdWVdIFRoZSBkZWZhdWx0IHZhbHVlIHRvIHVzZSBpZiBlbGVtZW50QXQgZG9lcyBub3QgZmluZCBhIHZhbHVlLlxuXHQgICAqIEByZXR1cm5zIHtPYnNlcnZhYmxlfSBBbiBvYnNlcnZhYmxlIHNlcXVlbmNlIHRoYXQgcHJvZHVjZXMgdGhlIGVsZW1lbnQgYXQgdGhlIHNwZWNpZmllZCBwb3NpdGlvbiBpbiB0aGUgc291cmNlIHNlcXVlbmNlLlxuXHQgICAqL1xuXHQgIG9ic2VydmFibGVQcm90by5lbGVtZW50QXQgPSAgZnVuY3Rpb24gKGluZGV4LCBkZWZhdWx0VmFsdWUpIHtcblx0ICAgIGlmIChpbmRleCA8IDApIHsgdGhyb3cgbmV3IEFyZ3VtZW50T3V0T2ZSYW5nZUVycm9yKCk7IH1cblx0ICAgIHJldHVybiBuZXcgRWxlbWVudEF0T2JzZXJ2YWJsZSh0aGlzLCBpbmRleCwgZGVmYXVsdFZhbHVlKTtcblx0ICB9O1xuXHRcblx0ICB2YXIgU2luZ2xlT2JzZXJ2ZXIgPSAoZnVuY3Rpb24oX19zdXBlcl9fKSB7XG5cdCAgICBpbmhlcml0cyhTaW5nbGVPYnNlcnZlciwgX19zdXBlcl9fKTtcblx0ICAgIGZ1bmN0aW9uIFNpbmdsZU9ic2VydmVyKG8sIG9iaiwgcykge1xuXHQgICAgICB0aGlzLl9vID0gbztcblx0ICAgICAgdGhpcy5fb2JqID0gb2JqO1xuXHQgICAgICB0aGlzLl9zID0gcztcblx0ICAgICAgdGhpcy5faSA9IDA7XG5cdCAgICAgIHRoaXMuX2h2ID0gZmFsc2U7XG5cdCAgICAgIHRoaXMuX3YgPSBudWxsO1xuXHQgICAgICBfX3N1cGVyX18uY2FsbCh0aGlzKTtcblx0ICAgIH1cblx0XG5cdCAgICBTaW5nbGVPYnNlcnZlci5wcm90b3R5cGUubmV4dCA9IGZ1bmN0aW9uICh4KSB7XG5cdCAgICAgIHZhciBzaG91bGRZaWVsZCA9IGZhbHNlO1xuXHQgICAgICBpZiAodGhpcy5fb2JqLnByZWRpY2F0ZSkge1xuXHQgICAgICAgIHZhciByZXMgPSB0cnlDYXRjaCh0aGlzLl9vYmoucHJlZGljYXRlKSh4LCB0aGlzLl9pKyssIHRoaXMuX3MpO1xuXHQgICAgICAgIGlmIChyZXMgPT09IGVycm9yT2JqKSB7IHJldHVybiB0aGlzLl9vLm9uRXJyb3IocmVzLmUpOyB9XG5cdCAgICAgICAgQm9vbGVhbihyZXMpICYmIChzaG91bGRZaWVsZCA9IHRydWUpO1xuXHQgICAgICB9IGVsc2UgaWYgKCF0aGlzLl9vYmoucHJlZGljYXRlKSB7XG5cdCAgICAgICAgc2hvdWxkWWllbGQgPSB0cnVlO1xuXHQgICAgICB9XG5cdCAgICAgIGlmIChzaG91bGRZaWVsZCkge1xuXHQgICAgICAgIGlmICh0aGlzLl9odikge1xuXHQgICAgICAgICAgcmV0dXJuIHRoaXMuX28ub25FcnJvcihuZXcgRXJyb3IoJ1NlcXVlbmNlIGNvbnRhaW5zIG1vcmUgdGhhbiBvbmUgbWF0Y2hpbmcgZWxlbWVudCcpKTtcblx0ICAgICAgICB9XG5cdCAgICAgICAgdGhpcy5faHYgPSB0cnVlO1xuXHQgICAgICAgIHRoaXMuX3YgPSB4O1xuXHQgICAgICB9XG5cdCAgICB9O1xuXHQgICAgU2luZ2xlT2JzZXJ2ZXIucHJvdG90eXBlLmVycm9yID0gZnVuY3Rpb24gKGUpIHsgdGhpcy5fby5vbkVycm9yKGUpOyB9O1xuXHQgICAgU2luZ2xlT2JzZXJ2ZXIucHJvdG90eXBlLmNvbXBsZXRlZCA9IGZ1bmN0aW9uICgpIHtcblx0ICAgICAgaWYgKHRoaXMuX2h2KSB7XG5cdCAgICAgICAgdGhpcy5fby5vbk5leHQodGhpcy5fdik7XG5cdCAgICAgICAgdGhpcy5fby5vbkNvbXBsZXRlZCgpO1xuXHQgICAgICB9XG5cdCAgICAgIGVsc2UgaWYgKHRoaXMuX29iai5kZWZhdWx0VmFsdWUgPT09IHVuZGVmaW5lZCkge1xuXHQgICAgICAgIHRoaXMuX28ub25FcnJvcihuZXcgRW1wdHlFcnJvcigpKTtcblx0ICAgICAgfSBlbHNlIHtcblx0ICAgICAgICB0aGlzLl9vLm9uTmV4dCh0aGlzLl9vYmouZGVmYXVsdFZhbHVlKTtcblx0ICAgICAgICB0aGlzLl9vLm9uQ29tcGxldGVkKCk7XG5cdCAgICAgIH1cblx0ICAgIH07XG5cdFxuXHQgICAgcmV0dXJuIFNpbmdsZU9ic2VydmVyO1xuXHQgIH0oQWJzdHJhY3RPYnNlcnZlcikpO1xuXHRcblx0XG5cdCAgICAvKipcblx0ICAgICAqIFJldHVybnMgdGhlIG9ubHkgZWxlbWVudCBvZiBhbiBvYnNlcnZhYmxlIHNlcXVlbmNlIHRoYXQgc2F0aXNmaWVzIHRoZSBjb25kaXRpb24gaW4gdGhlIG9wdGlvbmFsIHByZWRpY2F0ZSwgYW5kIHJlcG9ydHMgYW4gZXhjZXB0aW9uIGlmIHRoZXJlIGlzIG5vdCBleGFjdGx5IG9uZSBlbGVtZW50IGluIHRoZSBvYnNlcnZhYmxlIHNlcXVlbmNlLlxuXHQgICAgICogQHJldHVybnMge09ic2VydmFibGV9IFNlcXVlbmNlIGNvbnRhaW5pbmcgdGhlIHNpbmdsZSBlbGVtZW50IGluIHRoZSBvYnNlcnZhYmxlIHNlcXVlbmNlIHRoYXQgc2F0aXNmaWVzIHRoZSBjb25kaXRpb24gaW4gdGhlIHByZWRpY2F0ZS5cblx0ICAgICAqL1xuXHQgICAgb2JzZXJ2YWJsZVByb3RvLnNpbmdsZSA9IGZ1bmN0aW9uIChwcmVkaWNhdGUsIHRoaXNBcmcpIHtcblx0ICAgICAgdmFyIG9iaiA9IHt9LCBzb3VyY2UgPSB0aGlzO1xuXHQgICAgICBpZiAodHlwZW9mIGFyZ3VtZW50c1swXSA9PT0gJ29iamVjdCcpIHtcblx0ICAgICAgICBvYmogPSBhcmd1bWVudHNbMF07XG5cdCAgICAgIH0gZWxzZSB7XG5cdCAgICAgICAgb2JqID0ge1xuXHQgICAgICAgICAgcHJlZGljYXRlOiBhcmd1bWVudHNbMF0sXG5cdCAgICAgICAgICB0aGlzQXJnOiBhcmd1bWVudHNbMV0sXG5cdCAgICAgICAgICBkZWZhdWx0VmFsdWU6IGFyZ3VtZW50c1syXVxuXHQgICAgICAgIH07XG5cdCAgICAgIH1cblx0ICAgICAgaWYgKGlzRnVuY3Rpb24gKG9iai5wcmVkaWNhdGUpKSB7XG5cdCAgICAgICAgdmFyIGZuID0gb2JqLnByZWRpY2F0ZTtcblx0ICAgICAgICBvYmoucHJlZGljYXRlID0gYmluZENhbGxiYWNrKGZuLCBvYmoudGhpc0FyZywgMyk7XG5cdCAgICAgIH1cblx0ICAgICAgcmV0dXJuIG5ldyBBbm9ueW1vdXNPYnNlcnZhYmxlKGZ1bmN0aW9uIChvKSB7XG5cdCAgICAgICAgcmV0dXJuIHNvdXJjZS5zdWJzY3JpYmUobmV3IFNpbmdsZU9ic2VydmVyKG8sIG9iaiwgc291cmNlKSk7XG5cdCAgICAgIH0sIHNvdXJjZSk7XG5cdCAgICB9O1xuXHRcblx0ICB2YXIgRmlyc3RPYnNlcnZhYmxlID0gKGZ1bmN0aW9uIChfX3N1cGVyX18pIHtcblx0ICAgIGluaGVyaXRzKEZpcnN0T2JzZXJ2YWJsZSwgX19zdXBlcl9fKTtcblx0ICAgIGZ1bmN0aW9uIEZpcnN0T2JzZXJ2YWJsZShzb3VyY2UsIG9iaikge1xuXHQgICAgICB0aGlzLnNvdXJjZSA9IHNvdXJjZTtcblx0ICAgICAgdGhpcy5fb2JqID0gb2JqO1xuXHQgICAgICBfX3N1cGVyX18uY2FsbCh0aGlzKTtcblx0ICAgIH1cblx0XG5cdCAgICBGaXJzdE9ic2VydmFibGUucHJvdG90eXBlLnN1YnNjcmliZUNvcmUgPSBmdW5jdGlvbiAobykge1xuXHQgICAgICByZXR1cm4gdGhpcy5zb3VyY2Uuc3Vic2NyaWJlKG5ldyBGaXJzdE9ic2VydmVyKG8sIHRoaXMuX29iaiwgdGhpcy5zb3VyY2UpKTtcblx0ICAgIH07XG5cdFxuXHQgICAgcmV0dXJuIEZpcnN0T2JzZXJ2YWJsZTtcblx0ICB9KE9ic2VydmFibGVCYXNlKSk7XG5cdFxuXHQgIHZhciBGaXJzdE9ic2VydmVyID0gKGZ1bmN0aW9uKF9fc3VwZXJfXykge1xuXHQgICAgaW5oZXJpdHMoRmlyc3RPYnNlcnZlciwgX19zdXBlcl9fKTtcblx0ICAgIGZ1bmN0aW9uIEZpcnN0T2JzZXJ2ZXIobywgb2JqLCBzKSB7XG5cdCAgICAgIHRoaXMuX28gPSBvO1xuXHQgICAgICB0aGlzLl9vYmogPSBvYmo7XG5cdCAgICAgIHRoaXMuX3MgPSBzO1xuXHQgICAgICB0aGlzLl9pID0gMDtcblx0ICAgICAgX19zdXBlcl9fLmNhbGwodGhpcyk7XG5cdCAgICB9XG5cdFxuXHQgICAgRmlyc3RPYnNlcnZlci5wcm90b3R5cGUubmV4dCA9IGZ1bmN0aW9uICh4KSB7XG5cdCAgICAgIGlmICh0aGlzLl9vYmoucHJlZGljYXRlKSB7XG5cdCAgICAgICAgdmFyIHJlcyA9IHRyeUNhdGNoKHRoaXMuX29iai5wcmVkaWNhdGUpKHgsIHRoaXMuX2krKywgdGhpcy5fcyk7XG5cdCAgICAgICAgaWYgKHJlcyA9PT0gZXJyb3JPYmopIHsgcmV0dXJuIHRoaXMuX28ub25FcnJvcihyZXMuZSk7IH1cblx0ICAgICAgICBpZiAoQm9vbGVhbihyZXMpKSB7XG5cdCAgICAgICAgICB0aGlzLl9vLm9uTmV4dCh4KTtcblx0ICAgICAgICAgIHRoaXMuX28ub25Db21wbGV0ZWQoKTtcblx0ICAgICAgICB9XG5cdCAgICAgIH0gZWxzZSBpZiAoIXRoaXMuX29iai5wcmVkaWNhdGUpIHtcblx0ICAgICAgICB0aGlzLl9vLm9uTmV4dCh4KTtcblx0ICAgICAgICB0aGlzLl9vLm9uQ29tcGxldGVkKCk7XG5cdCAgICAgIH1cblx0ICAgIH07XG5cdCAgICBGaXJzdE9ic2VydmVyLnByb3RvdHlwZS5lcnJvciA9IGZ1bmN0aW9uIChlKSB7IHRoaXMuX28ub25FcnJvcihlKTsgfTtcblx0ICAgIEZpcnN0T2JzZXJ2ZXIucHJvdG90eXBlLmNvbXBsZXRlZCA9IGZ1bmN0aW9uICgpIHtcblx0ICAgICAgaWYgKHRoaXMuX29iai5kZWZhdWx0VmFsdWUgPT09IHVuZGVmaW5lZCkge1xuXHQgICAgICAgIHRoaXMuX28ub25FcnJvcihuZXcgRW1wdHlFcnJvcigpKTtcblx0ICAgICAgfSBlbHNlIHtcblx0ICAgICAgICB0aGlzLl9vLm9uTmV4dCh0aGlzLl9vYmouZGVmYXVsdFZhbHVlKTtcblx0ICAgICAgICB0aGlzLl9vLm9uQ29tcGxldGVkKCk7XG5cdCAgICAgIH1cblx0ICAgIH07XG5cdFxuXHQgICAgcmV0dXJuIEZpcnN0T2JzZXJ2ZXI7XG5cdCAgfShBYnN0cmFjdE9ic2VydmVyKSk7XG5cdFxuXHQgIC8qKlxuXHQgICAqIFJldHVybnMgdGhlIGZpcnN0IGVsZW1lbnQgb2YgYW4gb2JzZXJ2YWJsZSBzZXF1ZW5jZSB0aGF0IHNhdGlzZmllcyB0aGUgY29uZGl0aW9uIGluIHRoZSBwcmVkaWNhdGUgaWYgcHJlc2VudCBlbHNlIHRoZSBmaXJzdCBpdGVtIGluIHRoZSBzZXF1ZW5jZS5cblx0ICAgKiBAcmV0dXJucyB7T2JzZXJ2YWJsZX0gU2VxdWVuY2UgY29udGFpbmluZyB0aGUgZmlyc3QgZWxlbWVudCBpbiB0aGUgb2JzZXJ2YWJsZSBzZXF1ZW5jZSB0aGF0IHNhdGlzZmllcyB0aGUgY29uZGl0aW9uIGluIHRoZSBwcmVkaWNhdGUgaWYgcHJvdmlkZWQsIGVsc2UgdGhlIGZpcnN0IGl0ZW0gaW4gdGhlIHNlcXVlbmNlLlxuXHQgICAqL1xuXHQgIG9ic2VydmFibGVQcm90by5maXJzdCA9IGZ1bmN0aW9uICgpIHtcblx0ICAgIHZhciBvYmogPSB7fSwgc291cmNlID0gdGhpcztcblx0ICAgIGlmICh0eXBlb2YgYXJndW1lbnRzWzBdID09PSAnb2JqZWN0Jykge1xuXHQgICAgICBvYmogPSBhcmd1bWVudHNbMF07XG5cdCAgICB9IGVsc2Uge1xuXHQgICAgICBvYmogPSB7XG5cdCAgICAgICAgcHJlZGljYXRlOiBhcmd1bWVudHNbMF0sXG5cdCAgICAgICAgdGhpc0FyZzogYXJndW1lbnRzWzFdLFxuXHQgICAgICAgIGRlZmF1bHRWYWx1ZTogYXJndW1lbnRzWzJdXG5cdCAgICAgIH07XG5cdCAgICB9XG5cdCAgICBpZiAoaXNGdW5jdGlvbiAob2JqLnByZWRpY2F0ZSkpIHtcblx0ICAgICAgdmFyIGZuID0gb2JqLnByZWRpY2F0ZTtcblx0ICAgICAgb2JqLnByZWRpY2F0ZSA9IGJpbmRDYWxsYmFjayhmbiwgb2JqLnRoaXNBcmcsIDMpO1xuXHQgICAgfVxuXHQgICAgcmV0dXJuIG5ldyBGaXJzdE9ic2VydmFibGUodGhpcywgb2JqKTtcblx0ICB9O1xuXHRcblx0ICB2YXIgTGFzdE9ic2VydmFibGUgPSAoZnVuY3Rpb24gKF9fc3VwZXJfXykge1xuXHQgICAgaW5oZXJpdHMoTGFzdE9ic2VydmFibGUsIF9fc3VwZXJfXyk7XG5cdCAgICBmdW5jdGlvbiBMYXN0T2JzZXJ2YWJsZShzb3VyY2UsIG9iaikge1xuXHQgICAgICB0aGlzLnNvdXJjZSA9IHNvdXJjZTtcblx0ICAgICAgdGhpcy5fb2JqID0gb2JqO1xuXHQgICAgICBfX3N1cGVyX18uY2FsbCh0aGlzKTtcblx0ICAgIH1cblx0XG5cdCAgICBMYXN0T2JzZXJ2YWJsZS5wcm90b3R5cGUuc3Vic2NyaWJlQ29yZSA9IGZ1bmN0aW9uIChvKSB7XG5cdCAgICAgIHJldHVybiB0aGlzLnNvdXJjZS5zdWJzY3JpYmUobmV3IExhc3RPYnNlcnZlcihvLCB0aGlzLl9vYmosIHRoaXMuc291cmNlKSk7XG5cdCAgICB9O1xuXHRcblx0ICAgIHJldHVybiBMYXN0T2JzZXJ2YWJsZTtcblx0ICB9KE9ic2VydmFibGVCYXNlKSk7XG5cdFxuXHQgIHZhciBMYXN0T2JzZXJ2ZXIgPSAoZnVuY3Rpb24oX19zdXBlcl9fKSB7XG5cdCAgICBpbmhlcml0cyhMYXN0T2JzZXJ2ZXIsIF9fc3VwZXJfXyk7XG5cdCAgICBmdW5jdGlvbiBMYXN0T2JzZXJ2ZXIobywgb2JqLCBzKSB7XG5cdCAgICAgIHRoaXMuX28gPSBvO1xuXHQgICAgICB0aGlzLl9vYmogPSBvYmo7XG5cdCAgICAgIHRoaXMuX3MgPSBzO1xuXHQgICAgICB0aGlzLl9pID0gMDtcblx0ICAgICAgdGhpcy5faHYgPSBmYWxzZTtcblx0ICAgICAgdGhpcy5fdiA9IG51bGw7XG5cdCAgICAgIF9fc3VwZXJfXy5jYWxsKHRoaXMpO1xuXHQgICAgfVxuXHRcblx0ICAgIExhc3RPYnNlcnZlci5wcm90b3R5cGUubmV4dCA9IGZ1bmN0aW9uICh4KSB7XG5cdCAgICAgIHZhciBzaG91bGRZaWVsZCA9IGZhbHNlO1xuXHQgICAgICBpZiAodGhpcy5fb2JqLnByZWRpY2F0ZSkge1xuXHQgICAgICAgIHZhciByZXMgPSB0cnlDYXRjaCh0aGlzLl9vYmoucHJlZGljYXRlKSh4LCB0aGlzLl9pKyssIHRoaXMuX3MpO1xuXHQgICAgICAgIGlmIChyZXMgPT09IGVycm9yT2JqKSB7IHJldHVybiB0aGlzLl9vLm9uRXJyb3IocmVzLmUpOyB9XG5cdCAgICAgICAgQm9vbGVhbihyZXMpICYmIChzaG91bGRZaWVsZCA9IHRydWUpO1xuXHQgICAgICB9IGVsc2UgaWYgKCF0aGlzLl9vYmoucHJlZGljYXRlKSB7XG5cdCAgICAgICAgc2hvdWxkWWllbGQgPSB0cnVlO1xuXHQgICAgICB9XG5cdCAgICAgIGlmIChzaG91bGRZaWVsZCkge1xuXHQgICAgICAgIHRoaXMuX2h2ID0gdHJ1ZTtcblx0ICAgICAgICB0aGlzLl92ID0geDtcblx0ICAgICAgfVxuXHQgICAgfTtcblx0ICAgIExhc3RPYnNlcnZlci5wcm90b3R5cGUuZXJyb3IgPSBmdW5jdGlvbiAoZSkgeyB0aGlzLl9vLm9uRXJyb3IoZSk7IH07XG5cdCAgICBMYXN0T2JzZXJ2ZXIucHJvdG90eXBlLmNvbXBsZXRlZCA9IGZ1bmN0aW9uICgpIHtcblx0ICAgICAgaWYgKHRoaXMuX2h2KSB7XG5cdCAgICAgICAgdGhpcy5fby5vbk5leHQodGhpcy5fdik7XG5cdCAgICAgICAgdGhpcy5fby5vbkNvbXBsZXRlZCgpO1xuXHQgICAgICB9XG5cdCAgICAgIGVsc2UgaWYgKHRoaXMuX29iai5kZWZhdWx0VmFsdWUgPT09IHVuZGVmaW5lZCkge1xuXHQgICAgICAgIHRoaXMuX28ub25FcnJvcihuZXcgRW1wdHlFcnJvcigpKTtcblx0ICAgICAgfSBlbHNlIHtcblx0ICAgICAgICB0aGlzLl9vLm9uTmV4dCh0aGlzLl9vYmouZGVmYXVsdFZhbHVlKTtcblx0ICAgICAgICB0aGlzLl9vLm9uQ29tcGxldGVkKCk7XG5cdCAgICAgIH1cblx0ICAgIH07XG5cdFxuXHQgICAgcmV0dXJuIExhc3RPYnNlcnZlcjtcblx0ICB9KEFic3RyYWN0T2JzZXJ2ZXIpKTtcblx0XG5cdCAgLyoqXG5cdCAgICogUmV0dXJucyB0aGUgbGFzdCBlbGVtZW50IG9mIGFuIG9ic2VydmFibGUgc2VxdWVuY2UgdGhhdCBzYXRpc2ZpZXMgdGhlIGNvbmRpdGlvbiBpbiB0aGUgcHJlZGljYXRlIGlmIHNwZWNpZmllZCwgZWxzZSB0aGUgbGFzdCBlbGVtZW50LlxuXHQgICAqIEByZXR1cm5zIHtPYnNlcnZhYmxlfSBTZXF1ZW5jZSBjb250YWluaW5nIHRoZSBsYXN0IGVsZW1lbnQgaW4gdGhlIG9ic2VydmFibGUgc2VxdWVuY2UgdGhhdCBzYXRpc2ZpZXMgdGhlIGNvbmRpdGlvbiBpbiB0aGUgcHJlZGljYXRlLlxuXHQgICAqL1xuXHQgIG9ic2VydmFibGVQcm90by5sYXN0ID0gZnVuY3Rpb24gKCkge1xuXHQgICAgdmFyIG9iaiA9IHt9LCBzb3VyY2UgPSB0aGlzO1xuXHQgICAgaWYgKHR5cGVvZiBhcmd1bWVudHNbMF0gPT09ICdvYmplY3QnKSB7XG5cdCAgICAgIG9iaiA9IGFyZ3VtZW50c1swXTtcblx0ICAgIH0gZWxzZSB7XG5cdCAgICAgIG9iaiA9IHtcblx0ICAgICAgICBwcmVkaWNhdGU6IGFyZ3VtZW50c1swXSxcblx0ICAgICAgICB0aGlzQXJnOiBhcmd1bWVudHNbMV0sXG5cdCAgICAgICAgZGVmYXVsdFZhbHVlOiBhcmd1bWVudHNbMl1cblx0ICAgICAgfTtcblx0ICAgIH1cblx0ICAgIGlmIChpc0Z1bmN0aW9uIChvYmoucHJlZGljYXRlKSkge1xuXHQgICAgICB2YXIgZm4gPSBvYmoucHJlZGljYXRlO1xuXHQgICAgICBvYmoucHJlZGljYXRlID0gYmluZENhbGxiYWNrKGZuLCBvYmoudGhpc0FyZywgMyk7XG5cdCAgICB9XG5cdCAgICByZXR1cm4gbmV3IExhc3RPYnNlcnZhYmxlKHRoaXMsIG9iaik7XG5cdCAgfTtcblx0XG5cdCAgdmFyIEZpbmRWYWx1ZU9ic2VydmVyID0gKGZ1bmN0aW9uKF9fc3VwZXJfXykge1xuXHQgICAgaW5oZXJpdHMoRmluZFZhbHVlT2JzZXJ2ZXIsIF9fc3VwZXJfXyk7XG5cdCAgICBmdW5jdGlvbiBGaW5kVmFsdWVPYnNlcnZlcihvYnNlcnZlciwgc291cmNlLCBjYWxsYmFjaywgeWllbGRJbmRleCkge1xuXHQgICAgICB0aGlzLl9vID0gb2JzZXJ2ZXI7XG5cdCAgICAgIHRoaXMuX3MgPSBzb3VyY2U7XG5cdCAgICAgIHRoaXMuX2NiID0gY2FsbGJhY2s7XG5cdCAgICAgIHRoaXMuX3kgPSB5aWVsZEluZGV4O1xuXHQgICAgICB0aGlzLl9pID0gMDtcblx0ICAgICAgX19zdXBlcl9fLmNhbGwodGhpcyk7XG5cdCAgICB9XG5cdFxuXHQgICAgRmluZFZhbHVlT2JzZXJ2ZXIucHJvdG90eXBlLm5leHQgPSBmdW5jdGlvbiAoeCkge1xuXHQgICAgICB2YXIgc2hvdWxkUnVuID0gdHJ5Q2F0Y2godGhpcy5fY2IpKHgsIHRoaXMuX2ksIHRoaXMuX3MpO1xuXHQgICAgICBpZiAoc2hvdWxkUnVuID09PSBlcnJvck9iaikgeyByZXR1cm4gdGhpcy5fby5vbkVycm9yKHNob3VsZFJ1bi5lKTsgfVxuXHQgICAgICBpZiAoc2hvdWxkUnVuKSB7XG5cdCAgICAgICAgdGhpcy5fby5vbk5leHQodGhpcy5feSA/IHRoaXMuX2kgOiB4KTtcblx0ICAgICAgICB0aGlzLl9vLm9uQ29tcGxldGVkKCk7XG5cdCAgICAgIH0gZWxzZSB7XG5cdCAgICAgICAgdGhpcy5faSsrO1xuXHQgICAgICB9XG5cdCAgICB9O1xuXHRcblx0ICAgIEZpbmRWYWx1ZU9ic2VydmVyLnByb3RvdHlwZS5lcnJvciA9IGZ1bmN0aW9uIChlKSB7XG5cdCAgICAgIHRoaXMuX28ub25FcnJvcihlKTtcblx0ICAgIH07XG5cdFxuXHQgICAgRmluZFZhbHVlT2JzZXJ2ZXIucHJvdG90eXBlLmNvbXBsZXRlZCA9IGZ1bmN0aW9uICgpIHtcblx0ICAgICAgdGhpcy5feSAmJiB0aGlzLl9vLm9uTmV4dCgtMSk7XG5cdCAgICAgIHRoaXMuX28ub25Db21wbGV0ZWQoKTtcblx0ICAgIH07XG5cdFxuXHQgICAgcmV0dXJuIEZpbmRWYWx1ZU9ic2VydmVyO1xuXHQgIH0oQWJzdHJhY3RPYnNlcnZlcikpO1xuXHRcblx0ICBmdW5jdGlvbiBmaW5kVmFsdWUgKHNvdXJjZSwgcHJlZGljYXRlLCB0aGlzQXJnLCB5aWVsZEluZGV4KSB7XG5cdCAgICB2YXIgY2FsbGJhY2sgPSBiaW5kQ2FsbGJhY2socHJlZGljYXRlLCB0aGlzQXJnLCAzKTtcblx0ICAgIHJldHVybiBuZXcgQW5vbnltb3VzT2JzZXJ2YWJsZShmdW5jdGlvbiAobykge1xuXHQgICAgICByZXR1cm4gc291cmNlLnN1YnNjcmliZShuZXcgRmluZFZhbHVlT2JzZXJ2ZXIobywgc291cmNlLCBjYWxsYmFjaywgeWllbGRJbmRleCkpO1xuXHQgICAgfSwgc291cmNlKTtcblx0ICB9XG5cdFxuXHQgIC8qKlxuXHQgICAqIFNlYXJjaGVzIGZvciBhbiBlbGVtZW50IHRoYXQgbWF0Y2hlcyB0aGUgY29uZGl0aW9ucyBkZWZpbmVkIGJ5IHRoZSBzcGVjaWZpZWQgcHJlZGljYXRlLCBhbmQgcmV0dXJucyB0aGUgZmlyc3Qgb2NjdXJyZW5jZSB3aXRoaW4gdGhlIGVudGlyZSBPYnNlcnZhYmxlIHNlcXVlbmNlLlxuXHQgICAqIEBwYXJhbSB7RnVuY3Rpb259IHByZWRpY2F0ZSBUaGUgcHJlZGljYXRlIHRoYXQgZGVmaW5lcyB0aGUgY29uZGl0aW9ucyBvZiB0aGUgZWxlbWVudCB0byBzZWFyY2ggZm9yLlxuXHQgICAqIEBwYXJhbSB7QW55fSBbdGhpc0FyZ10gT2JqZWN0IHRvIHVzZSBhcyBgdGhpc2Agd2hlbiBleGVjdXRpbmcgdGhlIHByZWRpY2F0ZS5cblx0ICAgKiBAcmV0dXJucyB7T2JzZXJ2YWJsZX0gQW4gT2JzZXJ2YWJsZSBzZXF1ZW5jZSB3aXRoIHRoZSBmaXJzdCBlbGVtZW50IHRoYXQgbWF0Y2hlcyB0aGUgY29uZGl0aW9ucyBkZWZpbmVkIGJ5IHRoZSBzcGVjaWZpZWQgcHJlZGljYXRlLCBpZiBmb3VuZDsgb3RoZXJ3aXNlLCB1bmRlZmluZWQuXG5cdCAgICovXG5cdCAgb2JzZXJ2YWJsZVByb3RvLmZpbmQgPSBmdW5jdGlvbiAocHJlZGljYXRlLCB0aGlzQXJnKSB7XG5cdCAgICByZXR1cm4gZmluZFZhbHVlKHRoaXMsIHByZWRpY2F0ZSwgdGhpc0FyZywgZmFsc2UpO1xuXHQgIH07XG5cdFxuXHQgIC8qKlxuXHQgICAqIFNlYXJjaGVzIGZvciBhbiBlbGVtZW50IHRoYXQgbWF0Y2hlcyB0aGUgY29uZGl0aW9ucyBkZWZpbmVkIGJ5IHRoZSBzcGVjaWZpZWQgcHJlZGljYXRlLCBhbmQgcmV0dXJuc1xuXHQgICAqIGFuIE9ic2VydmFibGUgc2VxdWVuY2Ugd2l0aCB0aGUgemVyby1iYXNlZCBpbmRleCBvZiB0aGUgZmlyc3Qgb2NjdXJyZW5jZSB3aXRoaW4gdGhlIGVudGlyZSBPYnNlcnZhYmxlIHNlcXVlbmNlLlxuXHQgICAqIEBwYXJhbSB7RnVuY3Rpb259IHByZWRpY2F0ZSBUaGUgcHJlZGljYXRlIHRoYXQgZGVmaW5lcyB0aGUgY29uZGl0aW9ucyBvZiB0aGUgZWxlbWVudCB0byBzZWFyY2ggZm9yLlxuXHQgICAqIEBwYXJhbSB7QW55fSBbdGhpc0FyZ10gT2JqZWN0IHRvIHVzZSBhcyBgdGhpc2Agd2hlbiBleGVjdXRpbmcgdGhlIHByZWRpY2F0ZS5cblx0ICAgKiBAcmV0dXJucyB7T2JzZXJ2YWJsZX0gQW4gT2JzZXJ2YWJsZSBzZXF1ZW5jZSB3aXRoIHRoZSB6ZXJvLWJhc2VkIGluZGV4IG9mIHRoZSBmaXJzdCBvY2N1cnJlbmNlIG9mIGFuIGVsZW1lbnQgdGhhdCBtYXRjaGVzIHRoZSBjb25kaXRpb25zIGRlZmluZWQgYnkgbWF0Y2gsIGlmIGZvdW5kOyBvdGhlcndpc2UsIOKAkzEuXG5cdCAgKi9cblx0ICBvYnNlcnZhYmxlUHJvdG8uZmluZEluZGV4ID0gZnVuY3Rpb24gKHByZWRpY2F0ZSwgdGhpc0FyZykge1xuXHQgICAgcmV0dXJuIGZpbmRWYWx1ZSh0aGlzLCBwcmVkaWNhdGUsIHRoaXNBcmcsIHRydWUpO1xuXHQgIH07XG5cdFxuXHQgIHZhciBUb1NldE9ic2VydmFibGUgPSAoZnVuY3Rpb24gKF9fc3VwZXJfXykge1xuXHQgICAgaW5oZXJpdHMoVG9TZXRPYnNlcnZhYmxlLCBfX3N1cGVyX18pO1xuXHQgICAgZnVuY3Rpb24gVG9TZXRPYnNlcnZhYmxlKHNvdXJjZSkge1xuXHQgICAgICB0aGlzLnNvdXJjZSA9IHNvdXJjZTtcblx0ICAgICAgX19zdXBlcl9fLmNhbGwodGhpcyk7XG5cdCAgICB9XG5cdFxuXHQgICAgVG9TZXRPYnNlcnZhYmxlLnByb3RvdHlwZS5zdWJzY3JpYmVDb3JlID0gZnVuY3Rpb24gKG8pIHtcblx0ICAgICAgcmV0dXJuIHRoaXMuc291cmNlLnN1YnNjcmliZShuZXcgVG9TZXRPYnNlcnZlcihvKSk7XG5cdCAgICB9O1xuXHRcblx0ICAgIHJldHVybiBUb1NldE9ic2VydmFibGU7XG5cdCAgfShPYnNlcnZhYmxlQmFzZSkpO1xuXHRcblx0ICB2YXIgVG9TZXRPYnNlcnZlciA9IChmdW5jdGlvbiAoX19zdXBlcl9fKSB7XG5cdCAgICBpbmhlcml0cyhUb1NldE9ic2VydmVyLCBfX3N1cGVyX18pO1xuXHQgICAgZnVuY3Rpb24gVG9TZXRPYnNlcnZlcihvKSB7XG5cdCAgICAgIHRoaXMuX28gPSBvO1xuXHQgICAgICB0aGlzLl9zID0gbmV3IHJvb3QuU2V0KCk7XG5cdCAgICAgIF9fc3VwZXJfXy5jYWxsKHRoaXMpO1xuXHQgICAgfVxuXHRcblx0ICAgIFRvU2V0T2JzZXJ2ZXIucHJvdG90eXBlLm5leHQgPSBmdW5jdGlvbiAoeCkge1xuXHQgICAgICB0aGlzLl9zLmFkZCh4KTtcblx0ICAgIH07XG5cdFxuXHQgICAgVG9TZXRPYnNlcnZlci5wcm90b3R5cGUuZXJyb3IgPSBmdW5jdGlvbiAoZSkge1xuXHQgICAgICB0aGlzLl9vLm9uRXJyb3IoZSk7XG5cdCAgICB9O1xuXHRcblx0ICAgIFRvU2V0T2JzZXJ2ZXIucHJvdG90eXBlLmNvbXBsZXRlZCA9IGZ1bmN0aW9uICgpIHtcblx0ICAgICAgdGhpcy5fby5vbk5leHQodGhpcy5fcyk7XG5cdCAgICAgIHRoaXMuX28ub25Db21wbGV0ZWQoKTtcblx0ICAgIH07XG5cdFxuXHQgICAgcmV0dXJuIFRvU2V0T2JzZXJ2ZXI7XG5cdCAgfShBYnN0cmFjdE9ic2VydmVyKSk7XG5cdFxuXHQgIC8qKlxuXHQgICAqIENvbnZlcnRzIHRoZSBvYnNlcnZhYmxlIHNlcXVlbmNlIHRvIGEgU2V0IGlmIGl0IGV4aXN0cy5cblx0ICAgKiBAcmV0dXJucyB7T2JzZXJ2YWJsZX0gQW4gb2JzZXJ2YWJsZSBzZXF1ZW5jZSB3aXRoIGEgc2luZ2xlIHZhbHVlIG9mIGEgU2V0IGNvbnRhaW5pbmcgdGhlIHZhbHVlcyBmcm9tIHRoZSBvYnNlcnZhYmxlIHNlcXVlbmNlLlxuXHQgICAqL1xuXHQgIG9ic2VydmFibGVQcm90by50b1NldCA9IGZ1bmN0aW9uICgpIHtcblx0ICAgIGlmICh0eXBlb2Ygcm9vdC5TZXQgPT09ICd1bmRlZmluZWQnKSB7IHRocm93IG5ldyBUeXBlRXJyb3IoKTsgfVxuXHQgICAgcmV0dXJuIG5ldyBUb1NldE9ic2VydmFibGUodGhpcyk7XG5cdCAgfTtcblx0XG5cdCAgdmFyIFRvTWFwT2JzZXJ2YWJsZSA9IChmdW5jdGlvbiAoX19zdXBlcl9fKSB7XG5cdCAgICBpbmhlcml0cyhUb01hcE9ic2VydmFibGUsIF9fc3VwZXJfXyk7XG5cdCAgICBmdW5jdGlvbiBUb01hcE9ic2VydmFibGUoc291cmNlLCBrLCBlKSB7XG5cdCAgICAgIHRoaXMuc291cmNlID0gc291cmNlO1xuXHQgICAgICB0aGlzLl9rID0gaztcblx0ICAgICAgdGhpcy5fZSA9IGU7XG5cdCAgICAgIF9fc3VwZXJfXy5jYWxsKHRoaXMpO1xuXHQgICAgfVxuXHRcblx0ICAgIFRvTWFwT2JzZXJ2YWJsZS5wcm90b3R5cGUuc3Vic2NyaWJlQ29yZSA9IGZ1bmN0aW9uIChvKSB7XG5cdCAgICAgIHJldHVybiB0aGlzLnNvdXJjZS5zdWJzY3JpYmUobmV3IFRvTWFwT2JzZXJ2ZXIobywgdGhpcy5faywgdGhpcy5fZSkpO1xuXHQgICAgfTtcblx0XG5cdCAgICByZXR1cm4gVG9NYXBPYnNlcnZhYmxlO1xuXHQgIH0oT2JzZXJ2YWJsZUJhc2UpKTtcblx0XG5cdCAgdmFyIFRvTWFwT2JzZXJ2ZXIgPSAoZnVuY3Rpb24gKF9fc3VwZXJfXykge1xuXHQgICAgaW5oZXJpdHMoVG9NYXBPYnNlcnZlciwgX19zdXBlcl9fKTtcblx0ICAgIGZ1bmN0aW9uIFRvTWFwT2JzZXJ2ZXIobywgaywgZSkge1xuXHQgICAgICB0aGlzLl9vID0gbztcblx0ICAgICAgdGhpcy5fayA9IGs7XG5cdCAgICAgIHRoaXMuX2UgPSBlO1xuXHQgICAgICB0aGlzLl9tID0gbmV3IHJvb3QuTWFwKCk7XG5cdCAgICAgIF9fc3VwZXJfXy5jYWxsKHRoaXMpO1xuXHQgICAgfVxuXHRcblx0ICAgIFRvTWFwT2JzZXJ2ZXIucHJvdG90eXBlLm5leHQgPSBmdW5jdGlvbiAoeCkge1xuXHQgICAgICB2YXIga2V5ID0gdHJ5Q2F0Y2godGhpcy5faykoeCk7XG5cdCAgICAgIGlmIChrZXkgPT09IGVycm9yT2JqKSB7IHJldHVybiB0aGlzLl9vLm9uRXJyb3Ioa2V5LmUpOyB9XG5cdCAgICAgIHZhciBlbGVtID0geDtcblx0ICAgICAgaWYgKHRoaXMuX2UpIHtcblx0ICAgICAgICBlbGVtID0gdHJ5Q2F0Y2godGhpcy5fZSkoeCk7XG5cdCAgICAgICAgaWYgKGVsZW0gPT09IGVycm9yT2JqKSB7IHJldHVybiB0aGlzLl9vLm9uRXJyb3IoZWxlbS5lKTsgfVxuXHQgICAgICB9XG5cdFxuXHQgICAgICB0aGlzLl9tLnNldChrZXksIGVsZW0pO1xuXHQgICAgfTtcblx0XG5cdCAgICBUb01hcE9ic2VydmVyLnByb3RvdHlwZS5lcnJvciA9IGZ1bmN0aW9uIChlKSB7XG5cdCAgICAgIHRoaXMuX28ub25FcnJvcihlKTtcblx0ICAgIH07XG5cdFxuXHQgICAgVG9NYXBPYnNlcnZlci5wcm90b3R5cGUuY29tcGxldGVkID0gZnVuY3Rpb24gKCkge1xuXHQgICAgICB0aGlzLl9vLm9uTmV4dCh0aGlzLl9tKTtcblx0ICAgICAgdGhpcy5fby5vbkNvbXBsZXRlZCgpO1xuXHQgICAgfTtcblx0XG5cdCAgICByZXR1cm4gVG9NYXBPYnNlcnZlcjtcblx0ICB9KEFic3RyYWN0T2JzZXJ2ZXIpKTtcblx0XG5cdCAgLyoqXG5cdCAgKiBDb252ZXJ0cyB0aGUgb2JzZXJ2YWJsZSBzZXF1ZW5jZSB0byBhIE1hcCBpZiBpdCBleGlzdHMuXG5cdCAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBrZXlTZWxlY3RvciBBIGZ1bmN0aW9uIHdoaWNoIHByb2R1Y2VzIHRoZSBrZXkgZm9yIHRoZSBNYXAuXG5cdCAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBbZWxlbWVudFNlbGVjdG9yXSBBbiBvcHRpb25hbCBmdW5jdGlvbiB3aGljaCBwcm9kdWNlcyB0aGUgZWxlbWVudCBmb3IgdGhlIE1hcC4gSWYgbm90IHByZXNlbnQsIGRlZmF1bHRzIHRvIHRoZSB2YWx1ZSBmcm9tIHRoZSBvYnNlcnZhYmxlIHNlcXVlbmNlLlxuXHQgICogQHJldHVybnMge09ic2VydmFibGV9IEFuIG9ic2VydmFibGUgc2VxdWVuY2Ugd2l0aCBhIHNpbmdsZSB2YWx1ZSBvZiBhIE1hcCBjb250YWluaW5nIHRoZSB2YWx1ZXMgZnJvbSB0aGUgb2JzZXJ2YWJsZSBzZXF1ZW5jZS5cblx0ICAqL1xuXHQgIG9ic2VydmFibGVQcm90by50b01hcCA9IGZ1bmN0aW9uIChrZXlTZWxlY3RvciwgZWxlbWVudFNlbGVjdG9yKSB7XG5cdCAgICBpZiAodHlwZW9mIHJvb3QuTWFwID09PSAndW5kZWZpbmVkJykgeyB0aHJvdyBuZXcgVHlwZUVycm9yKCk7IH1cblx0ICAgIHJldHVybiBuZXcgVG9NYXBPYnNlcnZhYmxlKHRoaXMsIGtleVNlbGVjdG9yLCBlbGVtZW50U2VsZWN0b3IpO1xuXHQgIH07XG5cdFxuXHQgIHZhciBTbGljZU9ic2VydmFibGUgPSAoZnVuY3Rpb24gKF9fc3VwZXJfXykge1xuXHQgICAgaW5oZXJpdHMoU2xpY2VPYnNlcnZhYmxlLCBfX3N1cGVyX18pO1xuXHQgICAgZnVuY3Rpb24gU2xpY2VPYnNlcnZhYmxlKHNvdXJjZSwgYiwgZSkge1xuXHQgICAgICB0aGlzLnNvdXJjZSA9IHNvdXJjZTtcblx0ICAgICAgdGhpcy5fYiA9IGI7XG5cdCAgICAgIHRoaXMuX2UgPSBlO1xuXHQgICAgICBfX3N1cGVyX18uY2FsbCh0aGlzKTtcblx0ICAgIH1cblx0XG5cdCAgICBTbGljZU9ic2VydmFibGUucHJvdG90eXBlLnN1YnNjcmliZUNvcmUgPSBmdW5jdGlvbiAobykge1xuXHQgICAgICByZXR1cm4gdGhpcy5zb3VyY2Uuc3Vic2NyaWJlKG5ldyBTbGljZU9ic2VydmVyKG8sIHRoaXMuX2IsIHRoaXMuX2UpKTtcblx0ICAgIH07XG5cdFxuXHQgICAgcmV0dXJuIFNsaWNlT2JzZXJ2YWJsZTtcblx0ICB9KE9ic2VydmFibGVCYXNlKSk7XG5cdFxuXHQgIHZhciBTbGljZU9ic2VydmVyID0gKGZ1bmN0aW9uIChfX3N1cGVyX18pIHtcblx0ICAgIGluaGVyaXRzKFNsaWNlT2JzZXJ2ZXIsIF9fc3VwZXJfXyk7XG5cdFxuXHQgICAgZnVuY3Rpb24gU2xpY2VPYnNlcnZlcihvLCBiLCBlKSB7XG5cdCAgICAgIHRoaXMuX28gPSBvO1xuXHQgICAgICB0aGlzLl9iID0gYjtcblx0ICAgICAgdGhpcy5fZSA9IGU7XG5cdCAgICAgIHRoaXMuX2kgPSAwO1xuXHQgICAgICBfX3N1cGVyX18uY2FsbCh0aGlzKTtcblx0ICAgIH1cblx0XG5cdCAgICBTbGljZU9ic2VydmVyLnByb3RvdHlwZS5uZXh0ID0gZnVuY3Rpb24gKHgpIHtcblx0ICAgICAgaWYgKHRoaXMuX2kgPj0gdGhpcy5fYikge1xuXHQgICAgICAgIGlmICh0aGlzLl9lID09PSB0aGlzLl9pKSB7XG5cdCAgICAgICAgICB0aGlzLl9vLm9uQ29tcGxldGVkKCk7XG5cdCAgICAgICAgfSBlbHNlIHtcblx0ICAgICAgICAgIHRoaXMuX28ub25OZXh0KHgpO1xuXHQgICAgICAgIH1cblx0ICAgICAgfVxuXHQgICAgICB0aGlzLl9pKys7XG5cdCAgICB9O1xuXHQgICAgU2xpY2VPYnNlcnZlci5wcm90b3R5cGUuZXJyb3IgPSBmdW5jdGlvbiAoZSkgeyB0aGlzLl9vLm9uRXJyb3IoZSk7IH07XG5cdCAgICBTbGljZU9ic2VydmVyLnByb3RvdHlwZS5jb21wbGV0ZWQgPSBmdW5jdGlvbiAoKSB7IHRoaXMuX28ub25Db21wbGV0ZWQoKTsgfTtcblx0XG5cdCAgICByZXR1cm4gU2xpY2VPYnNlcnZlcjtcblx0ICB9KEFic3RyYWN0T2JzZXJ2ZXIpKTtcblx0XG5cdCAgLypcblx0ICAqIFRoZSBzbGljZSgpIG1ldGhvZCByZXR1cm5zIGEgc2hhbGxvdyBjb3B5IG9mIGEgcG9ydGlvbiBvZiBhbiBPYnNlcnZhYmxlIGludG8gYSBuZXcgT2JzZXJ2YWJsZSBvYmplY3QuXG5cdCAgKiBVbmxpa2UgdGhlIGFycmF5IHZlcnNpb24sIHRoaXMgZG9lcyBub3Qgc3VwcG9ydCBuZWdhdGl2ZSBudW1iZXJzIGZvciBiZWluZyBvciBlbmQuXG5cdCAgKiBAcGFyYW0ge051bWJlcn0gW2JlZ2luXSBaZXJvLWJhc2VkIGluZGV4IGF0IHdoaWNoIHRvIGJlZ2luIGV4dHJhY3Rpb24uIElmIG9taXR0ZWQsIHRoaXMgd2lsbCBkZWZhdWx0IHRvIHplcm8uXG5cdCAgKiBAcGFyYW0ge051bWJlcn0gW2VuZF0gWmVyby1iYXNlZCBpbmRleCBhdCB3aGljaCB0byBlbmQgZXh0cmFjdGlvbi4gc2xpY2UgZXh0cmFjdHMgdXAgdG8gYnV0IG5vdCBpbmNsdWRpbmcgZW5kLlxuXHQgICogSWYgb21pdHRlZCwgdGhpcyB3aWxsIGVtaXQgdGhlIHJlc3Qgb2YgdGhlIE9ic2VydmFibGUgb2JqZWN0LlxuXHQgICogQHJldHVybnMge09ic2VydmFibGV9IEEgc2hhbGxvdyBjb3B5IG9mIGEgcG9ydGlvbiBvZiBhbiBPYnNlcnZhYmxlIGludG8gYSBuZXcgT2JzZXJ2YWJsZSBvYmplY3QuXG5cdCAgKi9cblx0ICBvYnNlcnZhYmxlUHJvdG8uc2xpY2UgPSBmdW5jdGlvbiAoYmVnaW4sIGVuZCkge1xuXHQgICAgdmFyIHN0YXJ0ID0gYmVnaW4gfHwgMDtcblx0ICAgIGlmIChzdGFydCA8IDApIHsgdGhyb3cgbmV3IFJ4LkFyZ3VtZW50T3V0T2ZSYW5nZUVycm9yKCk7IH1cblx0ICAgIGlmICh0eXBlb2YgZW5kID09PSAnbnVtYmVyJyAmJiBlbmQgPCBzdGFydCkge1xuXHQgICAgICB0aHJvdyBuZXcgUnguQXJndW1lbnRPdXRPZlJhbmdlRXJyb3IoKTtcblx0ICAgIH1cblx0ICAgIHJldHVybiBuZXcgU2xpY2VPYnNlcnZhYmxlKHRoaXMsIHN0YXJ0LCBlbmQpO1xuXHQgIH07XG5cdFxuXHQgIHZhciBMYXN0SW5kZXhPZk9ic2VydmFibGUgPSAoZnVuY3Rpb24gKF9fc3VwZXJfXykge1xuXHQgICAgaW5oZXJpdHMoTGFzdEluZGV4T2ZPYnNlcnZhYmxlLCBfX3N1cGVyX18pO1xuXHQgICAgZnVuY3Rpb24gTGFzdEluZGV4T2ZPYnNlcnZhYmxlKHNvdXJjZSwgZSwgbikge1xuXHQgICAgICB0aGlzLnNvdXJjZSA9IHNvdXJjZTtcblx0ICAgICAgdGhpcy5fZSA9IGU7XG5cdCAgICAgIHRoaXMuX24gPSBuO1xuXHQgICAgICBfX3N1cGVyX18uY2FsbCh0aGlzKTtcblx0ICAgIH1cblx0XG5cdCAgICBMYXN0SW5kZXhPZk9ic2VydmFibGUucHJvdG90eXBlLnN1YnNjcmliZUNvcmUgPSBmdW5jdGlvbiAobykge1xuXHQgICAgICBpZiAodGhpcy5fbiA8IDApIHtcblx0ICAgICAgICBvLm9uTmV4dCgtMSk7XG5cdCAgICAgICAgby5vbkNvbXBsZXRlZCgpO1xuXHQgICAgICAgIHJldHVybiBkaXNwb3NhYmxlRW1wdHk7XG5cdCAgICAgIH1cblx0XG5cdCAgICAgIHJldHVybiB0aGlzLnNvdXJjZS5zdWJzY3JpYmUobmV3IExhc3RJbmRleE9mT2JzZXJ2ZXIobywgdGhpcy5fZSwgdGhpcy5fbikpO1xuXHQgICAgfTtcblx0XG5cdCAgICByZXR1cm4gTGFzdEluZGV4T2ZPYnNlcnZhYmxlO1xuXHQgIH0oT2JzZXJ2YWJsZUJhc2UpKTtcblx0XG5cdCAgdmFyIExhc3RJbmRleE9mT2JzZXJ2ZXIgPSAoZnVuY3Rpb24gKF9fc3VwZXJfXykge1xuXHQgICAgaW5oZXJpdHMoTGFzdEluZGV4T2ZPYnNlcnZlciwgX19zdXBlcl9fKTtcblx0ICAgIGZ1bmN0aW9uIExhc3RJbmRleE9mT2JzZXJ2ZXIobywgZSwgbikge1xuXHQgICAgICB0aGlzLl9vID0gbztcblx0ICAgICAgdGhpcy5fZSA9IGU7XG5cdCAgICAgIHRoaXMuX24gPSBuO1xuXHQgICAgICB0aGlzLl92ID0gMDtcblx0ICAgICAgdGhpcy5faHYgPSBmYWxzZTtcblx0ICAgICAgdGhpcy5faSA9IDA7XG5cdCAgICAgIF9fc3VwZXJfXy5jYWxsKHRoaXMpO1xuXHQgICAgfVxuXHRcblx0ICAgIExhc3RJbmRleE9mT2JzZXJ2ZXIucHJvdG90eXBlLm5leHQgPSBmdW5jdGlvbiAoeCkge1xuXHQgICAgICBpZiAodGhpcy5faSA+PSB0aGlzLl9uICYmIHggPT09IHRoaXMuX2UpIHtcblx0ICAgICAgICB0aGlzLl9odiA9IHRydWU7XG5cdCAgICAgICAgdGhpcy5fdiA9IHRoaXMuX2k7XG5cdCAgICAgIH1cblx0ICAgICAgdGhpcy5faSsrO1xuXHQgICAgfTtcblx0ICAgIExhc3RJbmRleE9mT2JzZXJ2ZXIucHJvdG90eXBlLmVycm9yID0gZnVuY3Rpb24gKGUpIHsgdGhpcy5fby5vbkVycm9yKGUpOyB9O1xuXHQgICAgTGFzdEluZGV4T2ZPYnNlcnZlci5wcm90b3R5cGUuY29tcGxldGVkID0gZnVuY3Rpb24gKCkge1xuXHQgICAgICBpZiAodGhpcy5faHYpIHtcblx0ICAgICAgICB0aGlzLl9vLm9uTmV4dCh0aGlzLl92KTtcblx0ICAgICAgfSBlbHNlIHtcblx0ICAgICAgICB0aGlzLl9vLm9uTmV4dCgtMSk7XG5cdCAgICAgIH1cblx0ICAgICAgdGhpcy5fby5vbkNvbXBsZXRlZCgpO1xuXHQgICAgfTtcblx0XG5cdCAgICByZXR1cm4gTGFzdEluZGV4T2ZPYnNlcnZlcjtcblx0ICB9KEFic3RyYWN0T2JzZXJ2ZXIpKTtcblx0XG5cdCAgLyoqXG5cdCAgICogUmV0dXJucyB0aGUgbGFzdCBpbmRleCBhdCB3aGljaCBhIGdpdmVuIGVsZW1lbnQgY2FuIGJlIGZvdW5kIGluIHRoZSBvYnNlcnZhYmxlIHNlcXVlbmNlLCBvciAtMSBpZiBpdCBpcyBub3QgcHJlc2VudC5cblx0ICAgKiBAcGFyYW0ge0FueX0gc2VhcmNoRWxlbWVudCBFbGVtZW50IHRvIGxvY2F0ZSBpbiB0aGUgYXJyYXkuXG5cdCAgICogQHBhcmFtIHtOdW1iZXJ9IFtmcm9tSW5kZXhdIFRoZSBpbmRleCB0byBzdGFydCB0aGUgc2VhcmNoLiAgSWYgbm90IHNwZWNpZmllZCwgZGVmYXVsdHMgdG8gMC5cblx0ICAgKiBAcmV0dXJucyB7T2JzZXJ2YWJsZX0gQW5kIG9ic2VydmFibGUgc2VxdWVuY2UgY29udGFpbmluZyB0aGUgbGFzdCBpbmRleCBhdCB3aGljaCBhIGdpdmVuIGVsZW1lbnQgY2FuIGJlIGZvdW5kIGluIHRoZSBvYnNlcnZhYmxlIHNlcXVlbmNlLCBvciAtMSBpZiBpdCBpcyBub3QgcHJlc2VudC5cblx0ICAgKi9cblx0ICBvYnNlcnZhYmxlUHJvdG8ubGFzdEluZGV4T2YgPSBmdW5jdGlvbihzZWFyY2hFbGVtZW50LCBmcm9tSW5kZXgpIHtcblx0ICAgIHZhciBuID0gK2Zyb21JbmRleCB8fCAwO1xuXHQgICAgTWF0aC5hYnMobikgPT09IEluZmluaXR5ICYmIChuID0gMCk7XG5cdCAgICByZXR1cm4gbmV3IExhc3RJbmRleE9mT2JzZXJ2YWJsZSh0aGlzLCBzZWFyY2hFbGVtZW50LCBuKTtcblx0ICB9O1xuXHRcblx0ICBPYnNlcnZhYmxlLndyYXAgPSBmdW5jdGlvbiAoZm4pIHtcblx0ICAgIGNyZWF0ZU9ic2VydmFibGUuX19nZW5lcmF0b3JGdW5jdGlvbl9fID0gZm47XG5cdCAgICByZXR1cm4gY3JlYXRlT2JzZXJ2YWJsZTtcblx0XG5cdCAgICBmdW5jdGlvbiBjcmVhdGVPYnNlcnZhYmxlKCkge1xuXHQgICAgICByZXR1cm4gT2JzZXJ2YWJsZS5zcGF3bi5jYWxsKHRoaXMsIGZuLmFwcGx5KHRoaXMsIGFyZ3VtZW50cykpO1xuXHQgICAgfVxuXHQgIH07XG5cdFxuXHQgIHZhciBzcGF3biA9IE9ic2VydmFibGUuc3Bhd24gPSBmdW5jdGlvbiAoKSB7XG5cdCAgICB2YXIgZ2VuID0gYXJndW1lbnRzWzBdLCBzZWxmID0gdGhpcywgYXJncyA9IFtdO1xuXHQgICAgZm9yICh2YXIgaSA9IDEsIGxlbiA9IGFyZ3VtZW50cy5sZW5ndGg7IGkgPCBsZW47IGkrKykgeyBhcmdzLnB1c2goYXJndW1lbnRzW2ldKTsgfVxuXHRcblx0ICAgIHJldHVybiBuZXcgQW5vbnltb3VzT2JzZXJ2YWJsZShmdW5jdGlvbiAobykge1xuXHQgICAgICB2YXIgZyA9IG5ldyBDb21wb3NpdGVEaXNwb3NhYmxlKCk7XG5cdFxuXHQgICAgICBpZiAoaXNGdW5jdGlvbihnZW4pKSB7IGdlbiA9IGdlbi5hcHBseShzZWxmLCBhcmdzKTsgfVxuXHQgICAgICBpZiAoIWdlbiB8fCAhaXNGdW5jdGlvbihnZW4ubmV4dCkpIHtcblx0ICAgICAgICBvLm9uTmV4dChnZW4pO1xuXHQgICAgICAgIHJldHVybiBvLm9uQ29tcGxldGVkKCk7XG5cdCAgICAgIH1cblx0XG5cdCAgICAgIHByb2Nlc3NHZW5lcmF0b3IoKTtcblx0XG5cdCAgICAgIGZ1bmN0aW9uIHByb2Nlc3NHZW5lcmF0b3IocmVzKSB7XG5cdCAgICAgICAgdmFyIHJldCA9IHRyeUNhdGNoKGdlbi5uZXh0KS5jYWxsKGdlbiwgcmVzKTtcblx0ICAgICAgICBpZiAocmV0ID09PSBlcnJvck9iaikgeyByZXR1cm4gby5vbkVycm9yKHJldC5lKTsgfVxuXHQgICAgICAgIG5leHQocmV0KTtcblx0ICAgICAgfVxuXHRcblx0ICAgICAgZnVuY3Rpb24gb25FcnJvcihlcnIpIHtcblx0ICAgICAgICB2YXIgcmV0ID0gdHJ5Q2F0Y2goZ2VuLm5leHQpLmNhbGwoZ2VuLCBlcnIpO1xuXHQgICAgICAgIGlmIChyZXQgPT09IGVycm9yT2JqKSB7IHJldHVybiBvLm9uRXJyb3IocmV0LmUpOyB9XG5cdCAgICAgICAgbmV4dChyZXQpO1xuXHQgICAgICB9XG5cdFxuXHQgICAgICBmdW5jdGlvbiBuZXh0KHJldCkge1xuXHQgICAgICAgIGlmIChyZXQuZG9uZSkge1xuXHQgICAgICAgICAgby5vbk5leHQocmV0LnZhbHVlKTtcblx0ICAgICAgICAgIG8ub25Db21wbGV0ZWQoKTtcblx0ICAgICAgICAgIHJldHVybjtcblx0ICAgICAgICB9XG5cdCAgICAgICAgdmFyIHZhbHVlID0gdG9PYnNlcnZhYmxlLmNhbGwoc2VsZiwgcmV0LnZhbHVlKTtcblx0ICAgICAgICBpZiAoT2JzZXJ2YWJsZS5pc09ic2VydmFibGUodmFsdWUpKSB7XG5cdCAgICAgICAgICBnLmFkZCh2YWx1ZS5zdWJzY3JpYmUocHJvY2Vzc0dlbmVyYXRvciwgb25FcnJvcikpO1xuXHQgICAgICAgIH0gZWxzZSB7XG5cdCAgICAgICAgICBvbkVycm9yKG5ldyBUeXBlRXJyb3IoJ3R5cGUgbm90IHN1cHBvcnRlZCcpKTtcblx0ICAgICAgICB9XG5cdCAgICAgIH1cblx0XG5cdCAgICAgIHJldHVybiBnO1xuXHQgICAgfSk7XG5cdCAgfTtcblx0XG5cdCAgZnVuY3Rpb24gdG9PYnNlcnZhYmxlKG9iaikge1xuXHQgICAgaWYgKCFvYmopIHsgcmV0dXJuIG9iajsgfVxuXHQgICAgaWYgKE9ic2VydmFibGUuaXNPYnNlcnZhYmxlKG9iaikpIHsgcmV0dXJuIG9iajsgfVxuXHQgICAgaWYgKGlzUHJvbWlzZShvYmopKSB7IHJldHVybiBPYnNlcnZhYmxlLmZyb21Qcm9taXNlKG9iaik7IH1cblx0ICAgIGlmIChpc0dlbmVyYXRvckZ1bmN0aW9uKG9iaikgfHwgaXNHZW5lcmF0b3Iob2JqKSkgeyByZXR1cm4gc3Bhd24uY2FsbCh0aGlzLCBvYmopOyB9XG5cdCAgICBpZiAoaXNGdW5jdGlvbihvYmopKSB7IHJldHVybiB0aHVua1RvT2JzZXJ2YWJsZS5jYWxsKHRoaXMsIG9iaik7IH1cblx0ICAgIGlmIChpc0FycmF5TGlrZShvYmopIHx8IGlzSXRlcmFibGUob2JqKSkgeyByZXR1cm4gYXJyYXlUb09ic2VydmFibGUuY2FsbCh0aGlzLCBvYmopOyB9XG5cdCAgICBpZiAoaXNPYmplY3Qob2JqKSkge3JldHVybiBvYmplY3RUb09ic2VydmFibGUuY2FsbCh0aGlzLCBvYmopO31cblx0ICAgIHJldHVybiBvYmo7XG5cdCAgfVxuXHRcblx0ICBmdW5jdGlvbiBhcnJheVRvT2JzZXJ2YWJsZSAob2JqKSB7XG5cdCAgICByZXR1cm4gT2JzZXJ2YWJsZS5mcm9tKG9iailcblx0ICAgICAgICAuZmxhdE1hcCh0b09ic2VydmFibGUpXG5cdCAgICAgICAgLnRvQXJyYXkoKTtcblx0ICB9XG5cdFxuXHQgIGZ1bmN0aW9uIG9iamVjdFRvT2JzZXJ2YWJsZSAob2JqKSB7XG5cdCAgICB2YXIgcmVzdWx0cyA9IG5ldyBvYmouY29uc3RydWN0b3IoKSwga2V5cyA9IE9iamVjdC5rZXlzKG9iaiksIG9ic2VydmFibGVzID0gW107XG5cdCAgICBmb3IgKHZhciBpID0gMCwgbGVuID0ga2V5cy5sZW5ndGg7IGkgPCBsZW47IGkrKykge1xuXHQgICAgICB2YXIga2V5ID0ga2V5c1tpXTtcblx0ICAgICAgdmFyIG9ic2VydmFibGUgPSB0b09ic2VydmFibGUuY2FsbCh0aGlzLCBvYmpba2V5XSk7XG5cdFxuXHQgICAgICBpZihvYnNlcnZhYmxlICYmIE9ic2VydmFibGUuaXNPYnNlcnZhYmxlKG9ic2VydmFibGUpKSB7XG5cdCAgICAgICAgZGVmZXIob2JzZXJ2YWJsZSwga2V5KTtcblx0ICAgICAgfSBlbHNlIHtcblx0ICAgICAgICByZXN1bHRzW2tleV0gPSBvYmpba2V5XTtcblx0ICAgICAgfVxuXHQgICAgfVxuXHRcblx0ICAgIHJldHVybiBPYnNlcnZhYmxlLmZvcmtKb2luLmFwcGx5KE9ic2VydmFibGUsIG9ic2VydmFibGVzKS5tYXAoZnVuY3Rpb24oKSB7XG5cdCAgICAgIHJldHVybiByZXN1bHRzO1xuXHQgICAgfSk7XG5cdFxuXHRcblx0ICAgIGZ1bmN0aW9uIGRlZmVyIChvYnNlcnZhYmxlLCBrZXkpIHtcblx0ICAgICAgcmVzdWx0c1trZXldID0gdW5kZWZpbmVkO1xuXHQgICAgICBvYnNlcnZhYmxlcy5wdXNoKG9ic2VydmFibGUubWFwKGZ1bmN0aW9uIChuZXh0KSB7XG5cdCAgICAgICAgcmVzdWx0c1trZXldID0gbmV4dDtcblx0ICAgICAgfSkpO1xuXHQgICAgfVxuXHQgIH1cblx0XG5cdCAgZnVuY3Rpb24gdGh1bmtUb09ic2VydmFibGUoZm4pIHtcblx0ICAgIHZhciBzZWxmID0gdGhpcztcblx0ICAgIHJldHVybiBuZXcgQW5vbnltb3VzT2JzZXJ2YWJsZShmdW5jdGlvbiAobykge1xuXHQgICAgICBmbi5jYWxsKHNlbGYsIGZ1bmN0aW9uICgpIHtcblx0ICAgICAgICB2YXIgZXJyID0gYXJndW1lbnRzWzBdLCByZXMgPSBhcmd1bWVudHNbMV07XG5cdCAgICAgICAgaWYgKGVycikgeyByZXR1cm4gby5vbkVycm9yKGVycik7IH1cblx0ICAgICAgICBpZiAoYXJndW1lbnRzLmxlbmd0aCA+IDIpIHtcblx0ICAgICAgICAgIHZhciBhcmdzID0gW107XG5cdCAgICAgICAgICBmb3IgKHZhciBpID0gMSwgbGVuID0gYXJndW1lbnRzLmxlbmd0aDsgaSA8IGxlbjsgaSsrKSB7IGFyZ3MucHVzaChhcmd1bWVudHNbaV0pOyB9XG5cdCAgICAgICAgICByZXMgPSBhcmdzO1xuXHQgICAgICAgIH1cblx0ICAgICAgICBvLm9uTmV4dChyZXMpO1xuXHQgICAgICAgIG8ub25Db21wbGV0ZWQoKTtcblx0ICAgICAgfSk7XG5cdCAgICB9KTtcblx0ICB9XG5cdFxuXHQgIGZ1bmN0aW9uIGlzR2VuZXJhdG9yKG9iaikge1xuXHQgICAgcmV0dXJuIGlzRnVuY3Rpb24gKG9iai5uZXh0KSAmJiBpc0Z1bmN0aW9uIChvYmoudGhyb3cpO1xuXHQgIH1cblx0XG5cdCAgZnVuY3Rpb24gaXNHZW5lcmF0b3JGdW5jdGlvbihvYmopIHtcblx0ICAgIHZhciBjdG9yID0gb2JqLmNvbnN0cnVjdG9yO1xuXHQgICAgaWYgKCFjdG9yKSB7IHJldHVybiBmYWxzZTsgfVxuXHQgICAgaWYgKGN0b3IubmFtZSA9PT0gJ0dlbmVyYXRvckZ1bmN0aW9uJyB8fCBjdG9yLmRpc3BsYXlOYW1lID09PSAnR2VuZXJhdG9yRnVuY3Rpb24nKSB7IHJldHVybiB0cnVlOyB9XG5cdCAgICByZXR1cm4gaXNHZW5lcmF0b3IoY3Rvci5wcm90b3R5cGUpO1xuXHQgIH1cblx0XG5cdCAgZnVuY3Rpb24gaXNPYmplY3QodmFsKSB7XG5cdCAgICByZXR1cm4gT2JqZWN0ID09IHZhbC5jb25zdHJ1Y3Rvcjtcblx0ICB9XG5cdFxuXHQgIC8qKlxuXHQgICAqIEludm9rZXMgdGhlIHNwZWNpZmllZCBmdW5jdGlvbiBhc3luY2hyb25vdXNseSBvbiB0aGUgc3BlY2lmaWVkIHNjaGVkdWxlciwgc3VyZmFjaW5nIHRoZSByZXN1bHQgdGhyb3VnaCBhbiBvYnNlcnZhYmxlIHNlcXVlbmNlLlxuXHQgICAqXG5cdCAgICogQGV4YW1wbGVcblx0ICAgKiB2YXIgcmVzID0gUnguT2JzZXJ2YWJsZS5zdGFydChmdW5jdGlvbiAoKSB7IGNvbnNvbGUubG9nKCdoZWxsbycpOyB9KTtcblx0ICAgKiB2YXIgcmVzID0gUnguT2JzZXJ2YWJsZS5zdGFydChmdW5jdGlvbiAoKSB7IGNvbnNvbGUubG9nKCdoZWxsbycpOyB9LCBSeC5TY2hlZHVsZXIudGltZW91dCk7XG5cdCAgICogdmFyIHJlcyA9IFJ4Lk9ic2VydmFibGUuc3RhcnQoZnVuY3Rpb24gKCkgeyB0aGlzLmxvZygnaGVsbG8nKTsgfSwgUnguU2NoZWR1bGVyLnRpbWVvdXQsIGNvbnNvbGUpO1xuXHQgICAqXG5cdCAgICogQHBhcmFtIHtGdW5jdGlvbn0gZnVuYyBGdW5jdGlvbiB0byBydW4gYXN5bmNocm9ub3VzbHkuXG5cdCAgICogQHBhcmFtIHtTY2hlZHVsZXJ9IFtzY2hlZHVsZXJdICBTY2hlZHVsZXIgdG8gcnVuIHRoZSBmdW5jdGlvbiBvbi4gSWYgbm90IHNwZWNpZmllZCwgZGVmYXVsdHMgdG8gU2NoZWR1bGVyLnRpbWVvdXQuXG5cdCAgICogQHBhcmFtIFtjb250ZXh0XSAgVGhlIGNvbnRleHQgZm9yIHRoZSBmdW5jIHBhcmFtZXRlciB0byBiZSBleGVjdXRlZC4gIElmIG5vdCBzcGVjaWZpZWQsIGRlZmF1bHRzIHRvIHVuZGVmaW5lZC5cblx0ICAgKiBAcmV0dXJucyB7T2JzZXJ2YWJsZX0gQW4gb2JzZXJ2YWJsZSBzZXF1ZW5jZSBleHBvc2luZyB0aGUgZnVuY3Rpb24ncyByZXN1bHQgdmFsdWUsIG9yIGFuIGV4Y2VwdGlvbi5cblx0ICAgKlxuXHQgICAqIFJlbWFya3Ncblx0ICAgKiAqIFRoZSBmdW5jdGlvbiBpcyBjYWxsZWQgaW1tZWRpYXRlbHksIG5vdCBkdXJpbmcgdGhlIHN1YnNjcmlwdGlvbiBvZiB0aGUgcmVzdWx0aW5nIHNlcXVlbmNlLlxuXHQgICAqICogTXVsdGlwbGUgc3Vic2NyaXB0aW9ucyB0byB0aGUgcmVzdWx0aW5nIHNlcXVlbmNlIGNhbiBvYnNlcnZlIHRoZSBmdW5jdGlvbidzIHJlc3VsdC5cblx0ICAgKi9cblx0ICBPYnNlcnZhYmxlLnN0YXJ0ID0gZnVuY3Rpb24gKGZ1bmMsIGNvbnRleHQsIHNjaGVkdWxlcikge1xuXHQgICAgcmV0dXJuIG9ic2VydmFibGVUb0FzeW5jKGZ1bmMsIGNvbnRleHQsIHNjaGVkdWxlcikoKTtcblx0ICB9O1xuXHRcblx0ICAvKipcblx0ICAgKiBDb252ZXJ0cyB0aGUgZnVuY3Rpb24gaW50byBhbiBhc3luY2hyb25vdXMgZnVuY3Rpb24uIEVhY2ggaW52b2NhdGlvbiBvZiB0aGUgcmVzdWx0aW5nIGFzeW5jaHJvbm91cyBmdW5jdGlvbiBjYXVzZXMgYW4gaW52b2NhdGlvbiBvZiB0aGUgb3JpZ2luYWwgc3luY2hyb25vdXMgZnVuY3Rpb24gb24gdGhlIHNwZWNpZmllZCBzY2hlZHVsZXIuXG5cdCAgICogQHBhcmFtIHtGdW5jdGlvbn0gZnVuY3Rpb24gRnVuY3Rpb24gdG8gY29udmVydCB0byBhbiBhc3luY2hyb25vdXMgZnVuY3Rpb24uXG5cdCAgICogQHBhcmFtIHtTY2hlZHVsZXJ9IFtzY2hlZHVsZXJdIFNjaGVkdWxlciB0byBydW4gdGhlIGZ1bmN0aW9uIG9uLiBJZiBub3Qgc3BlY2lmaWVkLCBkZWZhdWx0cyB0byBTY2hlZHVsZXIudGltZW91dC5cblx0ICAgKiBAcGFyYW0ge01peGVkfSBbY29udGV4dF0gVGhlIGNvbnRleHQgZm9yIHRoZSBmdW5jIHBhcmFtZXRlciB0byBiZSBleGVjdXRlZC4gIElmIG5vdCBzcGVjaWZpZWQsIGRlZmF1bHRzIHRvIHVuZGVmaW5lZC5cblx0ICAgKiBAcmV0dXJucyB7RnVuY3Rpb259IEFzeW5jaHJvbm91cyBmdW5jdGlvbi5cblx0ICAgKi9cblx0ICB2YXIgb2JzZXJ2YWJsZVRvQXN5bmMgPSBPYnNlcnZhYmxlLnRvQXN5bmMgPSBmdW5jdGlvbiAoZnVuYywgY29udGV4dCwgc2NoZWR1bGVyKSB7XG5cdCAgICBpc1NjaGVkdWxlcihzY2hlZHVsZXIpIHx8IChzY2hlZHVsZXIgPSBkZWZhdWx0U2NoZWR1bGVyKTtcblx0ICAgIHJldHVybiBmdW5jdGlvbiAoKSB7XG5cdCAgICAgIHZhciBhcmdzID0gYXJndW1lbnRzLFxuXHQgICAgICAgIHN1YmplY3QgPSBuZXcgQXN5bmNTdWJqZWN0KCk7XG5cdFxuXHQgICAgICBzY2hlZHVsZXIuc2NoZWR1bGUobnVsbCwgZnVuY3Rpb24gKCkge1xuXHQgICAgICAgIHZhciByZXN1bHQ7XG5cdCAgICAgICAgdHJ5IHtcblx0ICAgICAgICAgIHJlc3VsdCA9IGZ1bmMuYXBwbHkoY29udGV4dCwgYXJncyk7XG5cdCAgICAgICAgfSBjYXRjaCAoZSkge1xuXHQgICAgICAgICAgc3ViamVjdC5vbkVycm9yKGUpO1xuXHQgICAgICAgICAgcmV0dXJuO1xuXHQgICAgICAgIH1cblx0ICAgICAgICBzdWJqZWN0Lm9uTmV4dChyZXN1bHQpO1xuXHQgICAgICAgIHN1YmplY3Qub25Db21wbGV0ZWQoKTtcblx0ICAgICAgfSk7XG5cdCAgICAgIHJldHVybiBzdWJqZWN0LmFzT2JzZXJ2YWJsZSgpO1xuXHQgICAgfTtcblx0ICB9O1xuXHRcblx0ZnVuY3Rpb24gY3JlYXRlQ2JPYnNlcnZhYmxlKGZuLCBjdHgsIHNlbGVjdG9yLCBhcmdzKSB7XG5cdCAgdmFyIG8gPSBuZXcgQXN5bmNTdWJqZWN0KCk7XG5cdFxuXHQgIGFyZ3MucHVzaChjcmVhdGVDYkhhbmRsZXIobywgY3R4LCBzZWxlY3RvcikpO1xuXHQgIGZuLmFwcGx5KGN0eCwgYXJncyk7XG5cdFxuXHQgIHJldHVybiBvLmFzT2JzZXJ2YWJsZSgpO1xuXHR9XG5cdFxuXHRmdW5jdGlvbiBjcmVhdGVDYkhhbmRsZXIobywgY3R4LCBzZWxlY3Rvcikge1xuXHQgIHJldHVybiBmdW5jdGlvbiBoYW5kbGVyICgpIHtcblx0ICAgIHZhciBsZW4gPSBhcmd1bWVudHMubGVuZ3RoLCByZXN1bHRzID0gbmV3IEFycmF5KGxlbik7XG5cdCAgICBmb3IodmFyIGkgPSAwOyBpIDwgbGVuOyBpKyspIHsgcmVzdWx0c1tpXSA9IGFyZ3VtZW50c1tpXTsgfVxuXHRcblx0ICAgIGlmIChpc0Z1bmN0aW9uKHNlbGVjdG9yKSkge1xuXHQgICAgICByZXN1bHRzID0gdHJ5Q2F0Y2goc2VsZWN0b3IpLmFwcGx5KGN0eCwgcmVzdWx0cyk7XG5cdCAgICAgIGlmIChyZXN1bHRzID09PSBlcnJvck9iaikgeyByZXR1cm4gby5vbkVycm9yKHJlc3VsdHMuZSk7IH1cblx0ICAgICAgby5vbk5leHQocmVzdWx0cyk7XG5cdCAgICB9IGVsc2Uge1xuXHQgICAgICBpZiAocmVzdWx0cy5sZW5ndGggPD0gMSkge1xuXHQgICAgICAgIG8ub25OZXh0KHJlc3VsdHNbMF0pO1xuXHQgICAgICB9IGVsc2Uge1xuXHQgICAgICAgIG8ub25OZXh0KHJlc3VsdHMpO1xuXHQgICAgICB9XG5cdCAgICB9XG5cdFxuXHQgICAgby5vbkNvbXBsZXRlZCgpO1xuXHQgIH07XG5cdH1cblx0XG5cdC8qKlxuXHQgKiBDb252ZXJ0cyBhIGNhbGxiYWNrIGZ1bmN0aW9uIHRvIGFuIG9ic2VydmFibGUgc2VxdWVuY2UuXG5cdCAqXG5cdCAqIEBwYXJhbSB7RnVuY3Rpb259IGZuIEZ1bmN0aW9uIHdpdGggYSBjYWxsYmFjayBhcyB0aGUgbGFzdCBwYXJhbWV0ZXIgdG8gY29udmVydCB0byBhbiBPYnNlcnZhYmxlIHNlcXVlbmNlLlxuXHQgKiBAcGFyYW0ge01peGVkfSBbY3R4XSBUaGUgY29udGV4dCBmb3IgdGhlIGZ1bmMgcGFyYW1ldGVyIHRvIGJlIGV4ZWN1dGVkLiAgSWYgbm90IHNwZWNpZmllZCwgZGVmYXVsdHMgdG8gdW5kZWZpbmVkLlxuXHQgKiBAcGFyYW0ge0Z1bmN0aW9ufSBbc2VsZWN0b3JdIEEgc2VsZWN0b3Igd2hpY2ggdGFrZXMgdGhlIGFyZ3VtZW50cyBmcm9tIHRoZSBjYWxsYmFjayB0byBwcm9kdWNlIGEgc2luZ2xlIGl0ZW0gdG8geWllbGQgb24gbmV4dC5cblx0ICogQHJldHVybnMge0Z1bmN0aW9ufSBBIGZ1bmN0aW9uLCB3aGVuIGV4ZWN1dGVkIHdpdGggdGhlIHJlcXVpcmVkIHBhcmFtZXRlcnMgbWludXMgdGhlIGNhbGxiYWNrLCBwcm9kdWNlcyBhbiBPYnNlcnZhYmxlIHNlcXVlbmNlIHdpdGggYSBzaW5nbGUgdmFsdWUgb2YgdGhlIGFyZ3VtZW50cyB0byB0aGUgY2FsbGJhY2sgYXMgYW4gYXJyYXkuXG5cdCAqL1xuXHRPYnNlcnZhYmxlLmZyb21DYWxsYmFjayA9IGZ1bmN0aW9uIChmbiwgY3R4LCBzZWxlY3Rvcikge1xuXHQgIHJldHVybiBmdW5jdGlvbiAoKSB7XG5cdCAgICB0eXBlb2YgY3R4ID09PSAndW5kZWZpbmVkJyAmJiAoY3R4ID0gdGhpcyk7IFxuXHRcblx0ICAgIHZhciBsZW4gPSBhcmd1bWVudHMubGVuZ3RoLCBhcmdzID0gbmV3IEFycmF5KGxlbilcblx0ICAgIGZvcih2YXIgaSA9IDA7IGkgPCBsZW47IGkrKykgeyBhcmdzW2ldID0gYXJndW1lbnRzW2ldOyB9XG5cdCAgICByZXR1cm4gY3JlYXRlQ2JPYnNlcnZhYmxlKGZuLCBjdHgsIHNlbGVjdG9yLCBhcmdzKTtcblx0ICB9O1xuXHR9O1xuXHRcblx0ZnVuY3Rpb24gY3JlYXRlTm9kZU9ic2VydmFibGUoZm4sIGN0eCwgc2VsZWN0b3IsIGFyZ3MpIHtcblx0ICB2YXIgbyA9IG5ldyBBc3luY1N1YmplY3QoKTtcblx0XG5cdCAgYXJncy5wdXNoKGNyZWF0ZU5vZGVIYW5kbGVyKG8sIGN0eCwgc2VsZWN0b3IpKTtcblx0ICBmbi5hcHBseShjdHgsIGFyZ3MpO1xuXHRcblx0ICByZXR1cm4gby5hc09ic2VydmFibGUoKTtcblx0fVxuXHRcblx0ZnVuY3Rpb24gY3JlYXRlTm9kZUhhbmRsZXIobywgY3R4LCBzZWxlY3Rvcikge1xuXHQgIHJldHVybiBmdW5jdGlvbiBoYW5kbGVyICgpIHtcblx0ICAgIHZhciBlcnIgPSBhcmd1bWVudHNbMF07XG5cdCAgICBpZiAoZXJyKSB7IHJldHVybiBvLm9uRXJyb3IoZXJyKTsgfVxuXHRcblx0ICAgIHZhciBsZW4gPSBhcmd1bWVudHMubGVuZ3RoLCByZXN1bHRzID0gW107XG5cdCAgICBmb3IodmFyIGkgPSAxOyBpIDwgbGVuOyBpKyspIHsgcmVzdWx0c1tpIC0gMV0gPSBhcmd1bWVudHNbaV07IH1cblx0XG5cdCAgICBpZiAoaXNGdW5jdGlvbihzZWxlY3RvcikpIHtcblx0ICAgICAgdmFyIHJlc3VsdHMgPSB0cnlDYXRjaChzZWxlY3RvcikuYXBwbHkoY3R4LCByZXN1bHRzKTtcblx0ICAgICAgaWYgKHJlc3VsdHMgPT09IGVycm9yT2JqKSB7IHJldHVybiBvLm9uRXJyb3IocmVzdWx0cy5lKTsgfVxuXHQgICAgICBvLm9uTmV4dChyZXN1bHRzKTtcblx0ICAgIH0gZWxzZSB7XG5cdCAgICAgIGlmIChyZXN1bHRzLmxlbmd0aCA8PSAxKSB7XG5cdCAgICAgICAgby5vbk5leHQocmVzdWx0c1swXSk7XG5cdCAgICAgIH0gZWxzZSB7XG5cdCAgICAgICAgby5vbk5leHQocmVzdWx0cyk7XG5cdCAgICAgIH1cblx0ICAgIH1cblx0XG5cdCAgICBvLm9uQ29tcGxldGVkKCk7XG5cdCAgfTtcblx0fVxuXHRcblx0LyoqXG5cdCAqIENvbnZlcnRzIGEgTm9kZS5qcyBjYWxsYmFjayBzdHlsZSBmdW5jdGlvbiB0byBhbiBvYnNlcnZhYmxlIHNlcXVlbmNlLiAgVGhpcyBtdXN0IGJlIGluIGZ1bmN0aW9uIChlcnIsIC4uLikgZm9ybWF0LlxuXHQgKiBAcGFyYW0ge0Z1bmN0aW9ufSBmbiBUaGUgZnVuY3Rpb24gdG8gY2FsbFxuXHQgKiBAcGFyYW0ge01peGVkfSBbY3R4XSBUaGUgY29udGV4dCBmb3IgdGhlIGZ1bmMgcGFyYW1ldGVyIHRvIGJlIGV4ZWN1dGVkLiAgSWYgbm90IHNwZWNpZmllZCwgZGVmYXVsdHMgdG8gdW5kZWZpbmVkLlxuXHQgKiBAcGFyYW0ge0Z1bmN0aW9ufSBbc2VsZWN0b3JdIEEgc2VsZWN0b3Igd2hpY2ggdGFrZXMgdGhlIGFyZ3VtZW50cyBmcm9tIHRoZSBjYWxsYmFjayBtaW51cyB0aGUgZXJyb3IgdG8gcHJvZHVjZSBhIHNpbmdsZSBpdGVtIHRvIHlpZWxkIG9uIG5leHQuXG5cdCAqIEByZXR1cm5zIHtGdW5jdGlvbn0gQW4gYXN5bmMgZnVuY3Rpb24gd2hpY2ggd2hlbiBhcHBsaWVkLCByZXR1cm5zIGFuIG9ic2VydmFibGUgc2VxdWVuY2Ugd2l0aCB0aGUgY2FsbGJhY2sgYXJndW1lbnRzIGFzIGFuIGFycmF5LlxuXHQgKi9cblx0T2JzZXJ2YWJsZS5mcm9tTm9kZUNhbGxiYWNrID0gZnVuY3Rpb24gKGZuLCBjdHgsIHNlbGVjdG9yKSB7XG5cdCAgcmV0dXJuIGZ1bmN0aW9uICgpIHtcblx0ICAgIHR5cGVvZiBjdHggPT09ICd1bmRlZmluZWQnICYmIChjdHggPSB0aGlzKTsgXG5cdCAgICB2YXIgbGVuID0gYXJndW1lbnRzLmxlbmd0aCwgYXJncyA9IG5ldyBBcnJheShsZW4pO1xuXHQgICAgZm9yKHZhciBpID0gMDsgaSA8IGxlbjsgaSsrKSB7IGFyZ3NbaV0gPSBhcmd1bWVudHNbaV07IH1cblx0ICAgIHJldHVybiBjcmVhdGVOb2RlT2JzZXJ2YWJsZShmbiwgY3R4LCBzZWxlY3RvciwgYXJncyk7XG5cdCAgfTtcblx0fTtcblx0XG5cdCAgZnVuY3Rpb24gTGlzdGVuRGlzcG9zYWJsZShlLCBuLCBmbikge1xuXHQgICAgdGhpcy5fZSA9IGU7XG5cdCAgICB0aGlzLl9uID0gbjtcblx0ICAgIHRoaXMuX2ZuID0gZm47XG5cdCAgICB0aGlzLl9lLmFkZEV2ZW50TGlzdGVuZXIodGhpcy5fbiwgdGhpcy5fZm4sIGZhbHNlKTtcblx0ICAgIHRoaXMuaXNEaXNwb3NlZCA9IGZhbHNlO1xuXHQgIH1cblx0ICBMaXN0ZW5EaXNwb3NhYmxlLnByb3RvdHlwZS5kaXNwb3NlID0gZnVuY3Rpb24gKCkge1xuXHQgICAgaWYgKCF0aGlzLmlzRGlzcG9zZWQpIHtcblx0ICAgICAgdGhpcy5fZS5yZW1vdmVFdmVudExpc3RlbmVyKHRoaXMuX24sIHRoaXMuX2ZuLCBmYWxzZSk7XG5cdCAgICAgIHRoaXMuaXNEaXNwb3NlZCA9IHRydWU7XG5cdCAgICB9XG5cdCAgfTtcblx0XG5cdCAgZnVuY3Rpb24gY3JlYXRlRXZlbnRMaXN0ZW5lciAoZWwsIGV2ZW50TmFtZSwgaGFuZGxlcikge1xuXHQgICAgdmFyIGRpc3Bvc2FibGVzID0gbmV3IENvbXBvc2l0ZURpc3Bvc2FibGUoKTtcblx0XG5cdCAgICAvLyBBc3VtZSBOb2RlTGlzdCBvciBIVE1MQ29sbGVjdGlvblxuXHQgICAgdmFyIGVsZW1Ub1N0cmluZyA9IE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbChlbCk7XG5cdCAgICBpZiAoZWxlbVRvU3RyaW5nID09PSAnW29iamVjdCBOb2RlTGlzdF0nIHx8IGVsZW1Ub1N0cmluZyA9PT0gJ1tvYmplY3QgSFRNTENvbGxlY3Rpb25dJykge1xuXHQgICAgICBmb3IgKHZhciBpID0gMCwgbGVuID0gZWwubGVuZ3RoOyBpIDwgbGVuOyBpKyspIHtcblx0ICAgICAgICBkaXNwb3NhYmxlcy5hZGQoY3JlYXRlRXZlbnRMaXN0ZW5lcihlbC5pdGVtKGkpLCBldmVudE5hbWUsIGhhbmRsZXIpKTtcblx0ICAgICAgfVxuXHQgICAgfSBlbHNlIGlmIChlbCkge1xuXHQgICAgICBkaXNwb3NhYmxlcy5hZGQobmV3IExpc3RlbkRpc3Bvc2FibGUoZWwsIGV2ZW50TmFtZSwgaGFuZGxlcikpO1xuXHQgICAgfVxuXHRcblx0ICAgIHJldHVybiBkaXNwb3NhYmxlcztcblx0ICB9XG5cdFxuXHQgIC8qKlxuXHQgICAqIENvbmZpZ3VyYXRpb24gb3B0aW9uIHRvIGRldGVybWluZSB3aGV0aGVyIHRvIHVzZSBuYXRpdmUgZXZlbnRzIG9ubHlcblx0ICAgKi9cblx0ICBSeC5jb25maWcudXNlTmF0aXZlRXZlbnRzID0gZmFsc2U7XG5cdFxuXHQgIGZ1bmN0aW9uIGV2ZW50SGFuZGxlcihvLCBzZWxlY3Rvcikge1xuXHQgICAgcmV0dXJuIGZ1bmN0aW9uIGhhbmRsZXIgKCkge1xuXHQgICAgICB2YXIgcmVzdWx0cyA9IGFyZ3VtZW50c1swXTtcblx0ICAgICAgaWYgKGlzRnVuY3Rpb24oc2VsZWN0b3IpKSB7XG5cdCAgICAgICAgcmVzdWx0cyA9IHRyeUNhdGNoKHNlbGVjdG9yKS5hcHBseShudWxsLCBhcmd1bWVudHMpO1xuXHQgICAgICAgIGlmIChyZXN1bHRzID09PSBlcnJvck9iaikgeyByZXR1cm4gby5vbkVycm9yKHJlc3VsdHMuZSk7IH1cblx0ICAgICAgfVxuXHQgICAgICBvLm9uTmV4dChyZXN1bHRzKTtcblx0ICAgIH07XG5cdCAgfVxuXHRcblx0ICAvKipcblx0ICAgKiBDcmVhdGVzIGFuIG9ic2VydmFibGUgc2VxdWVuY2UgYnkgYWRkaW5nIGFuIGV2ZW50IGxpc3RlbmVyIHRvIHRoZSBtYXRjaGluZyBET01FbGVtZW50IG9yIGVhY2ggaXRlbSBpbiB0aGUgTm9kZUxpc3QuXG5cdCAgICogQHBhcmFtIHtPYmplY3R9IGVsZW1lbnQgVGhlIERPTUVsZW1lbnQgb3IgTm9kZUxpc3QgdG8gYXR0YWNoIGEgbGlzdGVuZXIuXG5cdCAgICogQHBhcmFtIHtTdHJpbmd9IGV2ZW50TmFtZSBUaGUgZXZlbnQgbmFtZSB0byBhdHRhY2ggdGhlIG9ic2VydmFibGUgc2VxdWVuY2UuXG5cdCAgICogQHBhcmFtIHtGdW5jdGlvbn0gW3NlbGVjdG9yXSBBIHNlbGVjdG9yIHdoaWNoIHRha2VzIHRoZSBhcmd1bWVudHMgZnJvbSB0aGUgZXZlbnQgaGFuZGxlciB0byBwcm9kdWNlIGEgc2luZ2xlIGl0ZW0gdG8geWllbGQgb24gbmV4dC5cblx0ICAgKiBAcmV0dXJucyB7T2JzZXJ2YWJsZX0gQW4gb2JzZXJ2YWJsZSBzZXF1ZW5jZSBvZiBldmVudHMgZnJvbSB0aGUgc3BlY2lmaWVkIGVsZW1lbnQgYW5kIHRoZSBzcGVjaWZpZWQgZXZlbnQuXG5cdCAgICovXG5cdCAgT2JzZXJ2YWJsZS5mcm9tRXZlbnQgPSBmdW5jdGlvbiAoZWxlbWVudCwgZXZlbnROYW1lLCBzZWxlY3Rvcikge1xuXHQgICAgLy8gTm9kZS5qcyBzcGVjaWZpY1xuXHQgICAgaWYgKGVsZW1lbnQuYWRkTGlzdGVuZXIpIHtcblx0ICAgICAgcmV0dXJuIGZyb21FdmVudFBhdHRlcm4oXG5cdCAgICAgICAgZnVuY3Rpb24gKGgpIHsgZWxlbWVudC5hZGRMaXN0ZW5lcihldmVudE5hbWUsIGgpOyB9LFxuXHQgICAgICAgIGZ1bmN0aW9uIChoKSB7IGVsZW1lbnQucmVtb3ZlTGlzdGVuZXIoZXZlbnROYW1lLCBoKTsgfSxcblx0ICAgICAgICBzZWxlY3Rvcik7XG5cdCAgICB9XG5cdFxuXHQgICAgLy8gVXNlIG9ubHkgaWYgbm9uLW5hdGl2ZSBldmVudHMgYXJlIGFsbG93ZWRcblx0ICAgIGlmICghUnguY29uZmlnLnVzZU5hdGl2ZUV2ZW50cykge1xuXHQgICAgICAvLyBIYW5kbGVzIGpxLCBBbmd1bGFyLmpzLCBaZXB0bywgTWFyaW9uZXR0ZSwgRW1iZXIuanNcblx0ICAgICAgaWYgKHR5cGVvZiBlbGVtZW50Lm9uID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZiBlbGVtZW50Lm9mZiA9PT0gJ2Z1bmN0aW9uJykge1xuXHQgICAgICAgIHJldHVybiBmcm9tRXZlbnRQYXR0ZXJuKFxuXHQgICAgICAgICAgZnVuY3Rpb24gKGgpIHsgZWxlbWVudC5vbihldmVudE5hbWUsIGgpOyB9LFxuXHQgICAgICAgICAgZnVuY3Rpb24gKGgpIHsgZWxlbWVudC5vZmYoZXZlbnROYW1lLCBoKTsgfSxcblx0ICAgICAgICAgIHNlbGVjdG9yKTtcblx0ICAgICAgfVxuXHQgICAgfVxuXHRcblx0ICAgIHJldHVybiBuZXcgQW5vbnltb3VzT2JzZXJ2YWJsZShmdW5jdGlvbiAobykge1xuXHQgICAgICByZXR1cm4gY3JlYXRlRXZlbnRMaXN0ZW5lcihcblx0ICAgICAgICBlbGVtZW50LFxuXHQgICAgICAgIGV2ZW50TmFtZSxcblx0ICAgICAgICBldmVudEhhbmRsZXIobywgc2VsZWN0b3IpKTtcblx0ICAgIH0pLnB1Ymxpc2goKS5yZWZDb3VudCgpO1xuXHQgIH07XG5cdFxuXHQgIC8qKlxuXHQgICAqIENyZWF0ZXMgYW4gb2JzZXJ2YWJsZSBzZXF1ZW5jZSBmcm9tIGFuIGV2ZW50IGVtaXR0ZXIgdmlhIGFuIGFkZEhhbmRsZXIvcmVtb3ZlSGFuZGxlciBwYWlyLlxuXHQgICAqIEBwYXJhbSB7RnVuY3Rpb259IGFkZEhhbmRsZXIgVGhlIGZ1bmN0aW9uIHRvIGFkZCBhIGhhbmRsZXIgdG8gdGhlIGVtaXR0ZXIuXG5cdCAgICogQHBhcmFtIHtGdW5jdGlvbn0gW3JlbW92ZUhhbmRsZXJdIFRoZSBvcHRpb25hbCBmdW5jdGlvbiB0byByZW1vdmUgYSBoYW5kbGVyIGZyb20gYW4gZW1pdHRlci5cblx0ICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBbc2VsZWN0b3JdIEEgc2VsZWN0b3Igd2hpY2ggdGFrZXMgdGhlIGFyZ3VtZW50cyBmcm9tIHRoZSBldmVudCBoYW5kbGVyIHRvIHByb2R1Y2UgYSBzaW5nbGUgaXRlbSB0byB5aWVsZCBvbiBuZXh0LlxuXHQgICAqIEBwYXJhbSB7U2NoZWR1bGVyfSBbc2NoZWR1bGVyXSBBIHNjaGVkdWxlciB1c2VkIHRvIHNjaGVkdWxlIHRoZSByZW1vdmUgaGFuZGxlci5cblx0ICAgKiBAcmV0dXJucyB7T2JzZXJ2YWJsZX0gQW4gb2JzZXJ2YWJsZSBzZXF1ZW5jZSB3aGljaCB3cmFwcyBhbiBldmVudCBmcm9tIGFuIGV2ZW50IGVtaXR0ZXJcblx0ICAgKi9cblx0ICB2YXIgZnJvbUV2ZW50UGF0dGVybiA9IE9ic2VydmFibGUuZnJvbUV2ZW50UGF0dGVybiA9IGZ1bmN0aW9uIChhZGRIYW5kbGVyLCByZW1vdmVIYW5kbGVyLCBzZWxlY3Rvciwgc2NoZWR1bGVyKSB7XG5cdCAgICBpc1NjaGVkdWxlcihzY2hlZHVsZXIpIHx8IChzY2hlZHVsZXIgPSBpbW1lZGlhdGVTY2hlZHVsZXIpO1xuXHQgICAgcmV0dXJuIG5ldyBBbm9ueW1vdXNPYnNlcnZhYmxlKGZ1bmN0aW9uIChvKSB7XG5cdCAgICAgIGZ1bmN0aW9uIGlubmVySGFuZGxlciAoKSB7XG5cdCAgICAgICAgdmFyIHJlc3VsdCA9IGFyZ3VtZW50c1swXTtcblx0ICAgICAgICBpZiAoaXNGdW5jdGlvbihzZWxlY3RvcikpIHtcblx0ICAgICAgICAgIHJlc3VsdCA9IHRyeUNhdGNoKHNlbGVjdG9yKS5hcHBseShudWxsLCBhcmd1bWVudHMpO1xuXHQgICAgICAgICAgaWYgKHJlc3VsdCA9PT0gZXJyb3JPYmopIHsgcmV0dXJuIG8ub25FcnJvcihyZXN1bHQuZSk7IH1cblx0ICAgICAgICB9XG5cdCAgICAgICAgby5vbk5leHQocmVzdWx0KTtcblx0ICAgICAgfVxuXHRcblx0ICAgICAgdmFyIHJldHVyblZhbHVlID0gYWRkSGFuZGxlcihpbm5lckhhbmRsZXIpO1xuXHQgICAgICByZXR1cm4gZGlzcG9zYWJsZUNyZWF0ZShmdW5jdGlvbiAoKSB7XG5cdCAgICAgICAgaXNGdW5jdGlvbihyZW1vdmVIYW5kbGVyKSAmJiByZW1vdmVIYW5kbGVyKGlubmVySGFuZGxlciwgcmV0dXJuVmFsdWUpO1xuXHQgICAgICB9KTtcblx0ICAgIH0pLnB1Ymxpc2goKS5yZWZDb3VudCgpO1xuXHQgIH07XG5cdFxuXHQgIC8qKlxuXHQgICAqIEludm9rZXMgdGhlIGFzeW5jaHJvbm91cyBmdW5jdGlvbiwgc3VyZmFjaW5nIHRoZSByZXN1bHQgdGhyb3VnaCBhbiBvYnNlcnZhYmxlIHNlcXVlbmNlLlxuXHQgICAqIEBwYXJhbSB7RnVuY3Rpb259IGZ1bmN0aW9uQXN5bmMgQXN5bmNocm9ub3VzIGZ1bmN0aW9uIHdoaWNoIHJldHVybnMgYSBQcm9taXNlIHRvIHJ1bi5cblx0ICAgKiBAcmV0dXJucyB7T2JzZXJ2YWJsZX0gQW4gb2JzZXJ2YWJsZSBzZXF1ZW5jZSBleHBvc2luZyB0aGUgZnVuY3Rpb24ncyByZXN1bHQgdmFsdWUsIG9yIGFuIGV4Y2VwdGlvbi5cblx0ICAgKi9cblx0ICBPYnNlcnZhYmxlLnN0YXJ0QXN5bmMgPSBmdW5jdGlvbiAoZnVuY3Rpb25Bc3luYykge1xuXHQgICAgdmFyIHByb21pc2UgPSB0cnlDYXRjaChmdW5jdGlvbkFzeW5jKSgpO1xuXHQgICAgaWYgKHByb21pc2UgPT09IGVycm9yT2JqKSB7IHJldHVybiBvYnNlcnZhYmxlVGhyb3cocHJvbWlzZS5lKTsgfVxuXHQgICAgcmV0dXJuIG9ic2VydmFibGVGcm9tUHJvbWlzZShwcm9taXNlKTtcblx0ICB9O1xuXHRcblx0ICB2YXIgUGF1c2FibGVPYnNlcnZhYmxlID0gKGZ1bmN0aW9uIChfX3N1cGVyX18pIHtcblx0ICAgIGluaGVyaXRzKFBhdXNhYmxlT2JzZXJ2YWJsZSwgX19zdXBlcl9fKTtcblx0ICAgIGZ1bmN0aW9uIFBhdXNhYmxlT2JzZXJ2YWJsZShzb3VyY2UsIHBhdXNlcikge1xuXHQgICAgICB0aGlzLnNvdXJjZSA9IHNvdXJjZTtcblx0ICAgICAgdGhpcy5jb250cm9sbGVyID0gbmV3IFN1YmplY3QoKTtcblx0XG5cdCAgICAgIGlmIChwYXVzZXIgJiYgcGF1c2VyLnN1YnNjcmliZSkge1xuXHQgICAgICAgIHRoaXMucGF1c2VyID0gdGhpcy5jb250cm9sbGVyLm1lcmdlKHBhdXNlcik7XG5cdCAgICAgIH0gZWxzZSB7XG5cdCAgICAgICAgdGhpcy5wYXVzZXIgPSB0aGlzLmNvbnRyb2xsZXI7XG5cdCAgICAgIH1cblx0XG5cdCAgICAgIF9fc3VwZXJfXy5jYWxsKHRoaXMpO1xuXHQgICAgfVxuXHRcblx0ICAgIFBhdXNhYmxlT2JzZXJ2YWJsZS5wcm90b3R5cGUuX3N1YnNjcmliZSA9IGZ1bmN0aW9uIChvKSB7XG5cdCAgICAgIHZhciBjb25uID0gdGhpcy5zb3VyY2UucHVibGlzaCgpLFxuXHQgICAgICAgIHN1YnNjcmlwdGlvbiA9IGNvbm4uc3Vic2NyaWJlKG8pLFxuXHQgICAgICAgIGNvbm5lY3Rpb24gPSBkaXNwb3NhYmxlRW1wdHk7XG5cdFxuXHQgICAgICB2YXIgcGF1c2FibGUgPSB0aGlzLnBhdXNlci5kaXN0aW5jdFVudGlsQ2hhbmdlZCgpLnN1YnNjcmliZShmdW5jdGlvbiAoYikge1xuXHQgICAgICAgIGlmIChiKSB7XG5cdCAgICAgICAgICBjb25uZWN0aW9uID0gY29ubi5jb25uZWN0KCk7XG5cdCAgICAgICAgfSBlbHNlIHtcblx0ICAgICAgICAgIGNvbm5lY3Rpb24uZGlzcG9zZSgpO1xuXHQgICAgICAgICAgY29ubmVjdGlvbiA9IGRpc3Bvc2FibGVFbXB0eTtcblx0ICAgICAgICB9XG5cdCAgICAgIH0pO1xuXHRcblx0ICAgICAgcmV0dXJuIG5ldyBOQXJ5RGlzcG9zYWJsZShbc3Vic2NyaXB0aW9uLCBjb25uZWN0aW9uLCBwYXVzYWJsZV0pO1xuXHQgICAgfTtcblx0XG5cdCAgICBQYXVzYWJsZU9ic2VydmFibGUucHJvdG90eXBlLnBhdXNlID0gZnVuY3Rpb24gKCkge1xuXHQgICAgICB0aGlzLmNvbnRyb2xsZXIub25OZXh0KGZhbHNlKTtcblx0ICAgIH07XG5cdFxuXHQgICAgUGF1c2FibGVPYnNlcnZhYmxlLnByb3RvdHlwZS5yZXN1bWUgPSBmdW5jdGlvbiAoKSB7XG5cdCAgICAgIHRoaXMuY29udHJvbGxlci5vbk5leHQodHJ1ZSk7XG5cdCAgICB9O1xuXHRcblx0ICAgIHJldHVybiBQYXVzYWJsZU9ic2VydmFibGU7XG5cdFxuXHQgIH0oT2JzZXJ2YWJsZSkpO1xuXHRcblx0ICAvKipcblx0ICAgKiBQYXVzZXMgdGhlIHVuZGVybHlpbmcgb2JzZXJ2YWJsZSBzZXF1ZW5jZSBiYXNlZCB1cG9uIHRoZSBvYnNlcnZhYmxlIHNlcXVlbmNlIHdoaWNoIHlpZWxkcyB0cnVlL2ZhbHNlLlxuXHQgICAqIEBleGFtcGxlXG5cdCAgICogdmFyIHBhdXNlciA9IG5ldyBSeC5TdWJqZWN0KCk7XG5cdCAgICogdmFyIHNvdXJjZSA9IFJ4Lk9ic2VydmFibGUuaW50ZXJ2YWwoMTAwKS5wYXVzYWJsZShwYXVzZXIpO1xuXHQgICAqIEBwYXJhbSB7T2JzZXJ2YWJsZX0gcGF1c2VyIFRoZSBvYnNlcnZhYmxlIHNlcXVlbmNlIHVzZWQgdG8gcGF1c2UgdGhlIHVuZGVybHlpbmcgc2VxdWVuY2UuXG5cdCAgICogQHJldHVybnMge09ic2VydmFibGV9IFRoZSBvYnNlcnZhYmxlIHNlcXVlbmNlIHdoaWNoIGlzIHBhdXNlZCBiYXNlZCB1cG9uIHRoZSBwYXVzZXIuXG5cdCAgICovXG5cdCAgb2JzZXJ2YWJsZVByb3RvLnBhdXNhYmxlID0gZnVuY3Rpb24gKHBhdXNlcikge1xuXHQgICAgcmV0dXJuIG5ldyBQYXVzYWJsZU9ic2VydmFibGUodGhpcywgcGF1c2VyKTtcblx0ICB9O1xuXHRcblx0ICBmdW5jdGlvbiBjb21iaW5lTGF0ZXN0U291cmNlKHNvdXJjZSwgc3ViamVjdCwgcmVzdWx0U2VsZWN0b3IpIHtcblx0ICAgIHJldHVybiBuZXcgQW5vbnltb3VzT2JzZXJ2YWJsZShmdW5jdGlvbiAobykge1xuXHQgICAgICB2YXIgaGFzVmFsdWUgPSBbZmFsc2UsIGZhbHNlXSxcblx0ICAgICAgICBoYXNWYWx1ZUFsbCA9IGZhbHNlLFxuXHQgICAgICAgIGlzRG9uZSA9IGZhbHNlLFxuXHQgICAgICAgIHZhbHVlcyA9IG5ldyBBcnJheSgyKSxcblx0ICAgICAgICBlcnI7XG5cdFxuXHQgICAgICBmdW5jdGlvbiBuZXh0KHgsIGkpIHtcblx0ICAgICAgICB2YWx1ZXNbaV0gPSB4O1xuXHQgICAgICAgIGhhc1ZhbHVlW2ldID0gdHJ1ZTtcblx0ICAgICAgICBpZiAoaGFzVmFsdWVBbGwgfHwgKGhhc1ZhbHVlQWxsID0gaGFzVmFsdWUuZXZlcnkoaWRlbnRpdHkpKSkge1xuXHQgICAgICAgICAgaWYgKGVycikgeyByZXR1cm4gby5vbkVycm9yKGVycik7IH1cblx0ICAgICAgICAgIHZhciByZXMgPSB0cnlDYXRjaChyZXN1bHRTZWxlY3RvcikuYXBwbHkobnVsbCwgdmFsdWVzKTtcblx0ICAgICAgICAgIGlmIChyZXMgPT09IGVycm9yT2JqKSB7IHJldHVybiBvLm9uRXJyb3IocmVzLmUpOyB9XG5cdCAgICAgICAgICBvLm9uTmV4dChyZXMpO1xuXHQgICAgICAgIH1cblx0ICAgICAgICBpc0RvbmUgJiYgdmFsdWVzWzFdICYmIG8ub25Db21wbGV0ZWQoKTtcblx0ICAgICAgfVxuXHRcblx0ICAgICAgcmV0dXJuIG5ldyBCaW5hcnlEaXNwb3NhYmxlKFxuXHQgICAgICAgIHNvdXJjZS5zdWJzY3JpYmUoXG5cdCAgICAgICAgICBmdW5jdGlvbiAoeCkge1xuXHQgICAgICAgICAgICBuZXh0KHgsIDApO1xuXHQgICAgICAgICAgfSxcblx0ICAgICAgICAgIGZ1bmN0aW9uIChlKSB7XG5cdCAgICAgICAgICAgIGlmICh2YWx1ZXNbMV0pIHtcblx0ICAgICAgICAgICAgICBvLm9uRXJyb3IoZSk7XG5cdCAgICAgICAgICAgIH0gZWxzZSB7XG5cdCAgICAgICAgICAgICAgZXJyID0gZTtcblx0ICAgICAgICAgICAgfVxuXHQgICAgICAgICAgfSxcblx0ICAgICAgICAgIGZ1bmN0aW9uICgpIHtcblx0ICAgICAgICAgICAgaXNEb25lID0gdHJ1ZTtcblx0ICAgICAgICAgICAgdmFsdWVzWzFdICYmIG8ub25Db21wbGV0ZWQoKTtcblx0ICAgICAgICAgIH0pLFxuXHQgICAgICAgIHN1YmplY3Quc3Vic2NyaWJlKFxuXHQgICAgICAgICAgZnVuY3Rpb24gKHgpIHtcblx0ICAgICAgICAgICAgbmV4dCh4LCAxKTtcblx0ICAgICAgICAgIH0sXG5cdCAgICAgICAgICBmdW5jdGlvbiAoZSkgeyBvLm9uRXJyb3IoZSk7IH0sXG5cdCAgICAgICAgICBmdW5jdGlvbiAoKSB7XG5cdCAgICAgICAgICAgIGlzRG9uZSA9IHRydWU7XG5cdCAgICAgICAgICAgIG5leHQodHJ1ZSwgMSk7XG5cdCAgICAgICAgICB9KVxuXHQgICAgICAgICk7XG5cdCAgICB9LCBzb3VyY2UpO1xuXHQgIH1cblx0XG5cdCAgdmFyIFBhdXNhYmxlQnVmZmVyZWRPYnNlcnZhYmxlID0gKGZ1bmN0aW9uIChfX3N1cGVyX18pIHtcblx0ICAgIGluaGVyaXRzKFBhdXNhYmxlQnVmZmVyZWRPYnNlcnZhYmxlLCBfX3N1cGVyX18pO1xuXHQgICAgZnVuY3Rpb24gUGF1c2FibGVCdWZmZXJlZE9ic2VydmFibGUoc291cmNlLCBwYXVzZXIpIHtcblx0ICAgICAgdGhpcy5zb3VyY2UgPSBzb3VyY2U7XG5cdCAgICAgIHRoaXMuY29udHJvbGxlciA9IG5ldyBTdWJqZWN0KCk7XG5cdFxuXHQgICAgICBpZiAocGF1c2VyICYmIHBhdXNlci5zdWJzY3JpYmUpIHtcblx0ICAgICAgICB0aGlzLnBhdXNlciA9IHRoaXMuY29udHJvbGxlci5tZXJnZShwYXVzZXIpO1xuXHQgICAgICB9IGVsc2Uge1xuXHQgICAgICAgIHRoaXMucGF1c2VyID0gdGhpcy5jb250cm9sbGVyO1xuXHQgICAgICB9XG5cdFxuXHQgICAgICBfX3N1cGVyX18uY2FsbCh0aGlzKTtcblx0ICAgIH1cblx0XG5cdCAgICBQYXVzYWJsZUJ1ZmZlcmVkT2JzZXJ2YWJsZS5wcm90b3R5cGUuX3N1YnNjcmliZSA9IGZ1bmN0aW9uIChvKSB7XG5cdCAgICAgIHZhciBxID0gW10sIHByZXZpb3VzU2hvdWxkRmlyZTtcblx0XG5cdCAgICAgIGZ1bmN0aW9uIGRyYWluUXVldWUoKSB7IHdoaWxlIChxLmxlbmd0aCA+IDApIHsgby5vbk5leHQocS5zaGlmdCgpKTsgfSB9XG5cdFxuXHQgICAgICB2YXIgc3Vic2NyaXB0aW9uID1cblx0ICAgICAgICBjb21iaW5lTGF0ZXN0U291cmNlKFxuXHQgICAgICAgICAgdGhpcy5zb3VyY2UsXG5cdCAgICAgICAgICB0aGlzLnBhdXNlci5zdGFydFdpdGgoZmFsc2UpLmRpc3RpbmN0VW50aWxDaGFuZ2VkKCksXG5cdCAgICAgICAgICBmdW5jdGlvbiAoZGF0YSwgc2hvdWxkRmlyZSkge1xuXHQgICAgICAgICAgICByZXR1cm4geyBkYXRhOiBkYXRhLCBzaG91bGRGaXJlOiBzaG91bGRGaXJlIH07XG5cdCAgICAgICAgICB9KVxuXHQgICAgICAgICAgLnN1YnNjcmliZShcblx0ICAgICAgICAgICAgZnVuY3Rpb24gKHJlc3VsdHMpIHtcblx0ICAgICAgICAgICAgICBpZiAocHJldmlvdXNTaG91bGRGaXJlICE9PSB1bmRlZmluZWQgJiYgcmVzdWx0cy5zaG91bGRGaXJlICE9PSBwcmV2aW91c1Nob3VsZEZpcmUpIHtcblx0ICAgICAgICAgICAgICAgIHByZXZpb3VzU2hvdWxkRmlyZSA9IHJlc3VsdHMuc2hvdWxkRmlyZTtcblx0ICAgICAgICAgICAgICAgIC8vIGNoYW5nZSBpbiBzaG91bGRGaXJlXG5cdCAgICAgICAgICAgICAgICBpZiAocmVzdWx0cy5zaG91bGRGaXJlKSB7IGRyYWluUXVldWUoKTsgfVxuXHQgICAgICAgICAgICAgIH0gZWxzZSB7XG5cdCAgICAgICAgICAgICAgICBwcmV2aW91c1Nob3VsZEZpcmUgPSByZXN1bHRzLnNob3VsZEZpcmU7XG5cdCAgICAgICAgICAgICAgICAvLyBuZXcgZGF0YVxuXHQgICAgICAgICAgICAgICAgaWYgKHJlc3VsdHMuc2hvdWxkRmlyZSkge1xuXHQgICAgICAgICAgICAgICAgICBvLm9uTmV4dChyZXN1bHRzLmRhdGEpO1xuXHQgICAgICAgICAgICAgICAgfSBlbHNlIHtcblx0ICAgICAgICAgICAgICAgICAgcS5wdXNoKHJlc3VsdHMuZGF0YSk7XG5cdCAgICAgICAgICAgICAgICB9XG5cdCAgICAgICAgICAgICAgfVxuXHQgICAgICAgICAgICB9LFxuXHQgICAgICAgICAgICBmdW5jdGlvbiAoZXJyKSB7XG5cdCAgICAgICAgICAgICAgZHJhaW5RdWV1ZSgpO1xuXHQgICAgICAgICAgICAgIG8ub25FcnJvcihlcnIpO1xuXHQgICAgICAgICAgICB9LFxuXHQgICAgICAgICAgICBmdW5jdGlvbiAoKSB7XG5cdCAgICAgICAgICAgICAgZHJhaW5RdWV1ZSgpO1xuXHQgICAgICAgICAgICAgIG8ub25Db21wbGV0ZWQoKTtcblx0ICAgICAgICAgICAgfVxuXHQgICAgICAgICAgKTtcblx0ICAgICAgcmV0dXJuIHN1YnNjcmlwdGlvbjsgICAgICBcblx0ICAgIH07XG5cdFxuXHQgICAgUGF1c2FibGVCdWZmZXJlZE9ic2VydmFibGUucHJvdG90eXBlLnBhdXNlID0gZnVuY3Rpb24gKCkge1xuXHQgICAgICB0aGlzLmNvbnRyb2xsZXIub25OZXh0KGZhbHNlKTtcblx0ICAgIH07XG5cdFxuXHQgICAgUGF1c2FibGVCdWZmZXJlZE9ic2VydmFibGUucHJvdG90eXBlLnJlc3VtZSA9IGZ1bmN0aW9uICgpIHtcblx0ICAgICAgdGhpcy5jb250cm9sbGVyLm9uTmV4dCh0cnVlKTtcblx0ICAgIH07XG5cdFxuXHQgICAgcmV0dXJuIFBhdXNhYmxlQnVmZmVyZWRPYnNlcnZhYmxlO1xuXHRcblx0ICB9KE9ic2VydmFibGUpKTtcblx0XG5cdCAgLyoqXG5cdCAgICogUGF1c2VzIHRoZSB1bmRlcmx5aW5nIG9ic2VydmFibGUgc2VxdWVuY2UgYmFzZWQgdXBvbiB0aGUgb2JzZXJ2YWJsZSBzZXF1ZW5jZSB3aGljaCB5aWVsZHMgdHJ1ZS9mYWxzZSxcblx0ICAgKiBhbmQgeWllbGRzIHRoZSB2YWx1ZXMgdGhhdCB3ZXJlIGJ1ZmZlcmVkIHdoaWxlIHBhdXNlZC5cblx0ICAgKiBAZXhhbXBsZVxuXHQgICAqIHZhciBwYXVzZXIgPSBuZXcgUnguU3ViamVjdCgpO1xuXHQgICAqIHZhciBzb3VyY2UgPSBSeC5PYnNlcnZhYmxlLmludGVydmFsKDEwMCkucGF1c2FibGVCdWZmZXJlZChwYXVzZXIpO1xuXHQgICAqIEBwYXJhbSB7T2JzZXJ2YWJsZX0gcGF1c2VyIFRoZSBvYnNlcnZhYmxlIHNlcXVlbmNlIHVzZWQgdG8gcGF1c2UgdGhlIHVuZGVybHlpbmcgc2VxdWVuY2UuXG5cdCAgICogQHJldHVybnMge09ic2VydmFibGV9IFRoZSBvYnNlcnZhYmxlIHNlcXVlbmNlIHdoaWNoIGlzIHBhdXNlZCBiYXNlZCB1cG9uIHRoZSBwYXVzZXIuXG5cdCAgICovXG5cdCAgb2JzZXJ2YWJsZVByb3RvLnBhdXNhYmxlQnVmZmVyZWQgPSBmdW5jdGlvbiAoc3ViamVjdCkge1xuXHQgICAgcmV0dXJuIG5ldyBQYXVzYWJsZUJ1ZmZlcmVkT2JzZXJ2YWJsZSh0aGlzLCBzdWJqZWN0KTtcblx0ICB9O1xuXHRcblx0ICB2YXIgQ29udHJvbGxlZE9ic2VydmFibGUgPSAoZnVuY3Rpb24gKF9fc3VwZXJfXykge1xuXHQgICAgaW5oZXJpdHMoQ29udHJvbGxlZE9ic2VydmFibGUsIF9fc3VwZXJfXyk7XG5cdCAgICBmdW5jdGlvbiBDb250cm9sbGVkT2JzZXJ2YWJsZSAoc291cmNlLCBlbmFibGVRdWV1ZSwgc2NoZWR1bGVyKSB7XG5cdCAgICAgIF9fc3VwZXJfXy5jYWxsKHRoaXMpO1xuXHQgICAgICB0aGlzLnN1YmplY3QgPSBuZXcgQ29udHJvbGxlZFN1YmplY3QoZW5hYmxlUXVldWUsIHNjaGVkdWxlcik7XG5cdCAgICAgIHRoaXMuc291cmNlID0gc291cmNlLm11bHRpY2FzdCh0aGlzLnN1YmplY3QpLnJlZkNvdW50KCk7XG5cdCAgICB9XG5cdFxuXHQgICAgQ29udHJvbGxlZE9ic2VydmFibGUucHJvdG90eXBlLl9zdWJzY3JpYmUgPSBmdW5jdGlvbiAobykge1xuXHQgICAgICByZXR1cm4gdGhpcy5zb3VyY2Uuc3Vic2NyaWJlKG8pO1xuXHQgICAgfTtcblx0XG5cdCAgICBDb250cm9sbGVkT2JzZXJ2YWJsZS5wcm90b3R5cGUucmVxdWVzdCA9IGZ1bmN0aW9uIChudW1iZXJPZkl0ZW1zKSB7XG5cdCAgICAgIHJldHVybiB0aGlzLnN1YmplY3QucmVxdWVzdChudW1iZXJPZkl0ZW1zID09IG51bGwgPyAtMSA6IG51bWJlck9mSXRlbXMpO1xuXHQgICAgfTtcblx0XG5cdCAgICByZXR1cm4gQ29udHJvbGxlZE9ic2VydmFibGU7XG5cdFxuXHQgIH0oT2JzZXJ2YWJsZSkpO1xuXHRcblx0ICB2YXIgQ29udHJvbGxlZFN1YmplY3QgPSAoZnVuY3Rpb24gKF9fc3VwZXJfXykge1xuXHQgICAgaW5oZXJpdHMoQ29udHJvbGxlZFN1YmplY3QsIF9fc3VwZXJfXyk7XG5cdCAgICBmdW5jdGlvbiBDb250cm9sbGVkU3ViamVjdChlbmFibGVRdWV1ZSwgc2NoZWR1bGVyKSB7XG5cdCAgICAgIGVuYWJsZVF1ZXVlID09IG51bGwgJiYgKGVuYWJsZVF1ZXVlID0gdHJ1ZSk7XG5cdFxuXHQgICAgICBfX3N1cGVyX18uY2FsbCh0aGlzKTtcblx0ICAgICAgdGhpcy5zdWJqZWN0ID0gbmV3IFN1YmplY3QoKTtcblx0ICAgICAgdGhpcy5lbmFibGVRdWV1ZSA9IGVuYWJsZVF1ZXVlO1xuXHQgICAgICB0aGlzLnF1ZXVlID0gZW5hYmxlUXVldWUgPyBbXSA6IG51bGw7XG5cdCAgICAgIHRoaXMucmVxdWVzdGVkQ291bnQgPSAwO1xuXHQgICAgICB0aGlzLnJlcXVlc3RlZERpc3Bvc2FibGUgPSBudWxsO1xuXHQgICAgICB0aGlzLmVycm9yID0gbnVsbDtcblx0ICAgICAgdGhpcy5oYXNGYWlsZWQgPSBmYWxzZTtcblx0ICAgICAgdGhpcy5oYXNDb21wbGV0ZWQgPSBmYWxzZTtcblx0ICAgICAgdGhpcy5zY2hlZHVsZXIgPSBzY2hlZHVsZXIgfHwgY3VycmVudFRocmVhZFNjaGVkdWxlcjtcblx0ICAgIH1cblx0XG5cdCAgICBhZGRQcm9wZXJ0aWVzKENvbnRyb2xsZWRTdWJqZWN0LnByb3RvdHlwZSwgT2JzZXJ2ZXIsIHtcblx0ICAgICAgX3N1YnNjcmliZTogZnVuY3Rpb24gKG8pIHtcblx0ICAgICAgICByZXR1cm4gdGhpcy5zdWJqZWN0LnN1YnNjcmliZShvKTtcblx0ICAgICAgfSxcblx0ICAgICAgb25Db21wbGV0ZWQ6IGZ1bmN0aW9uICgpIHtcblx0ICAgICAgICB0aGlzLmhhc0NvbXBsZXRlZCA9IHRydWU7XG5cdCAgICAgICAgaWYgKCF0aGlzLmVuYWJsZVF1ZXVlIHx8IHRoaXMucXVldWUubGVuZ3RoID09PSAwKSB7XG5cdCAgICAgICAgICB0aGlzLnN1YmplY3Qub25Db21wbGV0ZWQoKTtcblx0ICAgICAgICAgIHRoaXMuZGlzcG9zZUN1cnJlbnRSZXF1ZXN0KCk7XG5cdCAgICAgICAgfSBlbHNlIHtcblx0ICAgICAgICAgIHRoaXMucXVldWUucHVzaChOb3RpZmljYXRpb24uY3JlYXRlT25Db21wbGV0ZWQoKSk7XG5cdCAgICAgICAgfVxuXHQgICAgICB9LFxuXHQgICAgICBvbkVycm9yOiBmdW5jdGlvbiAoZXJyb3IpIHtcblx0ICAgICAgICB0aGlzLmhhc0ZhaWxlZCA9IHRydWU7XG5cdCAgICAgICAgdGhpcy5lcnJvciA9IGVycm9yO1xuXHQgICAgICAgIGlmICghdGhpcy5lbmFibGVRdWV1ZSB8fCB0aGlzLnF1ZXVlLmxlbmd0aCA9PT0gMCkge1xuXHQgICAgICAgICAgdGhpcy5zdWJqZWN0Lm9uRXJyb3IoZXJyb3IpO1xuXHQgICAgICAgICAgdGhpcy5kaXNwb3NlQ3VycmVudFJlcXVlc3QoKTtcblx0ICAgICAgICB9IGVsc2Uge1xuXHQgICAgICAgICAgdGhpcy5xdWV1ZS5wdXNoKE5vdGlmaWNhdGlvbi5jcmVhdGVPbkVycm9yKGVycm9yKSk7XG5cdCAgICAgICAgfVxuXHQgICAgICB9LFxuXHQgICAgICBvbk5leHQ6IGZ1bmN0aW9uICh2YWx1ZSkge1xuXHQgICAgICAgIGlmICh0aGlzLnJlcXVlc3RlZENvdW50IDw9IDApIHtcblx0ICAgICAgICAgIHRoaXMuZW5hYmxlUXVldWUgJiYgdGhpcy5xdWV1ZS5wdXNoKE5vdGlmaWNhdGlvbi5jcmVhdGVPbk5leHQodmFsdWUpKTtcblx0ICAgICAgICB9IGVsc2Uge1xuXHQgICAgICAgICAgKHRoaXMucmVxdWVzdGVkQ291bnQtLSA9PT0gMCkgJiYgdGhpcy5kaXNwb3NlQ3VycmVudFJlcXVlc3QoKTtcblx0ICAgICAgICAgIHRoaXMuc3ViamVjdC5vbk5leHQodmFsdWUpO1xuXHQgICAgICAgIH1cblx0ICAgICAgfSxcblx0ICAgICAgX3Byb2Nlc3NSZXF1ZXN0OiBmdW5jdGlvbiAobnVtYmVyT2ZJdGVtcykge1xuXHQgICAgICAgIGlmICh0aGlzLmVuYWJsZVF1ZXVlKSB7XG5cdCAgICAgICAgICB3aGlsZSAodGhpcy5xdWV1ZS5sZW5ndGggPiAwICYmIChudW1iZXJPZkl0ZW1zID4gMCB8fCB0aGlzLnF1ZXVlWzBdLmtpbmQgIT09ICdOJykpIHtcblx0ICAgICAgICAgICAgdmFyIGZpcnN0ID0gdGhpcy5xdWV1ZS5zaGlmdCgpO1xuXHQgICAgICAgICAgICBmaXJzdC5hY2NlcHQodGhpcy5zdWJqZWN0KTtcblx0ICAgICAgICAgICAgaWYgKGZpcnN0LmtpbmQgPT09ICdOJykge1xuXHQgICAgICAgICAgICAgIG51bWJlck9mSXRlbXMtLTtcblx0ICAgICAgICAgICAgfSBlbHNlIHtcblx0ICAgICAgICAgICAgICB0aGlzLmRpc3Bvc2VDdXJyZW50UmVxdWVzdCgpO1xuXHQgICAgICAgICAgICAgIHRoaXMucXVldWUgPSBbXTtcblx0ICAgICAgICAgICAgfVxuXHQgICAgICAgICAgfVxuXHQgICAgICAgIH1cblx0XG5cdCAgICAgICAgcmV0dXJuIG51bWJlck9mSXRlbXM7XG5cdCAgICAgIH0sXG5cdCAgICAgIHJlcXVlc3Q6IGZ1bmN0aW9uIChudW1iZXIpIHtcblx0ICAgICAgICB0aGlzLmRpc3Bvc2VDdXJyZW50UmVxdWVzdCgpO1xuXHQgICAgICAgIHZhciBzZWxmID0gdGhpcztcblx0XG5cdCAgICAgICAgdGhpcy5yZXF1ZXN0ZWREaXNwb3NhYmxlID0gdGhpcy5zY2hlZHVsZXIuc2NoZWR1bGUobnVtYmVyLFxuXHQgICAgICAgIGZ1bmN0aW9uKHMsIGkpIHtcblx0ICAgICAgICAgIHZhciByZW1haW5pbmcgPSBzZWxmLl9wcm9jZXNzUmVxdWVzdChpKTtcblx0ICAgICAgICAgIHZhciBzdG9wcGVkID0gc2VsZi5oYXNDb21wbGV0ZWQgfHwgc2VsZi5oYXNGYWlsZWQ7XG5cdCAgICAgICAgICBpZiAoIXN0b3BwZWQgJiYgcmVtYWluaW5nID4gMCkge1xuXHQgICAgICAgICAgICBzZWxmLnJlcXVlc3RlZENvdW50ID0gcmVtYWluaW5nO1xuXHRcblx0ICAgICAgICAgICAgcmV0dXJuIGRpc3Bvc2FibGVDcmVhdGUoZnVuY3Rpb24gKCkge1xuXHQgICAgICAgICAgICAgIHNlbGYucmVxdWVzdGVkQ291bnQgPSAwO1xuXHQgICAgICAgICAgICB9KTtcblx0ICAgICAgICAgICAgICAvLyBTY2hlZHVsZWQgaXRlbSBpcyBzdGlsbCBpbiBwcm9ncmVzcy4gUmV0dXJuIGEgbmV3XG5cdCAgICAgICAgICAgICAgLy8gZGlzcG9zYWJsZSB0byBhbGxvdyB0aGUgcmVxdWVzdCB0byBiZSBpbnRlcnJ1cHRlZFxuXHQgICAgICAgICAgICAgIC8vIHZpYSBkaXNwb3NlLlxuXHQgICAgICAgICAgfVxuXHQgICAgICAgIH0pO1xuXHRcblx0ICAgICAgICByZXR1cm4gdGhpcy5yZXF1ZXN0ZWREaXNwb3NhYmxlO1xuXHQgICAgICB9LFxuXHQgICAgICBkaXNwb3NlQ3VycmVudFJlcXVlc3Q6IGZ1bmN0aW9uICgpIHtcblx0ICAgICAgICBpZiAodGhpcy5yZXF1ZXN0ZWREaXNwb3NhYmxlKSB7XG5cdCAgICAgICAgICB0aGlzLnJlcXVlc3RlZERpc3Bvc2FibGUuZGlzcG9zZSgpO1xuXHQgICAgICAgICAgdGhpcy5yZXF1ZXN0ZWREaXNwb3NhYmxlID0gbnVsbDtcblx0ICAgICAgICB9XG5cdCAgICAgIH1cblx0ICAgIH0pO1xuXHRcblx0ICAgIHJldHVybiBDb250cm9sbGVkU3ViamVjdDtcblx0ICB9KE9ic2VydmFibGUpKTtcblx0XG5cdCAgLyoqXG5cdCAgICogQXR0YWNoZXMgYSBjb250cm9sbGVyIHRvIHRoZSBvYnNlcnZhYmxlIHNlcXVlbmNlIHdpdGggdGhlIGFiaWxpdHkgdG8gcXVldWUuXG5cdCAgICogQGV4YW1wbGVcblx0ICAgKiB2YXIgc291cmNlID0gUnguT2JzZXJ2YWJsZS5pbnRlcnZhbCgxMDApLmNvbnRyb2xsZWQoKTtcblx0ICAgKiBzb3VyY2UucmVxdWVzdCgzKTsgLy8gUmVhZHMgMyB2YWx1ZXNcblx0ICAgKiBAcGFyYW0ge2Jvb2x9IGVuYWJsZVF1ZXVlIHRydXRoeSB2YWx1ZSB0byBkZXRlcm1pbmUgaWYgdmFsdWVzIHNob3VsZCBiZSBxdWV1ZWQgcGVuZGluZyB0aGUgbmV4dCByZXF1ZXN0XG5cdCAgICogQHBhcmFtIHtTY2hlZHVsZXJ9IHNjaGVkdWxlciBkZXRlcm1pbmVzIGhvdyB0aGUgcmVxdWVzdHMgd2lsbCBiZSBzY2hlZHVsZWRcblx0ICAgKiBAcmV0dXJucyB7T2JzZXJ2YWJsZX0gVGhlIG9ic2VydmFibGUgc2VxdWVuY2Ugd2hpY2ggb25seSBwcm9wYWdhdGVzIHZhbHVlcyBvbiByZXF1ZXN0LlxuXHQgICAqL1xuXHQgIG9ic2VydmFibGVQcm90by5jb250cm9sbGVkID0gZnVuY3Rpb24gKGVuYWJsZVF1ZXVlLCBzY2hlZHVsZXIpIHtcblx0XG5cdCAgICBpZiAoZW5hYmxlUXVldWUgJiYgaXNTY2hlZHVsZXIoZW5hYmxlUXVldWUpKSB7XG5cdCAgICAgIHNjaGVkdWxlciA9IGVuYWJsZVF1ZXVlO1xuXHQgICAgICBlbmFibGVRdWV1ZSA9IHRydWU7XG5cdCAgICB9XG5cdFxuXHQgICAgaWYgKGVuYWJsZVF1ZXVlID09IG51bGwpIHsgIGVuYWJsZVF1ZXVlID0gdHJ1ZTsgfVxuXHQgICAgcmV0dXJuIG5ldyBDb250cm9sbGVkT2JzZXJ2YWJsZSh0aGlzLCBlbmFibGVRdWV1ZSwgc2NoZWR1bGVyKTtcblx0ICB9O1xuXHRcblx0ICB2YXIgU3RvcEFuZFdhaXRPYnNlcnZhYmxlID0gKGZ1bmN0aW9uIChfX3N1cGVyX18pIHtcblx0ICAgIGluaGVyaXRzKFN0b3BBbmRXYWl0T2JzZXJ2YWJsZSwgX19zdXBlcl9fKTtcblx0ICAgIGZ1bmN0aW9uIFN0b3BBbmRXYWl0T2JzZXJ2YWJsZSAoc291cmNlKSB7XG5cdCAgICAgIF9fc3VwZXJfXy5jYWxsKHRoaXMpO1xuXHQgICAgICB0aGlzLnNvdXJjZSA9IHNvdXJjZTtcblx0ICAgIH1cblx0XG5cdCAgICBmdW5jdGlvbiBzY2hlZHVsZU1ldGhvZChzLCBzZWxmKSB7XG5cdCAgICAgIHNlbGYuc291cmNlLnJlcXVlc3QoMSk7XG5cdCAgICB9XG5cdFxuXHQgICAgU3RvcEFuZFdhaXRPYnNlcnZhYmxlLnByb3RvdHlwZS5fc3Vic2NyaWJlID0gZnVuY3Rpb24gKG8pIHtcblx0ICAgICAgdGhpcy5zdWJzY3JpcHRpb24gPSB0aGlzLnNvdXJjZS5zdWJzY3JpYmUobmV3IFN0b3BBbmRXYWl0T2JzZXJ2ZXIobywgdGhpcywgdGhpcy5zdWJzY3JpcHRpb24pKTtcblx0ICAgICAgcmV0dXJuIG5ldyBCaW5hcnlEaXNwb3NhYmxlKFxuXHQgICAgICAgIHRoaXMuc3Vic2NyaXB0aW9uLFxuXHQgICAgICAgIGRlZmF1bHRTY2hlZHVsZXIuc2NoZWR1bGUodGhpcywgc2NoZWR1bGVNZXRob2QpXG5cdCAgICAgICk7XG5cdCAgICB9O1xuXHRcblx0ICAgIHZhciBTdG9wQW5kV2FpdE9ic2VydmVyID0gKGZ1bmN0aW9uIChfX3N1Yl9fKSB7XG5cdCAgICAgIGluaGVyaXRzKFN0b3BBbmRXYWl0T2JzZXJ2ZXIsIF9fc3ViX18pO1xuXHQgICAgICBmdW5jdGlvbiBTdG9wQW5kV2FpdE9ic2VydmVyIChvYnNlcnZlciwgb2JzZXJ2YWJsZSwgY2FuY2VsKSB7XG5cdCAgICAgICAgX19zdWJfXy5jYWxsKHRoaXMpO1xuXHQgICAgICAgIHRoaXMub2JzZXJ2ZXIgPSBvYnNlcnZlcjtcblx0ICAgICAgICB0aGlzLm9ic2VydmFibGUgPSBvYnNlcnZhYmxlO1xuXHQgICAgICAgIHRoaXMuY2FuY2VsID0gY2FuY2VsO1xuXHQgICAgICAgIHRoaXMuc2NoZWR1bGVEaXNwb3NhYmxlID0gbnVsbDtcblx0ICAgICAgfVxuXHRcblx0ICAgICAgU3RvcEFuZFdhaXRPYnNlcnZlci5wcm90b3R5cGUuY29tcGxldGVkID0gZnVuY3Rpb24gKCkge1xuXHQgICAgICAgIHRoaXMub2JzZXJ2ZXIub25Db21wbGV0ZWQoKTtcblx0ICAgICAgICB0aGlzLmRpc3Bvc2UoKTtcblx0ICAgICAgfTtcblx0XG5cdCAgICAgIFN0b3BBbmRXYWl0T2JzZXJ2ZXIucHJvdG90eXBlLmVycm9yID0gZnVuY3Rpb24gKGVycm9yKSB7XG5cdCAgICAgICAgdGhpcy5vYnNlcnZlci5vbkVycm9yKGVycm9yKTtcblx0ICAgICAgICB0aGlzLmRpc3Bvc2UoKTtcblx0ICAgICAgfTtcblx0XG5cdCAgICAgIGZ1bmN0aW9uIGlubmVyU2NoZWR1bGVNZXRob2Qocywgc2VsZikge1xuXHQgICAgICAgIHNlbGYub2JzZXJ2YWJsZS5zb3VyY2UucmVxdWVzdCgxKTtcblx0ICAgICAgfVxuXHRcblx0ICAgICAgU3RvcEFuZFdhaXRPYnNlcnZlci5wcm90b3R5cGUubmV4dCA9IGZ1bmN0aW9uICh2YWx1ZSkge1xuXHQgICAgICAgIHRoaXMub2JzZXJ2ZXIub25OZXh0KHZhbHVlKTtcblx0ICAgICAgICB0aGlzLnNjaGVkdWxlRGlzcG9zYWJsZSA9IGRlZmF1bHRTY2hlZHVsZXIuc2NoZWR1bGUodGhpcywgaW5uZXJTY2hlZHVsZU1ldGhvZCk7XG5cdCAgICAgIH07XG5cdFxuXHQgICAgICBTdG9wQW5kV2FpdE9ic2VydmFibGUuZGlzcG9zZSA9IGZ1bmN0aW9uICgpIHtcblx0ICAgICAgICB0aGlzLm9ic2VydmVyID0gbnVsbDtcblx0ICAgICAgICBpZiAodGhpcy5jYW5jZWwpIHtcblx0ICAgICAgICAgIHRoaXMuY2FuY2VsLmRpc3Bvc2UoKTtcblx0ICAgICAgICAgIHRoaXMuY2FuY2VsID0gbnVsbDtcblx0ICAgICAgICB9XG5cdCAgICAgICAgaWYgKHRoaXMuc2NoZWR1bGVEaXNwb3NhYmxlKSB7XG5cdCAgICAgICAgICB0aGlzLnNjaGVkdWxlRGlzcG9zYWJsZS5kaXNwb3NlKCk7XG5cdCAgICAgICAgICB0aGlzLnNjaGVkdWxlRGlzcG9zYWJsZSA9IG51bGw7XG5cdCAgICAgICAgfVxuXHQgICAgICAgIF9fc3ViX18ucHJvdG90eXBlLmRpc3Bvc2UuY2FsbCh0aGlzKTtcblx0ICAgICAgfTtcblx0XG5cdCAgICAgIHJldHVybiBTdG9wQW5kV2FpdE9ic2VydmVyO1xuXHQgICAgfShBYnN0cmFjdE9ic2VydmVyKSk7XG5cdFxuXHQgICAgcmV0dXJuIFN0b3BBbmRXYWl0T2JzZXJ2YWJsZTtcblx0ICB9KE9ic2VydmFibGUpKTtcblx0XG5cdFxuXHQgIC8qKlxuXHQgICAqIEF0dGFjaGVzIGEgc3RvcCBhbmQgd2FpdCBvYnNlcnZhYmxlIHRvIHRoZSBjdXJyZW50IG9ic2VydmFibGUuXG5cdCAgICogQHJldHVybnMge09ic2VydmFibGV9IEEgc3RvcCBhbmQgd2FpdCBvYnNlcnZhYmxlLlxuXHQgICAqL1xuXHQgIENvbnRyb2xsZWRPYnNlcnZhYmxlLnByb3RvdHlwZS5zdG9wQW5kV2FpdCA9IGZ1bmN0aW9uICgpIHtcblx0ICAgIHJldHVybiBuZXcgU3RvcEFuZFdhaXRPYnNlcnZhYmxlKHRoaXMpO1xuXHQgIH07XG5cdFxuXHQgIHZhciBXaW5kb3dlZE9ic2VydmFibGUgPSAoZnVuY3Rpb24gKF9fc3VwZXJfXykge1xuXHQgICAgaW5oZXJpdHMoV2luZG93ZWRPYnNlcnZhYmxlLCBfX3N1cGVyX18pO1xuXHQgICAgZnVuY3Rpb24gV2luZG93ZWRPYnNlcnZhYmxlKHNvdXJjZSwgd2luZG93U2l6ZSkge1xuXHQgICAgICBfX3N1cGVyX18uY2FsbCh0aGlzKTtcblx0ICAgICAgdGhpcy5zb3VyY2UgPSBzb3VyY2U7XG5cdCAgICAgIHRoaXMud2luZG93U2l6ZSA9IHdpbmRvd1NpemU7XG5cdCAgICB9XG5cdFxuXHQgICAgZnVuY3Rpb24gc2NoZWR1bGVNZXRob2Qocywgc2VsZikge1xuXHQgICAgICBzZWxmLnNvdXJjZS5yZXF1ZXN0KHNlbGYud2luZG93U2l6ZSk7XG5cdCAgICB9XG5cdFxuXHQgICAgV2luZG93ZWRPYnNlcnZhYmxlLnByb3RvdHlwZS5fc3Vic2NyaWJlID0gZnVuY3Rpb24gKG8pIHtcblx0ICAgICAgdGhpcy5zdWJzY3JpcHRpb24gPSB0aGlzLnNvdXJjZS5zdWJzY3JpYmUobmV3IFdpbmRvd2VkT2JzZXJ2ZXIobywgdGhpcywgdGhpcy5zdWJzY3JpcHRpb24pKTtcblx0ICAgICAgcmV0dXJuIG5ldyBCaW5hcnlEaXNwb3NhYmxlKFxuXHQgICAgICAgIHRoaXMuc3Vic2NyaXB0aW9uLFxuXHQgICAgICAgIGRlZmF1bHRTY2hlZHVsZXIuc2NoZWR1bGUodGhpcywgc2NoZWR1bGVNZXRob2QpXG5cdCAgICAgICk7XG5cdCAgICB9O1xuXHRcblx0ICAgIHZhciBXaW5kb3dlZE9ic2VydmVyID0gKGZ1bmN0aW9uIChfX3N1Yl9fKSB7XG5cdCAgICAgIGluaGVyaXRzKFdpbmRvd2VkT2JzZXJ2ZXIsIF9fc3ViX18pO1xuXHQgICAgICBmdW5jdGlvbiBXaW5kb3dlZE9ic2VydmVyKG9ic2VydmVyLCBvYnNlcnZhYmxlLCBjYW5jZWwpIHtcblx0ICAgICAgICB0aGlzLm9ic2VydmVyID0gb2JzZXJ2ZXI7XG5cdCAgICAgICAgdGhpcy5vYnNlcnZhYmxlID0gb2JzZXJ2YWJsZTtcblx0ICAgICAgICB0aGlzLmNhbmNlbCA9IGNhbmNlbDtcblx0ICAgICAgICB0aGlzLnJlY2VpdmVkID0gMDtcblx0ICAgICAgICB0aGlzLnNjaGVkdWxlRGlzcG9zYWJsZSA9IG51bGw7XG5cdCAgICAgICAgX19zdWJfXy5jYWxsKHRoaXMpO1xuXHQgICAgICB9XG5cdFxuXHQgICAgICBXaW5kb3dlZE9ic2VydmVyLnByb3RvdHlwZS5jb21wbGV0ZWQgPSBmdW5jdGlvbiAoKSB7XG5cdCAgICAgICAgdGhpcy5vYnNlcnZlci5vbkNvbXBsZXRlZCgpO1xuXHQgICAgICAgIHRoaXMuZGlzcG9zZSgpO1xuXHQgICAgICB9O1xuXHRcblx0ICAgICAgV2luZG93ZWRPYnNlcnZlci5wcm90b3R5cGUuZXJyb3IgPSBmdW5jdGlvbiAoZXJyb3IpIHtcblx0ICAgICAgICB0aGlzLm9ic2VydmVyLm9uRXJyb3IoZXJyb3IpO1xuXHQgICAgICAgIHRoaXMuZGlzcG9zZSgpO1xuXHQgICAgICB9O1xuXHRcblx0ICAgICAgZnVuY3Rpb24gaW5uZXJTY2hlZHVsZU1ldGhvZChzLCBzZWxmKSB7XG5cdCAgICAgICAgc2VsZi5vYnNlcnZhYmxlLnNvdXJjZS5yZXF1ZXN0KHNlbGYub2JzZXJ2YWJsZS53aW5kb3dTaXplKTtcblx0ICAgICAgfVxuXHRcblx0ICAgICAgV2luZG93ZWRPYnNlcnZlci5wcm90b3R5cGUubmV4dCA9IGZ1bmN0aW9uICh2YWx1ZSkge1xuXHQgICAgICAgIHRoaXMub2JzZXJ2ZXIub25OZXh0KHZhbHVlKTtcblx0ICAgICAgICB0aGlzLnJlY2VpdmVkID0gKyt0aGlzLnJlY2VpdmVkICUgdGhpcy5vYnNlcnZhYmxlLndpbmRvd1NpemU7XG5cdCAgICAgICAgdGhpcy5yZWNlaXZlZCA9PT0gMCAmJiAodGhpcy5zY2hlZHVsZURpc3Bvc2FibGUgPSBkZWZhdWx0U2NoZWR1bGVyLnNjaGVkdWxlKHRoaXMsIGlubmVyU2NoZWR1bGVNZXRob2QpKTtcblx0ICAgICAgfTtcblx0XG5cdCAgICAgIFdpbmRvd2VkT2JzZXJ2ZXIucHJvdG90eXBlLmRpc3Bvc2UgPSBmdW5jdGlvbiAoKSB7XG5cdCAgICAgICAgdGhpcy5vYnNlcnZlciA9IG51bGw7XG5cdCAgICAgICAgaWYgKHRoaXMuY2FuY2VsKSB7XG5cdCAgICAgICAgICB0aGlzLmNhbmNlbC5kaXNwb3NlKCk7XG5cdCAgICAgICAgICB0aGlzLmNhbmNlbCA9IG51bGw7XG5cdCAgICAgICAgfVxuXHQgICAgICAgIGlmICh0aGlzLnNjaGVkdWxlRGlzcG9zYWJsZSkge1xuXHQgICAgICAgICAgdGhpcy5zY2hlZHVsZURpc3Bvc2FibGUuZGlzcG9zZSgpO1xuXHQgICAgICAgICAgdGhpcy5zY2hlZHVsZURpc3Bvc2FibGUgPSBudWxsO1xuXHQgICAgICAgIH1cblx0ICAgICAgICBfX3N1Yl9fLnByb3RvdHlwZS5kaXNwb3NlLmNhbGwodGhpcyk7XG5cdCAgICAgIH07XG5cdFxuXHQgICAgICByZXR1cm4gV2luZG93ZWRPYnNlcnZlcjtcblx0ICAgIH0oQWJzdHJhY3RPYnNlcnZlcikpO1xuXHRcblx0ICAgIHJldHVybiBXaW5kb3dlZE9ic2VydmFibGU7XG5cdCAgfShPYnNlcnZhYmxlKSk7XG5cdFxuXHQgIC8qKlxuXHQgICAqIENyZWF0ZXMgYSBzbGlkaW5nIHdpbmRvd2VkIG9ic2VydmFibGUgYmFzZWQgdXBvbiB0aGUgd2luZG93IHNpemUuXG5cdCAgICogQHBhcmFtIHtOdW1iZXJ9IHdpbmRvd1NpemUgVGhlIG51bWJlciBvZiBpdGVtcyBpbiB0aGUgd2luZG93XG5cdCAgICogQHJldHVybnMge09ic2VydmFibGV9IEEgd2luZG93ZWQgb2JzZXJ2YWJsZSBiYXNlZCB1cG9uIHRoZSB3aW5kb3cgc2l6ZS5cblx0ICAgKi9cblx0ICBDb250cm9sbGVkT2JzZXJ2YWJsZS5wcm90b3R5cGUud2luZG93ZWQgPSBmdW5jdGlvbiAod2luZG93U2l6ZSkge1xuXHQgICAgcmV0dXJuIG5ldyBXaW5kb3dlZE9ic2VydmFibGUodGhpcywgd2luZG93U2l6ZSk7XG5cdCAgfTtcblx0XG5cdCAgLyoqXG5cdCAgICogUGlwZXMgdGhlIGV4aXN0aW5nIE9ic2VydmFibGUgc2VxdWVuY2UgaW50byBhIE5vZGUuanMgU3RyZWFtLlxuXHQgICAqIEBwYXJhbSB7U3RyZWFtfSBkZXN0IFRoZSBkZXN0aW5hdGlvbiBOb2RlLmpzIHN0cmVhbS5cblx0ICAgKiBAcmV0dXJucyB7U3RyZWFtfSBUaGUgZGVzdGluYXRpb24gc3RyZWFtLlxuXHQgICAqL1xuXHQgIG9ic2VydmFibGVQcm90by5waXBlID0gZnVuY3Rpb24gKGRlc3QpIHtcblx0ICAgIHZhciBzb3VyY2UgPSB0aGlzLnBhdXNhYmxlQnVmZmVyZWQoKTtcblx0XG5cdCAgICBmdW5jdGlvbiBvbkRyYWluKCkge1xuXHQgICAgICBzb3VyY2UucmVzdW1lKCk7XG5cdCAgICB9XG5cdFxuXHQgICAgZGVzdC5hZGRMaXN0ZW5lcignZHJhaW4nLCBvbkRyYWluKTtcblx0XG5cdCAgICBzb3VyY2Uuc3Vic2NyaWJlKFxuXHQgICAgICBmdW5jdGlvbiAoeCkge1xuXHQgICAgICAgICFkZXN0LndyaXRlKFN0cmluZyh4KSkgJiYgc291cmNlLnBhdXNlKCk7XG5cdCAgICAgIH0sXG5cdCAgICAgIGZ1bmN0aW9uIChlcnIpIHtcblx0ICAgICAgICBkZXN0LmVtaXQoJ2Vycm9yJywgZXJyKTtcblx0ICAgICAgfSxcblx0ICAgICAgZnVuY3Rpb24gKCkge1xuXHQgICAgICAgIC8vIEhhY2sgY2hlY2sgYmVjYXVzZSBTVERJTyBpcyBub3QgY2xvc2FibGVcblx0ICAgICAgICAhZGVzdC5faXNTdGRpbyAmJiBkZXN0LmVuZCgpO1xuXHQgICAgICAgIGRlc3QucmVtb3ZlTGlzdGVuZXIoJ2RyYWluJywgb25EcmFpbik7XG5cdCAgICAgIH0pO1xuXHRcblx0ICAgIHNvdXJjZS5yZXN1bWUoKTtcblx0XG5cdCAgICByZXR1cm4gZGVzdDtcblx0ICB9O1xuXHRcblx0ICB2YXIgTXVsdGljYXN0T2JzZXJ2YWJsZSA9IChmdW5jdGlvbiAoX19zdXBlcl9fKSB7XG5cdCAgICBpbmhlcml0cyhNdWx0aWNhc3RPYnNlcnZhYmxlLCBfX3N1cGVyX18pO1xuXHQgICAgZnVuY3Rpb24gTXVsdGljYXN0T2JzZXJ2YWJsZShzb3VyY2UsIGZuMSwgZm4yKSB7XG5cdCAgICAgIHRoaXMuc291cmNlID0gc291cmNlO1xuXHQgICAgICB0aGlzLl9mbjEgPSBmbjE7XG5cdCAgICAgIHRoaXMuX2ZuMiA9IGZuMjtcblx0ICAgICAgX19zdXBlcl9fLmNhbGwodGhpcyk7XG5cdCAgICB9XG5cdFxuXHQgICAgTXVsdGljYXN0T2JzZXJ2YWJsZS5wcm90b3R5cGUuc3Vic2NyaWJlQ29yZSA9IGZ1bmN0aW9uIChvKSB7XG5cdCAgICAgIHZhciBjb25uZWN0YWJsZSA9IHRoaXMuc291cmNlLm11bHRpY2FzdCh0aGlzLl9mbjEoKSk7XG5cdCAgICAgIHJldHVybiBuZXcgQmluYXJ5RGlzcG9zYWJsZSh0aGlzLl9mbjIoY29ubmVjdGFibGUpLnN1YnNjcmliZShvKSwgY29ubmVjdGFibGUuY29ubmVjdCgpKTtcblx0ICAgIH07XG5cdFxuXHQgICAgcmV0dXJuIE11bHRpY2FzdE9ic2VydmFibGU7XG5cdCAgfShPYnNlcnZhYmxlQmFzZSkpO1xuXHRcblx0ICAvKipcblx0ICAgKiBNdWx0aWNhc3RzIHRoZSBzb3VyY2Ugc2VxdWVuY2Ugbm90aWZpY2F0aW9ucyB0aHJvdWdoIGFuIGluc3RhbnRpYXRlZCBzdWJqZWN0IGludG8gYWxsIHVzZXMgb2YgdGhlIHNlcXVlbmNlIHdpdGhpbiBhIHNlbGVjdG9yIGZ1bmN0aW9uLiBFYWNoXG5cdCAgICogc3Vic2NyaXB0aW9uIHRvIHRoZSByZXN1bHRpbmcgc2VxdWVuY2UgY2F1c2VzIGEgc2VwYXJhdGUgbXVsdGljYXN0IGludm9jYXRpb24sIGV4cG9zaW5nIHRoZSBzZXF1ZW5jZSByZXN1bHRpbmcgZnJvbSB0aGUgc2VsZWN0b3IgZnVuY3Rpb24nc1xuXHQgICAqIGludm9jYXRpb24uIEZvciBzcGVjaWFsaXphdGlvbnMgd2l0aCBmaXhlZCBzdWJqZWN0IHR5cGVzLCBzZWUgUHVibGlzaCwgUHVibGlzaExhc3QsIGFuZCBSZXBsYXkuXG5cdCAgICpcblx0ICAgKiBAZXhhbXBsZVxuXHQgICAqIDEgLSByZXMgPSBzb3VyY2UubXVsdGljYXN0KG9ic2VydmFibGUpO1xuXHQgICAqIDIgLSByZXMgPSBzb3VyY2UubXVsdGljYXN0KGZ1bmN0aW9uICgpIHsgcmV0dXJuIG5ldyBTdWJqZWN0KCk7IH0sIGZ1bmN0aW9uICh4KSB7IHJldHVybiB4OyB9KTtcblx0ICAgKlxuXHQgICAqIEBwYXJhbSB7RnVuY3Rpb258U3ViamVjdH0gc3ViamVjdE9yU3ViamVjdFNlbGVjdG9yXG5cdCAgICogRmFjdG9yeSBmdW5jdGlvbiB0byBjcmVhdGUgYW4gaW50ZXJtZWRpYXRlIHN1YmplY3QgdGhyb3VnaCB3aGljaCB0aGUgc291cmNlIHNlcXVlbmNlJ3MgZWxlbWVudHMgd2lsbCBiZSBtdWx0aWNhc3QgdG8gdGhlIHNlbGVjdG9yIGZ1bmN0aW9uLlxuXHQgICAqIE9yOlxuXHQgICAqIFN1YmplY3QgdG8gcHVzaCBzb3VyY2UgZWxlbWVudHMgaW50by5cblx0ICAgKlxuXHQgICAqIEBwYXJhbSB7RnVuY3Rpb259IFtzZWxlY3Rvcl0gT3B0aW9uYWwgc2VsZWN0b3IgZnVuY3Rpb24gd2hpY2ggY2FuIHVzZSB0aGUgbXVsdGljYXN0ZWQgc291cmNlIHNlcXVlbmNlIHN1YmplY3QgdG8gdGhlIHBvbGljaWVzIGVuZm9yY2VkIGJ5IHRoZSBjcmVhdGVkIHN1YmplY3QuIFNwZWNpZmllZCBvbmx5IGlmIDxwYXJhbXJlZiBuYW1lPVwic3ViamVjdE9yU3ViamVjdFNlbGVjdG9yXCIgaXMgYSBmYWN0b3J5IGZ1bmN0aW9uLlxuXHQgICAqIEByZXR1cm5zIHtPYnNlcnZhYmxlfSBBbiBvYnNlcnZhYmxlIHNlcXVlbmNlIHRoYXQgY29udGFpbnMgdGhlIGVsZW1lbnRzIG9mIGEgc2VxdWVuY2UgcHJvZHVjZWQgYnkgbXVsdGljYXN0aW5nIHRoZSBzb3VyY2Ugc2VxdWVuY2Ugd2l0aGluIGEgc2VsZWN0b3IgZnVuY3Rpb24uXG5cdCAgICovXG5cdCAgb2JzZXJ2YWJsZVByb3RvLm11bHRpY2FzdCA9IGZ1bmN0aW9uIChzdWJqZWN0T3JTdWJqZWN0U2VsZWN0b3IsIHNlbGVjdG9yKSB7XG5cdCAgICByZXR1cm4gaXNGdW5jdGlvbihzdWJqZWN0T3JTdWJqZWN0U2VsZWN0b3IpID9cblx0ICAgICAgbmV3IE11bHRpY2FzdE9ic2VydmFibGUodGhpcywgc3ViamVjdE9yU3ViamVjdFNlbGVjdG9yLCBzZWxlY3RvcikgOlxuXHQgICAgICBuZXcgQ29ubmVjdGFibGVPYnNlcnZhYmxlKHRoaXMsIHN1YmplY3RPclN1YmplY3RTZWxlY3Rvcik7XG5cdCAgfTtcblx0XG5cdCAgLyoqXG5cdCAgICogUmV0dXJucyBhbiBvYnNlcnZhYmxlIHNlcXVlbmNlIHRoYXQgaXMgdGhlIHJlc3VsdCBvZiBpbnZva2luZyB0aGUgc2VsZWN0b3Igb24gYSBjb25uZWN0YWJsZSBvYnNlcnZhYmxlIHNlcXVlbmNlIHRoYXQgc2hhcmVzIGEgc2luZ2xlIHN1YnNjcmlwdGlvbiB0byB0aGUgdW5kZXJseWluZyBzZXF1ZW5jZS5cblx0ICAgKiBUaGlzIG9wZXJhdG9yIGlzIGEgc3BlY2lhbGl6YXRpb24gb2YgTXVsdGljYXN0IHVzaW5nIGEgcmVndWxhciBTdWJqZWN0LlxuXHQgICAqXG5cdCAgICogQGV4YW1wbGVcblx0ICAgKiB2YXIgcmVzcmVzID0gc291cmNlLnB1Ymxpc2goKTtcblx0ICAgKiB2YXIgcmVzID0gc291cmNlLnB1Ymxpc2goZnVuY3Rpb24gKHgpIHsgcmV0dXJuIHg7IH0pO1xuXHQgICAqXG5cdCAgICogQHBhcmFtIHtGdW5jdGlvbn0gW3NlbGVjdG9yXSBTZWxlY3RvciBmdW5jdGlvbiB3aGljaCBjYW4gdXNlIHRoZSBtdWx0aWNhc3RlZCBzb3VyY2Ugc2VxdWVuY2UgYXMgbWFueSB0aW1lcyBhcyBuZWVkZWQsIHdpdGhvdXQgY2F1c2luZyBtdWx0aXBsZSBzdWJzY3JpcHRpb25zIHRvIHRoZSBzb3VyY2Ugc2VxdWVuY2UuIFN1YnNjcmliZXJzIHRvIHRoZSBnaXZlbiBzb3VyY2Ugd2lsbCByZWNlaXZlIGFsbCBub3RpZmljYXRpb25zIG9mIHRoZSBzb3VyY2UgZnJvbSB0aGUgdGltZSBvZiB0aGUgc3Vic2NyaXB0aW9uIG9uLlxuXHQgICAqIEByZXR1cm5zIHtPYnNlcnZhYmxlfSBBbiBvYnNlcnZhYmxlIHNlcXVlbmNlIHRoYXQgY29udGFpbnMgdGhlIGVsZW1lbnRzIG9mIGEgc2VxdWVuY2UgcHJvZHVjZWQgYnkgbXVsdGljYXN0aW5nIHRoZSBzb3VyY2Ugc2VxdWVuY2Ugd2l0aGluIGEgc2VsZWN0b3IgZnVuY3Rpb24uXG5cdCAgICovXG5cdCAgb2JzZXJ2YWJsZVByb3RvLnB1Ymxpc2ggPSBmdW5jdGlvbiAoc2VsZWN0b3IpIHtcblx0ICAgIHJldHVybiBzZWxlY3RvciAmJiBpc0Z1bmN0aW9uKHNlbGVjdG9yKSA/XG5cdCAgICAgIHRoaXMubXVsdGljYXN0KGZ1bmN0aW9uICgpIHsgcmV0dXJuIG5ldyBTdWJqZWN0KCk7IH0sIHNlbGVjdG9yKSA6XG5cdCAgICAgIHRoaXMubXVsdGljYXN0KG5ldyBTdWJqZWN0KCkpO1xuXHQgIH07XG5cdFxuXHQgIC8qKlxuXHQgICAqIFJldHVybnMgYW4gb2JzZXJ2YWJsZSBzZXF1ZW5jZSB0aGF0IHNoYXJlcyBhIHNpbmdsZSBzdWJzY3JpcHRpb24gdG8gdGhlIHVuZGVybHlpbmcgc2VxdWVuY2UuXG5cdCAgICogVGhpcyBvcGVyYXRvciBpcyBhIHNwZWNpYWxpemF0aW9uIG9mIHB1Ymxpc2ggd2hpY2ggY3JlYXRlcyBhIHN1YnNjcmlwdGlvbiB3aGVuIHRoZSBudW1iZXIgb2Ygb2JzZXJ2ZXJzIGdvZXMgZnJvbSB6ZXJvIHRvIG9uZSwgdGhlbiBzaGFyZXMgdGhhdCBzdWJzY3JpcHRpb24gd2l0aCBhbGwgc3Vic2VxdWVudCBvYnNlcnZlcnMgdW50aWwgdGhlIG51bWJlciBvZiBvYnNlcnZlcnMgcmV0dXJucyB0byB6ZXJvLCBhdCB3aGljaCBwb2ludCB0aGUgc3Vic2NyaXB0aW9uIGlzIGRpc3Bvc2VkLlxuXHQgICAqIEByZXR1cm5zIHtPYnNlcnZhYmxlfSBBbiBvYnNlcnZhYmxlIHNlcXVlbmNlIHRoYXQgY29udGFpbnMgdGhlIGVsZW1lbnRzIG9mIGEgc2VxdWVuY2UgcHJvZHVjZWQgYnkgbXVsdGljYXN0aW5nIHRoZSBzb3VyY2Ugc2VxdWVuY2UuXG5cdCAgICovXG5cdCAgb2JzZXJ2YWJsZVByb3RvLnNoYXJlID0gZnVuY3Rpb24gKCkge1xuXHQgICAgcmV0dXJuIHRoaXMucHVibGlzaCgpLnJlZkNvdW50KCk7XG5cdCAgfTtcblx0XG5cdCAgLyoqXG5cdCAgICogUmV0dXJucyBhbiBvYnNlcnZhYmxlIHNlcXVlbmNlIHRoYXQgaXMgdGhlIHJlc3VsdCBvZiBpbnZva2luZyB0aGUgc2VsZWN0b3Igb24gYSBjb25uZWN0YWJsZSBvYnNlcnZhYmxlIHNlcXVlbmNlIHRoYXQgc2hhcmVzIGEgc2luZ2xlIHN1YnNjcmlwdGlvbiB0byB0aGUgdW5kZXJseWluZyBzZXF1ZW5jZSBjb250YWluaW5nIG9ubHkgdGhlIGxhc3Qgbm90aWZpY2F0aW9uLlxuXHQgICAqIFRoaXMgb3BlcmF0b3IgaXMgYSBzcGVjaWFsaXphdGlvbiBvZiBNdWx0aWNhc3QgdXNpbmcgYSBBc3luY1N1YmplY3QuXG5cdCAgICpcblx0ICAgKiBAZXhhbXBsZVxuXHQgICAqIHZhciByZXMgPSBzb3VyY2UucHVibGlzaExhc3QoKTtcblx0ICAgKiB2YXIgcmVzID0gc291cmNlLnB1Ymxpc2hMYXN0KGZ1bmN0aW9uICh4KSB7IHJldHVybiB4OyB9KTtcblx0ICAgKlxuXHQgICAqIEBwYXJhbSBzZWxlY3RvciBbT3B0aW9uYWxdIFNlbGVjdG9yIGZ1bmN0aW9uIHdoaWNoIGNhbiB1c2UgdGhlIG11bHRpY2FzdGVkIHNvdXJjZSBzZXF1ZW5jZSBhcyBtYW55IHRpbWVzIGFzIG5lZWRlZCwgd2l0aG91dCBjYXVzaW5nIG11bHRpcGxlIHN1YnNjcmlwdGlvbnMgdG8gdGhlIHNvdXJjZSBzZXF1ZW5jZS4gU3Vic2NyaWJlcnMgdG8gdGhlIGdpdmVuIHNvdXJjZSB3aWxsIG9ubHkgcmVjZWl2ZSB0aGUgbGFzdCBub3RpZmljYXRpb24gb2YgdGhlIHNvdXJjZS5cblx0ICAgKiBAcmV0dXJucyB7T2JzZXJ2YWJsZX0gQW4gb2JzZXJ2YWJsZSBzZXF1ZW5jZSB0aGF0IGNvbnRhaW5zIHRoZSBlbGVtZW50cyBvZiBhIHNlcXVlbmNlIHByb2R1Y2VkIGJ5IG11bHRpY2FzdGluZyB0aGUgc291cmNlIHNlcXVlbmNlIHdpdGhpbiBhIHNlbGVjdG9yIGZ1bmN0aW9uLlxuXHQgICAqL1xuXHQgIG9ic2VydmFibGVQcm90by5wdWJsaXNoTGFzdCA9IGZ1bmN0aW9uIChzZWxlY3Rvcikge1xuXHQgICAgcmV0dXJuIHNlbGVjdG9yICYmIGlzRnVuY3Rpb24oc2VsZWN0b3IpID9cblx0ICAgICAgdGhpcy5tdWx0aWNhc3QoZnVuY3Rpb24gKCkgeyByZXR1cm4gbmV3IEFzeW5jU3ViamVjdCgpOyB9LCBzZWxlY3RvcikgOlxuXHQgICAgICB0aGlzLm11bHRpY2FzdChuZXcgQXN5bmNTdWJqZWN0KCkpO1xuXHQgIH07XG5cdFxuXHQgIC8qKlxuXHQgICAqIFJldHVybnMgYW4gb2JzZXJ2YWJsZSBzZXF1ZW5jZSB0aGF0IGlzIHRoZSByZXN1bHQgb2YgaW52b2tpbmcgdGhlIHNlbGVjdG9yIG9uIGEgY29ubmVjdGFibGUgb2JzZXJ2YWJsZSBzZXF1ZW5jZSB0aGF0IHNoYXJlcyBhIHNpbmdsZSBzdWJzY3JpcHRpb24gdG8gdGhlIHVuZGVybHlpbmcgc2VxdWVuY2UgYW5kIHN0YXJ0cyB3aXRoIGluaXRpYWxWYWx1ZS5cblx0ICAgKiBUaGlzIG9wZXJhdG9yIGlzIGEgc3BlY2lhbGl6YXRpb24gb2YgTXVsdGljYXN0IHVzaW5nIGEgQmVoYXZpb3JTdWJqZWN0LlxuXHQgICAqXG5cdCAgICogQGV4YW1wbGVcblx0ICAgKiB2YXIgcmVzID0gc291cmNlLnB1Ymxpc2hWYWx1ZSg0Mik7XG5cdCAgICogdmFyIHJlcyA9IHNvdXJjZS5wdWJsaXNoVmFsdWUoZnVuY3Rpb24gKHgpIHsgcmV0dXJuIHguc2VsZWN0KGZ1bmN0aW9uICh5KSB7IHJldHVybiB5ICogeTsgfSkgfSwgNDIpO1xuXHQgICAqXG5cdCAgICogQHBhcmFtIHtGdW5jdGlvbn0gW3NlbGVjdG9yXSBPcHRpb25hbCBzZWxlY3RvciBmdW5jdGlvbiB3aGljaCBjYW4gdXNlIHRoZSBtdWx0aWNhc3RlZCBzb3VyY2Ugc2VxdWVuY2UgYXMgbWFueSB0aW1lcyBhcyBuZWVkZWQsIHdpdGhvdXQgY2F1c2luZyBtdWx0aXBsZSBzdWJzY3JpcHRpb25zIHRvIHRoZSBzb3VyY2Ugc2VxdWVuY2UuIFN1YnNjcmliZXJzIHRvIHRoZSBnaXZlbiBzb3VyY2Ugd2lsbCByZWNlaXZlIGltbWVkaWF0ZWx5IHJlY2VpdmUgdGhlIGluaXRpYWwgdmFsdWUsIGZvbGxvd2VkIGJ5IGFsbCBub3RpZmljYXRpb25zIG9mIHRoZSBzb3VyY2UgZnJvbSB0aGUgdGltZSBvZiB0aGUgc3Vic2NyaXB0aW9uIG9uLlxuXHQgICAqIEBwYXJhbSB7TWl4ZWR9IGluaXRpYWxWYWx1ZSBJbml0aWFsIHZhbHVlIHJlY2VpdmVkIGJ5IG9ic2VydmVycyB1cG9uIHN1YnNjcmlwdGlvbi5cblx0ICAgKiBAcmV0dXJucyB7T2JzZXJ2YWJsZX0gQW4gb2JzZXJ2YWJsZSBzZXF1ZW5jZSB0aGF0IGNvbnRhaW5zIHRoZSBlbGVtZW50cyBvZiBhIHNlcXVlbmNlIHByb2R1Y2VkIGJ5IG11bHRpY2FzdGluZyB0aGUgc291cmNlIHNlcXVlbmNlIHdpdGhpbiBhIHNlbGVjdG9yIGZ1bmN0aW9uLlxuXHQgICAqL1xuXHQgIG9ic2VydmFibGVQcm90by5wdWJsaXNoVmFsdWUgPSBmdW5jdGlvbiAoaW5pdGlhbFZhbHVlT3JTZWxlY3RvciwgaW5pdGlhbFZhbHVlKSB7XG5cdCAgICByZXR1cm4gYXJndW1lbnRzLmxlbmd0aCA9PT0gMiA/XG5cdCAgICAgIHRoaXMubXVsdGljYXN0KGZ1bmN0aW9uICgpIHtcblx0ICAgICAgICByZXR1cm4gbmV3IEJlaGF2aW9yU3ViamVjdChpbml0aWFsVmFsdWUpO1xuXHQgICAgICB9LCBpbml0aWFsVmFsdWVPclNlbGVjdG9yKSA6XG5cdCAgICAgIHRoaXMubXVsdGljYXN0KG5ldyBCZWhhdmlvclN1YmplY3QoaW5pdGlhbFZhbHVlT3JTZWxlY3RvcikpO1xuXHQgIH07XG5cdFxuXHQgIC8qKlxuXHQgICAqIFJldHVybnMgYW4gb2JzZXJ2YWJsZSBzZXF1ZW5jZSB0aGF0IHNoYXJlcyBhIHNpbmdsZSBzdWJzY3JpcHRpb24gdG8gdGhlIHVuZGVybHlpbmcgc2VxdWVuY2UgYW5kIHN0YXJ0cyB3aXRoIGFuIGluaXRpYWxWYWx1ZS5cblx0ICAgKiBUaGlzIG9wZXJhdG9yIGlzIGEgc3BlY2lhbGl6YXRpb24gb2YgcHVibGlzaFZhbHVlIHdoaWNoIGNyZWF0ZXMgYSBzdWJzY3JpcHRpb24gd2hlbiB0aGUgbnVtYmVyIG9mIG9ic2VydmVycyBnb2VzIGZyb20gemVybyB0byBvbmUsIHRoZW4gc2hhcmVzIHRoYXQgc3Vic2NyaXB0aW9uIHdpdGggYWxsIHN1YnNlcXVlbnQgb2JzZXJ2ZXJzIHVudGlsIHRoZSBudW1iZXIgb2Ygb2JzZXJ2ZXJzIHJldHVybnMgdG8gemVybywgYXQgd2hpY2ggcG9pbnQgdGhlIHN1YnNjcmlwdGlvbiBpcyBkaXNwb3NlZC5cblx0ICAgKiBAcGFyYW0ge01peGVkfSBpbml0aWFsVmFsdWUgSW5pdGlhbCB2YWx1ZSByZWNlaXZlZCBieSBvYnNlcnZlcnMgdXBvbiBzdWJzY3JpcHRpb24uXG5cdCAgICogQHJldHVybnMge09ic2VydmFibGV9IEFuIG9ic2VydmFibGUgc2VxdWVuY2UgdGhhdCBjb250YWlucyB0aGUgZWxlbWVudHMgb2YgYSBzZXF1ZW5jZSBwcm9kdWNlZCBieSBtdWx0aWNhc3RpbmcgdGhlIHNvdXJjZSBzZXF1ZW5jZS5cblx0ICAgKi9cblx0ICBvYnNlcnZhYmxlUHJvdG8uc2hhcmVWYWx1ZSA9IGZ1bmN0aW9uIChpbml0aWFsVmFsdWUpIHtcblx0ICAgIHJldHVybiB0aGlzLnB1Ymxpc2hWYWx1ZShpbml0aWFsVmFsdWUpLnJlZkNvdW50KCk7XG5cdCAgfTtcblx0XG5cdCAgLyoqXG5cdCAgICogUmV0dXJucyBhbiBvYnNlcnZhYmxlIHNlcXVlbmNlIHRoYXQgaXMgdGhlIHJlc3VsdCBvZiBpbnZva2luZyB0aGUgc2VsZWN0b3Igb24gYSBjb25uZWN0YWJsZSBvYnNlcnZhYmxlIHNlcXVlbmNlIHRoYXQgc2hhcmVzIGEgc2luZ2xlIHN1YnNjcmlwdGlvbiB0byB0aGUgdW5kZXJseWluZyBzZXF1ZW5jZSByZXBsYXlpbmcgbm90aWZpY2F0aW9ucyBzdWJqZWN0IHRvIGEgbWF4aW11bSB0aW1lIGxlbmd0aCBmb3IgdGhlIHJlcGxheSBidWZmZXIuXG5cdCAgICogVGhpcyBvcGVyYXRvciBpcyBhIHNwZWNpYWxpemF0aW9uIG9mIE11bHRpY2FzdCB1c2luZyBhIFJlcGxheVN1YmplY3QuXG5cdCAgICpcblx0ICAgKiBAZXhhbXBsZVxuXHQgICAqIHZhciByZXMgPSBzb3VyY2UucmVwbGF5KG51bGwsIDMpO1xuXHQgICAqIHZhciByZXMgPSBzb3VyY2UucmVwbGF5KG51bGwsIDMsIDUwMCk7XG5cdCAgICogdmFyIHJlcyA9IHNvdXJjZS5yZXBsYXkobnVsbCwgMywgNTAwLCBzY2hlZHVsZXIpO1xuXHQgICAqIHZhciByZXMgPSBzb3VyY2UucmVwbGF5KGZ1bmN0aW9uICh4KSB7IHJldHVybiB4LnRha2UoNikucmVwZWF0KCk7IH0sIDMsIDUwMCwgc2NoZWR1bGVyKTtcblx0ICAgKlxuXHQgICAqIEBwYXJhbSBzZWxlY3RvciBbT3B0aW9uYWxdIFNlbGVjdG9yIGZ1bmN0aW9uIHdoaWNoIGNhbiB1c2UgdGhlIG11bHRpY2FzdGVkIHNvdXJjZSBzZXF1ZW5jZSBhcyBtYW55IHRpbWVzIGFzIG5lZWRlZCwgd2l0aG91dCBjYXVzaW5nIG11bHRpcGxlIHN1YnNjcmlwdGlvbnMgdG8gdGhlIHNvdXJjZSBzZXF1ZW5jZS4gU3Vic2NyaWJlcnMgdG8gdGhlIGdpdmVuIHNvdXJjZSB3aWxsIHJlY2VpdmUgYWxsIHRoZSBub3RpZmljYXRpb25zIG9mIHRoZSBzb3VyY2Ugc3ViamVjdCB0byB0aGUgc3BlY2lmaWVkIHJlcGxheSBidWZmZXIgdHJpbW1pbmcgcG9saWN5LlxuXHQgICAqIEBwYXJhbSBidWZmZXJTaXplIFtPcHRpb25hbF0gTWF4aW11bSBlbGVtZW50IGNvdW50IG9mIHRoZSByZXBsYXkgYnVmZmVyLlxuXHQgICAqIEBwYXJhbSB3aW5kb3dTaXplIFtPcHRpb25hbF0gTWF4aW11bSB0aW1lIGxlbmd0aCBvZiB0aGUgcmVwbGF5IGJ1ZmZlci5cblx0ICAgKiBAcGFyYW0gc2NoZWR1bGVyIFtPcHRpb25hbF0gU2NoZWR1bGVyIHdoZXJlIGNvbm5lY3RlZCBvYnNlcnZlcnMgd2l0aGluIHRoZSBzZWxlY3RvciBmdW5jdGlvbiB3aWxsIGJlIGludm9rZWQgb24uXG5cdCAgICogQHJldHVybnMge09ic2VydmFibGV9IEFuIG9ic2VydmFibGUgc2VxdWVuY2UgdGhhdCBjb250YWlucyB0aGUgZWxlbWVudHMgb2YgYSBzZXF1ZW5jZSBwcm9kdWNlZCBieSBtdWx0aWNhc3RpbmcgdGhlIHNvdXJjZSBzZXF1ZW5jZSB3aXRoaW4gYSBzZWxlY3RvciBmdW5jdGlvbi5cblx0ICAgKi9cblx0ICBvYnNlcnZhYmxlUHJvdG8ucmVwbGF5ID0gZnVuY3Rpb24gKHNlbGVjdG9yLCBidWZmZXJTaXplLCB3aW5kb3dTaXplLCBzY2hlZHVsZXIpIHtcblx0ICAgIHJldHVybiBzZWxlY3RvciAmJiBpc0Z1bmN0aW9uKHNlbGVjdG9yKSA/XG5cdCAgICAgIHRoaXMubXVsdGljYXN0KGZ1bmN0aW9uICgpIHsgcmV0dXJuIG5ldyBSZXBsYXlTdWJqZWN0KGJ1ZmZlclNpemUsIHdpbmRvd1NpemUsIHNjaGVkdWxlcik7IH0sIHNlbGVjdG9yKSA6XG5cdCAgICAgIHRoaXMubXVsdGljYXN0KG5ldyBSZXBsYXlTdWJqZWN0KGJ1ZmZlclNpemUsIHdpbmRvd1NpemUsIHNjaGVkdWxlcikpO1xuXHQgIH07XG5cdFxuXHQgIC8qKlxuXHQgICAqIFJldHVybnMgYW4gb2JzZXJ2YWJsZSBzZXF1ZW5jZSB0aGF0IHNoYXJlcyBhIHNpbmdsZSBzdWJzY3JpcHRpb24gdG8gdGhlIHVuZGVybHlpbmcgc2VxdWVuY2UgcmVwbGF5aW5nIG5vdGlmaWNhdGlvbnMgc3ViamVjdCB0byBhIG1heGltdW0gdGltZSBsZW5ndGggZm9yIHRoZSByZXBsYXkgYnVmZmVyLlxuXHQgICAqIFRoaXMgb3BlcmF0b3IgaXMgYSBzcGVjaWFsaXphdGlvbiBvZiByZXBsYXkgd2hpY2ggY3JlYXRlcyBhIHN1YnNjcmlwdGlvbiB3aGVuIHRoZSBudW1iZXIgb2Ygb2JzZXJ2ZXJzIGdvZXMgZnJvbSB6ZXJvIHRvIG9uZSwgdGhlbiBzaGFyZXMgdGhhdCBzdWJzY3JpcHRpb24gd2l0aCBhbGwgc3Vic2VxdWVudCBvYnNlcnZlcnMgdW50aWwgdGhlIG51bWJlciBvZiBvYnNlcnZlcnMgcmV0dXJucyB0byB6ZXJvLCBhdCB3aGljaCBwb2ludCB0aGUgc3Vic2NyaXB0aW9uIGlzIGRpc3Bvc2VkLlxuXHQgICAqXG5cdCAgICogQGV4YW1wbGVcblx0ICAgKiB2YXIgcmVzID0gc291cmNlLnNoYXJlUmVwbGF5KDMpO1xuXHQgICAqIHZhciByZXMgPSBzb3VyY2Uuc2hhcmVSZXBsYXkoMywgNTAwKTtcblx0ICAgKiB2YXIgcmVzID0gc291cmNlLnNoYXJlUmVwbGF5KDMsIDUwMCwgc2NoZWR1bGVyKTtcblx0ICAgKlxuXHRcblx0ICAgKiBAcGFyYW0gYnVmZmVyU2l6ZSBbT3B0aW9uYWxdIE1heGltdW0gZWxlbWVudCBjb3VudCBvZiB0aGUgcmVwbGF5IGJ1ZmZlci5cblx0ICAgKiBAcGFyYW0gd2luZG93IFtPcHRpb25hbF0gTWF4aW11bSB0aW1lIGxlbmd0aCBvZiB0aGUgcmVwbGF5IGJ1ZmZlci5cblx0ICAgKiBAcGFyYW0gc2NoZWR1bGVyIFtPcHRpb25hbF0gU2NoZWR1bGVyIHdoZXJlIGNvbm5lY3RlZCBvYnNlcnZlcnMgd2l0aGluIHRoZSBzZWxlY3RvciBmdW5jdGlvbiB3aWxsIGJlIGludm9rZWQgb24uXG5cdCAgICogQHJldHVybnMge09ic2VydmFibGV9IEFuIG9ic2VydmFibGUgc2VxdWVuY2UgdGhhdCBjb250YWlucyB0aGUgZWxlbWVudHMgb2YgYSBzZXF1ZW5jZSBwcm9kdWNlZCBieSBtdWx0aWNhc3RpbmcgdGhlIHNvdXJjZSBzZXF1ZW5jZS5cblx0ICAgKi9cblx0ICBvYnNlcnZhYmxlUHJvdG8uc2hhcmVSZXBsYXkgPSBmdW5jdGlvbiAoYnVmZmVyU2l6ZSwgd2luZG93U2l6ZSwgc2NoZWR1bGVyKSB7XG5cdCAgICByZXR1cm4gdGhpcy5yZXBsYXkobnVsbCwgYnVmZmVyU2l6ZSwgd2luZG93U2l6ZSwgc2NoZWR1bGVyKS5yZWZDb3VudCgpO1xuXHQgIH07XG5cdFxuXHQgIHZhciBJbm5lclN1YnNjcmlwdGlvbiA9IGZ1bmN0aW9uIChzLCBvKSB7XG5cdCAgICB0aGlzLl9zID0gcztcblx0ICAgIHRoaXMuX28gPSBvO1xuXHQgIH07XG5cdFxuXHQgIElubmVyU3Vic2NyaXB0aW9uLnByb3RvdHlwZS5kaXNwb3NlID0gZnVuY3Rpb24gKCkge1xuXHQgICAgaWYgKCF0aGlzLl9zLmlzRGlzcG9zZWQgJiYgdGhpcy5fbyAhPT0gbnVsbCkge1xuXHQgICAgICB2YXIgaWR4ID0gdGhpcy5fcy5vYnNlcnZlcnMuaW5kZXhPZih0aGlzLl9vKTtcblx0ICAgICAgdGhpcy5fcy5vYnNlcnZlcnMuc3BsaWNlKGlkeCwgMSk7XG5cdCAgICAgIHRoaXMuX28gPSBudWxsO1xuXHQgICAgfVxuXHQgIH07XG5cdFxuXHQgIC8qKlxuXHQgICAqICBSZXByZXNlbnRzIGEgdmFsdWUgdGhhdCBjaGFuZ2VzIG92ZXIgdGltZS5cblx0ICAgKiAgT2JzZXJ2ZXJzIGNhbiBzdWJzY3JpYmUgdG8gdGhlIHN1YmplY3QgdG8gcmVjZWl2ZSB0aGUgbGFzdCAob3IgaW5pdGlhbCkgdmFsdWUgYW5kIGFsbCBzdWJzZXF1ZW50IG5vdGlmaWNhdGlvbnMuXG5cdCAgICovXG5cdCAgdmFyIEJlaGF2aW9yU3ViamVjdCA9IFJ4LkJlaGF2aW9yU3ViamVjdCA9IChmdW5jdGlvbiAoX19zdXBlcl9fKSB7XG5cdCAgICBpbmhlcml0cyhCZWhhdmlvclN1YmplY3QsIF9fc3VwZXJfXyk7XG5cdCAgICBmdW5jdGlvbiBCZWhhdmlvclN1YmplY3QodmFsdWUpIHtcblx0ICAgICAgX19zdXBlcl9fLmNhbGwodGhpcyk7XG5cdCAgICAgIHRoaXMudmFsdWUgPSB2YWx1ZTtcblx0ICAgICAgdGhpcy5vYnNlcnZlcnMgPSBbXTtcblx0ICAgICAgdGhpcy5pc0Rpc3Bvc2VkID0gZmFsc2U7XG5cdCAgICAgIHRoaXMuaXNTdG9wcGVkID0gZmFsc2U7XG5cdCAgICAgIHRoaXMuaGFzRXJyb3IgPSBmYWxzZTtcblx0ICAgIH1cblx0XG5cdCAgICBhZGRQcm9wZXJ0aWVzKEJlaGF2aW9yU3ViamVjdC5wcm90b3R5cGUsIE9ic2VydmVyLCB7XG5cdCAgICAgIF9zdWJzY3JpYmU6IGZ1bmN0aW9uIChvKSB7XG5cdCAgICAgICAgY2hlY2tEaXNwb3NlZCh0aGlzKTtcblx0ICAgICAgICBpZiAoIXRoaXMuaXNTdG9wcGVkKSB7XG5cdCAgICAgICAgICB0aGlzLm9ic2VydmVycy5wdXNoKG8pO1xuXHQgICAgICAgICAgby5vbk5leHQodGhpcy52YWx1ZSk7XG5cdCAgICAgICAgICByZXR1cm4gbmV3IElubmVyU3Vic2NyaXB0aW9uKHRoaXMsIG8pO1xuXHQgICAgICAgIH1cblx0ICAgICAgICBpZiAodGhpcy5oYXNFcnJvcikge1xuXHQgICAgICAgICAgby5vbkVycm9yKHRoaXMuZXJyb3IpO1xuXHQgICAgICAgIH0gZWxzZSB7XG5cdCAgICAgICAgICBvLm9uQ29tcGxldGVkKCk7XG5cdCAgICAgICAgfVxuXHQgICAgICAgIHJldHVybiBkaXNwb3NhYmxlRW1wdHk7XG5cdCAgICAgIH0sXG5cdCAgICAgIC8qKlxuXHQgICAgICAgKiBHZXRzIHRoZSBjdXJyZW50IHZhbHVlIG9yIHRocm93cyBhbiBleGNlcHRpb24uXG5cdCAgICAgICAqIFZhbHVlIGlzIGZyb3plbiBhZnRlciBvbkNvbXBsZXRlZCBpcyBjYWxsZWQuXG5cdCAgICAgICAqIEFmdGVyIG9uRXJyb3IgaXMgY2FsbGVkIGFsd2F5cyB0aHJvd3MgdGhlIHNwZWNpZmllZCBleGNlcHRpb24uXG5cdCAgICAgICAqIEFuIGV4Y2VwdGlvbiBpcyBhbHdheXMgdGhyb3duIGFmdGVyIGRpc3Bvc2UgaXMgY2FsbGVkLlxuXHQgICAgICAgKiBAcmV0dXJucyB7TWl4ZWR9IFRoZSBpbml0aWFsIHZhbHVlIHBhc3NlZCB0byB0aGUgY29uc3RydWN0b3IgdW50aWwgb25OZXh0IGlzIGNhbGxlZDsgYWZ0ZXIgd2hpY2gsIHRoZSBsYXN0IHZhbHVlIHBhc3NlZCB0byBvbk5leHQuXG5cdCAgICAgICAqL1xuXHQgICAgICBnZXRWYWx1ZTogZnVuY3Rpb24gKCkge1xuXHQgICAgICAgICAgY2hlY2tEaXNwb3NlZCh0aGlzKTtcblx0ICAgICAgICAgIGlmICh0aGlzLmhhc0Vycm9yKSB7XG5cdCAgICAgICAgICAgICAgdGhyb3cgdGhpcy5lcnJvcjtcblx0ICAgICAgICAgIH1cblx0ICAgICAgICAgIHJldHVybiB0aGlzLnZhbHVlO1xuXHQgICAgICB9LFxuXHQgICAgICAvKipcblx0ICAgICAgICogSW5kaWNhdGVzIHdoZXRoZXIgdGhlIHN1YmplY3QgaGFzIG9ic2VydmVycyBzdWJzY3JpYmVkIHRvIGl0LlxuXHQgICAgICAgKiBAcmV0dXJucyB7Qm9vbGVhbn0gSW5kaWNhdGVzIHdoZXRoZXIgdGhlIHN1YmplY3QgaGFzIG9ic2VydmVycyBzdWJzY3JpYmVkIHRvIGl0LlxuXHQgICAgICAgKi9cblx0ICAgICAgaGFzT2JzZXJ2ZXJzOiBmdW5jdGlvbiAoKSB7IHJldHVybiB0aGlzLm9ic2VydmVycy5sZW5ndGggPiAwOyB9LFxuXHQgICAgICAvKipcblx0ICAgICAgICogTm90aWZpZXMgYWxsIHN1YnNjcmliZWQgb2JzZXJ2ZXJzIGFib3V0IHRoZSBlbmQgb2YgdGhlIHNlcXVlbmNlLlxuXHQgICAgICAgKi9cblx0ICAgICAgb25Db21wbGV0ZWQ6IGZ1bmN0aW9uICgpIHtcblx0ICAgICAgICBjaGVja0Rpc3Bvc2VkKHRoaXMpO1xuXHQgICAgICAgIGlmICh0aGlzLmlzU3RvcHBlZCkgeyByZXR1cm47IH1cblx0ICAgICAgICB0aGlzLmlzU3RvcHBlZCA9IHRydWU7XG5cdCAgICAgICAgZm9yICh2YXIgaSA9IDAsIG9zID0gY2xvbmVBcnJheSh0aGlzLm9ic2VydmVycyksIGxlbiA9IG9zLmxlbmd0aDsgaSA8IGxlbjsgaSsrKSB7XG5cdCAgICAgICAgICBvc1tpXS5vbkNvbXBsZXRlZCgpO1xuXHQgICAgICAgIH1cblx0XG5cdCAgICAgICAgdGhpcy5vYnNlcnZlcnMubGVuZ3RoID0gMDtcblx0ICAgICAgfSxcblx0ICAgICAgLyoqXG5cdCAgICAgICAqIE5vdGlmaWVzIGFsbCBzdWJzY3JpYmVkIG9ic2VydmVycyBhYm91dCB0aGUgZXhjZXB0aW9uLlxuXHQgICAgICAgKiBAcGFyYW0ge01peGVkfSBlcnJvciBUaGUgZXhjZXB0aW9uIHRvIHNlbmQgdG8gYWxsIG9ic2VydmVycy5cblx0ICAgICAgICovXG5cdCAgICAgIG9uRXJyb3I6IGZ1bmN0aW9uIChlcnJvcikge1xuXHQgICAgICAgIGNoZWNrRGlzcG9zZWQodGhpcyk7XG5cdCAgICAgICAgaWYgKHRoaXMuaXNTdG9wcGVkKSB7IHJldHVybjsgfVxuXHQgICAgICAgIHRoaXMuaXNTdG9wcGVkID0gdHJ1ZTtcblx0ICAgICAgICB0aGlzLmhhc0Vycm9yID0gdHJ1ZTtcblx0ICAgICAgICB0aGlzLmVycm9yID0gZXJyb3I7XG5cdFxuXHQgICAgICAgIGZvciAodmFyIGkgPSAwLCBvcyA9IGNsb25lQXJyYXkodGhpcy5vYnNlcnZlcnMpLCBsZW4gPSBvcy5sZW5ndGg7IGkgPCBsZW47IGkrKykge1xuXHQgICAgICAgICAgb3NbaV0ub25FcnJvcihlcnJvcik7XG5cdCAgICAgICAgfVxuXHRcblx0ICAgICAgICB0aGlzLm9ic2VydmVycy5sZW5ndGggPSAwO1xuXHQgICAgICB9LFxuXHQgICAgICAvKipcblx0ICAgICAgICogTm90aWZpZXMgYWxsIHN1YnNjcmliZWQgb2JzZXJ2ZXJzIGFib3V0IHRoZSBhcnJpdmFsIG9mIHRoZSBzcGVjaWZpZWQgZWxlbWVudCBpbiB0aGUgc2VxdWVuY2UuXG5cdCAgICAgICAqIEBwYXJhbSB7TWl4ZWR9IHZhbHVlIFRoZSB2YWx1ZSB0byBzZW5kIHRvIGFsbCBvYnNlcnZlcnMuXG5cdCAgICAgICAqL1xuXHQgICAgICBvbk5leHQ6IGZ1bmN0aW9uICh2YWx1ZSkge1xuXHQgICAgICAgIGNoZWNrRGlzcG9zZWQodGhpcyk7XG5cdCAgICAgICAgaWYgKHRoaXMuaXNTdG9wcGVkKSB7IHJldHVybjsgfVxuXHQgICAgICAgIHRoaXMudmFsdWUgPSB2YWx1ZTtcblx0ICAgICAgICBmb3IgKHZhciBpID0gMCwgb3MgPSBjbG9uZUFycmF5KHRoaXMub2JzZXJ2ZXJzKSwgbGVuID0gb3MubGVuZ3RoOyBpIDwgbGVuOyBpKyspIHtcblx0ICAgICAgICAgIG9zW2ldLm9uTmV4dCh2YWx1ZSk7XG5cdCAgICAgICAgfVxuXHQgICAgICB9LFxuXHQgICAgICAvKipcblx0ICAgICAgICogVW5zdWJzY3JpYmUgYWxsIG9ic2VydmVycyBhbmQgcmVsZWFzZSByZXNvdXJjZXMuXG5cdCAgICAgICAqL1xuXHQgICAgICBkaXNwb3NlOiBmdW5jdGlvbiAoKSB7XG5cdCAgICAgICAgdGhpcy5pc0Rpc3Bvc2VkID0gdHJ1ZTtcblx0ICAgICAgICB0aGlzLm9ic2VydmVycyA9IG51bGw7XG5cdCAgICAgICAgdGhpcy52YWx1ZSA9IG51bGw7XG5cdCAgICAgICAgdGhpcy5lcnJvciA9IG51bGw7XG5cdCAgICAgIH1cblx0ICAgIH0pO1xuXHRcblx0ICAgIHJldHVybiBCZWhhdmlvclN1YmplY3Q7XG5cdCAgfShPYnNlcnZhYmxlKSk7XG5cdFxuXHQgIC8qKlxuXHQgICAqIFJlcHJlc2VudHMgYW4gb2JqZWN0IHRoYXQgaXMgYm90aCBhbiBvYnNlcnZhYmxlIHNlcXVlbmNlIGFzIHdlbGwgYXMgYW4gb2JzZXJ2ZXIuXG5cdCAgICogRWFjaCBub3RpZmljYXRpb24gaXMgYnJvYWRjYXN0ZWQgdG8gYWxsIHN1YnNjcmliZWQgYW5kIGZ1dHVyZSBvYnNlcnZlcnMsIHN1YmplY3QgdG8gYnVmZmVyIHRyaW1taW5nIHBvbGljaWVzLlxuXHQgICAqL1xuXHQgIHZhciBSZXBsYXlTdWJqZWN0ID0gUnguUmVwbGF5U3ViamVjdCA9IChmdW5jdGlvbiAoX19zdXBlcl9fKSB7XG5cdFxuXHQgICAgdmFyIG1heFNhZmVJbnRlZ2VyID0gTWF0aC5wb3coMiwgNTMpIC0gMTtcblx0XG5cdCAgICBmdW5jdGlvbiBjcmVhdGVSZW1vdmFibGVEaXNwb3NhYmxlKHN1YmplY3QsIG9ic2VydmVyKSB7XG5cdCAgICAgIHJldHVybiBkaXNwb3NhYmxlQ3JlYXRlKGZ1bmN0aW9uICgpIHtcblx0ICAgICAgICBvYnNlcnZlci5kaXNwb3NlKCk7XG5cdCAgICAgICAgIXN1YmplY3QuaXNEaXNwb3NlZCAmJiBzdWJqZWN0Lm9ic2VydmVycy5zcGxpY2Uoc3ViamVjdC5vYnNlcnZlcnMuaW5kZXhPZihvYnNlcnZlciksIDEpO1xuXHQgICAgICB9KTtcblx0ICAgIH1cblx0XG5cdCAgICBpbmhlcml0cyhSZXBsYXlTdWJqZWN0LCBfX3N1cGVyX18pO1xuXHRcblx0ICAgIC8qKlxuXHQgICAgICogIEluaXRpYWxpemVzIGEgbmV3IGluc3RhbmNlIG9mIHRoZSBSZXBsYXlTdWJqZWN0IGNsYXNzIHdpdGggdGhlIHNwZWNpZmllZCBidWZmZXIgc2l6ZSwgd2luZG93IHNpemUgYW5kIHNjaGVkdWxlci5cblx0ICAgICAqICBAcGFyYW0ge051bWJlcn0gW2J1ZmZlclNpemVdIE1heGltdW0gZWxlbWVudCBjb3VudCBvZiB0aGUgcmVwbGF5IGJ1ZmZlci5cblx0ICAgICAqICBAcGFyYW0ge051bWJlcn0gW3dpbmRvd1NpemVdIE1heGltdW0gdGltZSBsZW5ndGggb2YgdGhlIHJlcGxheSBidWZmZXIuXG5cdCAgICAgKiAgQHBhcmFtIHtTY2hlZHVsZXJ9IFtzY2hlZHVsZXJdIFNjaGVkdWxlciB0aGUgb2JzZXJ2ZXJzIGFyZSBpbnZva2VkIG9uLlxuXHQgICAgICovXG5cdCAgICBmdW5jdGlvbiBSZXBsYXlTdWJqZWN0KGJ1ZmZlclNpemUsIHdpbmRvd1NpemUsIHNjaGVkdWxlcikge1xuXHQgICAgICB0aGlzLmJ1ZmZlclNpemUgPSBidWZmZXJTaXplID09IG51bGwgPyBtYXhTYWZlSW50ZWdlciA6IGJ1ZmZlclNpemU7XG5cdCAgICAgIHRoaXMud2luZG93U2l6ZSA9IHdpbmRvd1NpemUgPT0gbnVsbCA/IG1heFNhZmVJbnRlZ2VyIDogd2luZG93U2l6ZTtcblx0ICAgICAgdGhpcy5zY2hlZHVsZXIgPSBzY2hlZHVsZXIgfHwgY3VycmVudFRocmVhZFNjaGVkdWxlcjtcblx0ICAgICAgdGhpcy5xID0gW107XG5cdCAgICAgIHRoaXMub2JzZXJ2ZXJzID0gW107XG5cdCAgICAgIHRoaXMuaXNTdG9wcGVkID0gZmFsc2U7XG5cdCAgICAgIHRoaXMuaXNEaXNwb3NlZCA9IGZhbHNlO1xuXHQgICAgICB0aGlzLmhhc0Vycm9yID0gZmFsc2U7XG5cdCAgICAgIHRoaXMuZXJyb3IgPSBudWxsO1xuXHQgICAgICBfX3N1cGVyX18uY2FsbCh0aGlzKTtcblx0ICAgIH1cblx0XG5cdCAgICBhZGRQcm9wZXJ0aWVzKFJlcGxheVN1YmplY3QucHJvdG90eXBlLCBPYnNlcnZlci5wcm90b3R5cGUsIHtcblx0ICAgICAgX3N1YnNjcmliZTogZnVuY3Rpb24gKG8pIHtcblx0ICAgICAgICBjaGVja0Rpc3Bvc2VkKHRoaXMpO1xuXHQgICAgICAgIHZhciBzbyA9IG5ldyBTY2hlZHVsZWRPYnNlcnZlcih0aGlzLnNjaGVkdWxlciwgbyksIHN1YnNjcmlwdGlvbiA9IGNyZWF0ZVJlbW92YWJsZURpc3Bvc2FibGUodGhpcywgc28pO1xuXHRcblx0ICAgICAgICB0aGlzLl90cmltKHRoaXMuc2NoZWR1bGVyLm5vdygpKTtcblx0ICAgICAgICB0aGlzLm9ic2VydmVycy5wdXNoKHNvKTtcblx0XG5cdCAgICAgICAgZm9yICh2YXIgaSA9IDAsIGxlbiA9IHRoaXMucS5sZW5ndGg7IGkgPCBsZW47IGkrKykge1xuXHQgICAgICAgICAgc28ub25OZXh0KHRoaXMucVtpXS52YWx1ZSk7XG5cdCAgICAgICAgfVxuXHRcblx0ICAgICAgICBpZiAodGhpcy5oYXNFcnJvcikge1xuXHQgICAgICAgICAgc28ub25FcnJvcih0aGlzLmVycm9yKTtcblx0ICAgICAgICB9IGVsc2UgaWYgKHRoaXMuaXNTdG9wcGVkKSB7XG5cdCAgICAgICAgICBzby5vbkNvbXBsZXRlZCgpO1xuXHQgICAgICAgIH1cblx0XG5cdCAgICAgICAgc28uZW5zdXJlQWN0aXZlKCk7XG5cdCAgICAgICAgcmV0dXJuIHN1YnNjcmlwdGlvbjtcblx0ICAgICAgfSxcblx0ICAgICAgLyoqXG5cdCAgICAgICAqIEluZGljYXRlcyB3aGV0aGVyIHRoZSBzdWJqZWN0IGhhcyBvYnNlcnZlcnMgc3Vic2NyaWJlZCB0byBpdC5cblx0ICAgICAgICogQHJldHVybnMge0Jvb2xlYW59IEluZGljYXRlcyB3aGV0aGVyIHRoZSBzdWJqZWN0IGhhcyBvYnNlcnZlcnMgc3Vic2NyaWJlZCB0byBpdC5cblx0ICAgICAgICovXG5cdCAgICAgIGhhc09ic2VydmVyczogZnVuY3Rpb24gKCkge1xuXHQgICAgICAgIHJldHVybiB0aGlzLm9ic2VydmVycy5sZW5ndGggPiAwO1xuXHQgICAgICB9LFxuXHQgICAgICBfdHJpbTogZnVuY3Rpb24gKG5vdykge1xuXHQgICAgICAgIHdoaWxlICh0aGlzLnEubGVuZ3RoID4gdGhpcy5idWZmZXJTaXplKSB7XG5cdCAgICAgICAgICB0aGlzLnEuc2hpZnQoKTtcblx0ICAgICAgICB9XG5cdCAgICAgICAgd2hpbGUgKHRoaXMucS5sZW5ndGggPiAwICYmIChub3cgLSB0aGlzLnFbMF0uaW50ZXJ2YWwpID4gdGhpcy53aW5kb3dTaXplKSB7XG5cdCAgICAgICAgICB0aGlzLnEuc2hpZnQoKTtcblx0ICAgICAgICB9XG5cdCAgICAgIH0sXG5cdCAgICAgIC8qKlxuXHQgICAgICAgKiBOb3RpZmllcyBhbGwgc3Vic2NyaWJlZCBvYnNlcnZlcnMgYWJvdXQgdGhlIGFycml2YWwgb2YgdGhlIHNwZWNpZmllZCBlbGVtZW50IGluIHRoZSBzZXF1ZW5jZS5cblx0ICAgICAgICogQHBhcmFtIHtNaXhlZH0gdmFsdWUgVGhlIHZhbHVlIHRvIHNlbmQgdG8gYWxsIG9ic2VydmVycy5cblx0ICAgICAgICovXG5cdCAgICAgIG9uTmV4dDogZnVuY3Rpb24gKHZhbHVlKSB7XG5cdCAgICAgICAgY2hlY2tEaXNwb3NlZCh0aGlzKTtcblx0ICAgICAgICBpZiAodGhpcy5pc1N0b3BwZWQpIHsgcmV0dXJuOyB9XG5cdCAgICAgICAgdmFyIG5vdyA9IHRoaXMuc2NoZWR1bGVyLm5vdygpO1xuXHQgICAgICAgIHRoaXMucS5wdXNoKHsgaW50ZXJ2YWw6IG5vdywgdmFsdWU6IHZhbHVlIH0pO1xuXHQgICAgICAgIHRoaXMuX3RyaW0obm93KTtcblx0XG5cdCAgICAgICAgZm9yICh2YXIgaSA9IDAsIG9zID0gY2xvbmVBcnJheSh0aGlzLm9ic2VydmVycyksIGxlbiA9IG9zLmxlbmd0aDsgaSA8IGxlbjsgaSsrKSB7XG5cdCAgICAgICAgICB2YXIgb2JzZXJ2ZXIgPSBvc1tpXTtcblx0ICAgICAgICAgIG9ic2VydmVyLm9uTmV4dCh2YWx1ZSk7XG5cdCAgICAgICAgICBvYnNlcnZlci5lbnN1cmVBY3RpdmUoKTtcblx0ICAgICAgICB9XG5cdCAgICAgIH0sXG5cdCAgICAgIC8qKlxuXHQgICAgICAgKiBOb3RpZmllcyBhbGwgc3Vic2NyaWJlZCBvYnNlcnZlcnMgYWJvdXQgdGhlIGV4Y2VwdGlvbi5cblx0ICAgICAgICogQHBhcmFtIHtNaXhlZH0gZXJyb3IgVGhlIGV4Y2VwdGlvbiB0byBzZW5kIHRvIGFsbCBvYnNlcnZlcnMuXG5cdCAgICAgICAqL1xuXHQgICAgICBvbkVycm9yOiBmdW5jdGlvbiAoZXJyb3IpIHtcblx0ICAgICAgICBjaGVja0Rpc3Bvc2VkKHRoaXMpO1xuXHQgICAgICAgIGlmICh0aGlzLmlzU3RvcHBlZCkgeyByZXR1cm47IH1cblx0ICAgICAgICB0aGlzLmlzU3RvcHBlZCA9IHRydWU7XG5cdCAgICAgICAgdGhpcy5lcnJvciA9IGVycm9yO1xuXHQgICAgICAgIHRoaXMuaGFzRXJyb3IgPSB0cnVlO1xuXHQgICAgICAgIHZhciBub3cgPSB0aGlzLnNjaGVkdWxlci5ub3coKTtcblx0ICAgICAgICB0aGlzLl90cmltKG5vdyk7XG5cdCAgICAgICAgZm9yICh2YXIgaSA9IDAsIG9zID0gY2xvbmVBcnJheSh0aGlzLm9ic2VydmVycyksIGxlbiA9IG9zLmxlbmd0aDsgaSA8IGxlbjsgaSsrKSB7XG5cdCAgICAgICAgICB2YXIgb2JzZXJ2ZXIgPSBvc1tpXTtcblx0ICAgICAgICAgIG9ic2VydmVyLm9uRXJyb3IoZXJyb3IpO1xuXHQgICAgICAgICAgb2JzZXJ2ZXIuZW5zdXJlQWN0aXZlKCk7XG5cdCAgICAgICAgfVxuXHQgICAgICAgIHRoaXMub2JzZXJ2ZXJzLmxlbmd0aCA9IDA7XG5cdCAgICAgIH0sXG5cdCAgICAgIC8qKlxuXHQgICAgICAgKiBOb3RpZmllcyBhbGwgc3Vic2NyaWJlZCBvYnNlcnZlcnMgYWJvdXQgdGhlIGVuZCBvZiB0aGUgc2VxdWVuY2UuXG5cdCAgICAgICAqL1xuXHQgICAgICBvbkNvbXBsZXRlZDogZnVuY3Rpb24gKCkge1xuXHQgICAgICAgIGNoZWNrRGlzcG9zZWQodGhpcyk7XG5cdCAgICAgICAgaWYgKHRoaXMuaXNTdG9wcGVkKSB7IHJldHVybjsgfVxuXHQgICAgICAgIHRoaXMuaXNTdG9wcGVkID0gdHJ1ZTtcblx0ICAgICAgICB2YXIgbm93ID0gdGhpcy5zY2hlZHVsZXIubm93KCk7XG5cdCAgICAgICAgdGhpcy5fdHJpbShub3cpO1xuXHQgICAgICAgIGZvciAodmFyIGkgPSAwLCBvcyA9IGNsb25lQXJyYXkodGhpcy5vYnNlcnZlcnMpLCBsZW4gPSBvcy5sZW5ndGg7IGkgPCBsZW47IGkrKykge1xuXHQgICAgICAgICAgdmFyIG9ic2VydmVyID0gb3NbaV07XG5cdCAgICAgICAgICBvYnNlcnZlci5vbkNvbXBsZXRlZCgpO1xuXHQgICAgICAgICAgb2JzZXJ2ZXIuZW5zdXJlQWN0aXZlKCk7XG5cdCAgICAgICAgfVxuXHQgICAgICAgIHRoaXMub2JzZXJ2ZXJzLmxlbmd0aCA9IDA7XG5cdCAgICAgIH0sXG5cdCAgICAgIC8qKlxuXHQgICAgICAgKiBVbnN1YnNjcmliZSBhbGwgb2JzZXJ2ZXJzIGFuZCByZWxlYXNlIHJlc291cmNlcy5cblx0ICAgICAgICovXG5cdCAgICAgIGRpc3Bvc2U6IGZ1bmN0aW9uICgpIHtcblx0ICAgICAgICB0aGlzLmlzRGlzcG9zZWQgPSB0cnVlO1xuXHQgICAgICAgIHRoaXMub2JzZXJ2ZXJzID0gbnVsbDtcblx0ICAgICAgfVxuXHQgICAgfSk7XG5cdFxuXHQgICAgcmV0dXJuIFJlcGxheVN1YmplY3Q7XG5cdCAgfShPYnNlcnZhYmxlKSk7XG5cdFxuXHQgIHZhciBSZWZDb3VudE9ic2VydmFibGUgPSAoZnVuY3Rpb24gKF9fc3VwZXJfXykge1xuXHQgICAgaW5oZXJpdHMoUmVmQ291bnRPYnNlcnZhYmxlLCBfX3N1cGVyX18pO1xuXHQgICAgZnVuY3Rpb24gUmVmQ291bnRPYnNlcnZhYmxlKHNvdXJjZSkge1xuXHQgICAgICB0aGlzLnNvdXJjZSA9IHNvdXJjZTtcblx0ICAgICAgdGhpcy5fY291bnQgPSAwO1xuXHQgICAgICB0aGlzLl9jb25uZWN0YWJsZVN1YnNjcmlwdGlvbiA9IG51bGw7XG5cdCAgICAgIF9fc3VwZXJfXy5jYWxsKHRoaXMpO1xuXHQgICAgfVxuXHRcblx0ICAgIFJlZkNvdW50T2JzZXJ2YWJsZS5wcm90b3R5cGUuc3Vic2NyaWJlQ29yZSA9IGZ1bmN0aW9uIChvKSB7XG5cdCAgICAgIHZhciBzaG91bGRDb25uZWN0ID0gKyt0aGlzLl9jb3VudCA9PT0gMSwgc3Vic2NyaXB0aW9uID0gdGhpcy5zb3VyY2Uuc3Vic2NyaWJlKG8pO1xuXHQgICAgICBzaG91bGRDb25uZWN0ICYmICh0aGlzLl9jb25uZWN0YWJsZVN1YnNjcmlwdGlvbiA9IHRoaXMuc291cmNlLmNvbm5lY3QoKSk7XG5cdCAgICAgIHJldHVybiBuZXcgUmVmQ291bnREaXNwb3NhYmxlKHRoaXMsIHN1YnNjcmlwdGlvbik7XG5cdCAgICB9O1xuXHRcblx0ICAgIGZ1bmN0aW9uIFJlZkNvdW50RGlzcG9zYWJsZShwLCBzKSB7XG5cdCAgICAgIHRoaXMuX3AgPSBwO1xuXHQgICAgICB0aGlzLl9zID0gcztcblx0ICAgICAgdGhpcy5pc0Rpc3Bvc2VkID0gZmFsc2U7XG5cdCAgICB9XG5cdFxuXHQgICAgUmVmQ291bnREaXNwb3NhYmxlLnByb3RvdHlwZS5kaXNwb3NlID0gZnVuY3Rpb24gKCkge1xuXHQgICAgICBpZiAoIXRoaXMuaXNEaXNwb3NlZCkge1xuXHQgICAgICAgIHRoaXMuaXNEaXNwb3NlZCA9IHRydWU7XG5cdCAgICAgICAgdGhpcy5fcy5kaXNwb3NlKCk7XG5cdCAgICAgICAgLS10aGlzLl9wLl9jb3VudCA9PT0gMCAmJiB0aGlzLl9wLl9jb25uZWN0YWJsZVN1YnNjcmlwdGlvbi5kaXNwb3NlKCk7XG5cdCAgICAgIH1cblx0ICAgIH07XG5cdFxuXHQgICAgcmV0dXJuIFJlZkNvdW50T2JzZXJ2YWJsZTtcblx0ICB9KE9ic2VydmFibGVCYXNlKSk7XG5cdFxuXHQgIHZhciBDb25uZWN0YWJsZU9ic2VydmFibGUgPSBSeC5Db25uZWN0YWJsZU9ic2VydmFibGUgPSAoZnVuY3Rpb24gKF9fc3VwZXJfXykge1xuXHQgICAgaW5oZXJpdHMoQ29ubmVjdGFibGVPYnNlcnZhYmxlLCBfX3N1cGVyX18pO1xuXHQgICAgZnVuY3Rpb24gQ29ubmVjdGFibGVPYnNlcnZhYmxlKHNvdXJjZSwgc3ViamVjdCkge1xuXHQgICAgICB0aGlzLnNvdXJjZSA9IHNvdXJjZTtcblx0ICAgICAgdGhpcy5faGFzU3Vic2NyaXB0aW9uICA9IGZhbHNlO1xuXHQgICAgICB0aGlzLl9zdWJzY3JpcHRpb24gPSBudWxsO1xuXHQgICAgICB0aGlzLl9zb3VyY2VPYnNlcnZhYmxlID0gc291cmNlLmFzT2JzZXJ2YWJsZSgpO1xuXHQgICAgICB0aGlzLl9zdWJqZWN0ID0gc3ViamVjdDtcblx0ICAgICAgX19zdXBlcl9fLmNhbGwodGhpcyk7XG5cdCAgICB9XG5cdFxuXHQgICAgZnVuY3Rpb24gQ29ubmVjdERpc3Bvc2FibGUocGFyZW50KSB7XG5cdCAgICAgIHRoaXMuX3AgPSBwYXJlbnQ7XG5cdCAgICAgIHRoaXMuaXNEaXNwb3NlZCA9IGZhbHNlO1xuXHQgICAgfVxuXHRcblx0ICAgIENvbm5lY3REaXNwb3NhYmxlLnByb3RvdHlwZS5kaXNwb3NlID0gZnVuY3Rpb24gKCkge1xuXHQgICAgICBpZiAoIXRoaXMuaXNEaXNwb3NlZCkge1xuXHQgICAgICAgIHRoaXMuaXNEaXNwb3NlZCA9IHRydWU7XG5cdCAgICAgICAgdGhpcy5fcC5faGFzU3Vic2NyaXB0aW9uID0gZmFsc2U7XG5cdCAgICAgIH1cblx0ICAgIH07XG5cdFxuXHQgICAgQ29ubmVjdGFibGVPYnNlcnZhYmxlLnByb3RvdHlwZS5jb25uZWN0ID0gZnVuY3Rpb24gKCkge1xuXHQgICAgICBpZiAoIXRoaXMuX2hhc1N1YnNjcmlwdGlvbikge1xuXHQgICAgICAgIHRoaXMuX2hhc1N1YnNjcmlwdGlvbiA9IHRydWU7XG5cdCAgICAgICAgdGhpcy5fc3Vic2NyaXB0aW9uID0gbmV3IEJpbmFyeURpc3Bvc2FibGUoXG5cdCAgICAgICAgICB0aGlzLl9zb3VyY2VPYnNlcnZhYmxlLnN1YnNjcmliZSh0aGlzLl9zdWJqZWN0KSxcblx0ICAgICAgICAgIG5ldyBDb25uZWN0RGlzcG9zYWJsZSh0aGlzKVxuXHQgICAgICAgICk7XG5cdCAgICAgIH1cblx0ICAgICAgcmV0dXJuIHRoaXMuX3N1YnNjcmlwdGlvbjtcblx0ICAgIH07XG5cdFxuXHQgICAgQ29ubmVjdGFibGVPYnNlcnZhYmxlLnByb3RvdHlwZS5fc3Vic2NyaWJlID0gZnVuY3Rpb24gKG8pIHtcblx0ICAgICAgcmV0dXJuIHRoaXMuX3N1YmplY3Quc3Vic2NyaWJlKG8pO1xuXHQgICAgfTtcblx0XG5cdCAgICBDb25uZWN0YWJsZU9ic2VydmFibGUucHJvdG90eXBlLnJlZkNvdW50ID0gZnVuY3Rpb24gKCkge1xuXHQgICAgICByZXR1cm4gbmV3IFJlZkNvdW50T2JzZXJ2YWJsZSh0aGlzKTtcblx0ICAgIH07XG5cdFxuXHQgICAgcmV0dXJuIENvbm5lY3RhYmxlT2JzZXJ2YWJsZTtcblx0ICB9KE9ic2VydmFibGUpKTtcblx0XG5cdCAgLyoqXG5cdCAgICogUmV0dXJucyBhbiBvYnNlcnZhYmxlIHNlcXVlbmNlIHRoYXQgc2hhcmVzIGEgc2luZ2xlIHN1YnNjcmlwdGlvbiB0byB0aGUgdW5kZXJseWluZyBzZXF1ZW5jZS4gVGhpcyBvYnNlcnZhYmxlIHNlcXVlbmNlXG5cdCAgICogY2FuIGJlIHJlc3Vic2NyaWJlZCB0bywgZXZlbiBpZiBhbGwgcHJpb3Igc3Vic2NyaXB0aW9ucyBoYXZlIGVuZGVkLiAodW5saWtlIGAucHVibGlzaCgpLnJlZkNvdW50KClgKVxuXHQgICAqIEByZXR1cm5zIHtPYnNlcnZhYmxlfSBBbiBvYnNlcnZhYmxlIHNlcXVlbmNlIHRoYXQgY29udGFpbnMgdGhlIGVsZW1lbnRzIG9mIGEgc2VxdWVuY2UgcHJvZHVjZWQgYnkgbXVsdGljYXN0aW5nIHRoZSBzb3VyY2UuXG5cdCAgICovXG5cdCAgb2JzZXJ2YWJsZVByb3RvLnNpbmdsZUluc3RhbmNlID0gZnVuY3Rpb24oKSB7XG5cdCAgICB2YXIgc291cmNlID0gdGhpcywgaGFzT2JzZXJ2YWJsZSA9IGZhbHNlLCBvYnNlcnZhYmxlO1xuXHRcblx0ICAgIGZ1bmN0aW9uIGdldE9ic2VydmFibGUoKSB7XG5cdCAgICAgIGlmICghaGFzT2JzZXJ2YWJsZSkge1xuXHQgICAgICAgIGhhc09ic2VydmFibGUgPSB0cnVlO1xuXHQgICAgICAgIG9ic2VydmFibGUgPSBzb3VyY2UuZmluYWxseShmdW5jdGlvbigpIHsgaGFzT2JzZXJ2YWJsZSA9IGZhbHNlOyB9KS5wdWJsaXNoKCkucmVmQ291bnQoKTtcblx0ICAgICAgfVxuXHQgICAgICByZXR1cm4gb2JzZXJ2YWJsZTtcblx0ICAgIH1cblx0XG5cdCAgICByZXR1cm4gbmV3IEFub255bW91c09ic2VydmFibGUoZnVuY3Rpb24obykge1xuXHQgICAgICByZXR1cm4gZ2V0T2JzZXJ2YWJsZSgpLnN1YnNjcmliZShvKTtcblx0ICAgIH0pO1xuXHQgIH07XG5cdFxuXHQgIC8qKlxuXHQgICAqICBDb3JyZWxhdGVzIHRoZSBlbGVtZW50cyBvZiB0d28gc2VxdWVuY2VzIGJhc2VkIG9uIG92ZXJsYXBwaW5nIGR1cmF0aW9ucy5cblx0ICAgKlxuXHQgICAqICBAcGFyYW0ge09ic2VydmFibGV9IHJpZ2h0IFRoZSByaWdodCBvYnNlcnZhYmxlIHNlcXVlbmNlIHRvIGpvaW4gZWxlbWVudHMgZm9yLlxuXHQgICAqICBAcGFyYW0ge0Z1bmN0aW9ufSBsZWZ0RHVyYXRpb25TZWxlY3RvciBBIGZ1bmN0aW9uIHRvIHNlbGVjdCB0aGUgZHVyYXRpb24gKGV4cHJlc3NlZCBhcyBhbiBvYnNlcnZhYmxlIHNlcXVlbmNlKSBvZiBlYWNoIGVsZW1lbnQgb2YgdGhlIGxlZnQgb2JzZXJ2YWJsZSBzZXF1ZW5jZSwgdXNlZCB0byBkZXRlcm1pbmUgb3ZlcmxhcC5cblx0ICAgKiAgQHBhcmFtIHtGdW5jdGlvbn0gcmlnaHREdXJhdGlvblNlbGVjdG9yIEEgZnVuY3Rpb24gdG8gc2VsZWN0IHRoZSBkdXJhdGlvbiAoZXhwcmVzc2VkIGFzIGFuIG9ic2VydmFibGUgc2VxdWVuY2UpIG9mIGVhY2ggZWxlbWVudCBvZiB0aGUgcmlnaHQgb2JzZXJ2YWJsZSBzZXF1ZW5jZSwgdXNlZCB0byBkZXRlcm1pbmUgb3ZlcmxhcC5cblx0ICAgKiAgQHBhcmFtIHtGdW5jdGlvbn0gcmVzdWx0U2VsZWN0b3IgQSBmdW5jdGlvbiBpbnZva2VkIHRvIGNvbXB1dGUgYSByZXN1bHQgZWxlbWVudCBmb3IgYW55IHR3byBvdmVybGFwcGluZyBlbGVtZW50cyBvZiB0aGUgbGVmdCBhbmQgcmlnaHQgb2JzZXJ2YWJsZSBzZXF1ZW5jZXMuIFRoZSBwYXJhbWV0ZXJzIHBhc3NlZCB0byB0aGUgZnVuY3Rpb24gY29ycmVzcG9uZCB3aXRoIHRoZSBlbGVtZW50cyBmcm9tIHRoZSBsZWZ0IGFuZCByaWdodCBzb3VyY2Ugc2VxdWVuY2VzIGZvciB3aGljaCBvdmVybGFwIG9jY3Vycy5cblx0ICAgKiAgQHJldHVybnMge09ic2VydmFibGV9IEFuIG9ic2VydmFibGUgc2VxdWVuY2UgdGhhdCBjb250YWlucyByZXN1bHQgZWxlbWVudHMgY29tcHV0ZWQgZnJvbSBzb3VyY2UgZWxlbWVudHMgdGhhdCBoYXZlIGFuIG92ZXJsYXBwaW5nIGR1cmF0aW9uLlxuXHQgICAqL1xuXHQgIG9ic2VydmFibGVQcm90by5qb2luID0gZnVuY3Rpb24gKHJpZ2h0LCBsZWZ0RHVyYXRpb25TZWxlY3RvciwgcmlnaHREdXJhdGlvblNlbGVjdG9yLCByZXN1bHRTZWxlY3Rvcikge1xuXHQgICAgdmFyIGxlZnQgPSB0aGlzO1xuXHQgICAgcmV0dXJuIG5ldyBBbm9ueW1vdXNPYnNlcnZhYmxlKGZ1bmN0aW9uIChvKSB7XG5cdCAgICAgIHZhciBncm91cCA9IG5ldyBDb21wb3NpdGVEaXNwb3NhYmxlKCk7XG5cdCAgICAgIHZhciBsZWZ0RG9uZSA9IGZhbHNlLCByaWdodERvbmUgPSBmYWxzZTtcblx0ICAgICAgdmFyIGxlZnRJZCA9IDAsIHJpZ2h0SWQgPSAwO1xuXHQgICAgICB2YXIgbGVmdE1hcCA9IG5ldyBNYXAoKSwgcmlnaHRNYXAgPSBuZXcgTWFwKCk7XG5cdCAgICAgIHZhciBoYW5kbGVFcnJvciA9IGZ1bmN0aW9uIChlKSB7IG8ub25FcnJvcihlKTsgfTtcblx0XG5cdCAgICAgIGdyb3VwLmFkZChsZWZ0LnN1YnNjcmliZShcblx0ICAgICAgICBmdW5jdGlvbiAodmFsdWUpIHtcblx0ICAgICAgICAgIHZhciBpZCA9IGxlZnRJZCsrLCBtZCA9IG5ldyBTaW5nbGVBc3NpZ25tZW50RGlzcG9zYWJsZSgpO1xuXHRcblx0ICAgICAgICAgIGxlZnRNYXAuc2V0KGlkLCB2YWx1ZSk7XG5cdCAgICAgICAgICBncm91cC5hZGQobWQpO1xuXHRcblx0ICAgICAgICAgIHZhciBkdXJhdGlvbiA9IHRyeUNhdGNoKGxlZnREdXJhdGlvblNlbGVjdG9yKSh2YWx1ZSk7XG5cdCAgICAgICAgICBpZiAoZHVyYXRpb24gPT09IGVycm9yT2JqKSB7IHJldHVybiBvLm9uRXJyb3IoZHVyYXRpb24uZSk7IH1cblx0XG5cdCAgICAgICAgICBtZC5zZXREaXNwb3NhYmxlKGR1cmF0aW9uLnRha2UoMSkuc3Vic2NyaWJlKFxuXHQgICAgICAgICAgICBub29wLFxuXHQgICAgICAgICAgICBoYW5kbGVFcnJvcixcblx0ICAgICAgICAgICAgZnVuY3Rpb24gKCkge1xuXHQgICAgICAgICAgICAgIGxlZnRNYXBbJ2RlbGV0ZSddKGlkKSAmJiBsZWZ0TWFwLnNpemUgPT09IDAgJiYgbGVmdERvbmUgJiYgby5vbkNvbXBsZXRlZCgpO1xuXHQgICAgICAgICAgICAgIGdyb3VwLnJlbW92ZShtZCk7XG5cdCAgICAgICAgICAgIH0pKTtcblx0XG5cdCAgICAgICAgICByaWdodE1hcC5mb3JFYWNoKGZ1bmN0aW9uICh2KSB7XG5cdCAgICAgICAgICAgIHZhciByZXN1bHQgPSB0cnlDYXRjaChyZXN1bHRTZWxlY3RvcikodmFsdWUsIHYpO1xuXHQgICAgICAgICAgICBpZiAocmVzdWx0ID09PSBlcnJvck9iaikgeyByZXR1cm4gby5vbkVycm9yKHJlc3VsdC5lKTsgfVxuXHQgICAgICAgICAgICBvLm9uTmV4dChyZXN1bHQpO1xuXHQgICAgICAgICAgfSk7XG5cdCAgICAgICAgfSxcblx0ICAgICAgICBoYW5kbGVFcnJvcixcblx0ICAgICAgICBmdW5jdGlvbiAoKSB7XG5cdCAgICAgICAgICBsZWZ0RG9uZSA9IHRydWU7XG5cdCAgICAgICAgICAocmlnaHREb25lIHx8IGxlZnRNYXAuc2l6ZSA9PT0gMCkgJiYgby5vbkNvbXBsZXRlZCgpO1xuXHQgICAgICAgIH0pXG5cdCAgICAgICk7XG5cdFxuXHQgICAgICBncm91cC5hZGQocmlnaHQuc3Vic2NyaWJlKFxuXHQgICAgICAgIGZ1bmN0aW9uICh2YWx1ZSkge1xuXHQgICAgICAgICAgdmFyIGlkID0gcmlnaHRJZCsrLCBtZCA9IG5ldyBTaW5nbGVBc3NpZ25tZW50RGlzcG9zYWJsZSgpO1xuXHRcblx0ICAgICAgICAgIHJpZ2h0TWFwLnNldChpZCwgdmFsdWUpO1xuXHQgICAgICAgICAgZ3JvdXAuYWRkKG1kKTtcblx0XG5cdCAgICAgICAgICB2YXIgZHVyYXRpb24gPSB0cnlDYXRjaChyaWdodER1cmF0aW9uU2VsZWN0b3IpKHZhbHVlKTtcblx0ICAgICAgICAgIGlmIChkdXJhdGlvbiA9PT0gZXJyb3JPYmopIHsgcmV0dXJuIG8ub25FcnJvcihkdXJhdGlvbi5lKTsgfVxuXHRcblx0ICAgICAgICAgIG1kLnNldERpc3Bvc2FibGUoZHVyYXRpb24udGFrZSgxKS5zdWJzY3JpYmUoXG5cdCAgICAgICAgICAgIG5vb3AsXG5cdCAgICAgICAgICAgIGhhbmRsZUVycm9yLFxuXHQgICAgICAgICAgICBmdW5jdGlvbiAoKSB7XG5cdCAgICAgICAgICAgICAgcmlnaHRNYXBbJ2RlbGV0ZSddKGlkKSAmJiByaWdodE1hcC5zaXplID09PSAwICYmIHJpZ2h0RG9uZSAmJiBvLm9uQ29tcGxldGVkKCk7XG5cdCAgICAgICAgICAgICAgZ3JvdXAucmVtb3ZlKG1kKTtcblx0ICAgICAgICAgICAgfSkpO1xuXHRcblx0ICAgICAgICAgIGxlZnRNYXAuZm9yRWFjaChmdW5jdGlvbiAodikge1xuXHQgICAgICAgICAgICB2YXIgcmVzdWx0ID0gdHJ5Q2F0Y2gocmVzdWx0U2VsZWN0b3IpKHYsIHZhbHVlKTtcblx0ICAgICAgICAgICAgaWYgKHJlc3VsdCA9PT0gZXJyb3JPYmopIHsgcmV0dXJuIG8ub25FcnJvcihyZXN1bHQuZSk7IH1cblx0ICAgICAgICAgICAgby5vbk5leHQocmVzdWx0KTtcblx0ICAgICAgICAgIH0pO1xuXHQgICAgICAgIH0sXG5cdCAgICAgICAgaGFuZGxlRXJyb3IsXG5cdCAgICAgICAgZnVuY3Rpb24gKCkge1xuXHQgICAgICAgICAgcmlnaHREb25lID0gdHJ1ZTtcblx0ICAgICAgICAgIChsZWZ0RG9uZSB8fCByaWdodE1hcC5zaXplID09PSAwKSAmJiBvLm9uQ29tcGxldGVkKCk7XG5cdCAgICAgICAgfSlcblx0ICAgICAgKTtcblx0ICAgICAgcmV0dXJuIGdyb3VwO1xuXHQgICAgfSwgbGVmdCk7XG5cdCAgfTtcblx0XG5cdCAgLyoqXG5cdCAgICogIENvcnJlbGF0ZXMgdGhlIGVsZW1lbnRzIG9mIHR3byBzZXF1ZW5jZXMgYmFzZWQgb24gb3ZlcmxhcHBpbmcgZHVyYXRpb25zLCBhbmQgZ3JvdXBzIHRoZSByZXN1bHRzLlxuXHQgICAqXG5cdCAgICogIEBwYXJhbSB7T2JzZXJ2YWJsZX0gcmlnaHQgVGhlIHJpZ2h0IG9ic2VydmFibGUgc2VxdWVuY2UgdG8gam9pbiBlbGVtZW50cyBmb3IuXG5cdCAgICogIEBwYXJhbSB7RnVuY3Rpb259IGxlZnREdXJhdGlvblNlbGVjdG9yIEEgZnVuY3Rpb24gdG8gc2VsZWN0IHRoZSBkdXJhdGlvbiAoZXhwcmVzc2VkIGFzIGFuIG9ic2VydmFibGUgc2VxdWVuY2UpIG9mIGVhY2ggZWxlbWVudCBvZiB0aGUgbGVmdCBvYnNlcnZhYmxlIHNlcXVlbmNlLCB1c2VkIHRvIGRldGVybWluZSBvdmVybGFwLlxuXHQgICAqICBAcGFyYW0ge0Z1bmN0aW9ufSByaWdodER1cmF0aW9uU2VsZWN0b3IgQSBmdW5jdGlvbiB0byBzZWxlY3QgdGhlIGR1cmF0aW9uIChleHByZXNzZWQgYXMgYW4gb2JzZXJ2YWJsZSBzZXF1ZW5jZSkgb2YgZWFjaCBlbGVtZW50IG9mIHRoZSByaWdodCBvYnNlcnZhYmxlIHNlcXVlbmNlLCB1c2VkIHRvIGRldGVybWluZSBvdmVybGFwLlxuXHQgICAqICBAcGFyYW0ge0Z1bmN0aW9ufSByZXN1bHRTZWxlY3RvciBBIGZ1bmN0aW9uIGludm9rZWQgdG8gY29tcHV0ZSBhIHJlc3VsdCBlbGVtZW50IGZvciBhbnkgZWxlbWVudCBvZiB0aGUgbGVmdCBzZXF1ZW5jZSB3aXRoIG92ZXJsYXBwaW5nIGVsZW1lbnRzIGZyb20gdGhlIHJpZ2h0IG9ic2VydmFibGUgc2VxdWVuY2UuIFRoZSBmaXJzdCBwYXJhbWV0ZXIgcGFzc2VkIHRvIHRoZSBmdW5jdGlvbiBpcyBhbiBlbGVtZW50IG9mIHRoZSBsZWZ0IHNlcXVlbmNlLiBUaGUgc2Vjb25kIHBhcmFtZXRlciBwYXNzZWQgdG8gdGhlIGZ1bmN0aW9uIGlzIGFuIG9ic2VydmFibGUgc2VxdWVuY2Ugd2l0aCBlbGVtZW50cyBmcm9tIHRoZSByaWdodCBzZXF1ZW5jZSB0aGF0IG92ZXJsYXAgd2l0aCB0aGUgbGVmdCBzZXF1ZW5jZSdzIGVsZW1lbnQuXG5cdCAgICogIEByZXR1cm5zIHtPYnNlcnZhYmxlfSBBbiBvYnNlcnZhYmxlIHNlcXVlbmNlIHRoYXQgY29udGFpbnMgcmVzdWx0IGVsZW1lbnRzIGNvbXB1dGVkIGZyb20gc291cmNlIGVsZW1lbnRzIHRoYXQgaGF2ZSBhbiBvdmVybGFwcGluZyBkdXJhdGlvbi5cblx0ICAgKi9cblx0ICBvYnNlcnZhYmxlUHJvdG8uZ3JvdXBKb2luID0gZnVuY3Rpb24gKHJpZ2h0LCBsZWZ0RHVyYXRpb25TZWxlY3RvciwgcmlnaHREdXJhdGlvblNlbGVjdG9yLCByZXN1bHRTZWxlY3Rvcikge1xuXHQgICAgdmFyIGxlZnQgPSB0aGlzO1xuXHQgICAgcmV0dXJuIG5ldyBBbm9ueW1vdXNPYnNlcnZhYmxlKGZ1bmN0aW9uIChvKSB7XG5cdCAgICAgIHZhciBncm91cCA9IG5ldyBDb21wb3NpdGVEaXNwb3NhYmxlKCk7XG5cdCAgICAgIHZhciByID0gbmV3IFJlZkNvdW50RGlzcG9zYWJsZShncm91cCk7XG5cdCAgICAgIHZhciBsZWZ0TWFwID0gbmV3IE1hcCgpLCByaWdodE1hcCA9IG5ldyBNYXAoKTtcblx0ICAgICAgdmFyIGxlZnRJZCA9IDAsIHJpZ2h0SWQgPSAwO1xuXHQgICAgICB2YXIgaGFuZGxlRXJyb3IgPSBmdW5jdGlvbiAoZSkgeyByZXR1cm4gZnVuY3Rpb24gKHYpIHsgdi5vbkVycm9yKGUpOyB9OyB9O1xuXHRcblx0ICAgICAgZnVuY3Rpb24gaGFuZGxlRXJyb3IoZSkgeyB9O1xuXHRcblx0ICAgICAgZ3JvdXAuYWRkKGxlZnQuc3Vic2NyaWJlKFxuXHQgICAgICAgIGZ1bmN0aW9uICh2YWx1ZSkge1xuXHQgICAgICAgICAgdmFyIHMgPSBuZXcgU3ViamVjdCgpO1xuXHQgICAgICAgICAgdmFyIGlkID0gbGVmdElkKys7XG5cdCAgICAgICAgICBsZWZ0TWFwLnNldChpZCwgcyk7XG5cdFxuXHQgICAgICAgICAgdmFyIHJlc3VsdCA9IHRyeUNhdGNoKHJlc3VsdFNlbGVjdG9yKSh2YWx1ZSwgYWRkUmVmKHMsIHIpKTtcblx0ICAgICAgICAgIGlmIChyZXN1bHQgPT09IGVycm9yT2JqKSB7XG5cdCAgICAgICAgICAgIGxlZnRNYXAuZm9yRWFjaChoYW5kbGVFcnJvcihyZXN1bHQuZSkpO1xuXHQgICAgICAgICAgICByZXR1cm4gby5vbkVycm9yKHJlc3VsdC5lKTtcblx0ICAgICAgICAgIH1cblx0ICAgICAgICAgIG8ub25OZXh0KHJlc3VsdCk7XG5cdFxuXHQgICAgICAgICAgcmlnaHRNYXAuZm9yRWFjaChmdW5jdGlvbiAodikgeyBzLm9uTmV4dCh2KTsgfSk7XG5cdFxuXHQgICAgICAgICAgdmFyIG1kID0gbmV3IFNpbmdsZUFzc2lnbm1lbnREaXNwb3NhYmxlKCk7XG5cdCAgICAgICAgICBncm91cC5hZGQobWQpO1xuXHRcblx0ICAgICAgICAgIHZhciBkdXJhdGlvbiA9IHRyeUNhdGNoKGxlZnREdXJhdGlvblNlbGVjdG9yKSh2YWx1ZSk7XG5cdCAgICAgICAgICBpZiAoZHVyYXRpb24gPT09IGVycm9yT2JqKSB7XG5cdCAgICAgICAgICAgIGxlZnRNYXAuZm9yRWFjaChoYW5kbGVFcnJvcihkdXJhdGlvbi5lKSk7XG5cdCAgICAgICAgICAgIHJldHVybiBvLm9uRXJyb3IoZHVyYXRpb24uZSk7XG5cdCAgICAgICAgICB9XG5cdFxuXHQgICAgICAgICAgbWQuc2V0RGlzcG9zYWJsZShkdXJhdGlvbi50YWtlKDEpLnN1YnNjcmliZShcblx0ICAgICAgICAgICAgbm9vcCxcblx0ICAgICAgICAgICAgZnVuY3Rpb24gKGUpIHtcblx0ICAgICAgICAgICAgICBsZWZ0TWFwLmZvckVhY2goaGFuZGxlRXJyb3IoZSkpO1xuXHQgICAgICAgICAgICAgIG8ub25FcnJvcihlKTtcblx0ICAgICAgICAgICAgfSxcblx0ICAgICAgICAgICAgZnVuY3Rpb24gKCkge1xuXHQgICAgICAgICAgICAgIGxlZnRNYXBbJ2RlbGV0ZSddKGlkKSAmJiBzLm9uQ29tcGxldGVkKCk7XG5cdCAgICAgICAgICAgICAgZ3JvdXAucmVtb3ZlKG1kKTtcblx0ICAgICAgICAgICAgfSkpO1xuXHQgICAgICAgIH0sXG5cdCAgICAgICAgZnVuY3Rpb24gKGUpIHtcblx0ICAgICAgICAgIGxlZnRNYXAuZm9yRWFjaChoYW5kbGVFcnJvcihlKSk7XG5cdCAgICAgICAgICBvLm9uRXJyb3IoZSk7XG5cdCAgICAgICAgfSxcblx0ICAgICAgICBmdW5jdGlvbiAoKSB7IG8ub25Db21wbGV0ZWQoKTsgfSlcblx0ICAgICAgKTtcblx0XG5cdCAgICAgIGdyb3VwLmFkZChyaWdodC5zdWJzY3JpYmUoXG5cdCAgICAgICAgZnVuY3Rpb24gKHZhbHVlKSB7XG5cdCAgICAgICAgICB2YXIgaWQgPSByaWdodElkKys7XG5cdCAgICAgICAgICByaWdodE1hcC5zZXQoaWQsIHZhbHVlKTtcblx0XG5cdCAgICAgICAgICB2YXIgbWQgPSBuZXcgU2luZ2xlQXNzaWdubWVudERpc3Bvc2FibGUoKTtcblx0ICAgICAgICAgIGdyb3VwLmFkZChtZCk7XG5cdFxuXHQgICAgICAgICAgdmFyIGR1cmF0aW9uID0gdHJ5Q2F0Y2gocmlnaHREdXJhdGlvblNlbGVjdG9yKSh2YWx1ZSk7XG5cdCAgICAgICAgICBpZiAoZHVyYXRpb24gPT09IGVycm9yT2JqKSB7XG5cdCAgICAgICAgICAgIGxlZnRNYXAuZm9yRWFjaChoYW5kbGVFcnJvcihkdXJhdGlvbi5lKSk7XG5cdCAgICAgICAgICAgIHJldHVybiBvLm9uRXJyb3IoZHVyYXRpb24uZSk7XG5cdCAgICAgICAgICB9XG5cdFxuXHQgICAgICAgICAgbWQuc2V0RGlzcG9zYWJsZShkdXJhdGlvbi50YWtlKDEpLnN1YnNjcmliZShcblx0ICAgICAgICAgICAgbm9vcCxcblx0ICAgICAgICAgICAgZnVuY3Rpb24gKGUpIHtcblx0ICAgICAgICAgICAgICBsZWZ0TWFwLmZvckVhY2goaGFuZGxlRXJyb3IoZSkpO1xuXHQgICAgICAgICAgICAgIG8ub25FcnJvcihlKTtcblx0ICAgICAgICAgICAgfSxcblx0ICAgICAgICAgICAgZnVuY3Rpb24gKCkge1xuXHQgICAgICAgICAgICAgIHJpZ2h0TWFwWydkZWxldGUnXShpZCk7XG5cdCAgICAgICAgICAgICAgZ3JvdXAucmVtb3ZlKG1kKTtcblx0ICAgICAgICAgICAgfSkpO1xuXHRcblx0ICAgICAgICAgIGxlZnRNYXAuZm9yRWFjaChmdW5jdGlvbiAodikgeyB2Lm9uTmV4dCh2YWx1ZSk7IH0pO1xuXHQgICAgICAgIH0sXG5cdCAgICAgICAgZnVuY3Rpb24gKGUpIHtcblx0ICAgICAgICAgIGxlZnRNYXAuZm9yRWFjaChoYW5kbGVFcnJvcihlKSk7XG5cdCAgICAgICAgICBvLm9uRXJyb3IoZSk7XG5cdCAgICAgICAgfSlcblx0ICAgICAgKTtcblx0XG5cdCAgICAgIHJldHVybiByO1xuXHQgICAgfSwgbGVmdCk7XG5cdCAgfTtcblx0XG5cdCAgZnVuY3Rpb24gdG9BcnJheSh4KSB7IHJldHVybiB4LnRvQXJyYXkoKTsgfVxuXHRcblx0ICAvKipcblx0ICAgKiAgUHJvamVjdHMgZWFjaCBlbGVtZW50IG9mIGFuIG9ic2VydmFibGUgc2VxdWVuY2UgaW50byB6ZXJvIG9yIG1vcmUgYnVmZmVycy5cblx0ICAgKiAgQHBhcmFtIHtNaXhlZH0gYnVmZmVyT3BlbmluZ3NPckNsb3NpbmdTZWxlY3RvciBPYnNlcnZhYmxlIHNlcXVlbmNlIHdob3NlIGVsZW1lbnRzIGRlbm90ZSB0aGUgY3JlYXRpb24gb2YgbmV3IHdpbmRvd3MsIG9yLCBhIGZ1bmN0aW9uIGludm9rZWQgdG8gZGVmaW5lIHRoZSBib3VuZGFyaWVzIG9mIHRoZSBwcm9kdWNlZCB3aW5kb3dzIChhIG5ldyB3aW5kb3cgaXMgc3RhcnRlZCB3aGVuIHRoZSBwcmV2aW91cyBvbmUgaXMgY2xvc2VkLCByZXN1bHRpbmcgaW4gbm9uLW92ZXJsYXBwaW5nIHdpbmRvd3MpLlxuXHQgICAqICBAcGFyYW0ge0Z1bmN0aW9ufSBbYnVmZmVyQ2xvc2luZ1NlbGVjdG9yXSBBIGZ1bmN0aW9uIGludm9rZWQgdG8gZGVmaW5lIHRoZSBjbG9zaW5nIG9mIGVhY2ggcHJvZHVjZWQgd2luZG93LiBJZiBhIGNsb3Npbmcgc2VsZWN0b3IgZnVuY3Rpb24gaXMgc3BlY2lmaWVkIGZvciB0aGUgZmlyc3QgcGFyYW1ldGVyLCB0aGlzIHBhcmFtZXRlciBpcyBpZ25vcmVkLlxuXHQgICAqICBAcmV0dXJucyB7T2JzZXJ2YWJsZX0gQW4gb2JzZXJ2YWJsZSBzZXF1ZW5jZSBvZiB3aW5kb3dzLlxuXHQgICAqL1xuXHQgIG9ic2VydmFibGVQcm90by5idWZmZXIgPSBmdW5jdGlvbiAoKSB7XG5cdCAgICByZXR1cm4gdGhpcy53aW5kb3cuYXBwbHkodGhpcywgYXJndW1lbnRzKVxuXHQgICAgICAuZmxhdE1hcCh0b0FycmF5KTtcblx0ICB9O1xuXHRcblx0ICAvKipcblx0ICAgKiAgUHJvamVjdHMgZWFjaCBlbGVtZW50IG9mIGFuIG9ic2VydmFibGUgc2VxdWVuY2UgaW50byB6ZXJvIG9yIG1vcmUgd2luZG93cy5cblx0ICAgKlxuXHQgICAqICBAcGFyYW0ge01peGVkfSB3aW5kb3dPcGVuaW5nc09yQ2xvc2luZ1NlbGVjdG9yIE9ic2VydmFibGUgc2VxdWVuY2Ugd2hvc2UgZWxlbWVudHMgZGVub3RlIHRoZSBjcmVhdGlvbiBvZiBuZXcgd2luZG93cywgb3IsIGEgZnVuY3Rpb24gaW52b2tlZCB0byBkZWZpbmUgdGhlIGJvdW5kYXJpZXMgb2YgdGhlIHByb2R1Y2VkIHdpbmRvd3MgKGEgbmV3IHdpbmRvdyBpcyBzdGFydGVkIHdoZW4gdGhlIHByZXZpb3VzIG9uZSBpcyBjbG9zZWQsIHJlc3VsdGluZyBpbiBub24tb3ZlcmxhcHBpbmcgd2luZG93cykuXG5cdCAgICogIEBwYXJhbSB7RnVuY3Rpb259IFt3aW5kb3dDbG9zaW5nU2VsZWN0b3JdIEEgZnVuY3Rpb24gaW52b2tlZCB0byBkZWZpbmUgdGhlIGNsb3Npbmcgb2YgZWFjaCBwcm9kdWNlZCB3aW5kb3cuIElmIGEgY2xvc2luZyBzZWxlY3RvciBmdW5jdGlvbiBpcyBzcGVjaWZpZWQgZm9yIHRoZSBmaXJzdCBwYXJhbWV0ZXIsIHRoaXMgcGFyYW1ldGVyIGlzIGlnbm9yZWQuXG5cdCAgICogIEByZXR1cm5zIHtPYnNlcnZhYmxlfSBBbiBvYnNlcnZhYmxlIHNlcXVlbmNlIG9mIHdpbmRvd3MuXG5cdCAgICovXG5cdCAgb2JzZXJ2YWJsZVByb3RvLndpbmRvdyA9IGZ1bmN0aW9uICh3aW5kb3dPcGVuaW5nc09yQ2xvc2luZ1NlbGVjdG9yLCB3aW5kb3dDbG9zaW5nU2VsZWN0b3IpIHtcblx0ICAgIGlmIChhcmd1bWVudHMubGVuZ3RoID09PSAxICYmIHR5cGVvZiBhcmd1bWVudHNbMF0gIT09ICdmdW5jdGlvbicpIHtcblx0ICAgICAgcmV0dXJuIG9ic2VydmFibGVXaW5kb3dXaXRoQm91bmRhcmllcy5jYWxsKHRoaXMsIHdpbmRvd09wZW5pbmdzT3JDbG9zaW5nU2VsZWN0b3IpO1xuXHQgICAgfVxuXHQgICAgcmV0dXJuIHR5cGVvZiB3aW5kb3dPcGVuaW5nc09yQ2xvc2luZ1NlbGVjdG9yID09PSAnZnVuY3Rpb24nID9cblx0ICAgICAgb2JzZXJ2YWJsZVdpbmRvd1dpdGhDbG9zaW5nU2VsZWN0b3IuY2FsbCh0aGlzLCB3aW5kb3dPcGVuaW5nc09yQ2xvc2luZ1NlbGVjdG9yKSA6XG5cdCAgICAgIG9ic2VydmFibGVXaW5kb3dXaXRoT3BlbmluZ3MuY2FsbCh0aGlzLCB3aW5kb3dPcGVuaW5nc09yQ2xvc2luZ1NlbGVjdG9yLCB3aW5kb3dDbG9zaW5nU2VsZWN0b3IpO1xuXHQgIH07XG5cdFxuXHQgIGZ1bmN0aW9uIG9ic2VydmFibGVXaW5kb3dXaXRoT3BlbmluZ3Mod2luZG93T3BlbmluZ3MsIHdpbmRvd0Nsb3NpbmdTZWxlY3Rvcikge1xuXHQgICAgcmV0dXJuIHdpbmRvd09wZW5pbmdzLmdyb3VwSm9pbih0aGlzLCB3aW5kb3dDbG9zaW5nU2VsZWN0b3IsIG9ic2VydmFibGVFbXB0eSwgZnVuY3Rpb24gKF8sIHdpbikge1xuXHQgICAgICByZXR1cm4gd2luO1xuXHQgICAgfSk7XG5cdCAgfVxuXHRcblx0ICBmdW5jdGlvbiBvYnNlcnZhYmxlV2luZG93V2l0aEJvdW5kYXJpZXMod2luZG93Qm91bmRhcmllcykge1xuXHQgICAgdmFyIHNvdXJjZSA9IHRoaXM7XG5cdCAgICByZXR1cm4gbmV3IEFub255bW91c09ic2VydmFibGUoZnVuY3Rpb24gKG9ic2VydmVyKSB7XG5cdCAgICAgIHZhciB3aW4gPSBuZXcgU3ViamVjdCgpLFxuXHQgICAgICAgIGQgPSBuZXcgQ29tcG9zaXRlRGlzcG9zYWJsZSgpLFxuXHQgICAgICAgIHIgPSBuZXcgUmVmQ291bnREaXNwb3NhYmxlKGQpO1xuXHRcblx0ICAgICAgb2JzZXJ2ZXIub25OZXh0KGFkZFJlZih3aW4sIHIpKTtcblx0XG5cdCAgICAgIGQuYWRkKHNvdXJjZS5zdWJzY3JpYmUoZnVuY3Rpb24gKHgpIHtcblx0ICAgICAgICB3aW4ub25OZXh0KHgpO1xuXHQgICAgICB9LCBmdW5jdGlvbiAoZXJyKSB7XG5cdCAgICAgICAgd2luLm9uRXJyb3IoZXJyKTtcblx0ICAgICAgICBvYnNlcnZlci5vbkVycm9yKGVycik7XG5cdCAgICAgIH0sIGZ1bmN0aW9uICgpIHtcblx0ICAgICAgICB3aW4ub25Db21wbGV0ZWQoKTtcblx0ICAgICAgICBvYnNlcnZlci5vbkNvbXBsZXRlZCgpO1xuXHQgICAgICB9KSk7XG5cdFxuXHQgICAgICBpc1Byb21pc2Uod2luZG93Qm91bmRhcmllcykgJiYgKHdpbmRvd0JvdW5kYXJpZXMgPSBvYnNlcnZhYmxlRnJvbVByb21pc2Uod2luZG93Qm91bmRhcmllcykpO1xuXHRcblx0ICAgICAgZC5hZGQod2luZG93Qm91bmRhcmllcy5zdWJzY3JpYmUoZnVuY3Rpb24gKHcpIHtcblx0ICAgICAgICB3aW4ub25Db21wbGV0ZWQoKTtcblx0ICAgICAgICB3aW4gPSBuZXcgU3ViamVjdCgpO1xuXHQgICAgICAgIG9ic2VydmVyLm9uTmV4dChhZGRSZWYod2luLCByKSk7XG5cdCAgICAgIH0sIGZ1bmN0aW9uIChlcnIpIHtcblx0ICAgICAgICB3aW4ub25FcnJvcihlcnIpO1xuXHQgICAgICAgIG9ic2VydmVyLm9uRXJyb3IoZXJyKTtcblx0ICAgICAgfSwgZnVuY3Rpb24gKCkge1xuXHQgICAgICAgIHdpbi5vbkNvbXBsZXRlZCgpO1xuXHQgICAgICAgIG9ic2VydmVyLm9uQ29tcGxldGVkKCk7XG5cdCAgICAgIH0pKTtcblx0XG5cdCAgICAgIHJldHVybiByO1xuXHQgICAgfSwgc291cmNlKTtcblx0ICB9XG5cdFxuXHQgIGZ1bmN0aW9uIG9ic2VydmFibGVXaW5kb3dXaXRoQ2xvc2luZ1NlbGVjdG9yKHdpbmRvd0Nsb3NpbmdTZWxlY3Rvcikge1xuXHQgICAgdmFyIHNvdXJjZSA9IHRoaXM7XG5cdCAgICByZXR1cm4gbmV3IEFub255bW91c09ic2VydmFibGUoZnVuY3Rpb24gKG9ic2VydmVyKSB7XG5cdCAgICAgIHZhciBtID0gbmV3IFNlcmlhbERpc3Bvc2FibGUoKSxcblx0ICAgICAgICBkID0gbmV3IENvbXBvc2l0ZURpc3Bvc2FibGUobSksXG5cdCAgICAgICAgciA9IG5ldyBSZWZDb3VudERpc3Bvc2FibGUoZCksXG5cdCAgICAgICAgd2luID0gbmV3IFN1YmplY3QoKTtcblx0ICAgICAgb2JzZXJ2ZXIub25OZXh0KGFkZFJlZih3aW4sIHIpKTtcblx0ICAgICAgZC5hZGQoc291cmNlLnN1YnNjcmliZShmdW5jdGlvbiAoeCkge1xuXHQgICAgICAgICAgd2luLm9uTmV4dCh4KTtcblx0ICAgICAgfSwgZnVuY3Rpb24gKGVycikge1xuXHQgICAgICAgICAgd2luLm9uRXJyb3IoZXJyKTtcblx0ICAgICAgICAgIG9ic2VydmVyLm9uRXJyb3IoZXJyKTtcblx0ICAgICAgfSwgZnVuY3Rpb24gKCkge1xuXHQgICAgICAgICAgd2luLm9uQ29tcGxldGVkKCk7XG5cdCAgICAgICAgICBvYnNlcnZlci5vbkNvbXBsZXRlZCgpO1xuXHQgICAgICB9KSk7XG5cdFxuXHQgICAgICBmdW5jdGlvbiBjcmVhdGVXaW5kb3dDbG9zZSAoKSB7XG5cdCAgICAgICAgdmFyIHdpbmRvd0Nsb3NlO1xuXHQgICAgICAgIHRyeSB7XG5cdCAgICAgICAgICB3aW5kb3dDbG9zZSA9IHdpbmRvd0Nsb3NpbmdTZWxlY3RvcigpO1xuXHQgICAgICAgIH0gY2F0Y2ggKGUpIHtcblx0ICAgICAgICAgIG9ic2VydmVyLm9uRXJyb3IoZSk7XG5cdCAgICAgICAgICByZXR1cm47XG5cdCAgICAgICAgfVxuXHRcblx0ICAgICAgICBpc1Byb21pc2Uod2luZG93Q2xvc2UpICYmICh3aW5kb3dDbG9zZSA9IG9ic2VydmFibGVGcm9tUHJvbWlzZSh3aW5kb3dDbG9zZSkpO1xuXHRcblx0ICAgICAgICB2YXIgbTEgPSBuZXcgU2luZ2xlQXNzaWdubWVudERpc3Bvc2FibGUoKTtcblx0ICAgICAgICBtLnNldERpc3Bvc2FibGUobTEpO1xuXHQgICAgICAgIG0xLnNldERpc3Bvc2FibGUod2luZG93Q2xvc2UudGFrZSgxKS5zdWJzY3JpYmUobm9vcCwgZnVuY3Rpb24gKGVycikge1xuXHQgICAgICAgICAgd2luLm9uRXJyb3IoZXJyKTtcblx0ICAgICAgICAgIG9ic2VydmVyLm9uRXJyb3IoZXJyKTtcblx0ICAgICAgICB9LCBmdW5jdGlvbiAoKSB7XG5cdCAgICAgICAgICB3aW4ub25Db21wbGV0ZWQoKTtcblx0ICAgICAgICAgIHdpbiA9IG5ldyBTdWJqZWN0KCk7XG5cdCAgICAgICAgICBvYnNlcnZlci5vbk5leHQoYWRkUmVmKHdpbiwgcikpO1xuXHQgICAgICAgICAgY3JlYXRlV2luZG93Q2xvc2UoKTtcblx0ICAgICAgICB9KSk7XG5cdCAgICAgIH1cblx0XG5cdCAgICAgIGNyZWF0ZVdpbmRvd0Nsb3NlKCk7XG5cdCAgICAgIHJldHVybiByO1xuXHQgICAgfSwgc291cmNlKTtcblx0ICB9XG5cdFxuXHQgIC8qKlxuXHQgICAqIFJldHVybnMgYSBuZXcgb2JzZXJ2YWJsZSB0aGF0IHRyaWdnZXJzIG9uIHRoZSBzZWNvbmQgYW5kIHN1YnNlcXVlbnQgdHJpZ2dlcmluZ3Mgb2YgdGhlIGlucHV0IG9ic2VydmFibGUuXG5cdCAgICogVGhlIE50aCB0cmlnZ2VyaW5nIG9mIHRoZSBpbnB1dCBvYnNlcnZhYmxlIHBhc3NlcyB0aGUgYXJndW1lbnRzIGZyb20gdGhlIE4tMXRoIGFuZCBOdGggdHJpZ2dlcmluZyBhcyBhIHBhaXIuXG5cdCAgICogVGhlIGFyZ3VtZW50IHBhc3NlZCB0byB0aGUgTi0xdGggdHJpZ2dlcmluZyBpcyBoZWxkIGluIGhpZGRlbiBpbnRlcm5hbCBzdGF0ZSB1bnRpbCB0aGUgTnRoIHRyaWdnZXJpbmcgb2NjdXJzLlxuXHQgICAqIEByZXR1cm5zIHtPYnNlcnZhYmxlfSBBbiBvYnNlcnZhYmxlIHRoYXQgdHJpZ2dlcnMgb24gc3VjY2Vzc2l2ZSBwYWlycyBvZiBvYnNlcnZhdGlvbnMgZnJvbSB0aGUgaW5wdXQgb2JzZXJ2YWJsZSBhcyBhbiBhcnJheS5cblx0ICAgKi9cblx0ICBvYnNlcnZhYmxlUHJvdG8ucGFpcndpc2UgPSBmdW5jdGlvbiAoKSB7XG5cdCAgICB2YXIgc291cmNlID0gdGhpcztcblx0ICAgIHJldHVybiBuZXcgQW5vbnltb3VzT2JzZXJ2YWJsZShmdW5jdGlvbiAob2JzZXJ2ZXIpIHtcblx0ICAgICAgdmFyIHByZXZpb3VzLCBoYXNQcmV2aW91cyA9IGZhbHNlO1xuXHQgICAgICByZXR1cm4gc291cmNlLnN1YnNjcmliZShcblx0ICAgICAgICBmdW5jdGlvbiAoeCkge1xuXHQgICAgICAgICAgaWYgKGhhc1ByZXZpb3VzKSB7XG5cdCAgICAgICAgICAgIG9ic2VydmVyLm9uTmV4dChbcHJldmlvdXMsIHhdKTtcblx0ICAgICAgICAgIH0gZWxzZSB7XG5cdCAgICAgICAgICAgIGhhc1ByZXZpb3VzID0gdHJ1ZTtcblx0ICAgICAgICAgIH1cblx0ICAgICAgICAgIHByZXZpb3VzID0geDtcblx0ICAgICAgICB9LFxuXHQgICAgICAgIG9ic2VydmVyLm9uRXJyb3IuYmluZChvYnNlcnZlciksXG5cdCAgICAgICAgb2JzZXJ2ZXIub25Db21wbGV0ZWQuYmluZChvYnNlcnZlcikpO1xuXHQgICAgfSwgc291cmNlKTtcblx0ICB9O1xuXHRcblx0ICAvKipcblx0ICAgKiBSZXR1cm5zIHR3byBvYnNlcnZhYmxlcyB3aGljaCBwYXJ0aXRpb24gdGhlIG9ic2VydmF0aW9ucyBvZiB0aGUgc291cmNlIGJ5IHRoZSBnaXZlbiBmdW5jdGlvbi5cblx0ICAgKiBUaGUgZmlyc3Qgd2lsbCB0cmlnZ2VyIG9ic2VydmF0aW9ucyBmb3IgdGhvc2UgdmFsdWVzIGZvciB3aGljaCB0aGUgcHJlZGljYXRlIHJldHVybnMgdHJ1ZS5cblx0ICAgKiBUaGUgc2Vjb25kIHdpbGwgdHJpZ2dlciBvYnNlcnZhdGlvbnMgZm9yIHRob3NlIHZhbHVlcyB3aGVyZSB0aGUgcHJlZGljYXRlIHJldHVybnMgZmFsc2UuXG5cdCAgICogVGhlIHByZWRpY2F0ZSBpcyBleGVjdXRlZCBvbmNlIGZvciBlYWNoIHN1YnNjcmliZWQgb2JzZXJ2ZXIuXG5cdCAgICogQm90aCBhbHNvIHByb3BhZ2F0ZSBhbGwgZXJyb3Igb2JzZXJ2YXRpb25zIGFyaXNpbmcgZnJvbSB0aGUgc291cmNlIGFuZCBlYWNoIGNvbXBsZXRlc1xuXHQgICAqIHdoZW4gdGhlIHNvdXJjZSBjb21wbGV0ZXMuXG5cdCAgICogQHBhcmFtIHtGdW5jdGlvbn0gcHJlZGljYXRlXG5cdCAgICogICAgVGhlIGZ1bmN0aW9uIHRvIGRldGVybWluZSB3aGljaCBvdXRwdXQgT2JzZXJ2YWJsZSB3aWxsIHRyaWdnZXIgYSBwYXJ0aWN1bGFyIG9ic2VydmF0aW9uLlxuXHQgICAqIEByZXR1cm5zIHtBcnJheX1cblx0ICAgKiAgICBBbiBhcnJheSBvZiBvYnNlcnZhYmxlcy4gVGhlIGZpcnN0IHRyaWdnZXJzIHdoZW4gdGhlIHByZWRpY2F0ZSByZXR1cm5zIHRydWUsXG5cdCAgICogICAgYW5kIHRoZSBzZWNvbmQgdHJpZ2dlcnMgd2hlbiB0aGUgcHJlZGljYXRlIHJldHVybnMgZmFsc2UuXG5cdCAgKi9cblx0ICBvYnNlcnZhYmxlUHJvdG8ucGFydGl0aW9uID0gZnVuY3Rpb24ocHJlZGljYXRlLCB0aGlzQXJnKSB7XG5cdCAgICByZXR1cm4gW1xuXHQgICAgICB0aGlzLmZpbHRlcihwcmVkaWNhdGUsIHRoaXNBcmcpLFxuXHQgICAgICB0aGlzLmZpbHRlcihmdW5jdGlvbiAoeCwgaSwgbykgeyByZXR1cm4gIXByZWRpY2F0ZS5jYWxsKHRoaXNBcmcsIHgsIGksIG8pOyB9KVxuXHQgICAgXTtcblx0ICB9O1xuXHRcblx0ICB2YXIgV2hpbGVFbnVtZXJhYmxlID0gKGZ1bmN0aW9uKF9fc3VwZXJfXykge1xuXHQgICAgaW5oZXJpdHMoV2hpbGVFbnVtZXJhYmxlLCBfX3N1cGVyX18pO1xuXHQgICAgZnVuY3Rpb24gV2hpbGVFbnVtZXJhYmxlKGMsIHMpIHtcblx0ICAgICAgdGhpcy5jID0gYztcblx0ICAgICAgdGhpcy5zID0gcztcblx0ICAgIH1cblx0ICAgIFdoaWxlRW51bWVyYWJsZS5wcm90b3R5cGVbJGl0ZXJhdG9yJF0gPSBmdW5jdGlvbiAoKSB7XG5cdCAgICAgIHZhciBzZWxmID0gdGhpcztcblx0ICAgICAgcmV0dXJuIHtcblx0ICAgICAgICBuZXh0OiBmdW5jdGlvbiAoKSB7XG5cdCAgICAgICAgICByZXR1cm4gc2VsZi5jKCkgP1xuXHQgICAgICAgICAgIHsgZG9uZTogZmFsc2UsIHZhbHVlOiBzZWxmLnMgfSA6XG5cdCAgICAgICAgICAgeyBkb25lOiB0cnVlLCB2YWx1ZTogdm9pZCAwIH07XG5cdCAgICAgICAgfVxuXHQgICAgICB9O1xuXHQgICAgfTtcblx0ICAgIHJldHVybiBXaGlsZUVudW1lcmFibGU7XG5cdCAgfShFbnVtZXJhYmxlKSk7XG5cdCAgXG5cdCAgZnVuY3Rpb24gZW51bWVyYWJsZVdoaWxlKGNvbmRpdGlvbiwgc291cmNlKSB7XG5cdCAgICByZXR1cm4gbmV3IFdoaWxlRW51bWVyYWJsZShjb25kaXRpb24sIHNvdXJjZSk7XG5cdCAgfSAgXG5cdFxuXHQgICAvKipcblx0ICAgKiAgUmV0dXJucyBhbiBvYnNlcnZhYmxlIHNlcXVlbmNlIHRoYXQgaXMgdGhlIHJlc3VsdCBvZiBpbnZva2luZyB0aGUgc2VsZWN0b3Igb24gdGhlIHNvdXJjZSBzZXF1ZW5jZSwgd2l0aG91dCBzaGFyaW5nIHN1YnNjcmlwdGlvbnMuXG5cdCAgICogIFRoaXMgb3BlcmF0b3IgYWxsb3dzIGZvciBhIGZsdWVudCBzdHlsZSBvZiB3cml0aW5nIHF1ZXJpZXMgdGhhdCB1c2UgdGhlIHNhbWUgc2VxdWVuY2UgbXVsdGlwbGUgdGltZXMuXG5cdCAgICpcblx0ICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBzZWxlY3RvciBTZWxlY3RvciBmdW5jdGlvbiB3aGljaCBjYW4gdXNlIHRoZSBzb3VyY2Ugc2VxdWVuY2UgYXMgbWFueSB0aW1lcyBhcyBuZWVkZWQsIHdpdGhvdXQgc2hhcmluZyBzdWJzY3JpcHRpb25zIHRvIHRoZSBzb3VyY2Ugc2VxdWVuY2UuXG5cdCAgICogQHJldHVybnMge09ic2VydmFibGV9IEFuIG9ic2VydmFibGUgc2VxdWVuY2UgdGhhdCBjb250YWlucyB0aGUgZWxlbWVudHMgb2YgYSBzZXF1ZW5jZSBwcm9kdWNlZCBieSBtdWx0aWNhc3RpbmcgdGhlIHNvdXJjZSBzZXF1ZW5jZSB3aXRoaW4gYSBzZWxlY3RvciBmdW5jdGlvbi5cblx0ICAgKi9cblx0ICBvYnNlcnZhYmxlUHJvdG8ubGV0QmluZCA9IG9ic2VydmFibGVQcm90b1snbGV0J10gPSBmdW5jdGlvbiAoZnVuYykge1xuXHQgICAgcmV0dXJuIGZ1bmModGhpcyk7XG5cdCAgfTtcblx0XG5cdCAgIC8qKlxuXHQgICAqICBEZXRlcm1pbmVzIHdoZXRoZXIgYW4gb2JzZXJ2YWJsZSBjb2xsZWN0aW9uIGNvbnRhaW5zIHZhbHVlcy4gXG5cdCAgICpcblx0ICAgKiBAZXhhbXBsZVxuXHQgICAqICAxIC0gcmVzID0gUnguT2JzZXJ2YWJsZS5pZihjb25kaXRpb24sIG9iczEpO1xuXHQgICAqICAyIC0gcmVzID0gUnguT2JzZXJ2YWJsZS5pZihjb25kaXRpb24sIG9iczEsIG9iczIpO1xuXHQgICAqICAzIC0gcmVzID0gUnguT2JzZXJ2YWJsZS5pZihjb25kaXRpb24sIG9iczEsIHNjaGVkdWxlcik7XG5cdCAgICogQHBhcmFtIHtGdW5jdGlvbn0gY29uZGl0aW9uIFRoZSBjb25kaXRpb24gd2hpY2ggZGV0ZXJtaW5lcyBpZiB0aGUgdGhlblNvdXJjZSBvciBlbHNlU291cmNlIHdpbGwgYmUgcnVuLlxuXHQgICAqIEBwYXJhbSB7T2JzZXJ2YWJsZX0gdGhlblNvdXJjZSBUaGUgb2JzZXJ2YWJsZSBzZXF1ZW5jZSBvciBQcm9taXNlIHRoYXQgd2lsbCBiZSBydW4gaWYgdGhlIGNvbmRpdGlvbiBmdW5jdGlvbiByZXR1cm5zIHRydWUuXG5cdCAgICogQHBhcmFtIHtPYnNlcnZhYmxlfSBbZWxzZVNvdXJjZV0gVGhlIG9ic2VydmFibGUgc2VxdWVuY2Ugb3IgUHJvbWlzZSB0aGF0IHdpbGwgYmUgcnVuIGlmIHRoZSBjb25kaXRpb24gZnVuY3Rpb24gcmV0dXJucyBmYWxzZS4gSWYgdGhpcyBpcyBub3QgcHJvdmlkZWQsIGl0IGRlZmF1bHRzIHRvIFJ4Lk9ic2VydmFiZS5FbXB0eSB3aXRoIHRoZSBzcGVjaWZpZWQgc2NoZWR1bGVyLlxuXHQgICAqIEByZXR1cm5zIHtPYnNlcnZhYmxlfSBBbiBvYnNlcnZhYmxlIHNlcXVlbmNlIHdoaWNoIGlzIGVpdGhlciB0aGUgdGhlblNvdXJjZSBvciBlbHNlU291cmNlLlxuXHQgICAqL1xuXHQgIE9ic2VydmFibGVbJ2lmJ10gPSBmdW5jdGlvbiAoY29uZGl0aW9uLCB0aGVuU291cmNlLCBlbHNlU291cmNlT3JTY2hlZHVsZXIpIHtcblx0ICAgIHJldHVybiBvYnNlcnZhYmxlRGVmZXIoZnVuY3Rpb24gKCkge1xuXHQgICAgICBlbHNlU291cmNlT3JTY2hlZHVsZXIgfHwgKGVsc2VTb3VyY2VPclNjaGVkdWxlciA9IG9ic2VydmFibGVFbXB0eSgpKTtcblx0XG5cdCAgICAgIGlzUHJvbWlzZSh0aGVuU291cmNlKSAmJiAodGhlblNvdXJjZSA9IG9ic2VydmFibGVGcm9tUHJvbWlzZSh0aGVuU291cmNlKSk7XG5cdCAgICAgIGlzUHJvbWlzZShlbHNlU291cmNlT3JTY2hlZHVsZXIpICYmIChlbHNlU291cmNlT3JTY2hlZHVsZXIgPSBvYnNlcnZhYmxlRnJvbVByb21pc2UoZWxzZVNvdXJjZU9yU2NoZWR1bGVyKSk7XG5cdFxuXHQgICAgICAvLyBBc3N1bWUgYSBzY2hlZHVsZXIgZm9yIGVtcHR5IG9ubHlcblx0ICAgICAgdHlwZW9mIGVsc2VTb3VyY2VPclNjaGVkdWxlci5ub3cgPT09ICdmdW5jdGlvbicgJiYgKGVsc2VTb3VyY2VPclNjaGVkdWxlciA9IG9ic2VydmFibGVFbXB0eShlbHNlU291cmNlT3JTY2hlZHVsZXIpKTtcblx0ICAgICAgcmV0dXJuIGNvbmRpdGlvbigpID8gdGhlblNvdXJjZSA6IGVsc2VTb3VyY2VPclNjaGVkdWxlcjtcblx0ICAgIH0pO1xuXHQgIH07XG5cdFxuXHQgICAvKipcblx0ICAgKiAgQ29uY2F0ZW5hdGVzIHRoZSBvYnNlcnZhYmxlIHNlcXVlbmNlcyBvYnRhaW5lZCBieSBydW5uaW5nIHRoZSBzcGVjaWZpZWQgcmVzdWx0IHNlbGVjdG9yIGZvciBlYWNoIGVsZW1lbnQgaW4gc291cmNlLlxuXHQgICAqIFRoZXJlIGlzIGFuIGFsaWFzIGZvciB0aGlzIG1ldGhvZCBjYWxsZWQgJ2ZvckluJyBmb3IgYnJvd3NlcnMgPElFOVxuXHQgICAqIEBwYXJhbSB7QXJyYXl9IHNvdXJjZXMgQW4gYXJyYXkgb2YgdmFsdWVzIHRvIHR1cm4gaW50byBhbiBvYnNlcnZhYmxlIHNlcXVlbmNlLlxuXHQgICAqIEBwYXJhbSB7RnVuY3Rpb259IHJlc3VsdFNlbGVjdG9yIEEgZnVuY3Rpb24gdG8gYXBwbHkgdG8gZWFjaCBpdGVtIGluIHRoZSBzb3VyY2VzIGFycmF5IHRvIHR1cm4gaXQgaW50byBhbiBvYnNlcnZhYmxlIHNlcXVlbmNlLlxuXHQgICAqIEByZXR1cm5zIHtPYnNlcnZhYmxlfSBBbiBvYnNlcnZhYmxlIHNlcXVlbmNlIGZyb20gdGhlIGNvbmNhdGVuYXRlZCBvYnNlcnZhYmxlIHNlcXVlbmNlcy5cblx0ICAgKi9cblx0ICBPYnNlcnZhYmxlWydmb3InXSA9IE9ic2VydmFibGUuZm9ySW4gPSBmdW5jdGlvbiAoc291cmNlcywgcmVzdWx0U2VsZWN0b3IsIHRoaXNBcmcpIHtcblx0ICAgIHJldHVybiBlbnVtZXJhYmxlT2Yoc291cmNlcywgcmVzdWx0U2VsZWN0b3IsIHRoaXNBcmcpLmNvbmNhdCgpO1xuXHQgIH07XG5cdFxuXHQgICAvKipcblx0ICAgKiAgUmVwZWF0cyBzb3VyY2UgYXMgbG9uZyBhcyBjb25kaXRpb24gaG9sZHMgZW11bGF0aW5nIGEgd2hpbGUgbG9vcC5cblx0ICAgKiBUaGVyZSBpcyBhbiBhbGlhcyBmb3IgdGhpcyBtZXRob2QgY2FsbGVkICd3aGlsZURvJyBmb3IgYnJvd3NlcnMgPElFOVxuXHQgICAqXG5cdCAgICogQHBhcmFtIHtGdW5jdGlvbn0gY29uZGl0aW9uIFRoZSBjb25kaXRpb24gd2hpY2ggZGV0ZXJtaW5lcyBpZiB0aGUgc291cmNlIHdpbGwgYmUgcmVwZWF0ZWQuXG5cdCAgICogQHBhcmFtIHtPYnNlcnZhYmxlfSBzb3VyY2UgVGhlIG9ic2VydmFibGUgc2VxdWVuY2UgdGhhdCB3aWxsIGJlIHJ1biBpZiB0aGUgY29uZGl0aW9uIGZ1bmN0aW9uIHJldHVybnMgdHJ1ZS5cblx0ICAgKiBAcmV0dXJucyB7T2JzZXJ2YWJsZX0gQW4gb2JzZXJ2YWJsZSBzZXF1ZW5jZSB3aGljaCBpcyByZXBlYXRlZCBhcyBsb25nIGFzIHRoZSBjb25kaXRpb24gaG9sZHMuXG5cdCAgICovXG5cdCAgdmFyIG9ic2VydmFibGVXaGlsZURvID0gT2JzZXJ2YWJsZVsnd2hpbGUnXSA9IE9ic2VydmFibGUud2hpbGVEbyA9IGZ1bmN0aW9uIChjb25kaXRpb24sIHNvdXJjZSkge1xuXHQgICAgaXNQcm9taXNlKHNvdXJjZSkgJiYgKHNvdXJjZSA9IG9ic2VydmFibGVGcm9tUHJvbWlzZShzb3VyY2UpKTtcblx0ICAgIHJldHVybiBlbnVtZXJhYmxlV2hpbGUoY29uZGl0aW9uLCBzb3VyY2UpLmNvbmNhdCgpO1xuXHQgIH07XG5cdFxuXHQgICAvKipcblx0ICAgKiAgUmVwZWF0cyBzb3VyY2UgYXMgbG9uZyBhcyBjb25kaXRpb24gaG9sZHMgZW11bGF0aW5nIGEgZG8gd2hpbGUgbG9vcC5cblx0ICAgKlxuXHQgICAqIEBwYXJhbSB7RnVuY3Rpb259IGNvbmRpdGlvbiBUaGUgY29uZGl0aW9uIHdoaWNoIGRldGVybWluZXMgaWYgdGhlIHNvdXJjZSB3aWxsIGJlIHJlcGVhdGVkLlxuXHQgICAqIEBwYXJhbSB7T2JzZXJ2YWJsZX0gc291cmNlIFRoZSBvYnNlcnZhYmxlIHNlcXVlbmNlIHRoYXQgd2lsbCBiZSBydW4gaWYgdGhlIGNvbmRpdGlvbiBmdW5jdGlvbiByZXR1cm5zIHRydWUuXG5cdCAgICogQHJldHVybnMge09ic2VydmFibGV9IEFuIG9ic2VydmFibGUgc2VxdWVuY2Ugd2hpY2ggaXMgcmVwZWF0ZWQgYXMgbG9uZyBhcyB0aGUgY29uZGl0aW9uIGhvbGRzLlxuXHQgICAqL1xuXHQgIG9ic2VydmFibGVQcm90by5kb1doaWxlID0gZnVuY3Rpb24gKGNvbmRpdGlvbikge1xuXHQgICAgcmV0dXJuIG9ic2VydmFibGVDb25jYXQoW3RoaXMsIG9ic2VydmFibGVXaGlsZURvKGNvbmRpdGlvbiwgdGhpcyldKTtcblx0ICB9O1xuXHRcblx0ICAgLyoqXG5cdCAgICogIFVzZXMgc2VsZWN0b3IgdG8gZGV0ZXJtaW5lIHdoaWNoIHNvdXJjZSBpbiBzb3VyY2VzIHRvIHVzZS5cblx0ICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBzZWxlY3RvciBUaGUgZnVuY3Rpb24gd2hpY2ggZXh0cmFjdHMgdGhlIHZhbHVlIGZvciB0byB0ZXN0IGluIGEgY2FzZSBzdGF0ZW1lbnQuXG5cdCAgICogQHBhcmFtIHtBcnJheX0gc291cmNlcyBBIG9iamVjdCB3aGljaCBoYXMga2V5cyB3aGljaCBjb3JyZXNwb25kIHRvIHRoZSBjYXNlIHN0YXRlbWVudCBsYWJlbHMuXG5cdCAgICogQHBhcmFtIHtPYnNlcnZhYmxlfSBbZWxzZVNvdXJjZV0gVGhlIG9ic2VydmFibGUgc2VxdWVuY2Ugb3IgUHJvbWlzZSB0aGF0IHdpbGwgYmUgcnVuIGlmIHRoZSBzb3VyY2VzIGFyZSBub3QgbWF0Y2hlZC4gSWYgdGhpcyBpcyBub3QgcHJvdmlkZWQsIGl0IGRlZmF1bHRzIHRvIFJ4Lk9ic2VydmFiZS5lbXB0eSB3aXRoIHRoZSBzcGVjaWZpZWQgc2NoZWR1bGVyLlxuXHQgICAqXG5cdCAgICogQHJldHVybnMge09ic2VydmFibGV9IEFuIG9ic2VydmFibGUgc2VxdWVuY2Ugd2hpY2ggaXMgZGV0ZXJtaW5lZCBieSBhIGNhc2Ugc3RhdGVtZW50LlxuXHQgICAqL1xuXHQgIE9ic2VydmFibGVbJ2Nhc2UnXSA9IGZ1bmN0aW9uIChzZWxlY3Rvciwgc291cmNlcywgZGVmYXVsdFNvdXJjZU9yU2NoZWR1bGVyKSB7XG5cdCAgICByZXR1cm4gb2JzZXJ2YWJsZURlZmVyKGZ1bmN0aW9uICgpIHtcblx0ICAgICAgaXNQcm9taXNlKGRlZmF1bHRTb3VyY2VPclNjaGVkdWxlcikgJiYgKGRlZmF1bHRTb3VyY2VPclNjaGVkdWxlciA9IG9ic2VydmFibGVGcm9tUHJvbWlzZShkZWZhdWx0U291cmNlT3JTY2hlZHVsZXIpKTtcblx0ICAgICAgZGVmYXVsdFNvdXJjZU9yU2NoZWR1bGVyIHx8IChkZWZhdWx0U291cmNlT3JTY2hlZHVsZXIgPSBvYnNlcnZhYmxlRW1wdHkoKSk7XG5cdFxuXHQgICAgICBpc1NjaGVkdWxlcihkZWZhdWx0U291cmNlT3JTY2hlZHVsZXIpICYmIChkZWZhdWx0U291cmNlT3JTY2hlZHVsZXIgPSBvYnNlcnZhYmxlRW1wdHkoZGVmYXVsdFNvdXJjZU9yU2NoZWR1bGVyKSk7XG5cdFxuXHQgICAgICB2YXIgcmVzdWx0ID0gc291cmNlc1tzZWxlY3RvcigpXTtcblx0ICAgICAgaXNQcm9taXNlKHJlc3VsdCkgJiYgKHJlc3VsdCA9IG9ic2VydmFibGVGcm9tUHJvbWlzZShyZXN1bHQpKTtcblx0XG5cdCAgICAgIHJldHVybiByZXN1bHQgfHwgZGVmYXVsdFNvdXJjZU9yU2NoZWR1bGVyO1xuXHQgICAgfSk7XG5cdCAgfTtcblx0XG5cdCAgIC8qKlxuXHQgICAqICBFeHBhbmRzIGFuIG9ic2VydmFibGUgc2VxdWVuY2UgYnkgcmVjdXJzaXZlbHkgaW52b2tpbmcgc2VsZWN0b3IuXG5cdCAgICpcblx0ICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBzZWxlY3RvciBTZWxlY3RvciBmdW5jdGlvbiB0byBpbnZva2UgZm9yIGVhY2ggcHJvZHVjZWQgZWxlbWVudCwgcmVzdWx0aW5nIGluIGFub3RoZXIgc2VxdWVuY2UgdG8gd2hpY2ggdGhlIHNlbGVjdG9yIHdpbGwgYmUgaW52b2tlZCByZWN1cnNpdmVseSBhZ2Fpbi5cblx0ICAgKiBAcGFyYW0ge1NjaGVkdWxlcn0gW3NjaGVkdWxlcl0gU2NoZWR1bGVyIG9uIHdoaWNoIHRvIHBlcmZvcm0gdGhlIGV4cGFuc2lvbi4gSWYgbm90IHByb3ZpZGVkLCB0aGlzIGRlZmF1bHRzIHRvIHRoZSBjdXJyZW50IHRocmVhZCBzY2hlZHVsZXIuXG5cdCAgICogQHJldHVybnMge09ic2VydmFibGV9IEFuIG9ic2VydmFibGUgc2VxdWVuY2UgY29udGFpbmluZyBhbGwgdGhlIGVsZW1lbnRzIHByb2R1Y2VkIGJ5IHRoZSByZWN1cnNpdmUgZXhwYW5zaW9uLlxuXHQgICAqL1xuXHQgIG9ic2VydmFibGVQcm90by5leHBhbmQgPSBmdW5jdGlvbiAoc2VsZWN0b3IsIHNjaGVkdWxlcikge1xuXHQgICAgaXNTY2hlZHVsZXIoc2NoZWR1bGVyKSB8fCAoc2NoZWR1bGVyID0gaW1tZWRpYXRlU2NoZWR1bGVyKTtcblx0ICAgIHZhciBzb3VyY2UgPSB0aGlzO1xuXHQgICAgcmV0dXJuIG5ldyBBbm9ueW1vdXNPYnNlcnZhYmxlKGZ1bmN0aW9uIChvKSB7XG5cdCAgICAgIHZhciBxID0gW10sXG5cdCAgICAgICAgbSA9IG5ldyBTZXJpYWxEaXNwb3NhYmxlKCksXG5cdCAgICAgICAgZCA9IG5ldyBDb21wb3NpdGVEaXNwb3NhYmxlKG0pLFxuXHQgICAgICAgIGFjdGl2ZUNvdW50ID0gMCxcblx0ICAgICAgICBpc0FjcXVpcmVkID0gZmFsc2U7XG5cdFxuXHQgICAgICB2YXIgZW5zdXJlQWN0aXZlID0gZnVuY3Rpb24gKCkge1xuXHQgICAgICAgIHZhciBpc093bmVyID0gZmFsc2U7XG5cdCAgICAgICAgaWYgKHEubGVuZ3RoID4gMCkge1xuXHQgICAgICAgICAgaXNPd25lciA9ICFpc0FjcXVpcmVkO1xuXHQgICAgICAgICAgaXNBY3F1aXJlZCA9IHRydWU7XG5cdCAgICAgICAgfVxuXHQgICAgICAgIGlmIChpc093bmVyKSB7XG5cdCAgICAgICAgICBtLnNldERpc3Bvc2FibGUoc2NoZWR1bGVyLnNjaGVkdWxlUmVjdXJzaXZlKG51bGwsIGZ1bmN0aW9uIChfLCBzZWxmKSB7XG5cdCAgICAgICAgICAgIHZhciB3b3JrO1xuXHQgICAgICAgICAgICBpZiAocS5sZW5ndGggPiAwKSB7XG5cdCAgICAgICAgICAgICAgd29yayA9IHEuc2hpZnQoKTtcblx0ICAgICAgICAgICAgfSBlbHNlIHtcblx0ICAgICAgICAgICAgICBpc0FjcXVpcmVkID0gZmFsc2U7XG5cdCAgICAgICAgICAgICAgcmV0dXJuO1xuXHQgICAgICAgICAgICB9XG5cdCAgICAgICAgICAgIHZhciBtMSA9IG5ldyBTaW5nbGVBc3NpZ25tZW50RGlzcG9zYWJsZSgpO1xuXHQgICAgICAgICAgICBkLmFkZChtMSk7XG5cdCAgICAgICAgICAgIG0xLnNldERpc3Bvc2FibGUod29yay5zdWJzY3JpYmUoZnVuY3Rpb24gKHgpIHtcblx0ICAgICAgICAgICAgICBvLm9uTmV4dCh4KTtcblx0ICAgICAgICAgICAgICB2YXIgcmVzdWx0ID0gbnVsbDtcblx0ICAgICAgICAgICAgICB0cnkge1xuXHQgICAgICAgICAgICAgICAgcmVzdWx0ID0gc2VsZWN0b3IoeCk7XG5cdCAgICAgICAgICAgICAgfSBjYXRjaCAoZSkge1xuXHQgICAgICAgICAgICAgICAgby5vbkVycm9yKGUpO1xuXHQgICAgICAgICAgICAgIH1cblx0ICAgICAgICAgICAgICBxLnB1c2gocmVzdWx0KTtcblx0ICAgICAgICAgICAgICBhY3RpdmVDb3VudCsrO1xuXHQgICAgICAgICAgICAgIGVuc3VyZUFjdGl2ZSgpO1xuXHQgICAgICAgICAgICB9LCBmdW5jdGlvbiAoZSkgeyBvLm9uRXJyb3IoZSk7IH0sIGZ1bmN0aW9uICgpIHtcblx0ICAgICAgICAgICAgICBkLnJlbW92ZShtMSk7XG5cdCAgICAgICAgICAgICAgYWN0aXZlQ291bnQtLTtcblx0ICAgICAgICAgICAgICBpZiAoYWN0aXZlQ291bnQgPT09IDApIHtcblx0ICAgICAgICAgICAgICAgIG8ub25Db21wbGV0ZWQoKTtcblx0ICAgICAgICAgICAgICB9XG5cdCAgICAgICAgICAgIH0pKTtcblx0ICAgICAgICAgICAgc2VsZigpO1xuXHQgICAgICAgICAgfSkpO1xuXHQgICAgICAgIH1cblx0ICAgICAgfTtcblx0XG5cdCAgICAgIHEucHVzaChzb3VyY2UpO1xuXHQgICAgICBhY3RpdmVDb3VudCsrO1xuXHQgICAgICBlbnN1cmVBY3RpdmUoKTtcblx0ICAgICAgcmV0dXJuIGQ7XG5cdCAgICB9LCB0aGlzKTtcblx0ICB9O1xuXHRcblx0ICAgLyoqXG5cdCAgICogIFJ1bnMgYWxsIG9ic2VydmFibGUgc2VxdWVuY2VzIGluIHBhcmFsbGVsIGFuZCBjb2xsZWN0IHRoZWlyIGxhc3QgZWxlbWVudHMuXG5cdCAgICpcblx0ICAgKiBAZXhhbXBsZVxuXHQgICAqICAxIC0gcmVzID0gUnguT2JzZXJ2YWJsZS5mb3JrSm9pbihbb2JzMSwgb2JzMl0pO1xuXHQgICAqICAxIC0gcmVzID0gUnguT2JzZXJ2YWJsZS5mb3JrSm9pbihvYnMxLCBvYnMyLCAuLi4pO1xuXHQgICAqIEByZXR1cm5zIHtPYnNlcnZhYmxlfSBBbiBvYnNlcnZhYmxlIHNlcXVlbmNlIHdpdGggYW4gYXJyYXkgY29sbGVjdGluZyB0aGUgbGFzdCBlbGVtZW50cyBvZiBhbGwgdGhlIGlucHV0IHNlcXVlbmNlcy5cblx0ICAgKi9cblx0ICBPYnNlcnZhYmxlLmZvcmtKb2luID0gZnVuY3Rpb24gKCkge1xuXHQgICAgdmFyIGFsbFNvdXJjZXMgPSBbXTtcblx0ICAgIGlmIChBcnJheS5pc0FycmF5KGFyZ3VtZW50c1swXSkpIHtcblx0ICAgICAgYWxsU291cmNlcyA9IGFyZ3VtZW50c1swXTtcblx0ICAgIH0gZWxzZSB7XG5cdCAgICAgIGZvcih2YXIgaSA9IDAsIGxlbiA9IGFyZ3VtZW50cy5sZW5ndGg7IGkgPCBsZW47IGkrKykgeyBhbGxTb3VyY2VzLnB1c2goYXJndW1lbnRzW2ldKTsgfVxuXHQgICAgfVxuXHQgICAgcmV0dXJuIG5ldyBBbm9ueW1vdXNPYnNlcnZhYmxlKGZ1bmN0aW9uIChzdWJzY3JpYmVyKSB7XG5cdCAgICAgIHZhciBjb3VudCA9IGFsbFNvdXJjZXMubGVuZ3RoO1xuXHQgICAgICBpZiAoY291bnQgPT09IDApIHtcblx0ICAgICAgICBzdWJzY3JpYmVyLm9uQ29tcGxldGVkKCk7XG5cdCAgICAgICAgcmV0dXJuIGRpc3Bvc2FibGVFbXB0eTtcblx0ICAgICAgfVxuXHQgICAgICB2YXIgZ3JvdXAgPSBuZXcgQ29tcG9zaXRlRGlzcG9zYWJsZSgpLFxuXHQgICAgICAgIGZpbmlzaGVkID0gZmFsc2UsXG5cdCAgICAgICAgaGFzUmVzdWx0cyA9IG5ldyBBcnJheShjb3VudCksXG5cdCAgICAgICAgaGFzQ29tcGxldGVkID0gbmV3IEFycmF5KGNvdW50KSxcblx0ICAgICAgICByZXN1bHRzID0gbmV3IEFycmF5KGNvdW50KTtcblx0XG5cdCAgICAgIGZvciAodmFyIGlkeCA9IDA7IGlkeCA8IGNvdW50OyBpZHgrKykge1xuXHQgICAgICAgIChmdW5jdGlvbiAoaSkge1xuXHQgICAgICAgICAgdmFyIHNvdXJjZSA9IGFsbFNvdXJjZXNbaV07XG5cdCAgICAgICAgICBpc1Byb21pc2Uoc291cmNlKSAmJiAoc291cmNlID0gb2JzZXJ2YWJsZUZyb21Qcm9taXNlKHNvdXJjZSkpO1xuXHQgICAgICAgICAgZ3JvdXAuYWRkKFxuXHQgICAgICAgICAgICBzb3VyY2Uuc3Vic2NyaWJlKFxuXHQgICAgICAgICAgICAgIGZ1bmN0aW9uICh2YWx1ZSkge1xuXHQgICAgICAgICAgICAgIGlmICghZmluaXNoZWQpIHtcblx0ICAgICAgICAgICAgICAgIGhhc1Jlc3VsdHNbaV0gPSB0cnVlO1xuXHQgICAgICAgICAgICAgICAgcmVzdWx0c1tpXSA9IHZhbHVlO1xuXHQgICAgICAgICAgICAgIH1cblx0ICAgICAgICAgICAgfSxcblx0ICAgICAgICAgICAgZnVuY3Rpb24gKGUpIHtcblx0ICAgICAgICAgICAgICBmaW5pc2hlZCA9IHRydWU7XG5cdCAgICAgICAgICAgICAgc3Vic2NyaWJlci5vbkVycm9yKGUpO1xuXHQgICAgICAgICAgICAgIGdyb3VwLmRpc3Bvc2UoKTtcblx0ICAgICAgICAgICAgfSxcblx0ICAgICAgICAgICAgZnVuY3Rpb24gKCkge1xuXHQgICAgICAgICAgICAgIGlmICghZmluaXNoZWQpIHtcblx0ICAgICAgICAgICAgICAgIGlmICghaGFzUmVzdWx0c1tpXSkge1xuXHQgICAgICAgICAgICAgICAgICAgIHN1YnNjcmliZXIub25Db21wbGV0ZWQoKTtcblx0ICAgICAgICAgICAgICAgICAgICByZXR1cm47XG5cdCAgICAgICAgICAgICAgICB9XG5cdCAgICAgICAgICAgICAgICBoYXNDb21wbGV0ZWRbaV0gPSB0cnVlO1xuXHQgICAgICAgICAgICAgICAgZm9yICh2YXIgaXggPSAwOyBpeCA8IGNvdW50OyBpeCsrKSB7XG5cdCAgICAgICAgICAgICAgICAgIGlmICghaGFzQ29tcGxldGVkW2l4XSkgeyByZXR1cm47IH1cblx0ICAgICAgICAgICAgICAgIH1cblx0ICAgICAgICAgICAgICAgIGZpbmlzaGVkID0gdHJ1ZTtcblx0ICAgICAgICAgICAgICAgIHN1YnNjcmliZXIub25OZXh0KHJlc3VsdHMpO1xuXHQgICAgICAgICAgICAgICAgc3Vic2NyaWJlci5vbkNvbXBsZXRlZCgpO1xuXHQgICAgICAgICAgICAgIH1cblx0ICAgICAgICAgICAgfSkpO1xuXHQgICAgICAgIH0pKGlkeCk7XG5cdCAgICAgIH1cblx0XG5cdCAgICAgIHJldHVybiBncm91cDtcblx0ICAgIH0pO1xuXHQgIH07XG5cdFxuXHQgICAvKipcblx0ICAgKiAgUnVucyB0d28gb2JzZXJ2YWJsZSBzZXF1ZW5jZXMgaW4gcGFyYWxsZWwgYW5kIGNvbWJpbmVzIHRoZWlyIGxhc3QgZWxlbWVuZXRzLlxuXHQgICAqIEBwYXJhbSB7T2JzZXJ2YWJsZX0gc2Vjb25kIFNlY29uZCBvYnNlcnZhYmxlIHNlcXVlbmNlLlxuXHQgICAqIEBwYXJhbSB7RnVuY3Rpb259IHJlc3VsdFNlbGVjdG9yIFJlc3VsdCBzZWxlY3RvciBmdW5jdGlvbiB0byBpbnZva2Ugd2l0aCB0aGUgbGFzdCBlbGVtZW50cyBvZiBib3RoIHNlcXVlbmNlcy5cblx0ICAgKiBAcmV0dXJucyB7T2JzZXJ2YWJsZX0gQW4gb2JzZXJ2YWJsZSBzZXF1ZW5jZSB3aXRoIHRoZSByZXN1bHQgb2YgY2FsbGluZyB0aGUgc2VsZWN0b3IgZnVuY3Rpb24gd2l0aCB0aGUgbGFzdCBlbGVtZW50cyBvZiBib3RoIGlucHV0IHNlcXVlbmNlcy5cblx0ICAgKi9cblx0ICBvYnNlcnZhYmxlUHJvdG8uZm9ya0pvaW4gPSBmdW5jdGlvbiAoc2Vjb25kLCByZXN1bHRTZWxlY3Rvcikge1xuXHQgICAgdmFyIGZpcnN0ID0gdGhpcztcblx0ICAgIHJldHVybiBuZXcgQW5vbnltb3VzT2JzZXJ2YWJsZShmdW5jdGlvbiAob2JzZXJ2ZXIpIHtcblx0ICAgICAgdmFyIGxlZnRTdG9wcGVkID0gZmFsc2UsIHJpZ2h0U3RvcHBlZCA9IGZhbHNlLFxuXHQgICAgICAgIGhhc0xlZnQgPSBmYWxzZSwgaGFzUmlnaHQgPSBmYWxzZSxcblx0ICAgICAgICBsYXN0TGVmdCwgbGFzdFJpZ2h0LFxuXHQgICAgICAgIGxlZnRTdWJzY3JpcHRpb24gPSBuZXcgU2luZ2xlQXNzaWdubWVudERpc3Bvc2FibGUoKSwgcmlnaHRTdWJzY3JpcHRpb24gPSBuZXcgU2luZ2xlQXNzaWdubWVudERpc3Bvc2FibGUoKTtcblx0XG5cdCAgICAgIGlzUHJvbWlzZShzZWNvbmQpICYmIChzZWNvbmQgPSBvYnNlcnZhYmxlRnJvbVByb21pc2Uoc2Vjb25kKSk7XG5cdFxuXHQgICAgICBsZWZ0U3Vic2NyaXB0aW9uLnNldERpc3Bvc2FibGUoXG5cdCAgICAgICAgICBmaXJzdC5zdWJzY3JpYmUoZnVuY3Rpb24gKGxlZnQpIHtcblx0ICAgICAgICAgICAgaGFzTGVmdCA9IHRydWU7XG5cdCAgICAgICAgICAgIGxhc3RMZWZ0ID0gbGVmdDtcblx0ICAgICAgICAgIH0sIGZ1bmN0aW9uIChlcnIpIHtcblx0ICAgICAgICAgICAgcmlnaHRTdWJzY3JpcHRpb24uZGlzcG9zZSgpO1xuXHQgICAgICAgICAgICBvYnNlcnZlci5vbkVycm9yKGVycik7XG5cdCAgICAgICAgICB9LCBmdW5jdGlvbiAoKSB7XG5cdCAgICAgICAgICAgIGxlZnRTdG9wcGVkID0gdHJ1ZTtcblx0ICAgICAgICAgICAgaWYgKHJpZ2h0U3RvcHBlZCkge1xuXHQgICAgICAgICAgICAgIGlmICghaGFzTGVmdCkge1xuXHQgICAgICAgICAgICAgICAgICBvYnNlcnZlci5vbkNvbXBsZXRlZCgpO1xuXHQgICAgICAgICAgICAgIH0gZWxzZSBpZiAoIWhhc1JpZ2h0KSB7XG5cdCAgICAgICAgICAgICAgICAgIG9ic2VydmVyLm9uQ29tcGxldGVkKCk7XG5cdCAgICAgICAgICAgICAgfSBlbHNlIHtcblx0ICAgICAgICAgICAgICAgIHZhciByZXN1bHQgPSB0cnlDYXRjaChyZXN1bHRTZWxlY3RvcikobGFzdExlZnQsIGxhc3RSaWdodCk7XG5cdCAgICAgICAgICAgICAgICBpZiAocmVzdWx0ID09PSBlcnJvck9iaikgeyByZXR1cm4gb2JzZXJ2ZXIub25FcnJvcihlKTsgfVxuXHQgICAgICAgICAgICAgICAgb2JzZXJ2ZXIub25OZXh0KHJlc3VsdCk7XG5cdCAgICAgICAgICAgICAgICBvYnNlcnZlci5vbkNvbXBsZXRlZCgpO1xuXHQgICAgICAgICAgICAgIH1cblx0ICAgICAgICAgICAgfVxuXHQgICAgICAgICAgfSlcblx0ICAgICAgKTtcblx0XG5cdCAgICAgIHJpZ2h0U3Vic2NyaXB0aW9uLnNldERpc3Bvc2FibGUoXG5cdCAgICAgICAgc2Vjb25kLnN1YnNjcmliZShmdW5jdGlvbiAocmlnaHQpIHtcblx0ICAgICAgICAgIGhhc1JpZ2h0ID0gdHJ1ZTtcblx0ICAgICAgICAgIGxhc3RSaWdodCA9IHJpZ2h0O1xuXHQgICAgICAgIH0sIGZ1bmN0aW9uIChlcnIpIHtcblx0ICAgICAgICAgIGxlZnRTdWJzY3JpcHRpb24uZGlzcG9zZSgpO1xuXHQgICAgICAgICAgb2JzZXJ2ZXIub25FcnJvcihlcnIpO1xuXHQgICAgICAgIH0sIGZ1bmN0aW9uICgpIHtcblx0ICAgICAgICAgIHJpZ2h0U3RvcHBlZCA9IHRydWU7XG5cdCAgICAgICAgICBpZiAobGVmdFN0b3BwZWQpIHtcblx0ICAgICAgICAgICAgaWYgKCFoYXNMZWZ0KSB7XG5cdCAgICAgICAgICAgICAgb2JzZXJ2ZXIub25Db21wbGV0ZWQoKTtcblx0ICAgICAgICAgICAgfSBlbHNlIGlmICghaGFzUmlnaHQpIHtcblx0ICAgICAgICAgICAgICBvYnNlcnZlci5vbkNvbXBsZXRlZCgpO1xuXHQgICAgICAgICAgICB9IGVsc2Uge1xuXHQgICAgICAgICAgICAgIHZhciByZXN1bHQgPSB0cnlDYXRjaChyZXN1bHRTZWxlY3RvcikobGFzdExlZnQsIGxhc3RSaWdodCk7XG5cdCAgICAgICAgICAgICAgaWYgKHJlc3VsdCA9PT0gZXJyb3JPYmopIHsgcmV0dXJuIG9ic2VydmVyLm9uRXJyb3IocmVzdWx0LmUpOyB9XG5cdCAgICAgICAgICAgICAgb2JzZXJ2ZXIub25OZXh0KHJlc3VsdCk7XG5cdCAgICAgICAgICAgICAgb2JzZXJ2ZXIub25Db21wbGV0ZWQoKTtcblx0ICAgICAgICAgICAgfVxuXHQgICAgICAgICAgfVxuXHQgICAgICAgIH0pXG5cdCAgICAgICk7XG5cdFxuXHQgICAgICByZXR1cm4gbmV3IEJpbmFyeURpc3Bvc2FibGUobGVmdFN1YnNjcmlwdGlvbiwgcmlnaHRTdWJzY3JpcHRpb24pO1xuXHQgICAgfSwgZmlyc3QpO1xuXHQgIH07XG5cdFxuXHQgIC8qKlxuXHQgICAqIENvbW9uYWRpYyBiaW5kIG9wZXJhdG9yLlxuXHQgICAqIEBwYXJhbSB7RnVuY3Rpb259IHNlbGVjdG9yIEEgdHJhbnNmb3JtIGZ1bmN0aW9uIHRvIGFwcGx5IHRvIGVhY2ggZWxlbWVudC5cblx0ICAgKiBAcGFyYW0ge09iamVjdH0gc2NoZWR1bGVyIFNjaGVkdWxlciB1c2VkIHRvIGV4ZWN1dGUgdGhlIG9wZXJhdGlvbi4gSWYgbm90IHNwZWNpZmllZCwgZGVmYXVsdHMgdG8gdGhlIEltbWVkaWF0ZVNjaGVkdWxlci5cblx0ICAgKiBAcmV0dXJucyB7T2JzZXJ2YWJsZX0gQW4gb2JzZXJ2YWJsZSBzZXF1ZW5jZSB3aGljaCByZXN1bHRzIGZyb20gdGhlIGNvbW9uYWRpYyBiaW5kIG9wZXJhdGlvbi5cblx0ICAgKi9cblx0ICBvYnNlcnZhYmxlUHJvdG8ubWFueVNlbGVjdCA9IG9ic2VydmFibGVQcm90by5leHRlbmQgPSBmdW5jdGlvbiAoc2VsZWN0b3IsIHNjaGVkdWxlcikge1xuXHQgICAgaXNTY2hlZHVsZXIoc2NoZWR1bGVyKSB8fCAoc2NoZWR1bGVyID0gaW1tZWRpYXRlU2NoZWR1bGVyKTtcblx0ICAgIHZhciBzb3VyY2UgPSB0aGlzO1xuXHQgICAgcmV0dXJuIG9ic2VydmFibGVEZWZlcihmdW5jdGlvbiAoKSB7XG5cdCAgICAgIHZhciBjaGFpbjtcblx0XG5cdCAgICAgIHJldHVybiBzb3VyY2Vcblx0ICAgICAgICAubWFwKGZ1bmN0aW9uICh4KSB7XG5cdCAgICAgICAgICB2YXIgY3VyciA9IG5ldyBDaGFpbk9ic2VydmFibGUoeCk7XG5cdFxuXHQgICAgICAgICAgY2hhaW4gJiYgY2hhaW4ub25OZXh0KHgpO1xuXHQgICAgICAgICAgY2hhaW4gPSBjdXJyO1xuXHRcblx0ICAgICAgICAgIHJldHVybiBjdXJyO1xuXHQgICAgICAgIH0pXG5cdCAgICAgICAgLnRhcChcblx0ICAgICAgICAgIG5vb3AsXG5cdCAgICAgICAgICBmdW5jdGlvbiAoZSkgeyBjaGFpbiAmJiBjaGFpbi5vbkVycm9yKGUpOyB9LFxuXHQgICAgICAgICAgZnVuY3Rpb24gKCkgeyBjaGFpbiAmJiBjaGFpbi5vbkNvbXBsZXRlZCgpOyB9XG5cdCAgICAgICAgKVxuXHQgICAgICAgIC5vYnNlcnZlT24oc2NoZWR1bGVyKVxuXHQgICAgICAgIC5tYXAoc2VsZWN0b3IpO1xuXHQgICAgfSwgc291cmNlKTtcblx0ICB9O1xuXHRcblx0ICB2YXIgQ2hhaW5PYnNlcnZhYmxlID0gKGZ1bmN0aW9uIChfX3N1cGVyX18pIHtcblx0ICAgIGluaGVyaXRzKENoYWluT2JzZXJ2YWJsZSwgX19zdXBlcl9fKTtcblx0ICAgIGZ1bmN0aW9uIENoYWluT2JzZXJ2YWJsZShoZWFkKSB7XG5cdCAgICAgIF9fc3VwZXJfXy5jYWxsKHRoaXMpO1xuXHQgICAgICB0aGlzLmhlYWQgPSBoZWFkO1xuXHQgICAgICB0aGlzLnRhaWwgPSBuZXcgQXN5bmNTdWJqZWN0KCk7XG5cdCAgICB9XG5cdFxuXHQgICAgYWRkUHJvcGVydGllcyhDaGFpbk9ic2VydmFibGUucHJvdG90eXBlLCBPYnNlcnZlciwge1xuXHQgICAgICBfc3Vic2NyaWJlOiBmdW5jdGlvbiAobykge1xuXHQgICAgICAgIHZhciBnID0gbmV3IENvbXBvc2l0ZURpc3Bvc2FibGUoKTtcblx0ICAgICAgICBnLmFkZChjdXJyZW50VGhyZWFkU2NoZWR1bGVyLnNjaGVkdWxlKHRoaXMsIGZ1bmN0aW9uIChfLCBzZWxmKSB7XG5cdCAgICAgICAgICBvLm9uTmV4dChzZWxmLmhlYWQpO1xuXHQgICAgICAgICAgZy5hZGQoc2VsZi50YWlsLm1lcmdlQWxsKCkuc3Vic2NyaWJlKG8pKTtcblx0ICAgICAgICB9KSk7XG5cdFxuXHQgICAgICAgIHJldHVybiBnO1xuXHQgICAgICB9LFxuXHQgICAgICBvbkNvbXBsZXRlZDogZnVuY3Rpb24gKCkge1xuXHQgICAgICAgIHRoaXMub25OZXh0KE9ic2VydmFibGUuZW1wdHkoKSk7XG5cdCAgICAgIH0sXG5cdCAgICAgIG9uRXJyb3I6IGZ1bmN0aW9uIChlKSB7XG5cdCAgICAgICAgdGhpcy5vbk5leHQoT2JzZXJ2YWJsZVsndGhyb3cnXShlKSk7XG5cdCAgICAgIH0sXG5cdCAgICAgIG9uTmV4dDogZnVuY3Rpb24gKHYpIHtcblx0ICAgICAgICB0aGlzLnRhaWwub25OZXh0KHYpO1xuXHQgICAgICAgIHRoaXMudGFpbC5vbkNvbXBsZXRlZCgpO1xuXHQgICAgICB9XG5cdCAgICB9KTtcblx0XG5cdCAgICByZXR1cm4gQ2hhaW5PYnNlcnZhYmxlO1xuXHRcblx0ICB9KE9ic2VydmFibGUpKTtcblx0XG5cdCAgdmFyIE1hcCA9IHJvb3QuTWFwIHx8IChmdW5jdGlvbiAoKSB7XG5cdCAgICBmdW5jdGlvbiBNYXAoKSB7XG5cdCAgICAgIHRoaXMuc2l6ZSA9IDA7XG5cdCAgICAgIHRoaXMuX3ZhbHVlcyA9IFtdO1xuXHQgICAgICB0aGlzLl9rZXlzID0gW107XG5cdCAgICB9XG5cdFxuXHQgICAgTWFwLnByb3RvdHlwZVsnZGVsZXRlJ10gPSBmdW5jdGlvbiAoa2V5KSB7XG5cdCAgICAgIHZhciBpID0gdGhpcy5fa2V5cy5pbmRleE9mKGtleSk7XG5cdCAgICAgIGlmIChpID09PSAtMSkgeyByZXR1cm4gZmFsc2U7IH1cblx0ICAgICAgdGhpcy5fdmFsdWVzLnNwbGljZShpLCAxKTtcblx0ICAgICAgdGhpcy5fa2V5cy5zcGxpY2UoaSwgMSk7XG5cdCAgICAgIHRoaXMuc2l6ZS0tO1xuXHQgICAgICByZXR1cm4gdHJ1ZTtcblx0ICAgIH07XG5cdFxuXHQgICAgTWFwLnByb3RvdHlwZS5nZXQgPSBmdW5jdGlvbiAoa2V5KSB7XG5cdCAgICAgIHZhciBpID0gdGhpcy5fa2V5cy5pbmRleE9mKGtleSk7XG5cdCAgICAgIHJldHVybiBpID09PSAtMSA/IHVuZGVmaW5lZCA6IHRoaXMuX3ZhbHVlc1tpXTtcblx0ICAgIH07XG5cdFxuXHQgICAgTWFwLnByb3RvdHlwZS5zZXQgPSBmdW5jdGlvbiAoa2V5LCB2YWx1ZSkge1xuXHQgICAgICB2YXIgaSA9IHRoaXMuX2tleXMuaW5kZXhPZihrZXkpO1xuXHQgICAgICBpZiAoaSA9PT0gLTEpIHtcblx0ICAgICAgICB0aGlzLl9rZXlzLnB1c2goa2V5KTtcblx0ICAgICAgICB0aGlzLl92YWx1ZXMucHVzaCh2YWx1ZSk7XG5cdCAgICAgICAgdGhpcy5zaXplKys7XG5cdCAgICAgIH0gZWxzZSB7XG5cdCAgICAgICAgdGhpcy5fdmFsdWVzW2ldID0gdmFsdWU7XG5cdCAgICAgIH1cblx0ICAgICAgcmV0dXJuIHRoaXM7XG5cdCAgICB9O1xuXHRcblx0ICAgIE1hcC5wcm90b3R5cGUuZm9yRWFjaCA9IGZ1bmN0aW9uIChjYiwgdGhpc0FyZykge1xuXHQgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHRoaXMuc2l6ZTsgaSsrKSB7XG5cdCAgICAgICAgY2IuY2FsbCh0aGlzQXJnLCB0aGlzLl92YWx1ZXNbaV0sIHRoaXMuX2tleXNbaV0pO1xuXHQgICAgICB9XG5cdCAgICB9O1xuXHRcblx0ICAgIHJldHVybiBNYXA7XG5cdCAgfSgpKTtcblx0XG5cdCAgLyoqXG5cdCAgICogQGNvbnN0cnVjdG9yXG5cdCAgICogUmVwcmVzZW50cyBhIGpvaW4gcGF0dGVybiBvdmVyIG9ic2VydmFibGUgc2VxdWVuY2VzLlxuXHQgICAqL1xuXHQgIGZ1bmN0aW9uIFBhdHRlcm4ocGF0dGVybnMpIHtcblx0ICAgIHRoaXMucGF0dGVybnMgPSBwYXR0ZXJucztcblx0ICB9XG5cdFxuXHQgIC8qKlxuXHQgICAqICBDcmVhdGVzIGEgcGF0dGVybiB0aGF0IG1hdGNoZXMgdGhlIGN1cnJlbnQgcGxhbiBtYXRjaGVzIGFuZCB3aGVuIHRoZSBzcGVjaWZpZWQgb2JzZXJ2YWJsZSBzZXF1ZW5jZXMgaGFzIGFuIGF2YWlsYWJsZSB2YWx1ZS5cblx0ICAgKiAgQHBhcmFtIG90aGVyIE9ic2VydmFibGUgc2VxdWVuY2UgdG8gbWF0Y2ggaW4gYWRkaXRpb24gdG8gdGhlIGN1cnJlbnQgcGF0dGVybi5cblx0ICAgKiAgQHJldHVybiB7UGF0dGVybn0gUGF0dGVybiBvYmplY3QgdGhhdCBtYXRjaGVzIHdoZW4gYWxsIG9ic2VydmFibGUgc2VxdWVuY2VzIGluIHRoZSBwYXR0ZXJuIGhhdmUgYW4gYXZhaWxhYmxlIHZhbHVlLlxuXHQgICAqL1xuXHQgIFBhdHRlcm4ucHJvdG90eXBlLmFuZCA9IGZ1bmN0aW9uIChvdGhlcikge1xuXHQgICAgcmV0dXJuIG5ldyBQYXR0ZXJuKHRoaXMucGF0dGVybnMuY29uY2F0KG90aGVyKSk7XG5cdCAgfTtcblx0XG5cdCAgLyoqXG5cdCAgICogIE1hdGNoZXMgd2hlbiBhbGwgb2JzZXJ2YWJsZSBzZXF1ZW5jZXMgaW4gdGhlIHBhdHRlcm4gKHNwZWNpZmllZCB1c2luZyBhIGNoYWluIG9mIGFuZCBvcGVyYXRvcnMpIGhhdmUgYW4gYXZhaWxhYmxlIHZhbHVlIGFuZCBwcm9qZWN0cyB0aGUgdmFsdWVzLlxuXHQgICAqICBAcGFyYW0ge0Z1bmN0aW9ufSBzZWxlY3RvciBTZWxlY3RvciB0aGF0IHdpbGwgYmUgaW52b2tlZCB3aXRoIGF2YWlsYWJsZSB2YWx1ZXMgZnJvbSB0aGUgc291cmNlIHNlcXVlbmNlcywgaW4gdGhlIHNhbWUgb3JkZXIgb2YgdGhlIHNlcXVlbmNlcyBpbiB0aGUgcGF0dGVybi5cblx0ICAgKiAgQHJldHVybiB7UGxhbn0gUGxhbiB0aGF0IHByb2R1Y2VzIHRoZSBwcm9qZWN0ZWQgdmFsdWVzLCB0byBiZSBmZWQgKHdpdGggb3RoZXIgcGxhbnMpIHRvIHRoZSB3aGVuIG9wZXJhdG9yLlxuXHQgICAqL1xuXHQgIFBhdHRlcm4ucHJvdG90eXBlLnRoZW5EbyA9IGZ1bmN0aW9uIChzZWxlY3Rvcikge1xuXHQgICAgcmV0dXJuIG5ldyBQbGFuKHRoaXMsIHNlbGVjdG9yKTtcblx0ICB9O1xuXHRcblx0ICBmdW5jdGlvbiBQbGFuKGV4cHJlc3Npb24sIHNlbGVjdG9yKSB7XG5cdCAgICAgIHRoaXMuZXhwcmVzc2lvbiA9IGV4cHJlc3Npb247XG5cdCAgICAgIHRoaXMuc2VsZWN0b3IgPSBzZWxlY3Rvcjtcblx0ICB9XG5cdFxuXHQgIFBsYW4ucHJvdG90eXBlLmFjdGl2YXRlID0gZnVuY3Rpb24gKGV4dGVybmFsU3Vic2NyaXB0aW9ucywgb2JzZXJ2ZXIsIGRlYWN0aXZhdGUpIHtcblx0ICAgIHZhciBzZWxmID0gdGhpcztcblx0ICAgIHZhciBqb2luT2JzZXJ2ZXJzID0gW107XG5cdCAgICBmb3IgKHZhciBpID0gMCwgbGVuID0gdGhpcy5leHByZXNzaW9uLnBhdHRlcm5zLmxlbmd0aDsgaSA8IGxlbjsgaSsrKSB7XG5cdCAgICAgIGpvaW5PYnNlcnZlcnMucHVzaChwbGFuQ3JlYXRlT2JzZXJ2ZXIoZXh0ZXJuYWxTdWJzY3JpcHRpb25zLCB0aGlzLmV4cHJlc3Npb24ucGF0dGVybnNbaV0sIG9ic2VydmVyLm9uRXJyb3IuYmluZChvYnNlcnZlcikpKTtcblx0ICAgIH1cblx0ICAgIHZhciBhY3RpdmVQbGFuID0gbmV3IEFjdGl2ZVBsYW4oam9pbk9ic2VydmVycywgZnVuY3Rpb24gKCkge1xuXHQgICAgICB2YXIgcmVzdWx0O1xuXHQgICAgICB0cnkge1xuXHQgICAgICAgIHJlc3VsdCA9IHNlbGYuc2VsZWN0b3IuYXBwbHkoc2VsZiwgYXJndW1lbnRzKTtcblx0ICAgICAgfSBjYXRjaCAoZSkge1xuXHQgICAgICAgIG9ic2VydmVyLm9uRXJyb3IoZSk7XG5cdCAgICAgICAgcmV0dXJuO1xuXHQgICAgICB9XG5cdCAgICAgIG9ic2VydmVyLm9uTmV4dChyZXN1bHQpO1xuXHQgICAgfSwgZnVuY3Rpb24gKCkge1xuXHQgICAgICBmb3IgKHZhciBqID0gMCwgamxlbiA9IGpvaW5PYnNlcnZlcnMubGVuZ3RoOyBqIDwgamxlbjsgaisrKSB7XG5cdCAgICAgICAgam9pbk9ic2VydmVyc1tqXS5yZW1vdmVBY3RpdmVQbGFuKGFjdGl2ZVBsYW4pO1xuXHQgICAgICB9XG5cdCAgICAgIGRlYWN0aXZhdGUoYWN0aXZlUGxhbik7XG5cdCAgICB9KTtcblx0ICAgIGZvciAoaSA9IDAsIGxlbiA9IGpvaW5PYnNlcnZlcnMubGVuZ3RoOyBpIDwgbGVuOyBpKyspIHtcblx0ICAgICAgam9pbk9ic2VydmVyc1tpXS5hZGRBY3RpdmVQbGFuKGFjdGl2ZVBsYW4pO1xuXHQgICAgfVxuXHQgICAgcmV0dXJuIGFjdGl2ZVBsYW47XG5cdCAgfTtcblx0XG5cdCAgZnVuY3Rpb24gcGxhbkNyZWF0ZU9ic2VydmVyKGV4dGVybmFsU3Vic2NyaXB0aW9ucywgb2JzZXJ2YWJsZSwgb25FcnJvcikge1xuXHQgICAgdmFyIGVudHJ5ID0gZXh0ZXJuYWxTdWJzY3JpcHRpb25zLmdldChvYnNlcnZhYmxlKTtcblx0ICAgIGlmICghZW50cnkpIHtcblx0ICAgICAgdmFyIG9ic2VydmVyID0gbmV3IEpvaW5PYnNlcnZlcihvYnNlcnZhYmxlLCBvbkVycm9yKTtcblx0ICAgICAgZXh0ZXJuYWxTdWJzY3JpcHRpb25zLnNldChvYnNlcnZhYmxlLCBvYnNlcnZlcik7XG5cdCAgICAgIHJldHVybiBvYnNlcnZlcjtcblx0ICAgIH1cblx0ICAgIHJldHVybiBlbnRyeTtcblx0ICB9XG5cdFxuXHQgIGZ1bmN0aW9uIEFjdGl2ZVBsYW4oam9pbk9ic2VydmVyQXJyYXksIG9uTmV4dCwgb25Db21wbGV0ZWQpIHtcblx0ICAgIHRoaXMuam9pbk9ic2VydmVyQXJyYXkgPSBqb2luT2JzZXJ2ZXJBcnJheTtcblx0ICAgIHRoaXMub25OZXh0ID0gb25OZXh0O1xuXHQgICAgdGhpcy5vbkNvbXBsZXRlZCA9IG9uQ29tcGxldGVkO1xuXHQgICAgdGhpcy5qb2luT2JzZXJ2ZXJzID0gbmV3IE1hcCgpO1xuXHQgICAgZm9yICh2YXIgaSA9IDAsIGxlbiA9IHRoaXMuam9pbk9ic2VydmVyQXJyYXkubGVuZ3RoOyBpIDwgbGVuOyBpKyspIHtcblx0ICAgICAgdmFyIGpvaW5PYnNlcnZlciA9IHRoaXMuam9pbk9ic2VydmVyQXJyYXlbaV07XG5cdCAgICAgIHRoaXMuam9pbk9ic2VydmVycy5zZXQoam9pbk9ic2VydmVyLCBqb2luT2JzZXJ2ZXIpO1xuXHQgICAgfVxuXHQgIH1cblx0XG5cdCAgQWN0aXZlUGxhbi5wcm90b3R5cGUuZGVxdWV1ZSA9IGZ1bmN0aW9uICgpIHtcblx0ICAgIHRoaXMuam9pbk9ic2VydmVycy5mb3JFYWNoKGZ1bmN0aW9uICh2KSB7IHYucXVldWUuc2hpZnQoKTsgfSk7XG5cdCAgfTtcblx0XG5cdCAgQWN0aXZlUGxhbi5wcm90b3R5cGUubWF0Y2ggPSBmdW5jdGlvbiAoKSB7XG5cdCAgICB2YXIgaSwgbGVuLCBoYXNWYWx1ZXMgPSB0cnVlO1xuXHQgICAgZm9yIChpID0gMCwgbGVuID0gdGhpcy5qb2luT2JzZXJ2ZXJBcnJheS5sZW5ndGg7IGkgPCBsZW47IGkrKykge1xuXHQgICAgICBpZiAodGhpcy5qb2luT2JzZXJ2ZXJBcnJheVtpXS5xdWV1ZS5sZW5ndGggPT09IDApIHtcblx0ICAgICAgICBoYXNWYWx1ZXMgPSBmYWxzZTtcblx0ICAgICAgICBicmVhaztcblx0ICAgICAgfVxuXHQgICAgfVxuXHQgICAgaWYgKGhhc1ZhbHVlcykge1xuXHQgICAgICB2YXIgZmlyc3RWYWx1ZXMgPSBbXSxcblx0ICAgICAgICAgIGlzQ29tcGxldGVkID0gZmFsc2U7XG5cdCAgICAgIGZvciAoaSA9IDAsIGxlbiA9IHRoaXMuam9pbk9ic2VydmVyQXJyYXkubGVuZ3RoOyBpIDwgbGVuOyBpKyspIHtcblx0ICAgICAgICBmaXJzdFZhbHVlcy5wdXNoKHRoaXMuam9pbk9ic2VydmVyQXJyYXlbaV0ucXVldWVbMF0pO1xuXHQgICAgICAgIHRoaXMuam9pbk9ic2VydmVyQXJyYXlbaV0ucXVldWVbMF0ua2luZCA9PT0gJ0MnICYmIChpc0NvbXBsZXRlZCA9IHRydWUpO1xuXHQgICAgICB9XG5cdCAgICAgIGlmIChpc0NvbXBsZXRlZCkge1xuXHQgICAgICAgIHRoaXMub25Db21wbGV0ZWQoKTtcblx0ICAgICAgfSBlbHNlIHtcblx0ICAgICAgICB0aGlzLmRlcXVldWUoKTtcblx0ICAgICAgICB2YXIgdmFsdWVzID0gW107XG5cdCAgICAgICAgZm9yIChpID0gMCwgbGVuID0gZmlyc3RWYWx1ZXMubGVuZ3RoOyBpIDwgZmlyc3RWYWx1ZXMubGVuZ3RoOyBpKyspIHtcblx0ICAgICAgICAgIHZhbHVlcy5wdXNoKGZpcnN0VmFsdWVzW2ldLnZhbHVlKTtcblx0ICAgICAgICB9XG5cdCAgICAgICAgdGhpcy5vbk5leHQuYXBwbHkodGhpcywgdmFsdWVzKTtcblx0ICAgICAgfVxuXHQgICAgfVxuXHQgIH07XG5cdFxuXHQgIHZhciBKb2luT2JzZXJ2ZXIgPSAoZnVuY3Rpb24gKF9fc3VwZXJfXykge1xuXHQgICAgaW5oZXJpdHMoSm9pbk9ic2VydmVyLCBfX3N1cGVyX18pO1xuXHRcblx0ICAgIGZ1bmN0aW9uIEpvaW5PYnNlcnZlcihzb3VyY2UsIG9uRXJyb3IpIHtcblx0ICAgICAgX19zdXBlcl9fLmNhbGwodGhpcyk7XG5cdCAgICAgIHRoaXMuc291cmNlID0gc291cmNlO1xuXHQgICAgICB0aGlzLm9uRXJyb3IgPSBvbkVycm9yO1xuXHQgICAgICB0aGlzLnF1ZXVlID0gW107XG5cdCAgICAgIHRoaXMuYWN0aXZlUGxhbnMgPSBbXTtcblx0ICAgICAgdGhpcy5zdWJzY3JpcHRpb24gPSBuZXcgU2luZ2xlQXNzaWdubWVudERpc3Bvc2FibGUoKTtcblx0ICAgICAgdGhpcy5pc0Rpc3Bvc2VkID0gZmFsc2U7XG5cdCAgICB9XG5cdFxuXHQgICAgdmFyIEpvaW5PYnNlcnZlclByb3RvdHlwZSA9IEpvaW5PYnNlcnZlci5wcm90b3R5cGU7XG5cdFxuXHQgICAgSm9pbk9ic2VydmVyUHJvdG90eXBlLm5leHQgPSBmdW5jdGlvbiAobm90aWZpY2F0aW9uKSB7XG5cdCAgICAgIGlmICghdGhpcy5pc0Rpc3Bvc2VkKSB7XG5cdCAgICAgICAgaWYgKG5vdGlmaWNhdGlvbi5raW5kID09PSAnRScpIHtcblx0ICAgICAgICAgIHJldHVybiB0aGlzLm9uRXJyb3Iobm90aWZpY2F0aW9uLmVycm9yKTtcblx0ICAgICAgICB9XG5cdCAgICAgICAgdGhpcy5xdWV1ZS5wdXNoKG5vdGlmaWNhdGlvbik7XG5cdCAgICAgICAgdmFyIGFjdGl2ZVBsYW5zID0gdGhpcy5hY3RpdmVQbGFucy5zbGljZSgwKTtcblx0ICAgICAgICBmb3IgKHZhciBpID0gMCwgbGVuID0gYWN0aXZlUGxhbnMubGVuZ3RoOyBpIDwgbGVuOyBpKyspIHtcblx0ICAgICAgICAgIGFjdGl2ZVBsYW5zW2ldLm1hdGNoKCk7XG5cdCAgICAgICAgfVxuXHQgICAgICB9XG5cdCAgICB9O1xuXHRcblx0ICAgIEpvaW5PYnNlcnZlclByb3RvdHlwZS5lcnJvciA9IG5vb3A7XG5cdCAgICBKb2luT2JzZXJ2ZXJQcm90b3R5cGUuY29tcGxldGVkID0gbm9vcDtcblx0XG5cdCAgICBKb2luT2JzZXJ2ZXJQcm90b3R5cGUuYWRkQWN0aXZlUGxhbiA9IGZ1bmN0aW9uIChhY3RpdmVQbGFuKSB7XG5cdCAgICAgIHRoaXMuYWN0aXZlUGxhbnMucHVzaChhY3RpdmVQbGFuKTtcblx0ICAgIH07XG5cdFxuXHQgICAgSm9pbk9ic2VydmVyUHJvdG90eXBlLnN1YnNjcmliZSA9IGZ1bmN0aW9uICgpIHtcblx0ICAgICAgdGhpcy5zdWJzY3JpcHRpb24uc2V0RGlzcG9zYWJsZSh0aGlzLnNvdXJjZS5tYXRlcmlhbGl6ZSgpLnN1YnNjcmliZSh0aGlzKSk7XG5cdCAgICB9O1xuXHRcblx0ICAgIEpvaW5PYnNlcnZlclByb3RvdHlwZS5yZW1vdmVBY3RpdmVQbGFuID0gZnVuY3Rpb24gKGFjdGl2ZVBsYW4pIHtcblx0ICAgICAgdGhpcy5hY3RpdmVQbGFucy5zcGxpY2UodGhpcy5hY3RpdmVQbGFucy5pbmRleE9mKGFjdGl2ZVBsYW4pLCAxKTtcblx0ICAgICAgdGhpcy5hY3RpdmVQbGFucy5sZW5ndGggPT09IDAgJiYgdGhpcy5kaXNwb3NlKCk7XG5cdCAgICB9O1xuXHRcblx0ICAgIEpvaW5PYnNlcnZlclByb3RvdHlwZS5kaXNwb3NlID0gZnVuY3Rpb24gKCkge1xuXHQgICAgICBfX3N1cGVyX18ucHJvdG90eXBlLmRpc3Bvc2UuY2FsbCh0aGlzKTtcblx0ICAgICAgaWYgKCF0aGlzLmlzRGlzcG9zZWQpIHtcblx0ICAgICAgICB0aGlzLmlzRGlzcG9zZWQgPSB0cnVlO1xuXHQgICAgICAgIHRoaXMuc3Vic2NyaXB0aW9uLmRpc3Bvc2UoKTtcblx0ICAgICAgfVxuXHQgICAgfTtcblx0XG5cdCAgICByZXR1cm4gSm9pbk9ic2VydmVyO1xuXHQgIH0gKEFic3RyYWN0T2JzZXJ2ZXIpKTtcblx0XG5cdCAgLyoqXG5cdCAgICogIENyZWF0ZXMgYSBwYXR0ZXJuIHRoYXQgbWF0Y2hlcyB3aGVuIGJvdGggb2JzZXJ2YWJsZSBzZXF1ZW5jZXMgaGF2ZSBhbiBhdmFpbGFibGUgdmFsdWUuXG5cdCAgICpcblx0ICAgKiAgQHBhcmFtIHJpZ2h0IE9ic2VydmFibGUgc2VxdWVuY2UgdG8gbWF0Y2ggd2l0aCB0aGUgY3VycmVudCBzZXF1ZW5jZS5cblx0ICAgKiAgQHJldHVybiB7UGF0dGVybn0gUGF0dGVybiBvYmplY3QgdGhhdCBtYXRjaGVzIHdoZW4gYm90aCBvYnNlcnZhYmxlIHNlcXVlbmNlcyBoYXZlIGFuIGF2YWlsYWJsZSB2YWx1ZS5cblx0ICAgKi9cblx0ICBvYnNlcnZhYmxlUHJvdG8uYW5kID0gZnVuY3Rpb24gKHJpZ2h0KSB7XG5cdCAgICByZXR1cm4gbmV3IFBhdHRlcm4oW3RoaXMsIHJpZ2h0XSk7XG5cdCAgfTtcblx0XG5cdCAgLyoqXG5cdCAgICogIE1hdGNoZXMgd2hlbiB0aGUgb2JzZXJ2YWJsZSBzZXF1ZW5jZSBoYXMgYW4gYXZhaWxhYmxlIHZhbHVlIGFuZCBwcm9qZWN0cyB0aGUgdmFsdWUuXG5cdCAgICpcblx0ICAgKiAgQHBhcmFtIHtGdW5jdGlvbn0gc2VsZWN0b3IgU2VsZWN0b3IgdGhhdCB3aWxsIGJlIGludm9rZWQgZm9yIHZhbHVlcyBpbiB0aGUgc291cmNlIHNlcXVlbmNlLlxuXHQgICAqICBAcmV0dXJucyB7UGxhbn0gUGxhbiB0aGF0IHByb2R1Y2VzIHRoZSBwcm9qZWN0ZWQgdmFsdWVzLCB0byBiZSBmZWQgKHdpdGggb3RoZXIgcGxhbnMpIHRvIHRoZSB3aGVuIG9wZXJhdG9yLlxuXHQgICAqL1xuXHQgIG9ic2VydmFibGVQcm90by50aGVuRG8gPSBmdW5jdGlvbiAoc2VsZWN0b3IpIHtcblx0ICAgIHJldHVybiBuZXcgUGF0dGVybihbdGhpc10pLnRoZW5EbyhzZWxlY3Rvcik7XG5cdCAgfTtcblx0XG5cdCAgLyoqXG5cdCAgICogIEpvaW5zIHRvZ2V0aGVyIHRoZSByZXN1bHRzIGZyb20gc2V2ZXJhbCBwYXR0ZXJucy5cblx0ICAgKlxuXHQgICAqICBAcGFyYW0gcGxhbnMgQSBzZXJpZXMgb2YgcGxhbnMgKHNwZWNpZmllZCBhcyBhbiBBcnJheSBvZiBhcyBhIHNlcmllcyBvZiBhcmd1bWVudHMpIGNyZWF0ZWQgYnkgdXNlIG9mIHRoZSBUaGVuIG9wZXJhdG9yIG9uIHBhdHRlcm5zLlxuXHQgICAqICBAcmV0dXJucyB7T2JzZXJ2YWJsZX0gT2JzZXJ2YWJsZSBzZXF1ZW5jZSB3aXRoIHRoZSByZXN1bHRzIGZvcm0gbWF0Y2hpbmcgc2V2ZXJhbCBwYXR0ZXJucy5cblx0ICAgKi9cblx0ICBPYnNlcnZhYmxlLndoZW4gPSBmdW5jdGlvbiAoKSB7XG5cdCAgICB2YXIgbGVuID0gYXJndW1lbnRzLmxlbmd0aCwgcGxhbnM7XG5cdCAgICBpZiAoQXJyYXkuaXNBcnJheShhcmd1bWVudHNbMF0pKSB7XG5cdCAgICAgIHBsYW5zID0gYXJndW1lbnRzWzBdO1xuXHQgICAgfSBlbHNlIHtcblx0ICAgICAgcGxhbnMgPSBuZXcgQXJyYXkobGVuKTtcblx0ICAgICAgZm9yKHZhciBpID0gMDsgaSA8IGxlbjsgaSsrKSB7IHBsYW5zW2ldID0gYXJndW1lbnRzW2ldOyB9XG5cdCAgICB9XG5cdCAgICByZXR1cm4gbmV3IEFub255bW91c09ic2VydmFibGUoZnVuY3Rpb24gKG8pIHtcblx0ICAgICAgdmFyIGFjdGl2ZVBsYW5zID0gW10sXG5cdCAgICAgICAgICBleHRlcm5hbFN1YnNjcmlwdGlvbnMgPSBuZXcgTWFwKCk7XG5cdCAgICAgIHZhciBvdXRPYnNlcnZlciA9IG9ic2VydmVyQ3JlYXRlKFxuXHQgICAgICAgIGZ1bmN0aW9uICh4KSB7IG8ub25OZXh0KHgpOyB9LFxuXHQgICAgICAgIGZ1bmN0aW9uIChlcnIpIHtcblx0ICAgICAgICAgIGV4dGVybmFsU3Vic2NyaXB0aW9ucy5mb3JFYWNoKGZ1bmN0aW9uICh2KSB7IHYub25FcnJvcihlcnIpOyB9KTtcblx0ICAgICAgICAgIG8ub25FcnJvcihlcnIpO1xuXHQgICAgICAgIH0sXG5cdCAgICAgICAgZnVuY3Rpb24gKHgpIHsgby5vbkNvbXBsZXRlZCgpOyB9XG5cdCAgICAgICk7XG5cdCAgICAgIHRyeSB7XG5cdCAgICAgICAgZm9yICh2YXIgaSA9IDAsIGxlbiA9IHBsYW5zLmxlbmd0aDsgaSA8IGxlbjsgaSsrKSB7XG5cdCAgICAgICAgICBhY3RpdmVQbGFucy5wdXNoKHBsYW5zW2ldLmFjdGl2YXRlKGV4dGVybmFsU3Vic2NyaXB0aW9ucywgb3V0T2JzZXJ2ZXIsIGZ1bmN0aW9uIChhY3RpdmVQbGFuKSB7XG5cdCAgICAgICAgICAgIHZhciBpZHggPSBhY3RpdmVQbGFucy5pbmRleE9mKGFjdGl2ZVBsYW4pO1xuXHQgICAgICAgICAgICBhY3RpdmVQbGFucy5zcGxpY2UoaWR4LCAxKTtcblx0ICAgICAgICAgICAgYWN0aXZlUGxhbnMubGVuZ3RoID09PSAwICYmIG8ub25Db21wbGV0ZWQoKTtcblx0ICAgICAgICAgIH0pKTtcblx0ICAgICAgICB9XG5cdCAgICAgIH0gY2F0Y2ggKGUpIHtcblx0ICAgICAgICBvYnNlcnZhYmxlVGhyb3coZSkuc3Vic2NyaWJlKG8pO1xuXHQgICAgICB9XG5cdCAgICAgIHZhciBncm91cCA9IG5ldyBDb21wb3NpdGVEaXNwb3NhYmxlKCk7XG5cdCAgICAgIGV4dGVybmFsU3Vic2NyaXB0aW9ucy5mb3JFYWNoKGZ1bmN0aW9uIChqb2luT2JzZXJ2ZXIpIHtcblx0ICAgICAgICBqb2luT2JzZXJ2ZXIuc3Vic2NyaWJlKCk7XG5cdCAgICAgICAgZ3JvdXAuYWRkKGpvaW5PYnNlcnZlcik7XG5cdCAgICAgIH0pO1xuXHRcblx0ICAgICAgcmV0dXJuIGdyb3VwO1xuXHQgICAgfSk7XG5cdCAgfTtcblx0XG5cdCAgdmFyIFRpbWVyT2JzZXJ2YWJsZSA9IChmdW5jdGlvbihfX3N1cGVyX18pIHtcblx0ICAgIGluaGVyaXRzKFRpbWVyT2JzZXJ2YWJsZSwgX19zdXBlcl9fKTtcblx0ICAgIGZ1bmN0aW9uIFRpbWVyT2JzZXJ2YWJsZShkdCwgcykge1xuXHQgICAgICB0aGlzLl9kdCA9IGR0O1xuXHQgICAgICB0aGlzLl9zID0gcztcblx0ICAgICAgX19zdXBlcl9fLmNhbGwodGhpcyk7XG5cdCAgICB9XG5cdFxuXHQgICAgVGltZXJPYnNlcnZhYmxlLnByb3RvdHlwZS5zdWJzY3JpYmVDb3JlID0gZnVuY3Rpb24gKG8pIHtcblx0ICAgICAgcmV0dXJuIHRoaXMuX3Muc2NoZWR1bGVGdXR1cmUobywgdGhpcy5fZHQsIHNjaGVkdWxlTWV0aG9kKTtcblx0ICAgIH07XG5cdFxuXHQgICAgZnVuY3Rpb24gc2NoZWR1bGVNZXRob2Qocywgbykge1xuXHQgICAgICBvLm9uTmV4dCgwKTtcblx0ICAgICAgby5vbkNvbXBsZXRlZCgpO1xuXHQgICAgfVxuXHRcblx0ICAgIHJldHVybiBUaW1lck9ic2VydmFibGU7XG5cdCAgfShPYnNlcnZhYmxlQmFzZSkpO1xuXHRcblx0ICBmdW5jdGlvbiBfb2JzZXJ2YWJsZVRpbWVyKGR1ZVRpbWUsIHNjaGVkdWxlcikge1xuXHQgICAgcmV0dXJuIG5ldyBUaW1lck9ic2VydmFibGUoZHVlVGltZSwgc2NoZWR1bGVyKTtcblx0ICB9XG5cdFxuXHQgIGZ1bmN0aW9uIG9ic2VydmFibGVUaW1lckRhdGVBbmRQZXJpb2QoZHVlVGltZSwgcGVyaW9kLCBzY2hlZHVsZXIpIHtcblx0ICAgIHJldHVybiBuZXcgQW5vbnltb3VzT2JzZXJ2YWJsZShmdW5jdGlvbiAob2JzZXJ2ZXIpIHtcblx0ICAgICAgdmFyIGQgPSBkdWVUaW1lLCBwID0gbm9ybWFsaXplVGltZShwZXJpb2QpO1xuXHQgICAgICByZXR1cm4gc2NoZWR1bGVyLnNjaGVkdWxlUmVjdXJzaXZlRnV0dXJlKDAsIGQsIGZ1bmN0aW9uIChjb3VudCwgc2VsZikge1xuXHQgICAgICAgIGlmIChwID4gMCkge1xuXHQgICAgICAgICAgdmFyIG5vdyA9IHNjaGVkdWxlci5ub3coKTtcblx0ICAgICAgICAgIGQgPSBkICsgcDtcblx0ICAgICAgICAgIGQgPD0gbm93ICYmIChkID0gbm93ICsgcCk7XG5cdCAgICAgICAgfVxuXHQgICAgICAgIG9ic2VydmVyLm9uTmV4dChjb3VudCk7XG5cdCAgICAgICAgc2VsZihjb3VudCArIDEsIG5ldyBEYXRlKGQpKTtcblx0ICAgICAgfSk7XG5cdCAgICB9KTtcblx0ICB9XG5cdFxuXHQgIGZ1bmN0aW9uIG9ic2VydmFibGVUaW1lclRpbWVTcGFuQW5kUGVyaW9kKGR1ZVRpbWUsIHBlcmlvZCwgc2NoZWR1bGVyKSB7XG5cdCAgICByZXR1cm4gZHVlVGltZSA9PT0gcGVyaW9kID9cblx0ICAgICAgbmV3IEFub255bW91c09ic2VydmFibGUoZnVuY3Rpb24gKG9ic2VydmVyKSB7XG5cdCAgICAgICAgcmV0dXJuIHNjaGVkdWxlci5zY2hlZHVsZVBlcmlvZGljKDAsIHBlcmlvZCwgZnVuY3Rpb24gKGNvdW50KSB7XG5cdCAgICAgICAgICBvYnNlcnZlci5vbk5leHQoY291bnQpO1xuXHQgICAgICAgICAgcmV0dXJuIGNvdW50ICsgMTtcblx0ICAgICAgICB9KTtcblx0ICAgICAgfSkgOlxuXHQgICAgICBvYnNlcnZhYmxlRGVmZXIoZnVuY3Rpb24gKCkge1xuXHQgICAgICAgIHJldHVybiBvYnNlcnZhYmxlVGltZXJEYXRlQW5kUGVyaW9kKG5ldyBEYXRlKHNjaGVkdWxlci5ub3coKSArIGR1ZVRpbWUpLCBwZXJpb2QsIHNjaGVkdWxlcik7XG5cdCAgICAgIH0pO1xuXHQgIH1cblx0XG5cdCAgLyoqXG5cdCAgICogIFJldHVybnMgYW4gb2JzZXJ2YWJsZSBzZXF1ZW5jZSB0aGF0IHByb2R1Y2VzIGEgdmFsdWUgYWZ0ZXIgZWFjaCBwZXJpb2QuXG5cdCAgICpcblx0ICAgKiBAZXhhbXBsZVxuXHQgICAqICAxIC0gcmVzID0gUnguT2JzZXJ2YWJsZS5pbnRlcnZhbCgxMDAwKTtcblx0ICAgKiAgMiAtIHJlcyA9IFJ4Lk9ic2VydmFibGUuaW50ZXJ2YWwoMTAwMCwgUnguU2NoZWR1bGVyLnRpbWVvdXQpO1xuXHQgICAqXG5cdCAgICogQHBhcmFtIHtOdW1iZXJ9IHBlcmlvZCBQZXJpb2QgZm9yIHByb2R1Y2luZyB0aGUgdmFsdWVzIGluIHRoZSByZXN1bHRpbmcgc2VxdWVuY2UgKHNwZWNpZmllZCBhcyBhbiBpbnRlZ2VyIGRlbm90aW5nIG1pbGxpc2Vjb25kcykuXG5cdCAgICogQHBhcmFtIHtTY2hlZHVsZXJ9IFtzY2hlZHVsZXJdIFNjaGVkdWxlciB0byBydW4gdGhlIHRpbWVyIG9uLiBJZiBub3Qgc3BlY2lmaWVkLCBSeC5TY2hlZHVsZXIudGltZW91dCBpcyB1c2VkLlxuXHQgICAqIEByZXR1cm5zIHtPYnNlcnZhYmxlfSBBbiBvYnNlcnZhYmxlIHNlcXVlbmNlIHRoYXQgcHJvZHVjZXMgYSB2YWx1ZSBhZnRlciBlYWNoIHBlcmlvZC5cblx0ICAgKi9cblx0ICB2YXIgb2JzZXJ2YWJsZWludGVydmFsID0gT2JzZXJ2YWJsZS5pbnRlcnZhbCA9IGZ1bmN0aW9uIChwZXJpb2QsIHNjaGVkdWxlcikge1xuXHQgICAgcmV0dXJuIG9ic2VydmFibGVUaW1lclRpbWVTcGFuQW5kUGVyaW9kKHBlcmlvZCwgcGVyaW9kLCBpc1NjaGVkdWxlcihzY2hlZHVsZXIpID8gc2NoZWR1bGVyIDogZGVmYXVsdFNjaGVkdWxlcik7XG5cdCAgfTtcblx0XG5cdCAgLyoqXG5cdCAgICogIFJldHVybnMgYW4gb2JzZXJ2YWJsZSBzZXF1ZW5jZSB0aGF0IHByb2R1Y2VzIGEgdmFsdWUgYWZ0ZXIgZHVlVGltZSBoYXMgZWxhcHNlZCBhbmQgdGhlbiBhZnRlciBlYWNoIHBlcmlvZC5cblx0ICAgKiBAcGFyYW0ge051bWJlcn0gZHVlVGltZSBBYnNvbHV0ZSAoc3BlY2lmaWVkIGFzIGEgRGF0ZSBvYmplY3QpIG9yIHJlbGF0aXZlIHRpbWUgKHNwZWNpZmllZCBhcyBhbiBpbnRlZ2VyIGRlbm90aW5nIG1pbGxpc2Vjb25kcykgYXQgd2hpY2ggdG8gcHJvZHVjZSB0aGUgZmlyc3QgdmFsdWUuXG5cdCAgICogQHBhcmFtIHtNaXhlZH0gW3BlcmlvZE9yU2NoZWR1bGVyXSAgUGVyaW9kIHRvIHByb2R1Y2Ugc3Vic2VxdWVudCB2YWx1ZXMgKHNwZWNpZmllZCBhcyBhbiBpbnRlZ2VyIGRlbm90aW5nIG1pbGxpc2Vjb25kcyksIG9yIHRoZSBzY2hlZHVsZXIgdG8gcnVuIHRoZSB0aW1lciBvbi4gSWYgbm90IHNwZWNpZmllZCwgdGhlIHJlc3VsdGluZyB0aW1lciBpcyBub3QgcmVjdXJyaW5nLlxuXHQgICAqIEBwYXJhbSB7U2NoZWR1bGVyfSBbc2NoZWR1bGVyXSAgU2NoZWR1bGVyIHRvIHJ1biB0aGUgdGltZXIgb24uIElmIG5vdCBzcGVjaWZpZWQsIHRoZSB0aW1lb3V0IHNjaGVkdWxlciBpcyB1c2VkLlxuXHQgICAqIEByZXR1cm5zIHtPYnNlcnZhYmxlfSBBbiBvYnNlcnZhYmxlIHNlcXVlbmNlIHRoYXQgcHJvZHVjZXMgYSB2YWx1ZSBhZnRlciBkdWUgdGltZSBoYXMgZWxhcHNlZCBhbmQgdGhlbiBlYWNoIHBlcmlvZC5cblx0ICAgKi9cblx0ICB2YXIgb2JzZXJ2YWJsZVRpbWVyID0gT2JzZXJ2YWJsZS50aW1lciA9IGZ1bmN0aW9uIChkdWVUaW1lLCBwZXJpb2RPclNjaGVkdWxlciwgc2NoZWR1bGVyKSB7XG5cdCAgICB2YXIgcGVyaW9kO1xuXHQgICAgaXNTY2hlZHVsZXIoc2NoZWR1bGVyKSB8fCAoc2NoZWR1bGVyID0gZGVmYXVsdFNjaGVkdWxlcik7XG5cdCAgICBpZiAocGVyaW9kT3JTY2hlZHVsZXIgIT0gbnVsbCAmJiB0eXBlb2YgcGVyaW9kT3JTY2hlZHVsZXIgPT09ICdudW1iZXInKSB7XG5cdCAgICAgIHBlcmlvZCA9IHBlcmlvZE9yU2NoZWR1bGVyO1xuXHQgICAgfSBlbHNlIGlmIChpc1NjaGVkdWxlcihwZXJpb2RPclNjaGVkdWxlcikpIHtcblx0ICAgICAgc2NoZWR1bGVyID0gcGVyaW9kT3JTY2hlZHVsZXI7XG5cdCAgICB9XG5cdCAgICBpZiAoKGR1ZVRpbWUgaW5zdGFuY2VvZiBEYXRlIHx8IHR5cGVvZiBkdWVUaW1lID09PSAnbnVtYmVyJykgJiYgcGVyaW9kID09PSB1bmRlZmluZWQpIHtcblx0ICAgICAgcmV0dXJuIF9vYnNlcnZhYmxlVGltZXIoZHVlVGltZSwgc2NoZWR1bGVyKTtcblx0ICAgIH1cblx0ICAgIGlmIChkdWVUaW1lIGluc3RhbmNlb2YgRGF0ZSAmJiBwZXJpb2QgIT09IHVuZGVmaW5lZCkge1xuXHQgICAgICByZXR1cm4gb2JzZXJ2YWJsZVRpbWVyRGF0ZUFuZFBlcmlvZChkdWVUaW1lLmdldFRpbWUoKSwgcGVyaW9kT3JTY2hlZHVsZXIsIHNjaGVkdWxlcik7XG5cdCAgICB9XG5cdCAgICByZXR1cm4gb2JzZXJ2YWJsZVRpbWVyVGltZVNwYW5BbmRQZXJpb2QoZHVlVGltZSwgcGVyaW9kLCBzY2hlZHVsZXIpO1xuXHQgIH07XG5cdFxuXHQgIGZ1bmN0aW9uIG9ic2VydmFibGVEZWxheVJlbGF0aXZlKHNvdXJjZSwgZHVlVGltZSwgc2NoZWR1bGVyKSB7XG5cdCAgICByZXR1cm4gbmV3IEFub255bW91c09ic2VydmFibGUoZnVuY3Rpb24gKG8pIHtcblx0ICAgICAgdmFyIGFjdGl2ZSA9IGZhbHNlLFxuXHQgICAgICAgIGNhbmNlbGFibGUgPSBuZXcgU2VyaWFsRGlzcG9zYWJsZSgpLFxuXHQgICAgICAgIGV4Y2VwdGlvbiA9IG51bGwsXG5cdCAgICAgICAgcSA9IFtdLFxuXHQgICAgICAgIHJ1bm5pbmcgPSBmYWxzZSxcblx0ICAgICAgICBzdWJzY3JpcHRpb247XG5cdCAgICAgIHN1YnNjcmlwdGlvbiA9IHNvdXJjZS5tYXRlcmlhbGl6ZSgpLnRpbWVzdGFtcChzY2hlZHVsZXIpLnN1YnNjcmliZShmdW5jdGlvbiAobm90aWZpY2F0aW9uKSB7XG5cdCAgICAgICAgdmFyIGQsIHNob3VsZFJ1bjtcblx0ICAgICAgICBpZiAobm90aWZpY2F0aW9uLnZhbHVlLmtpbmQgPT09ICdFJykge1xuXHQgICAgICAgICAgcSA9IFtdO1xuXHQgICAgICAgICAgcS5wdXNoKG5vdGlmaWNhdGlvbik7XG5cdCAgICAgICAgICBleGNlcHRpb24gPSBub3RpZmljYXRpb24udmFsdWUuZXJyb3I7XG5cdCAgICAgICAgICBzaG91bGRSdW4gPSAhcnVubmluZztcblx0ICAgICAgICB9IGVsc2Uge1xuXHQgICAgICAgICAgcS5wdXNoKHsgdmFsdWU6IG5vdGlmaWNhdGlvbi52YWx1ZSwgdGltZXN0YW1wOiBub3RpZmljYXRpb24udGltZXN0YW1wICsgZHVlVGltZSB9KTtcblx0ICAgICAgICAgIHNob3VsZFJ1biA9ICFhY3RpdmU7XG5cdCAgICAgICAgICBhY3RpdmUgPSB0cnVlO1xuXHQgICAgICAgIH1cblx0ICAgICAgICBpZiAoc2hvdWxkUnVuKSB7XG5cdCAgICAgICAgICBpZiAoZXhjZXB0aW9uICE9PSBudWxsKSB7XG5cdCAgICAgICAgICAgIG8ub25FcnJvcihleGNlcHRpb24pO1xuXHQgICAgICAgICAgfSBlbHNlIHtcblx0ICAgICAgICAgICAgZCA9IG5ldyBTaW5nbGVBc3NpZ25tZW50RGlzcG9zYWJsZSgpO1xuXHQgICAgICAgICAgICBjYW5jZWxhYmxlLnNldERpc3Bvc2FibGUoZCk7XG5cdCAgICAgICAgICAgIGQuc2V0RGlzcG9zYWJsZShzY2hlZHVsZXIuc2NoZWR1bGVSZWN1cnNpdmVGdXR1cmUobnVsbCwgZHVlVGltZSwgZnVuY3Rpb24gKF8sIHNlbGYpIHtcblx0ICAgICAgICAgICAgICB2YXIgZSwgcmVjdXJzZUR1ZVRpbWUsIHJlc3VsdCwgc2hvdWxkUmVjdXJzZTtcblx0ICAgICAgICAgICAgICBpZiAoZXhjZXB0aW9uICE9PSBudWxsKSB7XG5cdCAgICAgICAgICAgICAgICByZXR1cm47XG5cdCAgICAgICAgICAgICAgfVxuXHQgICAgICAgICAgICAgIHJ1bm5pbmcgPSB0cnVlO1xuXHQgICAgICAgICAgICAgIGRvIHtcblx0ICAgICAgICAgICAgICAgIHJlc3VsdCA9IG51bGw7XG5cdCAgICAgICAgICAgICAgICBpZiAocS5sZW5ndGggPiAwICYmIHFbMF0udGltZXN0YW1wIC0gc2NoZWR1bGVyLm5vdygpIDw9IDApIHtcblx0ICAgICAgICAgICAgICAgICAgcmVzdWx0ID0gcS5zaGlmdCgpLnZhbHVlO1xuXHQgICAgICAgICAgICAgICAgfVxuXHQgICAgICAgICAgICAgICAgaWYgKHJlc3VsdCAhPT0gbnVsbCkge1xuXHQgICAgICAgICAgICAgICAgICByZXN1bHQuYWNjZXB0KG8pO1xuXHQgICAgICAgICAgICAgICAgfVxuXHQgICAgICAgICAgICAgIH0gd2hpbGUgKHJlc3VsdCAhPT0gbnVsbCk7XG5cdCAgICAgICAgICAgICAgc2hvdWxkUmVjdXJzZSA9IGZhbHNlO1xuXHQgICAgICAgICAgICAgIHJlY3Vyc2VEdWVUaW1lID0gMDtcblx0ICAgICAgICAgICAgICBpZiAocS5sZW5ndGggPiAwKSB7XG5cdCAgICAgICAgICAgICAgICBzaG91bGRSZWN1cnNlID0gdHJ1ZTtcblx0ICAgICAgICAgICAgICAgIHJlY3Vyc2VEdWVUaW1lID0gTWF0aC5tYXgoMCwgcVswXS50aW1lc3RhbXAgLSBzY2hlZHVsZXIubm93KCkpO1xuXHQgICAgICAgICAgICAgIH0gZWxzZSB7XG5cdCAgICAgICAgICAgICAgICBhY3RpdmUgPSBmYWxzZTtcblx0ICAgICAgICAgICAgICB9XG5cdCAgICAgICAgICAgICAgZSA9IGV4Y2VwdGlvbjtcblx0ICAgICAgICAgICAgICBydW5uaW5nID0gZmFsc2U7XG5cdCAgICAgICAgICAgICAgaWYgKGUgIT09IG51bGwpIHtcblx0ICAgICAgICAgICAgICAgIG8ub25FcnJvcihlKTtcblx0ICAgICAgICAgICAgICB9IGVsc2UgaWYgKHNob3VsZFJlY3Vyc2UpIHtcblx0ICAgICAgICAgICAgICAgIHNlbGYobnVsbCwgcmVjdXJzZUR1ZVRpbWUpO1xuXHQgICAgICAgICAgICAgIH1cblx0ICAgICAgICAgICAgfSkpO1xuXHQgICAgICAgICAgfVxuXHQgICAgICAgIH1cblx0ICAgICAgfSk7XG5cdCAgICAgIHJldHVybiBuZXcgQmluYXJ5RGlzcG9zYWJsZShzdWJzY3JpcHRpb24sIGNhbmNlbGFibGUpO1xuXHQgICAgfSwgc291cmNlKTtcblx0ICB9XG5cdFxuXHQgIGZ1bmN0aW9uIG9ic2VydmFibGVEZWxheUFic29sdXRlKHNvdXJjZSwgZHVlVGltZSwgc2NoZWR1bGVyKSB7XG5cdCAgICByZXR1cm4gb2JzZXJ2YWJsZURlZmVyKGZ1bmN0aW9uICgpIHtcblx0ICAgICAgcmV0dXJuIG9ic2VydmFibGVEZWxheVJlbGF0aXZlKHNvdXJjZSwgZHVlVGltZSAtIHNjaGVkdWxlci5ub3coKSwgc2NoZWR1bGVyKTtcblx0ICAgIH0pO1xuXHQgIH1cblx0XG5cdCAgZnVuY3Rpb24gZGVsYXlXaXRoU2VsZWN0b3Ioc291cmNlLCBzdWJzY3JpcHRpb25EZWxheSwgZGVsYXlEdXJhdGlvblNlbGVjdG9yKSB7XG5cdCAgICB2YXIgc3ViRGVsYXksIHNlbGVjdG9yO1xuXHQgICAgaWYgKGlzRnVuY3Rpb24oc3Vic2NyaXB0aW9uRGVsYXkpKSB7XG5cdCAgICAgIHNlbGVjdG9yID0gc3Vic2NyaXB0aW9uRGVsYXk7XG5cdCAgICB9IGVsc2Uge1xuXHQgICAgICBzdWJEZWxheSA9IHN1YnNjcmlwdGlvbkRlbGF5O1xuXHQgICAgICBzZWxlY3RvciA9IGRlbGF5RHVyYXRpb25TZWxlY3Rvcjtcblx0ICAgIH1cblx0ICAgIHJldHVybiBuZXcgQW5vbnltb3VzT2JzZXJ2YWJsZShmdW5jdGlvbiAobykge1xuXHQgICAgICB2YXIgZGVsYXlzID0gbmV3IENvbXBvc2l0ZURpc3Bvc2FibGUoKSwgYXRFbmQgPSBmYWxzZSwgc3Vic2NyaXB0aW9uID0gbmV3IFNlcmlhbERpc3Bvc2FibGUoKTtcblx0XG5cdCAgICAgIGZ1bmN0aW9uIHN0YXJ0KCkge1xuXHQgICAgICAgIHN1YnNjcmlwdGlvbi5zZXREaXNwb3NhYmxlKHNvdXJjZS5zdWJzY3JpYmUoXG5cdCAgICAgICAgICBmdW5jdGlvbiAoeCkge1xuXHQgICAgICAgICAgICB2YXIgZGVsYXkgPSB0cnlDYXRjaChzZWxlY3RvcikoeCk7XG5cdCAgICAgICAgICAgIGlmIChkZWxheSA9PT0gZXJyb3JPYmopIHsgcmV0dXJuIG8ub25FcnJvcihkZWxheS5lKTsgfVxuXHQgICAgICAgICAgICB2YXIgZCA9IG5ldyBTaW5nbGVBc3NpZ25tZW50RGlzcG9zYWJsZSgpO1xuXHQgICAgICAgICAgICBkZWxheXMuYWRkKGQpO1xuXHQgICAgICAgICAgICBkLnNldERpc3Bvc2FibGUoZGVsYXkuc3Vic2NyaWJlKFxuXHQgICAgICAgICAgICAgIGZ1bmN0aW9uICgpIHtcblx0ICAgICAgICAgICAgICAgIG8ub25OZXh0KHgpO1xuXHQgICAgICAgICAgICAgICAgZGVsYXlzLnJlbW92ZShkKTtcblx0ICAgICAgICAgICAgICAgIGRvbmUoKTtcblx0ICAgICAgICAgICAgICB9LFxuXHQgICAgICAgICAgICAgIGZ1bmN0aW9uIChlKSB7IG8ub25FcnJvcihlKTsgfSxcblx0ICAgICAgICAgICAgICBmdW5jdGlvbiAoKSB7XG5cdCAgICAgICAgICAgICAgICBvLm9uTmV4dCh4KTtcblx0ICAgICAgICAgICAgICAgIGRlbGF5cy5yZW1vdmUoZCk7XG5cdCAgICAgICAgICAgICAgICBkb25lKCk7XG5cdCAgICAgICAgICAgICAgfVxuXHQgICAgICAgICAgICApKTtcblx0ICAgICAgICAgIH0sXG5cdCAgICAgICAgICBmdW5jdGlvbiAoZSkgeyBvLm9uRXJyb3IoZSk7IH0sXG5cdCAgICAgICAgICBmdW5jdGlvbiAoKSB7XG5cdCAgICAgICAgICAgIGF0RW5kID0gdHJ1ZTtcblx0ICAgICAgICAgICAgc3Vic2NyaXB0aW9uLmRpc3Bvc2UoKTtcblx0ICAgICAgICAgICAgZG9uZSgpO1xuXHQgICAgICAgICAgfVxuXHQgICAgICAgICkpO1xuXHQgICAgICB9XG5cdFxuXHQgICAgICBmdW5jdGlvbiBkb25lICgpIHtcblx0ICAgICAgICBhdEVuZCAmJiBkZWxheXMubGVuZ3RoID09PSAwICYmIG8ub25Db21wbGV0ZWQoKTtcblx0ICAgICAgfVxuXHRcblx0ICAgICAgaWYgKCFzdWJEZWxheSkge1xuXHQgICAgICAgIHN0YXJ0KCk7XG5cdCAgICAgIH0gZWxzZSB7XG5cdCAgICAgICAgc3Vic2NyaXB0aW9uLnNldERpc3Bvc2FibGUoc3ViRGVsYXkuc3Vic2NyaWJlKHN0YXJ0LCBmdW5jdGlvbiAoZSkgeyBvLm9uRXJyb3IoZSk7IH0sIHN0YXJ0KSk7XG5cdCAgICAgIH1cblx0XG5cdCAgICAgIHJldHVybiBuZXcgQmluYXJ5RGlzcG9zYWJsZShzdWJzY3JpcHRpb24sIGRlbGF5cyk7XG5cdCAgICB9LCB0aGlzKTtcblx0ICB9XG5cdFxuXHQgIC8qKlxuXHQgICAqICBUaW1lIHNoaWZ0cyB0aGUgb2JzZXJ2YWJsZSBzZXF1ZW5jZSBieSBkdWVUaW1lLlxuXHQgICAqICBUaGUgcmVsYXRpdmUgdGltZSBpbnRlcnZhbHMgYmV0d2VlbiB0aGUgdmFsdWVzIGFyZSBwcmVzZXJ2ZWQuXG5cdCAgICpcblx0ICAgKiBAcGFyYW0ge051bWJlcn0gZHVlVGltZSBBYnNvbHV0ZSAoc3BlY2lmaWVkIGFzIGEgRGF0ZSBvYmplY3QpIG9yIHJlbGF0aXZlIHRpbWUgKHNwZWNpZmllZCBhcyBhbiBpbnRlZ2VyIGRlbm90aW5nIG1pbGxpc2Vjb25kcykgYnkgd2hpY2ggdG8gc2hpZnQgdGhlIG9ic2VydmFibGUgc2VxdWVuY2UuXG5cdCAgICogQHBhcmFtIHtTY2hlZHVsZXJ9IFtzY2hlZHVsZXJdIFNjaGVkdWxlciB0byBydW4gdGhlIGRlbGF5IHRpbWVycyBvbi4gSWYgbm90IHNwZWNpZmllZCwgdGhlIHRpbWVvdXQgc2NoZWR1bGVyIGlzIHVzZWQuXG5cdCAgICogQHJldHVybnMge09ic2VydmFibGV9IFRpbWUtc2hpZnRlZCBzZXF1ZW5jZS5cblx0ICAgKi9cblx0ICBvYnNlcnZhYmxlUHJvdG8uZGVsYXkgPSBmdW5jdGlvbiAoKSB7XG5cdCAgICB2YXIgZmlyc3RBcmcgPSBhcmd1bWVudHNbMF07XG5cdCAgICBpZiAodHlwZW9mIGZpcnN0QXJnID09PSAnbnVtYmVyJyB8fCBmaXJzdEFyZyBpbnN0YW5jZW9mIERhdGUpIHtcblx0ICAgICAgdmFyIGR1ZVRpbWUgPSBmaXJzdEFyZywgc2NoZWR1bGVyID0gYXJndW1lbnRzWzFdO1xuXHQgICAgICBpc1NjaGVkdWxlcihzY2hlZHVsZXIpIHx8IChzY2hlZHVsZXIgPSBkZWZhdWx0U2NoZWR1bGVyKTtcblx0ICAgICAgcmV0dXJuIGR1ZVRpbWUgaW5zdGFuY2VvZiBEYXRlID9cblx0ICAgICAgICBvYnNlcnZhYmxlRGVsYXlBYnNvbHV0ZSh0aGlzLCBkdWVUaW1lLCBzY2hlZHVsZXIpIDpcblx0ICAgICAgICBvYnNlcnZhYmxlRGVsYXlSZWxhdGl2ZSh0aGlzLCBkdWVUaW1lLCBzY2hlZHVsZXIpO1xuXHQgICAgfSBlbHNlIGlmIChPYnNlcnZhYmxlLmlzT2JzZXJ2YWJsZShmaXJzdEFyZykgfHwgaXNGdW5jdGlvbihmaXJzdEFyZykpIHtcblx0ICAgICAgcmV0dXJuIGRlbGF5V2l0aFNlbGVjdG9yKHRoaXMsIGZpcnN0QXJnLCBhcmd1bWVudHNbMV0pO1xuXHQgICAgfSBlbHNlIHtcblx0ICAgICAgdGhyb3cgbmV3IEVycm9yKCdJbnZhbGlkIGFyZ3VtZW50cycpO1xuXHQgICAgfVxuXHQgIH07XG5cdFxuXHQgIHZhciBEZWJvdW5jZU9ic2VydmFibGUgPSAoZnVuY3Rpb24gKF9fc3VwZXJfXykge1xuXHQgICAgaW5oZXJpdHMoRGVib3VuY2VPYnNlcnZhYmxlLCBfX3N1cGVyX18pO1xuXHQgICAgZnVuY3Rpb24gRGVib3VuY2VPYnNlcnZhYmxlKHNvdXJjZSwgZHQsIHMpIHtcblx0ICAgICAgaXNTY2hlZHVsZXIocykgfHwgKHMgPSBkZWZhdWx0U2NoZWR1bGVyKTtcblx0ICAgICAgdGhpcy5zb3VyY2UgPSBzb3VyY2U7XG5cdCAgICAgIHRoaXMuX2R0ID0gZHQ7XG5cdCAgICAgIHRoaXMuX3MgPSBzO1xuXHQgICAgICBfX3N1cGVyX18uY2FsbCh0aGlzKTtcblx0ICAgIH1cblx0XG5cdCAgICBEZWJvdW5jZU9ic2VydmFibGUucHJvdG90eXBlLnN1YnNjcmliZUNvcmUgPSBmdW5jdGlvbiAobykge1xuXHQgICAgICB2YXIgY2FuY2VsYWJsZSA9IG5ldyBTZXJpYWxEaXNwb3NhYmxlKCk7XG5cdCAgICAgIHJldHVybiBuZXcgQmluYXJ5RGlzcG9zYWJsZShcblx0ICAgICAgICB0aGlzLnNvdXJjZS5zdWJzY3JpYmUobmV3IERlYm91bmNlT2JzZXJ2ZXIobywgdGhpcy5zb3VyY2UsIHRoaXMuX2R0LCB0aGlzLl9zLCBjYW5jZWxhYmxlKSksXG5cdCAgICAgICAgY2FuY2VsYWJsZSk7XG5cdCAgICB9O1xuXHRcblx0ICAgIHJldHVybiBEZWJvdW5jZU9ic2VydmFibGU7XG5cdCAgfShPYnNlcnZhYmxlQmFzZSkpO1xuXHRcblx0ICB2YXIgRGVib3VuY2VPYnNlcnZlciA9IChmdW5jdGlvbiAoX19zdXBlcl9fKSB7XG5cdCAgICBpbmhlcml0cyhEZWJvdW5jZU9ic2VydmVyLCBfX3N1cGVyX18pO1xuXHQgICAgZnVuY3Rpb24gRGVib3VuY2VPYnNlcnZlcihvYnNlcnZlciwgc291cmNlLCBkdWVUaW1lLCBzY2hlZHVsZXIsIGNhbmNlbGFibGUpIHtcblx0ICAgICAgdGhpcy5fbyA9IG9ic2VydmVyO1xuXHQgICAgICB0aGlzLl9zID0gc291cmNlO1xuXHQgICAgICB0aGlzLl9kID0gZHVlVGltZTtcblx0ICAgICAgdGhpcy5fc2NoZWR1bGVyID0gc2NoZWR1bGVyO1xuXHQgICAgICB0aGlzLl9jID0gY2FuY2VsYWJsZTtcblx0ICAgICAgdGhpcy5fdiA9IG51bGw7XG5cdCAgICAgIHRoaXMuX2h2ID0gZmFsc2U7XG5cdCAgICAgIHRoaXMuX2lkID0gMDtcblx0ICAgICAgX19zdXBlcl9fLmNhbGwodGhpcyk7XG5cdCAgICB9XG5cdFxuXHQgICAgRGVib3VuY2VPYnNlcnZlci5wcm90b3R5cGUubmV4dCA9IGZ1bmN0aW9uICh4KSB7XG5cdCAgICAgIHRoaXMuX2h2ID0gdHJ1ZTtcblx0ICAgICAgdGhpcy5fdiA9IHg7XG5cdCAgICAgIHZhciBjdXJyZW50SWQgPSArK3RoaXMuX2lkLCBkID0gbmV3IFNpbmdsZUFzc2lnbm1lbnREaXNwb3NhYmxlKCk7XG5cdCAgICAgIHRoaXMuX2Muc2V0RGlzcG9zYWJsZShkKTtcblx0ICAgICAgZC5zZXREaXNwb3NhYmxlKHRoaXMuX3NjaGVkdWxlci5zY2hlZHVsZUZ1dHVyZSh0aGlzLCB0aGlzLl9kLCBmdW5jdGlvbiAoXywgc2VsZikge1xuXHQgICAgICAgIHNlbGYuX2h2ICYmIHNlbGYuX2lkID09PSBjdXJyZW50SWQgJiYgc2VsZi5fby5vbk5leHQoeCk7XG5cdCAgICAgICAgc2VsZi5faHYgPSBmYWxzZTtcblx0ICAgICAgfSkpO1xuXHQgICAgfTtcblx0XG5cdCAgICBEZWJvdW5jZU9ic2VydmVyLnByb3RvdHlwZS5lcnJvciA9IGZ1bmN0aW9uIChlKSB7XG5cdCAgICAgIHRoaXMuX2MuZGlzcG9zZSgpO1xuXHQgICAgICB0aGlzLl9vLm9uRXJyb3IoZSk7XG5cdCAgICAgIHRoaXMuX2h2ID0gZmFsc2U7XG5cdCAgICAgIHRoaXMuX2lkKys7XG5cdCAgICB9O1xuXHRcblx0ICAgIERlYm91bmNlT2JzZXJ2ZXIucHJvdG90eXBlLmNvbXBsZXRlZCA9IGZ1bmN0aW9uICgpIHtcblx0ICAgICAgdGhpcy5fYy5kaXNwb3NlKCk7XG5cdCAgICAgIHRoaXMuX2h2ICYmIHRoaXMuX28ub25OZXh0KHRoaXMuX3YpO1xuXHQgICAgICB0aGlzLl9vLm9uQ29tcGxldGVkKCk7XG5cdCAgICAgIHRoaXMuX2h2ID0gZmFsc2U7XG5cdCAgICAgIHRoaXMuX2lkKys7XG5cdCAgICB9O1xuXHRcblx0ICAgIHJldHVybiBEZWJvdW5jZU9ic2VydmVyO1xuXHQgIH0oQWJzdHJhY3RPYnNlcnZlcikpO1xuXHRcblx0ICBmdW5jdGlvbiBkZWJvdW5jZVdpdGhTZWxlY3Rvcihzb3VyY2UsIGR1cmF0aW9uU2VsZWN0b3IpIHtcblx0ICAgIHJldHVybiBuZXcgQW5vbnltb3VzT2JzZXJ2YWJsZShmdW5jdGlvbiAobykge1xuXHQgICAgICB2YXIgdmFsdWUsIGhhc1ZhbHVlID0gZmFsc2UsIGNhbmNlbGFibGUgPSBuZXcgU2VyaWFsRGlzcG9zYWJsZSgpLCBpZCA9IDA7XG5cdCAgICAgIHZhciBzdWJzY3JpcHRpb24gPSBzb3VyY2Uuc3Vic2NyaWJlKFxuXHQgICAgICAgIGZ1bmN0aW9uICh4KSB7XG5cdCAgICAgICAgICB2YXIgdGhyb3R0bGUgPSB0cnlDYXRjaChkdXJhdGlvblNlbGVjdG9yKSh4KTtcblx0ICAgICAgICAgIGlmICh0aHJvdHRsZSA9PT0gZXJyb3JPYmopIHsgcmV0dXJuIG8ub25FcnJvcih0aHJvdHRsZS5lKTsgfVxuXHRcblx0ICAgICAgICAgIGlzUHJvbWlzZSh0aHJvdHRsZSkgJiYgKHRocm90dGxlID0gb2JzZXJ2YWJsZUZyb21Qcm9taXNlKHRocm90dGxlKSk7XG5cdFxuXHQgICAgICAgICAgaGFzVmFsdWUgPSB0cnVlO1xuXHQgICAgICAgICAgdmFsdWUgPSB4O1xuXHQgICAgICAgICAgaWQrKztcblx0ICAgICAgICAgIHZhciBjdXJyZW50aWQgPSBpZCwgZCA9IG5ldyBTaW5nbGVBc3NpZ25tZW50RGlzcG9zYWJsZSgpO1xuXHQgICAgICAgICAgY2FuY2VsYWJsZS5zZXREaXNwb3NhYmxlKGQpO1xuXHQgICAgICAgICAgZC5zZXREaXNwb3NhYmxlKHRocm90dGxlLnN1YnNjcmliZShcblx0ICAgICAgICAgICAgZnVuY3Rpb24gKCkge1xuXHQgICAgICAgICAgICAgIGhhc1ZhbHVlICYmIGlkID09PSBjdXJyZW50aWQgJiYgby5vbk5leHQodmFsdWUpO1xuXHQgICAgICAgICAgICAgIGhhc1ZhbHVlID0gZmFsc2U7XG5cdCAgICAgICAgICAgICAgZC5kaXNwb3NlKCk7XG5cdCAgICAgICAgICAgIH0sXG5cdCAgICAgICAgICAgIGZ1bmN0aW9uIChlKSB7IG8ub25FcnJvcihlKTsgfSxcblx0ICAgICAgICAgICAgZnVuY3Rpb24gKCkge1xuXHQgICAgICAgICAgICAgIGhhc1ZhbHVlICYmIGlkID09PSBjdXJyZW50aWQgJiYgby5vbk5leHQodmFsdWUpO1xuXHQgICAgICAgICAgICAgIGhhc1ZhbHVlID0gZmFsc2U7XG5cdCAgICAgICAgICAgICAgZC5kaXNwb3NlKCk7XG5cdCAgICAgICAgICAgIH1cblx0ICAgICAgICAgICkpO1xuXHQgICAgICAgIH0sXG5cdCAgICAgICAgZnVuY3Rpb24gKGUpIHtcblx0ICAgICAgICAgIGNhbmNlbGFibGUuZGlzcG9zZSgpO1xuXHQgICAgICAgICAgby5vbkVycm9yKGUpO1xuXHQgICAgICAgICAgaGFzVmFsdWUgPSBmYWxzZTtcblx0ICAgICAgICAgIGlkKys7XG5cdCAgICAgICAgfSxcblx0ICAgICAgICBmdW5jdGlvbiAoKSB7XG5cdCAgICAgICAgICBjYW5jZWxhYmxlLmRpc3Bvc2UoKTtcblx0ICAgICAgICAgIGhhc1ZhbHVlICYmIG8ub25OZXh0KHZhbHVlKTtcblx0ICAgICAgICAgIG8ub25Db21wbGV0ZWQoKTtcblx0ICAgICAgICAgIGhhc1ZhbHVlID0gZmFsc2U7XG5cdCAgICAgICAgICBpZCsrO1xuXHQgICAgICAgIH1cblx0ICAgICAgKTtcblx0ICAgICAgcmV0dXJuIG5ldyBCaW5hcnlEaXNwb3NhYmxlKHN1YnNjcmlwdGlvbiwgY2FuY2VsYWJsZSk7XG5cdCAgICB9LCBzb3VyY2UpO1xuXHQgIH1cblx0XG5cdCAgb2JzZXJ2YWJsZVByb3RvLmRlYm91bmNlID0gZnVuY3Rpb24gKCkge1xuXHQgICAgaWYgKGlzRnVuY3Rpb24gKGFyZ3VtZW50c1swXSkpIHtcblx0ICAgICAgcmV0dXJuIGRlYm91bmNlV2l0aFNlbGVjdG9yKHRoaXMsIGFyZ3VtZW50c1swXSk7XG5cdCAgICB9IGVsc2UgaWYgKHR5cGVvZiBhcmd1bWVudHNbMF0gPT09ICdudW1iZXInKSB7XG5cdCAgICAgIHJldHVybiBuZXcgRGVib3VuY2VPYnNlcnZhYmxlKHRoaXMsIGFyZ3VtZW50c1swXSwgYXJndW1lbnRzWzFdKTtcblx0ICAgIH0gZWxzZSB7XG5cdCAgICAgIHRocm93IG5ldyBFcnJvcignSW52YWxpZCBhcmd1bWVudHMnKTtcblx0ICAgIH1cblx0ICB9O1xuXHRcblx0ICAvKipcblx0ICAgKiAgUHJvamVjdHMgZWFjaCBlbGVtZW50IG9mIGFuIG9ic2VydmFibGUgc2VxdWVuY2UgaW50byB6ZXJvIG9yIG1vcmUgd2luZG93cyB3aGljaCBhcmUgcHJvZHVjZWQgYmFzZWQgb24gdGltaW5nIGluZm9ybWF0aW9uLlxuXHQgICAqIEBwYXJhbSB7TnVtYmVyfSB0aW1lU3BhbiBMZW5ndGggb2YgZWFjaCB3aW5kb3cgKHNwZWNpZmllZCBhcyBhbiBpbnRlZ2VyIGRlbm90aW5nIG1pbGxpc2Vjb25kcykuXG5cdCAgICogQHBhcmFtIHtNaXhlZH0gW3RpbWVTaGlmdE9yU2NoZWR1bGVyXSAgSW50ZXJ2YWwgYmV0d2VlbiBjcmVhdGlvbiBvZiBjb25zZWN1dGl2ZSB3aW5kb3dzIChzcGVjaWZpZWQgYXMgYW4gaW50ZWdlciBkZW5vdGluZyBtaWxsaXNlY29uZHMpLCBvciBhbiBvcHRpb25hbCBzY2hlZHVsZXIgcGFyYW1ldGVyLiBJZiBub3Qgc3BlY2lmaWVkLCB0aGUgdGltZSBzaGlmdCBjb3JyZXNwb25kcyB0byB0aGUgdGltZVNwYW4gcGFyYW1ldGVyLCByZXN1bHRpbmcgaW4gbm9uLW92ZXJsYXBwaW5nIGFkamFjZW50IHdpbmRvd3MuXG5cdCAgICogQHBhcmFtIHtTY2hlZHVsZXJ9IFtzY2hlZHVsZXJdICBTY2hlZHVsZXIgdG8gcnVuIHdpbmRvd2luZyB0aW1lcnMgb24uIElmIG5vdCBzcGVjaWZpZWQsIHRoZSB0aW1lb3V0IHNjaGVkdWxlciBpcyB1c2VkLlxuXHQgICAqIEByZXR1cm5zIHtPYnNlcnZhYmxlfSBBbiBvYnNlcnZhYmxlIHNlcXVlbmNlIG9mIHdpbmRvd3MuXG5cdCAgICovXG5cdCAgb2JzZXJ2YWJsZVByb3RvLndpbmRvd1dpdGhUaW1lID0gZnVuY3Rpb24gKHRpbWVTcGFuLCB0aW1lU2hpZnRPclNjaGVkdWxlciwgc2NoZWR1bGVyKSB7XG5cdCAgICB2YXIgc291cmNlID0gdGhpcywgdGltZVNoaWZ0O1xuXHQgICAgdGltZVNoaWZ0T3JTY2hlZHVsZXIgPT0gbnVsbCAmJiAodGltZVNoaWZ0ID0gdGltZVNwYW4pO1xuXHQgICAgaXNTY2hlZHVsZXIoc2NoZWR1bGVyKSB8fCAoc2NoZWR1bGVyID0gZGVmYXVsdFNjaGVkdWxlcik7XG5cdCAgICBpZiAodHlwZW9mIHRpbWVTaGlmdE9yU2NoZWR1bGVyID09PSAnbnVtYmVyJykge1xuXHQgICAgICB0aW1lU2hpZnQgPSB0aW1lU2hpZnRPclNjaGVkdWxlcjtcblx0ICAgIH0gZWxzZSBpZiAoaXNTY2hlZHVsZXIodGltZVNoaWZ0T3JTY2hlZHVsZXIpKSB7XG5cdCAgICAgIHRpbWVTaGlmdCA9IHRpbWVTcGFuO1xuXHQgICAgICBzY2hlZHVsZXIgPSB0aW1lU2hpZnRPclNjaGVkdWxlcjtcblx0ICAgIH1cblx0ICAgIHJldHVybiBuZXcgQW5vbnltb3VzT2JzZXJ2YWJsZShmdW5jdGlvbiAob2JzZXJ2ZXIpIHtcblx0ICAgICAgdmFyIGdyb3VwRGlzcG9zYWJsZSxcblx0ICAgICAgICBuZXh0U2hpZnQgPSB0aW1lU2hpZnQsXG5cdCAgICAgICAgbmV4dFNwYW4gPSB0aW1lU3Bhbixcblx0ICAgICAgICBxID0gW10sXG5cdCAgICAgICAgcmVmQ291bnREaXNwb3NhYmxlLFxuXHQgICAgICAgIHRpbWVyRCA9IG5ldyBTZXJpYWxEaXNwb3NhYmxlKCksXG5cdCAgICAgICAgdG90YWxUaW1lID0gMDtcblx0ICAgICAgICBncm91cERpc3Bvc2FibGUgPSBuZXcgQ29tcG9zaXRlRGlzcG9zYWJsZSh0aW1lckQpLFxuXHQgICAgICAgIHJlZkNvdW50RGlzcG9zYWJsZSA9IG5ldyBSZWZDb3VudERpc3Bvc2FibGUoZ3JvdXBEaXNwb3NhYmxlKTtcblx0XG5cdCAgICAgICBmdW5jdGlvbiBjcmVhdGVUaW1lciAoKSB7XG5cdCAgICAgICAgdmFyIG0gPSBuZXcgU2luZ2xlQXNzaWdubWVudERpc3Bvc2FibGUoKSxcblx0ICAgICAgICAgIGlzU3BhbiA9IGZhbHNlLFxuXHQgICAgICAgICAgaXNTaGlmdCA9IGZhbHNlO1xuXHQgICAgICAgIHRpbWVyRC5zZXREaXNwb3NhYmxlKG0pO1xuXHQgICAgICAgIGlmIChuZXh0U3BhbiA9PT0gbmV4dFNoaWZ0KSB7XG5cdCAgICAgICAgICBpc1NwYW4gPSB0cnVlO1xuXHQgICAgICAgICAgaXNTaGlmdCA9IHRydWU7XG5cdCAgICAgICAgfSBlbHNlIGlmIChuZXh0U3BhbiA8IG5leHRTaGlmdCkge1xuXHQgICAgICAgICAgICBpc1NwYW4gPSB0cnVlO1xuXHQgICAgICAgIH0gZWxzZSB7XG5cdCAgICAgICAgICBpc1NoaWZ0ID0gdHJ1ZTtcblx0ICAgICAgICB9XG5cdCAgICAgICAgdmFyIG5ld1RvdGFsVGltZSA9IGlzU3BhbiA/IG5leHRTcGFuIDogbmV4dFNoaWZ0LFxuXHQgICAgICAgICAgdHMgPSBuZXdUb3RhbFRpbWUgLSB0b3RhbFRpbWU7XG5cdCAgICAgICAgdG90YWxUaW1lID0gbmV3VG90YWxUaW1lO1xuXHQgICAgICAgIGlmIChpc1NwYW4pIHtcblx0ICAgICAgICAgIG5leHRTcGFuICs9IHRpbWVTaGlmdDtcblx0ICAgICAgICB9XG5cdCAgICAgICAgaWYgKGlzU2hpZnQpIHtcblx0ICAgICAgICAgIG5leHRTaGlmdCArPSB0aW1lU2hpZnQ7XG5cdCAgICAgICAgfVxuXHQgICAgICAgIG0uc2V0RGlzcG9zYWJsZShzY2hlZHVsZXIuc2NoZWR1bGVGdXR1cmUobnVsbCwgdHMsIGZ1bmN0aW9uICgpIHtcblx0ICAgICAgICAgIGlmIChpc1NoaWZ0KSB7XG5cdCAgICAgICAgICAgIHZhciBzID0gbmV3IFN1YmplY3QoKTtcblx0ICAgICAgICAgICAgcS5wdXNoKHMpO1xuXHQgICAgICAgICAgICBvYnNlcnZlci5vbk5leHQoYWRkUmVmKHMsIHJlZkNvdW50RGlzcG9zYWJsZSkpO1xuXHQgICAgICAgICAgfVxuXHQgICAgICAgICAgaXNTcGFuICYmIHEuc2hpZnQoKS5vbkNvbXBsZXRlZCgpO1xuXHQgICAgICAgICAgY3JlYXRlVGltZXIoKTtcblx0ICAgICAgICB9KSk7XG5cdCAgICAgIH07XG5cdCAgICAgIHEucHVzaChuZXcgU3ViamVjdCgpKTtcblx0ICAgICAgb2JzZXJ2ZXIub25OZXh0KGFkZFJlZihxWzBdLCByZWZDb3VudERpc3Bvc2FibGUpKTtcblx0ICAgICAgY3JlYXRlVGltZXIoKTtcblx0ICAgICAgZ3JvdXBEaXNwb3NhYmxlLmFkZChzb3VyY2Uuc3Vic2NyaWJlKFxuXHQgICAgICAgIGZ1bmN0aW9uICh4KSB7XG5cdCAgICAgICAgICBmb3IgKHZhciBpID0gMCwgbGVuID0gcS5sZW5ndGg7IGkgPCBsZW47IGkrKykgeyBxW2ldLm9uTmV4dCh4KTsgfVxuXHQgICAgICAgIH0sXG5cdCAgICAgICAgZnVuY3Rpb24gKGUpIHtcblx0ICAgICAgICAgIGZvciAodmFyIGkgPSAwLCBsZW4gPSBxLmxlbmd0aDsgaSA8IGxlbjsgaSsrKSB7IHFbaV0ub25FcnJvcihlKTsgfVxuXHQgICAgICAgICAgb2JzZXJ2ZXIub25FcnJvcihlKTtcblx0ICAgICAgICB9LFxuXHQgICAgICAgIGZ1bmN0aW9uICgpIHtcblx0ICAgICAgICAgIGZvciAodmFyIGkgPSAwLCBsZW4gPSBxLmxlbmd0aDsgaSA8IGxlbjsgaSsrKSB7IHFbaV0ub25Db21wbGV0ZWQoKTsgfVxuXHQgICAgICAgICAgb2JzZXJ2ZXIub25Db21wbGV0ZWQoKTtcblx0ICAgICAgICB9XG5cdCAgICAgICkpO1xuXHQgICAgICByZXR1cm4gcmVmQ291bnREaXNwb3NhYmxlO1xuXHQgICAgfSwgc291cmNlKTtcblx0ICB9O1xuXHRcblx0ICAvKipcblx0ICAgKiAgUHJvamVjdHMgZWFjaCBlbGVtZW50IG9mIGFuIG9ic2VydmFibGUgc2VxdWVuY2UgaW50byBhIHdpbmRvdyB0aGF0IGlzIGNvbXBsZXRlZCB3aGVuIGVpdGhlciBpdCdzIGZ1bGwgb3IgYSBnaXZlbiBhbW91bnQgb2YgdGltZSBoYXMgZWxhcHNlZC5cblx0ICAgKiBAcGFyYW0ge051bWJlcn0gdGltZVNwYW4gTWF4aW11bSB0aW1lIGxlbmd0aCBvZiBhIHdpbmRvdy5cblx0ICAgKiBAcGFyYW0ge051bWJlcn0gY291bnQgTWF4aW11bSBlbGVtZW50IGNvdW50IG9mIGEgd2luZG93LlxuXHQgICAqIEBwYXJhbSB7U2NoZWR1bGVyfSBbc2NoZWR1bGVyXSAgU2NoZWR1bGVyIHRvIHJ1biB3aW5kb3dpbmcgdGltZXJzIG9uLiBJZiBub3Qgc3BlY2lmaWVkLCB0aGUgdGltZW91dCBzY2hlZHVsZXIgaXMgdXNlZC5cblx0ICAgKiBAcmV0dXJucyB7T2JzZXJ2YWJsZX0gQW4gb2JzZXJ2YWJsZSBzZXF1ZW5jZSBvZiB3aW5kb3dzLlxuXHQgICAqL1xuXHQgIG9ic2VydmFibGVQcm90by53aW5kb3dXaXRoVGltZU9yQ291bnQgPSBmdW5jdGlvbiAodGltZVNwYW4sIGNvdW50LCBzY2hlZHVsZXIpIHtcblx0ICAgIHZhciBzb3VyY2UgPSB0aGlzO1xuXHQgICAgaXNTY2hlZHVsZXIoc2NoZWR1bGVyKSB8fCAoc2NoZWR1bGVyID0gZGVmYXVsdFNjaGVkdWxlcik7XG5cdCAgICByZXR1cm4gbmV3IEFub255bW91c09ic2VydmFibGUoZnVuY3Rpb24gKG9ic2VydmVyKSB7XG5cdCAgICAgIHZhciB0aW1lckQgPSBuZXcgU2VyaWFsRGlzcG9zYWJsZSgpLFxuXHQgICAgICAgICAgZ3JvdXBEaXNwb3NhYmxlID0gbmV3IENvbXBvc2l0ZURpc3Bvc2FibGUodGltZXJEKSxcblx0ICAgICAgICAgIHJlZkNvdW50RGlzcG9zYWJsZSA9IG5ldyBSZWZDb3VudERpc3Bvc2FibGUoZ3JvdXBEaXNwb3NhYmxlKSxcblx0ICAgICAgICAgIG4gPSAwLFxuXHQgICAgICAgICAgd2luZG93SWQgPSAwLFxuXHQgICAgICAgICAgcyA9IG5ldyBTdWJqZWN0KCk7XG5cdFxuXHQgICAgICBmdW5jdGlvbiBjcmVhdGVUaW1lcihpZCkge1xuXHQgICAgICAgIHZhciBtID0gbmV3IFNpbmdsZUFzc2lnbm1lbnREaXNwb3NhYmxlKCk7XG5cdCAgICAgICAgdGltZXJELnNldERpc3Bvc2FibGUobSk7XG5cdCAgICAgICAgbS5zZXREaXNwb3NhYmxlKHNjaGVkdWxlci5zY2hlZHVsZUZ1dHVyZShudWxsLCB0aW1lU3BhbiwgZnVuY3Rpb24gKCkge1xuXHQgICAgICAgICAgaWYgKGlkICE9PSB3aW5kb3dJZCkgeyByZXR1cm47IH1cblx0ICAgICAgICAgIG4gPSAwO1xuXHQgICAgICAgICAgdmFyIG5ld0lkID0gKyt3aW5kb3dJZDtcblx0ICAgICAgICAgIHMub25Db21wbGV0ZWQoKTtcblx0ICAgICAgICAgIHMgPSBuZXcgU3ViamVjdCgpO1xuXHQgICAgICAgICAgb2JzZXJ2ZXIub25OZXh0KGFkZFJlZihzLCByZWZDb3VudERpc3Bvc2FibGUpKTtcblx0ICAgICAgICAgIGNyZWF0ZVRpbWVyKG5ld0lkKTtcblx0ICAgICAgICB9KSk7XG5cdCAgICAgIH1cblx0XG5cdCAgICAgIG9ic2VydmVyLm9uTmV4dChhZGRSZWYocywgcmVmQ291bnREaXNwb3NhYmxlKSk7XG5cdCAgICAgIGNyZWF0ZVRpbWVyKDApO1xuXHRcblx0ICAgICAgZ3JvdXBEaXNwb3NhYmxlLmFkZChzb3VyY2Uuc3Vic2NyaWJlKFxuXHQgICAgICAgIGZ1bmN0aW9uICh4KSB7XG5cdCAgICAgICAgICB2YXIgbmV3SWQgPSAwLCBuZXdXaW5kb3cgPSBmYWxzZTtcblx0ICAgICAgICAgIHMub25OZXh0KHgpO1xuXHQgICAgICAgICAgaWYgKCsrbiA9PT0gY291bnQpIHtcblx0ICAgICAgICAgICAgbmV3V2luZG93ID0gdHJ1ZTtcblx0ICAgICAgICAgICAgbiA9IDA7XG5cdCAgICAgICAgICAgIG5ld0lkID0gKyt3aW5kb3dJZDtcblx0ICAgICAgICAgICAgcy5vbkNvbXBsZXRlZCgpO1xuXHQgICAgICAgICAgICBzID0gbmV3IFN1YmplY3QoKTtcblx0ICAgICAgICAgICAgb2JzZXJ2ZXIub25OZXh0KGFkZFJlZihzLCByZWZDb3VudERpc3Bvc2FibGUpKTtcblx0ICAgICAgICAgIH1cblx0ICAgICAgICAgIG5ld1dpbmRvdyAmJiBjcmVhdGVUaW1lcihuZXdJZCk7XG5cdCAgICAgICAgfSxcblx0ICAgICAgICBmdW5jdGlvbiAoZSkge1xuXHQgICAgICAgICAgcy5vbkVycm9yKGUpO1xuXHQgICAgICAgICAgb2JzZXJ2ZXIub25FcnJvcihlKTtcblx0ICAgICAgICB9LCBmdW5jdGlvbiAoKSB7XG5cdCAgICAgICAgICBzLm9uQ29tcGxldGVkKCk7XG5cdCAgICAgICAgICBvYnNlcnZlci5vbkNvbXBsZXRlZCgpO1xuXHQgICAgICAgIH1cblx0ICAgICAgKSk7XG5cdCAgICAgIHJldHVybiByZWZDb3VudERpc3Bvc2FibGU7XG5cdCAgICB9LCBzb3VyY2UpO1xuXHQgIH07XG5cdFxuXHQgIGZ1bmN0aW9uIHRvQXJyYXkoeCkgeyByZXR1cm4geC50b0FycmF5KCk7IH1cblx0XG5cdCAgLyoqXG5cdCAgICogIFByb2plY3RzIGVhY2ggZWxlbWVudCBvZiBhbiBvYnNlcnZhYmxlIHNlcXVlbmNlIGludG8gemVybyBvciBtb3JlIGJ1ZmZlcnMgd2hpY2ggYXJlIHByb2R1Y2VkIGJhc2VkIG9uIHRpbWluZyBpbmZvcm1hdGlvbi5cblx0ICAgKiBAcGFyYW0ge051bWJlcn0gdGltZVNwYW4gTGVuZ3RoIG9mIGVhY2ggYnVmZmVyIChzcGVjaWZpZWQgYXMgYW4gaW50ZWdlciBkZW5vdGluZyBtaWxsaXNlY29uZHMpLlxuXHQgICAqIEBwYXJhbSB7TWl4ZWR9IFt0aW1lU2hpZnRPclNjaGVkdWxlcl0gIEludGVydmFsIGJldHdlZW4gY3JlYXRpb24gb2YgY29uc2VjdXRpdmUgYnVmZmVycyAoc3BlY2lmaWVkIGFzIGFuIGludGVnZXIgZGVub3RpbmcgbWlsbGlzZWNvbmRzKSwgb3IgYW4gb3B0aW9uYWwgc2NoZWR1bGVyIHBhcmFtZXRlci4gSWYgbm90IHNwZWNpZmllZCwgdGhlIHRpbWUgc2hpZnQgY29ycmVzcG9uZHMgdG8gdGhlIHRpbWVTcGFuIHBhcmFtZXRlciwgcmVzdWx0aW5nIGluIG5vbi1vdmVybGFwcGluZyBhZGphY2VudCBidWZmZXJzLlxuXHQgICAqIEBwYXJhbSB7U2NoZWR1bGVyfSBbc2NoZWR1bGVyXSAgU2NoZWR1bGVyIHRvIHJ1biBidWZmZXIgdGltZXJzIG9uLiBJZiBub3Qgc3BlY2lmaWVkLCB0aGUgdGltZW91dCBzY2hlZHVsZXIgaXMgdXNlZC5cblx0ICAgKiBAcmV0dXJucyB7T2JzZXJ2YWJsZX0gQW4gb2JzZXJ2YWJsZSBzZXF1ZW5jZSBvZiBidWZmZXJzLlxuXHQgICAqL1xuXHQgIG9ic2VydmFibGVQcm90by5idWZmZXJXaXRoVGltZSA9IGZ1bmN0aW9uICh0aW1lU3BhbiwgdGltZVNoaWZ0T3JTY2hlZHVsZXIsIHNjaGVkdWxlcikge1xuXHQgICAgcmV0dXJuIHRoaXMud2luZG93V2l0aFRpbWUodGltZVNwYW4sIHRpbWVTaGlmdE9yU2NoZWR1bGVyLCBzY2hlZHVsZXIpLmZsYXRNYXAodG9BcnJheSk7XG5cdCAgfTtcblx0XG5cdCAgZnVuY3Rpb24gdG9BcnJheSh4KSB7IHJldHVybiB4LnRvQXJyYXkoKTsgfVxuXHRcblx0ICAvKipcblx0ICAgKiAgUHJvamVjdHMgZWFjaCBlbGVtZW50IG9mIGFuIG9ic2VydmFibGUgc2VxdWVuY2UgaW50byBhIGJ1ZmZlciB0aGF0IGlzIGNvbXBsZXRlZCB3aGVuIGVpdGhlciBpdCdzIGZ1bGwgb3IgYSBnaXZlbiBhbW91bnQgb2YgdGltZSBoYXMgZWxhcHNlZC5cblx0ICAgKiBAcGFyYW0ge051bWJlcn0gdGltZVNwYW4gTWF4aW11bSB0aW1lIGxlbmd0aCBvZiBhIGJ1ZmZlci5cblx0ICAgKiBAcGFyYW0ge051bWJlcn0gY291bnQgTWF4aW11bSBlbGVtZW50IGNvdW50IG9mIGEgYnVmZmVyLlxuXHQgICAqIEBwYXJhbSB7U2NoZWR1bGVyfSBbc2NoZWR1bGVyXSAgU2NoZWR1bGVyIHRvIHJ1biBidWZmZXJpbiB0aW1lcnMgb24uIElmIG5vdCBzcGVjaWZpZWQsIHRoZSB0aW1lb3V0IHNjaGVkdWxlciBpcyB1c2VkLlxuXHQgICAqIEByZXR1cm5zIHtPYnNlcnZhYmxlfSBBbiBvYnNlcnZhYmxlIHNlcXVlbmNlIG9mIGJ1ZmZlcnMuXG5cdCAgICovXG5cdCAgb2JzZXJ2YWJsZVByb3RvLmJ1ZmZlcldpdGhUaW1lT3JDb3VudCA9IGZ1bmN0aW9uICh0aW1lU3BhbiwgY291bnQsIHNjaGVkdWxlcikge1xuXHQgICAgcmV0dXJuIHRoaXMud2luZG93V2l0aFRpbWVPckNvdW50KHRpbWVTcGFuLCBjb3VudCwgc2NoZWR1bGVyKS5mbGF0TWFwKHRvQXJyYXkpO1xuXHQgIH07XG5cdFxuXHQgIHZhciBUaW1lSW50ZXJ2YWxPYnNlcnZhYmxlID0gKGZ1bmN0aW9uIChfX3N1cGVyX18pIHtcblx0ICAgIGluaGVyaXRzKFRpbWVJbnRlcnZhbE9ic2VydmFibGUsIF9fc3VwZXJfXyk7XG5cdCAgICBmdW5jdGlvbiBUaW1lSW50ZXJ2YWxPYnNlcnZhYmxlKHNvdXJjZSwgcykge1xuXHQgICAgICB0aGlzLnNvdXJjZSA9IHNvdXJjZTtcblx0ICAgICAgdGhpcy5fcyA9IHM7XG5cdCAgICAgIF9fc3VwZXJfXy5jYWxsKHRoaXMpO1xuXHQgICAgfVxuXHRcblx0ICAgIFRpbWVJbnRlcnZhbE9ic2VydmFibGUucHJvdG90eXBlLnN1YnNjcmliZUNvcmUgPSBmdW5jdGlvbiAobykge1xuXHQgICAgICByZXR1cm4gdGhpcy5zb3VyY2Uuc3Vic2NyaWJlKG5ldyBUaW1lSW50ZXJ2YWxPYnNlcnZlcihvLCB0aGlzLl9zKSk7XG5cdCAgICB9O1xuXHRcblx0ICAgIHJldHVybiBUaW1lSW50ZXJ2YWxPYnNlcnZhYmxlO1xuXHQgIH0oT2JzZXJ2YWJsZUJhc2UpKTtcblx0XG5cdCAgdmFyIFRpbWVJbnRlcnZhbE9ic2VydmVyID0gKGZ1bmN0aW9uIChfX3N1cGVyX18pIHtcblx0ICAgIGluaGVyaXRzKFRpbWVJbnRlcnZhbE9ic2VydmVyLCBfX3N1cGVyX18pO1xuXHRcblx0ICAgIGZ1bmN0aW9uIFRpbWVJbnRlcnZhbE9ic2VydmVyKG8sIHMpIHtcblx0ICAgICAgdGhpcy5fbyA9IG87XG5cdCAgICAgIHRoaXMuX3MgPSBzO1xuXHQgICAgICB0aGlzLl9sID0gcy5ub3coKTtcblx0ICAgICAgX19zdXBlcl9fLmNhbGwodGhpcyk7XG5cdCAgICB9XG5cdFxuXHQgICAgVGltZUludGVydmFsT2JzZXJ2ZXIucHJvdG90eXBlLm5leHQgPSBmdW5jdGlvbiAoeCkge1xuXHQgICAgICB2YXIgbm93ID0gdGhpcy5fcy5ub3coKSwgc3BhbiA9IG5vdyAtIHRoaXMuX2w7XG5cdCAgICAgIHRoaXMuX2wgPSBub3c7XG5cdCAgICAgIHRoaXMuX28ub25OZXh0KHsgdmFsdWU6IHgsIGludGVydmFsOiBzcGFuIH0pO1xuXHQgICAgfTtcblx0ICAgIFRpbWVJbnRlcnZhbE9ic2VydmVyLnByb3RvdHlwZS5lcnJvciA9IGZ1bmN0aW9uIChlKSB7IHRoaXMuX28ub25FcnJvcihlKTsgfTtcblx0ICAgIFRpbWVJbnRlcnZhbE9ic2VydmVyLnByb3RvdHlwZS5jb21wbGV0ZWQgPSBmdW5jdGlvbiAoKSB7IHRoaXMuX28ub25Db21wbGV0ZWQoKTsgfTtcblx0XG5cdCAgICByZXR1cm4gVGltZUludGVydmFsT2JzZXJ2ZXI7XG5cdCAgfShBYnN0cmFjdE9ic2VydmVyKSk7XG5cdFxuXHQgIC8qKlxuXHQgICAqICBSZWNvcmRzIHRoZSB0aW1lIGludGVydmFsIGJldHdlZW4gY29uc2VjdXRpdmUgdmFsdWVzIGluIGFuIG9ic2VydmFibGUgc2VxdWVuY2UuXG5cdCAgICpcblx0ICAgKiBAZXhhbXBsZVxuXHQgICAqICAxIC0gcmVzID0gc291cmNlLnRpbWVJbnRlcnZhbCgpO1xuXHQgICAqICAyIC0gcmVzID0gc291cmNlLnRpbWVJbnRlcnZhbChSeC5TY2hlZHVsZXIudGltZW91dCk7XG5cdCAgICpcblx0ICAgKiBAcGFyYW0gW3NjaGVkdWxlcl0gIFNjaGVkdWxlciB1c2VkIHRvIGNvbXB1dGUgdGltZSBpbnRlcnZhbHMuIElmIG5vdCBzcGVjaWZpZWQsIHRoZSB0aW1lb3V0IHNjaGVkdWxlciBpcyB1c2VkLlxuXHQgICAqIEByZXR1cm5zIHtPYnNlcnZhYmxlfSBBbiBvYnNlcnZhYmxlIHNlcXVlbmNlIHdpdGggdGltZSBpbnRlcnZhbCBpbmZvcm1hdGlvbiBvbiB2YWx1ZXMuXG5cdCAgICovXG5cdCAgb2JzZXJ2YWJsZVByb3RvLnRpbWVJbnRlcnZhbCA9IGZ1bmN0aW9uIChzY2hlZHVsZXIpIHtcblx0ICAgIGlzU2NoZWR1bGVyKHNjaGVkdWxlcikgfHwgKHNjaGVkdWxlciA9IGRlZmF1bHRTY2hlZHVsZXIpO1xuXHQgICAgcmV0dXJuIG5ldyBUaW1lSW50ZXJ2YWxPYnNlcnZhYmxlKHRoaXMsIHNjaGVkdWxlcik7XG5cdCAgfTtcblx0XG5cdCAgdmFyIFRpbWVzdGFtcE9ic2VydmFibGUgPSAoZnVuY3Rpb24gKF9fc3VwZXJfXykge1xuXHQgICAgaW5oZXJpdHMoVGltZXN0YW1wT2JzZXJ2YWJsZSwgX19zdXBlcl9fKTtcblx0ICAgIGZ1bmN0aW9uIFRpbWVzdGFtcE9ic2VydmFibGUoc291cmNlLCBzKSB7XG5cdCAgICAgIHRoaXMuc291cmNlID0gc291cmNlO1xuXHQgICAgICB0aGlzLl9zID0gcztcblx0ICAgICAgX19zdXBlcl9fLmNhbGwodGhpcyk7XG5cdCAgICB9XG5cdFxuXHQgICAgVGltZXN0YW1wT2JzZXJ2YWJsZS5wcm90b3R5cGUuc3Vic2NyaWJlQ29yZSA9IGZ1bmN0aW9uIChvKSB7XG5cdCAgICAgIHJldHVybiB0aGlzLnNvdXJjZS5zdWJzY3JpYmUobmV3IFRpbWVzdGFtcE9ic2VydmVyKG8sIHRoaXMuX3MpKTtcblx0ICAgIH07XG5cdFxuXHQgICAgcmV0dXJuIFRpbWVzdGFtcE9ic2VydmFibGU7XG5cdCAgfShPYnNlcnZhYmxlQmFzZSkpO1xuXHRcblx0ICB2YXIgVGltZXN0YW1wT2JzZXJ2ZXIgPSAoZnVuY3Rpb24gKF9fc3VwZXJfXykge1xuXHQgICAgaW5oZXJpdHMoVGltZXN0YW1wT2JzZXJ2ZXIsIF9fc3VwZXJfXyk7XG5cdCAgICBmdW5jdGlvbiBUaW1lc3RhbXBPYnNlcnZlcihvLCBzKSB7XG5cdCAgICAgIHRoaXMuX28gPSBvO1xuXHQgICAgICB0aGlzLl9zID0gcztcblx0ICAgICAgX19zdXBlcl9fLmNhbGwodGhpcyk7XG5cdCAgICB9XG5cdFxuXHQgICAgVGltZXN0YW1wT2JzZXJ2ZXIucHJvdG90eXBlLm5leHQgPSBmdW5jdGlvbiAoeCkge1xuXHQgICAgICB0aGlzLl9vLm9uTmV4dCh7IHZhbHVlOiB4LCB0aW1lc3RhbXA6IHRoaXMuX3Mubm93KCkgfSk7XG5cdCAgICB9O1xuXHRcblx0ICAgIFRpbWVzdGFtcE9ic2VydmVyLnByb3RvdHlwZS5lcnJvciA9IGZ1bmN0aW9uIChlKSB7XG5cdCAgICAgIHRoaXMuX28ub25FcnJvcihlKTtcblx0ICAgIH07XG5cdFxuXHQgICAgVGltZXN0YW1wT2JzZXJ2ZXIucHJvdG90eXBlLmNvbXBsZXRlZCA9IGZ1bmN0aW9uICgpIHtcblx0ICAgICAgdGhpcy5fby5vbkNvbXBsZXRlZCgpO1xuXHQgICAgfTtcblx0XG5cdCAgICByZXR1cm4gVGltZXN0YW1wT2JzZXJ2ZXI7XG5cdCAgfShBYnN0cmFjdE9ic2VydmVyKSk7XG5cdFxuXHQgIC8qKlxuXHQgICAqICBSZWNvcmRzIHRoZSB0aW1lc3RhbXAgZm9yIGVhY2ggdmFsdWUgaW4gYW4gb2JzZXJ2YWJsZSBzZXF1ZW5jZS5cblx0ICAgKlxuXHQgICAqIEBleGFtcGxlXG5cdCAgICogIDEgLSByZXMgPSBzb3VyY2UudGltZXN0YW1wKCk7IC8vIHByb2R1Y2VzIHsgdmFsdWU6IHgsIHRpbWVzdGFtcDogdHMgfVxuXHQgICAqICAyIC0gcmVzID0gc291cmNlLnRpbWVzdGFtcChSeC5TY2hlZHVsZXIuZGVmYXVsdCk7XG5cdCAgICpcblx0ICAgKiBAcGFyYW0ge1NjaGVkdWxlcn0gW3NjaGVkdWxlcl0gIFNjaGVkdWxlciB1c2VkIHRvIGNvbXB1dGUgdGltZXN0YW1wcy4gSWYgbm90IHNwZWNpZmllZCwgdGhlIGRlZmF1bHQgc2NoZWR1bGVyIGlzIHVzZWQuXG5cdCAgICogQHJldHVybnMge09ic2VydmFibGV9IEFuIG9ic2VydmFibGUgc2VxdWVuY2Ugd2l0aCB0aW1lc3RhbXAgaW5mb3JtYXRpb24gb24gdmFsdWVzLlxuXHQgICAqL1xuXHQgIG9ic2VydmFibGVQcm90by50aW1lc3RhbXAgPSBmdW5jdGlvbiAoc2NoZWR1bGVyKSB7XG5cdCAgICBpc1NjaGVkdWxlcihzY2hlZHVsZXIpIHx8IChzY2hlZHVsZXIgPSBkZWZhdWx0U2NoZWR1bGVyKTtcblx0ICAgIHJldHVybiBuZXcgVGltZXN0YW1wT2JzZXJ2YWJsZSh0aGlzLCBzY2hlZHVsZXIpO1xuXHQgIH07XG5cdFxuXHQgIGZ1bmN0aW9uIHNhbXBsZU9ic2VydmFibGUoc291cmNlLCBzYW1wbGVyKSB7XG5cdCAgICByZXR1cm4gbmV3IEFub255bW91c09ic2VydmFibGUoZnVuY3Rpb24gKG8pIHtcblx0ICAgICAgdmFyIGF0RW5kID0gZmFsc2UsIHZhbHVlLCBoYXNWYWx1ZSA9IGZhbHNlO1xuXHRcblx0ICAgICAgZnVuY3Rpb24gc2FtcGxlU3Vic2NyaWJlKCkge1xuXHQgICAgICAgIGlmIChoYXNWYWx1ZSkge1xuXHQgICAgICAgICAgaGFzVmFsdWUgPSBmYWxzZTtcblx0ICAgICAgICAgIG8ub25OZXh0KHZhbHVlKTtcblx0ICAgICAgICB9XG5cdCAgICAgICAgYXRFbmQgJiYgby5vbkNvbXBsZXRlZCgpO1xuXHQgICAgICB9XG5cdFxuXHQgICAgICB2YXIgc291cmNlU3Vic2NyaXB0aW9uID0gbmV3IFNpbmdsZUFzc2lnbm1lbnREaXNwb3NhYmxlKCk7XG5cdCAgICAgIHNvdXJjZVN1YnNjcmlwdGlvbi5zZXREaXNwb3NhYmxlKHNvdXJjZS5zdWJzY3JpYmUoXG5cdCAgICAgICAgZnVuY3Rpb24gKG5ld1ZhbHVlKSB7XG5cdCAgICAgICAgICBoYXNWYWx1ZSA9IHRydWU7XG5cdCAgICAgICAgICB2YWx1ZSA9IG5ld1ZhbHVlO1xuXHQgICAgICAgIH0sXG5cdCAgICAgICAgZnVuY3Rpb24gKGUpIHsgby5vbkVycm9yKGUpOyB9LFxuXHQgICAgICAgIGZ1bmN0aW9uICgpIHtcblx0ICAgICAgICAgIGF0RW5kID0gdHJ1ZTtcblx0ICAgICAgICAgIHNvdXJjZVN1YnNjcmlwdGlvbi5kaXNwb3NlKCk7XG5cdCAgICAgICAgfVxuXHQgICAgICApKTtcblx0XG5cdCAgICAgIHJldHVybiBuZXcgQmluYXJ5RGlzcG9zYWJsZShcblx0ICAgICAgICBzb3VyY2VTdWJzY3JpcHRpb24sXG5cdCAgICAgICAgc2FtcGxlci5zdWJzY3JpYmUoc2FtcGxlU3Vic2NyaWJlLCBmdW5jdGlvbiAoZSkgeyBvLm9uRXJyb3IoZSk7IH0sIHNhbXBsZVN1YnNjcmliZSlcblx0ICAgICAgKTtcblx0ICAgIH0sIHNvdXJjZSk7XG5cdCAgfVxuXHRcblx0ICAvKipcblx0ICAgKiAgU2FtcGxlcyB0aGUgb2JzZXJ2YWJsZSBzZXF1ZW5jZSBhdCBlYWNoIGludGVydmFsLlxuXHQgICAqXG5cdCAgICogQGV4YW1wbGVcblx0ICAgKiAgMSAtIHJlcyA9IHNvdXJjZS5zYW1wbGUoc2FtcGxlT2JzZXJ2YWJsZSk7IC8vIFNhbXBsZXIgdGljayBzZXF1ZW5jZVxuXHQgICAqICAyIC0gcmVzID0gc291cmNlLnNhbXBsZSg1MDAwKTsgLy8gNSBzZWNvbmRzXG5cdCAgICogIDIgLSByZXMgPSBzb3VyY2Uuc2FtcGxlKDUwMDAsIFJ4LlNjaGVkdWxlci50aW1lb3V0KTsgLy8gNSBzZWNvbmRzXG5cdCAgICpcblx0ICAgKiBAcGFyYW0ge01peGVkfSBpbnRlcnZhbE9yU2FtcGxlciBJbnRlcnZhbCBhdCB3aGljaCB0byBzYW1wbGUgKHNwZWNpZmllZCBhcyBhbiBpbnRlZ2VyIGRlbm90aW5nIG1pbGxpc2Vjb25kcykgb3IgU2FtcGxlciBPYnNlcnZhYmxlLlxuXHQgICAqIEBwYXJhbSB7U2NoZWR1bGVyfSBbc2NoZWR1bGVyXSAgU2NoZWR1bGVyIHRvIHJ1biB0aGUgc2FtcGxpbmcgdGltZXIgb24uIElmIG5vdCBzcGVjaWZpZWQsIHRoZSB0aW1lb3V0IHNjaGVkdWxlciBpcyB1c2VkLlxuXHQgICAqIEByZXR1cm5zIHtPYnNlcnZhYmxlfSBTYW1wbGVkIG9ic2VydmFibGUgc2VxdWVuY2UuXG5cdCAgICovXG5cdCAgb2JzZXJ2YWJsZVByb3RvLnNhbXBsZSA9IG9ic2VydmFibGVQcm90by50aHJvdHRsZUxhdGVzdCA9IGZ1bmN0aW9uIChpbnRlcnZhbE9yU2FtcGxlciwgc2NoZWR1bGVyKSB7XG5cdCAgICBpc1NjaGVkdWxlcihzY2hlZHVsZXIpIHx8IChzY2hlZHVsZXIgPSBkZWZhdWx0U2NoZWR1bGVyKTtcblx0ICAgIHJldHVybiB0eXBlb2YgaW50ZXJ2YWxPclNhbXBsZXIgPT09ICdudW1iZXInID9cblx0ICAgICAgc2FtcGxlT2JzZXJ2YWJsZSh0aGlzLCBvYnNlcnZhYmxlaW50ZXJ2YWwoaW50ZXJ2YWxPclNhbXBsZXIsIHNjaGVkdWxlcikpIDpcblx0ICAgICAgc2FtcGxlT2JzZXJ2YWJsZSh0aGlzLCBpbnRlcnZhbE9yU2FtcGxlcik7XG5cdCAgfTtcblx0XG5cdCAgdmFyIFRpbWVvdXRFcnJvciA9IFJ4LlRpbWVvdXRFcnJvciA9IGZ1bmN0aW9uKG1lc3NhZ2UpIHtcblx0ICAgIHRoaXMubWVzc2FnZSA9IG1lc3NhZ2UgfHwgJ1RpbWVvdXQgaGFzIG9jY3VycmVkJztcblx0ICAgIHRoaXMubmFtZSA9ICdUaW1lb3V0RXJyb3InO1xuXHQgICAgRXJyb3IuY2FsbCh0aGlzKTtcblx0ICB9O1xuXHQgIFRpbWVvdXRFcnJvci5wcm90b3R5cGUgPSBPYmplY3QuY3JlYXRlKEVycm9yLnByb3RvdHlwZSk7XG5cdFxuXHQgIGZ1bmN0aW9uIHRpbWVvdXRXaXRoU2VsZWN0b3Ioc291cmNlLCBmaXJzdFRpbWVvdXQsIHRpbWVvdXREdXJhdGlvblNlbGVjdG9yLCBvdGhlcikge1xuXHQgICAgaWYgKGlzRnVuY3Rpb24oZmlyc3RUaW1lb3V0KSkge1xuXHQgICAgICBvdGhlciA9IHRpbWVvdXREdXJhdGlvblNlbGVjdG9yO1xuXHQgICAgICB0aW1lb3V0RHVyYXRpb25TZWxlY3RvciA9IGZpcnN0VGltZW91dDtcblx0ICAgICAgZmlyc3RUaW1lb3V0ID0gb2JzZXJ2YWJsZU5ldmVyKCk7XG5cdCAgICB9XG5cdCAgICBvdGhlciB8fCAob3RoZXIgPSBvYnNlcnZhYmxlVGhyb3cobmV3IFRpbWVvdXRFcnJvcigpKSk7XG5cdCAgICByZXR1cm4gbmV3IEFub255bW91c09ic2VydmFibGUoZnVuY3Rpb24gKG8pIHtcblx0ICAgICAgdmFyIHN1YnNjcmlwdGlvbiA9IG5ldyBTZXJpYWxEaXNwb3NhYmxlKCksXG5cdCAgICAgICAgdGltZXIgPSBuZXcgU2VyaWFsRGlzcG9zYWJsZSgpLFxuXHQgICAgICAgIG9yaWdpbmFsID0gbmV3IFNpbmdsZUFzc2lnbm1lbnREaXNwb3NhYmxlKCk7XG5cdFxuXHQgICAgICBzdWJzY3JpcHRpb24uc2V0RGlzcG9zYWJsZShvcmlnaW5hbCk7XG5cdFxuXHQgICAgICB2YXIgaWQgPSAwLCBzd2l0Y2hlZCA9IGZhbHNlO1xuXHRcblx0ICAgICAgZnVuY3Rpb24gc2V0VGltZXIodGltZW91dCkge1xuXHQgICAgICAgIHZhciBteUlkID0gaWQsIGQgPSBuZXcgU2luZ2xlQXNzaWdubWVudERpc3Bvc2FibGUoKTtcblx0XG5cdCAgICAgICAgZnVuY3Rpb24gdGltZXJXaW5zKCkge1xuXHQgICAgICAgICAgc3dpdGNoZWQgPSAobXlJZCA9PT0gaWQpO1xuXHQgICAgICAgICAgcmV0dXJuIHN3aXRjaGVkO1xuXHQgICAgICAgIH1cblx0XG5cdCAgICAgICAgdGltZXIuc2V0RGlzcG9zYWJsZShkKTtcblx0ICAgICAgICBkLnNldERpc3Bvc2FibGUodGltZW91dC5zdWJzY3JpYmUoZnVuY3Rpb24gKCkge1xuXHQgICAgICAgICAgdGltZXJXaW5zKCkgJiYgc3Vic2NyaXB0aW9uLnNldERpc3Bvc2FibGUob3RoZXIuc3Vic2NyaWJlKG8pKTtcblx0ICAgICAgICAgIGQuZGlzcG9zZSgpO1xuXHQgICAgICAgIH0sIGZ1bmN0aW9uIChlKSB7XG5cdCAgICAgICAgICB0aW1lcldpbnMoKSAmJiBvLm9uRXJyb3IoZSk7XG5cdCAgICAgICAgfSwgZnVuY3Rpb24gKCkge1xuXHQgICAgICAgICAgdGltZXJXaW5zKCkgJiYgc3Vic2NyaXB0aW9uLnNldERpc3Bvc2FibGUob3RoZXIuc3Vic2NyaWJlKG8pKTtcblx0ICAgICAgICB9KSk7XG5cdCAgICAgIH07XG5cdFxuXHQgICAgICBzZXRUaW1lcihmaXJzdFRpbWVvdXQpO1xuXHRcblx0ICAgICAgZnVuY3Rpb24gb1dpbnMoKSB7XG5cdCAgICAgICAgdmFyIHJlcyA9ICFzd2l0Y2hlZDtcblx0ICAgICAgICBpZiAocmVzKSB7IGlkKys7IH1cblx0ICAgICAgICByZXR1cm4gcmVzO1xuXHQgICAgICB9XG5cdFxuXHQgICAgICBvcmlnaW5hbC5zZXREaXNwb3NhYmxlKHNvdXJjZS5zdWJzY3JpYmUoZnVuY3Rpb24gKHgpIHtcblx0ICAgICAgICBpZiAob1dpbnMoKSkge1xuXHQgICAgICAgICAgby5vbk5leHQoeCk7XG5cdCAgICAgICAgICB2YXIgdGltZW91dCA9IHRyeUNhdGNoKHRpbWVvdXREdXJhdGlvblNlbGVjdG9yKSh4KTtcblx0ICAgICAgICAgIGlmICh0aW1lb3V0ID09PSBlcnJvck9iaikgeyByZXR1cm4gby5vbkVycm9yKHRpbWVvdXQuZSk7IH1cblx0ICAgICAgICAgIHNldFRpbWVyKGlzUHJvbWlzZSh0aW1lb3V0KSA/IG9ic2VydmFibGVGcm9tUHJvbWlzZSh0aW1lb3V0KSA6IHRpbWVvdXQpO1xuXHQgICAgICAgIH1cblx0ICAgICAgfSwgZnVuY3Rpb24gKGUpIHtcblx0ICAgICAgICBvV2lucygpICYmIG8ub25FcnJvcihlKTtcblx0ICAgICAgfSwgZnVuY3Rpb24gKCkge1xuXHQgICAgICAgIG9XaW5zKCkgJiYgby5vbkNvbXBsZXRlZCgpO1xuXHQgICAgICB9KSk7XG5cdCAgICAgIHJldHVybiBuZXcgQmluYXJ5RGlzcG9zYWJsZShzdWJzY3JpcHRpb24sIHRpbWVyKTtcblx0ICAgIH0sIHNvdXJjZSk7XG5cdCAgfVxuXHRcblx0ICBmdW5jdGlvbiB0aW1lb3V0KHNvdXJjZSwgZHVlVGltZSwgb3RoZXIsIHNjaGVkdWxlcikge1xuXHQgICAgaWYgKGlzU2NoZWR1bGVyKG90aGVyKSkge1xuXHQgICAgICBzY2hlZHVsZXIgPSBvdGhlcjtcblx0ICAgICAgb3RoZXIgPSBvYnNlcnZhYmxlVGhyb3cobmV3IFRpbWVvdXRFcnJvcigpKTtcblx0ICAgIH1cblx0ICAgIGlmIChvdGhlciBpbnN0YW5jZW9mIEVycm9yKSB7IG90aGVyID0gb2JzZXJ2YWJsZVRocm93KG90aGVyKTsgfVxuXHQgICAgaXNTY2hlZHVsZXIoc2NoZWR1bGVyKSB8fCAoc2NoZWR1bGVyID0gZGVmYXVsdFNjaGVkdWxlcik7XG5cdFxuXHQgICAgcmV0dXJuIG5ldyBBbm9ueW1vdXNPYnNlcnZhYmxlKGZ1bmN0aW9uIChvKSB7XG5cdCAgICAgIHZhciBpZCA9IDAsXG5cdCAgICAgICAgb3JpZ2luYWwgPSBuZXcgU2luZ2xlQXNzaWdubWVudERpc3Bvc2FibGUoKSxcblx0ICAgICAgICBzdWJzY3JpcHRpb24gPSBuZXcgU2VyaWFsRGlzcG9zYWJsZSgpLFxuXHQgICAgICAgIHN3aXRjaGVkID0gZmFsc2UsXG5cdCAgICAgICAgdGltZXIgPSBuZXcgU2VyaWFsRGlzcG9zYWJsZSgpO1xuXHRcblx0ICAgICAgc3Vic2NyaXB0aW9uLnNldERpc3Bvc2FibGUob3JpZ2luYWwpO1xuXHRcblx0ICAgICAgZnVuY3Rpb24gY3JlYXRlVGltZXIoKSB7XG5cdCAgICAgICAgdmFyIG15SWQgPSBpZDtcblx0ICAgICAgICB0aW1lci5zZXREaXNwb3NhYmxlKHNjaGVkdWxlci5zY2hlZHVsZUZ1dHVyZShudWxsLCBkdWVUaW1lLCBmdW5jdGlvbiAoKSB7XG5cdCAgICAgICAgICBzd2l0Y2hlZCA9IGlkID09PSBteUlkO1xuXHQgICAgICAgICAgaWYgKHN3aXRjaGVkKSB7XG5cdCAgICAgICAgICAgIGlzUHJvbWlzZShvdGhlcikgJiYgKG90aGVyID0gb2JzZXJ2YWJsZUZyb21Qcm9taXNlKG90aGVyKSk7XG5cdCAgICAgICAgICAgIHN1YnNjcmlwdGlvbi5zZXREaXNwb3NhYmxlKG90aGVyLnN1YnNjcmliZShvKSk7XG5cdCAgICAgICAgICB9XG5cdCAgICAgICAgfSkpO1xuXHQgICAgICB9XG5cdFxuXHQgICAgICBjcmVhdGVUaW1lcigpO1xuXHRcblx0ICAgICAgb3JpZ2luYWwuc2V0RGlzcG9zYWJsZShzb3VyY2Uuc3Vic2NyaWJlKGZ1bmN0aW9uICh4KSB7XG5cdCAgICAgICAgaWYgKCFzd2l0Y2hlZCkge1xuXHQgICAgICAgICAgaWQrKztcblx0ICAgICAgICAgIG8ub25OZXh0KHgpO1xuXHQgICAgICAgICAgY3JlYXRlVGltZXIoKTtcblx0ICAgICAgICB9XG5cdCAgICAgIH0sIGZ1bmN0aW9uIChlKSB7XG5cdCAgICAgICAgaWYgKCFzd2l0Y2hlZCkge1xuXHQgICAgICAgICAgaWQrKztcblx0ICAgICAgICAgIG8ub25FcnJvcihlKTtcblx0ICAgICAgICB9XG5cdCAgICAgIH0sIGZ1bmN0aW9uICgpIHtcblx0ICAgICAgICBpZiAoIXN3aXRjaGVkKSB7XG5cdCAgICAgICAgICBpZCsrO1xuXHQgICAgICAgICAgby5vbkNvbXBsZXRlZCgpO1xuXHQgICAgICAgIH1cblx0ICAgICAgfSkpO1xuXHQgICAgICByZXR1cm4gbmV3IEJpbmFyeURpc3Bvc2FibGUoc3Vic2NyaXB0aW9uLCB0aW1lcik7XG5cdCAgICB9LCBzb3VyY2UpO1xuXHQgIH1cblx0XG5cdCAgb2JzZXJ2YWJsZVByb3RvLnRpbWVvdXQgPSBmdW5jdGlvbiAoKSB7XG5cdCAgICB2YXIgZmlyc3RBcmcgPSBhcmd1bWVudHNbMF07XG5cdCAgICBpZiAoZmlyc3RBcmcgaW5zdGFuY2VvZiBEYXRlIHx8IHR5cGVvZiBmaXJzdEFyZyA9PT0gJ251bWJlcicpIHtcblx0ICAgICAgcmV0dXJuIHRpbWVvdXQodGhpcywgZmlyc3RBcmcsIGFyZ3VtZW50c1sxXSwgYXJndW1lbnRzWzJdKTtcblx0ICAgIH0gZWxzZSBpZiAoT2JzZXJ2YWJsZS5pc09ic2VydmFibGUoZmlyc3RBcmcpIHx8IGlzRnVuY3Rpb24oZmlyc3RBcmcpKSB7XG5cdCAgICAgIHJldHVybiB0aW1lb3V0V2l0aFNlbGVjdG9yKHRoaXMsIGZpcnN0QXJnLCBhcmd1bWVudHNbMV0sIGFyZ3VtZW50c1syXSk7XG5cdCAgICB9IGVsc2Uge1xuXHQgICAgICB0aHJvdyBuZXcgRXJyb3IoJ0ludmFsaWQgYXJndW1lbnRzJyk7XG5cdCAgICB9XG5cdCAgfTtcblx0XG5cdCAgdmFyIEdlbmVyYXRlQWJzb2x1dGVPYnNlcnZhYmxlID0gKGZ1bmN0aW9uIChfX3N1cGVyX18pIHtcblx0ICAgIGluaGVyaXRzKEdlbmVyYXRlQWJzb2x1dGVPYnNlcnZhYmxlLCBfX3N1cGVyX18pO1xuXHQgICAgZnVuY3Rpb24gR2VuZXJhdGVBYnNvbHV0ZU9ic2VydmFibGUoc3RhdGUsIGNuZEZuLCBpdHJGbiwgcmVzRm4sIHRpbWVGbiwgcykge1xuXHQgICAgICB0aGlzLl9zdGF0ZSA9IHN0YXRlO1xuXHQgICAgICB0aGlzLl9jbmRGbiA9IGNuZEZuO1xuXHQgICAgICB0aGlzLl9pdHJGbiA9IGl0ckZuO1xuXHQgICAgICB0aGlzLl9yZXNGbiA9IHJlc0ZuO1xuXHQgICAgICB0aGlzLl90aW1lRm4gPSB0aW1lRm47XG5cdCAgICAgIHRoaXMuX3MgPSBzO1xuXHQgICAgICB0aGlzLl9maXJzdCA9IHRydWU7XG5cdCAgICAgIHRoaXMuX2hhc1Jlc3VsdCA9IGZhbHNlO1xuXHQgICAgICBfX3N1cGVyX18uY2FsbCh0aGlzKTtcblx0ICAgIH1cblx0XG5cdCAgICBmdW5jdGlvbiBzY2hlZHVsZVJlY3Vyc2l2ZShzZWxmLCByZWN1cnNlKSB7XG5cdCAgICAgIHNlbGYuX2hhc1Jlc3VsdCAmJiBzZWxmLl9vLm9uTmV4dChzZWxmLl9zdGF0ZSk7XG5cdFxuXHQgICAgICBpZiAoc2VsZi5fZmlyc3QpIHtcblx0ICAgICAgICBzZWxmLl9maXJzdCA9IGZhbHNlO1xuXHQgICAgICB9IGVsc2Uge1xuXHQgICAgICAgIHNlbGYuX3N0YXRlID0gdHJ5Q2F0Y2goc2VsZi5faXRyRm4pKHNlbGYuX3N0YXRlKTtcblx0ICAgICAgICBpZiAoc2VsZi5fc3RhdGUgPT09IGVycm9yT2JqKSB7IHJldHVybiBzZWxmLl9vLm9uRXJyb3Ioc2VsZi5fc3RhdGUuZSk7IH1cblx0ICAgICAgfVxuXHQgICAgICBzZWxmLl9oYXNSZXN1bHQgPSB0cnlDYXRjaChzZWxmLl9jbmRGbikoc2VsZi5fc3RhdGUpO1xuXHQgICAgICBpZiAoc2VsZi5faGFzUmVzdWx0ID09PSBlcnJvck9iaikgeyByZXR1cm4gc2VsZi5fby5vbkVycm9yKHNlbGYuX2hhc1Jlc3VsdC5lKTsgfVxuXHQgICAgICBpZiAoc2VsZi5faGFzUmVzdWx0KSB7XG5cdCAgICAgICAgdmFyIHJlc3VsdCA9IHRyeUNhdGNoKHNlbGYuX3Jlc0ZuKShzZWxmLl9zdGF0ZSk7XG5cdCAgICAgICAgaWYgKHJlc3VsdCA9PT0gZXJyb3JPYmopIHsgcmV0dXJuIHNlbGYuX28ub25FcnJvcihyZXN1bHQuZSk7IH1cblx0ICAgICAgICB2YXIgdGltZSA9IHRyeUNhdGNoKHNlbGYuX3RpbWVGbikoc2VsZi5fc3RhdGUpO1xuXHQgICAgICAgIGlmICh0aW1lID09PSBlcnJvck9iaikgeyByZXR1cm4gc2VsZi5fby5vbkVycm9yKHRpbWUuZSk7IH1cblx0ICAgICAgICByZWN1cnNlKHNlbGYsIHRpbWUpO1xuXHQgICAgICB9IGVsc2Uge1xuXHQgICAgICAgIHNlbGYuX28ub25Db21wbGV0ZWQoKTtcblx0ICAgICAgfVxuXHQgICAgfVxuXHRcblx0ICAgIEdlbmVyYXRlQWJzb2x1dGVPYnNlcnZhYmxlLnByb3RvdHlwZS5zdWJzY3JpYmVDb3JlID0gZnVuY3Rpb24gKG8pIHtcblx0ICAgICAgdGhpcy5fbyA9IG87XG5cdCAgICAgIHJldHVybiB0aGlzLl9zLnNjaGVkdWxlUmVjdXJzaXZlRnV0dXJlKHRoaXMsIG5ldyBEYXRlKHRoaXMuX3Mubm93KCkpLCBzY2hlZHVsZVJlY3Vyc2l2ZSk7XG5cdCAgICB9O1xuXHRcblx0ICAgIHJldHVybiBHZW5lcmF0ZUFic29sdXRlT2JzZXJ2YWJsZTtcblx0ICB9KE9ic2VydmFibGVCYXNlKSk7XG5cdFxuXHQgIC8qKlxuXHQgICAqICBHZW5lcmF0ZUFic29sdXRlcyBhbiBvYnNlcnZhYmxlIHNlcXVlbmNlIGJ5IGl0ZXJhdGluZyBhIHN0YXRlIGZyb20gYW4gaW5pdGlhbCBzdGF0ZSB1bnRpbCB0aGUgY29uZGl0aW9uIGZhaWxzLlxuXHQgICAqXG5cdCAgICogQGV4YW1wbGVcblx0ICAgKiAgcmVzID0gc291cmNlLmdlbmVyYXRlV2l0aEFic29sdXRlVGltZSgwLFxuXHQgICAqICAgICAgZnVuY3Rpb24gKHgpIHsgcmV0dXJuIHJldHVybiB0cnVlOyB9LFxuXHQgICAqICAgICAgZnVuY3Rpb24gKHgpIHsgcmV0dXJuIHggKyAxOyB9LFxuXHQgICAqICAgICAgZnVuY3Rpb24gKHgpIHsgcmV0dXJuIHg7IH0sXG5cdCAgICogICAgICBmdW5jdGlvbiAoeCkgeyByZXR1cm4gbmV3IERhdGUoKTsgfVxuXHQgICAqICB9KTtcblx0ICAgKlxuXHQgICAqIEBwYXJhbSB7TWl4ZWR9IGluaXRpYWxTdGF0ZSBJbml0aWFsIHN0YXRlLlxuXHQgICAqIEBwYXJhbSB7RnVuY3Rpb259IGNvbmRpdGlvbiBDb25kaXRpb24gdG8gdGVybWluYXRlIGdlbmVyYXRpb24gKHVwb24gcmV0dXJuaW5nIGZhbHNlKS5cblx0ICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBpdGVyYXRlIEl0ZXJhdGlvbiBzdGVwIGZ1bmN0aW9uLlxuXHQgICAqIEBwYXJhbSB7RnVuY3Rpb259IHJlc3VsdFNlbGVjdG9yIFNlbGVjdG9yIGZ1bmN0aW9uIGZvciByZXN1bHRzIHByb2R1Y2VkIGluIHRoZSBzZXF1ZW5jZS5cblx0ICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSB0aW1lU2VsZWN0b3IgVGltZSBzZWxlY3RvciBmdW5jdGlvbiB0byBjb250cm9sIHRoZSBzcGVlZCBvZiB2YWx1ZXMgYmVpbmcgcHJvZHVjZWQgZWFjaCBpdGVyYXRpb24sIHJldHVybmluZyBEYXRlIHZhbHVlcy5cblx0ICAgKiBAcGFyYW0ge1NjaGVkdWxlcn0gW3NjaGVkdWxlcl0gIFNjaGVkdWxlciBvbiB3aGljaCB0byBydW4gdGhlIGdlbmVyYXRvciBsb29wLiBJZiBub3Qgc3BlY2lmaWVkLCB0aGUgdGltZW91dCBzY2hlZHVsZXIgaXMgdXNlZC5cblx0ICAgKiBAcmV0dXJucyB7T2JzZXJ2YWJsZX0gVGhlIGdlbmVyYXRlZCBzZXF1ZW5jZS5cblx0ICAgKi9cblx0ICBPYnNlcnZhYmxlLmdlbmVyYXRlV2l0aEFic29sdXRlVGltZSA9IGZ1bmN0aW9uIChpbml0aWFsU3RhdGUsIGNvbmRpdGlvbiwgaXRlcmF0ZSwgcmVzdWx0U2VsZWN0b3IsIHRpbWVTZWxlY3Rvciwgc2NoZWR1bGVyKSB7XG5cdCAgICBpc1NjaGVkdWxlcihzY2hlZHVsZXIpIHx8IChzY2hlZHVsZXIgPSBkZWZhdWx0U2NoZWR1bGVyKTtcblx0ICAgIHJldHVybiBuZXcgR2VuZXJhdGVBYnNvbHV0ZU9ic2VydmFibGUoaW5pdGlhbFN0YXRlLCBjb25kaXRpb24sIGl0ZXJhdGUsIHJlc3VsdFNlbGVjdG9yLCB0aW1lU2VsZWN0b3IsIHNjaGVkdWxlcik7XG5cdCAgfTtcblx0XG5cdCAgdmFyIEdlbmVyYXRlUmVsYXRpdmVPYnNlcnZhYmxlID0gKGZ1bmN0aW9uIChfX3N1cGVyX18pIHtcblx0ICAgIGluaGVyaXRzKEdlbmVyYXRlUmVsYXRpdmVPYnNlcnZhYmxlLCBfX3N1cGVyX18pO1xuXHQgICAgZnVuY3Rpb24gR2VuZXJhdGVSZWxhdGl2ZU9ic2VydmFibGUoc3RhdGUsIGNuZEZuLCBpdHJGbiwgcmVzRm4sIHRpbWVGbiwgcykge1xuXHQgICAgICB0aGlzLl9zdGF0ZSA9IHN0YXRlO1xuXHQgICAgICB0aGlzLl9jbmRGbiA9IGNuZEZuO1xuXHQgICAgICB0aGlzLl9pdHJGbiA9IGl0ckZuO1xuXHQgICAgICB0aGlzLl9yZXNGbiA9IHJlc0ZuO1xuXHQgICAgICB0aGlzLl90aW1lRm4gPSB0aW1lRm47XG5cdCAgICAgIHRoaXMuX3MgPSBzO1xuXHQgICAgICB0aGlzLl9maXJzdCA9IHRydWU7XG5cdCAgICAgIHRoaXMuX2hhc1Jlc3VsdCA9IGZhbHNlO1xuXHQgICAgICBfX3N1cGVyX18uY2FsbCh0aGlzKTtcblx0ICAgIH1cblx0XG5cdCAgICBmdW5jdGlvbiBzY2hlZHVsZVJlY3Vyc2l2ZShzZWxmLCByZWN1cnNlKSB7XG5cdCAgICAgIHNlbGYuX2hhc1Jlc3VsdCAmJiBzZWxmLl9vLm9uTmV4dChzZWxmLl9zdGF0ZSk7XG5cdFxuXHQgICAgICBpZiAoc2VsZi5fZmlyc3QpIHtcblx0ICAgICAgICBzZWxmLl9maXJzdCA9IGZhbHNlO1xuXHQgICAgICB9IGVsc2Uge1xuXHQgICAgICAgIHNlbGYuX3N0YXRlID0gdHJ5Q2F0Y2goc2VsZi5faXRyRm4pKHNlbGYuX3N0YXRlKTtcblx0ICAgICAgICBpZiAoc2VsZi5fc3RhdGUgPT09IGVycm9yT2JqKSB7IHJldHVybiBzZWxmLl9vLm9uRXJyb3Ioc2VsZi5fc3RhdGUuZSk7IH1cblx0ICAgICAgfVxuXHQgICAgICBzZWxmLl9oYXNSZXN1bHQgPSB0cnlDYXRjaChzZWxmLl9jbmRGbikoc2VsZi5fc3RhdGUpO1xuXHQgICAgICBpZiAoc2VsZi5faGFzUmVzdWx0ID09PSBlcnJvck9iaikgeyByZXR1cm4gc2VsZi5fby5vbkVycm9yKHNlbGYuX2hhc1Jlc3VsdC5lKTsgfVxuXHQgICAgICBpZiAoc2VsZi5faGFzUmVzdWx0KSB7XG5cdCAgICAgICAgdmFyIHJlc3VsdCA9IHRyeUNhdGNoKHNlbGYuX3Jlc0ZuKShzZWxmLl9zdGF0ZSk7XG5cdCAgICAgICAgaWYgKHJlc3VsdCA9PT0gZXJyb3JPYmopIHsgcmV0dXJuIHNlbGYuX28ub25FcnJvcihyZXN1bHQuZSk7IH1cblx0ICAgICAgICB2YXIgdGltZSA9IHRyeUNhdGNoKHNlbGYuX3RpbWVGbikoc2VsZi5fc3RhdGUpO1xuXHQgICAgICAgIGlmICh0aW1lID09PSBlcnJvck9iaikgeyByZXR1cm4gc2VsZi5fby5vbkVycm9yKHRpbWUuZSk7IH1cblx0ICAgICAgICByZWN1cnNlKHNlbGYsIHRpbWUpO1xuXHQgICAgICB9IGVsc2Uge1xuXHQgICAgICAgIHNlbGYuX28ub25Db21wbGV0ZWQoKTtcblx0ICAgICAgfVxuXHQgICAgfVxuXHRcblx0ICAgIEdlbmVyYXRlUmVsYXRpdmVPYnNlcnZhYmxlLnByb3RvdHlwZS5zdWJzY3JpYmVDb3JlID0gZnVuY3Rpb24gKG8pIHtcblx0ICAgICAgdGhpcy5fbyA9IG87XG5cdCAgICAgIHJldHVybiB0aGlzLl9zLnNjaGVkdWxlUmVjdXJzaXZlRnV0dXJlKHRoaXMsIDAsIHNjaGVkdWxlUmVjdXJzaXZlKTtcblx0ICAgIH07XG5cdFxuXHQgICAgcmV0dXJuIEdlbmVyYXRlUmVsYXRpdmVPYnNlcnZhYmxlO1xuXHQgIH0oT2JzZXJ2YWJsZUJhc2UpKTtcblx0XG5cdCAgLyoqXG5cdCAgICogIEdlbmVyYXRlcyBhbiBvYnNlcnZhYmxlIHNlcXVlbmNlIGJ5IGl0ZXJhdGluZyBhIHN0YXRlIGZyb20gYW4gaW5pdGlhbCBzdGF0ZSB1bnRpbCB0aGUgY29uZGl0aW9uIGZhaWxzLlxuXHQgICAqXG5cdCAgICogQGV4YW1wbGVcblx0ICAgKiAgcmVzID0gc291cmNlLmdlbmVyYXRlV2l0aFJlbGF0aXZlVGltZSgwLFxuXHQgICAqICAgICAgZnVuY3Rpb24gKHgpIHsgcmV0dXJuIHJldHVybiB0cnVlOyB9LFxuXHQgICAqICAgICAgZnVuY3Rpb24gKHgpIHsgcmV0dXJuIHggKyAxOyB9LFxuXHQgICAqICAgICAgZnVuY3Rpb24gKHgpIHsgcmV0dXJuIHg7IH0sXG5cdCAgICogICAgICBmdW5jdGlvbiAoeCkgeyByZXR1cm4gNTAwOyB9XG5cdCAgICogICk7XG5cdCAgICpcblx0ICAgKiBAcGFyYW0ge01peGVkfSBpbml0aWFsU3RhdGUgSW5pdGlhbCBzdGF0ZS5cblx0ICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBjb25kaXRpb24gQ29uZGl0aW9uIHRvIHRlcm1pbmF0ZSBnZW5lcmF0aW9uICh1cG9uIHJldHVybmluZyBmYWxzZSkuXG5cdCAgICogQHBhcmFtIHtGdW5jdGlvbn0gaXRlcmF0ZSBJdGVyYXRpb24gc3RlcCBmdW5jdGlvbi5cblx0ICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSByZXN1bHRTZWxlY3RvciBTZWxlY3RvciBmdW5jdGlvbiBmb3IgcmVzdWx0cyBwcm9kdWNlZCBpbiB0aGUgc2VxdWVuY2UuXG5cdCAgICogQHBhcmFtIHtGdW5jdGlvbn0gdGltZVNlbGVjdG9yIFRpbWUgc2VsZWN0b3IgZnVuY3Rpb24gdG8gY29udHJvbCB0aGUgc3BlZWQgb2YgdmFsdWVzIGJlaW5nIHByb2R1Y2VkIGVhY2ggaXRlcmF0aW9uLCByZXR1cm5pbmcgaW50ZWdlciB2YWx1ZXMgZGVub3RpbmcgbWlsbGlzZWNvbmRzLlxuXHQgICAqIEBwYXJhbSB7U2NoZWR1bGVyfSBbc2NoZWR1bGVyXSAgU2NoZWR1bGVyIG9uIHdoaWNoIHRvIHJ1biB0aGUgZ2VuZXJhdG9yIGxvb3AuIElmIG5vdCBzcGVjaWZpZWQsIHRoZSB0aW1lb3V0IHNjaGVkdWxlciBpcyB1c2VkLlxuXHQgICAqIEByZXR1cm5zIHtPYnNlcnZhYmxlfSBUaGUgZ2VuZXJhdGVkIHNlcXVlbmNlLlxuXHQgICAqL1xuXHQgIE9ic2VydmFibGUuZ2VuZXJhdGVXaXRoUmVsYXRpdmVUaW1lID0gZnVuY3Rpb24gKGluaXRpYWxTdGF0ZSwgY29uZGl0aW9uLCBpdGVyYXRlLCByZXN1bHRTZWxlY3RvciwgdGltZVNlbGVjdG9yLCBzY2hlZHVsZXIpIHtcblx0ICAgIGlzU2NoZWR1bGVyKHNjaGVkdWxlcikgfHwgKHNjaGVkdWxlciA9IGRlZmF1bHRTY2hlZHVsZXIpO1xuXHQgICAgcmV0dXJuIG5ldyBHZW5lcmF0ZVJlbGF0aXZlT2JzZXJ2YWJsZShpbml0aWFsU3RhdGUsIGNvbmRpdGlvbiwgaXRlcmF0ZSwgcmVzdWx0U2VsZWN0b3IsIHRpbWVTZWxlY3Rvciwgc2NoZWR1bGVyKTtcblx0ICB9O1xuXHRcblx0ICB2YXIgRGVsYXlTdWJzY3JpcHRpb24gPSAoZnVuY3Rpb24oX19zdXBlcl9fKSB7XG5cdCAgICBpbmhlcml0cyhEZWxheVN1YnNjcmlwdGlvbiwgX19zdXBlcl9fKTtcblx0ICAgIGZ1bmN0aW9uIERlbGF5U3Vic2NyaXB0aW9uKHNvdXJjZSwgZHQsIHMpIHtcblx0ICAgICAgdGhpcy5zb3VyY2UgPSBzb3VyY2U7XG5cdCAgICAgIHRoaXMuX2R0ID0gZHQ7XG5cdCAgICAgIHRoaXMuX3MgPSBzO1xuXHQgICAgICBfX3N1cGVyX18uY2FsbCh0aGlzKTtcblx0ICAgIH1cblx0XG5cdCAgICBEZWxheVN1YnNjcmlwdGlvbi5wcm90b3R5cGUuc3Vic2NyaWJlQ29yZSA9IGZ1bmN0aW9uIChvKSB7XG5cdCAgICAgIHZhciBkID0gbmV3IFNlcmlhbERpc3Bvc2FibGUoKTtcblx0XG5cdCAgICAgIGQuc2V0RGlzcG9zYWJsZSh0aGlzLl9zLnNjaGVkdWxlRnV0dXJlKFt0aGlzLnNvdXJjZSwgbywgZF0sIHRoaXMuX2R0LCBzY2hlZHVsZU1ldGhvZCkpO1xuXHRcblx0ICAgICAgcmV0dXJuIGQ7XG5cdCAgICB9O1xuXHRcblx0ICAgIGZ1bmN0aW9uIHNjaGVkdWxlTWV0aG9kKHMsIHN0YXRlKSB7XG5cdCAgICAgIHZhciBzb3VyY2UgPSBzdGF0ZVswXSwgbyA9IHN0YXRlWzFdLCBkID0gc3RhdGVbMl07XG5cdCAgICAgIGQuc2V0RGlzcG9zYWJsZShzb3VyY2Uuc3Vic2NyaWJlKG8pKTtcblx0ICAgIH1cblx0XG5cdCAgICByZXR1cm4gRGVsYXlTdWJzY3JpcHRpb247XG5cdCAgfShPYnNlcnZhYmxlQmFzZSkpO1xuXHRcblx0ICAvKipcblx0ICAgKiAgVGltZSBzaGlmdHMgdGhlIG9ic2VydmFibGUgc2VxdWVuY2UgYnkgZGVsYXlpbmcgdGhlIHN1YnNjcmlwdGlvbiB3aXRoIHRoZSBzcGVjaWZpZWQgcmVsYXRpdmUgdGltZSBkdXJhdGlvbiwgdXNpbmcgdGhlIHNwZWNpZmllZCBzY2hlZHVsZXIgdG8gcnVuIHRpbWVycy5cblx0ICAgKlxuXHQgICAqIEBleGFtcGxlXG5cdCAgICogIDEgLSByZXMgPSBzb3VyY2UuZGVsYXlTdWJzY3JpcHRpb24oNTAwMCk7IC8vIDVzXG5cdCAgICogIDIgLSByZXMgPSBzb3VyY2UuZGVsYXlTdWJzY3JpcHRpb24oNTAwMCwgUnguU2NoZWR1bGVyLmRlZmF1bHQpOyAvLyA1IHNlY29uZHNcblx0ICAgKlxuXHQgICAqIEBwYXJhbSB7TnVtYmVyfSBkdWVUaW1lIFJlbGF0aXZlIG9yIGFic29sdXRlIHRpbWUgc2hpZnQgb2YgdGhlIHN1YnNjcmlwdGlvbi5cblx0ICAgKiBAcGFyYW0ge1NjaGVkdWxlcn0gW3NjaGVkdWxlcl0gIFNjaGVkdWxlciB0byBydW4gdGhlIHN1YnNjcmlwdGlvbiBkZWxheSB0aW1lciBvbi4gSWYgbm90IHNwZWNpZmllZCwgdGhlIHRpbWVvdXQgc2NoZWR1bGVyIGlzIHVzZWQuXG5cdCAgICogQHJldHVybnMge09ic2VydmFibGV9IFRpbWUtc2hpZnRlZCBzZXF1ZW5jZS5cblx0ICAgKi9cblx0ICBvYnNlcnZhYmxlUHJvdG8uZGVsYXlTdWJzY3JpcHRpb24gPSBmdW5jdGlvbiAoZHVlVGltZSwgc2NoZWR1bGVyKSB7XG5cdCAgICBpc1NjaGVkdWxlcihzY2hlZHVsZXIpIHx8IChzY2hlZHVsZXIgPSBkZWZhdWx0U2NoZWR1bGVyKTtcblx0ICAgIHJldHVybiBuZXcgRGVsYXlTdWJzY3JpcHRpb24odGhpcywgZHVlVGltZSwgc2NoZWR1bGVyKTtcblx0ICB9O1xuXHRcblx0ICB2YXIgU2tpcExhc3RXaXRoVGltZU9ic2VydmFibGUgPSAoZnVuY3Rpb24gKF9fc3VwZXJfXykge1xuXHQgICAgaW5oZXJpdHMoU2tpcExhc3RXaXRoVGltZU9ic2VydmFibGUsIF9fc3VwZXJfXyk7XG5cdCAgICBmdW5jdGlvbiBTa2lwTGFzdFdpdGhUaW1lT2JzZXJ2YWJsZShzb3VyY2UsIGQsIHMpIHtcblx0ICAgICAgdGhpcy5zb3VyY2UgPSBzb3VyY2U7XG5cdCAgICAgIHRoaXMuX2QgPSBkO1xuXHQgICAgICB0aGlzLl9zID0gcztcblx0ICAgICAgX19zdXBlcl9fLmNhbGwodGhpcyk7XG5cdCAgICB9XG5cdFxuXHQgICAgU2tpcExhc3RXaXRoVGltZU9ic2VydmFibGUucHJvdG90eXBlLnN1YnNjcmliZUNvcmUgPSBmdW5jdGlvbiAobykge1xuXHQgICAgICByZXR1cm4gdGhpcy5zb3VyY2Uuc3Vic2NyaWJlKG5ldyBTa2lwTGFzdFdpdGhUaW1lT2JzZXJ2ZXIobywgdGhpcykpO1xuXHQgICAgfTtcblx0XG5cdCAgICByZXR1cm4gU2tpcExhc3RXaXRoVGltZU9ic2VydmFibGU7XG5cdCAgfShPYnNlcnZhYmxlQmFzZSkpO1xuXHRcblx0ICB2YXIgU2tpcExhc3RXaXRoVGltZU9ic2VydmVyID0gKGZ1bmN0aW9uIChfX3N1cGVyX18pIHtcblx0ICAgIGluaGVyaXRzKFNraXBMYXN0V2l0aFRpbWVPYnNlcnZlciwgX19zdXBlcl9fKTtcblx0XG5cdCAgICBmdW5jdGlvbiBTa2lwTGFzdFdpdGhUaW1lT2JzZXJ2ZXIobywgcCkge1xuXHQgICAgICB0aGlzLl9vID0gbztcblx0ICAgICAgdGhpcy5fcyA9IHAuX3M7XG5cdCAgICAgIHRoaXMuX2QgPSBwLl9kO1xuXHQgICAgICB0aGlzLl9xID0gW107XG5cdCAgICAgIF9fc3VwZXJfXy5jYWxsKHRoaXMpO1xuXHQgICAgfVxuXHRcblx0ICAgIFNraXBMYXN0V2l0aFRpbWVPYnNlcnZlci5wcm90b3R5cGUubmV4dCA9IGZ1bmN0aW9uICh4KSB7XG5cdCAgICAgIHZhciBub3cgPSB0aGlzLl9zLm5vdygpO1xuXHQgICAgICB0aGlzLl9xLnB1c2goeyBpbnRlcnZhbDogbm93LCB2YWx1ZTogeCB9KTtcblx0ICAgICAgd2hpbGUgKHRoaXMuX3EubGVuZ3RoID4gMCAmJiBub3cgLSB0aGlzLl9xWzBdLmludGVydmFsID49IHRoaXMuX2QpIHtcblx0ICAgICAgICB0aGlzLl9vLm9uTmV4dCh0aGlzLl9xLnNoaWZ0KCkudmFsdWUpO1xuXHQgICAgICB9XG5cdCAgICB9O1xuXHQgICAgU2tpcExhc3RXaXRoVGltZU9ic2VydmVyLnByb3RvdHlwZS5lcnJvciA9IGZ1bmN0aW9uIChlKSB7IHRoaXMuX28ub25FcnJvcihlKTsgfTtcblx0ICAgIFNraXBMYXN0V2l0aFRpbWVPYnNlcnZlci5wcm90b3R5cGUuY29tcGxldGVkID0gZnVuY3Rpb24gKCkge1xuXHQgICAgICB2YXIgbm93ID0gdGhpcy5fcy5ub3coKTtcblx0ICAgICAgd2hpbGUgKHRoaXMuX3EubGVuZ3RoID4gMCAmJiBub3cgLSB0aGlzLl9xWzBdLmludGVydmFsID49IHRoaXMuX2QpIHtcblx0ICAgICAgICB0aGlzLl9vLm9uTmV4dCh0aGlzLl9xLnNoaWZ0KCkudmFsdWUpO1xuXHQgICAgICB9XG5cdCAgICAgIHRoaXMuX28ub25Db21wbGV0ZWQoKTtcblx0ICAgIH07XG5cdFxuXHQgICAgcmV0dXJuIFNraXBMYXN0V2l0aFRpbWVPYnNlcnZlcjtcblx0ICB9KEFic3RyYWN0T2JzZXJ2ZXIpKTtcblx0XG5cdCAgLyoqXG5cdCAgICogIFNraXBzIGVsZW1lbnRzIGZvciB0aGUgc3BlY2lmaWVkIGR1cmF0aW9uIGZyb20gdGhlIGVuZCBvZiB0aGUgb2JzZXJ2YWJsZSBzb3VyY2Ugc2VxdWVuY2UsIHVzaW5nIHRoZSBzcGVjaWZpZWQgc2NoZWR1bGVyIHRvIHJ1biB0aW1lcnMuXG5cdCAgICogQGRlc2NyaXB0aW9uXG5cdCAgICogIFRoaXMgb3BlcmF0b3IgYWNjdW11bGF0ZXMgYSBxdWV1ZSB3aXRoIGEgbGVuZ3RoIGVub3VnaCB0byBzdG9yZSBlbGVtZW50cyByZWNlaXZlZCBkdXJpbmcgdGhlIGluaXRpYWwgZHVyYXRpb24gd2luZG93LlxuXHQgICAqICBBcyBtb3JlIGVsZW1lbnRzIGFyZSByZWNlaXZlZCwgZWxlbWVudHMgb2xkZXIgdGhhbiB0aGUgc3BlY2lmaWVkIGR1cmF0aW9uIGFyZSB0YWtlbiBmcm9tIHRoZSBxdWV1ZSBhbmQgcHJvZHVjZWQgb24gdGhlXG5cdCAgICogIHJlc3VsdCBzZXF1ZW5jZS4gVGhpcyBjYXVzZXMgZWxlbWVudHMgdG8gYmUgZGVsYXllZCB3aXRoIGR1cmF0aW9uLlxuXHQgICAqIEBwYXJhbSB7TnVtYmVyfSBkdXJhdGlvbiBEdXJhdGlvbiBmb3Igc2tpcHBpbmcgZWxlbWVudHMgZnJvbSB0aGUgZW5kIG9mIHRoZSBzZXF1ZW5jZS5cblx0ICAgKiBAcGFyYW0ge1NjaGVkdWxlcn0gW3NjaGVkdWxlcl0gIFNjaGVkdWxlciB0byBydW4gdGhlIHRpbWVyIG9uLiBJZiBub3Qgc3BlY2lmaWVkLCBkZWZhdWx0cyB0byBSeC5TY2hlZHVsZXIudGltZW91dFxuXHQgICAqIEByZXR1cm5zIHtPYnNlcnZhYmxlfSBBbiBvYnNlcnZhYmxlIHNlcXVlbmNlIHdpdGggdGhlIGVsZW1lbnRzIHNraXBwZWQgZHVyaW5nIHRoZSBzcGVjaWZpZWQgZHVyYXRpb24gZnJvbSB0aGUgZW5kIG9mIHRoZSBzb3VyY2Ugc2VxdWVuY2UuXG5cdCAgICovXG5cdCAgb2JzZXJ2YWJsZVByb3RvLnNraXBMYXN0V2l0aFRpbWUgPSBmdW5jdGlvbiAoZHVyYXRpb24sIHNjaGVkdWxlcikge1xuXHQgICAgaXNTY2hlZHVsZXIoc2NoZWR1bGVyKSB8fCAoc2NoZWR1bGVyID0gZGVmYXVsdFNjaGVkdWxlcik7XG5cdCAgICByZXR1cm4gbmV3IFNraXBMYXN0V2l0aFRpbWVPYnNlcnZhYmxlKHRoaXMsIGR1cmF0aW9uLCBzY2hlZHVsZXIpO1xuXHQgIH07XG5cdFxuXHQgIHZhciBUYWtlTGFzdFdpdGhUaW1lT2JzZXJ2YWJsZSA9IChmdW5jdGlvbiAoX19zdXBlcl9fKSB7XG5cdCAgICBpbmhlcml0cyhUYWtlTGFzdFdpdGhUaW1lT2JzZXJ2YWJsZSwgX19zdXBlcl9fKTtcblx0ICAgIGZ1bmN0aW9uIFRha2VMYXN0V2l0aFRpbWVPYnNlcnZhYmxlKHNvdXJjZSwgZCwgcykge1xuXHQgICAgICB0aGlzLnNvdXJjZSA9IHNvdXJjZTtcblx0ICAgICAgdGhpcy5fZCA9IGQ7XG5cdCAgICAgIHRoaXMuX3MgPSBzO1xuXHQgICAgICBfX3N1cGVyX18uY2FsbCh0aGlzKTtcblx0ICAgIH1cblx0XG5cdCAgICBUYWtlTGFzdFdpdGhUaW1lT2JzZXJ2YWJsZS5wcm90b3R5cGUuc3Vic2NyaWJlQ29yZSA9IGZ1bmN0aW9uIChvKSB7XG5cdCAgICAgIHJldHVybiB0aGlzLnNvdXJjZS5zdWJzY3JpYmUobmV3IFRha2VMYXN0V2l0aFRpbWVPYnNlcnZlcihvLCB0aGlzLl9kLCB0aGlzLl9zKSk7XG5cdCAgICB9O1xuXHRcblx0ICAgIHJldHVybiBUYWtlTGFzdFdpdGhUaW1lT2JzZXJ2YWJsZTtcblx0ICB9KE9ic2VydmFibGVCYXNlKSk7XG5cdFxuXHQgIHZhciBUYWtlTGFzdFdpdGhUaW1lT2JzZXJ2ZXIgPSAoZnVuY3Rpb24gKF9fc3VwZXJfXykge1xuXHQgICAgaW5oZXJpdHMoVGFrZUxhc3RXaXRoVGltZU9ic2VydmVyLCBfX3N1cGVyX18pO1xuXHRcblx0ICAgIGZ1bmN0aW9uIFRha2VMYXN0V2l0aFRpbWVPYnNlcnZlcihvLCBkLCBzKSB7XG5cdCAgICAgIHRoaXMuX28gPSBvO1xuXHQgICAgICB0aGlzLl9kID0gZDtcblx0ICAgICAgdGhpcy5fcyA9IHM7XG5cdCAgICAgIHRoaXMuX3EgPSBbXTtcblx0ICAgICAgX19zdXBlcl9fLmNhbGwodGhpcyk7XG5cdCAgICB9XG5cdFxuXHQgICAgVGFrZUxhc3RXaXRoVGltZU9ic2VydmVyLnByb3RvdHlwZS5uZXh0ID0gZnVuY3Rpb24gKHgpIHtcblx0ICAgICAgdmFyIG5vdyA9IHRoaXMuX3Mubm93KCk7XG5cdCAgICAgIHRoaXMuX3EucHVzaCh7IGludGVydmFsOiBub3csIHZhbHVlOiB4IH0pO1xuXHQgICAgICB3aGlsZSAodGhpcy5fcS5sZW5ndGggPiAwICYmIG5vdyAtIHRoaXMuX3FbMF0uaW50ZXJ2YWwgPj0gdGhpcy5fZCkge1xuXHQgICAgICAgIHRoaXMuX3Euc2hpZnQoKTtcblx0ICAgICAgfVxuXHQgICAgfTtcblx0ICAgIFRha2VMYXN0V2l0aFRpbWVPYnNlcnZlci5wcm90b3R5cGUuZXJyb3IgPSBmdW5jdGlvbiAoZSkgeyB0aGlzLl9vLm9uRXJyb3IoZSk7IH07XG5cdCAgICBUYWtlTGFzdFdpdGhUaW1lT2JzZXJ2ZXIucHJvdG90eXBlLmNvbXBsZXRlZCA9IGZ1bmN0aW9uICgpIHtcblx0ICAgICAgdmFyIG5vdyA9IHRoaXMuX3Mubm93KCk7XG5cdCAgICAgIHdoaWxlICh0aGlzLl9xLmxlbmd0aCA+IDApIHtcblx0ICAgICAgICB2YXIgbmV4dCA9IHRoaXMuX3Euc2hpZnQoKTtcblx0ICAgICAgICBpZiAobm93IC0gbmV4dC5pbnRlcnZhbCA8PSB0aGlzLl9kKSB7IHRoaXMuX28ub25OZXh0KG5leHQudmFsdWUpOyB9XG5cdCAgICAgIH1cblx0ICAgICAgdGhpcy5fby5vbkNvbXBsZXRlZCgpO1xuXHQgICAgfTtcblx0XG5cdCAgICByZXR1cm4gVGFrZUxhc3RXaXRoVGltZU9ic2VydmVyO1xuXHQgIH0oQWJzdHJhY3RPYnNlcnZlcikpO1xuXHRcblx0ICAvKipcblx0ICAgKiAgUmV0dXJucyBlbGVtZW50cyB3aXRoaW4gdGhlIHNwZWNpZmllZCBkdXJhdGlvbiBmcm9tIHRoZSBlbmQgb2YgdGhlIG9ic2VydmFibGUgc291cmNlIHNlcXVlbmNlLCB1c2luZyB0aGUgc3BlY2lmaWVkIHNjaGVkdWxlcnMgdG8gcnVuIHRpbWVycyBhbmQgdG8gZHJhaW4gdGhlIGNvbGxlY3RlZCBlbGVtZW50cy5cblx0ICAgKiBAZGVzY3JpcHRpb25cblx0ICAgKiAgVGhpcyBvcGVyYXRvciBhY2N1bXVsYXRlcyBhIHF1ZXVlIHdpdGggYSBsZW5ndGggZW5vdWdoIHRvIHN0b3JlIGVsZW1lbnRzIHJlY2VpdmVkIGR1cmluZyB0aGUgaW5pdGlhbCBkdXJhdGlvbiB3aW5kb3cuXG5cdCAgICogIEFzIG1vcmUgZWxlbWVudHMgYXJlIHJlY2VpdmVkLCBlbGVtZW50cyBvbGRlciB0aGFuIHRoZSBzcGVjaWZpZWQgZHVyYXRpb24gYXJlIHRha2VuIGZyb20gdGhlIHF1ZXVlIGFuZCBwcm9kdWNlZCBvbiB0aGVcblx0ICAgKiAgcmVzdWx0IHNlcXVlbmNlLiBUaGlzIGNhdXNlcyBlbGVtZW50cyB0byBiZSBkZWxheWVkIHdpdGggZHVyYXRpb24uXG5cdCAgICogQHBhcmFtIHtOdW1iZXJ9IGR1cmF0aW9uIER1cmF0aW9uIGZvciB0YWtpbmcgZWxlbWVudHMgZnJvbSB0aGUgZW5kIG9mIHRoZSBzZXF1ZW5jZS5cblx0ICAgKiBAcGFyYW0ge1NjaGVkdWxlcn0gW3NjaGVkdWxlcl0gIFNjaGVkdWxlciB0byBydW4gdGhlIHRpbWVyIG9uLiBJZiBub3Qgc3BlY2lmaWVkLCBkZWZhdWx0cyB0byBSeC5TY2hlZHVsZXIudGltZW91dC5cblx0ICAgKiBAcmV0dXJucyB7T2JzZXJ2YWJsZX0gQW4gb2JzZXJ2YWJsZSBzZXF1ZW5jZSB3aXRoIHRoZSBlbGVtZW50cyB0YWtlbiBkdXJpbmcgdGhlIHNwZWNpZmllZCBkdXJhdGlvbiBmcm9tIHRoZSBlbmQgb2YgdGhlIHNvdXJjZSBzZXF1ZW5jZS5cblx0ICAgKi9cblx0ICBvYnNlcnZhYmxlUHJvdG8udGFrZUxhc3RXaXRoVGltZSA9IGZ1bmN0aW9uIChkdXJhdGlvbiwgc2NoZWR1bGVyKSB7XG5cdCAgICBpc1NjaGVkdWxlcihzY2hlZHVsZXIpIHx8IChzY2hlZHVsZXIgPSBkZWZhdWx0U2NoZWR1bGVyKTtcblx0ICAgIHJldHVybiBuZXcgVGFrZUxhc3RXaXRoVGltZU9ic2VydmFibGUodGhpcywgZHVyYXRpb24sIHNjaGVkdWxlcik7XG5cdCAgfTtcblx0XG5cdCAgLyoqXG5cdCAgICogIFJldHVybnMgYW4gYXJyYXkgd2l0aCB0aGUgZWxlbWVudHMgd2l0aGluIHRoZSBzcGVjaWZpZWQgZHVyYXRpb24gZnJvbSB0aGUgZW5kIG9mIHRoZSBvYnNlcnZhYmxlIHNvdXJjZSBzZXF1ZW5jZSwgdXNpbmcgdGhlIHNwZWNpZmllZCBzY2hlZHVsZXIgdG8gcnVuIHRpbWVycy5cblx0ICAgKiBAZGVzY3JpcHRpb25cblx0ICAgKiAgVGhpcyBvcGVyYXRvciBhY2N1bXVsYXRlcyBhIHF1ZXVlIHdpdGggYSBsZW5ndGggZW5vdWdoIHRvIHN0b3JlIGVsZW1lbnRzIHJlY2VpdmVkIGR1cmluZyB0aGUgaW5pdGlhbCBkdXJhdGlvbiB3aW5kb3cuXG5cdCAgICogIEFzIG1vcmUgZWxlbWVudHMgYXJlIHJlY2VpdmVkLCBlbGVtZW50cyBvbGRlciB0aGFuIHRoZSBzcGVjaWZpZWQgZHVyYXRpb24gYXJlIHRha2VuIGZyb20gdGhlIHF1ZXVlIGFuZCBwcm9kdWNlZCBvbiB0aGVcblx0ICAgKiAgcmVzdWx0IHNlcXVlbmNlLiBUaGlzIGNhdXNlcyBlbGVtZW50cyB0byBiZSBkZWxheWVkIHdpdGggZHVyYXRpb24uXG5cdCAgICogQHBhcmFtIHtOdW1iZXJ9IGR1cmF0aW9uIER1cmF0aW9uIGZvciB0YWtpbmcgZWxlbWVudHMgZnJvbSB0aGUgZW5kIG9mIHRoZSBzZXF1ZW5jZS5cblx0ICAgKiBAcGFyYW0ge1NjaGVkdWxlcn0gc2NoZWR1bGVyIFNjaGVkdWxlciB0byBydW4gdGhlIHRpbWVyIG9uLiBJZiBub3Qgc3BlY2lmaWVkLCBkZWZhdWx0cyB0byBSeC5TY2hlZHVsZXIudGltZW91dC5cblx0ICAgKiBAcmV0dXJucyB7T2JzZXJ2YWJsZX0gQW4gb2JzZXJ2YWJsZSBzZXF1ZW5jZSBjb250YWluaW5nIGEgc2luZ2xlIGFycmF5IHdpdGggdGhlIGVsZW1lbnRzIHRha2VuIGR1cmluZyB0aGUgc3BlY2lmaWVkIGR1cmF0aW9uIGZyb20gdGhlIGVuZCBvZiB0aGUgc291cmNlIHNlcXVlbmNlLlxuXHQgICAqL1xuXHQgIG9ic2VydmFibGVQcm90by50YWtlTGFzdEJ1ZmZlcldpdGhUaW1lID0gZnVuY3Rpb24gKGR1cmF0aW9uLCBzY2hlZHVsZXIpIHtcblx0ICAgIHZhciBzb3VyY2UgPSB0aGlzO1xuXHQgICAgaXNTY2hlZHVsZXIoc2NoZWR1bGVyKSB8fCAoc2NoZWR1bGVyID0gZGVmYXVsdFNjaGVkdWxlcik7XG5cdCAgICByZXR1cm4gbmV3IEFub255bW91c09ic2VydmFibGUoZnVuY3Rpb24gKG8pIHtcblx0ICAgICAgdmFyIHEgPSBbXTtcblx0ICAgICAgcmV0dXJuIHNvdXJjZS5zdWJzY3JpYmUoZnVuY3Rpb24gKHgpIHtcblx0ICAgICAgICB2YXIgbm93ID0gc2NoZWR1bGVyLm5vdygpO1xuXHQgICAgICAgIHEucHVzaCh7IGludGVydmFsOiBub3csIHZhbHVlOiB4IH0pO1xuXHQgICAgICAgIHdoaWxlIChxLmxlbmd0aCA+IDAgJiYgbm93IC0gcVswXS5pbnRlcnZhbCA+PSBkdXJhdGlvbikge1xuXHQgICAgICAgICAgcS5zaGlmdCgpO1xuXHQgICAgICAgIH1cblx0ICAgICAgfSwgZnVuY3Rpb24gKGUpIHsgby5vbkVycm9yKGUpOyB9LCBmdW5jdGlvbiAoKSB7XG5cdCAgICAgICAgdmFyIG5vdyA9IHNjaGVkdWxlci5ub3coKSwgcmVzID0gW107XG5cdCAgICAgICAgd2hpbGUgKHEubGVuZ3RoID4gMCkge1xuXHQgICAgICAgICAgdmFyIG5leHQgPSBxLnNoaWZ0KCk7XG5cdCAgICAgICAgICBub3cgLSBuZXh0LmludGVydmFsIDw9IGR1cmF0aW9uICYmIHJlcy5wdXNoKG5leHQudmFsdWUpO1xuXHQgICAgICAgIH1cblx0ICAgICAgICBvLm9uTmV4dChyZXMpO1xuXHQgICAgICAgIG8ub25Db21wbGV0ZWQoKTtcblx0ICAgICAgfSk7XG5cdCAgICB9LCBzb3VyY2UpO1xuXHQgIH07XG5cdFxuXHQgIHZhciBUYWtlV2l0aFRpbWVPYnNlcnZhYmxlID0gKGZ1bmN0aW9uIChfX3N1cGVyX18pIHtcblx0ICAgIGluaGVyaXRzKFRha2VXaXRoVGltZU9ic2VydmFibGUsIF9fc3VwZXJfXyk7XG5cdCAgICBmdW5jdGlvbiBUYWtlV2l0aFRpbWVPYnNlcnZhYmxlKHNvdXJjZSwgZCwgcykge1xuXHQgICAgICB0aGlzLnNvdXJjZSA9IHNvdXJjZTtcblx0ICAgICAgdGhpcy5fZCA9IGQ7XG5cdCAgICAgIHRoaXMuX3MgPSBzO1xuXHQgICAgICBfX3N1cGVyX18uY2FsbCh0aGlzKTtcblx0ICAgIH1cblx0XG5cdCAgICBmdW5jdGlvbiBzY2hlZHVsZU1ldGhvZChzLCBvKSB7XG5cdCAgICAgIG8ub25Db21wbGV0ZWQoKTtcblx0ICAgIH1cblx0XG5cdCAgICBUYWtlV2l0aFRpbWVPYnNlcnZhYmxlLnByb3RvdHlwZS5zdWJzY3JpYmVDb3JlID0gZnVuY3Rpb24gKG8pIHtcblx0ICAgICAgcmV0dXJuIG5ldyBCaW5hcnlEaXNwb3NhYmxlKFxuXHQgICAgICAgIHRoaXMuX3Muc2NoZWR1bGVGdXR1cmUobywgdGhpcy5fZCwgc2NoZWR1bGVNZXRob2QpLFxuXHQgICAgICAgIHRoaXMuc291cmNlLnN1YnNjcmliZShvKVxuXHQgICAgICApO1xuXHQgICAgfTtcblx0XG5cdCAgICByZXR1cm4gVGFrZVdpdGhUaW1lT2JzZXJ2YWJsZTtcblx0ICB9KE9ic2VydmFibGVCYXNlKSk7XG5cdFxuXHQgIC8qKlxuXHQgICAqICBUYWtlcyBlbGVtZW50cyBmb3IgdGhlIHNwZWNpZmllZCBkdXJhdGlvbiBmcm9tIHRoZSBzdGFydCBvZiB0aGUgb2JzZXJ2YWJsZSBzb3VyY2Ugc2VxdWVuY2UsIHVzaW5nIHRoZSBzcGVjaWZpZWQgc2NoZWR1bGVyIHRvIHJ1biB0aW1lcnMuXG5cdCAgICpcblx0ICAgKiBAZXhhbXBsZVxuXHQgICAqICAxIC0gcmVzID0gc291cmNlLnRha2VXaXRoVGltZSg1MDAwLCAgW29wdGlvbmFsIHNjaGVkdWxlcl0pO1xuXHQgICAqIEBkZXNjcmlwdGlvblxuXHQgICAqICBUaGlzIG9wZXJhdG9yIGFjY3VtdWxhdGVzIGEgcXVldWUgd2l0aCBhIGxlbmd0aCBlbm91Z2ggdG8gc3RvcmUgZWxlbWVudHMgcmVjZWl2ZWQgZHVyaW5nIHRoZSBpbml0aWFsIGR1cmF0aW9uIHdpbmRvdy5cblx0ICAgKiAgQXMgbW9yZSBlbGVtZW50cyBhcmUgcmVjZWl2ZWQsIGVsZW1lbnRzIG9sZGVyIHRoYW4gdGhlIHNwZWNpZmllZCBkdXJhdGlvbiBhcmUgdGFrZW4gZnJvbSB0aGUgcXVldWUgYW5kIHByb2R1Y2VkIG9uIHRoZVxuXHQgICAqICByZXN1bHQgc2VxdWVuY2UuIFRoaXMgY2F1c2VzIGVsZW1lbnRzIHRvIGJlIGRlbGF5ZWQgd2l0aCBkdXJhdGlvbi5cblx0ICAgKiBAcGFyYW0ge051bWJlcn0gZHVyYXRpb24gRHVyYXRpb24gZm9yIHRha2luZyBlbGVtZW50cyBmcm9tIHRoZSBzdGFydCBvZiB0aGUgc2VxdWVuY2UuXG5cdCAgICogQHBhcmFtIHtTY2hlZHVsZXJ9IHNjaGVkdWxlciBTY2hlZHVsZXIgdG8gcnVuIHRoZSB0aW1lciBvbi4gSWYgbm90IHNwZWNpZmllZCwgZGVmYXVsdHMgdG8gUnguU2NoZWR1bGVyLnRpbWVvdXQuXG5cdCAgICogQHJldHVybnMge09ic2VydmFibGV9IEFuIG9ic2VydmFibGUgc2VxdWVuY2Ugd2l0aCB0aGUgZWxlbWVudHMgdGFrZW4gZHVyaW5nIHRoZSBzcGVjaWZpZWQgZHVyYXRpb24gZnJvbSB0aGUgc3RhcnQgb2YgdGhlIHNvdXJjZSBzZXF1ZW5jZS5cblx0ICAgKi9cblx0ICBvYnNlcnZhYmxlUHJvdG8udGFrZVdpdGhUaW1lID0gZnVuY3Rpb24gKGR1cmF0aW9uLCBzY2hlZHVsZXIpIHtcblx0ICAgIGlzU2NoZWR1bGVyKHNjaGVkdWxlcikgfHwgKHNjaGVkdWxlciA9IGRlZmF1bHRTY2hlZHVsZXIpO1xuXHQgICAgcmV0dXJuIG5ldyBUYWtlV2l0aFRpbWVPYnNlcnZhYmxlKHRoaXMsIGR1cmF0aW9uLCBzY2hlZHVsZXIpO1xuXHQgIH07XG5cdFxuXHQgIHZhciBTa2lwV2l0aFRpbWVPYnNlcnZhYmxlID0gKGZ1bmN0aW9uIChfX3N1cGVyX18pIHtcblx0ICAgIGluaGVyaXRzKFNraXBXaXRoVGltZU9ic2VydmFibGUsIF9fc3VwZXJfXyk7XG5cdCAgICBmdW5jdGlvbiBTa2lwV2l0aFRpbWVPYnNlcnZhYmxlKHNvdXJjZSwgZCwgcykge1xuXHQgICAgICB0aGlzLnNvdXJjZSA9IHNvdXJjZTtcblx0ICAgICAgdGhpcy5fZCA9IGQ7XG5cdCAgICAgIHRoaXMuX3MgPSBzO1xuXHQgICAgICB0aGlzLl9vcGVuID0gZmFsc2U7XG5cdCAgICAgIF9fc3VwZXJfXy5jYWxsKHRoaXMpO1xuXHQgICAgfVxuXHRcblx0ICAgIGZ1bmN0aW9uIHNjaGVkdWxlTWV0aG9kKHMsIHNlbGYpIHtcblx0ICAgICAgc2VsZi5fb3BlbiA9IHRydWU7XG5cdCAgICB9XG5cdFxuXHQgICAgU2tpcFdpdGhUaW1lT2JzZXJ2YWJsZS5wcm90b3R5cGUuc3Vic2NyaWJlQ29yZSA9IGZ1bmN0aW9uIChvKSB7XG5cdCAgICAgIHJldHVybiBuZXcgQmluYXJ5RGlzcG9zYWJsZShcblx0ICAgICAgICB0aGlzLl9zLnNjaGVkdWxlRnV0dXJlKHRoaXMsIHRoaXMuX2QsIHNjaGVkdWxlTWV0aG9kKSxcblx0ICAgICAgICB0aGlzLnNvdXJjZS5zdWJzY3JpYmUobmV3IFNraXBXaXRoVGltZU9ic2VydmVyKG8sIHRoaXMpKVxuXHQgICAgICApO1xuXHQgICAgfTtcblx0XG5cdCAgICByZXR1cm4gU2tpcFdpdGhUaW1lT2JzZXJ2YWJsZTtcblx0ICB9KE9ic2VydmFibGVCYXNlKSk7XG5cdFxuXHQgIHZhciBTa2lwV2l0aFRpbWVPYnNlcnZlciA9IChmdW5jdGlvbiAoX19zdXBlcl9fKSB7XG5cdCAgICBpbmhlcml0cyhTa2lwV2l0aFRpbWVPYnNlcnZlciwgX19zdXBlcl9fKTtcblx0XG5cdCAgICBmdW5jdGlvbiBTa2lwV2l0aFRpbWVPYnNlcnZlcihvLCBwKSB7XG5cdCAgICAgIHRoaXMuX28gPSBvO1xuXHQgICAgICB0aGlzLl9wID0gcDtcblx0ICAgICAgX19zdXBlcl9fLmNhbGwodGhpcyk7XG5cdCAgICB9XG5cdFxuXHQgICAgU2tpcFdpdGhUaW1lT2JzZXJ2ZXIucHJvdG90eXBlLm5leHQgPSBmdW5jdGlvbiAoeCkgeyB0aGlzLl9wLl9vcGVuICYmIHRoaXMuX28ub25OZXh0KHgpOyB9O1xuXHQgICAgU2tpcFdpdGhUaW1lT2JzZXJ2ZXIucHJvdG90eXBlLmVycm9yID0gZnVuY3Rpb24gKGUpIHsgdGhpcy5fby5vbkVycm9yKGUpOyB9O1xuXHQgICAgU2tpcFdpdGhUaW1lT2JzZXJ2ZXIucHJvdG90eXBlLmNvbXBsZXRlZCA9IGZ1bmN0aW9uICgpIHsgdGhpcy5fby5vbkNvbXBsZXRlZCgpOyB9O1xuXHRcblx0ICAgIHJldHVybiBTa2lwV2l0aFRpbWVPYnNlcnZlcjtcblx0ICB9KEFic3RyYWN0T2JzZXJ2ZXIpKTtcblx0XG5cdCAgLyoqXG5cdCAgICogIFNraXBzIGVsZW1lbnRzIGZvciB0aGUgc3BlY2lmaWVkIGR1cmF0aW9uIGZyb20gdGhlIHN0YXJ0IG9mIHRoZSBvYnNlcnZhYmxlIHNvdXJjZSBzZXF1ZW5jZSwgdXNpbmcgdGhlIHNwZWNpZmllZCBzY2hlZHVsZXIgdG8gcnVuIHRpbWVycy5cblx0ICAgKiBAZGVzY3JpcHRpb25cblx0ICAgKiAgU3BlY2lmeWluZyBhIHplcm8gdmFsdWUgZm9yIGR1cmF0aW9uIGRvZXNuJ3QgZ3VhcmFudGVlIG5vIGVsZW1lbnRzIHdpbGwgYmUgZHJvcHBlZCBmcm9tIHRoZSBzdGFydCBvZiB0aGUgc291cmNlIHNlcXVlbmNlLlxuXHQgICAqICBUaGlzIGlzIGEgc2lkZS1lZmZlY3Qgb2YgdGhlIGFzeW5jaHJvbnkgaW50cm9kdWNlZCBieSB0aGUgc2NoZWR1bGVyLCB3aGVyZSB0aGUgYWN0aW9uIHRoYXQgY2F1c2VzIGNhbGxiYWNrcyBmcm9tIHRoZSBzb3VyY2Ugc2VxdWVuY2UgdG8gYmUgZm9yd2FyZGVkXG5cdCAgICogIG1heSBub3QgZXhlY3V0ZSBpbW1lZGlhdGVseSwgZGVzcGl0ZSB0aGUgemVybyBkdWUgdGltZS5cblx0ICAgKlxuXHQgICAqICBFcnJvcnMgcHJvZHVjZWQgYnkgdGhlIHNvdXJjZSBzZXF1ZW5jZSBhcmUgYWx3YXlzIGZvcndhcmRlZCB0byB0aGUgcmVzdWx0IHNlcXVlbmNlLCBldmVuIGlmIHRoZSBlcnJvciBvY2N1cnMgYmVmb3JlIHRoZSBkdXJhdGlvbi5cblx0ICAgKiBAcGFyYW0ge051bWJlcn0gZHVyYXRpb24gRHVyYXRpb24gZm9yIHNraXBwaW5nIGVsZW1lbnRzIGZyb20gdGhlIHN0YXJ0IG9mIHRoZSBzZXF1ZW5jZS5cblx0ICAgKiBAcGFyYW0ge1NjaGVkdWxlcn0gc2NoZWR1bGVyIFNjaGVkdWxlciB0byBydW4gdGhlIHRpbWVyIG9uLiBJZiBub3Qgc3BlY2lmaWVkLCBkZWZhdWx0cyB0byBSeC5TY2hlZHVsZXIudGltZW91dC5cblx0ICAgKiBAcmV0dXJucyB7T2JzZXJ2YWJsZX0gQW4gb2JzZXJ2YWJsZSBzZXF1ZW5jZSB3aXRoIHRoZSBlbGVtZW50cyBza2lwcGVkIGR1cmluZyB0aGUgc3BlY2lmaWVkIGR1cmF0aW9uIGZyb20gdGhlIHN0YXJ0IG9mIHRoZSBzb3VyY2Ugc2VxdWVuY2UuXG5cdCAgICovXG5cdCAgb2JzZXJ2YWJsZVByb3RvLnNraXBXaXRoVGltZSA9IGZ1bmN0aW9uIChkdXJhdGlvbiwgc2NoZWR1bGVyKSB7XG5cdCAgICBpc1NjaGVkdWxlcihzY2hlZHVsZXIpIHx8IChzY2hlZHVsZXIgPSBkZWZhdWx0U2NoZWR1bGVyKTtcblx0ICAgIHJldHVybiBuZXcgU2tpcFdpdGhUaW1lT2JzZXJ2YWJsZSh0aGlzLCBkdXJhdGlvbiwgc2NoZWR1bGVyKTtcblx0ICB9O1xuXHRcblx0ICB2YXIgU2tpcFVudGlsV2l0aFRpbWVPYnNlcnZhYmxlID0gKGZ1bmN0aW9uIChfX3N1cGVyX18pIHtcblx0ICAgIGluaGVyaXRzKFNraXBVbnRpbFdpdGhUaW1lT2JzZXJ2YWJsZSwgX19zdXBlcl9fKTtcblx0ICAgIGZ1bmN0aW9uIFNraXBVbnRpbFdpdGhUaW1lT2JzZXJ2YWJsZShzb3VyY2UsIHN0YXJ0VGltZSwgc2NoZWR1bGVyKSB7XG5cdCAgICAgIHRoaXMuc291cmNlID0gc291cmNlO1xuXHQgICAgICB0aGlzLl9zdCA9IHN0YXJ0VGltZTtcblx0ICAgICAgdGhpcy5fcyA9IHNjaGVkdWxlcjtcblx0ICAgICAgX19zdXBlcl9fLmNhbGwodGhpcyk7XG5cdCAgICB9XG5cdFxuXHQgICAgZnVuY3Rpb24gc2NoZWR1bGVNZXRob2Qocywgc3RhdGUpIHtcblx0ICAgICAgc3RhdGUuX29wZW4gPSB0cnVlO1xuXHQgICAgfVxuXHRcblx0ICAgIFNraXBVbnRpbFdpdGhUaW1lT2JzZXJ2YWJsZS5wcm90b3R5cGUuc3Vic2NyaWJlQ29yZSA9IGZ1bmN0aW9uIChvKSB7XG5cdCAgICAgIHRoaXMuX29wZW4gPSBmYWxzZTtcblx0ICAgICAgcmV0dXJuIG5ldyBCaW5hcnlEaXNwb3NhYmxlKFxuXHQgICAgICAgIHRoaXMuX3Muc2NoZWR1bGVGdXR1cmUodGhpcywgdGhpcy5fc3QsIHNjaGVkdWxlTWV0aG9kKSxcblx0ICAgICAgICB0aGlzLnNvdXJjZS5zdWJzY3JpYmUobmV3IFNraXBVbnRpbFdpdGhUaW1lT2JzZXJ2ZXIobywgdGhpcykpXG5cdCAgICAgICk7XG5cdCAgICB9O1xuXHRcblx0ICAgIHJldHVybiBTa2lwVW50aWxXaXRoVGltZU9ic2VydmFibGU7XG5cdCAgfShPYnNlcnZhYmxlQmFzZSkpO1xuXHRcblx0ICB2YXIgU2tpcFVudGlsV2l0aFRpbWVPYnNlcnZlciA9IChmdW5jdGlvbiAoX19zdXBlcl9fKSB7XG5cdCAgICBpbmhlcml0cyhTa2lwVW50aWxXaXRoVGltZU9ic2VydmVyLCBfX3N1cGVyX18pO1xuXHRcblx0ICAgIGZ1bmN0aW9uIFNraXBVbnRpbFdpdGhUaW1lT2JzZXJ2ZXIobywgcCkge1xuXHQgICAgICB0aGlzLl9vID0gbztcblx0ICAgICAgdGhpcy5fcCA9IHA7XG5cdCAgICAgIF9fc3VwZXJfXy5jYWxsKHRoaXMpO1xuXHQgICAgfVxuXHRcblx0ICAgIFNraXBVbnRpbFdpdGhUaW1lT2JzZXJ2ZXIucHJvdG90eXBlLm5leHQgPSBmdW5jdGlvbiAoeCkgeyB0aGlzLl9wLl9vcGVuICYmIHRoaXMuX28ub25OZXh0KHgpOyB9O1xuXHQgICAgU2tpcFVudGlsV2l0aFRpbWVPYnNlcnZlci5wcm90b3R5cGUuZXJyb3IgPSBmdW5jdGlvbiAoZSkgeyB0aGlzLl9vLm9uRXJyb3IoZSk7IH07XG5cdCAgICBTa2lwVW50aWxXaXRoVGltZU9ic2VydmVyLnByb3RvdHlwZS5jb21wbGV0ZWQgPSBmdW5jdGlvbiAoKSB7IHRoaXMuX28ub25Db21wbGV0ZWQoKTsgfTtcblx0XG5cdCAgICByZXR1cm4gU2tpcFVudGlsV2l0aFRpbWVPYnNlcnZlcjtcblx0ICB9KEFic3RyYWN0T2JzZXJ2ZXIpKTtcblx0XG5cdFxuXHQgIC8qKlxuXHQgICAqICBTa2lwcyBlbGVtZW50cyBmcm9tIHRoZSBvYnNlcnZhYmxlIHNvdXJjZSBzZXF1ZW5jZSB1bnRpbCB0aGUgc3BlY2lmaWVkIHN0YXJ0IHRpbWUsIHVzaW5nIHRoZSBzcGVjaWZpZWQgc2NoZWR1bGVyIHRvIHJ1biB0aW1lcnMuXG5cdCAgICogIEVycm9ycyBwcm9kdWNlZCBieSB0aGUgc291cmNlIHNlcXVlbmNlIGFyZSBhbHdheXMgZm9yd2FyZGVkIHRvIHRoZSByZXN1bHQgc2VxdWVuY2UsIGV2ZW4gaWYgdGhlIGVycm9yIG9jY3VycyBiZWZvcmUgdGhlIHN0YXJ0IHRpbWUuXG5cdCAgICpcblx0ICAgKiBAZXhhbXBsZXNcblx0ICAgKiAgMSAtIHJlcyA9IHNvdXJjZS5za2lwVW50aWxXaXRoVGltZShuZXcgRGF0ZSgpLCBbc2NoZWR1bGVyXSk7XG5cdCAgICogIDIgLSByZXMgPSBzb3VyY2Uuc2tpcFVudGlsV2l0aFRpbWUoNTAwMCwgW3NjaGVkdWxlcl0pO1xuXHQgICAqIEBwYXJhbSB7RGF0ZXxOdW1iZXJ9IHN0YXJ0VGltZSBUaW1lIHRvIHN0YXJ0IHRha2luZyBlbGVtZW50cyBmcm9tIHRoZSBzb3VyY2Ugc2VxdWVuY2UuIElmIHRoaXMgdmFsdWUgaXMgbGVzcyB0aGFuIG9yIGVxdWFsIHRvIERhdGUoKSwgbm8gZWxlbWVudHMgd2lsbCBiZSBza2lwcGVkLlxuXHQgICAqIEBwYXJhbSB7U2NoZWR1bGVyfSBbc2NoZWR1bGVyXSBTY2hlZHVsZXIgdG8gcnVuIHRoZSB0aW1lciBvbi4gSWYgbm90IHNwZWNpZmllZCwgZGVmYXVsdHMgdG8gUnguU2NoZWR1bGVyLnRpbWVvdXQuXG5cdCAgICogQHJldHVybnMge09ic2VydmFibGV9IEFuIG9ic2VydmFibGUgc2VxdWVuY2Ugd2l0aCB0aGUgZWxlbWVudHMgc2tpcHBlZCB1bnRpbCB0aGUgc3BlY2lmaWVkIHN0YXJ0IHRpbWUuXG5cdCAgICovXG5cdCAgb2JzZXJ2YWJsZVByb3RvLnNraXBVbnRpbFdpdGhUaW1lID0gZnVuY3Rpb24gKHN0YXJ0VGltZSwgc2NoZWR1bGVyKSB7XG5cdCAgICBpc1NjaGVkdWxlcihzY2hlZHVsZXIpIHx8IChzY2hlZHVsZXIgPSBkZWZhdWx0U2NoZWR1bGVyKTtcblx0ICAgIHJldHVybiBuZXcgU2tpcFVudGlsV2l0aFRpbWVPYnNlcnZhYmxlKHRoaXMsIHN0YXJ0VGltZSwgc2NoZWR1bGVyKTtcblx0ICB9O1xuXHRcblx0ICAvKipcblx0ICAgKiAgVGFrZXMgZWxlbWVudHMgZm9yIHRoZSBzcGVjaWZpZWQgZHVyYXRpb24gdW50aWwgdGhlIHNwZWNpZmllZCBlbmQgdGltZSwgdXNpbmcgdGhlIHNwZWNpZmllZCBzY2hlZHVsZXIgdG8gcnVuIHRpbWVycy5cblx0ICAgKiBAcGFyYW0ge051bWJlciB8IERhdGV9IGVuZFRpbWUgVGltZSB0byBzdG9wIHRha2luZyBlbGVtZW50cyBmcm9tIHRoZSBzb3VyY2Ugc2VxdWVuY2UuIElmIHRoaXMgdmFsdWUgaXMgbGVzcyB0aGFuIG9yIGVxdWFsIHRvIG5ldyBEYXRlKCksIHRoZSByZXN1bHQgc3RyZWFtIHdpbGwgY29tcGxldGUgaW1tZWRpYXRlbHkuXG5cdCAgICogQHBhcmFtIHtTY2hlZHVsZXJ9IFtzY2hlZHVsZXJdIFNjaGVkdWxlciB0byBydW4gdGhlIHRpbWVyIG9uLlxuXHQgICAqIEByZXR1cm5zIHtPYnNlcnZhYmxlfSBBbiBvYnNlcnZhYmxlIHNlcXVlbmNlIHdpdGggdGhlIGVsZW1lbnRzIHRha2VuIHVudGlsIHRoZSBzcGVjaWZpZWQgZW5kIHRpbWUuXG5cdCAgICovXG5cdCAgb2JzZXJ2YWJsZVByb3RvLnRha2VVbnRpbFdpdGhUaW1lID0gZnVuY3Rpb24gKGVuZFRpbWUsIHNjaGVkdWxlcikge1xuXHQgICAgaXNTY2hlZHVsZXIoc2NoZWR1bGVyKSB8fCAoc2NoZWR1bGVyID0gZGVmYXVsdFNjaGVkdWxlcik7XG5cdCAgICB2YXIgc291cmNlID0gdGhpcztcblx0ICAgIHJldHVybiBuZXcgQW5vbnltb3VzT2JzZXJ2YWJsZShmdW5jdGlvbiAobykge1xuXHQgICAgICByZXR1cm4gbmV3IEJpbmFyeURpc3Bvc2FibGUoXG5cdCAgICAgICAgc2NoZWR1bGVyLnNjaGVkdWxlRnV0dXJlKG8sIGVuZFRpbWUsIGZ1bmN0aW9uIChfLCBvKSB7IG8ub25Db21wbGV0ZWQoKTsgfSksXG5cdCAgICAgICAgc291cmNlLnN1YnNjcmliZShvKSk7XG5cdCAgICB9LCBzb3VyY2UpO1xuXHQgIH07XG5cdFxuXHQgIC8qKlxuXHQgICAqIFJldHVybnMgYW4gT2JzZXJ2YWJsZSB0aGF0IGVtaXRzIG9ubHkgdGhlIGZpcnN0IGl0ZW0gZW1pdHRlZCBieSB0aGUgc291cmNlIE9ic2VydmFibGUgZHVyaW5nIHNlcXVlbnRpYWwgdGltZSB3aW5kb3dzIG9mIGEgc3BlY2lmaWVkIGR1cmF0aW9uLlxuXHQgICAqIEBwYXJhbSB7TnVtYmVyfSB3aW5kb3dEdXJhdGlvbiB0aW1lIHRvIHdhaXQgYmVmb3JlIGVtaXR0aW5nIGFub3RoZXIgaXRlbSBhZnRlciBlbWl0dGluZyB0aGUgbGFzdCBpdGVtXG5cdCAgICogQHBhcmFtIHtTY2hlZHVsZXJ9IFtzY2hlZHVsZXJdIHRoZSBTY2hlZHVsZXIgdG8gdXNlIGludGVybmFsbHkgdG8gbWFuYWdlIHRoZSB0aW1lcnMgdGhhdCBoYW5kbGUgdGltZW91dCBmb3IgZWFjaCBpdGVtLiBJZiBub3QgcHJvdmlkZWQsIGRlZmF1bHRzIHRvIFNjaGVkdWxlci50aW1lb3V0LlxuXHQgICAqIEByZXR1cm5zIHtPYnNlcnZhYmxlfSBBbiBPYnNlcnZhYmxlIHRoYXQgcGVyZm9ybXMgdGhlIHRocm90dGxlIG9wZXJhdGlvbi5cblx0ICAgKi9cblx0ICBvYnNlcnZhYmxlUHJvdG8udGhyb3R0bGUgPSBmdW5jdGlvbiAod2luZG93RHVyYXRpb24sIHNjaGVkdWxlcikge1xuXHQgICAgaXNTY2hlZHVsZXIoc2NoZWR1bGVyKSB8fCAoc2NoZWR1bGVyID0gZGVmYXVsdFNjaGVkdWxlcik7XG5cdCAgICB2YXIgZHVyYXRpb24gPSArd2luZG93RHVyYXRpb24gfHwgMDtcblx0ICAgIGlmIChkdXJhdGlvbiA8PSAwKSB7IHRocm93IG5ldyBSYW5nZUVycm9yKCd3aW5kb3dEdXJhdGlvbiBjYW5ub3QgYmUgbGVzcyBvciBlcXVhbCB6ZXJvLicpOyB9XG5cdCAgICB2YXIgc291cmNlID0gdGhpcztcblx0ICAgIHJldHVybiBuZXcgQW5vbnltb3VzT2JzZXJ2YWJsZShmdW5jdGlvbiAobykge1xuXHQgICAgICB2YXIgbGFzdE9uTmV4dCA9IDA7XG5cdCAgICAgIHJldHVybiBzb3VyY2Uuc3Vic2NyaWJlKFxuXHQgICAgICAgIGZ1bmN0aW9uICh4KSB7XG5cdCAgICAgICAgICB2YXIgbm93ID0gc2NoZWR1bGVyLm5vdygpO1xuXHQgICAgICAgICAgaWYgKGxhc3RPbk5leHQgPT09IDAgfHwgbm93IC0gbGFzdE9uTmV4dCA+PSBkdXJhdGlvbikge1xuXHQgICAgICAgICAgICBsYXN0T25OZXh0ID0gbm93O1xuXHQgICAgICAgICAgICBvLm9uTmV4dCh4KTtcblx0ICAgICAgICAgIH1cblx0ICAgICAgICB9LGZ1bmN0aW9uIChlKSB7IG8ub25FcnJvcihlKTsgfSwgZnVuY3Rpb24gKCkgeyBvLm9uQ29tcGxldGVkKCk7IH1cblx0ICAgICAgKTtcblx0ICAgIH0sIHNvdXJjZSk7XG5cdCAgfTtcblx0XG5cdCAgdmFyIFRyYW5zZHVjZU9ic2VydmVyID0gKGZ1bmN0aW9uIChfX3N1cGVyX18pIHtcblx0ICAgIGluaGVyaXRzKFRyYW5zZHVjZU9ic2VydmVyLCBfX3N1cGVyX18pO1xuXHQgICAgZnVuY3Rpb24gVHJhbnNkdWNlT2JzZXJ2ZXIobywgeGZvcm0pIHtcblx0ICAgICAgdGhpcy5fbyA9IG87XG5cdCAgICAgIHRoaXMuX3hmb3JtID0geGZvcm07XG5cdCAgICAgIF9fc3VwZXJfXy5jYWxsKHRoaXMpO1xuXHQgICAgfVxuXHRcblx0ICAgIFRyYW5zZHVjZU9ic2VydmVyLnByb3RvdHlwZS5uZXh0ID0gZnVuY3Rpb24gKHgpIHtcblx0ICAgICAgdmFyIHJlcyA9IHRyeUNhdGNoKHRoaXMuX3hmb3JtWydAQHRyYW5zZHVjZXIvc3RlcCddKS5jYWxsKHRoaXMuX3hmb3JtLCB0aGlzLl9vLCB4KTtcblx0ICAgICAgaWYgKHJlcyA9PT0gZXJyb3JPYmopIHsgdGhpcy5fby5vbkVycm9yKHJlcy5lKTsgfVxuXHQgICAgfTtcblx0XG5cdCAgICBUcmFuc2R1Y2VPYnNlcnZlci5wcm90b3R5cGUuZXJyb3IgPSBmdW5jdGlvbiAoZSkgeyB0aGlzLl9vLm9uRXJyb3IoZSk7IH07XG5cdFxuXHQgICAgVHJhbnNkdWNlT2JzZXJ2ZXIucHJvdG90eXBlLmNvbXBsZXRlZCA9IGZ1bmN0aW9uICgpIHtcblx0ICAgICAgdGhpcy5feGZvcm1bJ0BAdHJhbnNkdWNlci9yZXN1bHQnXSh0aGlzLl9vKTtcblx0ICAgIH07XG5cdFxuXHQgICAgcmV0dXJuIFRyYW5zZHVjZU9ic2VydmVyO1xuXHQgIH0oQWJzdHJhY3RPYnNlcnZlcikpO1xuXHRcblx0ICBmdW5jdGlvbiB0cmFuc2Zvcm1Gb3JPYnNlcnZlcihvKSB7XG5cdCAgICByZXR1cm4ge1xuXHQgICAgICAnQEB0cmFuc2R1Y2VyL2luaXQnOiBmdW5jdGlvbigpIHtcblx0ICAgICAgICByZXR1cm4gbztcblx0ICAgICAgfSxcblx0ICAgICAgJ0BAdHJhbnNkdWNlci9zdGVwJzogZnVuY3Rpb24ob2JzLCBpbnB1dCkge1xuXHQgICAgICAgIHJldHVybiBvYnMub25OZXh0KGlucHV0KTtcblx0ICAgICAgfSxcblx0ICAgICAgJ0BAdHJhbnNkdWNlci9yZXN1bHQnOiBmdW5jdGlvbihvYnMpIHtcblx0ICAgICAgICByZXR1cm4gb2JzLm9uQ29tcGxldGVkKCk7XG5cdCAgICAgIH1cblx0ICAgIH07XG5cdCAgfVxuXHRcblx0ICAvKipcblx0ICAgKiBFeGVjdXRlcyBhIHRyYW5zZHVjZXIgdG8gdHJhbnNmb3JtIHRoZSBvYnNlcnZhYmxlIHNlcXVlbmNlXG5cdCAgICogQHBhcmFtIHtUcmFuc2R1Y2VyfSB0cmFuc2R1Y2VyIEEgdHJhbnNkdWNlciB0byBleGVjdXRlXG5cdCAgICogQHJldHVybnMge09ic2VydmFibGV9IEFuIE9ic2VydmFibGUgc2VxdWVuY2UgY29udGFpbmluZyB0aGUgcmVzdWx0cyBmcm9tIHRoZSB0cmFuc2R1Y2VyLlxuXHQgICAqL1xuXHQgIG9ic2VydmFibGVQcm90by50cmFuc2R1Y2UgPSBmdW5jdGlvbih0cmFuc2R1Y2VyKSB7XG5cdCAgICB2YXIgc291cmNlID0gdGhpcztcblx0ICAgIHJldHVybiBuZXcgQW5vbnltb3VzT2JzZXJ2YWJsZShmdW5jdGlvbihvKSB7XG5cdCAgICAgIHZhciB4Zm9ybSA9IHRyYW5zZHVjZXIodHJhbnNmb3JtRm9yT2JzZXJ2ZXIobykpO1xuXHQgICAgICByZXR1cm4gc291cmNlLnN1YnNjcmliZShuZXcgVHJhbnNkdWNlT2JzZXJ2ZXIobywgeGZvcm0pKTtcblx0ICAgIH0sIHNvdXJjZSk7XG5cdCAgfTtcblx0XG5cdCAgLyoqXG5cdCAgICogUGVyZm9ybXMgYSBleGNsdXNpdmUgd2FpdGluZyBmb3IgdGhlIGZpcnN0IHRvIGZpbmlzaCBiZWZvcmUgc3Vic2NyaWJpbmcgdG8gYW5vdGhlciBvYnNlcnZhYmxlLlxuXHQgICAqIE9ic2VydmFibGVzIHRoYXQgY29tZSBpbiBiZXR3ZWVuIHN1YnNjcmlwdGlvbnMgd2lsbCBiZSBkcm9wcGVkIG9uIHRoZSBmbG9vci5cblx0ICAgKiBAcmV0dXJucyB7T2JzZXJ2YWJsZX0gQSBleGNsdXNpdmUgb2JzZXJ2YWJsZSB3aXRoIG9ubHkgdGhlIHJlc3VsdHMgdGhhdCBoYXBwZW4gd2hlbiBzdWJzY3JpYmVkLlxuXHQgICAqL1xuXHQgIG9ic2VydmFibGVQcm90by5zd2l0Y2hGaXJzdCA9IGZ1bmN0aW9uICgpIHtcblx0ICAgIHZhciBzb3VyY2VzID0gdGhpcztcblx0ICAgIHJldHVybiBuZXcgQW5vbnltb3VzT2JzZXJ2YWJsZShmdW5jdGlvbiAobykge1xuXHQgICAgICB2YXIgaGFzQ3VycmVudCA9IGZhbHNlLFxuXHQgICAgICAgIGlzU3RvcHBlZCA9IGZhbHNlLFxuXHQgICAgICAgIG0gPSBuZXcgU2luZ2xlQXNzaWdubWVudERpc3Bvc2FibGUoKSxcblx0ICAgICAgICBnID0gbmV3IENvbXBvc2l0ZURpc3Bvc2FibGUoKTtcblx0XG5cdCAgICAgIGcuYWRkKG0pO1xuXHRcblx0ICAgICAgbS5zZXREaXNwb3NhYmxlKHNvdXJjZXMuc3Vic2NyaWJlKFxuXHQgICAgICAgIGZ1bmN0aW9uIChpbm5lclNvdXJjZSkge1xuXHQgICAgICAgICAgaWYgKCFoYXNDdXJyZW50KSB7XG5cdCAgICAgICAgICAgIGhhc0N1cnJlbnQgPSB0cnVlO1xuXHRcblx0ICAgICAgICAgICAgaXNQcm9taXNlKGlubmVyU291cmNlKSAmJiAoaW5uZXJTb3VyY2UgPSBvYnNlcnZhYmxlRnJvbVByb21pc2UoaW5uZXJTb3VyY2UpKTtcblx0XG5cdCAgICAgICAgICAgIHZhciBpbm5lclN1YnNjcmlwdGlvbiA9IG5ldyBTaW5nbGVBc3NpZ25tZW50RGlzcG9zYWJsZSgpO1xuXHQgICAgICAgICAgICBnLmFkZChpbm5lclN1YnNjcmlwdGlvbik7XG5cdFxuXHQgICAgICAgICAgICBpbm5lclN1YnNjcmlwdGlvbi5zZXREaXNwb3NhYmxlKGlubmVyU291cmNlLnN1YnNjcmliZShcblx0ICAgICAgICAgICAgICBmdW5jdGlvbiAoeCkgeyBvLm9uTmV4dCh4KTsgfSxcblx0ICAgICAgICAgICAgICBmdW5jdGlvbiAoZSkgeyBvLm9uRXJyb3IoZSk7IH0sXG5cdCAgICAgICAgICAgICAgZnVuY3Rpb24gKCkge1xuXHQgICAgICAgICAgICAgICAgZy5yZW1vdmUoaW5uZXJTdWJzY3JpcHRpb24pO1xuXHQgICAgICAgICAgICAgICAgaGFzQ3VycmVudCA9IGZhbHNlO1xuXHQgICAgICAgICAgICAgICAgaXNTdG9wcGVkICYmIGcubGVuZ3RoID09PSAxICYmIG8ub25Db21wbGV0ZWQoKTtcblx0ICAgICAgICAgICAgfSkpO1xuXHQgICAgICAgICAgfVxuXHQgICAgICAgIH0sXG5cdCAgICAgICAgZnVuY3Rpb24gKGUpIHsgby5vbkVycm9yKGUpOyB9LFxuXHQgICAgICAgIGZ1bmN0aW9uICgpIHtcblx0ICAgICAgICAgIGlzU3RvcHBlZCA9IHRydWU7XG5cdCAgICAgICAgICAhaGFzQ3VycmVudCAmJiBnLmxlbmd0aCA9PT0gMSAmJiBvLm9uQ29tcGxldGVkKCk7XG5cdCAgICAgICAgfSkpO1xuXHRcblx0ICAgICAgcmV0dXJuIGc7XG5cdCAgICB9LCB0aGlzKTtcblx0ICB9O1xuXHRcblx0b2JzZXJ2YWJsZVByb3RvLmZsYXRNYXBGaXJzdCA9IG9ic2VydmFibGVQcm90by5zZWxlY3RNYW55Rmlyc3QgPSBmdW5jdGlvbihzZWxlY3RvciwgcmVzdWx0U2VsZWN0b3IsIHRoaXNBcmcpIHtcblx0ICAgIHJldHVybiBuZXcgRmxhdE1hcE9ic2VydmFibGUodGhpcywgc2VsZWN0b3IsIHJlc3VsdFNlbGVjdG9yLCB0aGlzQXJnKS5zd2l0Y2hGaXJzdCgpO1xuXHR9O1xuXHRcblx0UnguT2JzZXJ2YWJsZS5wcm90b3R5cGUuZmxhdE1hcFdpdGhNYXhDb25jdXJyZW50ID0gZnVuY3Rpb24obGltaXQsIHNlbGVjdG9yLCByZXN1bHRTZWxlY3RvciwgdGhpc0FyZykge1xuXHQgICAgcmV0dXJuIG5ldyBGbGF0TWFwT2JzZXJ2YWJsZSh0aGlzLCBzZWxlY3RvciwgcmVzdWx0U2VsZWN0b3IsIHRoaXNBcmcpLm1lcmdlKGxpbWl0KTtcblx0fTtcblx0ICAvKiogUHJvdmlkZXMgYSBzZXQgb2YgZXh0ZW5zaW9uIG1ldGhvZHMgZm9yIHZpcnR1YWwgdGltZSBzY2hlZHVsaW5nLiAqL1xuXHQgIHZhciBWaXJ0dWFsVGltZVNjaGVkdWxlciA9IFJ4LlZpcnR1YWxUaW1lU2NoZWR1bGVyID0gKGZ1bmN0aW9uIChfX3N1cGVyX18pIHtcblx0ICAgIGluaGVyaXRzKFZpcnR1YWxUaW1lU2NoZWR1bGVyLCBfX3N1cGVyX18pO1xuXHRcblx0ICAgIC8qKlxuXHQgICAgICogQ3JlYXRlcyBhIG5ldyB2aXJ0dWFsIHRpbWUgc2NoZWR1bGVyIHdpdGggdGhlIHNwZWNpZmllZCBpbml0aWFsIGNsb2NrIHZhbHVlIGFuZCBhYnNvbHV0ZSB0aW1lIGNvbXBhcmVyLlxuXHQgICAgICpcblx0ICAgICAqIEBjb25zdHJ1Y3RvclxuXHQgICAgICogQHBhcmFtIHtOdW1iZXJ9IGluaXRpYWxDbG9jayBJbml0aWFsIHZhbHVlIGZvciB0aGUgY2xvY2suXG5cdCAgICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBjb21wYXJlciBDb21wYXJlciB0byBkZXRlcm1pbmUgY2F1c2FsaXR5IG9mIGV2ZW50cyBiYXNlZCBvbiBhYnNvbHV0ZSB0aW1lLlxuXHQgICAgICovXG5cdCAgICBmdW5jdGlvbiBWaXJ0dWFsVGltZVNjaGVkdWxlcihpbml0aWFsQ2xvY2ssIGNvbXBhcmVyKSB7XG5cdCAgICAgIHRoaXMuY2xvY2sgPSBpbml0aWFsQ2xvY2s7XG5cdCAgICAgIHRoaXMuY29tcGFyZXIgPSBjb21wYXJlcjtcblx0ICAgICAgdGhpcy5pc0VuYWJsZWQgPSBmYWxzZTtcblx0ICAgICAgdGhpcy5xdWV1ZSA9IG5ldyBQcmlvcml0eVF1ZXVlKDEwMjQpO1xuXHQgICAgICBfX3N1cGVyX18uY2FsbCh0aGlzKTtcblx0ICAgIH1cblx0XG5cdCAgICB2YXIgVmlydHVhbFRpbWVTY2hlZHVsZXJQcm90b3R5cGUgPSBWaXJ0dWFsVGltZVNjaGVkdWxlci5wcm90b3R5cGU7XG5cdFxuXHQgICAgVmlydHVhbFRpbWVTY2hlZHVsZXJQcm90b3R5cGUubm93ID0gZnVuY3Rpb24gKCkge1xuXHQgICAgICByZXR1cm4gdGhpcy50b0Fic29sdXRlVGltZSh0aGlzLmNsb2NrKTtcblx0ICAgIH07XG5cdFxuXHQgICAgVmlydHVhbFRpbWVTY2hlZHVsZXJQcm90b3R5cGUuc2NoZWR1bGUgPSBmdW5jdGlvbiAoc3RhdGUsIGFjdGlvbikge1xuXHQgICAgICByZXR1cm4gdGhpcy5zY2hlZHVsZUFic29sdXRlKHN0YXRlLCB0aGlzLmNsb2NrLCBhY3Rpb24pO1xuXHQgICAgfTtcblx0XG5cdCAgICBWaXJ0dWFsVGltZVNjaGVkdWxlclByb3RvdHlwZS5zY2hlZHVsZUZ1dHVyZSA9IGZ1bmN0aW9uIChzdGF0ZSwgZHVlVGltZSwgYWN0aW9uKSB7XG5cdCAgICAgIHZhciBkdCA9IGR1ZVRpbWUgaW5zdGFuY2VvZiBEYXRlID9cblx0ICAgICAgICB0aGlzLnRvUmVsYXRpdmVUaW1lKGR1ZVRpbWUgLSB0aGlzLm5vdygpKSA6XG5cdCAgICAgICAgdGhpcy50b1JlbGF0aXZlVGltZShkdWVUaW1lKTtcblx0XG5cdCAgICAgIHJldHVybiB0aGlzLnNjaGVkdWxlUmVsYXRpdmUoc3RhdGUsIGR0LCBhY3Rpb24pO1xuXHQgICAgfTtcblx0XG5cdCAgICAvKipcblx0ICAgICAqIEFkZHMgYSByZWxhdGl2ZSB0aW1lIHZhbHVlIHRvIGFuIGFic29sdXRlIHRpbWUgdmFsdWUuXG5cdCAgICAgKiBAcGFyYW0ge051bWJlcn0gYWJzb2x1dGUgQWJzb2x1dGUgdmlydHVhbCB0aW1lIHZhbHVlLlxuXHQgICAgICogQHBhcmFtIHtOdW1iZXJ9IHJlbGF0aXZlIFJlbGF0aXZlIHZpcnR1YWwgdGltZSB2YWx1ZSB0byBhZGQuXG5cdCAgICAgKiBAcmV0dXJuIHtOdW1iZXJ9IFJlc3VsdGluZyBhYnNvbHV0ZSB2aXJ0dWFsIHRpbWUgc3VtIHZhbHVlLlxuXHQgICAgICovXG5cdCAgICBWaXJ0dWFsVGltZVNjaGVkdWxlclByb3RvdHlwZS5hZGQgPSBub3RJbXBsZW1lbnRlZDtcblx0XG5cdCAgICAvKipcblx0ICAgICAqIENvbnZlcnRzIGFuIGFic29sdXRlIHRpbWUgdG8gYSBudW1iZXJcblx0ICAgICAqIEBwYXJhbSB7QW55fSBUaGUgYWJzb2x1dGUgdGltZS5cblx0ICAgICAqIEByZXR1cm5zIHtOdW1iZXJ9IFRoZSBhYnNvbHV0ZSB0aW1lIGluIG1zXG5cdCAgICAgKi9cblx0ICAgIFZpcnR1YWxUaW1lU2NoZWR1bGVyUHJvdG90eXBlLnRvQWJzb2x1dGVUaW1lID0gbm90SW1wbGVtZW50ZWQ7XG5cdFxuXHQgICAgLyoqXG5cdCAgICAgKiBDb252ZXJ0cyB0aGUgVGltZVNwYW4gdmFsdWUgdG8gYSByZWxhdGl2ZSB2aXJ0dWFsIHRpbWUgdmFsdWUuXG5cdCAgICAgKiBAcGFyYW0ge051bWJlcn0gdGltZVNwYW4gVGltZVNwYW4gdmFsdWUgdG8gY29udmVydC5cblx0ICAgICAqIEByZXR1cm4ge051bWJlcn0gQ29ycmVzcG9uZGluZyByZWxhdGl2ZSB2aXJ0dWFsIHRpbWUgdmFsdWUuXG5cdCAgICAgKi9cblx0ICAgIFZpcnR1YWxUaW1lU2NoZWR1bGVyUHJvdG90eXBlLnRvUmVsYXRpdmVUaW1lID0gbm90SW1wbGVtZW50ZWQ7XG5cdFxuXHQgICAgLyoqXG5cdCAgICAgKiBTY2hlZHVsZXMgYSBwZXJpb2RpYyBwaWVjZSBvZiB3b3JrIGJ5IGR5bmFtaWNhbGx5IGRpc2NvdmVyaW5nIHRoZSBzY2hlZHVsZXIncyBjYXBhYmlsaXRpZXMuIFRoZSBwZXJpb2RpYyB0YXNrIHdpbGwgYmUgZW11bGF0ZWQgdXNpbmcgcmVjdXJzaXZlIHNjaGVkdWxpbmcuXG5cdCAgICAgKiBAcGFyYW0ge01peGVkfSBzdGF0ZSBJbml0aWFsIHN0YXRlIHBhc3NlZCB0byB0aGUgYWN0aW9uIHVwb24gdGhlIGZpcnN0IGl0ZXJhdGlvbi5cblx0ICAgICAqIEBwYXJhbSB7TnVtYmVyfSBwZXJpb2QgUGVyaW9kIGZvciBydW5uaW5nIHRoZSB3b3JrIHBlcmlvZGljYWxseS5cblx0ICAgICAqIEBwYXJhbSB7RnVuY3Rpb259IGFjdGlvbiBBY3Rpb24gdG8gYmUgZXhlY3V0ZWQsIHBvdGVudGlhbGx5IHVwZGF0aW5nIHRoZSBzdGF0ZS5cblx0ICAgICAqIEByZXR1cm5zIHtEaXNwb3NhYmxlfSBUaGUgZGlzcG9zYWJsZSBvYmplY3QgdXNlZCB0byBjYW5jZWwgdGhlIHNjaGVkdWxlZCByZWN1cnJpbmcgYWN0aW9uIChiZXN0IGVmZm9ydCkuXG5cdCAgICAgKi9cblx0ICAgIFZpcnR1YWxUaW1lU2NoZWR1bGVyUHJvdG90eXBlLnNjaGVkdWxlUGVyaW9kaWMgPSBmdW5jdGlvbiAoc3RhdGUsIHBlcmlvZCwgYWN0aW9uKSB7XG5cdCAgICAgIHZhciBzID0gbmV3IFNjaGVkdWxlUGVyaW9kaWNSZWN1cnNpdmUodGhpcywgc3RhdGUsIHBlcmlvZCwgYWN0aW9uKTtcblx0ICAgICAgcmV0dXJuIHMuc3RhcnQoKTtcblx0ICAgIH07XG5cdFxuXHQgICAgLyoqXG5cdCAgICAgKiBTY2hlZHVsZXMgYW4gYWN0aW9uIHRvIGJlIGV4ZWN1dGVkIGFmdGVyIGR1ZVRpbWUuXG5cdCAgICAgKiBAcGFyYW0ge01peGVkfSBzdGF0ZSBTdGF0ZSBwYXNzZWQgdG8gdGhlIGFjdGlvbiB0byBiZSBleGVjdXRlZC5cblx0ICAgICAqIEBwYXJhbSB7TnVtYmVyfSBkdWVUaW1lIFJlbGF0aXZlIHRpbWUgYWZ0ZXIgd2hpY2ggdG8gZXhlY3V0ZSB0aGUgYWN0aW9uLlxuXHQgICAgICogQHBhcmFtIHtGdW5jdGlvbn0gYWN0aW9uIEFjdGlvbiB0byBiZSBleGVjdXRlZC5cblx0ICAgICAqIEByZXR1cm5zIHtEaXNwb3NhYmxlfSBUaGUgZGlzcG9zYWJsZSBvYmplY3QgdXNlZCB0byBjYW5jZWwgdGhlIHNjaGVkdWxlZCBhY3Rpb24gKGJlc3QgZWZmb3J0KS5cblx0ICAgICAqL1xuXHQgICAgVmlydHVhbFRpbWVTY2hlZHVsZXJQcm90b3R5cGUuc2NoZWR1bGVSZWxhdGl2ZSA9IGZ1bmN0aW9uIChzdGF0ZSwgZHVlVGltZSwgYWN0aW9uKSB7XG5cdCAgICAgIHZhciBydW5BdCA9IHRoaXMuYWRkKHRoaXMuY2xvY2ssIGR1ZVRpbWUpO1xuXHQgICAgICByZXR1cm4gdGhpcy5zY2hlZHVsZUFic29sdXRlKHN0YXRlLCBydW5BdCwgYWN0aW9uKTtcblx0ICAgIH07XG5cdFxuXHQgICAgLyoqXG5cdCAgICAgKiBTdGFydHMgdGhlIHZpcnR1YWwgdGltZSBzY2hlZHVsZXIuXG5cdCAgICAgKi9cblx0ICAgIFZpcnR1YWxUaW1lU2NoZWR1bGVyUHJvdG90eXBlLnN0YXJ0ID0gZnVuY3Rpb24gKCkge1xuXHQgICAgICBpZiAoIXRoaXMuaXNFbmFibGVkKSB7XG5cdCAgICAgICAgdGhpcy5pc0VuYWJsZWQgPSB0cnVlO1xuXHQgICAgICAgIGRvIHtcblx0ICAgICAgICAgIHZhciBuZXh0ID0gdGhpcy5nZXROZXh0KCk7XG5cdCAgICAgICAgICBpZiAobmV4dCAhPT0gbnVsbCkge1xuXHQgICAgICAgICAgICB0aGlzLmNvbXBhcmVyKG5leHQuZHVlVGltZSwgdGhpcy5jbG9jaykgPiAwICYmICh0aGlzLmNsb2NrID0gbmV4dC5kdWVUaW1lKTtcblx0ICAgICAgICAgICAgbmV4dC5pbnZva2UoKTtcblx0ICAgICAgICAgIH0gZWxzZSB7XG5cdCAgICAgICAgICAgIHRoaXMuaXNFbmFibGVkID0gZmFsc2U7XG5cdCAgICAgICAgICB9XG5cdCAgICAgICAgfSB3aGlsZSAodGhpcy5pc0VuYWJsZWQpO1xuXHQgICAgICB9XG5cdCAgICB9O1xuXHRcblx0ICAgIC8qKlxuXHQgICAgICogU3RvcHMgdGhlIHZpcnR1YWwgdGltZSBzY2hlZHVsZXIuXG5cdCAgICAgKi9cblx0ICAgIFZpcnR1YWxUaW1lU2NoZWR1bGVyUHJvdG90eXBlLnN0b3AgPSBmdW5jdGlvbiAoKSB7XG5cdCAgICAgIHRoaXMuaXNFbmFibGVkID0gZmFsc2U7XG5cdCAgICB9O1xuXHRcblx0ICAgIC8qKlxuXHQgICAgICogQWR2YW5jZXMgdGhlIHNjaGVkdWxlcidzIGNsb2NrIHRvIHRoZSBzcGVjaWZpZWQgdGltZSwgcnVubmluZyBhbGwgd29yayB0aWxsIHRoYXQgcG9pbnQuXG5cdCAgICAgKiBAcGFyYW0ge051bWJlcn0gdGltZSBBYnNvbHV0ZSB0aW1lIHRvIGFkdmFuY2UgdGhlIHNjaGVkdWxlcidzIGNsb2NrIHRvLlxuXHQgICAgICovXG5cdCAgICBWaXJ0dWFsVGltZVNjaGVkdWxlclByb3RvdHlwZS5hZHZhbmNlVG8gPSBmdW5jdGlvbiAodGltZSkge1xuXHQgICAgICB2YXIgZHVlVG9DbG9jayA9IHRoaXMuY29tcGFyZXIodGhpcy5jbG9jaywgdGltZSk7XG5cdCAgICAgIGlmICh0aGlzLmNvbXBhcmVyKHRoaXMuY2xvY2ssIHRpbWUpID4gMCkgeyB0aHJvdyBuZXcgQXJndW1lbnRPdXRPZlJhbmdlRXJyb3IoKTsgfVxuXHQgICAgICBpZiAoZHVlVG9DbG9jayA9PT0gMCkgeyByZXR1cm47IH1cblx0ICAgICAgaWYgKCF0aGlzLmlzRW5hYmxlZCkge1xuXHQgICAgICAgIHRoaXMuaXNFbmFibGVkID0gdHJ1ZTtcblx0ICAgICAgICBkbyB7XG5cdCAgICAgICAgICB2YXIgbmV4dCA9IHRoaXMuZ2V0TmV4dCgpO1xuXHQgICAgICAgICAgaWYgKG5leHQgIT09IG51bGwgJiYgdGhpcy5jb21wYXJlcihuZXh0LmR1ZVRpbWUsIHRpbWUpIDw9IDApIHtcblx0ICAgICAgICAgICAgdGhpcy5jb21wYXJlcihuZXh0LmR1ZVRpbWUsIHRoaXMuY2xvY2spID4gMCAmJiAodGhpcy5jbG9jayA9IG5leHQuZHVlVGltZSk7XG5cdCAgICAgICAgICAgIG5leHQuaW52b2tlKCk7XG5cdCAgICAgICAgICB9IGVsc2Uge1xuXHQgICAgICAgICAgICB0aGlzLmlzRW5hYmxlZCA9IGZhbHNlO1xuXHQgICAgICAgICAgfVxuXHQgICAgICAgIH0gd2hpbGUgKHRoaXMuaXNFbmFibGVkKTtcblx0ICAgICAgICB0aGlzLmNsb2NrID0gdGltZTtcblx0ICAgICAgfVxuXHQgICAgfTtcblx0XG5cdCAgICAvKipcblx0ICAgICAqIEFkdmFuY2VzIHRoZSBzY2hlZHVsZXIncyBjbG9jayBieSB0aGUgc3BlY2lmaWVkIHJlbGF0aXZlIHRpbWUsIHJ1bm5pbmcgYWxsIHdvcmsgc2NoZWR1bGVkIGZvciB0aGF0IHRpbWVzcGFuLlxuXHQgICAgICogQHBhcmFtIHtOdW1iZXJ9IHRpbWUgUmVsYXRpdmUgdGltZSB0byBhZHZhbmNlIHRoZSBzY2hlZHVsZXIncyBjbG9jayBieS5cblx0ICAgICAqL1xuXHQgICAgVmlydHVhbFRpbWVTY2hlZHVsZXJQcm90b3R5cGUuYWR2YW5jZUJ5ID0gZnVuY3Rpb24gKHRpbWUpIHtcblx0ICAgICAgdmFyIGR0ID0gdGhpcy5hZGQodGhpcy5jbG9jaywgdGltZSksXG5cdCAgICAgICAgICBkdWVUb0Nsb2NrID0gdGhpcy5jb21wYXJlcih0aGlzLmNsb2NrLCBkdCk7XG5cdCAgICAgIGlmIChkdWVUb0Nsb2NrID4gMCkgeyB0aHJvdyBuZXcgQXJndW1lbnRPdXRPZlJhbmdlRXJyb3IoKTsgfVxuXHQgICAgICBpZiAoZHVlVG9DbG9jayA9PT0gMCkgeyAgcmV0dXJuOyB9XG5cdFxuXHQgICAgICB0aGlzLmFkdmFuY2VUbyhkdCk7XG5cdCAgICB9O1xuXHRcblx0ICAgIC8qKlxuXHQgICAgICogQWR2YW5jZXMgdGhlIHNjaGVkdWxlcidzIGNsb2NrIGJ5IHRoZSBzcGVjaWZpZWQgcmVsYXRpdmUgdGltZS5cblx0ICAgICAqIEBwYXJhbSB7TnVtYmVyfSB0aW1lIFJlbGF0aXZlIHRpbWUgdG8gYWR2YW5jZSB0aGUgc2NoZWR1bGVyJ3MgY2xvY2sgYnkuXG5cdCAgICAgKi9cblx0ICAgIFZpcnR1YWxUaW1lU2NoZWR1bGVyUHJvdG90eXBlLnNsZWVwID0gZnVuY3Rpb24gKHRpbWUpIHtcblx0ICAgICAgdmFyIGR0ID0gdGhpcy5hZGQodGhpcy5jbG9jaywgdGltZSk7XG5cdCAgICAgIGlmICh0aGlzLmNvbXBhcmVyKHRoaXMuY2xvY2ssIGR0KSA+PSAwKSB7IHRocm93IG5ldyBBcmd1bWVudE91dE9mUmFuZ2VFcnJvcigpOyB9XG5cdFxuXHQgICAgICB0aGlzLmNsb2NrID0gZHQ7XG5cdCAgICB9O1xuXHRcblx0ICAgIC8qKlxuXHQgICAgICogR2V0cyB0aGUgbmV4dCBzY2hlZHVsZWQgaXRlbSB0byBiZSBleGVjdXRlZC5cblx0ICAgICAqIEByZXR1cm5zIHtTY2hlZHVsZWRJdGVtfSBUaGUgbmV4dCBzY2hlZHVsZWQgaXRlbS5cblx0ICAgICAqL1xuXHQgICAgVmlydHVhbFRpbWVTY2hlZHVsZXJQcm90b3R5cGUuZ2V0TmV4dCA9IGZ1bmN0aW9uICgpIHtcblx0ICAgICAgd2hpbGUgKHRoaXMucXVldWUubGVuZ3RoID4gMCkge1xuXHQgICAgICAgIHZhciBuZXh0ID0gdGhpcy5xdWV1ZS5wZWVrKCk7XG5cdCAgICAgICAgaWYgKG5leHQuaXNDYW5jZWxsZWQoKSkge1xuXHQgICAgICAgICAgdGhpcy5xdWV1ZS5kZXF1ZXVlKCk7XG5cdCAgICAgICAgfSBlbHNlIHtcblx0ICAgICAgICAgIHJldHVybiBuZXh0O1xuXHQgICAgICAgIH1cblx0ICAgICAgfVxuXHQgICAgICByZXR1cm4gbnVsbDtcblx0ICAgIH07XG5cdFxuXHQgICAgLyoqXG5cdCAgICAgKiBTY2hlZHVsZXMgYW4gYWN0aW9uIHRvIGJlIGV4ZWN1dGVkIGF0IGR1ZVRpbWUuXG5cdCAgICAgKiBAcGFyYW0ge01peGVkfSBzdGF0ZSBTdGF0ZSBwYXNzZWQgdG8gdGhlIGFjdGlvbiB0byBiZSBleGVjdXRlZC5cblx0ICAgICAqIEBwYXJhbSB7TnVtYmVyfSBkdWVUaW1lIEFic29sdXRlIHRpbWUgYXQgd2hpY2ggdG8gZXhlY3V0ZSB0aGUgYWN0aW9uLlxuXHQgICAgICogQHBhcmFtIHtGdW5jdGlvbn0gYWN0aW9uIEFjdGlvbiB0byBiZSBleGVjdXRlZC5cblx0ICAgICAqIEByZXR1cm5zIHtEaXNwb3NhYmxlfSBUaGUgZGlzcG9zYWJsZSBvYmplY3QgdXNlZCB0byBjYW5jZWwgdGhlIHNjaGVkdWxlZCBhY3Rpb24gKGJlc3QgZWZmb3J0KS5cblx0ICAgICAqL1xuXHQgICAgVmlydHVhbFRpbWVTY2hlZHVsZXJQcm90b3R5cGUuc2NoZWR1bGVBYnNvbHV0ZSA9IGZ1bmN0aW9uIChzdGF0ZSwgZHVlVGltZSwgYWN0aW9uKSB7XG5cdCAgICAgIHZhciBzZWxmID0gdGhpcztcblx0XG5cdCAgICAgIGZ1bmN0aW9uIHJ1bihzY2hlZHVsZXIsIHN0YXRlMSkge1xuXHQgICAgICAgIHNlbGYucXVldWUucmVtb3ZlKHNpKTtcblx0ICAgICAgICByZXR1cm4gYWN0aW9uKHNjaGVkdWxlciwgc3RhdGUxKTtcblx0ICAgICAgfVxuXHRcblx0ICAgICAgdmFyIHNpID0gbmV3IFNjaGVkdWxlZEl0ZW0odGhpcywgc3RhdGUsIHJ1biwgZHVlVGltZSwgdGhpcy5jb21wYXJlcik7XG5cdCAgICAgIHRoaXMucXVldWUuZW5xdWV1ZShzaSk7XG5cdFxuXHQgICAgICByZXR1cm4gc2kuZGlzcG9zYWJsZTtcblx0ICAgIH07XG5cdFxuXHQgICAgcmV0dXJuIFZpcnR1YWxUaW1lU2NoZWR1bGVyO1xuXHQgIH0oU2NoZWR1bGVyKSk7XG5cdFxuXHQgIC8qKiBQcm92aWRlcyBhIHZpcnR1YWwgdGltZSBzY2hlZHVsZXIgdGhhdCB1c2VzIERhdGUgZm9yIGFic29sdXRlIHRpbWUgYW5kIG51bWJlciBmb3IgcmVsYXRpdmUgdGltZS4gKi9cblx0ICBSeC5IaXN0b3JpY2FsU2NoZWR1bGVyID0gKGZ1bmN0aW9uIChfX3N1cGVyX18pIHtcblx0ICAgIGluaGVyaXRzKEhpc3RvcmljYWxTY2hlZHVsZXIsIF9fc3VwZXJfXyk7XG5cdFxuXHQgICAgLyoqXG5cdCAgICAgKiBDcmVhdGVzIGEgbmV3IGhpc3RvcmljYWwgc2NoZWR1bGVyIHdpdGggdGhlIHNwZWNpZmllZCBpbml0aWFsIGNsb2NrIHZhbHVlLlxuXHQgICAgICogQGNvbnN0cnVjdG9yXG5cdCAgICAgKiBAcGFyYW0ge051bWJlcn0gaW5pdGlhbENsb2NrIEluaXRpYWwgdmFsdWUgZm9yIHRoZSBjbG9jay5cblx0ICAgICAqIEBwYXJhbSB7RnVuY3Rpb259IGNvbXBhcmVyIENvbXBhcmVyIHRvIGRldGVybWluZSBjYXVzYWxpdHkgb2YgZXZlbnRzIGJhc2VkIG9uIGFic29sdXRlIHRpbWUuXG5cdCAgICAgKi9cblx0ICAgIGZ1bmN0aW9uIEhpc3RvcmljYWxTY2hlZHVsZXIoaW5pdGlhbENsb2NrLCBjb21wYXJlcikge1xuXHQgICAgICB2YXIgY2xvY2sgPSBpbml0aWFsQ2xvY2sgPT0gbnVsbCA/IDAgOiBpbml0aWFsQ2xvY2s7XG5cdCAgICAgIHZhciBjbXAgPSBjb21wYXJlciB8fCBkZWZhdWx0U3ViQ29tcGFyZXI7XG5cdCAgICAgIF9fc3VwZXJfXy5jYWxsKHRoaXMsIGNsb2NrLCBjbXApO1xuXHQgICAgfVxuXHRcblx0ICAgIHZhciBIaXN0b3JpY2FsU2NoZWR1bGVyUHJvdG8gPSBIaXN0b3JpY2FsU2NoZWR1bGVyLnByb3RvdHlwZTtcblx0XG5cdCAgICAvKipcblx0ICAgICAqIEFkZHMgYSByZWxhdGl2ZSB0aW1lIHZhbHVlIHRvIGFuIGFic29sdXRlIHRpbWUgdmFsdWUuXG5cdCAgICAgKiBAcGFyYW0ge051bWJlcn0gYWJzb2x1dGUgQWJzb2x1dGUgdmlydHVhbCB0aW1lIHZhbHVlLlxuXHQgICAgICogQHBhcmFtIHtOdW1iZXJ9IHJlbGF0aXZlIFJlbGF0aXZlIHZpcnR1YWwgdGltZSB2YWx1ZSB0byBhZGQuXG5cdCAgICAgKiBAcmV0dXJuIHtOdW1iZXJ9IFJlc3VsdGluZyBhYnNvbHV0ZSB2aXJ0dWFsIHRpbWUgc3VtIHZhbHVlLlxuXHQgICAgICovXG5cdCAgICBIaXN0b3JpY2FsU2NoZWR1bGVyUHJvdG8uYWRkID0gZnVuY3Rpb24gKGFic29sdXRlLCByZWxhdGl2ZSkge1xuXHQgICAgICByZXR1cm4gYWJzb2x1dGUgKyByZWxhdGl2ZTtcblx0ICAgIH07XG5cdFxuXHQgICAgSGlzdG9yaWNhbFNjaGVkdWxlclByb3RvLnRvQWJzb2x1dGVUaW1lID0gZnVuY3Rpb24gKGFic29sdXRlKSB7XG5cdCAgICAgIHJldHVybiBuZXcgRGF0ZShhYnNvbHV0ZSkuZ2V0VGltZSgpO1xuXHQgICAgfTtcblx0XG5cdCAgICAvKipcblx0ICAgICAqIENvbnZlcnRzIHRoZSBUaW1lU3BhbiB2YWx1ZSB0byBhIHJlbGF0aXZlIHZpcnR1YWwgdGltZSB2YWx1ZS5cblx0ICAgICAqIEBtZW1iZXJPZiBIaXN0b3JpY2FsU2NoZWR1bGVyXG5cdCAgICAgKiBAcGFyYW0ge051bWJlcn0gdGltZVNwYW4gVGltZVNwYW4gdmFsdWUgdG8gY29udmVydC5cblx0ICAgICAqIEByZXR1cm4ge051bWJlcn0gQ29ycmVzcG9uZGluZyByZWxhdGl2ZSB2aXJ0dWFsIHRpbWUgdmFsdWUuXG5cdCAgICAgKi9cblx0ICAgIEhpc3RvcmljYWxTY2hlZHVsZXJQcm90by50b1JlbGF0aXZlVGltZSA9IGZ1bmN0aW9uICh0aW1lU3Bhbikge1xuXHQgICAgICByZXR1cm4gdGltZVNwYW47XG5cdCAgICB9O1xuXHRcblx0ICAgIHJldHVybiBIaXN0b3JpY2FsU2NoZWR1bGVyO1xuXHQgIH0oUnguVmlydHVhbFRpbWVTY2hlZHVsZXIpKTtcblx0XG5cdGZ1bmN0aW9uIE9uTmV4dFByZWRpY2F0ZShwcmVkaWNhdGUpIHtcblx0ICAgIHRoaXMucHJlZGljYXRlID0gcHJlZGljYXRlO1xuXHR9XG5cdFxuXHRPbk5leHRQcmVkaWNhdGUucHJvdG90eXBlLmVxdWFscyA9IGZ1bmN0aW9uIChvdGhlcikge1xuXHQgIGlmIChvdGhlciA9PT0gdGhpcykgeyByZXR1cm4gdHJ1ZTsgfVxuXHQgIGlmIChvdGhlciA9PSBudWxsKSB7IHJldHVybiBmYWxzZTsgfVxuXHQgIGlmIChvdGhlci5raW5kICE9PSAnTicpIHsgcmV0dXJuIGZhbHNlOyB9XG5cdCAgcmV0dXJuIHRoaXMucHJlZGljYXRlKG90aGVyLnZhbHVlKTtcblx0fTtcblx0XG5cdGZ1bmN0aW9uIE9uRXJyb3JQcmVkaWNhdGUocHJlZGljYXRlKSB7XG5cdCAgdGhpcy5wcmVkaWNhdGUgPSBwcmVkaWNhdGU7XG5cdH1cblx0XG5cdE9uRXJyb3JQcmVkaWNhdGUucHJvdG90eXBlLmVxdWFscyA9IGZ1bmN0aW9uIChvdGhlcikge1xuXHQgIGlmIChvdGhlciA9PT0gdGhpcykgeyByZXR1cm4gdHJ1ZTsgfVxuXHQgIGlmIChvdGhlciA9PSBudWxsKSB7IHJldHVybiBmYWxzZTsgfVxuXHQgIGlmIChvdGhlci5raW5kICE9PSAnRScpIHsgcmV0dXJuIGZhbHNlOyB9XG5cdCAgcmV0dXJuIHRoaXMucHJlZGljYXRlKG90aGVyLmVycm9yKTtcblx0fTtcblx0XG5cdHZhciBSZWFjdGl2ZVRlc3QgPSBSeC5SZWFjdGl2ZVRlc3QgPSB7XG5cdCAgLyoqIERlZmF1bHQgdmlydHVhbCB0aW1lIHVzZWQgZm9yIGNyZWF0aW9uIG9mIG9ic2VydmFibGUgc2VxdWVuY2VzIGluIHVuaXQgdGVzdHMuICovXG5cdCAgY3JlYXRlZDogMTAwLFxuXHQgIC8qKiBEZWZhdWx0IHZpcnR1YWwgdGltZSB1c2VkIHRvIHN1YnNjcmliZSB0byBvYnNlcnZhYmxlIHNlcXVlbmNlcyBpbiB1bml0IHRlc3RzLiAqL1xuXHQgIHN1YnNjcmliZWQ6IDIwMCxcblx0ICAvKiogRGVmYXVsdCB2aXJ0dWFsIHRpbWUgdXNlZCB0byBkaXNwb3NlIHN1YnNjcmlwdGlvbnMgaW4gdW5pdCB0ZXN0cy4gKi9cblx0ICBkaXNwb3NlZDogMTAwMCxcblx0XG5cdCAgLyoqXG5cdCAgICogRmFjdG9yeSBtZXRob2QgZm9yIGFuIE9uTmV4dCBub3RpZmljYXRpb24gcmVjb3JkIGF0IGEgZ2l2ZW4gdGltZSB3aXRoIGEgZ2l2ZW4gdmFsdWUgb3IgYSBwcmVkaWNhdGUgZnVuY3Rpb24uXG5cdCAgICpcblx0ICAgKiAxIC0gUmVhY3RpdmVUZXN0Lm9uTmV4dCgyMDAsIDQyKTtcblx0ICAgKiAyIC0gUmVhY3RpdmVUZXN0Lm9uTmV4dCgyMDAsIGZ1bmN0aW9uICh4KSB7IHJldHVybiB4Lmxlbmd0aCA9PSAyOyB9KTtcblx0ICAgKlxuXHQgICAqIEBwYXJhbSB0aWNrcyBSZWNvcmRlZCB2aXJ0dWFsIHRpbWUgdGhlIE9uTmV4dCBub3RpZmljYXRpb24gb2NjdXJzLlxuXHQgICAqIEBwYXJhbSB2YWx1ZSBSZWNvcmRlZCB2YWx1ZSBzdG9yZWQgaW4gdGhlIE9uTmV4dCBub3RpZmljYXRpb24gb3IgYSBwcmVkaWNhdGUuXG5cdCAgICogQHJldHVybiBSZWNvcmRlZCBPbk5leHQgbm90aWZpY2F0aW9uLlxuXHQgICAqL1xuXHQgIG9uTmV4dDogZnVuY3Rpb24gKHRpY2tzLCB2YWx1ZSkge1xuXHQgICAgcmV0dXJuIHR5cGVvZiB2YWx1ZSA9PT0gJ2Z1bmN0aW9uJyA/XG5cdCAgICAgIG5ldyBSZWNvcmRlZCh0aWNrcywgbmV3IE9uTmV4dFByZWRpY2F0ZSh2YWx1ZSkpIDpcblx0ICAgICAgbmV3IFJlY29yZGVkKHRpY2tzLCBOb3RpZmljYXRpb24uY3JlYXRlT25OZXh0KHZhbHVlKSk7XG5cdCAgfSxcblx0ICAvKipcblx0ICAgKiBGYWN0b3J5IG1ldGhvZCBmb3IgYW4gT25FcnJvciBub3RpZmljYXRpb24gcmVjb3JkIGF0IGEgZ2l2ZW4gdGltZSB3aXRoIGEgZ2l2ZW4gZXJyb3IuXG5cdCAgICpcblx0ICAgKiAxIC0gUmVhY3RpdmVUZXN0Lm9uTmV4dCgyMDAsIG5ldyBFcnJvcignZXJyb3InKSk7XG5cdCAgICogMiAtIFJlYWN0aXZlVGVzdC5vbk5leHQoMjAwLCBmdW5jdGlvbiAoZSkgeyByZXR1cm4gZS5tZXNzYWdlID09PSAnZXJyb3InOyB9KTtcblx0ICAgKlxuXHQgICAqIEBwYXJhbSB0aWNrcyBSZWNvcmRlZCB2aXJ0dWFsIHRpbWUgdGhlIE9uRXJyb3Igbm90aWZpY2F0aW9uIG9jY3Vycy5cblx0ICAgKiBAcGFyYW0gZXhjZXB0aW9uIFJlY29yZGVkIGV4Y2VwdGlvbiBzdG9yZWQgaW4gdGhlIE9uRXJyb3Igbm90aWZpY2F0aW9uLlxuXHQgICAqIEByZXR1cm4gUmVjb3JkZWQgT25FcnJvciBub3RpZmljYXRpb24uXG5cdCAgICovXG5cdCAgb25FcnJvcjogZnVuY3Rpb24gKHRpY2tzLCBlcnJvcikge1xuXHQgICAgcmV0dXJuIHR5cGVvZiBlcnJvciA9PT0gJ2Z1bmN0aW9uJyA/XG5cdCAgICAgIG5ldyBSZWNvcmRlZCh0aWNrcywgbmV3IE9uRXJyb3JQcmVkaWNhdGUoZXJyb3IpKSA6XG5cdCAgICAgIG5ldyBSZWNvcmRlZCh0aWNrcywgTm90aWZpY2F0aW9uLmNyZWF0ZU9uRXJyb3IoZXJyb3IpKTtcblx0ICB9LFxuXHQgIC8qKlxuXHQgICAqIEZhY3RvcnkgbWV0aG9kIGZvciBhbiBPbkNvbXBsZXRlZCBub3RpZmljYXRpb24gcmVjb3JkIGF0IGEgZ2l2ZW4gdGltZS5cblx0ICAgKlxuXHQgICAqIEBwYXJhbSB0aWNrcyBSZWNvcmRlZCB2aXJ0dWFsIHRpbWUgdGhlIE9uQ29tcGxldGVkIG5vdGlmaWNhdGlvbiBvY2N1cnMuXG5cdCAgICogQHJldHVybiBSZWNvcmRlZCBPbkNvbXBsZXRlZCBub3RpZmljYXRpb24uXG5cdCAgICovXG5cdCAgb25Db21wbGV0ZWQ6IGZ1bmN0aW9uICh0aWNrcykge1xuXHQgICAgcmV0dXJuIG5ldyBSZWNvcmRlZCh0aWNrcywgTm90aWZpY2F0aW9uLmNyZWF0ZU9uQ29tcGxldGVkKCkpO1xuXHQgIH0sXG5cdCAgLyoqXG5cdCAgICogRmFjdG9yeSBtZXRob2QgZm9yIGEgc3Vic2NyaXB0aW9uIHJlY29yZCBiYXNlZCBvbiBhIGdpdmVuIHN1YnNjcmlwdGlvbiBhbmQgZGlzcG9zYWwgdGltZS5cblx0ICAgKlxuXHQgICAqIEBwYXJhbSBzdGFydCBWaXJ0dWFsIHRpbWUgaW5kaWNhdGluZyB3aGVuIHRoZSBzdWJzY3JpcHRpb24gd2FzIGNyZWF0ZWQuXG5cdCAgICogQHBhcmFtIGVuZCBWaXJ0dWFsIHRpbWUgaW5kaWNhdGluZyB3aGVuIHRoZSBzdWJzY3JpcHRpb24gd2FzIGRpc3Bvc2VkLlxuXHQgICAqIEByZXR1cm4gU3Vic2NyaXB0aW9uIG9iamVjdC5cblx0ICAgKi9cblx0ICBzdWJzY3JpYmU6IGZ1bmN0aW9uIChzdGFydCwgZW5kKSB7XG5cdCAgICByZXR1cm4gbmV3IFN1YnNjcmlwdGlvbihzdGFydCwgZW5kKTtcblx0ICB9XG5cdH07XG5cdFxuXHQgIC8qKlxuXHQgICAqIENyZWF0ZXMgYSBuZXcgb2JqZWN0IHJlY29yZGluZyB0aGUgcHJvZHVjdGlvbiBvZiB0aGUgc3BlY2lmaWVkIHZhbHVlIGF0IHRoZSBnaXZlbiB2aXJ0dWFsIHRpbWUuXG5cdCAgICpcblx0ICAgKiBAY29uc3RydWN0b3Jcblx0ICAgKiBAcGFyYW0ge051bWJlcn0gdGltZSBWaXJ0dWFsIHRpbWUgdGhlIHZhbHVlIHdhcyBwcm9kdWNlZCBvbi5cblx0ICAgKiBAcGFyYW0ge01peGVkfSB2YWx1ZSBWYWx1ZSB0aGF0IHdhcyBwcm9kdWNlZC5cblx0ICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBjb21wYXJlciBBbiBvcHRpb25hbCBjb21wYXJlci5cblx0ICAgKi9cblx0ICB2YXIgUmVjb3JkZWQgPSBSeC5SZWNvcmRlZCA9IGZ1bmN0aW9uICh0aW1lLCB2YWx1ZSwgY29tcGFyZXIpIHtcblx0ICAgIHRoaXMudGltZSA9IHRpbWU7XG5cdCAgICB0aGlzLnZhbHVlID0gdmFsdWU7XG5cdCAgICB0aGlzLmNvbXBhcmVyID0gY29tcGFyZXIgfHwgZGVmYXVsdENvbXBhcmVyO1xuXHQgIH07XG5cdFxuXHQgIC8qKlxuXHQgICAqIENoZWNrcyB3aGV0aGVyIHRoZSBnaXZlbiByZWNvcmRlZCBvYmplY3QgaXMgZXF1YWwgdG8gdGhlIGN1cnJlbnQgaW5zdGFuY2UuXG5cdCAgICpcblx0ICAgKiBAcGFyYW0ge1JlY29yZGVkfSBvdGhlciBSZWNvcmRlZCBvYmplY3QgdG8gY2hlY2sgZm9yIGVxdWFsaXR5LlxuXHQgICAqIEByZXR1cm5zIHtCb29sZWFufSB0cnVlIGlmIGJvdGggb2JqZWN0cyBhcmUgZXF1YWw7IGZhbHNlIG90aGVyd2lzZS5cblx0ICAgKi9cblx0ICBSZWNvcmRlZC5wcm90b3R5cGUuZXF1YWxzID0gZnVuY3Rpb24gKG90aGVyKSB7XG5cdCAgICByZXR1cm4gdGhpcy50aW1lID09PSBvdGhlci50aW1lICYmIHRoaXMuY29tcGFyZXIodGhpcy52YWx1ZSwgb3RoZXIudmFsdWUpO1xuXHQgIH07XG5cdFxuXHQgIC8qKlxuXHQgICAqIFJldHVybnMgYSBzdHJpbmcgcmVwcmVzZW50YXRpb24gb2YgdGhlIGN1cnJlbnQgUmVjb3JkZWQgdmFsdWUuXG5cdCAgICpcblx0ICAgKiBAcmV0dXJucyB7U3RyaW5nfSBTdHJpbmcgcmVwcmVzZW50YXRpb24gb2YgdGhlIGN1cnJlbnQgUmVjb3JkZWQgdmFsdWUuXG5cdCAgICovXG5cdCAgUmVjb3JkZWQucHJvdG90eXBlLnRvU3RyaW5nID0gZnVuY3Rpb24gKCkge1xuXHQgICAgcmV0dXJuIHRoaXMudmFsdWUudG9TdHJpbmcoKSArICdAJyArIHRoaXMudGltZTtcblx0ICB9O1xuXHRcblx0ICAvKipcblx0ICAgKiBDcmVhdGVzIGEgbmV3IHN1YnNjcmlwdGlvbiBvYmplY3Qgd2l0aCB0aGUgZ2l2ZW4gdmlydHVhbCBzdWJzY3JpcHRpb24gYW5kIHVuc3Vic2NyaXB0aW9uIHRpbWUuXG5cdCAgICpcblx0ICAgKiBAY29uc3RydWN0b3Jcblx0ICAgKiBAcGFyYW0ge051bWJlcn0gc3Vic2NyaWJlIFZpcnR1YWwgdGltZSBhdCB3aGljaCB0aGUgc3Vic2NyaXB0aW9uIG9jY3VycmVkLlxuXHQgICAqIEBwYXJhbSB7TnVtYmVyfSB1bnN1YnNjcmliZSBWaXJ0dWFsIHRpbWUgYXQgd2hpY2ggdGhlIHVuc3Vic2NyaXB0aW9uIG9jY3VycmVkLlxuXHQgICAqL1xuXHQgIHZhciBTdWJzY3JpcHRpb24gPSBSeC5TdWJzY3JpcHRpb24gPSBmdW5jdGlvbiAoc3RhcnQsIGVuZCkge1xuXHQgICAgdGhpcy5zdWJzY3JpYmUgPSBzdGFydDtcblx0ICAgIHRoaXMudW5zdWJzY3JpYmUgPSBlbmQgfHwgTnVtYmVyLk1BWF9WQUxVRTtcblx0ICB9O1xuXHRcblx0ICAvKipcblx0ICAgKiBDaGVja3Mgd2hldGhlciB0aGUgZ2l2ZW4gc3Vic2NyaXB0aW9uIGlzIGVxdWFsIHRvIHRoZSBjdXJyZW50IGluc3RhbmNlLlxuXHQgICAqIEBwYXJhbSBvdGhlciBTdWJzY3JpcHRpb24gb2JqZWN0IHRvIGNoZWNrIGZvciBlcXVhbGl0eS5cblx0ICAgKiBAcmV0dXJucyB7Qm9vbGVhbn0gdHJ1ZSBpZiBib3RoIG9iamVjdHMgYXJlIGVxdWFsOyBmYWxzZSBvdGhlcndpc2UuXG5cdCAgICovXG5cdCAgU3Vic2NyaXB0aW9uLnByb3RvdHlwZS5lcXVhbHMgPSBmdW5jdGlvbiAob3RoZXIpIHtcblx0ICAgIHJldHVybiB0aGlzLnN1YnNjcmliZSA9PT0gb3RoZXIuc3Vic2NyaWJlICYmIHRoaXMudW5zdWJzY3JpYmUgPT09IG90aGVyLnVuc3Vic2NyaWJlO1xuXHQgIH07XG5cdFxuXHQgIC8qKlxuXHQgICAqIFJldHVybnMgYSBzdHJpbmcgcmVwcmVzZW50YXRpb24gb2YgdGhlIGN1cnJlbnQgU3Vic2NyaXB0aW9uIHZhbHVlLlxuXHQgICAqIEByZXR1cm5zIHtTdHJpbmd9IFN0cmluZyByZXByZXNlbnRhdGlvbiBvZiB0aGUgY3VycmVudCBTdWJzY3JpcHRpb24gdmFsdWUuXG5cdCAgICovXG5cdCAgU3Vic2NyaXB0aW9uLnByb3RvdHlwZS50b1N0cmluZyA9IGZ1bmN0aW9uICgpIHtcblx0ICAgIHJldHVybiAnKCcgKyB0aGlzLnN1YnNjcmliZSArICcsICcgKyAodGhpcy51bnN1YnNjcmliZSA9PT0gTnVtYmVyLk1BWF9WQUxVRSA/ICdJbmZpbml0ZScgOiB0aGlzLnVuc3Vic2NyaWJlKSArICcpJztcblx0ICB9O1xuXHRcblx0ICB2YXIgTW9ja0Rpc3Bvc2FibGUgPSBSeC5Nb2NrRGlzcG9zYWJsZSA9IGZ1bmN0aW9uIChzY2hlZHVsZXIpIHtcblx0ICAgIHRoaXMuc2NoZWR1bGVyID0gc2NoZWR1bGVyO1xuXHQgICAgdGhpcy5kaXNwb3NlcyA9IFtdO1xuXHQgICAgdGhpcy5kaXNwb3Nlcy5wdXNoKHRoaXMuc2NoZWR1bGVyLmNsb2NrKTtcblx0ICB9O1xuXHRcblx0ICBNb2NrRGlzcG9zYWJsZS5wcm90b3R5cGUuZGlzcG9zZSA9IGZ1bmN0aW9uICgpIHtcblx0ICAgIHRoaXMuZGlzcG9zZXMucHVzaCh0aGlzLnNjaGVkdWxlci5jbG9jayk7XG5cdCAgfTtcblx0XG5cdCAgdmFyIE1vY2tPYnNlcnZlciA9IChmdW5jdGlvbiAoX19zdXBlcl9fKSB7XG5cdCAgICBpbmhlcml0cyhNb2NrT2JzZXJ2ZXIsIF9fc3VwZXJfXyk7XG5cdFxuXHQgICAgZnVuY3Rpb24gTW9ja09ic2VydmVyKHNjaGVkdWxlcikge1xuXHQgICAgICBfX3N1cGVyX18uY2FsbCh0aGlzKTtcblx0ICAgICAgdGhpcy5zY2hlZHVsZXIgPSBzY2hlZHVsZXI7XG5cdCAgICAgIHRoaXMubWVzc2FnZXMgPSBbXTtcblx0ICAgIH1cblx0XG5cdCAgICB2YXIgTW9ja09ic2VydmVyUHJvdG90eXBlID0gTW9ja09ic2VydmVyLnByb3RvdHlwZTtcblx0XG5cdCAgICBNb2NrT2JzZXJ2ZXJQcm90b3R5cGUub25OZXh0ID0gZnVuY3Rpb24gKHZhbHVlKSB7XG5cdCAgICAgIHRoaXMubWVzc2FnZXMucHVzaChuZXcgUmVjb3JkZWQodGhpcy5zY2hlZHVsZXIuY2xvY2ssIE5vdGlmaWNhdGlvbi5jcmVhdGVPbk5leHQodmFsdWUpKSk7XG5cdCAgICB9O1xuXHRcblx0ICAgIE1vY2tPYnNlcnZlclByb3RvdHlwZS5vbkVycm9yID0gZnVuY3Rpb24gKGUpIHtcblx0ICAgICAgdGhpcy5tZXNzYWdlcy5wdXNoKG5ldyBSZWNvcmRlZCh0aGlzLnNjaGVkdWxlci5jbG9jaywgTm90aWZpY2F0aW9uLmNyZWF0ZU9uRXJyb3IoZSkpKTtcblx0ICAgIH07XG5cdFxuXHQgICAgTW9ja09ic2VydmVyUHJvdG90eXBlLm9uQ29tcGxldGVkID0gZnVuY3Rpb24gKCkge1xuXHQgICAgICB0aGlzLm1lc3NhZ2VzLnB1c2gobmV3IFJlY29yZGVkKHRoaXMuc2NoZWR1bGVyLmNsb2NrLCBOb3RpZmljYXRpb24uY3JlYXRlT25Db21wbGV0ZWQoKSkpO1xuXHQgICAgfTtcblx0XG5cdCAgICByZXR1cm4gTW9ja09ic2VydmVyO1xuXHQgIH0pKE9ic2VydmVyKTtcblx0XG5cdCAgZnVuY3Rpb24gTW9ja1Byb21pc2Uoc2NoZWR1bGVyLCBtZXNzYWdlcykge1xuXHQgICAgdmFyIHNlbGYgPSB0aGlzO1xuXHQgICAgdGhpcy5zY2hlZHVsZXIgPSBzY2hlZHVsZXI7XG5cdCAgICB0aGlzLm1lc3NhZ2VzID0gbWVzc2FnZXM7XG5cdCAgICB0aGlzLnN1YnNjcmlwdGlvbnMgPSBbXTtcblx0ICAgIHRoaXMub2JzZXJ2ZXJzID0gW107XG5cdCAgICBmb3IgKHZhciBpID0gMCwgbGVuID0gdGhpcy5tZXNzYWdlcy5sZW5ndGg7IGkgPCBsZW47IGkrKykge1xuXHQgICAgICB2YXIgbWVzc2FnZSA9IHRoaXMubWVzc2FnZXNbaV0sXG5cdCAgICAgICAgICBub3RpZmljYXRpb24gPSBtZXNzYWdlLnZhbHVlO1xuXHQgICAgICAoZnVuY3Rpb24gKGlubmVyTm90aWZpY2F0aW9uKSB7XG5cdCAgICAgICAgc2NoZWR1bGVyLnNjaGVkdWxlQWJzb2x1dGUobnVsbCwgbWVzc2FnZS50aW1lLCBmdW5jdGlvbiAoKSB7XG5cdCAgICAgICAgICB2YXIgb2JzID0gc2VsZi5vYnNlcnZlcnMuc2xpY2UoMCk7XG5cdFxuXHQgICAgICAgICAgZm9yICh2YXIgaiA9IDAsIGpMZW4gPSBvYnMubGVuZ3RoOyBqIDwgakxlbjsgaisrKSB7XG5cdCAgICAgICAgICAgIGlubmVyTm90aWZpY2F0aW9uLmFjY2VwdChvYnNbal0pO1xuXHQgICAgICAgICAgfVxuXHQgICAgICAgICAgcmV0dXJuIGRpc3Bvc2FibGVFbXB0eTtcblx0ICAgICAgICB9KTtcblx0ICAgICAgfSkobm90aWZpY2F0aW9uKTtcblx0ICAgIH1cblx0ICB9XG5cdFxuXHQgIE1vY2tQcm9taXNlLnByb3RvdHlwZS50aGVuID0gZnVuY3Rpb24gKG9uUmVzb2x2ZWQsIG9uUmVqZWN0ZWQpIHtcblx0ICAgIHZhciBzZWxmID0gdGhpcztcblx0XG5cdCAgICB0aGlzLnN1YnNjcmlwdGlvbnMucHVzaChuZXcgU3Vic2NyaXB0aW9uKHRoaXMuc2NoZWR1bGVyLmNsb2NrKSk7XG5cdCAgICB2YXIgaW5kZXggPSB0aGlzLnN1YnNjcmlwdGlvbnMubGVuZ3RoIC0gMTtcblx0XG5cdCAgICB2YXIgbmV3UHJvbWlzZTtcblx0XG5cdCAgICB2YXIgb2JzZXJ2ZXIgPSBSeC5PYnNlcnZlci5jcmVhdGUoXG5cdCAgICAgIGZ1bmN0aW9uICh4KSB7XG5cdCAgICAgICAgdmFyIHJldFZhbHVlID0gb25SZXNvbHZlZCh4KTtcblx0ICAgICAgICBpZiAocmV0VmFsdWUgJiYgdHlwZW9mIHJldFZhbHVlLnRoZW4gPT09ICdmdW5jdGlvbicpIHtcblx0ICAgICAgICAgIG5ld1Byb21pc2UgPSByZXRWYWx1ZTtcblx0ICAgICAgICB9IGVsc2Uge1xuXHQgICAgICAgICAgdmFyIHRpY2tzID0gc2VsZi5zY2hlZHVsZXIuY2xvY2s7XG5cdCAgICAgICAgICBuZXdQcm9taXNlID0gbmV3IE1vY2tQcm9taXNlKHNlbGYuc2NoZWR1bGVyLCBbUnguUmVhY3RpdmVUZXN0Lm9uTmV4dCh0aWNrcywgdW5kZWZpbmVkKSwgUnguUmVhY3RpdmVUZXN0Lm9uQ29tcGxldGVkKHRpY2tzKV0pO1xuXHQgICAgICAgIH1cblx0ICAgICAgICB2YXIgaWR4ID0gc2VsZi5vYnNlcnZlcnMuaW5kZXhPZihvYnNlcnZlcik7XG5cdCAgICAgICAgc2VsZi5vYnNlcnZlcnMuc3BsaWNlKGlkeCwgMSk7XG5cdCAgICAgICAgc2VsZi5zdWJzY3JpcHRpb25zW2luZGV4XSA9IG5ldyBTdWJzY3JpcHRpb24oc2VsZi5zdWJzY3JpcHRpb25zW2luZGV4XS5zdWJzY3JpYmUsIHNlbGYuc2NoZWR1bGVyLmNsb2NrKTtcblx0ICAgICAgfSxcblx0ICAgICAgZnVuY3Rpb24gKGVycikge1xuXHQgICAgICAgIG9uUmVqZWN0ZWQoZXJyKTtcblx0ICAgICAgICB2YXIgaWR4ID0gc2VsZi5vYnNlcnZlcnMuaW5kZXhPZihvYnNlcnZlcik7XG5cdCAgICAgICAgc2VsZi5vYnNlcnZlcnMuc3BsaWNlKGlkeCwgMSk7XG5cdCAgICAgICAgc2VsZi5zdWJzY3JpcHRpb25zW2luZGV4XSA9IG5ldyBTdWJzY3JpcHRpb24oc2VsZi5zdWJzY3JpcHRpb25zW2luZGV4XS5zdWJzY3JpYmUsIHNlbGYuc2NoZWR1bGVyLmNsb2NrKTtcblx0ICAgICAgfVxuXHQgICAgKTtcblx0ICAgIHRoaXMub2JzZXJ2ZXJzLnB1c2gob2JzZXJ2ZXIpO1xuXHRcblx0ICAgIHJldHVybiBuZXdQcm9taXNlIHx8IG5ldyBNb2NrUHJvbWlzZSh0aGlzLnNjaGVkdWxlciwgdGhpcy5tZXNzYWdlcyk7XG5cdCAgfTtcblx0XG5cdCAgdmFyIEhvdE9ic2VydmFibGUgPSAoZnVuY3Rpb24gKF9fc3VwZXJfXykge1xuXHQgICAgaW5oZXJpdHMoSG90T2JzZXJ2YWJsZSwgX19zdXBlcl9fKTtcblx0XG5cdCAgICBmdW5jdGlvbiBIb3RPYnNlcnZhYmxlKHNjaGVkdWxlciwgbWVzc2FnZXMpIHtcblx0ICAgICAgX19zdXBlcl9fLmNhbGwodGhpcyk7XG5cdCAgICAgIHZhciBtZXNzYWdlLCBub3RpZmljYXRpb24sIG9ic2VydmFibGUgPSB0aGlzO1xuXHQgICAgICB0aGlzLnNjaGVkdWxlciA9IHNjaGVkdWxlcjtcblx0ICAgICAgdGhpcy5tZXNzYWdlcyA9IG1lc3NhZ2VzO1xuXHQgICAgICB0aGlzLnN1YnNjcmlwdGlvbnMgPSBbXTtcblx0ICAgICAgdGhpcy5vYnNlcnZlcnMgPSBbXTtcblx0ICAgICAgZm9yICh2YXIgaSA9IDAsIGxlbiA9IHRoaXMubWVzc2FnZXMubGVuZ3RoOyBpIDwgbGVuOyBpKyspIHtcblx0ICAgICAgICBtZXNzYWdlID0gdGhpcy5tZXNzYWdlc1tpXTtcblx0ICAgICAgICBub3RpZmljYXRpb24gPSBtZXNzYWdlLnZhbHVlO1xuXHQgICAgICAgIChmdW5jdGlvbiAoaW5uZXJOb3RpZmljYXRpb24pIHtcblx0ICAgICAgICAgIHNjaGVkdWxlci5zY2hlZHVsZUFic29sdXRlKG51bGwsIG1lc3NhZ2UudGltZSwgZnVuY3Rpb24gKCkge1xuXHQgICAgICAgICAgICB2YXIgb2JzID0gb2JzZXJ2YWJsZS5vYnNlcnZlcnMuc2xpY2UoMCk7XG5cdFxuXHQgICAgICAgICAgICBmb3IgKHZhciBqID0gMCwgakxlbiA9IG9icy5sZW5ndGg7IGogPCBqTGVuOyBqKyspIHtcblx0ICAgICAgICAgICAgICBpbm5lck5vdGlmaWNhdGlvbi5hY2NlcHQob2JzW2pdKTtcblx0ICAgICAgICAgICAgfVxuXHQgICAgICAgICAgICByZXR1cm4gZGlzcG9zYWJsZUVtcHR5O1xuXHQgICAgICAgICAgfSk7XG5cdCAgICAgICAgfSkobm90aWZpY2F0aW9uKTtcblx0ICAgICAgfVxuXHQgICAgfVxuXHRcblx0ICAgIEhvdE9ic2VydmFibGUucHJvdG90eXBlLl9zdWJzY3JpYmUgPSBmdW5jdGlvbiAobykge1xuXHQgICAgICB2YXIgb2JzZXJ2YWJsZSA9IHRoaXM7XG5cdCAgICAgIHRoaXMub2JzZXJ2ZXJzLnB1c2gobyk7XG5cdCAgICAgIHRoaXMuc3Vic2NyaXB0aW9ucy5wdXNoKG5ldyBTdWJzY3JpcHRpb24odGhpcy5zY2hlZHVsZXIuY2xvY2spKTtcblx0ICAgICAgdmFyIGluZGV4ID0gdGhpcy5zdWJzY3JpcHRpb25zLmxlbmd0aCAtIDE7XG5cdCAgICAgIHJldHVybiBkaXNwb3NhYmxlQ3JlYXRlKGZ1bmN0aW9uICgpIHtcblx0ICAgICAgICB2YXIgaWR4ID0gb2JzZXJ2YWJsZS5vYnNlcnZlcnMuaW5kZXhPZihvKTtcblx0ICAgICAgICBvYnNlcnZhYmxlLm9ic2VydmVycy5zcGxpY2UoaWR4LCAxKTtcblx0ICAgICAgICBvYnNlcnZhYmxlLnN1YnNjcmlwdGlvbnNbaW5kZXhdID0gbmV3IFN1YnNjcmlwdGlvbihvYnNlcnZhYmxlLnN1YnNjcmlwdGlvbnNbaW5kZXhdLnN1YnNjcmliZSwgb2JzZXJ2YWJsZS5zY2hlZHVsZXIuY2xvY2spO1xuXHQgICAgICB9KTtcblx0ICAgIH07XG5cdFxuXHQgICAgcmV0dXJuIEhvdE9ic2VydmFibGU7XG5cdCAgfSkoT2JzZXJ2YWJsZSk7XG5cdFxuXHQgIHZhciBDb2xkT2JzZXJ2YWJsZSA9IChmdW5jdGlvbiAoX19zdXBlcl9fKSB7XG5cdCAgICBpbmhlcml0cyhDb2xkT2JzZXJ2YWJsZSwgX19zdXBlcl9fKTtcblx0XG5cdCAgICBmdW5jdGlvbiBDb2xkT2JzZXJ2YWJsZShzY2hlZHVsZXIsIG1lc3NhZ2VzKSB7XG5cdCAgICAgIF9fc3VwZXJfXy5jYWxsKHRoaXMpO1xuXHQgICAgICB0aGlzLnNjaGVkdWxlciA9IHNjaGVkdWxlcjtcblx0ICAgICAgdGhpcy5tZXNzYWdlcyA9IG1lc3NhZ2VzO1xuXHQgICAgICB0aGlzLnN1YnNjcmlwdGlvbnMgPSBbXTtcblx0ICAgIH1cblx0XG5cdCAgICBDb2xkT2JzZXJ2YWJsZS5wcm90b3R5cGUuX3N1YnNjcmliZSA9IGZ1bmN0aW9uIChvKSB7XG5cdCAgICAgIHZhciBtZXNzYWdlLCBub3RpZmljYXRpb24sIG9ic2VydmFibGUgPSB0aGlzO1xuXHQgICAgICB0aGlzLnN1YnNjcmlwdGlvbnMucHVzaChuZXcgU3Vic2NyaXB0aW9uKHRoaXMuc2NoZWR1bGVyLmNsb2NrKSk7XG5cdCAgICAgIHZhciBpbmRleCA9IHRoaXMuc3Vic2NyaXB0aW9ucy5sZW5ndGggLSAxO1xuXHQgICAgICB2YXIgZCA9IG5ldyBDb21wb3NpdGVEaXNwb3NhYmxlKCk7XG5cdCAgICAgIGZvciAodmFyIGkgPSAwLCBsZW4gPSB0aGlzLm1lc3NhZ2VzLmxlbmd0aDsgaSA8IGxlbjsgaSsrKSB7XG5cdCAgICAgICAgbWVzc2FnZSA9IHRoaXMubWVzc2FnZXNbaV07XG5cdCAgICAgICAgbm90aWZpY2F0aW9uID0gbWVzc2FnZS52YWx1ZTtcblx0ICAgICAgICAoZnVuY3Rpb24gKGlubmVyTm90aWZpY2F0aW9uKSB7XG5cdCAgICAgICAgICBkLmFkZChvYnNlcnZhYmxlLnNjaGVkdWxlci5zY2hlZHVsZVJlbGF0aXZlKG51bGwsIG1lc3NhZ2UudGltZSwgZnVuY3Rpb24gKCkge1xuXHQgICAgICAgICAgICBpbm5lck5vdGlmaWNhdGlvbi5hY2NlcHQobyk7XG5cdCAgICAgICAgICAgIHJldHVybiBkaXNwb3NhYmxlRW1wdHk7XG5cdCAgICAgICAgICB9KSk7XG5cdCAgICAgICAgfSkobm90aWZpY2F0aW9uKTtcblx0ICAgICAgfVxuXHQgICAgICByZXR1cm4gZGlzcG9zYWJsZUNyZWF0ZShmdW5jdGlvbiAoKSB7XG5cdCAgICAgICAgb2JzZXJ2YWJsZS5zdWJzY3JpcHRpb25zW2luZGV4XSA9IG5ldyBTdWJzY3JpcHRpb24ob2JzZXJ2YWJsZS5zdWJzY3JpcHRpb25zW2luZGV4XS5zdWJzY3JpYmUsIG9ic2VydmFibGUuc2NoZWR1bGVyLmNsb2NrKTtcblx0ICAgICAgICBkLmRpc3Bvc2UoKTtcblx0ICAgICAgfSk7XG5cdCAgICB9O1xuXHRcblx0ICAgIHJldHVybiBDb2xkT2JzZXJ2YWJsZTtcblx0ICB9KShPYnNlcnZhYmxlKTtcblx0XG5cdCAgLyoqIFZpcnR1YWwgdGltZSBzY2hlZHVsZXIgdXNlZCBmb3IgdGVzdGluZyBhcHBsaWNhdGlvbnMgYW5kIGxpYnJhcmllcyBidWlsdCB1c2luZyBSZWFjdGl2ZSBFeHRlbnNpb25zLiAqL1xuXHQgIFJ4LlRlc3RTY2hlZHVsZXIgPSAoZnVuY3Rpb24gKF9fc3VwZXJfXykge1xuXHQgICAgaW5oZXJpdHMoVGVzdFNjaGVkdWxlciwgX19zdXBlcl9fKTtcblx0XG5cdCAgICBmdW5jdGlvbiBiYXNlQ29tcGFyZXIoeCwgeSkge1xuXHQgICAgICByZXR1cm4geCA+IHkgPyAxIDogKHggPCB5ID8gLTEgOiAwKTtcblx0ICAgIH1cblx0XG5cdCAgICBmdW5jdGlvbiBUZXN0U2NoZWR1bGVyKCkge1xuXHQgICAgICBfX3N1cGVyX18uY2FsbCh0aGlzLCAwLCBiYXNlQ29tcGFyZXIpO1xuXHQgICAgfVxuXHRcblx0ICAgIC8qKlxuXHQgICAgICogU2NoZWR1bGVzIGFuIGFjdGlvbiB0byBiZSBleGVjdXRlZCBhdCB0aGUgc3BlY2lmaWVkIHZpcnR1YWwgdGltZS5cblx0ICAgICAqXG5cdCAgICAgKiBAcGFyYW0gc3RhdGUgU3RhdGUgcGFzc2VkIHRvIHRoZSBhY3Rpb24gdG8gYmUgZXhlY3V0ZWQuXG5cdCAgICAgKiBAcGFyYW0gZHVlVGltZSBBYnNvbHV0ZSB2aXJ0dWFsIHRpbWUgYXQgd2hpY2ggdG8gZXhlY3V0ZSB0aGUgYWN0aW9uLlxuXHQgICAgICogQHBhcmFtIGFjdGlvbiBBY3Rpb24gdG8gYmUgZXhlY3V0ZWQuXG5cdCAgICAgKiBAcmV0dXJuIERpc3Bvc2FibGUgb2JqZWN0IHVzZWQgdG8gY2FuY2VsIHRoZSBzY2hlZHVsZWQgYWN0aW9uIChiZXN0IGVmZm9ydCkuXG5cdCAgICAgKi9cblx0ICAgIFRlc3RTY2hlZHVsZXIucHJvdG90eXBlLnNjaGVkdWxlQWJzb2x1dGUgPSBmdW5jdGlvbiAoc3RhdGUsIGR1ZVRpbWUsIGFjdGlvbikge1xuXHQgICAgICBkdWVUaW1lIDw9IHRoaXMuY2xvY2sgJiYgKGR1ZVRpbWUgPSB0aGlzLmNsb2NrICsgMSk7XG5cdCAgICAgIHJldHVybiBfX3N1cGVyX18ucHJvdG90eXBlLnNjaGVkdWxlQWJzb2x1dGUuY2FsbCh0aGlzLCBzdGF0ZSwgZHVlVGltZSwgYWN0aW9uKTtcblx0ICAgIH07XG5cdCAgICAvKipcblx0ICAgICAqIEFkZHMgYSByZWxhdGl2ZSB2aXJ0dWFsIHRpbWUgdG8gYW4gYWJzb2x1dGUgdmlydHVhbCB0aW1lIHZhbHVlLlxuXHQgICAgICpcblx0ICAgICAqIEBwYXJhbSBhYnNvbHV0ZSBBYnNvbHV0ZSB2aXJ0dWFsIHRpbWUgdmFsdWUuXG5cdCAgICAgKiBAcGFyYW0gcmVsYXRpdmUgUmVsYXRpdmUgdmlydHVhbCB0aW1lIHZhbHVlIHRvIGFkZC5cblx0ICAgICAqIEByZXR1cm4gUmVzdWx0aW5nIGFic29sdXRlIHZpcnR1YWwgdGltZSBzdW0gdmFsdWUuXG5cdCAgICAgKi9cblx0ICAgIFRlc3RTY2hlZHVsZXIucHJvdG90eXBlLmFkZCA9IGZ1bmN0aW9uIChhYnNvbHV0ZSwgcmVsYXRpdmUpIHtcblx0ICAgICAgcmV0dXJuIGFic29sdXRlICsgcmVsYXRpdmU7XG5cdCAgICB9O1xuXHQgICAgLyoqXG5cdCAgICAgKiBDb252ZXJ0cyB0aGUgYWJzb2x1dGUgdmlydHVhbCB0aW1lIHZhbHVlIHRvIGEgRGF0ZVRpbWVPZmZzZXQgdmFsdWUuXG5cdCAgICAgKlxuXHQgICAgICogQHBhcmFtIGFic29sdXRlIEFic29sdXRlIHZpcnR1YWwgdGltZSB2YWx1ZSB0byBjb252ZXJ0LlxuXHQgICAgICogQHJldHVybiBDb3JyZXNwb25kaW5nIERhdGVUaW1lT2Zmc2V0IHZhbHVlLlxuXHQgICAgICovXG5cdCAgICBUZXN0U2NoZWR1bGVyLnByb3RvdHlwZS50b0Fic29sdXRlVGltZSA9IGZ1bmN0aW9uIChhYnNvbHV0ZSkge1xuXHQgICAgICByZXR1cm4gbmV3IERhdGUoYWJzb2x1dGUpLmdldFRpbWUoKTtcblx0ICAgIH07XG5cdCAgICAvKipcblx0ICAgICAqIENvbnZlcnRzIHRoZSBUaW1lU3BhbiB2YWx1ZSB0byBhIHJlbGF0aXZlIHZpcnR1YWwgdGltZSB2YWx1ZS5cblx0ICAgICAqXG5cdCAgICAgKiBAcGFyYW0gdGltZVNwYW4gVGltZVNwYW4gdmFsdWUgdG8gY29udmVydC5cblx0ICAgICAqIEByZXR1cm4gQ29ycmVzcG9uZGluZyByZWxhdGl2ZSB2aXJ0dWFsIHRpbWUgdmFsdWUuXG5cdCAgICAgKi9cblx0ICAgIFRlc3RTY2hlZHVsZXIucHJvdG90eXBlLnRvUmVsYXRpdmVUaW1lID0gZnVuY3Rpb24gKHRpbWVTcGFuKSB7XG5cdCAgICAgIHJldHVybiB0aW1lU3Bhbjtcblx0ICAgIH07XG5cdCAgICAvKipcblx0ICAgICAqIFN0YXJ0cyB0aGUgdGVzdCBzY2hlZHVsZXIgYW5kIHVzZXMgdGhlIHNwZWNpZmllZCB2aXJ0dWFsIHRpbWVzIHRvIGludm9rZSB0aGUgZmFjdG9yeSBmdW5jdGlvbiwgc3Vic2NyaWJlIHRvIHRoZSByZXN1bHRpbmcgc2VxdWVuY2UsIGFuZCBkaXNwb3NlIHRoZSBzdWJzY3JpcHRpb24uXG5cdCAgICAgKlxuXHQgICAgICogQHBhcmFtIGNyZWF0ZSBGYWN0b3J5IG1ldGhvZCB0byBjcmVhdGUgYW4gb2JzZXJ2YWJsZSBzZXF1ZW5jZS5cblx0ICAgICAqIEBwYXJhbSBjcmVhdGVkIFZpcnR1YWwgdGltZSBhdCB3aGljaCB0byBpbnZva2UgdGhlIGZhY3RvcnkgdG8gY3JlYXRlIGFuIG9ic2VydmFibGUgc2VxdWVuY2UuXG5cdCAgICAgKiBAcGFyYW0gc3Vic2NyaWJlZCBWaXJ0dWFsIHRpbWUgYXQgd2hpY2ggdG8gc3Vic2NyaWJlIHRvIHRoZSBjcmVhdGVkIG9ic2VydmFibGUgc2VxdWVuY2UuXG5cdCAgICAgKiBAcGFyYW0gZGlzcG9zZWQgVmlydHVhbCB0aW1lIGF0IHdoaWNoIHRvIGRpc3Bvc2UgdGhlIHN1YnNjcmlwdGlvbi5cblx0ICAgICAqIEByZXR1cm4gT2JzZXJ2ZXIgd2l0aCB0aW1lc3RhbXBlZCByZWNvcmRpbmdzIG9mIG5vdGlmaWNhdGlvbiBtZXNzYWdlcyB0aGF0IHdlcmUgcmVjZWl2ZWQgZHVyaW5nIHRoZSB2aXJ0dWFsIHRpbWUgd2luZG93IHdoZW4gdGhlIHN1YnNjcmlwdGlvbiB0byB0aGUgc291cmNlIHNlcXVlbmNlIHdhcyBhY3RpdmUuXG5cdCAgICAgKi9cblx0ICAgIFRlc3RTY2hlZHVsZXIucHJvdG90eXBlLnN0YXJ0U2NoZWR1bGVyID0gZnVuY3Rpb24gKGNyZWF0ZUZuLCBzZXR0aW5ncykge1xuXHQgICAgICBzZXR0aW5ncyB8fCAoc2V0dGluZ3MgPSB7fSk7XG5cdCAgICAgIHNldHRpbmdzLmNyZWF0ZWQgPT0gbnVsbCAmJiAoc2V0dGluZ3MuY3JlYXRlZCA9IFJlYWN0aXZlVGVzdC5jcmVhdGVkKTtcblx0ICAgICAgc2V0dGluZ3Muc3Vic2NyaWJlZCA9PSBudWxsICYmIChzZXR0aW5ncy5zdWJzY3JpYmVkID0gUmVhY3RpdmVUZXN0LnN1YnNjcmliZWQpO1xuXHQgICAgICBzZXR0aW5ncy5kaXNwb3NlZCA9PSBudWxsICYmIChzZXR0aW5ncy5kaXNwb3NlZCA9IFJlYWN0aXZlVGVzdC5kaXNwb3NlZCk7XG5cdFxuXHQgICAgICB2YXIgb2JzZXJ2ZXIgPSB0aGlzLmNyZWF0ZU9ic2VydmVyKCksIHNvdXJjZSwgc3Vic2NyaXB0aW9uO1xuXHRcblx0ICAgICAgdGhpcy5zY2hlZHVsZUFic29sdXRlKG51bGwsIHNldHRpbmdzLmNyZWF0ZWQsIGZ1bmN0aW9uICgpIHtcblx0ICAgICAgICBzb3VyY2UgPSBjcmVhdGVGbigpO1xuXHQgICAgICAgIHJldHVybiBkaXNwb3NhYmxlRW1wdHk7XG5cdCAgICAgIH0pO1xuXHRcblx0ICAgICAgdGhpcy5zY2hlZHVsZUFic29sdXRlKG51bGwsIHNldHRpbmdzLnN1YnNjcmliZWQsIGZ1bmN0aW9uICgpIHtcblx0ICAgICAgICBzdWJzY3JpcHRpb24gPSBzb3VyY2Uuc3Vic2NyaWJlKG9ic2VydmVyKTtcblx0ICAgICAgICByZXR1cm4gZGlzcG9zYWJsZUVtcHR5O1xuXHQgICAgICB9KTtcblx0XG5cdCAgICAgIHRoaXMuc2NoZWR1bGVBYnNvbHV0ZShudWxsLCBzZXR0aW5ncy5kaXNwb3NlZCwgZnVuY3Rpb24gKCkge1xuXHQgICAgICAgIHN1YnNjcmlwdGlvbi5kaXNwb3NlKCk7XG5cdCAgICAgICAgcmV0dXJuIGRpc3Bvc2FibGVFbXB0eTtcblx0ICAgICAgfSk7XG5cdFxuXHQgICAgICB0aGlzLnN0YXJ0KCk7XG5cdFxuXHQgICAgICByZXR1cm4gb2JzZXJ2ZXI7XG5cdCAgICB9O1xuXHRcblx0ICAgIC8qKlxuXHQgICAgICogQ3JlYXRlcyBhIGhvdCBvYnNlcnZhYmxlIHVzaW5nIHRoZSBzcGVjaWZpZWQgdGltZXN0YW1wZWQgbm90aWZpY2F0aW9uIG1lc3NhZ2VzIGVpdGhlciBhcyBhbiBhcnJheSBvciBhcmd1bWVudHMuXG5cdCAgICAgKiBAcGFyYW0gbWVzc2FnZXMgTm90aWZpY2F0aW9ucyB0byBzdXJmYWNlIHRocm91Z2ggdGhlIGNyZWF0ZWQgc2VxdWVuY2UgYXQgdGhlaXIgc3BlY2lmaWVkIGFic29sdXRlIHZpcnR1YWwgdGltZXMuXG5cdCAgICAgKiBAcmV0dXJuIEhvdCBvYnNlcnZhYmxlIHNlcXVlbmNlIHRoYXQgY2FuIGJlIHVzZWQgdG8gYXNzZXJ0IHRoZSB0aW1pbmcgb2Ygc3Vic2NyaXB0aW9ucyBhbmQgbm90aWZpY2F0aW9ucy5cblx0ICAgICAqL1xuXHQgICAgVGVzdFNjaGVkdWxlci5wcm90b3R5cGUuY3JlYXRlSG90T2JzZXJ2YWJsZSA9IGZ1bmN0aW9uICgpIHtcblx0ICAgICAgdmFyIGxlbiA9IGFyZ3VtZW50cy5sZW5ndGgsIGFyZ3M7XG5cdCAgICAgIGlmIChBcnJheS5pc0FycmF5KGFyZ3VtZW50c1swXSkpIHtcblx0ICAgICAgICBhcmdzID0gYXJndW1lbnRzWzBdO1xuXHQgICAgICB9IGVsc2Uge1xuXHQgICAgICAgIGFyZ3MgPSBuZXcgQXJyYXkobGVuKTtcblx0ICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGxlbjsgaSsrKSB7IGFyZ3NbaV0gPSBhcmd1bWVudHNbaV07IH1cblx0ICAgICAgfVxuXHQgICAgICByZXR1cm4gbmV3IEhvdE9ic2VydmFibGUodGhpcywgYXJncyk7XG5cdCAgICB9O1xuXHRcblx0ICAgIC8qKlxuXHQgICAgICogQ3JlYXRlcyBhIGNvbGQgb2JzZXJ2YWJsZSB1c2luZyB0aGUgc3BlY2lmaWVkIHRpbWVzdGFtcGVkIG5vdGlmaWNhdGlvbiBtZXNzYWdlcyBlaXRoZXIgYXMgYW4gYXJyYXkgb3IgYXJndW1lbnRzLlxuXHQgICAgICogQHBhcmFtIG1lc3NhZ2VzIE5vdGlmaWNhdGlvbnMgdG8gc3VyZmFjZSB0aHJvdWdoIHRoZSBjcmVhdGVkIHNlcXVlbmNlIGF0IHRoZWlyIHNwZWNpZmllZCB2aXJ0dWFsIHRpbWUgb2Zmc2V0cyBmcm9tIHRoZSBzZXF1ZW5jZSBzdWJzY3JpcHRpb24gdGltZS5cblx0ICAgICAqIEByZXR1cm4gQ29sZCBvYnNlcnZhYmxlIHNlcXVlbmNlIHRoYXQgY2FuIGJlIHVzZWQgdG8gYXNzZXJ0IHRoZSB0aW1pbmcgb2Ygc3Vic2NyaXB0aW9ucyBhbmQgbm90aWZpY2F0aW9ucy5cblx0ICAgICAqL1xuXHQgICAgVGVzdFNjaGVkdWxlci5wcm90b3R5cGUuY3JlYXRlQ29sZE9ic2VydmFibGUgPSBmdW5jdGlvbiAoKSB7XG5cdCAgICAgIHZhciBsZW4gPSBhcmd1bWVudHMubGVuZ3RoLCBhcmdzO1xuXHQgICAgICBpZiAoQXJyYXkuaXNBcnJheShhcmd1bWVudHNbMF0pKSB7XG5cdCAgICAgICAgYXJncyA9IGFyZ3VtZW50c1swXTtcblx0ICAgICAgfSBlbHNlIHtcblx0ICAgICAgICBhcmdzID0gbmV3IEFycmF5KGxlbik7XG5cdCAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBsZW47IGkrKykgeyBhcmdzW2ldID0gYXJndW1lbnRzW2ldOyB9XG5cdCAgICAgIH1cblx0ICAgICAgcmV0dXJuIG5ldyBDb2xkT2JzZXJ2YWJsZSh0aGlzLCBhcmdzKTtcblx0ICAgIH07XG5cdFxuXHQgICAgLyoqXG5cdCAgICAgKiBDcmVhdGVzIGEgcmVzb2x2ZWQgcHJvbWlzZSB3aXRoIHRoZSBnaXZlbiB2YWx1ZSBhbmQgdGlja3Ncblx0ICAgICAqIEBwYXJhbSB7TnVtYmVyfSB0aWNrcyBUaGUgYWJzb2x1dGUgdGltZSBvZiB0aGUgcmVzb2x1dGlvbi5cblx0ICAgICAqIEBwYXJhbSB7QW55fSB2YWx1ZSBUaGUgdmFsdWUgdG8geWllbGQgYXQgdGhlIGdpdmVuIHRpY2suXG5cdCAgICAgKiBAcmV0dXJucyB7TW9ja1Byb21pc2V9IEEgbW9jayBQcm9taXNlIHdoaWNoIGZ1bGZpbGxzIHdpdGggdGhlIGdpdmVuIHZhbHVlLlxuXHQgICAgICovXG5cdCAgICBUZXN0U2NoZWR1bGVyLnByb3RvdHlwZS5jcmVhdGVSZXNvbHZlZFByb21pc2UgPSBmdW5jdGlvbiAodGlja3MsIHZhbHVlKSB7XG5cdCAgICAgIHJldHVybiBuZXcgTW9ja1Byb21pc2UodGhpcywgW1J4LlJlYWN0aXZlVGVzdC5vbk5leHQodGlja3MsIHZhbHVlKSwgUnguUmVhY3RpdmVUZXN0Lm9uQ29tcGxldGVkKHRpY2tzKV0pO1xuXHQgICAgfTtcblx0XG5cdCAgICAvKipcblx0ICAgICAqIENyZWF0ZXMgYSByZWplY3RlZCBwcm9taXNlIHdpdGggdGhlIGdpdmVuIHJlYXNvbiBhbmQgdGlja3Ncblx0ICAgICAqIEBwYXJhbSB7TnVtYmVyfSB0aWNrcyBUaGUgYWJzb2x1dGUgdGltZSBvZiB0aGUgcmVzb2x1dGlvbi5cblx0ICAgICAqIEBwYXJhbSB7QW55fSByZWFzb24gVGhlIHJlYXNvbiBmb3IgcmVqZWN0aW9uIHRvIHlpZWxkIGF0IHRoZSBnaXZlbiB0aWNrLlxuXHQgICAgICogQHJldHVybnMge01vY2tQcm9taXNlfSBBIG1vY2sgUHJvbWlzZSB3aGljaCByZWplY3RzIHdpdGggdGhlIGdpdmVuIHJlYXNvbi5cblx0ICAgICAqL1xuXHQgICAgVGVzdFNjaGVkdWxlci5wcm90b3R5cGUuY3JlYXRlUmVqZWN0ZWRQcm9taXNlID0gZnVuY3Rpb24gKHRpY2tzLCByZWFzb24pIHtcblx0ICAgICAgcmV0dXJuIG5ldyBNb2NrUHJvbWlzZSh0aGlzLCBbUnguUmVhY3RpdmVUZXN0Lm9uRXJyb3IodGlja3MsIHJlYXNvbildKTtcblx0ICAgIH07XG5cdFxuXHQgICAgLyoqXG5cdCAgICAgKiBDcmVhdGVzIGFuIG9ic2VydmVyIHRoYXQgcmVjb3JkcyByZWNlaXZlZCBub3RpZmljYXRpb24gbWVzc2FnZXMgYW5kIHRpbWVzdGFtcHMgdGhvc2UuXG5cdCAgICAgKiBAcmV0dXJuIE9ic2VydmVyIHRoYXQgY2FuIGJlIHVzZWQgdG8gYXNzZXJ0IHRoZSB0aW1pbmcgb2YgcmVjZWl2ZWQgbm90aWZpY2F0aW9ucy5cblx0ICAgICAqL1xuXHQgICAgVGVzdFNjaGVkdWxlci5wcm90b3R5cGUuY3JlYXRlT2JzZXJ2ZXIgPSBmdW5jdGlvbiAoKSB7XG5cdCAgICAgIHJldHVybiBuZXcgTW9ja09ic2VydmVyKHRoaXMpO1xuXHQgICAgfTtcblx0XG5cdCAgICByZXR1cm4gVGVzdFNjaGVkdWxlcjtcblx0ICB9KShWaXJ0dWFsVGltZVNjaGVkdWxlcik7XG5cdFxuXHQgIHZhciBBbm9ueW1vdXNPYnNlcnZhYmxlID0gUnguQW5vbnltb3VzT2JzZXJ2YWJsZSA9IChmdW5jdGlvbiAoX19zdXBlcl9fKSB7XG5cdCAgICBpbmhlcml0cyhBbm9ueW1vdXNPYnNlcnZhYmxlLCBfX3N1cGVyX18pO1xuXHRcblx0ICAgIC8vIEZpeCBzdWJzY3JpYmVyIHRvIGNoZWNrIGZvciB1bmRlZmluZWQgb3IgZnVuY3Rpb24gcmV0dXJuZWQgdG8gZGVjb3JhdGUgYXMgRGlzcG9zYWJsZVxuXHQgICAgZnVuY3Rpb24gZml4U3Vic2NyaWJlcihzdWJzY3JpYmVyKSB7XG5cdCAgICAgIHJldHVybiBzdWJzY3JpYmVyICYmIGlzRnVuY3Rpb24oc3Vic2NyaWJlci5kaXNwb3NlKSA/IHN1YnNjcmliZXIgOlxuXHQgICAgICAgIGlzRnVuY3Rpb24oc3Vic2NyaWJlcikgPyBkaXNwb3NhYmxlQ3JlYXRlKHN1YnNjcmliZXIpIDogZGlzcG9zYWJsZUVtcHR5O1xuXHQgICAgfVxuXHRcblx0ICAgIGZ1bmN0aW9uIHNldERpc3Bvc2FibGUocywgc3RhdGUpIHtcblx0ICAgICAgdmFyIGFkbyA9IHN0YXRlWzBdLCBzZWxmID0gc3RhdGVbMV07XG5cdCAgICAgIHZhciBzdWIgPSB0cnlDYXRjaChzZWxmLl9fc3Vic2NyaWJlKS5jYWxsKHNlbGYsIGFkbyk7XG5cdCAgICAgIGlmIChzdWIgPT09IGVycm9yT2JqICYmICFhZG8uZmFpbChlcnJvck9iai5lKSkgeyB0aHJvd2VyKGVycm9yT2JqLmUpOyB9XG5cdCAgICAgIGFkby5zZXREaXNwb3NhYmxlKGZpeFN1YnNjcmliZXIoc3ViKSk7XG5cdCAgICB9XG5cdFxuXHQgICAgZnVuY3Rpb24gQW5vbnltb3VzT2JzZXJ2YWJsZShzdWJzY3JpYmUsIHBhcmVudCkge1xuXHQgICAgICB0aGlzLnNvdXJjZSA9IHBhcmVudDtcblx0ICAgICAgdGhpcy5fX3N1YnNjcmliZSA9IHN1YnNjcmliZTtcblx0ICAgICAgX19zdXBlcl9fLmNhbGwodGhpcyk7XG5cdCAgICB9XG5cdFxuXHQgICAgQW5vbnltb3VzT2JzZXJ2YWJsZS5wcm90b3R5cGUuX3N1YnNjcmliZSA9IGZ1bmN0aW9uIChvKSB7XG5cdCAgICAgIHZhciBhZG8gPSBuZXcgQXV0b0RldGFjaE9ic2VydmVyKG8pLCBzdGF0ZSA9IFthZG8sIHRoaXNdO1xuXHRcblx0ICAgICAgaWYgKGN1cnJlbnRUaHJlYWRTY2hlZHVsZXIuc2NoZWR1bGVSZXF1aXJlZCgpKSB7XG5cdCAgICAgICAgY3VycmVudFRocmVhZFNjaGVkdWxlci5zY2hlZHVsZShzdGF0ZSwgc2V0RGlzcG9zYWJsZSk7XG5cdCAgICAgIH0gZWxzZSB7XG5cdCAgICAgICAgc2V0RGlzcG9zYWJsZShudWxsLCBzdGF0ZSk7XG5cdCAgICAgIH1cblx0ICAgICAgcmV0dXJuIGFkbztcblx0ICAgIH07XG5cdFxuXHQgICAgcmV0dXJuIEFub255bW91c09ic2VydmFibGU7XG5cdFxuXHQgIH0oT2JzZXJ2YWJsZSkpO1xuXHRcblx0ICB2YXIgQXV0b0RldGFjaE9ic2VydmVyID0gKGZ1bmN0aW9uIChfX3N1cGVyX18pIHtcblx0ICAgIGluaGVyaXRzKEF1dG9EZXRhY2hPYnNlcnZlciwgX19zdXBlcl9fKTtcblx0XG5cdCAgICBmdW5jdGlvbiBBdXRvRGV0YWNoT2JzZXJ2ZXIob2JzZXJ2ZXIpIHtcblx0ICAgICAgX19zdXBlcl9fLmNhbGwodGhpcyk7XG5cdCAgICAgIHRoaXMub2JzZXJ2ZXIgPSBvYnNlcnZlcjtcblx0ICAgICAgdGhpcy5tID0gbmV3IFNpbmdsZUFzc2lnbm1lbnREaXNwb3NhYmxlKCk7XG5cdCAgICB9XG5cdFxuXHQgICAgdmFyIEF1dG9EZXRhY2hPYnNlcnZlclByb3RvdHlwZSA9IEF1dG9EZXRhY2hPYnNlcnZlci5wcm90b3R5cGU7XG5cdFxuXHQgICAgQXV0b0RldGFjaE9ic2VydmVyUHJvdG90eXBlLm5leHQgPSBmdW5jdGlvbiAodmFsdWUpIHtcblx0ICAgICAgdmFyIHJlc3VsdCA9IHRyeUNhdGNoKHRoaXMub2JzZXJ2ZXIub25OZXh0KS5jYWxsKHRoaXMub2JzZXJ2ZXIsIHZhbHVlKTtcblx0ICAgICAgaWYgKHJlc3VsdCA9PT0gZXJyb3JPYmopIHtcblx0ICAgICAgICB0aGlzLmRpc3Bvc2UoKTtcblx0ICAgICAgICB0aHJvd2VyKHJlc3VsdC5lKTtcblx0ICAgICAgfVxuXHQgICAgfTtcblx0XG5cdCAgICBBdXRvRGV0YWNoT2JzZXJ2ZXJQcm90b3R5cGUuZXJyb3IgPSBmdW5jdGlvbiAoZXJyKSB7XG5cdCAgICAgIHZhciByZXN1bHQgPSB0cnlDYXRjaCh0aGlzLm9ic2VydmVyLm9uRXJyb3IpLmNhbGwodGhpcy5vYnNlcnZlciwgZXJyKTtcblx0ICAgICAgdGhpcy5kaXNwb3NlKCk7XG5cdCAgICAgIHJlc3VsdCA9PT0gZXJyb3JPYmogJiYgdGhyb3dlcihyZXN1bHQuZSk7XG5cdCAgICB9O1xuXHRcblx0ICAgIEF1dG9EZXRhY2hPYnNlcnZlclByb3RvdHlwZS5jb21wbGV0ZWQgPSBmdW5jdGlvbiAoKSB7XG5cdCAgICAgIHZhciByZXN1bHQgPSB0cnlDYXRjaCh0aGlzLm9ic2VydmVyLm9uQ29tcGxldGVkKS5jYWxsKHRoaXMub2JzZXJ2ZXIpO1xuXHQgICAgICB0aGlzLmRpc3Bvc2UoKTtcblx0ICAgICAgcmVzdWx0ID09PSBlcnJvck9iaiAmJiB0aHJvd2VyKHJlc3VsdC5lKTtcblx0ICAgIH07XG5cdFxuXHQgICAgQXV0b0RldGFjaE9ic2VydmVyUHJvdG90eXBlLnNldERpc3Bvc2FibGUgPSBmdW5jdGlvbiAodmFsdWUpIHsgdGhpcy5tLnNldERpc3Bvc2FibGUodmFsdWUpOyB9O1xuXHQgICAgQXV0b0RldGFjaE9ic2VydmVyUHJvdG90eXBlLmdldERpc3Bvc2FibGUgPSBmdW5jdGlvbiAoKSB7IHJldHVybiB0aGlzLm0uZ2V0RGlzcG9zYWJsZSgpOyB9O1xuXHRcblx0ICAgIEF1dG9EZXRhY2hPYnNlcnZlclByb3RvdHlwZS5kaXNwb3NlID0gZnVuY3Rpb24gKCkge1xuXHQgICAgICBfX3N1cGVyX18ucHJvdG90eXBlLmRpc3Bvc2UuY2FsbCh0aGlzKTtcblx0ICAgICAgdGhpcy5tLmRpc3Bvc2UoKTtcblx0ICAgIH07XG5cdFxuXHQgICAgcmV0dXJuIEF1dG9EZXRhY2hPYnNlcnZlcjtcblx0ICB9KEFic3RyYWN0T2JzZXJ2ZXIpKTtcblx0XG5cdCAgdmFyIFVuZGVybHlpbmdPYnNlcnZhYmxlID0gKGZ1bmN0aW9uIChfX3N1cGVyX18pIHtcblx0ICAgIGluaGVyaXRzKFVuZGVybHlpbmdPYnNlcnZhYmxlLCBfX3N1cGVyX18pO1xuXHQgICAgZnVuY3Rpb24gVW5kZXJseWluZ09ic2VydmFibGUobSwgdSkge1xuXHQgICAgICB0aGlzLl9tID0gbTtcblx0ICAgICAgdGhpcy5fdSA9IHU7XG5cdCAgICAgIF9fc3VwZXJfXy5jYWxsKHRoaXMpO1xuXHQgICAgfVxuXHRcblx0ICAgIFVuZGVybHlpbmdPYnNlcnZhYmxlLnByb3RvdHlwZS5zdWJzY3JpYmVDb3JlID0gZnVuY3Rpb24gKG8pIHtcblx0ICAgICAgcmV0dXJuIG5ldyBCaW5hcnlEaXNwb3NhYmxlKHRoaXMuX20uZ2V0RGlzcG9zYWJsZSgpLCB0aGlzLl91LnN1YnNjcmliZShvKSk7XG5cdCAgICB9O1xuXHRcblx0ICAgIHJldHVybiBVbmRlcmx5aW5nT2JzZXJ2YWJsZTtcblx0ICB9KE9ic2VydmFibGVCYXNlKSk7XG5cdFxuXHQgIHZhciBHcm91cGVkT2JzZXJ2YWJsZSA9IChmdW5jdGlvbiAoX19zdXBlcl9fKSB7XG5cdCAgICBpbmhlcml0cyhHcm91cGVkT2JzZXJ2YWJsZSwgX19zdXBlcl9fKTtcblx0ICAgIGZ1bmN0aW9uIEdyb3VwZWRPYnNlcnZhYmxlKGtleSwgdW5kZXJseWluZ09ic2VydmFibGUsIG1lcmdlZERpc3Bvc2FibGUpIHtcblx0ICAgICAgX19zdXBlcl9fLmNhbGwodGhpcyk7XG5cdCAgICAgIHRoaXMua2V5ID0ga2V5O1xuXHQgICAgICB0aGlzLnVuZGVybHlpbmdPYnNlcnZhYmxlID0gIW1lcmdlZERpc3Bvc2FibGUgP1xuXHQgICAgICAgIHVuZGVybHlpbmdPYnNlcnZhYmxlIDpcblx0ICAgICAgICBuZXcgVW5kZXJseWluZ09ic2VydmFibGUobWVyZ2VkRGlzcG9zYWJsZSwgdW5kZXJseWluZ09ic2VydmFibGUpO1xuXHQgICAgfVxuXHRcblx0ICAgIEdyb3VwZWRPYnNlcnZhYmxlLnByb3RvdHlwZS5fc3Vic2NyaWJlID0gZnVuY3Rpb24gKG8pIHtcblx0ICAgICAgcmV0dXJuIHRoaXMudW5kZXJseWluZ09ic2VydmFibGUuc3Vic2NyaWJlKG8pO1xuXHQgICAgfTtcblx0XG5cdCAgICByZXR1cm4gR3JvdXBlZE9ic2VydmFibGU7XG5cdCAgfShPYnNlcnZhYmxlKSk7XG5cdFxuXHQgIC8qKlxuXHQgICAqICBSZXByZXNlbnRzIGFuIG9iamVjdCB0aGF0IGlzIGJvdGggYW4gb2JzZXJ2YWJsZSBzZXF1ZW5jZSBhcyB3ZWxsIGFzIGFuIG9ic2VydmVyLlxuXHQgICAqICBFYWNoIG5vdGlmaWNhdGlvbiBpcyBicm9hZGNhc3RlZCB0byBhbGwgc3Vic2NyaWJlZCBvYnNlcnZlcnMuXG5cdCAgICovXG5cdCAgdmFyIFN1YmplY3QgPSBSeC5TdWJqZWN0ID0gKGZ1bmN0aW9uIChfX3N1cGVyX18pIHtcblx0ICAgIGluaGVyaXRzKFN1YmplY3QsIF9fc3VwZXJfXyk7XG5cdCAgICBmdW5jdGlvbiBTdWJqZWN0KCkge1xuXHQgICAgICBfX3N1cGVyX18uY2FsbCh0aGlzKTtcblx0ICAgICAgdGhpcy5pc0Rpc3Bvc2VkID0gZmFsc2U7XG5cdCAgICAgIHRoaXMuaXNTdG9wcGVkID0gZmFsc2U7XG5cdCAgICAgIHRoaXMub2JzZXJ2ZXJzID0gW107XG5cdCAgICAgIHRoaXMuaGFzRXJyb3IgPSBmYWxzZTtcblx0ICAgIH1cblx0XG5cdCAgICBhZGRQcm9wZXJ0aWVzKFN1YmplY3QucHJvdG90eXBlLCBPYnNlcnZlci5wcm90b3R5cGUsIHtcblx0ICAgICAgX3N1YnNjcmliZTogZnVuY3Rpb24gKG8pIHtcblx0ICAgICAgICBjaGVja0Rpc3Bvc2VkKHRoaXMpO1xuXHQgICAgICAgIGlmICghdGhpcy5pc1N0b3BwZWQpIHtcblx0ICAgICAgICAgIHRoaXMub2JzZXJ2ZXJzLnB1c2gobyk7XG5cdCAgICAgICAgICByZXR1cm4gbmV3IElubmVyU3Vic2NyaXB0aW9uKHRoaXMsIG8pO1xuXHQgICAgICAgIH1cblx0ICAgICAgICBpZiAodGhpcy5oYXNFcnJvcikge1xuXHQgICAgICAgICAgby5vbkVycm9yKHRoaXMuZXJyb3IpO1xuXHQgICAgICAgICAgcmV0dXJuIGRpc3Bvc2FibGVFbXB0eTtcblx0ICAgICAgICB9XG5cdCAgICAgICAgby5vbkNvbXBsZXRlZCgpO1xuXHQgICAgICAgIHJldHVybiBkaXNwb3NhYmxlRW1wdHk7XG5cdCAgICAgIH0sXG5cdCAgICAgIC8qKlxuXHQgICAgICAgKiBJbmRpY2F0ZXMgd2hldGhlciB0aGUgc3ViamVjdCBoYXMgb2JzZXJ2ZXJzIHN1YnNjcmliZWQgdG8gaXQuXG5cdCAgICAgICAqIEByZXR1cm5zIHtCb29sZWFufSBJbmRpY2F0ZXMgd2hldGhlciB0aGUgc3ViamVjdCBoYXMgb2JzZXJ2ZXJzIHN1YnNjcmliZWQgdG8gaXQuXG5cdCAgICAgICAqL1xuXHQgICAgICBoYXNPYnNlcnZlcnM6IGZ1bmN0aW9uICgpIHsgcmV0dXJuIHRoaXMub2JzZXJ2ZXJzLmxlbmd0aCA+IDA7IH0sXG5cdCAgICAgIC8qKlxuXHQgICAgICAgKiBOb3RpZmllcyBhbGwgc3Vic2NyaWJlZCBvYnNlcnZlcnMgYWJvdXQgdGhlIGVuZCBvZiB0aGUgc2VxdWVuY2UuXG5cdCAgICAgICAqL1xuXHQgICAgICBvbkNvbXBsZXRlZDogZnVuY3Rpb24gKCkge1xuXHQgICAgICAgIGNoZWNrRGlzcG9zZWQodGhpcyk7XG5cdCAgICAgICAgaWYgKCF0aGlzLmlzU3RvcHBlZCkge1xuXHQgICAgICAgICAgdGhpcy5pc1N0b3BwZWQgPSB0cnVlO1xuXHQgICAgICAgICAgZm9yICh2YXIgaSA9IDAsIG9zID0gY2xvbmVBcnJheSh0aGlzLm9ic2VydmVycyksIGxlbiA9IG9zLmxlbmd0aDsgaSA8IGxlbjsgaSsrKSB7XG5cdCAgICAgICAgICAgIG9zW2ldLm9uQ29tcGxldGVkKCk7XG5cdCAgICAgICAgICB9XG5cdFxuXHQgICAgICAgICAgdGhpcy5vYnNlcnZlcnMubGVuZ3RoID0gMDtcblx0ICAgICAgICB9XG5cdCAgICAgIH0sXG5cdCAgICAgIC8qKlxuXHQgICAgICAgKiBOb3RpZmllcyBhbGwgc3Vic2NyaWJlZCBvYnNlcnZlcnMgYWJvdXQgdGhlIGV4Y2VwdGlvbi5cblx0ICAgICAgICogQHBhcmFtIHtNaXhlZH0gZXJyb3IgVGhlIGV4Y2VwdGlvbiB0byBzZW5kIHRvIGFsbCBvYnNlcnZlcnMuXG5cdCAgICAgICAqL1xuXHQgICAgICBvbkVycm9yOiBmdW5jdGlvbiAoZXJyb3IpIHtcblx0ICAgICAgICBjaGVja0Rpc3Bvc2VkKHRoaXMpO1xuXHQgICAgICAgIGlmICghdGhpcy5pc1N0b3BwZWQpIHtcblx0ICAgICAgICAgIHRoaXMuaXNTdG9wcGVkID0gdHJ1ZTtcblx0ICAgICAgICAgIHRoaXMuZXJyb3IgPSBlcnJvcjtcblx0ICAgICAgICAgIHRoaXMuaGFzRXJyb3IgPSB0cnVlO1xuXHQgICAgICAgICAgZm9yICh2YXIgaSA9IDAsIG9zID0gY2xvbmVBcnJheSh0aGlzLm9ic2VydmVycyksIGxlbiA9IG9zLmxlbmd0aDsgaSA8IGxlbjsgaSsrKSB7XG5cdCAgICAgICAgICAgIG9zW2ldLm9uRXJyb3IoZXJyb3IpO1xuXHQgICAgICAgICAgfVxuXHRcblx0ICAgICAgICAgIHRoaXMub2JzZXJ2ZXJzLmxlbmd0aCA9IDA7XG5cdCAgICAgICAgfVxuXHQgICAgICB9LFxuXHQgICAgICAvKipcblx0ICAgICAgICogTm90aWZpZXMgYWxsIHN1YnNjcmliZWQgb2JzZXJ2ZXJzIGFib3V0IHRoZSBhcnJpdmFsIG9mIHRoZSBzcGVjaWZpZWQgZWxlbWVudCBpbiB0aGUgc2VxdWVuY2UuXG5cdCAgICAgICAqIEBwYXJhbSB7TWl4ZWR9IHZhbHVlIFRoZSB2YWx1ZSB0byBzZW5kIHRvIGFsbCBvYnNlcnZlcnMuXG5cdCAgICAgICAqL1xuXHQgICAgICBvbk5leHQ6IGZ1bmN0aW9uICh2YWx1ZSkge1xuXHQgICAgICAgIGNoZWNrRGlzcG9zZWQodGhpcyk7XG5cdCAgICAgICAgaWYgKCF0aGlzLmlzU3RvcHBlZCkge1xuXHQgICAgICAgICAgZm9yICh2YXIgaSA9IDAsIG9zID0gY2xvbmVBcnJheSh0aGlzLm9ic2VydmVycyksIGxlbiA9IG9zLmxlbmd0aDsgaSA8IGxlbjsgaSsrKSB7XG5cdCAgICAgICAgICAgIG9zW2ldLm9uTmV4dCh2YWx1ZSk7XG5cdCAgICAgICAgICB9XG5cdCAgICAgICAgfVxuXHQgICAgICB9LFxuXHQgICAgICAvKipcblx0ICAgICAgICogVW5zdWJzY3JpYmUgYWxsIG9ic2VydmVycyBhbmQgcmVsZWFzZSByZXNvdXJjZXMuXG5cdCAgICAgICAqL1xuXHQgICAgICBkaXNwb3NlOiBmdW5jdGlvbiAoKSB7XG5cdCAgICAgICAgdGhpcy5pc0Rpc3Bvc2VkID0gdHJ1ZTtcblx0ICAgICAgICB0aGlzLm9ic2VydmVycyA9IG51bGw7XG5cdCAgICAgIH1cblx0ICAgIH0pO1xuXHRcblx0ICAgIC8qKlxuXHQgICAgICogQ3JlYXRlcyBhIHN1YmplY3QgZnJvbSB0aGUgc3BlY2lmaWVkIG9ic2VydmVyIGFuZCBvYnNlcnZhYmxlLlxuXHQgICAgICogQHBhcmFtIHtPYnNlcnZlcn0gb2JzZXJ2ZXIgVGhlIG9ic2VydmVyIHVzZWQgdG8gc2VuZCBtZXNzYWdlcyB0byB0aGUgc3ViamVjdC5cblx0ICAgICAqIEBwYXJhbSB7T2JzZXJ2YWJsZX0gb2JzZXJ2YWJsZSBUaGUgb2JzZXJ2YWJsZSB1c2VkIHRvIHN1YnNjcmliZSB0byBtZXNzYWdlcyBzZW50IGZyb20gdGhlIHN1YmplY3QuXG5cdCAgICAgKiBAcmV0dXJucyB7U3ViamVjdH0gU3ViamVjdCBpbXBsZW1lbnRlZCB1c2luZyB0aGUgZ2l2ZW4gb2JzZXJ2ZXIgYW5kIG9ic2VydmFibGUuXG5cdCAgICAgKi9cblx0ICAgIFN1YmplY3QuY3JlYXRlID0gZnVuY3Rpb24gKG9ic2VydmVyLCBvYnNlcnZhYmxlKSB7XG5cdCAgICAgIHJldHVybiBuZXcgQW5vbnltb3VzU3ViamVjdChvYnNlcnZlciwgb2JzZXJ2YWJsZSk7XG5cdCAgICB9O1xuXHRcblx0ICAgIHJldHVybiBTdWJqZWN0O1xuXHQgIH0oT2JzZXJ2YWJsZSkpO1xuXHRcblx0ICAvKipcblx0ICAgKiAgUmVwcmVzZW50cyB0aGUgcmVzdWx0IG9mIGFuIGFzeW5jaHJvbm91cyBvcGVyYXRpb24uXG5cdCAgICogIFRoZSBsYXN0IHZhbHVlIGJlZm9yZSB0aGUgT25Db21wbGV0ZWQgbm90aWZpY2F0aW9uLCBvciB0aGUgZXJyb3IgcmVjZWl2ZWQgdGhyb3VnaCBPbkVycm9yLCBpcyBzZW50IHRvIGFsbCBzdWJzY3JpYmVkIG9ic2VydmVycy5cblx0ICAgKi9cblx0ICB2YXIgQXN5bmNTdWJqZWN0ID0gUnguQXN5bmNTdWJqZWN0ID0gKGZ1bmN0aW9uIChfX3N1cGVyX18pIHtcblx0ICAgIGluaGVyaXRzKEFzeW5jU3ViamVjdCwgX19zdXBlcl9fKTtcblx0XG5cdCAgICAvKipcblx0ICAgICAqIENyZWF0ZXMgYSBzdWJqZWN0IHRoYXQgY2FuIG9ubHkgcmVjZWl2ZSBvbmUgdmFsdWUgYW5kIHRoYXQgdmFsdWUgaXMgY2FjaGVkIGZvciBhbGwgZnV0dXJlIG9ic2VydmF0aW9ucy5cblx0ICAgICAqIEBjb25zdHJ1Y3RvclxuXHQgICAgICovXG5cdCAgICBmdW5jdGlvbiBBc3luY1N1YmplY3QoKSB7XG5cdCAgICAgIF9fc3VwZXJfXy5jYWxsKHRoaXMpO1xuXHQgICAgICB0aGlzLmlzRGlzcG9zZWQgPSBmYWxzZTtcblx0ICAgICAgdGhpcy5pc1N0b3BwZWQgPSBmYWxzZTtcblx0ICAgICAgdGhpcy5oYXNWYWx1ZSA9IGZhbHNlO1xuXHQgICAgICB0aGlzLm9ic2VydmVycyA9IFtdO1xuXHQgICAgICB0aGlzLmhhc0Vycm9yID0gZmFsc2U7XG5cdCAgICB9XG5cdFxuXHQgICAgYWRkUHJvcGVydGllcyhBc3luY1N1YmplY3QucHJvdG90eXBlLCBPYnNlcnZlciwge1xuXHQgICAgICBfc3Vic2NyaWJlOiBmdW5jdGlvbiAobykge1xuXHQgICAgICAgIGNoZWNrRGlzcG9zZWQodGhpcyk7XG5cdFxuXHQgICAgICAgIGlmICghdGhpcy5pc1N0b3BwZWQpIHtcblx0ICAgICAgICAgIHRoaXMub2JzZXJ2ZXJzLnB1c2gobyk7XG5cdCAgICAgICAgICByZXR1cm4gbmV3IElubmVyU3Vic2NyaXB0aW9uKHRoaXMsIG8pO1xuXHQgICAgICAgIH1cblx0XG5cdCAgICAgICAgaWYgKHRoaXMuaGFzRXJyb3IpIHtcblx0ICAgICAgICAgIG8ub25FcnJvcih0aGlzLmVycm9yKTtcblx0ICAgICAgICB9IGVsc2UgaWYgKHRoaXMuaGFzVmFsdWUpIHtcblx0ICAgICAgICAgIG8ub25OZXh0KHRoaXMudmFsdWUpO1xuXHQgICAgICAgICAgby5vbkNvbXBsZXRlZCgpO1xuXHQgICAgICAgIH0gZWxzZSB7XG5cdCAgICAgICAgICBvLm9uQ29tcGxldGVkKCk7XG5cdCAgICAgICAgfVxuXHRcblx0ICAgICAgICByZXR1cm4gZGlzcG9zYWJsZUVtcHR5O1xuXHQgICAgICB9LFxuXHQgICAgICAvKipcblx0ICAgICAgICogSW5kaWNhdGVzIHdoZXRoZXIgdGhlIHN1YmplY3QgaGFzIG9ic2VydmVycyBzdWJzY3JpYmVkIHRvIGl0LlxuXHQgICAgICAgKiBAcmV0dXJucyB7Qm9vbGVhbn0gSW5kaWNhdGVzIHdoZXRoZXIgdGhlIHN1YmplY3QgaGFzIG9ic2VydmVycyBzdWJzY3JpYmVkIHRvIGl0LlxuXHQgICAgICAgKi9cblx0ICAgICAgaGFzT2JzZXJ2ZXJzOiBmdW5jdGlvbiAoKSB7XG5cdCAgICAgICAgY2hlY2tEaXNwb3NlZCh0aGlzKTtcblx0ICAgICAgICByZXR1cm4gdGhpcy5vYnNlcnZlcnMubGVuZ3RoID4gMDtcblx0ICAgICAgfSxcblx0ICAgICAgLyoqXG5cdCAgICAgICAqIE5vdGlmaWVzIGFsbCBzdWJzY3JpYmVkIG9ic2VydmVycyBhYm91dCB0aGUgZW5kIG9mIHRoZSBzZXF1ZW5jZSwgYWxzbyBjYXVzaW5nIHRoZSBsYXN0IHJlY2VpdmVkIHZhbHVlIHRvIGJlIHNlbnQgb3V0IChpZiBhbnkpLlxuXHQgICAgICAgKi9cblx0ICAgICAgb25Db21wbGV0ZWQ6IGZ1bmN0aW9uICgpIHtcblx0ICAgICAgICB2YXIgaSwgbGVuO1xuXHQgICAgICAgIGNoZWNrRGlzcG9zZWQodGhpcyk7XG5cdCAgICAgICAgaWYgKCF0aGlzLmlzU3RvcHBlZCkge1xuXHQgICAgICAgICAgdGhpcy5pc1N0b3BwZWQgPSB0cnVlO1xuXHQgICAgICAgICAgdmFyIG9zID0gY2xvbmVBcnJheSh0aGlzLm9ic2VydmVycyksIGxlbiA9IG9zLmxlbmd0aDtcblx0XG5cdCAgICAgICAgICBpZiAodGhpcy5oYXNWYWx1ZSkge1xuXHQgICAgICAgICAgICBmb3IgKGkgPSAwOyBpIDwgbGVuOyBpKyspIHtcblx0ICAgICAgICAgICAgICB2YXIgbyA9IG9zW2ldO1xuXHQgICAgICAgICAgICAgIG8ub25OZXh0KHRoaXMudmFsdWUpO1xuXHQgICAgICAgICAgICAgIG8ub25Db21wbGV0ZWQoKTtcblx0ICAgICAgICAgICAgfVxuXHQgICAgICAgICAgfSBlbHNlIHtcblx0ICAgICAgICAgICAgZm9yIChpID0gMDsgaSA8IGxlbjsgaSsrKSB7XG5cdCAgICAgICAgICAgICAgb3NbaV0ub25Db21wbGV0ZWQoKTtcblx0ICAgICAgICAgICAgfVxuXHQgICAgICAgICAgfVxuXHRcblx0ICAgICAgICAgIHRoaXMub2JzZXJ2ZXJzLmxlbmd0aCA9IDA7XG5cdCAgICAgICAgfVxuXHQgICAgICB9LFxuXHQgICAgICAvKipcblx0ICAgICAgICogTm90aWZpZXMgYWxsIHN1YnNjcmliZWQgb2JzZXJ2ZXJzIGFib3V0IHRoZSBlcnJvci5cblx0ICAgICAgICogQHBhcmFtIHtNaXhlZH0gZXJyb3IgVGhlIEVycm9yIHRvIHNlbmQgdG8gYWxsIG9ic2VydmVycy5cblx0ICAgICAgICovXG5cdCAgICAgIG9uRXJyb3I6IGZ1bmN0aW9uIChlcnJvcikge1xuXHQgICAgICAgIGNoZWNrRGlzcG9zZWQodGhpcyk7XG5cdCAgICAgICAgaWYgKCF0aGlzLmlzU3RvcHBlZCkge1xuXHQgICAgICAgICAgdGhpcy5pc1N0b3BwZWQgPSB0cnVlO1xuXHQgICAgICAgICAgdGhpcy5oYXNFcnJvciA9IHRydWU7XG5cdCAgICAgICAgICB0aGlzLmVycm9yID0gZXJyb3I7XG5cdFxuXHQgICAgICAgICAgZm9yICh2YXIgaSA9IDAsIG9zID0gY2xvbmVBcnJheSh0aGlzLm9ic2VydmVycyksIGxlbiA9IG9zLmxlbmd0aDsgaSA8IGxlbjsgaSsrKSB7XG5cdCAgICAgICAgICAgIG9zW2ldLm9uRXJyb3IoZXJyb3IpO1xuXHQgICAgICAgICAgfVxuXHRcblx0ICAgICAgICAgIHRoaXMub2JzZXJ2ZXJzLmxlbmd0aCA9IDA7XG5cdCAgICAgICAgfVxuXHQgICAgICB9LFxuXHQgICAgICAvKipcblx0ICAgICAgICogU2VuZHMgYSB2YWx1ZSB0byB0aGUgc3ViamVjdC4gVGhlIGxhc3QgdmFsdWUgcmVjZWl2ZWQgYmVmb3JlIHN1Y2Nlc3NmdWwgdGVybWluYXRpb24gd2lsbCBiZSBzZW50IHRvIGFsbCBzdWJzY3JpYmVkIGFuZCBmdXR1cmUgb2JzZXJ2ZXJzLlxuXHQgICAgICAgKiBAcGFyYW0ge01peGVkfSB2YWx1ZSBUaGUgdmFsdWUgdG8gc3RvcmUgaW4gdGhlIHN1YmplY3QuXG5cdCAgICAgICAqL1xuXHQgICAgICBvbk5leHQ6IGZ1bmN0aW9uICh2YWx1ZSkge1xuXHQgICAgICAgIGNoZWNrRGlzcG9zZWQodGhpcyk7XG5cdCAgICAgICAgaWYgKHRoaXMuaXNTdG9wcGVkKSB7IHJldHVybjsgfVxuXHQgICAgICAgIHRoaXMudmFsdWUgPSB2YWx1ZTtcblx0ICAgICAgICB0aGlzLmhhc1ZhbHVlID0gdHJ1ZTtcblx0ICAgICAgfSxcblx0ICAgICAgLyoqXG5cdCAgICAgICAqIFVuc3Vic2NyaWJlIGFsbCBvYnNlcnZlcnMgYW5kIHJlbGVhc2UgcmVzb3VyY2VzLlxuXHQgICAgICAgKi9cblx0ICAgICAgZGlzcG9zZTogZnVuY3Rpb24gKCkge1xuXHQgICAgICAgIHRoaXMuaXNEaXNwb3NlZCA9IHRydWU7XG5cdCAgICAgICAgdGhpcy5vYnNlcnZlcnMgPSBudWxsO1xuXHQgICAgICAgIHRoaXMuZXJyb3IgPSBudWxsO1xuXHQgICAgICAgIHRoaXMudmFsdWUgPSBudWxsO1xuXHQgICAgICB9XG5cdCAgICB9KTtcblx0XG5cdCAgICByZXR1cm4gQXN5bmNTdWJqZWN0O1xuXHQgIH0oT2JzZXJ2YWJsZSkpO1xuXHRcblx0ICB2YXIgQW5vbnltb3VzU3ViamVjdCA9IFJ4LkFub255bW91c1N1YmplY3QgPSAoZnVuY3Rpb24gKF9fc3VwZXJfXykge1xuXHQgICAgaW5oZXJpdHMoQW5vbnltb3VzU3ViamVjdCwgX19zdXBlcl9fKTtcblx0ICAgIGZ1bmN0aW9uIEFub255bW91c1N1YmplY3Qob2JzZXJ2ZXIsIG9ic2VydmFibGUpIHtcblx0ICAgICAgdGhpcy5vYnNlcnZlciA9IG9ic2VydmVyO1xuXHQgICAgICB0aGlzLm9ic2VydmFibGUgPSBvYnNlcnZhYmxlO1xuXHQgICAgICBfX3N1cGVyX18uY2FsbCh0aGlzKTtcblx0ICAgIH1cblx0XG5cdCAgICBhZGRQcm9wZXJ0aWVzKEFub255bW91c1N1YmplY3QucHJvdG90eXBlLCBPYnNlcnZlci5wcm90b3R5cGUsIHtcblx0ICAgICAgX3N1YnNjcmliZTogZnVuY3Rpb24gKG8pIHtcblx0ICAgICAgICByZXR1cm4gdGhpcy5vYnNlcnZhYmxlLnN1YnNjcmliZShvKTtcblx0ICAgICAgfSxcblx0ICAgICAgb25Db21wbGV0ZWQ6IGZ1bmN0aW9uICgpIHtcblx0ICAgICAgICB0aGlzLm9ic2VydmVyLm9uQ29tcGxldGVkKCk7XG5cdCAgICAgIH0sXG5cdCAgICAgIG9uRXJyb3I6IGZ1bmN0aW9uIChlcnJvcikge1xuXHQgICAgICAgIHRoaXMub2JzZXJ2ZXIub25FcnJvcihlcnJvcik7XG5cdCAgICAgIH0sXG5cdCAgICAgIG9uTmV4dDogZnVuY3Rpb24gKHZhbHVlKSB7XG5cdCAgICAgICAgdGhpcy5vYnNlcnZlci5vbk5leHQodmFsdWUpO1xuXHQgICAgICB9XG5cdCAgICB9KTtcblx0XG5cdCAgICByZXR1cm4gQW5vbnltb3VzU3ViamVjdDtcblx0ICB9KE9ic2VydmFibGUpKTtcblx0XG5cdCAgLyoqXG5cdCAgKiBVc2VkIHRvIHBhdXNlIGFuZCByZXN1bWUgc3RyZWFtcy5cblx0ICAqL1xuXHQgIFJ4LlBhdXNlciA9IChmdW5jdGlvbiAoX19zdXBlcl9fKSB7XG5cdCAgICBpbmhlcml0cyhQYXVzZXIsIF9fc3VwZXJfXyk7XG5cdCAgICBmdW5jdGlvbiBQYXVzZXIoKSB7XG5cdCAgICAgIF9fc3VwZXJfXy5jYWxsKHRoaXMpO1xuXHQgICAgfVxuXHRcblx0ICAgIC8qKlxuXHQgICAgICogUGF1c2VzIHRoZSB1bmRlcmx5aW5nIHNlcXVlbmNlLlxuXHQgICAgICovXG5cdCAgICBQYXVzZXIucHJvdG90eXBlLnBhdXNlID0gZnVuY3Rpb24gKCkgeyB0aGlzLm9uTmV4dChmYWxzZSk7IH07XG5cdFxuXHQgICAgLyoqXG5cdCAgICAqIFJlc3VtZXMgdGhlIHVuZGVybHlpbmcgc2VxdWVuY2UuXG5cdCAgICAqL1xuXHQgICAgUGF1c2VyLnByb3RvdHlwZS5yZXN1bWUgPSBmdW5jdGlvbiAoKSB7IHRoaXMub25OZXh0KHRydWUpOyB9O1xuXHRcblx0ICAgIHJldHVybiBQYXVzZXI7XG5cdCAgfShTdWJqZWN0KSk7XG5cdFxuXHQgIGlmICh0cnVlKSB7XG5cdCAgICByb290LlJ4ID0gUng7XG5cdFxuXHQgICAgIShfX1dFQlBBQ0tfQU1EX0RFRklORV9SRVNVTFRfXyA9IGZ1bmN0aW9uKCkge1xuXHQgICAgICByZXR1cm4gUng7XG5cdCAgICB9LmNhbGwoZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXywgZXhwb3J0cywgbW9kdWxlKSwgX19XRUJQQUNLX0FNRF9ERUZJTkVfUkVTVUxUX18gIT09IHVuZGVmaW5lZCAmJiAobW9kdWxlLmV4cG9ydHMgPSBfX1dFQlBBQ0tfQU1EX0RFRklORV9SRVNVTFRfXykpO1xuXHQgIH0gZWxzZSBpZiAoZnJlZUV4cG9ydHMgJiYgZnJlZU1vZHVsZSkge1xuXHQgICAgLy8gaW4gTm9kZS5qcyBvciBSaW5nb0pTXG5cdCAgICBpZiAobW9kdWxlRXhwb3J0cykge1xuXHQgICAgICAoZnJlZU1vZHVsZS5leHBvcnRzID0gUngpLlJ4ID0gUng7XG5cdCAgICB9IGVsc2Uge1xuXHQgICAgICBmcmVlRXhwb3J0cy5SeCA9IFJ4O1xuXHQgICAgfVxuXHQgIH0gZWxzZSB7XG5cdCAgICAvLyBpbiBhIGJyb3dzZXIgb3IgUmhpbm9cblx0ICAgIHJvb3QuUnggPSBSeDtcblx0ICB9XG5cdFxuXHQgIC8vIEFsbCBjb2RlIGJlZm9yZSB0aGlzIHBvaW50IHdpbGwgYmUgZmlsdGVyZWQgZnJvbSBzdGFjayB0cmFjZXMuXG5cdCAgdmFyIHJFbmRpbmdMaW5lID0gY2FwdHVyZUxpbmUoKTtcblx0XG5cdH0uY2FsbCh0aGlzKSk7XG5cdFxuXHQvKiBXRUJQQUNLIFZBUiBJTkpFQ1RJT04gKi99LmNhbGwoZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXygxMSkobW9kdWxlKSwgKGZ1bmN0aW9uKCkgeyByZXR1cm4gdGhpczsgfSgpKSwgX193ZWJwYWNrX3JlcXVpcmVfXygxMikpKVxuXG4vKioqLyB9LFxuLyogMTEgKi9cbi8qKiovIGZ1bmN0aW9uKG1vZHVsZSwgZXhwb3J0cykge1xuXG5cdG1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24obW9kdWxlKSB7XHJcblx0XHRpZighbW9kdWxlLndlYnBhY2tQb2x5ZmlsbCkge1xyXG5cdFx0XHRtb2R1bGUuZGVwcmVjYXRlID0gZnVuY3Rpb24oKSB7fTtcclxuXHRcdFx0bW9kdWxlLnBhdGhzID0gW107XHJcblx0XHRcdC8vIG1vZHVsZS5wYXJlbnQgPSB1bmRlZmluZWQgYnkgZGVmYXVsdFxyXG5cdFx0XHRtb2R1bGUuY2hpbGRyZW4gPSBbXTtcclxuXHRcdFx0bW9kdWxlLndlYnBhY2tQb2x5ZmlsbCA9IDE7XHJcblx0XHR9XHJcblx0XHRyZXR1cm4gbW9kdWxlO1xyXG5cdH1cclxuXG5cbi8qKiovIH0sXG4vKiAxMiAqL1xuLyoqKi8gZnVuY3Rpb24obW9kdWxlLCBleHBvcnRzKSB7XG5cblx0Ly8gc2hpbSBmb3IgdXNpbmcgcHJvY2VzcyBpbiBicm93c2VyXG5cdFxuXHR2YXIgcHJvY2VzcyA9IG1vZHVsZS5leHBvcnRzID0ge307XG5cdHZhciBxdWV1ZSA9IFtdO1xuXHR2YXIgZHJhaW5pbmcgPSBmYWxzZTtcblx0dmFyIGN1cnJlbnRRdWV1ZTtcblx0dmFyIHF1ZXVlSW5kZXggPSAtMTtcblx0XG5cdGZ1bmN0aW9uIGNsZWFuVXBOZXh0VGljaygpIHtcblx0ICAgIGRyYWluaW5nID0gZmFsc2U7XG5cdCAgICBpZiAoY3VycmVudFF1ZXVlLmxlbmd0aCkge1xuXHQgICAgICAgIHF1ZXVlID0gY3VycmVudFF1ZXVlLmNvbmNhdChxdWV1ZSk7XG5cdCAgICB9IGVsc2Uge1xuXHQgICAgICAgIHF1ZXVlSW5kZXggPSAtMTtcblx0ICAgIH1cblx0ICAgIGlmIChxdWV1ZS5sZW5ndGgpIHtcblx0ICAgICAgICBkcmFpblF1ZXVlKCk7XG5cdCAgICB9XG5cdH1cblx0XG5cdGZ1bmN0aW9uIGRyYWluUXVldWUoKSB7XG5cdCAgICBpZiAoZHJhaW5pbmcpIHtcblx0ICAgICAgICByZXR1cm47XG5cdCAgICB9XG5cdCAgICB2YXIgdGltZW91dCA9IHNldFRpbWVvdXQoY2xlYW5VcE5leHRUaWNrKTtcblx0ICAgIGRyYWluaW5nID0gdHJ1ZTtcblx0XG5cdCAgICB2YXIgbGVuID0gcXVldWUubGVuZ3RoO1xuXHQgICAgd2hpbGUobGVuKSB7XG5cdCAgICAgICAgY3VycmVudFF1ZXVlID0gcXVldWU7XG5cdCAgICAgICAgcXVldWUgPSBbXTtcblx0ICAgICAgICB3aGlsZSAoKytxdWV1ZUluZGV4IDwgbGVuKSB7XG5cdCAgICAgICAgICAgIGlmIChjdXJyZW50UXVldWUpIHtcblx0ICAgICAgICAgICAgICAgIGN1cnJlbnRRdWV1ZVtxdWV1ZUluZGV4XS5ydW4oKTtcblx0ICAgICAgICAgICAgfVxuXHQgICAgICAgIH1cblx0ICAgICAgICBxdWV1ZUluZGV4ID0gLTE7XG5cdCAgICAgICAgbGVuID0gcXVldWUubGVuZ3RoO1xuXHQgICAgfVxuXHQgICAgY3VycmVudFF1ZXVlID0gbnVsbDtcblx0ICAgIGRyYWluaW5nID0gZmFsc2U7XG5cdCAgICBjbGVhclRpbWVvdXQodGltZW91dCk7XG5cdH1cblx0XG5cdHByb2Nlc3MubmV4dFRpY2sgPSBmdW5jdGlvbiAoZnVuKSB7XG5cdCAgICB2YXIgYXJncyA9IG5ldyBBcnJheShhcmd1bWVudHMubGVuZ3RoIC0gMSk7XG5cdCAgICBpZiAoYXJndW1lbnRzLmxlbmd0aCA+IDEpIHtcblx0ICAgICAgICBmb3IgKHZhciBpID0gMTsgaSA8IGFyZ3VtZW50cy5sZW5ndGg7IGkrKykge1xuXHQgICAgICAgICAgICBhcmdzW2kgLSAxXSA9IGFyZ3VtZW50c1tpXTtcblx0ICAgICAgICB9XG5cdCAgICB9XG5cdCAgICBxdWV1ZS5wdXNoKG5ldyBJdGVtKGZ1biwgYXJncykpO1xuXHQgICAgaWYgKHF1ZXVlLmxlbmd0aCA9PT0gMSAmJiAhZHJhaW5pbmcpIHtcblx0ICAgICAgICBzZXRUaW1lb3V0KGRyYWluUXVldWUsIDApO1xuXHQgICAgfVxuXHR9O1xuXHRcblx0Ly8gdjggbGlrZXMgcHJlZGljdGlibGUgb2JqZWN0c1xuXHRmdW5jdGlvbiBJdGVtKGZ1biwgYXJyYXkpIHtcblx0ICAgIHRoaXMuZnVuID0gZnVuO1xuXHQgICAgdGhpcy5hcnJheSA9IGFycmF5O1xuXHR9XG5cdEl0ZW0ucHJvdG90eXBlLnJ1biA9IGZ1bmN0aW9uICgpIHtcblx0ICAgIHRoaXMuZnVuLmFwcGx5KG51bGwsIHRoaXMuYXJyYXkpO1xuXHR9O1xuXHRwcm9jZXNzLnRpdGxlID0gJ2Jyb3dzZXInO1xuXHRwcm9jZXNzLmJyb3dzZXIgPSB0cnVlO1xuXHRwcm9jZXNzLmVudiA9IHt9O1xuXHRwcm9jZXNzLmFyZ3YgPSBbXTtcblx0cHJvY2Vzcy52ZXJzaW9uID0gJyc7IC8vIGVtcHR5IHN0cmluZyB0byBhdm9pZCByZWdleHAgaXNzdWVzXG5cdHByb2Nlc3MudmVyc2lvbnMgPSB7fTtcblx0XG5cdGZ1bmN0aW9uIG5vb3AoKSB7fVxuXHRcblx0cHJvY2Vzcy5vbiA9IG5vb3A7XG5cdHByb2Nlc3MuYWRkTGlzdGVuZXIgPSBub29wO1xuXHRwcm9jZXNzLm9uY2UgPSBub29wO1xuXHRwcm9jZXNzLm9mZiA9IG5vb3A7XG5cdHByb2Nlc3MucmVtb3ZlTGlzdGVuZXIgPSBub29wO1xuXHRwcm9jZXNzLnJlbW92ZUFsbExpc3RlbmVycyA9IG5vb3A7XG5cdHByb2Nlc3MuZW1pdCA9IG5vb3A7XG5cdFxuXHRwcm9jZXNzLmJpbmRpbmcgPSBmdW5jdGlvbiAobmFtZSkge1xuXHQgICAgdGhyb3cgbmV3IEVycm9yKCdwcm9jZXNzLmJpbmRpbmcgaXMgbm90IHN1cHBvcnRlZCcpO1xuXHR9O1xuXHRcblx0cHJvY2Vzcy5jd2QgPSBmdW5jdGlvbiAoKSB7IHJldHVybiAnLycgfTtcblx0cHJvY2Vzcy5jaGRpciA9IGZ1bmN0aW9uIChkaXIpIHtcblx0ICAgIHRocm93IG5ldyBFcnJvcigncHJvY2Vzcy5jaGRpciBpcyBub3Qgc3VwcG9ydGVkJyk7XG5cdH07XG5cdHByb2Nlc3MudW1hc2sgPSBmdW5jdGlvbigpIHsgcmV0dXJuIDA7IH07XG5cblxuLyoqKi8gfVxuLyoqKioqKi8gXSk7XG5cblxuLyoqIFdFQlBBQ0sgRk9PVEVSICoqXG4gKiogcmVhY3QtY2xpbWItc29jaWFsLmpzXG4gKiovIiwiIFx0Ly8gVGhlIG1vZHVsZSBjYWNoZVxuIFx0dmFyIGluc3RhbGxlZE1vZHVsZXMgPSB7fTtcblxuIFx0Ly8gVGhlIHJlcXVpcmUgZnVuY3Rpb25cbiBcdGZ1bmN0aW9uIF9fd2VicGFja19yZXF1aXJlX18obW9kdWxlSWQpIHtcblxuIFx0XHQvLyBDaGVjayBpZiBtb2R1bGUgaXMgaW4gY2FjaGVcbiBcdFx0aWYoaW5zdGFsbGVkTW9kdWxlc1ttb2R1bGVJZF0pXG4gXHRcdFx0cmV0dXJuIGluc3RhbGxlZE1vZHVsZXNbbW9kdWxlSWRdLmV4cG9ydHM7XG5cbiBcdFx0Ly8gQ3JlYXRlIGEgbmV3IG1vZHVsZSAoYW5kIHB1dCBpdCBpbnRvIHRoZSBjYWNoZSlcbiBcdFx0dmFyIG1vZHVsZSA9IGluc3RhbGxlZE1vZHVsZXNbbW9kdWxlSWRdID0ge1xuIFx0XHRcdGV4cG9ydHM6IHt9LFxuIFx0XHRcdGlkOiBtb2R1bGVJZCxcbiBcdFx0XHRsb2FkZWQ6IGZhbHNlXG4gXHRcdH07XG5cbiBcdFx0Ly8gRXhlY3V0ZSB0aGUgbW9kdWxlIGZ1bmN0aW9uXG4gXHRcdG1vZHVsZXNbbW9kdWxlSWRdLmNhbGwobW9kdWxlLmV4cG9ydHMsIG1vZHVsZSwgbW9kdWxlLmV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pO1xuXG4gXHRcdC8vIEZsYWcgdGhlIG1vZHVsZSBhcyBsb2FkZWRcbiBcdFx0bW9kdWxlLmxvYWRlZCA9IHRydWU7XG5cbiBcdFx0Ly8gUmV0dXJuIHRoZSBleHBvcnRzIG9mIHRoZSBtb2R1bGVcbiBcdFx0cmV0dXJuIG1vZHVsZS5leHBvcnRzO1xuIFx0fVxuXG5cbiBcdC8vIGV4cG9zZSB0aGUgbW9kdWxlcyBvYmplY3QgKF9fd2VicGFja19tb2R1bGVzX18pXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLm0gPSBtb2R1bGVzO1xuXG4gXHQvLyBleHBvc2UgdGhlIG1vZHVsZSBjYWNoZVxuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5jID0gaW5zdGFsbGVkTW9kdWxlcztcblxuIFx0Ly8gX193ZWJwYWNrX3B1YmxpY19wYXRoX19cbiBcdF9fd2VicGFja19yZXF1aXJlX18ucCA9IFwiL1wiO1xuXG4gXHQvLyBMb2FkIGVudHJ5IG1vZHVsZSBhbmQgcmV0dXJuIGV4cG9ydHNcbiBcdHJldHVybiBfX3dlYnBhY2tfcmVxdWlyZV9fKDApO1xuXG5cblxuLyoqIFdFQlBBQ0sgRk9PVEVSICoqXG4gKiogd2VicGFjay9ib290c3RyYXAgNTEwNjRlYTA4NmNhZWYyNWRhZGFcbiAqKi8iLCJpbXBvcnQgUmVhY3QgZnJvbSAncmVhY3QnO1xuaW1wb3J0IFdhbGwgZnJvbSAnLi9jb21wb25lbnRzL1dhbGwuanN4JztcblxuaWYgKHdpbmRvdykge1xuICAgIHdpbmRvdy5DbGltYiA9IHdpbmRvdy5DbGltYiB8fCB7fTtcblxuICAgIGNvbnN0ICR0YXJnZXRzID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLmNsaW1iLXdhbGwnKTtcblxuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgJHRhcmdldHMubGVuZ3RoOyArK2kpIHtcbiAgICAgICAgY29uc3QgJGl0ZW0gPSAkdGFyZ2V0c1tpXTtcbiAgICAgICAgY29uc3QgY29sbGVjdGlvbklkID0gJGl0ZW0uZGF0YXNldC5jb2xsZWN0aW9uSWQ7XG4gICAgICAgIGNvbnN0IGxpbWl0ID0gJGl0ZW0uZGF0YXNldC5saW1pdDtcblxuICAgICAgICBSZWFjdC5yZW5kZXIoXG4gICAgICAgICAgICBSZWFjdC5jcmVhdGVFbGVtZW50KFdhbGwsIHtjb2xsZWN0aW9uSWQsIGxpbWl0fSksICRpdGVtXG4gICAgICAgICk7XG4gICAgfVxufVxuXG5leHBvcnQgZGVmYXVsdCBXYWxsO1xuXG5cblxuLyoqIFdFQlBBQ0sgRk9PVEVSICoqXG4gKiogLi9+L2VzbGludC1sb2FkZXIhLi9zcmMvaW5kZXguanNcbiAqKi8iLCJtb2R1bGUuZXhwb3J0cyA9IFJlYWN0O1xuXG5cbi8qKioqKioqKioqKioqKioqKlxuICoqIFdFQlBBQ0sgRk9PVEVSXG4gKiogZXh0ZXJuYWwgXCJSZWFjdFwiXG4gKiogbW9kdWxlIGlkID0gMVxuICoqIG1vZHVsZSBjaHVua3MgPSAwXG4gKiovIiwiaW1wb3J0IFJlYWN0IGZyb20gJ3JlYWN0JztcblxuXG5jbGFzcyBBdXRob3IgZXh0ZW5kcyBSZWFjdC5Db21wb25lbnQge1xuXG4gICAgcmVuZGVyKCkge1xuXG4gICAgICAgIHJldHVybiAoXG4gICAgICAgICAgICA8YSBjbGFzc05hbWU9XCJjbGltYl9fdGlsZV9fYXV0aG9yXCJcbiAgICAgICAgICAgICAgIGhyZWY9eyB0aGlzLnByb3BzLmxpbmsgfT5cblxuICAgICAgICAgICAgICAgIDxpbWcgc3JjPXsgdGhpcy5wcm9wcy5waWN0dXJlfVxuICAgICAgICAgICAgICAgICAgICAgYWx0PXsgYFByb2ZpbGUgcGljIG9mICR7dGhpcy5wcm9wcy5uYW1lfWAgfS8+XG5cbiAgICAgICAgICAgICAgICA8aDQgY2xhc3NOYW1lPVwiY2xpbWJfX3RpbGVfX2F1dGhvcl9fdXNlcm5hbWVcIj5cbiAgICAgICAgICAgICAgICAgICAgeyB0aGlzLnByb3BzLnVzZXJuYW1lIH1cbiAgICAgICAgICAgICAgICA8L2g0PlxuXG4gICAgICAgICAgICAgICAgPGg0IGNsYXNzTmFtZT1cImNsaW1iX190aWxlX19hdXRob3JfX2ZvbGxvd2Vyc1wiPlxuICAgICAgICAgICAgICAgICAgICB7IHRoaXMucHJvcHMuZm9sbG93ZXJzX2NvdW50IH1cbiAgICAgICAgICAgICAgICA8L2g0PlxuXG4gICAgICAgICAgICA8L2E+XG4gICAgICAgICk7XG4gICAgfVxufVxuXG5BdXRob3IucHJvcFR5cGVzID0ge307XG5cbmV4cG9ydCBkZWZhdWx0IEF1dGhvcjtcblxuXG5cbi8qKiBXRUJQQUNLIEZPT1RFUiAqKlxuICoqIC4vfi9lc2xpbnQtbG9hZGVyIS4vc3JjL2NvbXBvbmVudHMvQXV0aG9yLmpzeFxuICoqLyIsImltcG9ydCBSZWFjdCBmcm9tICdyZWFjdCc7XG5cblxuY2xhc3MgSW1hZ2UgZXh0ZW5kcyBSZWFjdC5Db21wb25lbnQge1xuXG4gICAgcmVuZGVyKCkge1xuICAgICAgICByZXR1cm4gKFxuICAgICAgICAgICAgPGltZyBjbGFzc05hbWU9XCJjbGltYl9fdGlsZV9faW1hZ2VcIlxuICAgICAgICAgICAgICAgICBzcmM9eyB0aGlzLnByb3BzLnNyYyB9IGRhdGEtd2lkdGg9eyB0aGlzLnByb3BzLndpZHRoIH0gZGF0YS1oZWlnaHQ9eyB0aGlzLnByb3BzLmhlaWdodCB9Lz5cbiAgICAgICAgKTtcbiAgICB9XG59XG5cbkltYWdlLnByb3BUeXBlcyA9IHtcbiAgICBzcmM6IFJlYWN0LlByb3BUeXBlcy5zdHJpbmcuaXNSZXF1aXJlZCxcbiAgICB3aWR0aDogUmVhY3QuUHJvcFR5cGVzLm51bWJlcixcbiAgICBoZWlnaHQ6IFJlYWN0LlByb3BUeXBlcy5udW1iZXJcbn07XG5cbmV4cG9ydCBkZWZhdWx0IEltYWdlO1xuXG5cblxuLyoqIFdFQlBBQ0sgRk9PVEVSICoqXG4gKiogLi9+L2VzbGludC1sb2FkZXIhLi9zcmMvY29tcG9uZW50cy9JbWFnZS5qc3hcbiAqKi8iLCJpbXBvcnQgUmVhY3QgZnJvbSAncmVhY3QnO1xuXG5cbmNsYXNzIEludGVyYWN0aW9uIGV4dGVuZHMgUmVhY3QuQ29tcG9uZW50IHtcblxuICAgIHJlbmRlcigpIHtcblxuICAgICAgICByZXR1cm4gKFxuICAgICAgICAgICAgPHVsPjwvdWw+XG4gICAgICAgICk7XG4gICAgfVxufVxuXG5JbnRlcmFjdGlvbi5wcm9wVHlwZXMgPSB7XG4gICAgYm9keTogUmVhY3QuUHJvcFR5cGVzLnN0cmluZy5pc1JlcXVpcmVkXG59O1xuXG5leHBvcnQgZGVmYXVsdCBJbnRlcmFjdGlvbjtcblxuXG5cbi8qKiBXRUJQQUNLIEZPT1RFUiAqKlxuICoqIC4vfi9lc2xpbnQtbG9hZGVyIS4vc3JjL2NvbXBvbmVudHMvSW50ZXJhY3Rpb24uanN4XG4gKiovIiwiaW1wb3J0IFJlYWN0IGZyb20gJ3JlYWN0JztcblxuXG5jbGFzcyBNZXNzYWdlIGV4dGVuZHMgUmVhY3QuQ29tcG9uZW50IHtcblxuICAgIHJlbmRlcigpIHtcbiAgICAgICAgcmV0dXJuIChcbiAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPVwiY2xpbWJfX3RpbGVfX21lc3NhZ2VcIlxuICAgICAgICAgICAgICAgICBkYW5nZXJvdXNseVNldElubmVySFRNTD17e19faHRtbDogdGhpcy5wcm9wcy5ib2R5fX0+XG4gICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgKTtcbiAgICB9XG59XG5cbk1lc3NhZ2UucHJvcFR5cGVzID0ge1xuICAgIGJvZHk6IFJlYWN0LlByb3BUeXBlcy5zdHJpbmcuaXNSZXF1aXJlZFxufTtcblxuZXhwb3J0IGRlZmF1bHQgTWVzc2FnZTtcblxuXG5cbi8qKiBXRUJQQUNLIEZPT1RFUiAqKlxuICoqIC4vfi9lc2xpbnQtbG9hZGVyIS4vc3JjL2NvbXBvbmVudHMvTWVzc2FnZS5qc3hcbiAqKi8iLCJpbXBvcnQgUmVhY3QgZnJvbSAncmVhY3QnO1xuaW1wb3J0IEltYWdlIGZyb20gJy4vSW1hZ2UnO1xuaW1wb3J0IE1lc3NhZ2UgZnJvbSAnLi9NZXNzYWdlJztcbmltcG9ydCBBdXRob3IgZnJvbSAnLi9BdXRob3InO1xuaW1wb3J0IEludGVyYWN0aW9uIGZyb20gJy4vSW50ZXJhY3Rpb24nO1xuXG5cbmNsYXNzIFRpbGUgZXh0ZW5kcyBSZWFjdC5Db21wb25lbnQge1xuXG4gICAgY29uc3RydWN0b3IocHJvcHMpIHtcbiAgICAgICAgc3VwZXIocHJvcHMpO1xuICAgICAgICB0aGlzLmNyZWF0ZUltYWdlLmJpbmQodGhpcyk7XG4gICAgICAgIHRoaXMuY3JlYXRlTWVzc2FnZS5iaW5kKHRoaXMpO1xuICAgICAgICB0aGlzLmNyZWF0ZUludGVyYWN0aW9uLmJpbmQodGhpcyk7XG4gICAgICAgIHRoaXMuY3JlYXRlQ2xhc3NTdHJpbmcuYmluZCh0aGlzKTtcbiAgICB9XG5cbiAgICBjcmVhdGVJbWFnZSgpIHtcblxuICAgICAgICBpZiAodGhpcy5wcm9wcy5pbWFnZSAhPT0gbnVsbCkge1xuICAgICAgICAgICAgY29uc3Qge3VybDogc3JjLCB3aWR0aCwgaGVpZ2h0fSA9IHRoaXMucHJvcHMuaW1hZ2U7XG4gICAgICAgICAgICByZXR1cm4gKFxuICAgICAgICAgICAgICAgIDxJbWFnZSBzcmM9eyBzcmMgfVxuICAgICAgICAgICAgICAgICAgICAgICB3aWR0aD17IHdpZHRoIH1cbiAgICAgICAgICAgICAgICAgICAgICAgaGVpZ2h0PXsgaGVpZ2h0IH0vPlxuICAgICAgICAgICAgKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG5cbiAgICBjcmVhdGVNZXNzYWdlKCkge1xuXG4gICAgICAgIGlmICh0aGlzLnByb3BzLm1lc3NhZ2UpIHtcbiAgICAgICAgICAgIHJldHVybiAoXG4gICAgICAgICAgICAgICAgPE1lc3NhZ2UgYm9keT17IHRoaXMucHJvcHMubWVzc2FnZSB9Lz5cbiAgICAgICAgICAgICk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgfVxuXG4gICAgY3JlYXRlSW50ZXJhY3Rpb24oKSB7XG4gICAgICAgIGlmICh0aGlzLnByb3BzLmxpbmspIHtcbiAgICAgICAgICAgIHJldHVybiAoXG4gICAgICAgICAgICAgICAgPEludGVyYWN0aW9uIGJvZHk9eyB0aGlzLnByb3BzIH0vPlxuICAgICAgICAgICAgKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG5cblxuICAgIGNyZWF0ZUNsYXNzU3RyaW5nKCkge1xuXG4gICAgICAgIGxldCBjbGFzc1N0cmluZyA9IGBjbGltYl9fdGlsZSBjbGltYl9fdGlsZS0tJHt0aGlzLnByb3BzLnNvdXJjZV90eXBlfWA7XG5cbiAgICAgICAgaWYgKHRoaXMucHJvcHMuaW1hZ2UpIHtcbiAgICAgICAgICAgIGNsYXNzU3RyaW5nICs9ICcgY2xpbWJfX3RpbGUtLWhhcy1tZWRpYSBjbGltYl9fdGlsZS0taGFzLWltYWdlJztcbiAgICAgICAgfVxuXG4gICAgICAgIGlmICh0aGlzLnByb3BzLnZpZGVvX3VybCkge1xuICAgICAgICAgICAgY2xhc3NTdHJpbmcgKz0gJyBjbGltYl9fdGlsZS0taGFzLW1lZGlhIGNsaW1iX190aWxlLS1oYXMtdmlkZW8nO1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIGNsYXNzU3RyaW5nO1xuICAgIH1cblxuICAgIHJlbmRlcigpIHtcblxuICAgICAgICBjb25zdCBpbWFnZSA9IHRoaXMuY3JlYXRlSW1hZ2UoKTtcbiAgICAgICAgY29uc3QgbWVzc2FnZSA9IHRoaXMuY3JlYXRlTWVzc2FnZSgpO1xuICAgICAgICBjb25zdCBpbnRlcmFjdGlvbiA9IHRoaXMuY3JlYXRlSW50ZXJhY3Rpb24oKTtcbiAgICAgICAgY29uc3QgY2xhc3NTdHJpbmcgPSB0aGlzLmNyZWF0ZUNsYXNzU3RyaW5nKCk7XG4gICAgICAgIGNvbnN0IHthdXRob3J9ID0gdGhpcy5wcm9wcztcblxuICAgICAgICByZXR1cm4gKFxuICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9eyBjbGFzc1N0cmluZyB9PlxuXG4gICAgICAgICAgICAgICAgPGEgaHJlZj17IHRoaXMucHJvcHMubGluayB9PlxuICAgICAgICAgICAgICAgICAgICB7IGltYWdlIH1cbiAgICAgICAgICAgICAgICA8L2E+XG5cbiAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT1cImNsaW1iX190aWxlX19jb250ZW50XCI+XG4gICAgICAgICAgICAgICAgICAgIHsgbWVzc2FnZSB9XG4gICAgICAgICAgICAgICAgPC9kaXY+XG5cbiAgICAgICAgICAgICAgICA8QXV0aG9yIHsuLi5hdXRob3J9IC8+XG5cbiAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT1cImNsaW1iX190aWxlX19pbnRlcmFjdGlvblwiPlxuICAgICAgICAgICAgICAgICAgICB7IGludGVyYWN0aW9uIH1cbiAgICAgICAgICAgICAgICA8L2Rpdj5cblxuICAgICAgICAgICAgPC9kaXY+XG4gICAgICAgICk7XG4gICAgfVxufVxuXG5cblRpbGUucHJvcFR5cGVzID0ge1xuXG4gICAgLy8gUmVxdWlyZWQgYXR0cnNcbiAgICBsaW5rOiBSZWFjdC5Qcm9wVHlwZXMuc3RyaW5nLmlzUmVxdWlyZWQsXG4gICAgc291cmNlX3R5cGU6IFJlYWN0LlByb3BUeXBlcy5zdHJpbmcuaXNSZXF1aXJlZCxcbiAgICB0aW1lc3RhbXA6IFJlYWN0LlByb3BUeXBlcy5udW1iZXIuaXNSZXF1aXJlZCxcbiAgICBhdXRob3I6IFJlYWN0LlByb3BUeXBlcy5zaGFwZSh7XG4gICAgICAgIHVzZXJuYW1lOiBSZWFjdC5Qcm9wVHlwZXMuc3RyaW5nLmlzUmVxdWlyZWQsXG4gICAgICAgIHBpY3R1cmU6IFJlYWN0LlByb3BUeXBlcy5zdHJpbmcuaXNSZXF1aXJlZCxcbiAgICAgICAgbGluazogUmVhY3QuUHJvcFR5cGVzLnN0cmluZy5pc1JlcXVpcmVkLFxuICAgIH0pLFxuXG4gICAgLy8gT3B0aW9uYWwgYXR0cnNcbiAgICBtZXNzYWdlOiBSZWFjdC5Qcm9wVHlwZXMuc3RyaW5nLFxuICAgIHZpZGVvX3NyYzogUmVhY3QuUHJvcFR5cGVzLnN0cmluZyxcbiAgICBpbWFnZTogUmVhY3QuUHJvcFR5cGVzLnNoYXBlKHtcbiAgICAgICAgdXJsOiBSZWFjdC5Qcm9wVHlwZXMuc3RyaW5nLmlzUmVxdWlyZWQsXG4gICAgICAgIHdpZHRoOiBSZWFjdC5Qcm9wVHlwZXMubnVtYmVyLmlzUmVxdWlyZWQsXG4gICAgICAgIGhlaWdodDogUmVhY3QuUHJvcFR5cGVzLm51bWJlci5pc1JlcXVpcmVkLFxuICAgIH0pXG5cbn07XG5cbmV4cG9ydCBkZWZhdWx0IFRpbGU7XG5cblxuXG4vKiogV0VCUEFDSyBGT09URVIgKipcbiAqKiAuL34vZXNsaW50LWxvYWRlciEuL3NyYy9jb21wb25lbnRzL1RpbGUuanN4XG4gKiovIiwiaW1wb3J0IFJlYWN0IGZyb20gJ3JlYWN0JztcbmltcG9ydCBjbGltYiBmcm9tICcuLi91dGlscy9jbGltYic7XG5pbXBvcnQgVGlsZSBmcm9tICcuL1RpbGUnO1xuXG5cbmNsYXNzIFdhbGwgZXh0ZW5kcyBSZWFjdC5Db21wb25lbnQge1xuXG4gICAgY29uc3RydWN0b3IocHJvcHMpIHtcbiAgICAgICAgc3VwZXIocHJvcHMpO1xuICAgICAgICB0aGlzLnN0YXRlID0ge1xuICAgICAgICAgICAgaXRlbXM6IFtdXG4gICAgICAgIH07XG4gICAgfVxuXG4gICAgaW5pdCgpIHtcblxuICAgICAgICBpZiAoIXRoaXMucHJvcHMuY29sbGVjdGlvbklkKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cblxuICAgICAgICBjbGltYlxuICAgICAgICAgICAgLmdldFN0cmVhbSh0aGlzLnByb3BzLmNvbGxlY3Rpb25JZClcbiAgICAgICAgICAgIC5zdWJzY3JpYmUoaXRlbXMgPT4ge1xuXG4gICAgICAgICAgICAgICAgY29uc3QgbWF4U2l6ZSA9IDMwO1xuXG4gICAgICAgICAgICAgICAgdGhpcy5zZXRTdGF0ZSh7XG4gICAgICAgICAgICAgICAgICAgIGl0ZW1zOiBpdGVtcy5zcGxpY2UoMCwgbWF4U2l6ZSlcbiAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgY29tcG9uZW50RGlkTW91bnQoKSB7XG4gICAgICAgIHRoaXMuaW5pdCgpO1xuICAgIH1cblxuICAgIGNvbXBvbmVudERpZFVwZGF0ZSgpIHtcbiAgICAgICAgbGV0IGNiO1xuICAgICAgICBpZiAod2luZG93LkNsaW1iICYmIHdpbmRvdy5DbGltYi5vblVwZGF0ZSkge1xuICAgICAgICAgICAgY2IgPSB3aW5kb3cuQ2xpbWIub25VcGRhdGU7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAvLyBub29wXG4gICAgICAgICAgICBjYiA9ICgpID0+IHtcbiAgICAgICAgICAgIH07XG4gICAgICAgIH1cbiAgICAgICAgY2IoKTtcbiAgICB9XG5cbiAgICByZW5kZXIoKSB7XG4gICAgICAgIGNvbnN0IHRpbGVzID0gW107XG4gICAgICAgIHRoaXMuc3RhdGUuaXRlbXMubWFwKGl0ZW0gPT4ge1xuXG4gICAgICAgICAgICAvLyBXaGF0J3Mgd2l0aCB0aGUgYC4uLmA/XG4gICAgICAgICAgICAvLyBJdCdzIEVTNi5cbiAgICAgICAgICAgIC8vIGh0dHBzOi8vZmFjZWJvb2suZ2l0aHViLmlvL3JlYWN0L2RvY3MvdHJhbnNmZXJyaW5nLXByb3BzLmh0bWwjdHJhbnNmZXJyaW5nLXdpdGgtLi4uLWluLWpzeFxuICAgICAgICAgICAgY29uc3Qge2lkLCAuLi5vdGhlclByb3BzfSA9IGl0ZW07XG5cbiAgICAgICAgICAgIHRpbGVzLnB1c2goXG4gICAgICAgICAgICAgICAgPFRpbGUga2V5PXtpZH1cbiAgICAgICAgICAgICAgICAgICAgey4uLm90aGVyUHJvcHMgfSAvPlxuICAgICAgICAgICAgKTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgcmV0dXJuIChcbiAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPVwiY2xpbWJfX3dhbGxcIj5cbiAgICAgICAgICAgICAgICB7IHRpbGVzIH1cbiAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICApO1xuICAgIH1cbn1cblxuV2FsbC5kaXNwbGF5TmFtZSA9ICdXYWxsJztcbldhbGwucHJvcFR5cGVzID0ge1xuICAgIGNvbGxlY3Rpb25JZDogUmVhY3QuUHJvcFR5cGVzLnN0cmluZy5pc1JlcXVpcmVkLFxuICAgIGxpbWl0OiBSZWFjdC5Qcm9wVHlwZXMubnVtYmVyXG59O1xuXG5leHBvcnQgZGVmYXVsdCBXYWxsO1xuXG5cblxuLyoqIFdFQlBBQ0sgRk9PVEVSICoqXG4gKiogLi9+L2VzbGludC1sb2FkZXIhLi9zcmMvY29tcG9uZW50cy9XYWxsLmpzeFxuICoqLyIsImltcG9ydCBSeCBmcm9tICdyeCc7XG5pbXBvcnQgZmV0Y2hKc29ucCBmcm9tICdmZXRjaC1qc29ucCc7XG5cbmNvbnN0IGdldFN0cmVhbSA9IChjb2xsZWN0aW9uSWQpID0+IHtcblxuICAgIGNvbnN0IHBvbGxSYXRlID0gNSAqIDEwMDA7XG5cbiAgICBjb25zdCByZXF1ZXN0U3RyZWFtID0gUnguT2JzZXJ2YWJsZS5qdXN0KGBodHRwOi8vYXBwLmNsaW1iLnNvY2lhbC9hcGkvdjEvY29sbGVjdGlvbnMvJHtjb2xsZWN0aW9uSWR9YCk7XG5cbiAgICBjb25zdCB1cGRhdGVTdHJlYW0gPSBSeC5PYnNlcnZhYmxlLmludGVydmFsKHBvbGxSYXRlKS5zdGFydFdpdGgobnVsbCk7XG5cbiAgICBjb25zdCByZXNwb25zZVN0cmVhbSA9IHVwZGF0ZVN0cmVhbVxuXG4gICAgICAgIC5jb21iaW5lTGF0ZXN0KHJlcXVlc3RTdHJlYW0sICh0aWNrLCB1cmwpID0+IHtcbiAgICAgICAgICAgIHJldHVybiB1cmw7XG4gICAgICAgIH0pXG5cbiAgICAgICAgLmZsYXRNYXAoYmFzZVVybCA9PiB7XG5cbiAgICAgICAgICAgIGNvbnN0IHJlcXVlc3RVcmwgPSBgJHtiYXNlVXJsfWA7XG5cbiAgICAgICAgICAgIHJldHVybiBSeC5PYnNlcnZhYmxlLmZyb21Qcm9taXNlKFxuICAgICAgICAgICAgICAgIGZldGNoSnNvbnAocmVxdWVzdFVybClcbiAgICAgICAgICAgICAgICAgICAgLnRoZW4ocmVzcCA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gcmVzcC5qc29uKCk7XG4gICAgICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICApO1xuICAgICAgICB9KTtcblxuICAgIHJldHVybiByZXNwb25zZVN0cmVhbTtcbn07XG5cbmNvbnN0IGNsaW1iID0ge1xuICAgIGdldFN0cmVhbVxufTtcblxuZXhwb3J0IGRlZmF1bHQgY2xpbWI7XG5cblxuXG4vKiogV0VCUEFDSyBGT09URVIgKipcbiAqKiAuL34vZXNsaW50LWxvYWRlciEuL3NyYy91dGlscy9jbGltYi5qc1xuICoqLyIsIihmdW5jdGlvbiAoZ2xvYmFsLCBmYWN0b3J5KSB7XG4gIGlmICh0eXBlb2YgZGVmaW5lID09PSAnZnVuY3Rpb24nICYmIGRlZmluZS5hbWQpIHtcbiAgICBkZWZpbmUoWydleHBvcnRzJywgJ21vZHVsZSddLCBmYWN0b3J5KTtcbiAgfSBlbHNlIGlmICh0eXBlb2YgZXhwb3J0cyAhPT0gJ3VuZGVmaW5lZCcgJiYgdHlwZW9mIG1vZHVsZSAhPT0gJ3VuZGVmaW5lZCcpIHtcbiAgICBmYWN0b3J5KGV4cG9ydHMsIG1vZHVsZSk7XG4gIH0gZWxzZSB7XG4gICAgdmFyIG1vZCA9IHtcbiAgICAgIGV4cG9ydHM6IHt9XG4gICAgfTtcbiAgICBmYWN0b3J5KG1vZC5leHBvcnRzLCBtb2QpO1xuICAgIGdsb2JhbC5mZXRjaEpzb25wID0gbW9kLmV4cG9ydHM7XG4gIH1cbn0pKHRoaXMsIGZ1bmN0aW9uIChleHBvcnRzLCBtb2R1bGUpIHtcbiAgJ3VzZSBzdHJpY3QnO1xuXG4gIHZhciBkZWZhdWx0T3B0aW9ucyA9IHtcbiAgICB0aW1lb3V0OiA1MDAwLFxuICAgIGpzb25wQ2FsbGJhY2s6ICdjYWxsYmFjaydcbiAgfTtcblxuICBmdW5jdGlvbiBnZW5lcmF0ZUNhbGxiYWNrRnVuY3Rpb24oKSB7XG4gICAgcmV0dXJuICdqc29ucF8nICsgRGF0ZS5ub3coKSArICdfJyArIE1hdGguY2VpbChNYXRoLnJhbmRvbSgpICogMTAwMDAwKTtcbiAgfVxuXG4gIC8vIEtub3duIGlzc3VlOiBXaWxsIHRocm93ICdVbmNhdWdodCBSZWZlcmVuY2VFcnJvcjogY2FsbGJhY2tfKioqIGlzIG5vdCBkZWZpbmVkJyBlcnJvciBpZiByZXF1ZXN0IHRpbWVvdXRcbiAgZnVuY3Rpb24gY2xlYXJGdW5jdGlvbihmdW5jdGlvbk5hbWUpIHtcbiAgICAvLyBJRTggdGhyb3dzIGFuIGV4Y2VwdGlvbiB3aGVuIHlvdSB0cnkgdG8gZGVsZXRlIGEgcHJvcGVydHkgb24gd2luZG93XG4gICAgLy8gaHR0cDovL3N0YWNrb3ZlcmZsb3cuY29tL2EvMTgyNDIyOC83NTEwODlcbiAgICB0cnkge1xuICAgICAgZGVsZXRlIHdpbmRvd1tmdW5jdGlvbk5hbWVdO1xuICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgIHdpbmRvd1tmdW5jdGlvbk5hbWVdID0gdW5kZWZpbmVkO1xuICAgIH1cbiAgfVxuXG4gIGZ1bmN0aW9uIHJlbW92ZVNjcmlwdChzY3JpcHRJZCkge1xuICAgIHZhciBzY3JpcHQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChzY3JpcHRJZCk7XG4gICAgZG9jdW1lbnQuZ2V0RWxlbWVudHNCeVRhZ05hbWUoXCJoZWFkXCIpWzBdLnJlbW92ZUNoaWxkKHNjcmlwdCk7XG4gIH1cblxuICB2YXIgZmV0Y2hKc29ucCA9IGZ1bmN0aW9uIGZldGNoSnNvbnAodXJsKSB7XG4gICAgdmFyIG9wdGlvbnMgPSBhcmd1bWVudHMubGVuZ3RoIDw9IDEgfHwgYXJndW1lbnRzWzFdID09PSB1bmRlZmluZWQgPyB7fSA6IGFyZ3VtZW50c1sxXTtcblxuICAgIHZhciB0aW1lb3V0ID0gb3B0aW9ucy50aW1lb3V0ICE9IG51bGwgPyBvcHRpb25zLnRpbWVvdXQgOiBkZWZhdWx0T3B0aW9ucy50aW1lb3V0O1xuICAgIHZhciBqc29ucENhbGxiYWNrID0gb3B0aW9ucy5qc29ucENhbGxiYWNrICE9IG51bGwgPyBvcHRpb25zLmpzb25wQ2FsbGJhY2sgOiBkZWZhdWx0T3B0aW9ucy5qc29ucENhbGxiYWNrO1xuXG4gICAgdmFyIHRpbWVvdXRJZCA9IHVuZGVmaW5lZDtcblxuICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7XG4gICAgICB2YXIgY2FsbGJhY2tGdW5jdGlvbiA9IGdlbmVyYXRlQ2FsbGJhY2tGdW5jdGlvbigpO1xuXG4gICAgICB3aW5kb3dbY2FsbGJhY2tGdW5jdGlvbl0gPSBmdW5jdGlvbiAocmVzcG9uc2UpIHtcbiAgICAgICAgcmVzb2x2ZSh7XG4gICAgICAgICAgb2s6IHRydWUsXG4gICAgICAgICAgLy8ga2VlcCBjb25zaXN0ZW50IHdpdGggZmV0Y2ggQVBJXG4gICAgICAgICAganNvbjogZnVuY3Rpb24ganNvbigpIHtcbiAgICAgICAgICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUocmVzcG9uc2UpO1xuICAgICAgICAgIH1cbiAgICAgICAgfSk7XG5cbiAgICAgICAgaWYgKHRpbWVvdXRJZCkgY2xlYXJUaW1lb3V0KHRpbWVvdXRJZCk7XG5cbiAgICAgICAgcmVtb3ZlU2NyaXB0KGpzb25wQ2FsbGJhY2sgKyAnXycgKyBjYWxsYmFja0Z1bmN0aW9uKTtcblxuICAgICAgICBjbGVhckZ1bmN0aW9uKGNhbGxiYWNrRnVuY3Rpb24pO1xuICAgICAgfTtcblxuICAgICAgLy8gQ2hlY2sgaWYgdGhlIHVzZXIgc2V0IHRoZWlyIG93biBwYXJhbXMsIGFuZCBpZiBub3QgYWRkIGEgPyB0byBzdGFydCBhIGxpc3Qgb2YgcGFyYW1zXG4gICAgICB1cmwgKz0gdXJsLmluZGV4T2YoJz8nKSA9PT0gLTEgPyAnPycgOiAnJic7XG5cbiAgICAgIHZhciBqc29ucFNjcmlwdCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3NjcmlwdCcpO1xuICAgICAganNvbnBTY3JpcHQuc2V0QXR0cmlidXRlKFwic3JjXCIsIHVybCArIGpzb25wQ2FsbGJhY2sgKyAnPScgKyBjYWxsYmFja0Z1bmN0aW9uKTtcbiAgICAgIGpzb25wU2NyaXB0LmlkID0ganNvbnBDYWxsYmFjayArICdfJyArIGNhbGxiYWNrRnVuY3Rpb247XG4gICAgICBkb2N1bWVudC5nZXRFbGVtZW50c0J5VGFnTmFtZShcImhlYWRcIilbMF0uYXBwZW5kQ2hpbGQoanNvbnBTY3JpcHQpO1xuXG4gICAgICB0aW1lb3V0SWQgPSBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmVqZWN0KG5ldyBFcnJvcignSlNPTlAgcmVxdWVzdCB0byAnICsgdXJsICsgJyB0aW1lZCBvdXQnKSk7XG5cbiAgICAgICAgY2xlYXJGdW5jdGlvbihjYWxsYmFja0Z1bmN0aW9uKTtcbiAgICAgICAgcmVtb3ZlU2NyaXB0KGpzb25wQ2FsbGJhY2sgKyAnXycgKyBjYWxsYmFja0Z1bmN0aW9uKTtcbiAgICAgIH0sIHRpbWVvdXQpO1xuICAgIH0pO1xuICB9O1xuXG4gIC8vIGV4cG9ydCBhcyBnbG9iYWwgZnVuY3Rpb25cbiAgLypcbiAgbGV0IGxvY2FsO1xuICBpZiAodHlwZW9mIGdsb2JhbCAhPT0gJ3VuZGVmaW5lZCcpIHtcbiAgICBsb2NhbCA9IGdsb2JhbDtcbiAgfSBlbHNlIGlmICh0eXBlb2Ygc2VsZiAhPT0gJ3VuZGVmaW5lZCcpIHtcbiAgICBsb2NhbCA9IHNlbGY7XG4gIH0gZWxzZSB7XG4gICAgdHJ5IHtcbiAgICAgIGxvY2FsID0gRnVuY3Rpb24oJ3JldHVybiB0aGlzJykoKTtcbiAgICB9IGNhdGNoIChlKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ3BvbHlmaWxsIGZhaWxlZCBiZWNhdXNlIGdsb2JhbCBvYmplY3QgaXMgdW5hdmFpbGFibGUgaW4gdGhpcyBlbnZpcm9ubWVudCcpO1xuICAgIH1cbiAgfVxuICBcbiAgbG9jYWwuZmV0Y2hKc29ucCA9IGZldGNoSnNvbnA7XG4gICovXG5cbiAgbW9kdWxlLmV4cG9ydHMgPSBmZXRjaEpzb25wO1xufSk7XG5cblxuLyoqKioqKioqKioqKioqKioqXG4gKiogV0VCUEFDSyBGT09URVJcbiAqKiAuL34vZmV0Y2gtanNvbnAvYnVpbGQvZmV0Y2gtanNvbnAuanNcbiAqKiBtb2R1bGUgaWQgPSA5XG4gKiogbW9kdWxlIGNodW5rcyA9IDBcbiAqKi8iLCIvLyBDb3B5cmlnaHQgKGMpIE1pY3Jvc29mdCBPcGVuIFRlY2hub2xvZ2llcywgSW5jLiBBbGwgcmlnaHRzIHJlc2VydmVkLiBTZWUgTGljZW5zZS50eHQgaW4gdGhlIHByb2plY3Qgcm9vdCBmb3IgbGljZW5zZSBpbmZvcm1hdGlvbi5cblxuOyhmdW5jdGlvbiAodW5kZWZpbmVkKSB7XG5cbiAgdmFyIG9iamVjdFR5cGVzID0ge1xuICAgICdmdW5jdGlvbic6IHRydWUsXG4gICAgJ29iamVjdCc6IHRydWVcbiAgfTtcblxuICB2YXJcbiAgICBmcmVlRXhwb3J0cyA9IG9iamVjdFR5cGVzW3R5cGVvZiBleHBvcnRzXSAmJiBleHBvcnRzICYmICFleHBvcnRzLm5vZGVUeXBlICYmIGV4cG9ydHMsXG4gICAgZnJlZVNlbGYgPSBvYmplY3RUeXBlc1t0eXBlb2Ygc2VsZl0gJiYgc2VsZi5PYmplY3QgJiYgc2VsZixcbiAgICBmcmVlV2luZG93ID0gb2JqZWN0VHlwZXNbdHlwZW9mIHdpbmRvd10gJiYgd2luZG93ICYmIHdpbmRvdy5PYmplY3QgJiYgd2luZG93LFxuICAgIGZyZWVNb2R1bGUgPSBvYmplY3RUeXBlc1t0eXBlb2YgbW9kdWxlXSAmJiBtb2R1bGUgJiYgIW1vZHVsZS5ub2RlVHlwZSAmJiBtb2R1bGUsXG4gICAgbW9kdWxlRXhwb3J0cyA9IGZyZWVNb2R1bGUgJiYgZnJlZU1vZHVsZS5leHBvcnRzID09PSBmcmVlRXhwb3J0cyAmJiBmcmVlRXhwb3J0cyxcbiAgICBmcmVlR2xvYmFsID0gZnJlZUV4cG9ydHMgJiYgZnJlZU1vZHVsZSAmJiB0eXBlb2YgZ2xvYmFsID09ICdvYmplY3QnICYmIGdsb2JhbCAmJiBnbG9iYWwuT2JqZWN0ICYmIGdsb2JhbDtcblxuICB2YXIgcm9vdCA9IHJvb3QgPSBmcmVlR2xvYmFsIHx8ICgoZnJlZVdpbmRvdyAhPT0gKHRoaXMgJiYgdGhpcy53aW5kb3cpKSAmJiBmcmVlV2luZG93KSB8fCBmcmVlU2VsZiB8fCB0aGlzO1xuXG4gIHZhciBSeCA9IHtcbiAgICBpbnRlcm5hbHM6IHt9LFxuICAgIGNvbmZpZzoge1xuICAgICAgUHJvbWlzZTogcm9vdC5Qcm9taXNlXG4gICAgfSxcbiAgICBoZWxwZXJzOiB7IH1cbiAgfTtcblxuICAvLyBEZWZhdWx0c1xuICB2YXIgbm9vcCA9IFJ4LmhlbHBlcnMubm9vcCA9IGZ1bmN0aW9uICgpIHsgfSxcbiAgICBpZGVudGl0eSA9IFJ4LmhlbHBlcnMuaWRlbnRpdHkgPSBmdW5jdGlvbiAoeCkgeyByZXR1cm4geDsgfSxcbiAgICBkZWZhdWx0Tm93ID0gUnguaGVscGVycy5kZWZhdWx0Tm93ID0gRGF0ZS5ub3csXG4gICAgZGVmYXVsdENvbXBhcmVyID0gUnguaGVscGVycy5kZWZhdWx0Q29tcGFyZXIgPSBmdW5jdGlvbiAoeCwgeSkgeyByZXR1cm4gaXNFcXVhbCh4LCB5KTsgfSxcbiAgICBkZWZhdWx0U3ViQ29tcGFyZXIgPSBSeC5oZWxwZXJzLmRlZmF1bHRTdWJDb21wYXJlciA9IGZ1bmN0aW9uICh4LCB5KSB7IHJldHVybiB4ID4geSA/IDEgOiAoeCA8IHkgPyAtMSA6IDApOyB9LFxuICAgIGRlZmF1bHRLZXlTZXJpYWxpemVyID0gUnguaGVscGVycy5kZWZhdWx0S2V5U2VyaWFsaXplciA9IGZ1bmN0aW9uICh4KSB7IHJldHVybiB4LnRvU3RyaW5nKCk7IH0sXG4gICAgZGVmYXVsdEVycm9yID0gUnguaGVscGVycy5kZWZhdWx0RXJyb3IgPSBmdW5jdGlvbiAoZXJyKSB7IHRocm93IGVycjsgfSxcbiAgICBpc1Byb21pc2UgPSBSeC5oZWxwZXJzLmlzUHJvbWlzZSA9IGZ1bmN0aW9uIChwKSB7IHJldHVybiAhIXAgJiYgdHlwZW9mIHAuc3Vic2NyaWJlICE9PSAnZnVuY3Rpb24nICYmIHR5cGVvZiBwLnRoZW4gPT09ICdmdW5jdGlvbic7IH0sXG4gICAgaXNGdW5jdGlvbiA9IFJ4LmhlbHBlcnMuaXNGdW5jdGlvbiA9IChmdW5jdGlvbiAoKSB7XG5cbiAgICAgIHZhciBpc0ZuID0gZnVuY3Rpb24gKHZhbHVlKSB7XG4gICAgICAgIHJldHVybiB0eXBlb2YgdmFsdWUgPT0gJ2Z1bmN0aW9uJyB8fCBmYWxzZTtcbiAgICAgIH1cblxuICAgICAgLy8gZmFsbGJhY2sgZm9yIG9sZGVyIHZlcnNpb25zIG9mIENocm9tZSBhbmQgU2FmYXJpXG4gICAgICBpZiAoaXNGbigveC8pKSB7XG4gICAgICAgIGlzRm4gPSBmdW5jdGlvbih2YWx1ZSkge1xuICAgICAgICAgIHJldHVybiB0eXBlb2YgdmFsdWUgPT0gJ2Z1bmN0aW9uJyAmJiB0b1N0cmluZy5jYWxsKHZhbHVlKSA9PSAnW29iamVjdCBGdW5jdGlvbl0nO1xuICAgICAgICB9O1xuICAgICAgfVxuXG4gICAgICByZXR1cm4gaXNGbjtcbiAgICB9KCkpO1xuXG4gIGZ1bmN0aW9uIGNsb25lQXJyYXkoYXJyKSB7IGZvcih2YXIgYSA9IFtdLCBpID0gMCwgbGVuID0gYXJyLmxlbmd0aDsgaSA8IGxlbjsgaSsrKSB7IGEucHVzaChhcnJbaV0pOyB9IHJldHVybiBhO31cblxuICB2YXIgZXJyb3JPYmogPSB7ZToge319O1xuICBcbiAgZnVuY3Rpb24gdHJ5Q2F0Y2hlckdlbih0cnlDYXRjaFRhcmdldCkge1xuICAgIHJldHVybiBmdW5jdGlvbiB0cnlDYXRjaGVyKCkge1xuICAgICAgdHJ5IHtcbiAgICAgICAgcmV0dXJuIHRyeUNhdGNoVGFyZ2V0LmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7XG4gICAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgIGVycm9yT2JqLmUgPSBlO1xuICAgICAgICByZXR1cm4gZXJyb3JPYmo7XG4gICAgICB9XG4gICAgfTtcbiAgfVxuXG4gIHZhciB0cnlDYXRjaCA9IFJ4LmludGVybmFscy50cnlDYXRjaCA9IGZ1bmN0aW9uIHRyeUNhdGNoKGZuKSB7XG4gICAgaWYgKCFpc0Z1bmN0aW9uKGZuKSkgeyB0aHJvdyBuZXcgVHlwZUVycm9yKCdmbiBtdXN0IGJlIGEgZnVuY3Rpb24nKTsgfVxuICAgIHJldHVybiB0cnlDYXRjaGVyR2VuKGZuKTtcbiAgfTtcblxuICBmdW5jdGlvbiB0aHJvd2VyKGUpIHtcbiAgICB0aHJvdyBlO1xuICB9XG5cbiAgUnguY29uZmlnLmxvbmdTdGFja1N1cHBvcnQgPSBmYWxzZTtcbiAgdmFyIGhhc1N0YWNrcyA9IGZhbHNlLCBzdGFja3MgPSB0cnlDYXRjaChmdW5jdGlvbiAoKSB7IHRocm93IG5ldyBFcnJvcigpOyB9KSgpO1xuICBoYXNTdGFja3MgPSAhIXN0YWNrcy5lICYmICEhc3RhY2tzLmUuc3RhY2s7XG5cbiAgLy8gQWxsIGNvZGUgYWZ0ZXIgdGhpcyBwb2ludCB3aWxsIGJlIGZpbHRlcmVkIGZyb20gc3RhY2sgdHJhY2VzIHJlcG9ydGVkIGJ5IFJ4SlNcbiAgdmFyIHJTdGFydGluZ0xpbmUgPSBjYXB0dXJlTGluZSgpLCByRmlsZU5hbWU7XG5cbiAgdmFyIFNUQUNLX0pVTVBfU0VQQVJBVE9SID0gJ0Zyb20gcHJldmlvdXMgZXZlbnQ6JztcblxuICBmdW5jdGlvbiBtYWtlU3RhY2tUcmFjZUxvbmcoZXJyb3IsIG9ic2VydmFibGUpIHtcbiAgICAvLyBJZiBwb3NzaWJsZSwgdHJhbnNmb3JtIHRoZSBlcnJvciBzdGFjayB0cmFjZSBieSByZW1vdmluZyBOb2RlIGFuZCBSeEpTXG4gICAgLy8gY3J1ZnQsIHRoZW4gY29uY2F0ZW5hdGluZyB3aXRoIHRoZSBzdGFjayB0cmFjZSBvZiBgb2JzZXJ2YWJsZWAuXG4gICAgaWYgKGhhc1N0YWNrcyAmJlxuICAgICAgICBvYnNlcnZhYmxlLnN0YWNrICYmXG4gICAgICAgIHR5cGVvZiBlcnJvciA9PT0gJ29iamVjdCcgJiZcbiAgICAgICAgZXJyb3IgIT09IG51bGwgJiZcbiAgICAgICAgZXJyb3Iuc3RhY2sgJiZcbiAgICAgICAgZXJyb3Iuc3RhY2suaW5kZXhPZihTVEFDS19KVU1QX1NFUEFSQVRPUikgPT09IC0xXG4gICAgKSB7XG4gICAgICB2YXIgc3RhY2tzID0gW107XG4gICAgICBmb3IgKHZhciBvID0gb2JzZXJ2YWJsZTsgISFvOyBvID0gby5zb3VyY2UpIHtcbiAgICAgICAgaWYgKG8uc3RhY2spIHtcbiAgICAgICAgICBzdGFja3MudW5zaGlmdChvLnN0YWNrKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgc3RhY2tzLnVuc2hpZnQoZXJyb3Iuc3RhY2spO1xuXG4gICAgICB2YXIgY29uY2F0ZWRTdGFja3MgPSBzdGFja3Muam9pbignXFxuJyArIFNUQUNLX0pVTVBfU0VQQVJBVE9SICsgJ1xcbicpO1xuICAgICAgZXJyb3Iuc3RhY2sgPSBmaWx0ZXJTdGFja1N0cmluZyhjb25jYXRlZFN0YWNrcyk7XG4gICAgfVxuICB9XG5cbiAgZnVuY3Rpb24gZmlsdGVyU3RhY2tTdHJpbmcoc3RhY2tTdHJpbmcpIHtcbiAgICB2YXIgbGluZXMgPSBzdGFja1N0cmluZy5zcGxpdCgnXFxuJyksIGRlc2lyZWRMaW5lcyA9IFtdO1xuICAgIGZvciAodmFyIGkgPSAwLCBsZW4gPSBsaW5lcy5sZW5ndGg7IGkgPCBsZW47IGkrKykge1xuICAgICAgdmFyIGxpbmUgPSBsaW5lc1tpXTtcblxuICAgICAgaWYgKCFpc0ludGVybmFsRnJhbWUobGluZSkgJiYgIWlzTm9kZUZyYW1lKGxpbmUpICYmIGxpbmUpIHtcbiAgICAgICAgZGVzaXJlZExpbmVzLnB1c2gobGluZSk7XG4gICAgICB9XG4gICAgfVxuICAgIHJldHVybiBkZXNpcmVkTGluZXMuam9pbignXFxuJyk7XG4gIH1cblxuICBmdW5jdGlvbiBpc0ludGVybmFsRnJhbWUoc3RhY2tMaW5lKSB7XG4gICAgdmFyIGZpbGVOYW1lQW5kTGluZU51bWJlciA9IGdldEZpbGVOYW1lQW5kTGluZU51bWJlcihzdGFja0xpbmUpO1xuICAgIGlmICghZmlsZU5hbWVBbmRMaW5lTnVtYmVyKSB7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICAgIHZhciBmaWxlTmFtZSA9IGZpbGVOYW1lQW5kTGluZU51bWJlclswXSwgbGluZU51bWJlciA9IGZpbGVOYW1lQW5kTGluZU51bWJlclsxXTtcblxuICAgIHJldHVybiBmaWxlTmFtZSA9PT0gckZpbGVOYW1lICYmXG4gICAgICBsaW5lTnVtYmVyID49IHJTdGFydGluZ0xpbmUgJiZcbiAgICAgIGxpbmVOdW1iZXIgPD0gckVuZGluZ0xpbmU7XG4gIH1cblxuICBmdW5jdGlvbiBpc05vZGVGcmFtZShzdGFja0xpbmUpIHtcbiAgICByZXR1cm4gc3RhY2tMaW5lLmluZGV4T2YoJyhtb2R1bGUuanM6JykgIT09IC0xIHx8XG4gICAgICBzdGFja0xpbmUuaW5kZXhPZignKG5vZGUuanM6JykgIT09IC0xO1xuICB9XG5cbiAgZnVuY3Rpb24gY2FwdHVyZUxpbmUoKSB7XG4gICAgaWYgKCFoYXNTdGFja3MpIHsgcmV0dXJuOyB9XG5cbiAgICB0cnkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKCk7XG4gICAgfSBjYXRjaCAoZSkge1xuICAgICAgdmFyIGxpbmVzID0gZS5zdGFjay5zcGxpdCgnXFxuJyk7XG4gICAgICB2YXIgZmlyc3RMaW5lID0gbGluZXNbMF0uaW5kZXhPZignQCcpID4gMCA/IGxpbmVzWzFdIDogbGluZXNbMl07XG4gICAgICB2YXIgZmlsZU5hbWVBbmRMaW5lTnVtYmVyID0gZ2V0RmlsZU5hbWVBbmRMaW5lTnVtYmVyKGZpcnN0TGluZSk7XG4gICAgICBpZiAoIWZpbGVOYW1lQW5kTGluZU51bWJlcikgeyByZXR1cm47IH1cblxuICAgICAgckZpbGVOYW1lID0gZmlsZU5hbWVBbmRMaW5lTnVtYmVyWzBdO1xuICAgICAgcmV0dXJuIGZpbGVOYW1lQW5kTGluZU51bWJlclsxXTtcbiAgICB9XG4gIH1cblxuICBmdW5jdGlvbiBnZXRGaWxlTmFtZUFuZExpbmVOdW1iZXIoc3RhY2tMaW5lKSB7XG4gICAgLy8gTmFtZWQgZnVuY3Rpb25zOiAnYXQgZnVuY3Rpb25OYW1lIChmaWxlbmFtZTpsaW5lTnVtYmVyOmNvbHVtbk51bWJlciknXG4gICAgdmFyIGF0dGVtcHQxID0gL2F0IC4rIFxcKCguKyk6KFxcZCspOig/OlxcZCspXFwpJC8uZXhlYyhzdGFja0xpbmUpO1xuICAgIGlmIChhdHRlbXB0MSkgeyByZXR1cm4gW2F0dGVtcHQxWzFdLCBOdW1iZXIoYXR0ZW1wdDFbMl0pXTsgfVxuXG4gICAgLy8gQW5vbnltb3VzIGZ1bmN0aW9uczogJ2F0IGZpbGVuYW1lOmxpbmVOdW1iZXI6Y29sdW1uTnVtYmVyJ1xuICAgIHZhciBhdHRlbXB0MiA9IC9hdCAoW14gXSspOihcXGQrKTooPzpcXGQrKSQvLmV4ZWMoc3RhY2tMaW5lKTtcbiAgICBpZiAoYXR0ZW1wdDIpIHsgcmV0dXJuIFthdHRlbXB0MlsxXSwgTnVtYmVyKGF0dGVtcHQyWzJdKV07IH1cblxuICAgIC8vIEZpcmVmb3ggc3R5bGU6ICdmdW5jdGlvbkBmaWxlbmFtZTpsaW5lTnVtYmVyIG9yIEBmaWxlbmFtZTpsaW5lTnVtYmVyJ1xuICAgIHZhciBhdHRlbXB0MyA9IC8uKkAoLispOihcXGQrKSQvLmV4ZWMoc3RhY2tMaW5lKTtcbiAgICBpZiAoYXR0ZW1wdDMpIHsgcmV0dXJuIFthdHRlbXB0M1sxXSwgTnVtYmVyKGF0dGVtcHQzWzJdKV07IH1cbiAgfVxuXG4gIHZhciBFbXB0eUVycm9yID0gUnguRW1wdHlFcnJvciA9IGZ1bmN0aW9uKCkge1xuICAgIHRoaXMubWVzc2FnZSA9ICdTZXF1ZW5jZSBjb250YWlucyBubyBlbGVtZW50cy4nO1xuICAgIHRoaXMubmFtZSA9ICdFbXB0eUVycm9yJztcbiAgICBFcnJvci5jYWxsKHRoaXMpO1xuICB9O1xuICBFbXB0eUVycm9yLnByb3RvdHlwZSA9IE9iamVjdC5jcmVhdGUoRXJyb3IucHJvdG90eXBlKTtcblxuICB2YXIgT2JqZWN0RGlzcG9zZWRFcnJvciA9IFJ4Lk9iamVjdERpc3Bvc2VkRXJyb3IgPSBmdW5jdGlvbigpIHtcbiAgICB0aGlzLm1lc3NhZ2UgPSAnT2JqZWN0IGhhcyBiZWVuIGRpc3Bvc2VkJztcbiAgICB0aGlzLm5hbWUgPSAnT2JqZWN0RGlzcG9zZWRFcnJvcic7XG4gICAgRXJyb3IuY2FsbCh0aGlzKTtcbiAgfTtcbiAgT2JqZWN0RGlzcG9zZWRFcnJvci5wcm90b3R5cGUgPSBPYmplY3QuY3JlYXRlKEVycm9yLnByb3RvdHlwZSk7XG5cbiAgdmFyIEFyZ3VtZW50T3V0T2ZSYW5nZUVycm9yID0gUnguQXJndW1lbnRPdXRPZlJhbmdlRXJyb3IgPSBmdW5jdGlvbiAoKSB7XG4gICAgdGhpcy5tZXNzYWdlID0gJ0FyZ3VtZW50IG91dCBvZiByYW5nZSc7XG4gICAgdGhpcy5uYW1lID0gJ0FyZ3VtZW50T3V0T2ZSYW5nZUVycm9yJztcbiAgICBFcnJvci5jYWxsKHRoaXMpO1xuICB9O1xuICBBcmd1bWVudE91dE9mUmFuZ2VFcnJvci5wcm90b3R5cGUgPSBPYmplY3QuY3JlYXRlKEVycm9yLnByb3RvdHlwZSk7XG5cbiAgdmFyIE5vdFN1cHBvcnRlZEVycm9yID0gUnguTm90U3VwcG9ydGVkRXJyb3IgPSBmdW5jdGlvbiAobWVzc2FnZSkge1xuICAgIHRoaXMubWVzc2FnZSA9IG1lc3NhZ2UgfHwgJ1RoaXMgb3BlcmF0aW9uIGlzIG5vdCBzdXBwb3J0ZWQnO1xuICAgIHRoaXMubmFtZSA9ICdOb3RTdXBwb3J0ZWRFcnJvcic7XG4gICAgRXJyb3IuY2FsbCh0aGlzKTtcbiAgfTtcbiAgTm90U3VwcG9ydGVkRXJyb3IucHJvdG90eXBlID0gT2JqZWN0LmNyZWF0ZShFcnJvci5wcm90b3R5cGUpO1xuXG4gIHZhciBOb3RJbXBsZW1lbnRlZEVycm9yID0gUnguTm90SW1wbGVtZW50ZWRFcnJvciA9IGZ1bmN0aW9uIChtZXNzYWdlKSB7XG4gICAgdGhpcy5tZXNzYWdlID0gbWVzc2FnZSB8fCAnVGhpcyBvcGVyYXRpb24gaXMgbm90IGltcGxlbWVudGVkJztcbiAgICB0aGlzLm5hbWUgPSAnTm90SW1wbGVtZW50ZWRFcnJvcic7XG4gICAgRXJyb3IuY2FsbCh0aGlzKTtcbiAgfTtcbiAgTm90SW1wbGVtZW50ZWRFcnJvci5wcm90b3R5cGUgPSBPYmplY3QuY3JlYXRlKEVycm9yLnByb3RvdHlwZSk7XG5cbiAgdmFyIG5vdEltcGxlbWVudGVkID0gUnguaGVscGVycy5ub3RJbXBsZW1lbnRlZCA9IGZ1bmN0aW9uICgpIHtcbiAgICB0aHJvdyBuZXcgTm90SW1wbGVtZW50ZWRFcnJvcigpO1xuICB9O1xuXG4gIHZhciBub3RTdXBwb3J0ZWQgPSBSeC5oZWxwZXJzLm5vdFN1cHBvcnRlZCA9IGZ1bmN0aW9uICgpIHtcbiAgICB0aHJvdyBuZXcgTm90U3VwcG9ydGVkRXJyb3IoKTtcbiAgfTtcblxuICAvLyBTaGltIGluIGl0ZXJhdG9yIHN1cHBvcnRcbiAgdmFyICRpdGVyYXRvciQgPSAodHlwZW9mIFN5bWJvbCA9PT0gJ2Z1bmN0aW9uJyAmJiBTeW1ib2wuaXRlcmF0b3IpIHx8XG4gICAgJ19lczZzaGltX2l0ZXJhdG9yXyc7XG4gIC8vIEJ1ZyBmb3IgbW96aWxsYSB2ZXJzaW9uXG4gIGlmIChyb290LlNldCAmJiB0eXBlb2YgbmV3IHJvb3QuU2V0KClbJ0BAaXRlcmF0b3InXSA9PT0gJ2Z1bmN0aW9uJykge1xuICAgICRpdGVyYXRvciQgPSAnQEBpdGVyYXRvcic7XG4gIH1cblxuICB2YXIgZG9uZUVudW1lcmF0b3IgPSBSeC5kb25lRW51bWVyYXRvciA9IHsgZG9uZTogdHJ1ZSwgdmFsdWU6IHVuZGVmaW5lZCB9O1xuXG4gIHZhciBpc0l0ZXJhYmxlID0gUnguaGVscGVycy5pc0l0ZXJhYmxlID0gZnVuY3Rpb24gKG8pIHtcbiAgICByZXR1cm4gb1skaXRlcmF0b3IkXSAhPT0gdW5kZWZpbmVkO1xuICB9XG5cbiAgdmFyIGlzQXJyYXlMaWtlID0gUnguaGVscGVycy5pc0FycmF5TGlrZSA9IGZ1bmN0aW9uIChvKSB7XG4gICAgcmV0dXJuIG8gJiYgby5sZW5ndGggIT09IHVuZGVmaW5lZDtcbiAgfVxuXG4gIFJ4LmhlbHBlcnMuaXRlcmF0b3IgPSAkaXRlcmF0b3IkO1xuXG4gIHZhciBiaW5kQ2FsbGJhY2sgPSBSeC5pbnRlcm5hbHMuYmluZENhbGxiYWNrID0gZnVuY3Rpb24gKGZ1bmMsIHRoaXNBcmcsIGFyZ0NvdW50KSB7XG4gICAgaWYgKHR5cGVvZiB0aGlzQXJnID09PSAndW5kZWZpbmVkJykgeyByZXR1cm4gZnVuYzsgfVxuICAgIHN3aXRjaChhcmdDb3VudCkge1xuICAgICAgY2FzZSAwOlxuICAgICAgICByZXR1cm4gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgcmV0dXJuIGZ1bmMuY2FsbCh0aGlzQXJnKVxuICAgICAgICB9O1xuICAgICAgY2FzZSAxOlxuICAgICAgICByZXR1cm4gZnVuY3Rpb24oYXJnKSB7XG4gICAgICAgICAgcmV0dXJuIGZ1bmMuY2FsbCh0aGlzQXJnLCBhcmcpO1xuICAgICAgICB9XG4gICAgICBjYXNlIDI6XG4gICAgICAgIHJldHVybiBmdW5jdGlvbih2YWx1ZSwgaW5kZXgpIHtcbiAgICAgICAgICByZXR1cm4gZnVuYy5jYWxsKHRoaXNBcmcsIHZhbHVlLCBpbmRleCk7XG4gICAgICAgIH07XG4gICAgICBjYXNlIDM6XG4gICAgICAgIHJldHVybiBmdW5jdGlvbih2YWx1ZSwgaW5kZXgsIGNvbGxlY3Rpb24pIHtcbiAgICAgICAgICByZXR1cm4gZnVuYy5jYWxsKHRoaXNBcmcsIHZhbHVlLCBpbmRleCwgY29sbGVjdGlvbik7XG4gICAgICAgIH07XG4gICAgfVxuXG4gICAgcmV0dXJuIGZ1bmN0aW9uKCkge1xuICAgICAgcmV0dXJuIGZ1bmMuYXBwbHkodGhpc0FyZywgYXJndW1lbnRzKTtcbiAgICB9O1xuICB9O1xuXG4gIC8qKiBVc2VkIHRvIGRldGVybWluZSBpZiB2YWx1ZXMgYXJlIG9mIHRoZSBsYW5ndWFnZSB0eXBlIE9iamVjdCAqL1xuICB2YXIgZG9udEVudW1zID0gWyd0b1N0cmluZycsXG4gICAgJ3RvTG9jYWxlU3RyaW5nJyxcbiAgICAndmFsdWVPZicsXG4gICAgJ2hhc093blByb3BlcnR5JyxcbiAgICAnaXNQcm90b3R5cGVPZicsXG4gICAgJ3Byb3BlcnR5SXNFbnVtZXJhYmxlJyxcbiAgICAnY29uc3RydWN0b3InXSxcbiAgZG9udEVudW1zTGVuZ3RoID0gZG9udEVudW1zLmxlbmd0aDtcblxuICAvKiogYE9iamVjdCN0b1N0cmluZ2AgcmVzdWx0IHNob3J0Y3V0cyAqL1xuICB2YXIgYXJnc0NsYXNzID0gJ1tvYmplY3QgQXJndW1lbnRzXScsXG4gICAgYXJyYXlDbGFzcyA9ICdbb2JqZWN0IEFycmF5XScsXG4gICAgYm9vbENsYXNzID0gJ1tvYmplY3QgQm9vbGVhbl0nLFxuICAgIGRhdGVDbGFzcyA9ICdbb2JqZWN0IERhdGVdJyxcbiAgICBlcnJvckNsYXNzID0gJ1tvYmplY3QgRXJyb3JdJyxcbiAgICBmdW5jQ2xhc3MgPSAnW29iamVjdCBGdW5jdGlvbl0nLFxuICAgIG51bWJlckNsYXNzID0gJ1tvYmplY3QgTnVtYmVyXScsXG4gICAgb2JqZWN0Q2xhc3MgPSAnW29iamVjdCBPYmplY3RdJyxcbiAgICByZWdleHBDbGFzcyA9ICdbb2JqZWN0IFJlZ0V4cF0nLFxuICAgIHN0cmluZ0NsYXNzID0gJ1tvYmplY3QgU3RyaW5nXSc7XG5cbiAgdmFyIHRvU3RyaW5nID0gT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZyxcbiAgICBoYXNPd25Qcm9wZXJ0eSA9IE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHksXG4gICAgc3VwcG9ydHNBcmdzQ2xhc3MgPSB0b1N0cmluZy5jYWxsKGFyZ3VtZW50cykgPT0gYXJnc0NsYXNzLCAvLyBGb3IgbGVzcyA8SUU5ICYmIEZGPDRcbiAgICBzdXBwb3J0Tm9kZUNsYXNzLFxuICAgIGVycm9yUHJvdG8gPSBFcnJvci5wcm90b3R5cGUsXG4gICAgb2JqZWN0UHJvdG8gPSBPYmplY3QucHJvdG90eXBlLFxuICAgIHN0cmluZ1Byb3RvID0gU3RyaW5nLnByb3RvdHlwZSxcbiAgICBwcm9wZXJ0eUlzRW51bWVyYWJsZSA9IG9iamVjdFByb3RvLnByb3BlcnR5SXNFbnVtZXJhYmxlO1xuXG4gIHRyeSB7XG4gICAgc3VwcG9ydE5vZGVDbGFzcyA9ICEodG9TdHJpbmcuY2FsbChkb2N1bWVudCkgPT0gb2JqZWN0Q2xhc3MgJiYgISh7ICd0b1N0cmluZyc6IDAgfSArICcnKSk7XG4gIH0gY2F0Y2ggKGUpIHtcbiAgICBzdXBwb3J0Tm9kZUNsYXNzID0gdHJ1ZTtcbiAgfVxuXG4gIHZhciBub25FbnVtUHJvcHMgPSB7fTtcbiAgbm9uRW51bVByb3BzW2FycmF5Q2xhc3NdID0gbm9uRW51bVByb3BzW2RhdGVDbGFzc10gPSBub25FbnVtUHJvcHNbbnVtYmVyQ2xhc3NdID0geyAnY29uc3RydWN0b3InOiB0cnVlLCAndG9Mb2NhbGVTdHJpbmcnOiB0cnVlLCAndG9TdHJpbmcnOiB0cnVlLCAndmFsdWVPZic6IHRydWUgfTtcbiAgbm9uRW51bVByb3BzW2Jvb2xDbGFzc10gPSBub25FbnVtUHJvcHNbc3RyaW5nQ2xhc3NdID0geyAnY29uc3RydWN0b3InOiB0cnVlLCAndG9TdHJpbmcnOiB0cnVlLCAndmFsdWVPZic6IHRydWUgfTtcbiAgbm9uRW51bVByb3BzW2Vycm9yQ2xhc3NdID0gbm9uRW51bVByb3BzW2Z1bmNDbGFzc10gPSBub25FbnVtUHJvcHNbcmVnZXhwQ2xhc3NdID0geyAnY29uc3RydWN0b3InOiB0cnVlLCAndG9TdHJpbmcnOiB0cnVlIH07XG4gIG5vbkVudW1Qcm9wc1tvYmplY3RDbGFzc10gPSB7ICdjb25zdHJ1Y3Rvcic6IHRydWUgfTtcblxuICB2YXIgc3VwcG9ydCA9IHt9O1xuICAoZnVuY3Rpb24gKCkge1xuICAgIHZhciBjdG9yID0gZnVuY3Rpb24oKSB7IHRoaXMueCA9IDE7IH0sXG4gICAgICBwcm9wcyA9IFtdO1xuXG4gICAgY3Rvci5wcm90b3R5cGUgPSB7ICd2YWx1ZU9mJzogMSwgJ3knOiAxIH07XG4gICAgZm9yICh2YXIga2V5IGluIG5ldyBjdG9yKSB7IHByb3BzLnB1c2goa2V5KTsgfVxuICAgIGZvciAoa2V5IGluIGFyZ3VtZW50cykgeyB9XG5cbiAgICAvLyBEZXRlY3QgaWYgYG5hbWVgIG9yIGBtZXNzYWdlYCBwcm9wZXJ0aWVzIG9mIGBFcnJvci5wcm90b3R5cGVgIGFyZSBlbnVtZXJhYmxlIGJ5IGRlZmF1bHQuXG4gICAgc3VwcG9ydC5lbnVtRXJyb3JQcm9wcyA9IHByb3BlcnR5SXNFbnVtZXJhYmxlLmNhbGwoZXJyb3JQcm90bywgJ21lc3NhZ2UnKSB8fCBwcm9wZXJ0eUlzRW51bWVyYWJsZS5jYWxsKGVycm9yUHJvdG8sICduYW1lJyk7XG5cbiAgICAvLyBEZXRlY3QgaWYgYHByb3RvdHlwZWAgcHJvcGVydGllcyBhcmUgZW51bWVyYWJsZSBieSBkZWZhdWx0LlxuICAgIHN1cHBvcnQuZW51bVByb3RvdHlwZXMgPSBwcm9wZXJ0eUlzRW51bWVyYWJsZS5jYWxsKGN0b3IsICdwcm90b3R5cGUnKTtcblxuICAgIC8vIERldGVjdCBpZiBgYXJndW1lbnRzYCBvYmplY3QgaW5kZXhlcyBhcmUgbm9uLWVudW1lcmFibGVcbiAgICBzdXBwb3J0Lm5vbkVudW1BcmdzID0ga2V5ICE9IDA7XG5cbiAgICAvLyBEZXRlY3QgaWYgcHJvcGVydGllcyBzaGFkb3dpbmcgdGhvc2Ugb24gYE9iamVjdC5wcm90b3R5cGVgIGFyZSBub24tZW51bWVyYWJsZS5cbiAgICBzdXBwb3J0Lm5vbkVudW1TaGFkb3dzID0gIS92YWx1ZU9mLy50ZXN0KHByb3BzKTtcbiAgfSgxKSk7XG5cbiAgdmFyIGlzT2JqZWN0ID0gUnguaW50ZXJuYWxzLmlzT2JqZWN0ID0gZnVuY3Rpb24odmFsdWUpIHtcbiAgICB2YXIgdHlwZSA9IHR5cGVvZiB2YWx1ZTtcbiAgICByZXR1cm4gdmFsdWUgJiYgKHR5cGUgPT0gJ2Z1bmN0aW9uJyB8fCB0eXBlID09ICdvYmplY3QnKSB8fCBmYWxzZTtcbiAgfTtcblxuICBmdW5jdGlvbiBrZXlzSW4ob2JqZWN0KSB7XG4gICAgdmFyIHJlc3VsdCA9IFtdO1xuICAgIGlmICghaXNPYmplY3Qob2JqZWN0KSkge1xuICAgICAgcmV0dXJuIHJlc3VsdDtcbiAgICB9XG4gICAgaWYgKHN1cHBvcnQubm9uRW51bUFyZ3MgJiYgb2JqZWN0Lmxlbmd0aCAmJiBpc0FyZ3VtZW50cyhvYmplY3QpKSB7XG4gICAgICBvYmplY3QgPSBzbGljZS5jYWxsKG9iamVjdCk7XG4gICAgfVxuICAgIHZhciBza2lwUHJvdG8gPSBzdXBwb3J0LmVudW1Qcm90b3R5cGVzICYmIHR5cGVvZiBvYmplY3QgPT0gJ2Z1bmN0aW9uJyxcbiAgICAgICAgc2tpcEVycm9yUHJvcHMgPSBzdXBwb3J0LmVudW1FcnJvclByb3BzICYmIChvYmplY3QgPT09IGVycm9yUHJvdG8gfHwgb2JqZWN0IGluc3RhbmNlb2YgRXJyb3IpO1xuXG4gICAgZm9yICh2YXIga2V5IGluIG9iamVjdCkge1xuICAgICAgaWYgKCEoc2tpcFByb3RvICYmIGtleSA9PSAncHJvdG90eXBlJykgJiZcbiAgICAgICAgICAhKHNraXBFcnJvclByb3BzICYmIChrZXkgPT0gJ21lc3NhZ2UnIHx8IGtleSA9PSAnbmFtZScpKSkge1xuICAgICAgICByZXN1bHQucHVzaChrZXkpO1xuICAgICAgfVxuICAgIH1cblxuICAgIGlmIChzdXBwb3J0Lm5vbkVudW1TaGFkb3dzICYmIG9iamVjdCAhPT0gb2JqZWN0UHJvdG8pIHtcbiAgICAgIHZhciBjdG9yID0gb2JqZWN0LmNvbnN0cnVjdG9yLFxuICAgICAgICAgIGluZGV4ID0gLTEsXG4gICAgICAgICAgbGVuZ3RoID0gZG9udEVudW1zTGVuZ3RoO1xuXG4gICAgICBpZiAob2JqZWN0ID09PSAoY3RvciAmJiBjdG9yLnByb3RvdHlwZSkpIHtcbiAgICAgICAgdmFyIGNsYXNzTmFtZSA9IG9iamVjdCA9PT0gc3RyaW5nUHJvdG8gPyBzdHJpbmdDbGFzcyA6IG9iamVjdCA9PT0gZXJyb3JQcm90byA/IGVycm9yQ2xhc3MgOiB0b1N0cmluZy5jYWxsKG9iamVjdCksXG4gICAgICAgICAgICBub25FbnVtID0gbm9uRW51bVByb3BzW2NsYXNzTmFtZV07XG4gICAgICB9XG4gICAgICB3aGlsZSAoKytpbmRleCA8IGxlbmd0aCkge1xuICAgICAgICBrZXkgPSBkb250RW51bXNbaW5kZXhdO1xuICAgICAgICBpZiAoIShub25FbnVtICYmIG5vbkVudW1ba2V5XSkgJiYgaGFzT3duUHJvcGVydHkuY2FsbChvYmplY3QsIGtleSkpIHtcbiAgICAgICAgICByZXN1bHQucHVzaChrZXkpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICAgIHJldHVybiByZXN1bHQ7XG4gIH1cblxuICBmdW5jdGlvbiBpbnRlcm5hbEZvcihvYmplY3QsIGNhbGxiYWNrLCBrZXlzRnVuYykge1xuICAgIHZhciBpbmRleCA9IC0xLFxuICAgICAgcHJvcHMgPSBrZXlzRnVuYyhvYmplY3QpLFxuICAgICAgbGVuZ3RoID0gcHJvcHMubGVuZ3RoO1xuXG4gICAgd2hpbGUgKCsraW5kZXggPCBsZW5ndGgpIHtcbiAgICAgIHZhciBrZXkgPSBwcm9wc1tpbmRleF07XG4gICAgICBpZiAoY2FsbGJhY2sob2JqZWN0W2tleV0sIGtleSwgb2JqZWN0KSA9PT0gZmFsc2UpIHtcbiAgICAgICAgYnJlYWs7XG4gICAgICB9XG4gICAgfVxuICAgIHJldHVybiBvYmplY3Q7XG4gIH1cblxuICBmdW5jdGlvbiBpbnRlcm5hbEZvckluKG9iamVjdCwgY2FsbGJhY2spIHtcbiAgICByZXR1cm4gaW50ZXJuYWxGb3Iob2JqZWN0LCBjYWxsYmFjaywga2V5c0luKTtcbiAgfVxuXG4gIGZ1bmN0aW9uIGlzTm9kZSh2YWx1ZSkge1xuICAgIC8vIElFIDwgOSBwcmVzZW50cyBET00gbm9kZXMgYXMgYE9iamVjdGAgb2JqZWN0cyBleGNlcHQgdGhleSBoYXZlIGB0b1N0cmluZ2BcbiAgICAvLyBtZXRob2RzIHRoYXQgYXJlIGB0eXBlb2ZgIFwic3RyaW5nXCIgYW5kIHN0aWxsIGNhbiBjb2VyY2Ugbm9kZXMgdG8gc3RyaW5nc1xuICAgIHJldHVybiB0eXBlb2YgdmFsdWUudG9TdHJpbmcgIT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YgKHZhbHVlICsgJycpID09ICdzdHJpbmcnO1xuICB9XG5cbiAgdmFyIGlzQXJndW1lbnRzID0gZnVuY3Rpb24odmFsdWUpIHtcbiAgICByZXR1cm4gKHZhbHVlICYmIHR5cGVvZiB2YWx1ZSA9PSAnb2JqZWN0JykgPyB0b1N0cmluZy5jYWxsKHZhbHVlKSA9PSBhcmdzQ2xhc3MgOiBmYWxzZTtcbiAgfVxuXG4gIC8vIGZhbGxiYWNrIGZvciBicm93c2VycyB0aGF0IGNhbid0IGRldGVjdCBgYXJndW1lbnRzYCBvYmplY3RzIGJ5IFtbQ2xhc3NdXVxuICBpZiAoIXN1cHBvcnRzQXJnc0NsYXNzKSB7XG4gICAgaXNBcmd1bWVudHMgPSBmdW5jdGlvbih2YWx1ZSkge1xuICAgICAgcmV0dXJuICh2YWx1ZSAmJiB0eXBlb2YgdmFsdWUgPT0gJ29iamVjdCcpID8gaGFzT3duUHJvcGVydHkuY2FsbCh2YWx1ZSwgJ2NhbGxlZScpIDogZmFsc2U7XG4gICAgfTtcbiAgfVxuXG4gIHZhciBpc0VxdWFsID0gUnguaW50ZXJuYWxzLmlzRXF1YWwgPSBmdW5jdGlvbiAoeCwgeSkge1xuICAgIHJldHVybiBkZWVwRXF1YWxzKHgsIHksIFtdLCBbXSk7XG4gIH07XG5cbiAgLyoqIEBwcml2YXRlXG4gICAqIFVzZWQgZm9yIGRlZXAgY29tcGFyaXNvblxuICAgKiovXG4gIGZ1bmN0aW9uIGRlZXBFcXVhbHMoYSwgYiwgc3RhY2tBLCBzdGFja0IpIHtcbiAgICAvLyBleGl0IGVhcmx5IGZvciBpZGVudGljYWwgdmFsdWVzXG4gICAgaWYgKGEgPT09IGIpIHtcbiAgICAgIC8vIHRyZWF0IGArMGAgdnMuIGAtMGAgYXMgbm90IGVxdWFsXG4gICAgICByZXR1cm4gYSAhPT0gMCB8fCAoMSAvIGEgPT0gMSAvIGIpO1xuICAgIH1cblxuICAgIHZhciB0eXBlID0gdHlwZW9mIGEsXG4gICAgICAgIG90aGVyVHlwZSA9IHR5cGVvZiBiO1xuXG4gICAgLy8gZXhpdCBlYXJseSBmb3IgdW5saWtlIHByaW1pdGl2ZSB2YWx1ZXNcbiAgICBpZiAoYSA9PT0gYSAmJiAoYSA9PSBudWxsIHx8IGIgPT0gbnVsbCB8fFxuICAgICAgICAodHlwZSAhPSAnZnVuY3Rpb24nICYmIHR5cGUgIT0gJ29iamVjdCcgJiYgb3RoZXJUeXBlICE9ICdmdW5jdGlvbicgJiYgb3RoZXJUeXBlICE9ICdvYmplY3QnKSkpIHtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG5cbiAgICAvLyBjb21wYXJlIFtbQ2xhc3NdXSBuYW1lc1xuICAgIHZhciBjbGFzc05hbWUgPSB0b1N0cmluZy5jYWxsKGEpLFxuICAgICAgICBvdGhlckNsYXNzID0gdG9TdHJpbmcuY2FsbChiKTtcblxuICAgIGlmIChjbGFzc05hbWUgPT0gYXJnc0NsYXNzKSB7XG4gICAgICBjbGFzc05hbWUgPSBvYmplY3RDbGFzcztcbiAgICB9XG4gICAgaWYgKG90aGVyQ2xhc3MgPT0gYXJnc0NsYXNzKSB7XG4gICAgICBvdGhlckNsYXNzID0gb2JqZWN0Q2xhc3M7XG4gICAgfVxuICAgIGlmIChjbGFzc05hbWUgIT0gb3RoZXJDbGFzcykge1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgICBzd2l0Y2ggKGNsYXNzTmFtZSkge1xuICAgICAgY2FzZSBib29sQ2xhc3M6XG4gICAgICBjYXNlIGRhdGVDbGFzczpcbiAgICAgICAgLy8gY29lcmNlIGRhdGVzIGFuZCBib29sZWFucyB0byBudW1iZXJzLCBkYXRlcyB0byBtaWxsaXNlY29uZHMgYW5kIGJvb2xlYW5zXG4gICAgICAgIC8vIHRvIGAxYCBvciBgMGAgdHJlYXRpbmcgaW52YWxpZCBkYXRlcyBjb2VyY2VkIHRvIGBOYU5gIGFzIG5vdCBlcXVhbFxuICAgICAgICByZXR1cm4gK2EgPT0gK2I7XG5cbiAgICAgIGNhc2UgbnVtYmVyQ2xhc3M6XG4gICAgICAgIC8vIHRyZWF0IGBOYU5gIHZzLiBgTmFOYCBhcyBlcXVhbFxuICAgICAgICByZXR1cm4gKGEgIT0gK2EpID9cbiAgICAgICAgICBiICE9ICtiIDpcbiAgICAgICAgICAvLyBidXQgdHJlYXQgYC0wYCB2cy4gYCswYCBhcyBub3QgZXF1YWxcbiAgICAgICAgICAoYSA9PSAwID8gKDEgLyBhID09IDEgLyBiKSA6IGEgPT0gK2IpO1xuXG4gICAgICBjYXNlIHJlZ2V4cENsYXNzOlxuICAgICAgY2FzZSBzdHJpbmdDbGFzczpcbiAgICAgICAgLy8gY29lcmNlIHJlZ2V4ZXMgdG8gc3RyaW5ncyAoaHR0cDovL2VzNS5naXRodWIuaW8vI3gxNS4xMC42LjQpXG4gICAgICAgIC8vIHRyZWF0IHN0cmluZyBwcmltaXRpdmVzIGFuZCB0aGVpciBjb3JyZXNwb25kaW5nIG9iamVjdCBpbnN0YW5jZXMgYXMgZXF1YWxcbiAgICAgICAgcmV0dXJuIGEgPT0gU3RyaW5nKGIpO1xuICAgIH1cbiAgICB2YXIgaXNBcnIgPSBjbGFzc05hbWUgPT0gYXJyYXlDbGFzcztcbiAgICBpZiAoIWlzQXJyKSB7XG5cbiAgICAgIC8vIGV4aXQgZm9yIGZ1bmN0aW9ucyBhbmQgRE9NIG5vZGVzXG4gICAgICBpZiAoY2xhc3NOYW1lICE9IG9iamVjdENsYXNzIHx8ICghc3VwcG9ydC5ub2RlQ2xhc3MgJiYgKGlzTm9kZShhKSB8fCBpc05vZGUoYikpKSkge1xuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICB9XG4gICAgICAvLyBpbiBvbGRlciB2ZXJzaW9ucyBvZiBPcGVyYSwgYGFyZ3VtZW50c2Agb2JqZWN0cyBoYXZlIGBBcnJheWAgY29uc3RydWN0b3JzXG4gICAgICB2YXIgY3RvckEgPSAhc3VwcG9ydC5hcmdzT2JqZWN0ICYmIGlzQXJndW1lbnRzKGEpID8gT2JqZWN0IDogYS5jb25zdHJ1Y3RvcixcbiAgICAgICAgICBjdG9yQiA9ICFzdXBwb3J0LmFyZ3NPYmplY3QgJiYgaXNBcmd1bWVudHMoYikgPyBPYmplY3QgOiBiLmNvbnN0cnVjdG9yO1xuXG4gICAgICAvLyBub24gYE9iamVjdGAgb2JqZWN0IGluc3RhbmNlcyB3aXRoIGRpZmZlcmVudCBjb25zdHJ1Y3RvcnMgYXJlIG5vdCBlcXVhbFxuICAgICAgaWYgKGN0b3JBICE9IGN0b3JCICYmXG4gICAgICAgICAgICAhKGhhc093blByb3BlcnR5LmNhbGwoYSwgJ2NvbnN0cnVjdG9yJykgJiYgaGFzT3duUHJvcGVydHkuY2FsbChiLCAnY29uc3RydWN0b3InKSkgJiZcbiAgICAgICAgICAgICEoaXNGdW5jdGlvbihjdG9yQSkgJiYgY3RvckEgaW5zdGFuY2VvZiBjdG9yQSAmJiBpc0Z1bmN0aW9uKGN0b3JCKSAmJiBjdG9yQiBpbnN0YW5jZW9mIGN0b3JCKSAmJlxuICAgICAgICAgICAgKCdjb25zdHJ1Y3RvcicgaW4gYSAmJiAnY29uc3RydWN0b3InIGluIGIpXG4gICAgICAgICAgKSB7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgIH1cbiAgICB9XG4gICAgLy8gYXNzdW1lIGN5Y2xpYyBzdHJ1Y3R1cmVzIGFyZSBlcXVhbFxuICAgIC8vIHRoZSBhbGdvcml0aG0gZm9yIGRldGVjdGluZyBjeWNsaWMgc3RydWN0dXJlcyBpcyBhZGFwdGVkIGZyb20gRVMgNS4xXG4gICAgLy8gc2VjdGlvbiAxNS4xMi4zLCBhYnN0cmFjdCBvcGVyYXRpb24gYEpPYCAoaHR0cDovL2VzNS5naXRodWIuaW8vI3gxNS4xMi4zKVxuICAgIHZhciBpbml0ZWRTdGFjayA9ICFzdGFja0E7XG4gICAgc3RhY2tBIHx8IChzdGFja0EgPSBbXSk7XG4gICAgc3RhY2tCIHx8IChzdGFja0IgPSBbXSk7XG5cbiAgICB2YXIgbGVuZ3RoID0gc3RhY2tBLmxlbmd0aDtcbiAgICB3aGlsZSAobGVuZ3RoLS0pIHtcbiAgICAgIGlmIChzdGFja0FbbGVuZ3RoXSA9PSBhKSB7XG4gICAgICAgIHJldHVybiBzdGFja0JbbGVuZ3RoXSA9PSBiO1xuICAgICAgfVxuICAgIH1cbiAgICB2YXIgc2l6ZSA9IDA7XG4gICAgdmFyIHJlc3VsdCA9IHRydWU7XG5cbiAgICAvLyBhZGQgYGFgIGFuZCBgYmAgdG8gdGhlIHN0YWNrIG9mIHRyYXZlcnNlZCBvYmplY3RzXG4gICAgc3RhY2tBLnB1c2goYSk7XG4gICAgc3RhY2tCLnB1c2goYik7XG5cbiAgICAvLyByZWN1cnNpdmVseSBjb21wYXJlIG9iamVjdHMgYW5kIGFycmF5cyAoc3VzY2VwdGlibGUgdG8gY2FsbCBzdGFjayBsaW1pdHMpXG4gICAgaWYgKGlzQXJyKSB7XG4gICAgICAvLyBjb21wYXJlIGxlbmd0aHMgdG8gZGV0ZXJtaW5lIGlmIGEgZGVlcCBjb21wYXJpc29uIGlzIG5lY2Vzc2FyeVxuICAgICAgbGVuZ3RoID0gYS5sZW5ndGg7XG4gICAgICBzaXplID0gYi5sZW5ndGg7XG4gICAgICByZXN1bHQgPSBzaXplID09IGxlbmd0aDtcblxuICAgICAgaWYgKHJlc3VsdCkge1xuICAgICAgICAvLyBkZWVwIGNvbXBhcmUgdGhlIGNvbnRlbnRzLCBpZ25vcmluZyBub24tbnVtZXJpYyBwcm9wZXJ0aWVzXG4gICAgICAgIHdoaWxlIChzaXplLS0pIHtcbiAgICAgICAgICB2YXIgaW5kZXggPSBsZW5ndGgsXG4gICAgICAgICAgICAgIHZhbHVlID0gYltzaXplXTtcblxuICAgICAgICAgIGlmICghKHJlc3VsdCA9IGRlZXBFcXVhbHMoYVtzaXplXSwgdmFsdWUsIHN0YWNrQSwgc3RhY2tCKSkpIHtcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgIC8vIGRlZXAgY29tcGFyZSBvYmplY3RzIHVzaW5nIGBmb3JJbmAsIGluc3RlYWQgb2YgYGZvck93bmAsIHRvIGF2b2lkIGBPYmplY3Qua2V5c2BcbiAgICAgIC8vIHdoaWNoLCBpbiB0aGlzIGNhc2UsIGlzIG1vcmUgY29zdGx5XG4gICAgICBpbnRlcm5hbEZvckluKGIsIGZ1bmN0aW9uKHZhbHVlLCBrZXksIGIpIHtcbiAgICAgICAgaWYgKGhhc093blByb3BlcnR5LmNhbGwoYiwga2V5KSkge1xuICAgICAgICAgIC8vIGNvdW50IHRoZSBudW1iZXIgb2YgcHJvcGVydGllcy5cbiAgICAgICAgICBzaXplKys7XG4gICAgICAgICAgLy8gZGVlcCBjb21wYXJlIGVhY2ggcHJvcGVydHkgdmFsdWUuXG4gICAgICAgICAgcmV0dXJuIChyZXN1bHQgPSBoYXNPd25Qcm9wZXJ0eS5jYWxsKGEsIGtleSkgJiYgZGVlcEVxdWFscyhhW2tleV0sIHZhbHVlLCBzdGFja0EsIHN0YWNrQikpO1xuICAgICAgICB9XG4gICAgICB9KTtcblxuICAgICAgaWYgKHJlc3VsdCkge1xuICAgICAgICAvLyBlbnN1cmUgYm90aCBvYmplY3RzIGhhdmUgdGhlIHNhbWUgbnVtYmVyIG9mIHByb3BlcnRpZXNcbiAgICAgICAgaW50ZXJuYWxGb3JJbihhLCBmdW5jdGlvbih2YWx1ZSwga2V5LCBhKSB7XG4gICAgICAgICAgaWYgKGhhc093blByb3BlcnR5LmNhbGwoYSwga2V5KSkge1xuICAgICAgICAgICAgLy8gYHNpemVgIHdpbGwgYmUgYC0xYCBpZiBgYWAgaGFzIG1vcmUgcHJvcGVydGllcyB0aGFuIGBiYFxuICAgICAgICAgICAgcmV0dXJuIChyZXN1bHQgPSAtLXNpemUgPiAtMSk7XG4gICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICB9XG4gICAgc3RhY2tBLnBvcCgpO1xuICAgIHN0YWNrQi5wb3AoKTtcblxuICAgIHJldHVybiByZXN1bHQ7XG4gIH1cblxuICB2YXIgaGFzUHJvcCA9IHt9Lmhhc093blByb3BlcnR5LFxuICAgICAgc2xpY2UgPSBBcnJheS5wcm90b3R5cGUuc2xpY2U7XG5cbiAgdmFyIGluaGVyaXRzID0gUnguaW50ZXJuYWxzLmluaGVyaXRzID0gZnVuY3Rpb24gKGNoaWxkLCBwYXJlbnQpIHtcbiAgICBmdW5jdGlvbiBfXygpIHsgdGhpcy5jb25zdHJ1Y3RvciA9IGNoaWxkOyB9XG4gICAgX18ucHJvdG90eXBlID0gcGFyZW50LnByb3RvdHlwZTtcbiAgICBjaGlsZC5wcm90b3R5cGUgPSBuZXcgX18oKTtcbiAgfTtcblxuICB2YXIgYWRkUHJvcGVydGllcyA9IFJ4LmludGVybmFscy5hZGRQcm9wZXJ0aWVzID0gZnVuY3Rpb24gKG9iaikge1xuICAgIGZvcih2YXIgc291cmNlcyA9IFtdLCBpID0gMSwgbGVuID0gYXJndW1lbnRzLmxlbmd0aDsgaSA8IGxlbjsgaSsrKSB7IHNvdXJjZXMucHVzaChhcmd1bWVudHNbaV0pOyB9XG4gICAgZm9yICh2YXIgaWR4ID0gMCwgbG4gPSBzb3VyY2VzLmxlbmd0aDsgaWR4IDwgbG47IGlkeCsrKSB7XG4gICAgICB2YXIgc291cmNlID0gc291cmNlc1tpZHhdO1xuICAgICAgZm9yICh2YXIgcHJvcCBpbiBzb3VyY2UpIHtcbiAgICAgICAgb2JqW3Byb3BdID0gc291cmNlW3Byb3BdO1xuICAgICAgfVxuICAgIH1cbiAgfTtcblxuICAvLyBSeCBVdGlsc1xuICB2YXIgYWRkUmVmID0gUnguaW50ZXJuYWxzLmFkZFJlZiA9IGZ1bmN0aW9uICh4cywgcikge1xuICAgIHJldHVybiBuZXcgQW5vbnltb3VzT2JzZXJ2YWJsZShmdW5jdGlvbiAob2JzZXJ2ZXIpIHtcbiAgICAgIHJldHVybiBuZXcgQmluYXJ5RGlzcG9zYWJsZShyLmdldERpc3Bvc2FibGUoKSwgeHMuc3Vic2NyaWJlKG9ic2VydmVyKSk7XG4gICAgfSk7XG4gIH07XG5cbiAgZnVuY3Rpb24gYXJyYXlJbml0aWFsaXplKGNvdW50LCBmYWN0b3J5KSB7XG4gICAgdmFyIGEgPSBuZXcgQXJyYXkoY291bnQpO1xuICAgIGZvciAodmFyIGkgPSAwOyBpIDwgY291bnQ7IGkrKykge1xuICAgICAgYVtpXSA9IGZhY3RvcnkoKTtcbiAgICB9XG4gICAgcmV0dXJuIGE7XG4gIH1cblxuICBmdW5jdGlvbiBJbmRleGVkSXRlbShpZCwgdmFsdWUpIHtcbiAgICB0aGlzLmlkID0gaWQ7XG4gICAgdGhpcy52YWx1ZSA9IHZhbHVlO1xuICB9XG5cbiAgSW5kZXhlZEl0ZW0ucHJvdG90eXBlLmNvbXBhcmVUbyA9IGZ1bmN0aW9uIChvdGhlcikge1xuICAgIHZhciBjID0gdGhpcy52YWx1ZS5jb21wYXJlVG8ob3RoZXIudmFsdWUpO1xuICAgIGMgPT09IDAgJiYgKGMgPSB0aGlzLmlkIC0gb3RoZXIuaWQpO1xuICAgIHJldHVybiBjO1xuICB9O1xuXG4gIHZhciBQcmlvcml0eVF1ZXVlID0gUnguaW50ZXJuYWxzLlByaW9yaXR5UXVldWUgPSBmdW5jdGlvbiAoY2FwYWNpdHkpIHtcbiAgICB0aGlzLml0ZW1zID0gbmV3IEFycmF5KGNhcGFjaXR5KTtcbiAgICB0aGlzLmxlbmd0aCA9IDA7XG4gIH07XG5cbiAgdmFyIHByaW9yaXR5UHJvdG8gPSBQcmlvcml0eVF1ZXVlLnByb3RvdHlwZTtcbiAgcHJpb3JpdHlQcm90by5pc0hpZ2hlclByaW9yaXR5ID0gZnVuY3Rpb24gKGxlZnQsIHJpZ2h0KSB7XG4gICAgcmV0dXJuIHRoaXMuaXRlbXNbbGVmdF0uY29tcGFyZVRvKHRoaXMuaXRlbXNbcmlnaHRdKSA8IDA7XG4gIH07XG5cbiAgcHJpb3JpdHlQcm90by5wZXJjb2xhdGUgPSBmdW5jdGlvbiAoaW5kZXgpIHtcbiAgICBpZiAoaW5kZXggPj0gdGhpcy5sZW5ndGggfHwgaW5kZXggPCAwKSB7IHJldHVybjsgfVxuICAgIHZhciBwYXJlbnQgPSBpbmRleCAtIDEgPj4gMTtcbiAgICBpZiAocGFyZW50IDwgMCB8fCBwYXJlbnQgPT09IGluZGV4KSB7IHJldHVybjsgfVxuICAgIGlmICh0aGlzLmlzSGlnaGVyUHJpb3JpdHkoaW5kZXgsIHBhcmVudCkpIHtcbiAgICAgIHZhciB0ZW1wID0gdGhpcy5pdGVtc1tpbmRleF07XG4gICAgICB0aGlzLml0ZW1zW2luZGV4XSA9IHRoaXMuaXRlbXNbcGFyZW50XTtcbiAgICAgIHRoaXMuaXRlbXNbcGFyZW50XSA9IHRlbXA7XG4gICAgICB0aGlzLnBlcmNvbGF0ZShwYXJlbnQpO1xuICAgIH1cbiAgfTtcblxuICBwcmlvcml0eVByb3RvLmhlYXBpZnkgPSBmdW5jdGlvbiAoaW5kZXgpIHtcbiAgICAraW5kZXggfHwgKGluZGV4ID0gMCk7XG4gICAgaWYgKGluZGV4ID49IHRoaXMubGVuZ3RoIHx8IGluZGV4IDwgMCkgeyByZXR1cm47IH1cbiAgICB2YXIgbGVmdCA9IDIgKiBpbmRleCArIDEsXG4gICAgICAgIHJpZ2h0ID0gMiAqIGluZGV4ICsgMixcbiAgICAgICAgZmlyc3QgPSBpbmRleDtcbiAgICBpZiAobGVmdCA8IHRoaXMubGVuZ3RoICYmIHRoaXMuaXNIaWdoZXJQcmlvcml0eShsZWZ0LCBmaXJzdCkpIHtcbiAgICAgIGZpcnN0ID0gbGVmdDtcbiAgICB9XG4gICAgaWYgKHJpZ2h0IDwgdGhpcy5sZW5ndGggJiYgdGhpcy5pc0hpZ2hlclByaW9yaXR5KHJpZ2h0LCBmaXJzdCkpIHtcbiAgICAgIGZpcnN0ID0gcmlnaHQ7XG4gICAgfVxuICAgIGlmIChmaXJzdCAhPT0gaW5kZXgpIHtcbiAgICAgIHZhciB0ZW1wID0gdGhpcy5pdGVtc1tpbmRleF07XG4gICAgICB0aGlzLml0ZW1zW2luZGV4XSA9IHRoaXMuaXRlbXNbZmlyc3RdO1xuICAgICAgdGhpcy5pdGVtc1tmaXJzdF0gPSB0ZW1wO1xuICAgICAgdGhpcy5oZWFwaWZ5KGZpcnN0KTtcbiAgICB9XG4gIH07XG5cbiAgcHJpb3JpdHlQcm90by5wZWVrID0gZnVuY3Rpb24gKCkgeyByZXR1cm4gdGhpcy5pdGVtc1swXS52YWx1ZTsgfTtcblxuICBwcmlvcml0eVByb3RvLnJlbW92ZUF0ID0gZnVuY3Rpb24gKGluZGV4KSB7XG4gICAgdGhpcy5pdGVtc1tpbmRleF0gPSB0aGlzLml0ZW1zWy0tdGhpcy5sZW5ndGhdO1xuICAgIHRoaXMuaXRlbXNbdGhpcy5sZW5ndGhdID0gdW5kZWZpbmVkO1xuICAgIHRoaXMuaGVhcGlmeSgpO1xuICB9O1xuXG4gIHByaW9yaXR5UHJvdG8uZGVxdWV1ZSA9IGZ1bmN0aW9uICgpIHtcbiAgICB2YXIgcmVzdWx0ID0gdGhpcy5wZWVrKCk7XG4gICAgdGhpcy5yZW1vdmVBdCgwKTtcbiAgICByZXR1cm4gcmVzdWx0O1xuICB9O1xuXG4gIHByaW9yaXR5UHJvdG8uZW5xdWV1ZSA9IGZ1bmN0aW9uIChpdGVtKSB7XG4gICAgdmFyIGluZGV4ID0gdGhpcy5sZW5ndGgrKztcbiAgICB0aGlzLml0ZW1zW2luZGV4XSA9IG5ldyBJbmRleGVkSXRlbShQcmlvcml0eVF1ZXVlLmNvdW50KyssIGl0ZW0pO1xuICAgIHRoaXMucGVyY29sYXRlKGluZGV4KTtcbiAgfTtcblxuICBwcmlvcml0eVByb3RvLnJlbW92ZSA9IGZ1bmN0aW9uIChpdGVtKSB7XG4gICAgZm9yICh2YXIgaSA9IDA7IGkgPCB0aGlzLmxlbmd0aDsgaSsrKSB7XG4gICAgICBpZiAodGhpcy5pdGVtc1tpXS52YWx1ZSA9PT0gaXRlbSkge1xuICAgICAgICB0aGlzLnJlbW92ZUF0KGkpO1xuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9O1xuICBQcmlvcml0eVF1ZXVlLmNvdW50ID0gMDtcblxuICAvKipcbiAgICogUmVwcmVzZW50cyBhIGdyb3VwIG9mIGRpc3Bvc2FibGUgcmVzb3VyY2VzIHRoYXQgYXJlIGRpc3Bvc2VkIHRvZ2V0aGVyLlxuICAgKiBAY29uc3RydWN0b3JcbiAgICovXG4gIHZhciBDb21wb3NpdGVEaXNwb3NhYmxlID0gUnguQ29tcG9zaXRlRGlzcG9zYWJsZSA9IGZ1bmN0aW9uICgpIHtcbiAgICB2YXIgYXJncyA9IFtdLCBpLCBsZW47XG4gICAgaWYgKEFycmF5LmlzQXJyYXkoYXJndW1lbnRzWzBdKSkge1xuICAgICAgYXJncyA9IGFyZ3VtZW50c1swXTtcbiAgICAgIGxlbiA9IGFyZ3MubGVuZ3RoO1xuICAgIH0gZWxzZSB7XG4gICAgICBsZW4gPSBhcmd1bWVudHMubGVuZ3RoO1xuICAgICAgYXJncyA9IG5ldyBBcnJheShsZW4pO1xuICAgICAgZm9yKGkgPSAwOyBpIDwgbGVuOyBpKyspIHsgYXJnc1tpXSA9IGFyZ3VtZW50c1tpXTsgfVxuICAgIH1cbiAgICB0aGlzLmRpc3Bvc2FibGVzID0gYXJncztcbiAgICB0aGlzLmlzRGlzcG9zZWQgPSBmYWxzZTtcbiAgICB0aGlzLmxlbmd0aCA9IGFyZ3MubGVuZ3RoO1xuICB9O1xuXG4gIHZhciBDb21wb3NpdGVEaXNwb3NhYmxlUHJvdG90eXBlID0gQ29tcG9zaXRlRGlzcG9zYWJsZS5wcm90b3R5cGU7XG5cbiAgLyoqXG4gICAqIEFkZHMgYSBkaXNwb3NhYmxlIHRvIHRoZSBDb21wb3NpdGVEaXNwb3NhYmxlIG9yIGRpc3Bvc2VzIHRoZSBkaXNwb3NhYmxlIGlmIHRoZSBDb21wb3NpdGVEaXNwb3NhYmxlIGlzIGRpc3Bvc2VkLlxuICAgKiBAcGFyYW0ge01peGVkfSBpdGVtIERpc3Bvc2FibGUgdG8gYWRkLlxuICAgKi9cbiAgQ29tcG9zaXRlRGlzcG9zYWJsZVByb3RvdHlwZS5hZGQgPSBmdW5jdGlvbiAoaXRlbSkge1xuICAgIGlmICh0aGlzLmlzRGlzcG9zZWQpIHtcbiAgICAgIGl0ZW0uZGlzcG9zZSgpO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLmRpc3Bvc2FibGVzLnB1c2goaXRlbSk7XG4gICAgICB0aGlzLmxlbmd0aCsrO1xuICAgIH1cbiAgfTtcblxuICAvKipcbiAgICogUmVtb3ZlcyBhbmQgZGlzcG9zZXMgdGhlIGZpcnN0IG9jY3VycmVuY2Ugb2YgYSBkaXNwb3NhYmxlIGZyb20gdGhlIENvbXBvc2l0ZURpc3Bvc2FibGUuXG4gICAqIEBwYXJhbSB7TWl4ZWR9IGl0ZW0gRGlzcG9zYWJsZSB0byByZW1vdmUuXG4gICAqIEByZXR1cm5zIHtCb29sZWFufSB0cnVlIGlmIGZvdW5kOyBmYWxzZSBvdGhlcndpc2UuXG4gICAqL1xuICBDb21wb3NpdGVEaXNwb3NhYmxlUHJvdG90eXBlLnJlbW92ZSA9IGZ1bmN0aW9uIChpdGVtKSB7XG4gICAgdmFyIHNob3VsZERpc3Bvc2UgPSBmYWxzZTtcbiAgICBpZiAoIXRoaXMuaXNEaXNwb3NlZCkge1xuICAgICAgdmFyIGlkeCA9IHRoaXMuZGlzcG9zYWJsZXMuaW5kZXhPZihpdGVtKTtcbiAgICAgIGlmIChpZHggIT09IC0xKSB7XG4gICAgICAgIHNob3VsZERpc3Bvc2UgPSB0cnVlO1xuICAgICAgICB0aGlzLmRpc3Bvc2FibGVzLnNwbGljZShpZHgsIDEpO1xuICAgICAgICB0aGlzLmxlbmd0aC0tO1xuICAgICAgICBpdGVtLmRpc3Bvc2UoKTtcbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIHNob3VsZERpc3Bvc2U7XG4gIH07XG5cbiAgLyoqXG4gICAqICBEaXNwb3NlcyBhbGwgZGlzcG9zYWJsZXMgaW4gdGhlIGdyb3VwIGFuZCByZW1vdmVzIHRoZW0gZnJvbSB0aGUgZ3JvdXAuXG4gICAqL1xuICBDb21wb3NpdGVEaXNwb3NhYmxlUHJvdG90eXBlLmRpc3Bvc2UgPSBmdW5jdGlvbiAoKSB7XG4gICAgaWYgKCF0aGlzLmlzRGlzcG9zZWQpIHtcbiAgICAgIHRoaXMuaXNEaXNwb3NlZCA9IHRydWU7XG4gICAgICB2YXIgbGVuID0gdGhpcy5kaXNwb3NhYmxlcy5sZW5ndGgsIGN1cnJlbnREaXNwb3NhYmxlcyA9IG5ldyBBcnJheShsZW4pO1xuICAgICAgZm9yKHZhciBpID0gMDsgaSA8IGxlbjsgaSsrKSB7IGN1cnJlbnREaXNwb3NhYmxlc1tpXSA9IHRoaXMuZGlzcG9zYWJsZXNbaV07IH1cbiAgICAgIHRoaXMuZGlzcG9zYWJsZXMgPSBbXTtcbiAgICAgIHRoaXMubGVuZ3RoID0gMDtcblxuICAgICAgZm9yIChpID0gMDsgaSA8IGxlbjsgaSsrKSB7XG4gICAgICAgIGN1cnJlbnREaXNwb3NhYmxlc1tpXS5kaXNwb3NlKCk7XG4gICAgICB9XG4gICAgfVxuICB9O1xuXG4gIC8qKlxuICAgKiBQcm92aWRlcyBhIHNldCBvZiBzdGF0aWMgbWV0aG9kcyBmb3IgY3JlYXRpbmcgRGlzcG9zYWJsZXMuXG4gICAqIEBwYXJhbSB7RnVuY3Rpb259IGRpc3Bvc2UgQWN0aW9uIHRvIHJ1biBkdXJpbmcgdGhlIGZpcnN0IGNhbGwgdG8gZGlzcG9zZS4gVGhlIGFjdGlvbiBpcyBndWFyYW50ZWVkIHRvIGJlIHJ1biBhdCBtb3N0IG9uY2UuXG4gICAqL1xuICB2YXIgRGlzcG9zYWJsZSA9IFJ4LkRpc3Bvc2FibGUgPSBmdW5jdGlvbiAoYWN0aW9uKSB7XG4gICAgdGhpcy5pc0Rpc3Bvc2VkID0gZmFsc2U7XG4gICAgdGhpcy5hY3Rpb24gPSBhY3Rpb24gfHwgbm9vcDtcbiAgfTtcblxuICAvKiogUGVyZm9ybXMgdGhlIHRhc2sgb2YgY2xlYW5pbmcgdXAgcmVzb3VyY2VzLiAqL1xuICBEaXNwb3NhYmxlLnByb3RvdHlwZS5kaXNwb3NlID0gZnVuY3Rpb24gKCkge1xuICAgIGlmICghdGhpcy5pc0Rpc3Bvc2VkKSB7XG4gICAgICB0aGlzLmFjdGlvbigpO1xuICAgICAgdGhpcy5pc0Rpc3Bvc2VkID0gdHJ1ZTtcbiAgICB9XG4gIH07XG5cbiAgLyoqXG4gICAqIENyZWF0ZXMgYSBkaXNwb3NhYmxlIG9iamVjdCB0aGF0IGludm9rZXMgdGhlIHNwZWNpZmllZCBhY3Rpb24gd2hlbiBkaXNwb3NlZC5cbiAgICogQHBhcmFtIHtGdW5jdGlvbn0gZGlzcG9zZSBBY3Rpb24gdG8gcnVuIGR1cmluZyB0aGUgZmlyc3QgY2FsbCB0byBkaXNwb3NlLiBUaGUgYWN0aW9uIGlzIGd1YXJhbnRlZWQgdG8gYmUgcnVuIGF0IG1vc3Qgb25jZS5cbiAgICogQHJldHVybiB7RGlzcG9zYWJsZX0gVGhlIGRpc3Bvc2FibGUgb2JqZWN0IHRoYXQgcnVucyB0aGUgZ2l2ZW4gYWN0aW9uIHVwb24gZGlzcG9zYWwuXG4gICAqL1xuICB2YXIgZGlzcG9zYWJsZUNyZWF0ZSA9IERpc3Bvc2FibGUuY3JlYXRlID0gZnVuY3Rpb24gKGFjdGlvbikgeyByZXR1cm4gbmV3IERpc3Bvc2FibGUoYWN0aW9uKTsgfTtcblxuICAvKipcbiAgICogR2V0cyB0aGUgZGlzcG9zYWJsZSB0aGF0IGRvZXMgbm90aGluZyB3aGVuIGRpc3Bvc2VkLlxuICAgKi9cbiAgdmFyIGRpc3Bvc2FibGVFbXB0eSA9IERpc3Bvc2FibGUuZW1wdHkgPSB7IGRpc3Bvc2U6IG5vb3AgfTtcblxuICAvKipcbiAgICogVmFsaWRhdGVzIHdoZXRoZXIgdGhlIGdpdmVuIG9iamVjdCBpcyBhIGRpc3Bvc2FibGVcbiAgICogQHBhcmFtIHtPYmplY3R9IE9iamVjdCB0byB0ZXN0IHdoZXRoZXIgaXQgaGFzIGEgZGlzcG9zZSBtZXRob2RcbiAgICogQHJldHVybnMge0Jvb2xlYW59IHRydWUgaWYgYSBkaXNwb3NhYmxlIG9iamVjdCwgZWxzZSBmYWxzZS5cbiAgICovXG4gIHZhciBpc0Rpc3Bvc2FibGUgPSBEaXNwb3NhYmxlLmlzRGlzcG9zYWJsZSA9IGZ1bmN0aW9uIChkKSB7XG4gICAgcmV0dXJuIGQgJiYgaXNGdW5jdGlvbihkLmRpc3Bvc2UpO1xuICB9O1xuXG4gIHZhciBjaGVja0Rpc3Bvc2VkID0gRGlzcG9zYWJsZS5jaGVja0Rpc3Bvc2VkID0gZnVuY3Rpb24gKGRpc3Bvc2FibGUpIHtcbiAgICBpZiAoZGlzcG9zYWJsZS5pc0Rpc3Bvc2VkKSB7IHRocm93IG5ldyBPYmplY3REaXNwb3NlZEVycm9yKCk7IH1cbiAgfTtcblxuICB2YXIgZGlzcG9zYWJsZUZpeHVwID0gRGlzcG9zYWJsZS5fZml4dXAgPSBmdW5jdGlvbiAocmVzdWx0KSB7XG4gICAgcmV0dXJuIGlzRGlzcG9zYWJsZShyZXN1bHQpID8gcmVzdWx0IDogZGlzcG9zYWJsZUVtcHR5O1xuICB9O1xuXG4gIC8vIFNpbmdsZSBhc3NpZ25tZW50XG4gIHZhciBTaW5nbGVBc3NpZ25tZW50RGlzcG9zYWJsZSA9IFJ4LlNpbmdsZUFzc2lnbm1lbnREaXNwb3NhYmxlID0gZnVuY3Rpb24gKCkge1xuICAgIHRoaXMuaXNEaXNwb3NlZCA9IGZhbHNlO1xuICAgIHRoaXMuY3VycmVudCA9IG51bGw7XG4gIH07XG4gIFNpbmdsZUFzc2lnbm1lbnREaXNwb3NhYmxlLnByb3RvdHlwZS5nZXREaXNwb3NhYmxlID0gZnVuY3Rpb24gKCkge1xuICAgIHJldHVybiB0aGlzLmN1cnJlbnQ7XG4gIH07XG4gIFNpbmdsZUFzc2lnbm1lbnREaXNwb3NhYmxlLnByb3RvdHlwZS5zZXREaXNwb3NhYmxlID0gZnVuY3Rpb24gKHZhbHVlKSB7XG4gICAgaWYgKHRoaXMuY3VycmVudCkgeyB0aHJvdyBuZXcgRXJyb3IoJ0Rpc3Bvc2FibGUgaGFzIGFscmVhZHkgYmVlbiBhc3NpZ25lZCcpOyB9XG4gICAgdmFyIHNob3VsZERpc3Bvc2UgPSB0aGlzLmlzRGlzcG9zZWQ7XG4gICAgIXNob3VsZERpc3Bvc2UgJiYgKHRoaXMuY3VycmVudCA9IHZhbHVlKTtcbiAgICBzaG91bGREaXNwb3NlICYmIHZhbHVlICYmIHZhbHVlLmRpc3Bvc2UoKTtcbiAgfTtcbiAgU2luZ2xlQXNzaWdubWVudERpc3Bvc2FibGUucHJvdG90eXBlLmRpc3Bvc2UgPSBmdW5jdGlvbiAoKSB7XG4gICAgaWYgKCF0aGlzLmlzRGlzcG9zZWQpIHtcbiAgICAgIHRoaXMuaXNEaXNwb3NlZCA9IHRydWU7XG4gICAgICB2YXIgb2xkID0gdGhpcy5jdXJyZW50O1xuICAgICAgdGhpcy5jdXJyZW50ID0gbnVsbDtcbiAgICAgIG9sZCAmJiBvbGQuZGlzcG9zZSgpO1xuICAgIH1cbiAgfTtcblxuICAvLyBNdWx0aXBsZSBhc3NpZ25tZW50IGRpc3Bvc2FibGVcbiAgdmFyIFNlcmlhbERpc3Bvc2FibGUgPSBSeC5TZXJpYWxEaXNwb3NhYmxlID0gZnVuY3Rpb24gKCkge1xuICAgIHRoaXMuaXNEaXNwb3NlZCA9IGZhbHNlO1xuICAgIHRoaXMuY3VycmVudCA9IG51bGw7XG4gIH07XG4gIFNlcmlhbERpc3Bvc2FibGUucHJvdG90eXBlLmdldERpc3Bvc2FibGUgPSBmdW5jdGlvbiAoKSB7XG4gICAgcmV0dXJuIHRoaXMuY3VycmVudDtcbiAgfTtcbiAgU2VyaWFsRGlzcG9zYWJsZS5wcm90b3R5cGUuc2V0RGlzcG9zYWJsZSA9IGZ1bmN0aW9uICh2YWx1ZSkge1xuICAgIHZhciBzaG91bGREaXNwb3NlID0gdGhpcy5pc0Rpc3Bvc2VkO1xuICAgIGlmICghc2hvdWxkRGlzcG9zZSkge1xuICAgICAgdmFyIG9sZCA9IHRoaXMuY3VycmVudDtcbiAgICAgIHRoaXMuY3VycmVudCA9IHZhbHVlO1xuICAgIH1cbiAgICBvbGQgJiYgb2xkLmRpc3Bvc2UoKTtcbiAgICBzaG91bGREaXNwb3NlICYmIHZhbHVlICYmIHZhbHVlLmRpc3Bvc2UoKTtcbiAgfTtcbiAgU2VyaWFsRGlzcG9zYWJsZS5wcm90b3R5cGUuZGlzcG9zZSA9IGZ1bmN0aW9uICgpIHtcbiAgICBpZiAoIXRoaXMuaXNEaXNwb3NlZCkge1xuICAgICAgdGhpcy5pc0Rpc3Bvc2VkID0gdHJ1ZTtcbiAgICAgIHZhciBvbGQgPSB0aGlzLmN1cnJlbnQ7XG4gICAgICB0aGlzLmN1cnJlbnQgPSBudWxsO1xuICAgIH1cbiAgICBvbGQgJiYgb2xkLmRpc3Bvc2UoKTtcbiAgfTtcblxuICB2YXIgQmluYXJ5RGlzcG9zYWJsZSA9IFJ4LkJpbmFyeURpc3Bvc2FibGUgPSBmdW5jdGlvbiAoZmlyc3QsIHNlY29uZCkge1xuICAgIHRoaXMuX2ZpcnN0ID0gZmlyc3Q7XG4gICAgdGhpcy5fc2Vjb25kID0gc2Vjb25kO1xuICAgIHRoaXMuaXNEaXNwb3NlZCA9IGZhbHNlO1xuICB9O1xuXG4gIEJpbmFyeURpc3Bvc2FibGUucHJvdG90eXBlLmRpc3Bvc2UgPSBmdW5jdGlvbiAoKSB7XG4gICAgaWYgKCF0aGlzLmlzRGlzcG9zZWQpIHtcbiAgICAgIHRoaXMuaXNEaXNwb3NlZCA9IHRydWU7XG4gICAgICB2YXIgb2xkMSA9IHRoaXMuX2ZpcnN0O1xuICAgICAgdGhpcy5fZmlyc3QgPSBudWxsO1xuICAgICAgb2xkMSAmJiBvbGQxLmRpc3Bvc2UoKTtcbiAgICAgIHZhciBvbGQyID0gdGhpcy5fc2Vjb25kO1xuICAgICAgdGhpcy5fc2Vjb25kID0gbnVsbDtcbiAgICAgIG9sZDIgJiYgb2xkMi5kaXNwb3NlKCk7XG4gICAgfVxuICB9O1xuXG4gIHZhciBOQXJ5RGlzcG9zYWJsZSA9IFJ4Lk5BcnlEaXNwb3NhYmxlID0gZnVuY3Rpb24gKGRpc3Bvc2FibGVzKSB7XG4gICAgdGhpcy5fZGlzcG9zYWJsZXMgPSBkaXNwb3NhYmxlcztcbiAgICB0aGlzLmlzRGlzcG9zZWQgPSBmYWxzZTtcbiAgfTtcblxuICBOQXJ5RGlzcG9zYWJsZS5wcm90b3R5cGUuZGlzcG9zZSA9IGZ1bmN0aW9uICgpIHtcbiAgICBpZiAoIXRoaXMuaXNEaXNwb3NlZCkge1xuICAgICAgdGhpcy5pc0Rpc3Bvc2VkID0gdHJ1ZTtcbiAgICAgIGZvciAodmFyIGkgPSAwLCBsZW4gPSB0aGlzLl9kaXNwb3NhYmxlcy5sZW5ndGg7IGkgPCBsZW47IGkrKykge1xuICAgICAgICB0aGlzLl9kaXNwb3NhYmxlc1tpXS5kaXNwb3NlKCk7XG4gICAgICB9XG4gICAgICB0aGlzLl9kaXNwb3NhYmxlcy5sZW5ndGggPSAwO1xuICAgIH1cbiAgfTtcblxuICAvKipcbiAgICogUmVwcmVzZW50cyBhIGRpc3Bvc2FibGUgcmVzb3VyY2UgdGhhdCBvbmx5IGRpc3Bvc2VzIGl0cyB1bmRlcmx5aW5nIGRpc3Bvc2FibGUgcmVzb3VyY2Ugd2hlbiBhbGwgZGVwZW5kZW50IGRpc3Bvc2FibGUgb2JqZWN0cyBoYXZlIGJlZW4gZGlzcG9zZWQuXG4gICAqL1xuICB2YXIgUmVmQ291bnREaXNwb3NhYmxlID0gUnguUmVmQ291bnREaXNwb3NhYmxlID0gKGZ1bmN0aW9uICgpIHtcblxuICAgIGZ1bmN0aW9uIElubmVyRGlzcG9zYWJsZShkaXNwb3NhYmxlKSB7XG4gICAgICB0aGlzLmRpc3Bvc2FibGUgPSBkaXNwb3NhYmxlO1xuICAgICAgdGhpcy5kaXNwb3NhYmxlLmNvdW50Kys7XG4gICAgICB0aGlzLmlzSW5uZXJEaXNwb3NlZCA9IGZhbHNlO1xuICAgIH1cblxuICAgIElubmVyRGlzcG9zYWJsZS5wcm90b3R5cGUuZGlzcG9zZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgIGlmICghdGhpcy5kaXNwb3NhYmxlLmlzRGlzcG9zZWQgJiYgIXRoaXMuaXNJbm5lckRpc3Bvc2VkKSB7XG4gICAgICAgIHRoaXMuaXNJbm5lckRpc3Bvc2VkID0gdHJ1ZTtcbiAgICAgICAgdGhpcy5kaXNwb3NhYmxlLmNvdW50LS07XG4gICAgICAgIGlmICh0aGlzLmRpc3Bvc2FibGUuY291bnQgPT09IDAgJiYgdGhpcy5kaXNwb3NhYmxlLmlzUHJpbWFyeURpc3Bvc2VkKSB7XG4gICAgICAgICAgdGhpcy5kaXNwb3NhYmxlLmlzRGlzcG9zZWQgPSB0cnVlO1xuICAgICAgICAgIHRoaXMuZGlzcG9zYWJsZS51bmRlcmx5aW5nRGlzcG9zYWJsZS5kaXNwb3NlKCk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9O1xuXG4gICAgLyoqXG4gICAgICogSW5pdGlhbGl6ZXMgYSBuZXcgaW5zdGFuY2Ugb2YgdGhlIFJlZkNvdW50RGlzcG9zYWJsZSB3aXRoIHRoZSBzcGVjaWZpZWQgZGlzcG9zYWJsZS5cbiAgICAgKiBAY29uc3RydWN0b3JcbiAgICAgKiBAcGFyYW0ge0Rpc3Bvc2FibGV9IGRpc3Bvc2FibGUgVW5kZXJseWluZyBkaXNwb3NhYmxlLlxuICAgICAgKi9cbiAgICBmdW5jdGlvbiBSZWZDb3VudERpc3Bvc2FibGUoZGlzcG9zYWJsZSkge1xuICAgICAgdGhpcy51bmRlcmx5aW5nRGlzcG9zYWJsZSA9IGRpc3Bvc2FibGU7XG4gICAgICB0aGlzLmlzRGlzcG9zZWQgPSBmYWxzZTtcbiAgICAgIHRoaXMuaXNQcmltYXJ5RGlzcG9zZWQgPSBmYWxzZTtcbiAgICAgIHRoaXMuY291bnQgPSAwO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIERpc3Bvc2VzIHRoZSB1bmRlcmx5aW5nIGRpc3Bvc2FibGUgb25seSB3aGVuIGFsbCBkZXBlbmRlbnQgZGlzcG9zYWJsZXMgaGF2ZSBiZWVuIGRpc3Bvc2VkXG4gICAgICovXG4gICAgUmVmQ291bnREaXNwb3NhYmxlLnByb3RvdHlwZS5kaXNwb3NlID0gZnVuY3Rpb24gKCkge1xuICAgICAgaWYgKCF0aGlzLmlzRGlzcG9zZWQgJiYgIXRoaXMuaXNQcmltYXJ5RGlzcG9zZWQpIHtcbiAgICAgICAgdGhpcy5pc1ByaW1hcnlEaXNwb3NlZCA9IHRydWU7XG4gICAgICAgIGlmICh0aGlzLmNvdW50ID09PSAwKSB7XG4gICAgICAgICAgdGhpcy5pc0Rpc3Bvc2VkID0gdHJ1ZTtcbiAgICAgICAgICB0aGlzLnVuZGVybHlpbmdEaXNwb3NhYmxlLmRpc3Bvc2UoKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH07XG5cbiAgICAvKipcbiAgICAgKiBSZXR1cm5zIGEgZGVwZW5kZW50IGRpc3Bvc2FibGUgdGhhdCB3aGVuIGRpc3Bvc2VkIGRlY3JlYXNlcyB0aGUgcmVmY291bnQgb24gdGhlIHVuZGVybHlpbmcgZGlzcG9zYWJsZS5cbiAgICAgKiBAcmV0dXJucyB7RGlzcG9zYWJsZX0gQSBkZXBlbmRlbnQgZGlzcG9zYWJsZSBjb250cmlidXRpbmcgdG8gdGhlIHJlZmVyZW5jZSBjb3VudCB0aGF0IG1hbmFnZXMgdGhlIHVuZGVybHlpbmcgZGlzcG9zYWJsZSdzIGxpZmV0aW1lLlxuICAgICAqL1xuICAgIFJlZkNvdW50RGlzcG9zYWJsZS5wcm90b3R5cGUuZ2V0RGlzcG9zYWJsZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgIHJldHVybiB0aGlzLmlzRGlzcG9zZWQgPyBkaXNwb3NhYmxlRW1wdHkgOiBuZXcgSW5uZXJEaXNwb3NhYmxlKHRoaXMpO1xuICAgIH07XG5cbiAgICByZXR1cm4gUmVmQ291bnREaXNwb3NhYmxlO1xuICB9KSgpO1xuXG4gIGZ1bmN0aW9uIFNjaGVkdWxlZERpc3Bvc2FibGUoc2NoZWR1bGVyLCBkaXNwb3NhYmxlKSB7XG4gICAgdGhpcy5zY2hlZHVsZXIgPSBzY2hlZHVsZXI7XG4gICAgdGhpcy5kaXNwb3NhYmxlID0gZGlzcG9zYWJsZTtcbiAgICB0aGlzLmlzRGlzcG9zZWQgPSBmYWxzZTtcbiAgfVxuXG4gIGZ1bmN0aW9uIHNjaGVkdWxlSXRlbShzLCBzZWxmKSB7XG4gICAgaWYgKCFzZWxmLmlzRGlzcG9zZWQpIHtcbiAgICAgIHNlbGYuaXNEaXNwb3NlZCA9IHRydWU7XG4gICAgICBzZWxmLmRpc3Bvc2FibGUuZGlzcG9zZSgpO1xuICAgIH1cbiAgfVxuXG4gIFNjaGVkdWxlZERpc3Bvc2FibGUucHJvdG90eXBlLmRpc3Bvc2UgPSBmdW5jdGlvbiAoKSB7XG4gICAgdGhpcy5zY2hlZHVsZXIuc2NoZWR1bGUodGhpcywgc2NoZWR1bGVJdGVtKTtcbiAgfTtcblxuICB2YXIgU2NoZWR1bGVkSXRlbSA9IFJ4LmludGVybmFscy5TY2hlZHVsZWRJdGVtID0gZnVuY3Rpb24gKHNjaGVkdWxlciwgc3RhdGUsIGFjdGlvbiwgZHVlVGltZSwgY29tcGFyZXIpIHtcbiAgICB0aGlzLnNjaGVkdWxlciA9IHNjaGVkdWxlcjtcbiAgICB0aGlzLnN0YXRlID0gc3RhdGU7XG4gICAgdGhpcy5hY3Rpb24gPSBhY3Rpb247XG4gICAgdGhpcy5kdWVUaW1lID0gZHVlVGltZTtcbiAgICB0aGlzLmNvbXBhcmVyID0gY29tcGFyZXIgfHwgZGVmYXVsdFN1YkNvbXBhcmVyO1xuICAgIHRoaXMuZGlzcG9zYWJsZSA9IG5ldyBTaW5nbGVBc3NpZ25tZW50RGlzcG9zYWJsZSgpO1xuICB9XG5cbiAgU2NoZWR1bGVkSXRlbS5wcm90b3R5cGUuaW52b2tlID0gZnVuY3Rpb24gKCkge1xuICAgIHRoaXMuZGlzcG9zYWJsZS5zZXREaXNwb3NhYmxlKHRoaXMuaW52b2tlQ29yZSgpKTtcbiAgfTtcblxuICBTY2hlZHVsZWRJdGVtLnByb3RvdHlwZS5jb21wYXJlVG8gPSBmdW5jdGlvbiAob3RoZXIpIHtcbiAgICByZXR1cm4gdGhpcy5jb21wYXJlcih0aGlzLmR1ZVRpbWUsIG90aGVyLmR1ZVRpbWUpO1xuICB9O1xuXG4gIFNjaGVkdWxlZEl0ZW0ucHJvdG90eXBlLmlzQ2FuY2VsbGVkID0gZnVuY3Rpb24gKCkge1xuICAgIHJldHVybiB0aGlzLmRpc3Bvc2FibGUuaXNEaXNwb3NlZDtcbiAgfTtcblxuICBTY2hlZHVsZWRJdGVtLnByb3RvdHlwZS5pbnZva2VDb3JlID0gZnVuY3Rpb24gKCkge1xuICAgIHJldHVybiBkaXNwb3NhYmxlRml4dXAodGhpcy5hY3Rpb24odGhpcy5zY2hlZHVsZXIsIHRoaXMuc3RhdGUpKTtcbiAgfTtcblxuICAvKiogUHJvdmlkZXMgYSBzZXQgb2Ygc3RhdGljIHByb3BlcnRpZXMgdG8gYWNjZXNzIGNvbW1vbmx5IHVzZWQgc2NoZWR1bGVycy4gKi9cbiAgdmFyIFNjaGVkdWxlciA9IFJ4LlNjaGVkdWxlciA9IChmdW5jdGlvbiAoKSB7XG5cbiAgICBmdW5jdGlvbiBTY2hlZHVsZXIoKSB7IH1cblxuICAgIC8qKiBEZXRlcm1pbmVzIHdoZXRoZXIgdGhlIGdpdmVuIG9iamVjdCBpcyBhIHNjaGVkdWxlciAqL1xuICAgIFNjaGVkdWxlci5pc1NjaGVkdWxlciA9IGZ1bmN0aW9uIChzKSB7XG4gICAgICByZXR1cm4gcyBpbnN0YW5jZW9mIFNjaGVkdWxlcjtcbiAgICB9O1xuXG4gICAgdmFyIHNjaGVkdWxlclByb3RvID0gU2NoZWR1bGVyLnByb3RvdHlwZTtcblxuICAgIC8qKlxuICAgKiBTY2hlZHVsZXMgYW4gYWN0aW9uIHRvIGJlIGV4ZWN1dGVkLlxuICAgKiBAcGFyYW0gc3RhdGUgU3RhdGUgcGFzc2VkIHRvIHRoZSBhY3Rpb24gdG8gYmUgZXhlY3V0ZWQuXG4gICAqIEBwYXJhbSB7RnVuY3Rpb259IGFjdGlvbiBBY3Rpb24gdG8gYmUgZXhlY3V0ZWQuXG4gICAqIEByZXR1cm5zIHtEaXNwb3NhYmxlfSBUaGUgZGlzcG9zYWJsZSBvYmplY3QgdXNlZCB0byBjYW5jZWwgdGhlIHNjaGVkdWxlZCBhY3Rpb24gKGJlc3QgZWZmb3J0KS5cbiAgICovXG4gICAgc2NoZWR1bGVyUHJvdG8uc2NoZWR1bGUgPSBmdW5jdGlvbiAoc3RhdGUsIGFjdGlvbikge1xuICAgICAgdGhyb3cgbmV3IE5vdEltcGxlbWVudGVkRXJyb3IoKTtcbiAgICB9O1xuXG4gIC8qKlxuICAgKiBTY2hlZHVsZXMgYW4gYWN0aW9uIHRvIGJlIGV4ZWN1dGVkIGFmdGVyIGR1ZVRpbWUuXG4gICAqIEBwYXJhbSBzdGF0ZSBTdGF0ZSBwYXNzZWQgdG8gdGhlIGFjdGlvbiB0byBiZSBleGVjdXRlZC5cbiAgICogQHBhcmFtIHtGdW5jdGlvbn0gYWN0aW9uIEFjdGlvbiB0byBiZSBleGVjdXRlZC5cbiAgICogQHBhcmFtIHtOdW1iZXJ9IGR1ZVRpbWUgUmVsYXRpdmUgdGltZSBhZnRlciB3aGljaCB0byBleGVjdXRlIHRoZSBhY3Rpb24uXG4gICAqIEByZXR1cm5zIHtEaXNwb3NhYmxlfSBUaGUgZGlzcG9zYWJsZSBvYmplY3QgdXNlZCB0byBjYW5jZWwgdGhlIHNjaGVkdWxlZCBhY3Rpb24gKGJlc3QgZWZmb3J0KS5cbiAgICovXG4gICAgc2NoZWR1bGVyUHJvdG8uc2NoZWR1bGVGdXR1cmUgPSBmdW5jdGlvbiAoc3RhdGUsIGR1ZVRpbWUsIGFjdGlvbikge1xuICAgICAgdmFyIGR0ID0gZHVlVGltZTtcbiAgICAgIGR0IGluc3RhbmNlb2YgRGF0ZSAmJiAoZHQgPSBkdCAtIHRoaXMubm93KCkpO1xuICAgICAgZHQgPSBTY2hlZHVsZXIubm9ybWFsaXplKGR0KTtcblxuICAgICAgaWYgKGR0ID09PSAwKSB7IHJldHVybiB0aGlzLnNjaGVkdWxlKHN0YXRlLCBhY3Rpb24pOyB9XG5cbiAgICAgIHJldHVybiB0aGlzLl9zY2hlZHVsZUZ1dHVyZShzdGF0ZSwgZHQsIGFjdGlvbik7XG4gICAgfTtcblxuICAgIHNjaGVkdWxlclByb3RvLl9zY2hlZHVsZUZ1dHVyZSA9IGZ1bmN0aW9uIChzdGF0ZSwgZHVlVGltZSwgYWN0aW9uKSB7XG4gICAgICB0aHJvdyBuZXcgTm90SW1wbGVtZW50ZWRFcnJvcigpO1xuICAgIH07XG5cbiAgICAvKiogR2V0cyB0aGUgY3VycmVudCB0aW1lIGFjY29yZGluZyB0byB0aGUgbG9jYWwgbWFjaGluZSdzIHN5c3RlbSBjbG9jay4gKi9cbiAgICBTY2hlZHVsZXIubm93ID0gZGVmYXVsdE5vdztcblxuICAgIC8qKiBHZXRzIHRoZSBjdXJyZW50IHRpbWUgYWNjb3JkaW5nIHRvIHRoZSBsb2NhbCBtYWNoaW5lJ3Mgc3lzdGVtIGNsb2NrLiAqL1xuICAgIFNjaGVkdWxlci5wcm90b3R5cGUubm93ID0gZGVmYXVsdE5vdztcblxuICAgIC8qKlxuICAgICAqIE5vcm1hbGl6ZXMgdGhlIHNwZWNpZmllZCBUaW1lU3BhbiB2YWx1ZSB0byBhIHBvc2l0aXZlIHZhbHVlLlxuICAgICAqIEBwYXJhbSB7TnVtYmVyfSB0aW1lU3BhbiBUaGUgdGltZSBzcGFuIHZhbHVlIHRvIG5vcm1hbGl6ZS5cbiAgICAgKiBAcmV0dXJucyB7TnVtYmVyfSBUaGUgc3BlY2lmaWVkIFRpbWVTcGFuIHZhbHVlIGlmIGl0IGlzIHplcm8gb3IgcG9zaXRpdmU7IG90aGVyd2lzZSwgMFxuICAgICAqL1xuICAgIFNjaGVkdWxlci5ub3JtYWxpemUgPSBmdW5jdGlvbiAodGltZVNwYW4pIHtcbiAgICAgIHRpbWVTcGFuIDwgMCAmJiAodGltZVNwYW4gPSAwKTtcbiAgICAgIHJldHVybiB0aW1lU3BhbjtcbiAgICB9O1xuXG4gICAgcmV0dXJuIFNjaGVkdWxlcjtcbiAgfSgpKTtcblxuICB2YXIgbm9ybWFsaXplVGltZSA9IFNjaGVkdWxlci5ub3JtYWxpemUsIGlzU2NoZWR1bGVyID0gU2NoZWR1bGVyLmlzU2NoZWR1bGVyO1xuXG4gIChmdW5jdGlvbiAoc2NoZWR1bGVyUHJvdG8pIHtcblxuICAgIGZ1bmN0aW9uIGludm9rZVJlY0ltbWVkaWF0ZShzY2hlZHVsZXIsIHBhaXIpIHtcbiAgICAgIHZhciBzdGF0ZSA9IHBhaXJbMF0sIGFjdGlvbiA9IHBhaXJbMV0sIGdyb3VwID0gbmV3IENvbXBvc2l0ZURpc3Bvc2FibGUoKTtcbiAgICAgIGFjdGlvbihzdGF0ZSwgaW5uZXJBY3Rpb24pO1xuICAgICAgcmV0dXJuIGdyb3VwO1xuXG4gICAgICBmdW5jdGlvbiBpbm5lckFjdGlvbihzdGF0ZTIpIHtcbiAgICAgICAgdmFyIGlzQWRkZWQgPSBmYWxzZSwgaXNEb25lID0gZmFsc2U7XG5cbiAgICAgICAgdmFyIGQgPSBzY2hlZHVsZXIuc2NoZWR1bGUoc3RhdGUyLCBzY2hlZHVsZVdvcmspO1xuICAgICAgICBpZiAoIWlzRG9uZSkge1xuICAgICAgICAgIGdyb3VwLmFkZChkKTtcbiAgICAgICAgICBpc0FkZGVkID0gdHJ1ZTtcbiAgICAgICAgfVxuXG4gICAgICAgIGZ1bmN0aW9uIHNjaGVkdWxlV29yayhfLCBzdGF0ZTMpIHtcbiAgICAgICAgICBpZiAoaXNBZGRlZCkge1xuICAgICAgICAgICAgZ3JvdXAucmVtb3ZlKGQpO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBpc0RvbmUgPSB0cnVlO1xuICAgICAgICAgIH1cbiAgICAgICAgICBhY3Rpb24oc3RhdGUzLCBpbm5lckFjdGlvbik7XG4gICAgICAgICAgcmV0dXJuIGRpc3Bvc2FibGVFbXB0eTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cblxuICAgIGZ1bmN0aW9uIGludm9rZVJlY0RhdGUoc2NoZWR1bGVyLCBwYWlyKSB7XG4gICAgICB2YXIgc3RhdGUgPSBwYWlyWzBdLCBhY3Rpb24gPSBwYWlyWzFdLCBncm91cCA9IG5ldyBDb21wb3NpdGVEaXNwb3NhYmxlKCk7XG4gICAgICBhY3Rpb24oc3RhdGUsIGlubmVyQWN0aW9uKTtcbiAgICAgIHJldHVybiBncm91cDtcblxuICAgICAgZnVuY3Rpb24gaW5uZXJBY3Rpb24oc3RhdGUyLCBkdWVUaW1lMSkge1xuICAgICAgICB2YXIgaXNBZGRlZCA9IGZhbHNlLCBpc0RvbmUgPSBmYWxzZTtcblxuICAgICAgICB2YXIgZCA9IHNjaGVkdWxlci5zY2hlZHVsZUZ1dHVyZShzdGF0ZTIsIGR1ZVRpbWUxLCBzY2hlZHVsZVdvcmspO1xuICAgICAgICBpZiAoIWlzRG9uZSkge1xuICAgICAgICAgIGdyb3VwLmFkZChkKTtcbiAgICAgICAgICBpc0FkZGVkID0gdHJ1ZTtcbiAgICAgICAgfVxuXG4gICAgICAgIGZ1bmN0aW9uIHNjaGVkdWxlV29yayhfLCBzdGF0ZTMpIHtcbiAgICAgICAgICBpZiAoaXNBZGRlZCkge1xuICAgICAgICAgICAgZ3JvdXAucmVtb3ZlKGQpO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBpc0RvbmUgPSB0cnVlO1xuICAgICAgICAgIH1cbiAgICAgICAgICBhY3Rpb24oc3RhdGUzLCBpbm5lckFjdGlvbik7XG4gICAgICAgICAgcmV0dXJuIGRpc3Bvc2FibGVFbXB0eTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFNjaGVkdWxlcyBhbiBhY3Rpb24gdG8gYmUgZXhlY3V0ZWQgcmVjdXJzaXZlbHkuXG4gICAgICogQHBhcmFtIHtNaXhlZH0gc3RhdGUgU3RhdGUgcGFzc2VkIHRvIHRoZSBhY3Rpb24gdG8gYmUgZXhlY3V0ZWQuXG4gICAgICogQHBhcmFtIHtGdW5jdGlvbn0gYWN0aW9uIEFjdGlvbiB0byBleGVjdXRlIHJlY3Vyc2l2ZWx5LiBUaGUgbGFzdCBwYXJhbWV0ZXIgcGFzc2VkIHRvIHRoZSBhY3Rpb24gaXMgdXNlZCB0byB0cmlnZ2VyIHJlY3Vyc2l2ZSBzY2hlZHVsaW5nIG9mIHRoZSBhY3Rpb24sIHBhc3NpbmcgaW4gcmVjdXJzaXZlIGludm9jYXRpb24gc3RhdGUuXG4gICAgICogQHJldHVybnMge0Rpc3Bvc2FibGV9IFRoZSBkaXNwb3NhYmxlIG9iamVjdCB1c2VkIHRvIGNhbmNlbCB0aGUgc2NoZWR1bGVkIGFjdGlvbiAoYmVzdCBlZmZvcnQpLlxuICAgICAqL1xuICAgIHNjaGVkdWxlclByb3RvLnNjaGVkdWxlUmVjdXJzaXZlID0gZnVuY3Rpb24gKHN0YXRlLCBhY3Rpb24pIHtcbiAgICAgIHJldHVybiB0aGlzLnNjaGVkdWxlKFtzdGF0ZSwgYWN0aW9uXSwgaW52b2tlUmVjSW1tZWRpYXRlKTtcbiAgICB9O1xuXG4gICAgLyoqXG4gICAgICogU2NoZWR1bGVzIGFuIGFjdGlvbiB0byBiZSBleGVjdXRlZCByZWN1cnNpdmVseSBhZnRlciBhIHNwZWNpZmllZCByZWxhdGl2ZSBvciBhYnNvbHV0ZSBkdWUgdGltZS5cbiAgICAgKiBAcGFyYW0ge01peGVkfSBzdGF0ZSBTdGF0ZSBwYXNzZWQgdG8gdGhlIGFjdGlvbiB0byBiZSBleGVjdXRlZC5cbiAgICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBhY3Rpb24gQWN0aW9uIHRvIGV4ZWN1dGUgcmVjdXJzaXZlbHkuIFRoZSBsYXN0IHBhcmFtZXRlciBwYXNzZWQgdG8gdGhlIGFjdGlvbiBpcyB1c2VkIHRvIHRyaWdnZXIgcmVjdXJzaXZlIHNjaGVkdWxpbmcgb2YgdGhlIGFjdGlvbiwgcGFzc2luZyBpbiB0aGUgcmVjdXJzaXZlIGR1ZSB0aW1lIGFuZCBpbnZvY2F0aW9uIHN0YXRlLlxuICAgICAqIEBwYXJhbSB7TnVtYmVyIHwgRGF0ZX0gZHVlVGltZSBSZWxhdGl2ZSBvciBhYnNvbHV0ZSB0aW1lIGFmdGVyIHdoaWNoIHRvIGV4ZWN1dGUgdGhlIGFjdGlvbiBmb3IgdGhlIGZpcnN0IHRpbWUuXG4gICAgICogQHJldHVybnMge0Rpc3Bvc2FibGV9IFRoZSBkaXNwb3NhYmxlIG9iamVjdCB1c2VkIHRvIGNhbmNlbCB0aGUgc2NoZWR1bGVkIGFjdGlvbiAoYmVzdCBlZmZvcnQpLlxuICAgICAqL1xuICAgIHNjaGVkdWxlclByb3RvLnNjaGVkdWxlUmVjdXJzaXZlRnV0dXJlID0gZnVuY3Rpb24gKHN0YXRlLCBkdWVUaW1lLCBhY3Rpb24pIHtcbiAgICAgIHJldHVybiB0aGlzLnNjaGVkdWxlRnV0dXJlKFtzdGF0ZSwgYWN0aW9uXSwgZHVlVGltZSwgaW52b2tlUmVjRGF0ZSk7XG4gICAgfTtcblxuICB9KFNjaGVkdWxlci5wcm90b3R5cGUpKTtcblxuICAoZnVuY3Rpb24gKHNjaGVkdWxlclByb3RvKSB7XG5cbiAgICAvKipcbiAgICAgKiBTY2hlZHVsZXMgYSBwZXJpb2RpYyBwaWVjZSBvZiB3b3JrIGJ5IGR5bmFtaWNhbGx5IGRpc2NvdmVyaW5nIHRoZSBzY2hlZHVsZXIncyBjYXBhYmlsaXRpZXMuIFRoZSBwZXJpb2RpYyB0YXNrIHdpbGwgYmUgc2NoZWR1bGVkIHVzaW5nIHdpbmRvdy5zZXRJbnRlcnZhbCBmb3IgdGhlIGJhc2UgaW1wbGVtZW50YXRpb24uXG4gICAgICogQHBhcmFtIHtNaXhlZH0gc3RhdGUgSW5pdGlhbCBzdGF0ZSBwYXNzZWQgdG8gdGhlIGFjdGlvbiB1cG9uIHRoZSBmaXJzdCBpdGVyYXRpb24uXG4gICAgICogQHBhcmFtIHtOdW1iZXJ9IHBlcmlvZCBQZXJpb2QgZm9yIHJ1bm5pbmcgdGhlIHdvcmsgcGVyaW9kaWNhbGx5LlxuICAgICAqIEBwYXJhbSB7RnVuY3Rpb259IGFjdGlvbiBBY3Rpb24gdG8gYmUgZXhlY3V0ZWQsIHBvdGVudGlhbGx5IHVwZGF0aW5nIHRoZSBzdGF0ZS5cbiAgICAgKiBAcmV0dXJucyB7RGlzcG9zYWJsZX0gVGhlIGRpc3Bvc2FibGUgb2JqZWN0IHVzZWQgdG8gY2FuY2VsIHRoZSBzY2hlZHVsZWQgcmVjdXJyaW5nIGFjdGlvbiAoYmVzdCBlZmZvcnQpLlxuICAgICAqL1xuICAgIFNjaGVkdWxlci5wcm90b3R5cGUuc2NoZWR1bGVQZXJpb2RpYyA9IGZ1bmN0aW9uKHN0YXRlLCBwZXJpb2QsIGFjdGlvbikge1xuICAgICAgaWYgKHR5cGVvZiByb290LnNldEludGVydmFsID09PSAndW5kZWZpbmVkJykgeyB0aHJvdyBuZXcgTm90U3VwcG9ydGVkRXJyb3IoKTsgfVxuICAgICAgcGVyaW9kID0gbm9ybWFsaXplVGltZShwZXJpb2QpO1xuICAgICAgdmFyIHMgPSBzdGF0ZSwgaWQgPSByb290LnNldEludGVydmFsKGZ1bmN0aW9uICgpIHsgcyA9IGFjdGlvbihzKTsgfSwgcGVyaW9kKTtcbiAgICAgIHJldHVybiBkaXNwb3NhYmxlQ3JlYXRlKGZ1bmN0aW9uICgpIHsgcm9vdC5jbGVhckludGVydmFsKGlkKTsgfSk7XG4gICAgfTtcblxuICB9KFNjaGVkdWxlci5wcm90b3R5cGUpKTtcblxuICAoZnVuY3Rpb24gKHNjaGVkdWxlclByb3RvKSB7XG4gICAgLyoqXG4gICAgICogUmV0dXJucyBhIHNjaGVkdWxlciB0aGF0IHdyYXBzIHRoZSBvcmlnaW5hbCBzY2hlZHVsZXIsIGFkZGluZyBleGNlcHRpb24gaGFuZGxpbmcgZm9yIHNjaGVkdWxlZCBhY3Rpb25zLlxuICAgICAqIEBwYXJhbSB7RnVuY3Rpb259IGhhbmRsZXIgSGFuZGxlciB0aGF0J3MgcnVuIGlmIGFuIGV4Y2VwdGlvbiBpcyBjYXVnaHQuIFRoZSBleGNlcHRpb24gd2lsbCBiZSByZXRocm93biBpZiB0aGUgaGFuZGxlciByZXR1cm5zIGZhbHNlLlxuICAgICAqIEByZXR1cm5zIHtTY2hlZHVsZXJ9IFdyYXBwZXIgYXJvdW5kIHRoZSBvcmlnaW5hbCBzY2hlZHVsZXIsIGVuZm9yY2luZyBleGNlcHRpb24gaGFuZGxpbmcuXG4gICAgICovXG4gICAgc2NoZWR1bGVyUHJvdG8uY2F0Y2hFcnJvciA9IHNjaGVkdWxlclByb3RvWydjYXRjaCddID0gZnVuY3Rpb24gKGhhbmRsZXIpIHtcbiAgICAgIHJldHVybiBuZXcgQ2F0Y2hTY2hlZHVsZXIodGhpcywgaGFuZGxlcik7XG4gICAgfTtcbiAgfShTY2hlZHVsZXIucHJvdG90eXBlKSk7XG5cbiAgdmFyIFNjaGVkdWxlUGVyaW9kaWNSZWN1cnNpdmUgPSBSeC5pbnRlcm5hbHMuU2NoZWR1bGVQZXJpb2RpY1JlY3Vyc2l2ZSA9IChmdW5jdGlvbiAoKSB7XG4gICAgZnVuY3Rpb24gdGljayhjb21tYW5kLCByZWN1cnNlKSB7XG4gICAgICByZWN1cnNlKDAsIHRoaXMuX3BlcmlvZCk7XG4gICAgICB0cnkge1xuICAgICAgICB0aGlzLl9zdGF0ZSA9IHRoaXMuX2FjdGlvbih0aGlzLl9zdGF0ZSk7XG4gICAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgIHRoaXMuX2NhbmNlbC5kaXNwb3NlKCk7XG4gICAgICAgIHRocm93IGU7XG4gICAgICB9XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gU2NoZWR1bGVQZXJpb2RpY1JlY3Vyc2l2ZShzY2hlZHVsZXIsIHN0YXRlLCBwZXJpb2QsIGFjdGlvbikge1xuICAgICAgdGhpcy5fc2NoZWR1bGVyID0gc2NoZWR1bGVyO1xuICAgICAgdGhpcy5fc3RhdGUgPSBzdGF0ZTtcbiAgICAgIHRoaXMuX3BlcmlvZCA9IHBlcmlvZDtcbiAgICAgIHRoaXMuX2FjdGlvbiA9IGFjdGlvbjtcbiAgICB9XG5cbiAgICBTY2hlZHVsZVBlcmlvZGljUmVjdXJzaXZlLnByb3RvdHlwZS5zdGFydCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgIHZhciBkID0gbmV3IFNpbmdsZUFzc2lnbm1lbnREaXNwb3NhYmxlKCk7XG4gICAgICB0aGlzLl9jYW5jZWwgPSBkO1xuICAgICAgZC5zZXREaXNwb3NhYmxlKHRoaXMuX3NjaGVkdWxlci5zY2hlZHVsZVJlY3Vyc2l2ZUZ1dHVyZSgwLCB0aGlzLl9wZXJpb2QsIHRpY2suYmluZCh0aGlzKSkpO1xuXG4gICAgICByZXR1cm4gZDtcbiAgICB9O1xuXG4gICAgcmV0dXJuIFNjaGVkdWxlUGVyaW9kaWNSZWN1cnNpdmU7XG4gIH0oKSk7XG5cbiAgLyoqIEdldHMgYSBzY2hlZHVsZXIgdGhhdCBzY2hlZHVsZXMgd29yayBpbW1lZGlhdGVseSBvbiB0aGUgY3VycmVudCB0aHJlYWQuICovXG4gICB2YXIgSW1tZWRpYXRlU2NoZWR1bGVyID0gKGZ1bmN0aW9uIChfX3N1cGVyX18pIHtcbiAgICBpbmhlcml0cyhJbW1lZGlhdGVTY2hlZHVsZXIsIF9fc3VwZXJfXyk7XG4gICAgZnVuY3Rpb24gSW1tZWRpYXRlU2NoZWR1bGVyKCkge1xuICAgICAgX19zdXBlcl9fLmNhbGwodGhpcyk7XG4gICAgfVxuXG4gICAgSW1tZWRpYXRlU2NoZWR1bGVyLnByb3RvdHlwZS5zY2hlZHVsZSA9IGZ1bmN0aW9uIChzdGF0ZSwgYWN0aW9uKSB7XG4gICAgICByZXR1cm4gZGlzcG9zYWJsZUZpeHVwKGFjdGlvbih0aGlzLCBzdGF0ZSkpO1xuICAgIH07XG5cbiAgICByZXR1cm4gSW1tZWRpYXRlU2NoZWR1bGVyO1xuICB9KFNjaGVkdWxlcikpO1xuXG4gIHZhciBpbW1lZGlhdGVTY2hlZHVsZXIgPSBTY2hlZHVsZXIuaW1tZWRpYXRlID0gbmV3IEltbWVkaWF0ZVNjaGVkdWxlcigpO1xuXG4gIC8qKlxuICAgKiBHZXRzIGEgc2NoZWR1bGVyIHRoYXQgc2NoZWR1bGVzIHdvcmsgYXMgc29vbiBhcyBwb3NzaWJsZSBvbiB0aGUgY3VycmVudCB0aHJlYWQuXG4gICAqL1xuICB2YXIgQ3VycmVudFRocmVhZFNjaGVkdWxlciA9IChmdW5jdGlvbiAoX19zdXBlcl9fKSB7XG4gICAgdmFyIHF1ZXVlO1xuXG4gICAgZnVuY3Rpb24gcnVuVHJhbXBvbGluZSAoKSB7XG4gICAgICB3aGlsZSAocXVldWUubGVuZ3RoID4gMCkge1xuICAgICAgICB2YXIgaXRlbSA9IHF1ZXVlLmRlcXVldWUoKTtcbiAgICAgICAgIWl0ZW0uaXNDYW5jZWxsZWQoKSAmJiBpdGVtLmludm9rZSgpO1xuICAgICAgfVxuICAgIH1cblxuICAgIGluaGVyaXRzKEN1cnJlbnRUaHJlYWRTY2hlZHVsZXIsIF9fc3VwZXJfXyk7XG4gICAgZnVuY3Rpb24gQ3VycmVudFRocmVhZFNjaGVkdWxlcigpIHtcbiAgICAgIF9fc3VwZXJfXy5jYWxsKHRoaXMpO1xuICAgIH1cblxuICAgIEN1cnJlbnRUaHJlYWRTY2hlZHVsZXIucHJvdG90eXBlLnNjaGVkdWxlID0gZnVuY3Rpb24gKHN0YXRlLCBhY3Rpb24pIHtcbiAgICAgIHZhciBzaSA9IG5ldyBTY2hlZHVsZWRJdGVtKHRoaXMsIHN0YXRlLCBhY3Rpb24sIHRoaXMubm93KCkpO1xuXG4gICAgICBpZiAoIXF1ZXVlKSB7XG4gICAgICAgIHF1ZXVlID0gbmV3IFByaW9yaXR5UXVldWUoNCk7XG4gICAgICAgIHF1ZXVlLmVucXVldWUoc2kpO1xuXG4gICAgICAgIHZhciByZXN1bHQgPSB0cnlDYXRjaChydW5UcmFtcG9saW5lKSgpO1xuICAgICAgICBxdWV1ZSA9IG51bGw7XG4gICAgICAgIGlmIChyZXN1bHQgPT09IGVycm9yT2JqKSB7IHRocm93ZXIocmVzdWx0LmUpOyB9XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBxdWV1ZS5lbnF1ZXVlKHNpKTtcbiAgICAgIH1cbiAgICAgIHJldHVybiBzaS5kaXNwb3NhYmxlO1xuICAgIH07XG5cbiAgICBDdXJyZW50VGhyZWFkU2NoZWR1bGVyLnByb3RvdHlwZS5zY2hlZHVsZVJlcXVpcmVkID0gZnVuY3Rpb24gKCkgeyByZXR1cm4gIXF1ZXVlOyB9O1xuXG4gICAgcmV0dXJuIEN1cnJlbnRUaHJlYWRTY2hlZHVsZXI7XG4gIH0oU2NoZWR1bGVyKSk7XG5cbiAgdmFyIGN1cnJlbnRUaHJlYWRTY2hlZHVsZXIgPSBTY2hlZHVsZXIuY3VycmVudFRocmVhZCA9IG5ldyBDdXJyZW50VGhyZWFkU2NoZWR1bGVyKCk7XG5cbiAgdmFyIHNjaGVkdWxlTWV0aG9kLCBjbGVhck1ldGhvZDtcblxuICB2YXIgbG9jYWxUaW1lciA9IChmdW5jdGlvbiAoKSB7XG4gICAgdmFyIGxvY2FsU2V0VGltZW91dCwgbG9jYWxDbGVhclRpbWVvdXQgPSBub29wO1xuICAgIGlmICghIXJvb3Quc2V0VGltZW91dCkge1xuICAgICAgbG9jYWxTZXRUaW1lb3V0ID0gcm9vdC5zZXRUaW1lb3V0O1xuICAgICAgbG9jYWxDbGVhclRpbWVvdXQgPSByb290LmNsZWFyVGltZW91dDtcbiAgICB9IGVsc2UgaWYgKCEhcm9vdC5XU2NyaXB0KSB7XG4gICAgICBsb2NhbFNldFRpbWVvdXQgPSBmdW5jdGlvbiAoZm4sIHRpbWUpIHtcbiAgICAgICAgcm9vdC5XU2NyaXB0LlNsZWVwKHRpbWUpO1xuICAgICAgICBmbigpO1xuICAgICAgfTtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhyb3cgbmV3IE5vdFN1cHBvcnRlZEVycm9yKCk7XG4gICAgfVxuXG4gICAgcmV0dXJuIHtcbiAgICAgIHNldFRpbWVvdXQ6IGxvY2FsU2V0VGltZW91dCxcbiAgICAgIGNsZWFyVGltZW91dDogbG9jYWxDbGVhclRpbWVvdXRcbiAgICB9O1xuICB9KCkpO1xuICB2YXIgbG9jYWxTZXRUaW1lb3V0ID0gbG9jYWxUaW1lci5zZXRUaW1lb3V0LFxuICAgIGxvY2FsQ2xlYXJUaW1lb3V0ID0gbG9jYWxUaW1lci5jbGVhclRpbWVvdXQ7XG5cbiAgKGZ1bmN0aW9uICgpIHtcblxuICAgIHZhciBuZXh0SGFuZGxlID0gMSwgdGFza3NCeUhhbmRsZSA9IHt9LCBjdXJyZW50bHlSdW5uaW5nID0gZmFsc2U7XG5cbiAgICBjbGVhck1ldGhvZCA9IGZ1bmN0aW9uIChoYW5kbGUpIHtcbiAgICAgIGRlbGV0ZSB0YXNrc0J5SGFuZGxlW2hhbmRsZV07XG4gICAgfTtcblxuICAgIGZ1bmN0aW9uIHJ1blRhc2soaGFuZGxlKSB7XG4gICAgICBpZiAoY3VycmVudGx5UnVubmluZykge1xuICAgICAgICBsb2NhbFNldFRpbWVvdXQoZnVuY3Rpb24gKCkgeyBydW5UYXNrKGhhbmRsZSk7IH0sIDApO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdmFyIHRhc2sgPSB0YXNrc0J5SGFuZGxlW2hhbmRsZV07XG4gICAgICAgIGlmICh0YXNrKSB7XG4gICAgICAgICAgY3VycmVudGx5UnVubmluZyA9IHRydWU7XG4gICAgICAgICAgdmFyIHJlc3VsdCA9IHRyeUNhdGNoKHRhc2spKCk7XG4gICAgICAgICAgY2xlYXJNZXRob2QoaGFuZGxlKTtcbiAgICAgICAgICBjdXJyZW50bHlSdW5uaW5nID0gZmFsc2U7XG4gICAgICAgICAgaWYgKHJlc3VsdCA9PT0gZXJyb3JPYmopIHsgdGhyb3dlcihyZXN1bHQuZSk7IH1cbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cblxuICAgIHZhciByZU5hdGl2ZSA9IG5ldyBSZWdFeHAoJ14nICtcbiAgICAgIFN0cmluZyh0b1N0cmluZylcbiAgICAgICAgLnJlcGxhY2UoL1suKis/XiR7fSgpfFtcXF1cXFxcXS9nLCAnXFxcXCQmJylcbiAgICAgICAgLnJlcGxhY2UoL3RvU3RyaW5nfCBmb3IgW15cXF1dKy9nLCAnLio/JykgKyAnJCdcbiAgICApO1xuXG4gICAgdmFyIHNldEltbWVkaWF0ZSA9IHR5cGVvZiAoc2V0SW1tZWRpYXRlID0gZnJlZUdsb2JhbCAmJiBtb2R1bGVFeHBvcnRzICYmIGZyZWVHbG9iYWwuc2V0SW1tZWRpYXRlKSA9PSAnZnVuY3Rpb24nICYmXG4gICAgICAhcmVOYXRpdmUudGVzdChzZXRJbW1lZGlhdGUpICYmIHNldEltbWVkaWF0ZTtcblxuICAgIGZ1bmN0aW9uIHBvc3RNZXNzYWdlU3VwcG9ydGVkICgpIHtcbiAgICAgIC8vIEVuc3VyZSBub3QgaW4gYSB3b3JrZXJcbiAgICAgIGlmICghcm9vdC5wb3N0TWVzc2FnZSB8fCByb290LmltcG9ydFNjcmlwdHMpIHsgcmV0dXJuIGZhbHNlOyB9XG4gICAgICB2YXIgaXNBc3luYyA9IGZhbHNlLCBvbGRIYW5kbGVyID0gcm9vdC5vbm1lc3NhZ2U7XG4gICAgICAvLyBUZXN0IGZvciBhc3luY1xuICAgICAgcm9vdC5vbm1lc3NhZ2UgPSBmdW5jdGlvbiAoKSB7IGlzQXN5bmMgPSB0cnVlOyB9O1xuICAgICAgcm9vdC5wb3N0TWVzc2FnZSgnJywgJyonKTtcbiAgICAgIHJvb3Qub25tZXNzYWdlID0gb2xkSGFuZGxlcjtcblxuICAgICAgcmV0dXJuIGlzQXN5bmM7XG4gICAgfVxuXG4gICAgLy8gVXNlIGluIG9yZGVyLCBzZXRJbW1lZGlhdGUsIG5leHRUaWNrLCBwb3N0TWVzc2FnZSwgTWVzc2FnZUNoYW5uZWwsIHNjcmlwdCByZWFkeXN0YXRlY2hhbmdlZCwgc2V0VGltZW91dFxuICAgIGlmIChpc0Z1bmN0aW9uKHNldEltbWVkaWF0ZSkpIHtcbiAgICAgIHNjaGVkdWxlTWV0aG9kID0gZnVuY3Rpb24gKGFjdGlvbikge1xuICAgICAgICB2YXIgaWQgPSBuZXh0SGFuZGxlKys7XG4gICAgICAgIHRhc2tzQnlIYW5kbGVbaWRdID0gYWN0aW9uO1xuICAgICAgICBzZXRJbW1lZGlhdGUoZnVuY3Rpb24gKCkgeyBydW5UYXNrKGlkKTsgfSk7XG5cbiAgICAgICAgcmV0dXJuIGlkO1xuICAgICAgfTtcbiAgICB9IGVsc2UgaWYgKHR5cGVvZiBwcm9jZXNzICE9PSAndW5kZWZpbmVkJyAmJiB7fS50b1N0cmluZy5jYWxsKHByb2Nlc3MpID09PSAnW29iamVjdCBwcm9jZXNzXScpIHtcbiAgICAgIHNjaGVkdWxlTWV0aG9kID0gZnVuY3Rpb24gKGFjdGlvbikge1xuICAgICAgICB2YXIgaWQgPSBuZXh0SGFuZGxlKys7XG4gICAgICAgIHRhc2tzQnlIYW5kbGVbaWRdID0gYWN0aW9uO1xuICAgICAgICBwcm9jZXNzLm5leHRUaWNrKGZ1bmN0aW9uICgpIHsgcnVuVGFzayhpZCk7IH0pO1xuXG4gICAgICAgIHJldHVybiBpZDtcbiAgICAgIH07XG4gICAgfSBlbHNlIGlmIChwb3N0TWVzc2FnZVN1cHBvcnRlZCgpKSB7XG4gICAgICB2YXIgTVNHX1BSRUZJWCA9ICdtcy5yeC5zY2hlZHVsZScgKyBNYXRoLnJhbmRvbSgpO1xuXG4gICAgICBmdW5jdGlvbiBvbkdsb2JhbFBvc3RNZXNzYWdlKGV2ZW50KSB7XG4gICAgICAgIC8vIE9ubHkgaWYgd2UncmUgYSBtYXRjaCB0byBhdm9pZCBhbnkgb3RoZXIgZ2xvYmFsIGV2ZW50c1xuICAgICAgICBpZiAodHlwZW9mIGV2ZW50LmRhdGEgPT09ICdzdHJpbmcnICYmIGV2ZW50LmRhdGEuc3Vic3RyaW5nKDAsIE1TR19QUkVGSVgubGVuZ3RoKSA9PT0gTVNHX1BSRUZJWCkge1xuICAgICAgICAgIHJ1blRhc2soZXZlbnQuZGF0YS5zdWJzdHJpbmcoTVNHX1BSRUZJWC5sZW5ndGgpKTtcbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICBpZiAocm9vdC5hZGRFdmVudExpc3RlbmVyKSB7XG4gICAgICAgIHJvb3QuYWRkRXZlbnRMaXN0ZW5lcignbWVzc2FnZScsIG9uR2xvYmFsUG9zdE1lc3NhZ2UsIGZhbHNlKTtcbiAgICAgIH0gZWxzZSBpZiAocm9vdC5hdHRhY2hFdmVudCkge1xuICAgICAgICByb290LmF0dGFjaEV2ZW50KCdvbm1lc3NhZ2UnLCBvbkdsb2JhbFBvc3RNZXNzYWdlKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHJvb3Qub25tZXNzYWdlID0gb25HbG9iYWxQb3N0TWVzc2FnZTtcbiAgICAgIH1cblxuICAgICAgc2NoZWR1bGVNZXRob2QgPSBmdW5jdGlvbiAoYWN0aW9uKSB7XG4gICAgICAgIHZhciBpZCA9IG5leHRIYW5kbGUrKztcbiAgICAgICAgdGFza3NCeUhhbmRsZVtpZF0gPSBhY3Rpb247XG4gICAgICAgIHJvb3QucG9zdE1lc3NhZ2UoTVNHX1BSRUZJWCArIGN1cnJlbnRJZCwgJyonKTtcbiAgICAgICAgcmV0dXJuIGlkO1xuICAgICAgfTtcbiAgICB9IGVsc2UgaWYgKCEhcm9vdC5NZXNzYWdlQ2hhbm5lbCkge1xuICAgICAgdmFyIGNoYW5uZWwgPSBuZXcgcm9vdC5NZXNzYWdlQ2hhbm5lbCgpO1xuXG4gICAgICBjaGFubmVsLnBvcnQxLm9ubWVzc2FnZSA9IGZ1bmN0aW9uIChlKSB7IHJ1blRhc2soZS5kYXRhKTsgfTtcblxuICAgICAgc2NoZWR1bGVNZXRob2QgPSBmdW5jdGlvbiAoYWN0aW9uKSB7XG4gICAgICAgIHZhciBpZCA9IG5leHRIYW5kbGUrKztcbiAgICAgICAgdGFza3NCeUhhbmRsZVtpZF0gPSBhY3Rpb247XG4gICAgICAgIGNoYW5uZWwucG9ydDIucG9zdE1lc3NhZ2UoaWQpO1xuICAgICAgICByZXR1cm4gaWQ7XG4gICAgICB9O1xuICAgIH0gZWxzZSBpZiAoJ2RvY3VtZW50JyBpbiByb290ICYmICdvbnJlYWR5c3RhdGVjaGFuZ2UnIGluIHJvb3QuZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnc2NyaXB0JykpIHtcblxuICAgICAgc2NoZWR1bGVNZXRob2QgPSBmdW5jdGlvbiAoYWN0aW9uKSB7XG4gICAgICAgIHZhciBzY3JpcHRFbGVtZW50ID0gcm9vdC5kb2N1bWVudC5jcmVhdGVFbGVtZW50KCdzY3JpcHQnKTtcbiAgICAgICAgdmFyIGlkID0gbmV4dEhhbmRsZSsrO1xuICAgICAgICB0YXNrc0J5SGFuZGxlW2lkXSA9IGFjdGlvbjtcblxuICAgICAgICBzY3JpcHRFbGVtZW50Lm9ucmVhZHlzdGF0ZWNoYW5nZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICBydW5UYXNrKGlkKTtcbiAgICAgICAgICBzY3JpcHRFbGVtZW50Lm9ucmVhZHlzdGF0ZWNoYW5nZSA9IG51bGw7XG4gICAgICAgICAgc2NyaXB0RWxlbWVudC5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKHNjcmlwdEVsZW1lbnQpO1xuICAgICAgICAgIHNjcmlwdEVsZW1lbnQgPSBudWxsO1xuICAgICAgICB9O1xuICAgICAgICByb290LmRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5hcHBlbmRDaGlsZChzY3JpcHRFbGVtZW50KTtcbiAgICAgICAgcmV0dXJuIGlkO1xuICAgICAgfTtcblxuICAgIH0gZWxzZSB7XG4gICAgICBzY2hlZHVsZU1ldGhvZCA9IGZ1bmN0aW9uIChhY3Rpb24pIHtcbiAgICAgICAgdmFyIGlkID0gbmV4dEhhbmRsZSsrO1xuICAgICAgICB0YXNrc0J5SGFuZGxlW2lkXSA9IGFjdGlvbjtcbiAgICAgICAgbG9jYWxTZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICBydW5UYXNrKGlkKTtcbiAgICAgICAgfSwgMCk7XG5cbiAgICAgICAgcmV0dXJuIGlkO1xuICAgICAgfTtcbiAgICB9XG4gIH0oKSk7XG5cbiAgLyoqXG4gICAqIEdldHMgYSBzY2hlZHVsZXIgdGhhdCBzY2hlZHVsZXMgd29yayB2aWEgYSB0aW1lZCBjYWxsYmFjayBiYXNlZCB1cG9uIHBsYXRmb3JtLlxuICAgKi9cbiAgIHZhciBEZWZhdWx0U2NoZWR1bGVyID0gKGZ1bmN0aW9uIChfX3N1cGVyX18pIHtcbiAgICAgaW5oZXJpdHMoRGVmYXVsdFNjaGVkdWxlciwgX19zdXBlcl9fKTtcbiAgICAgZnVuY3Rpb24gRGVmYXVsdFNjaGVkdWxlcigpIHtcbiAgICAgICBfX3N1cGVyX18uY2FsbCh0aGlzKTtcbiAgICAgfVxuXG4gICAgIGZ1bmN0aW9uIERlZmF1bHRTY2hlZHVsZXJEaXNwb3NhYmxlKGlkKSB7XG4gICAgICAgdGhpcy5faWQgPSBpZDtcbiAgICAgICB0aGlzLmlzRGlzcG9zZWQgPSBmYWxzZTtcbiAgICAgfVxuXG4gICAgIERlZmF1bHRTY2hlZHVsZXJEaXNwb3NhYmxlLnByb3RvdHlwZS5kaXNwb3NlID0gZnVuY3Rpb24gKCkge1xuICAgICAgIGlmICghdGhpcy5pc0Rpc3Bvc2VkKSB7XG4gICAgICAgICB0aGlzLmlzRGlzcG9zZWQgPSB0cnVlO1xuICAgICAgICAgbG9jYWxDbGVhclRpbWVvdXQodGhpcy5faWQpO1xuICAgICAgIH1cbiAgICAgfTtcblxuICAgIERlZmF1bHRTY2hlZHVsZXIucHJvdG90eXBlLnNjaGVkdWxlID0gZnVuY3Rpb24gKHN0YXRlLCBhY3Rpb24pIHtcbiAgICAgIHZhciBzY2hlZHVsZXIgPSB0aGlzLCBkaXNwb3NhYmxlID0gbmV3IFNpbmdsZUFzc2lnbm1lbnREaXNwb3NhYmxlKCk7XG4gICAgICB2YXIgaWQgPSBzY2hlZHVsZU1ldGhvZChmdW5jdGlvbiAoKSB7XG4gICAgICAgICFkaXNwb3NhYmxlLmlzRGlzcG9zZWQgJiYgZGlzcG9zYWJsZS5zZXREaXNwb3NhYmxlKGRpc3Bvc2FibGVGaXh1cChhY3Rpb24oc2NoZWR1bGVyLCBzdGF0ZSkpKTtcbiAgICAgIH0pO1xuICAgICAgcmV0dXJuIG5ldyBCaW5hcnlEaXNwb3NhYmxlKGRpc3Bvc2FibGUsIG5ldyBEZWZhdWx0U2NoZWR1bGVyRGlzcG9zYWJsZShpZCkpO1xuICAgIH07XG5cbiAgICBEZWZhdWx0U2NoZWR1bGVyLnByb3RvdHlwZS5fc2NoZWR1bGVGdXR1cmUgPSBmdW5jdGlvbiAoc3RhdGUsIGR1ZVRpbWUsIGFjdGlvbikge1xuICAgICAgdmFyIHNjaGVkdWxlciA9IHRoaXMsIGR0ID0gU2NoZWR1bGVyLm5vcm1hbGl6ZShkdWVUaW1lKSwgZGlzcG9zYWJsZSA9IG5ldyBTaW5nbGVBc3NpZ25tZW50RGlzcG9zYWJsZSgpO1xuICAgICAgaWYgKGR0ID09PSAwKSB7IHJldHVybiBzY2hlZHVsZXIuc2NoZWR1bGUoc3RhdGUsIGFjdGlvbik7IH1cbiAgICAgIHZhciBpZCA9IGxvY2FsU2V0VGltZW91dChmdW5jdGlvbiAoKSB7XG4gICAgICAgICFkaXNwb3NhYmxlLmlzRGlzcG9zZWQgJiYgZGlzcG9zYWJsZS5zZXREaXNwb3NhYmxlKGRpc3Bvc2FibGVGaXh1cChhY3Rpb24oc2NoZWR1bGVyLCBzdGF0ZSkpKTtcbiAgICAgIH0sIGR0KTtcbiAgICAgIHJldHVybiBuZXcgQmluYXJ5RGlzcG9zYWJsZShkaXNwb3NhYmxlLCBuZXcgRGVmYXVsdFNjaGVkdWxlckRpc3Bvc2FibGUoaWQpKTtcbiAgICB9O1xuXG4gICAgcmV0dXJuIERlZmF1bHRTY2hlZHVsZXI7XG4gIH0oU2NoZWR1bGVyKSk7XG5cbiAgdmFyIGRlZmF1bHRTY2hlZHVsZXIgPSBTY2hlZHVsZXJbJ2RlZmF1bHQnXSA9IFNjaGVkdWxlci5hc3luYyA9IG5ldyBEZWZhdWx0U2NoZWR1bGVyKCk7XG5cbiAgdmFyIENhdGNoU2NoZWR1bGVyID0gKGZ1bmN0aW9uIChfX3N1cGVyX18pIHtcbiAgICBpbmhlcml0cyhDYXRjaFNjaGVkdWxlciwgX19zdXBlcl9fKTtcblxuICAgIGZ1bmN0aW9uIENhdGNoU2NoZWR1bGVyKHNjaGVkdWxlciwgaGFuZGxlcikge1xuICAgICAgdGhpcy5fc2NoZWR1bGVyID0gc2NoZWR1bGVyO1xuICAgICAgdGhpcy5faGFuZGxlciA9IGhhbmRsZXI7XG4gICAgICB0aGlzLl9yZWN1cnNpdmVPcmlnaW5hbCA9IG51bGw7XG4gICAgICB0aGlzLl9yZWN1cnNpdmVXcmFwcGVyID0gbnVsbDtcbiAgICAgIF9fc3VwZXJfXy5jYWxsKHRoaXMpO1xuICAgIH1cblxuICAgIENhdGNoU2NoZWR1bGVyLnByb3RvdHlwZS5zY2hlZHVsZSA9IGZ1bmN0aW9uIChzdGF0ZSwgYWN0aW9uKSB7XG4gICAgICByZXR1cm4gdGhpcy5fc2NoZWR1bGVyLnNjaGVkdWxlKHN0YXRlLCB0aGlzLl93cmFwKGFjdGlvbikpO1xuICAgIH07XG5cbiAgICBDYXRjaFNjaGVkdWxlci5wcm90b3R5cGUuX3NjaGVkdWxlRnV0dXJlID0gZnVuY3Rpb24gKHN0YXRlLCBkdWVUaW1lLCBhY3Rpb24pIHtcbiAgICAgIHJldHVybiB0aGlzLl9zY2hlZHVsZXIuc2NoZWR1bGUoc3RhdGUsIGR1ZVRpbWUsIHRoaXMuX3dyYXAoYWN0aW9uKSk7XG4gICAgfTtcblxuICAgIENhdGNoU2NoZWR1bGVyLnByb3RvdHlwZS5ub3cgPSBmdW5jdGlvbiAoKSB7IHJldHVybiB0aGlzLl9zY2hlZHVsZXIubm93KCk7IH07XG5cbiAgICBDYXRjaFNjaGVkdWxlci5wcm90b3R5cGUuX2Nsb25lID0gZnVuY3Rpb24gKHNjaGVkdWxlcikge1xuICAgICAgICByZXR1cm4gbmV3IENhdGNoU2NoZWR1bGVyKHNjaGVkdWxlciwgdGhpcy5faGFuZGxlcik7XG4gICAgfTtcblxuICAgIENhdGNoU2NoZWR1bGVyLnByb3RvdHlwZS5fd3JhcCA9IGZ1bmN0aW9uIChhY3Rpb24pIHtcbiAgICAgIHZhciBwYXJlbnQgPSB0aGlzO1xuICAgICAgcmV0dXJuIGZ1bmN0aW9uIChzZWxmLCBzdGF0ZSkge1xuICAgICAgICB2YXIgcmVzID0gdHJ5Q2F0Y2goYWN0aW9uKShwYXJlbnQuX2dldFJlY3Vyc2l2ZVdyYXBwZXIoc2VsZiksIHN0YXRlKTtcbiAgICAgICAgaWYgKHJlcyA9PT0gZXJyb3JPYmopIHtcbiAgICAgICAgICBpZiAoIXBhcmVudC5faGFuZGxlcihyZXMuZSkpIHsgdGhyb3dlcihyZXMuZSk7IH1cbiAgICAgICAgICByZXR1cm4gZGlzcG9zYWJsZUVtcHR5O1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBkaXNwb3NhYmxlRml4dXAocmV0KTtcbiAgICAgIH07XG4gICAgfTtcblxuICAgIENhdGNoU2NoZWR1bGVyLnByb3RvdHlwZS5fZ2V0UmVjdXJzaXZlV3JhcHBlciA9IGZ1bmN0aW9uIChzY2hlZHVsZXIpIHtcbiAgICAgIGlmICh0aGlzLl9yZWN1cnNpdmVPcmlnaW5hbCAhPT0gc2NoZWR1bGVyKSB7XG4gICAgICAgIHRoaXMuX3JlY3Vyc2l2ZU9yaWdpbmFsID0gc2NoZWR1bGVyO1xuICAgICAgICB2YXIgd3JhcHBlciA9IHRoaXMuX2Nsb25lKHNjaGVkdWxlcik7XG4gICAgICAgIHdyYXBwZXIuX3JlY3Vyc2l2ZU9yaWdpbmFsID0gc2NoZWR1bGVyO1xuICAgICAgICB3cmFwcGVyLl9yZWN1cnNpdmVXcmFwcGVyID0gd3JhcHBlcjtcbiAgICAgICAgdGhpcy5fcmVjdXJzaXZlV3JhcHBlciA9IHdyYXBwZXI7XG4gICAgICB9XG4gICAgICByZXR1cm4gdGhpcy5fcmVjdXJzaXZlV3JhcHBlcjtcbiAgICB9O1xuXG4gICAgQ2F0Y2hTY2hlZHVsZXIucHJvdG90eXBlLnNjaGVkdWxlUGVyaW9kaWMgPSBmdW5jdGlvbiAoc3RhdGUsIHBlcmlvZCwgYWN0aW9uKSB7XG4gICAgICB2YXIgc2VsZiA9IHRoaXMsIGZhaWxlZCA9IGZhbHNlLCBkID0gbmV3IFNpbmdsZUFzc2lnbm1lbnREaXNwb3NhYmxlKCk7XG5cbiAgICAgIGQuc2V0RGlzcG9zYWJsZSh0aGlzLl9zY2hlZHVsZXIuc2NoZWR1bGVQZXJpb2RpYyhzdGF0ZSwgcGVyaW9kLCBmdW5jdGlvbiAoc3RhdGUxKSB7XG4gICAgICAgIGlmIChmYWlsZWQpIHsgcmV0dXJuIG51bGw7IH1cbiAgICAgICAgdmFyIHJlcyA9IHRyeUNhdGNoKGFjdGlvbikoc3RhdGUxKTtcbiAgICAgICAgaWYgKHJlcyA9PT0gZXJyb3JPYmopIHtcbiAgICAgICAgICBmYWlsZWQgPSB0cnVlO1xuICAgICAgICAgIGlmICghc2VsZi5faGFuZGxlcihyZXMuZSkpIHsgdGhyb3dlcihyZXMuZSk7IH1cbiAgICAgICAgICBkLmRpc3Bvc2UoKTtcbiAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gcmV0O1xuICAgICAgfSkpO1xuXG4gICAgICByZXR1cm4gZDtcbiAgICB9O1xuXG4gICAgcmV0dXJuIENhdGNoU2NoZWR1bGVyO1xuICB9KFNjaGVkdWxlcikpO1xuXG4gIC8qKlxuICAgKiAgUmVwcmVzZW50cyBhIG5vdGlmaWNhdGlvbiB0byBhbiBvYnNlcnZlci5cbiAgICovXG4gIHZhciBOb3RpZmljYXRpb24gPSBSeC5Ob3RpZmljYXRpb24gPSAoZnVuY3Rpb24gKCkge1xuICAgIGZ1bmN0aW9uIE5vdGlmaWNhdGlvbigpIHtcblxuICAgIH1cblxuICAgIE5vdGlmaWNhdGlvbi5wcm90b3R5cGUuX2FjY2VwdCA9IGZ1bmN0aW9uIChvbk5leHQsIG9uRXJyb3IsIG9uQ29tcGxldGVkKSB7XG4gICAgICB0aHJvdyBuZXcgTm90SW1wbGVtZW50ZWRFcnJvcigpO1xuICAgIH07XG5cbiAgICBOb3RpZmljYXRpb24ucHJvdG90eXBlLl9hY2NlcHRPYnNlcnZhYmxlID0gZnVuY3Rpb24gKG9uTmV4dCwgb25FcnJvciwgb25Db21wbGV0ZWQpIHtcbiAgICAgIHRocm93IG5ldyBOb3RJbXBsZW1lbnRlZEVycm9yKCk7XG4gICAgfTtcblxuICAgIC8qKlxuICAgICAqIEludm9rZXMgdGhlIGRlbGVnYXRlIGNvcnJlc3BvbmRpbmcgdG8gdGhlIG5vdGlmaWNhdGlvbiBvciB0aGUgb2JzZXJ2ZXIncyBtZXRob2QgY29ycmVzcG9uZGluZyB0byB0aGUgbm90aWZpY2F0aW9uIGFuZCByZXR1cm5zIHRoZSBwcm9kdWNlZCByZXN1bHQuXG4gICAgICpcbiAgICAgKiBAbWVtYmVyT2YgTm90aWZpY2F0aW9uXG4gICAgICogQHBhcmFtIHtBbnl9IG9ic2VydmVyT3JPbk5leHQgRGVsZWdhdGUgdG8gaW52b2tlIGZvciBhbiBPbk5leHQgbm90aWZpY2F0aW9uIG9yIE9ic2VydmVyIHRvIGludm9rZSB0aGUgbm90aWZpY2F0aW9uIG9uLi5cbiAgICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBvbkVycm9yIERlbGVnYXRlIHRvIGludm9rZSBmb3IgYW4gT25FcnJvciBub3RpZmljYXRpb24uXG4gICAgICogQHBhcmFtIHtGdW5jdGlvbn0gb25Db21wbGV0ZWQgRGVsZWdhdGUgdG8gaW52b2tlIGZvciBhbiBPbkNvbXBsZXRlZCBub3RpZmljYXRpb24uXG4gICAgICogQHJldHVybnMge0FueX0gUmVzdWx0IHByb2R1Y2VkIGJ5IHRoZSBvYnNlcnZhdGlvbi5cbiAgICAgKi9cbiAgICBOb3RpZmljYXRpb24ucHJvdG90eXBlLmFjY2VwdCA9IGZ1bmN0aW9uIChvYnNlcnZlck9yT25OZXh0LCBvbkVycm9yLCBvbkNvbXBsZXRlZCkge1xuICAgICAgcmV0dXJuIG9ic2VydmVyT3JPbk5leHQgJiYgdHlwZW9mIG9ic2VydmVyT3JPbk5leHQgPT09ICdvYmplY3QnID9cbiAgICAgICAgdGhpcy5fYWNjZXB0T2JzZXJ2YWJsZShvYnNlcnZlck9yT25OZXh0KSA6XG4gICAgICAgIHRoaXMuX2FjY2VwdChvYnNlcnZlck9yT25OZXh0LCBvbkVycm9yLCBvbkNvbXBsZXRlZCk7XG4gICAgfTtcblxuICAgIC8qKlxuICAgICAqIFJldHVybnMgYW4gb2JzZXJ2YWJsZSBzZXF1ZW5jZSB3aXRoIGEgc2luZ2xlIG5vdGlmaWNhdGlvbi5cbiAgICAgKlxuICAgICAqIEBtZW1iZXJPZiBOb3RpZmljYXRpb25zXG4gICAgICogQHBhcmFtIHtTY2hlZHVsZXJ9IFtzY2hlZHVsZXJdIFNjaGVkdWxlciB0byBzZW5kIG91dCB0aGUgbm90aWZpY2F0aW9uIGNhbGxzIG9uLlxuICAgICAqIEByZXR1cm5zIHtPYnNlcnZhYmxlfSBUaGUgb2JzZXJ2YWJsZSBzZXF1ZW5jZSB0aGF0IHN1cmZhY2VzIHRoZSBiZWhhdmlvciBvZiB0aGUgbm90aWZpY2F0aW9uIHVwb24gc3Vic2NyaXB0aW9uLlxuICAgICAqL1xuICAgIE5vdGlmaWNhdGlvbi5wcm90b3R5cGUudG9PYnNlcnZhYmxlID0gZnVuY3Rpb24gKHNjaGVkdWxlcikge1xuICAgICAgdmFyIHNlbGYgPSB0aGlzO1xuICAgICAgaXNTY2hlZHVsZXIoc2NoZWR1bGVyKSB8fCAoc2NoZWR1bGVyID0gaW1tZWRpYXRlU2NoZWR1bGVyKTtcbiAgICAgIHJldHVybiBuZXcgQW5vbnltb3VzT2JzZXJ2YWJsZShmdW5jdGlvbiAobykge1xuICAgICAgICByZXR1cm4gc2NoZWR1bGVyLnNjaGVkdWxlKHNlbGYsIGZ1bmN0aW9uIChfLCBub3RpZmljYXRpb24pIHtcbiAgICAgICAgICBub3RpZmljYXRpb24uX2FjY2VwdE9ic2VydmFibGUobyk7XG4gICAgICAgICAgbm90aWZpY2F0aW9uLmtpbmQgPT09ICdOJyAmJiBvLm9uQ29tcGxldGVkKCk7XG4gICAgICAgIH0pO1xuICAgICAgfSk7XG4gICAgfTtcblxuICAgIHJldHVybiBOb3RpZmljYXRpb247XG4gIH0pKCk7XG5cbiAgdmFyIE9uTmV4dE5vdGlmaWNhdGlvbiA9IChmdW5jdGlvbiAoX19zdXBlcl9fKSB7XG4gICAgaW5oZXJpdHMoT25OZXh0Tm90aWZpY2F0aW9uLCBfX3N1cGVyX18pO1xuICAgIGZ1bmN0aW9uIE9uTmV4dE5vdGlmaWNhdGlvbih2YWx1ZSkge1xuICAgICAgdGhpcy52YWx1ZSA9IHZhbHVlO1xuICAgICAgdGhpcy5raW5kID0gJ04nO1xuICAgIH1cblxuICAgIE9uTmV4dE5vdGlmaWNhdGlvbi5wcm90b3R5cGUuX2FjY2VwdCA9IGZ1bmN0aW9uIChvbk5leHQpIHtcbiAgICAgIHJldHVybiBvbk5leHQodGhpcy52YWx1ZSk7XG4gICAgfTtcblxuICAgIE9uTmV4dE5vdGlmaWNhdGlvbi5wcm90b3R5cGUuX2FjY2VwdE9ic2VydmFibGUgPSBmdW5jdGlvbiAobykge1xuICAgICAgcmV0dXJuIG8ub25OZXh0KHRoaXMudmFsdWUpO1xuICAgIH07XG5cbiAgICBPbk5leHROb3RpZmljYXRpb24ucHJvdG90eXBlLnRvU3RyaW5nID0gZnVuY3Rpb24gKCkge1xuICAgICAgcmV0dXJuICdPbk5leHQoJyArIHRoaXMudmFsdWUgKyAnKSc7XG4gICAgfTtcblxuICAgIHJldHVybiBPbk5leHROb3RpZmljYXRpb247XG4gIH0oTm90aWZpY2F0aW9uKSk7XG5cbiAgdmFyIE9uRXJyb3JOb3RpZmljYXRpb24gPSAoZnVuY3Rpb24gKF9fc3VwZXJfXykge1xuICAgIGluaGVyaXRzKE9uRXJyb3JOb3RpZmljYXRpb24sIF9fc3VwZXJfXyk7XG4gICAgZnVuY3Rpb24gT25FcnJvck5vdGlmaWNhdGlvbihlcnJvcikge1xuICAgICAgdGhpcy5lcnJvciA9IGVycm9yO1xuICAgICAgdGhpcy5raW5kID0gJ0UnO1xuICAgIH1cblxuICAgIE9uRXJyb3JOb3RpZmljYXRpb24ucHJvdG90eXBlLl9hY2NlcHQgPSBmdW5jdGlvbiAob25OZXh0LCBvbkVycm9yKSB7XG4gICAgICByZXR1cm4gb25FcnJvcih0aGlzLmVycm9yKTtcbiAgICB9O1xuXG4gICAgT25FcnJvck5vdGlmaWNhdGlvbi5wcm90b3R5cGUuX2FjY2VwdE9ic2VydmFibGUgPSBmdW5jdGlvbiAobykge1xuICAgICAgcmV0dXJuIG8ub25FcnJvcih0aGlzLmVycm9yKTtcbiAgICB9O1xuXG4gICAgT25FcnJvck5vdGlmaWNhdGlvbi5wcm90b3R5cGUudG9TdHJpbmcgPSBmdW5jdGlvbiAoKSB7XG4gICAgICByZXR1cm4gJ09uRXJyb3IoJyArIHRoaXMuZXJyb3IgKyAnKSc7XG4gICAgfTtcblxuICAgIHJldHVybiBPbkVycm9yTm90aWZpY2F0aW9uO1xuICB9KE5vdGlmaWNhdGlvbikpO1xuXG4gIHZhciBPbkNvbXBsZXRlZE5vdGlmaWNhdGlvbiA9IChmdW5jdGlvbiAoX19zdXBlcl9fKSB7XG4gICAgaW5oZXJpdHMoT25Db21wbGV0ZWROb3RpZmljYXRpb24sIF9fc3VwZXJfXyk7XG4gICAgZnVuY3Rpb24gT25Db21wbGV0ZWROb3RpZmljYXRpb24oKSB7XG4gICAgICB0aGlzLmtpbmQgPSAnQyc7XG4gICAgfVxuXG4gICAgT25Db21wbGV0ZWROb3RpZmljYXRpb24ucHJvdG90eXBlLl9hY2NlcHQgPSBmdW5jdGlvbiAob25OZXh0LCBvbkVycm9yLCBvbkNvbXBsZXRlZCkge1xuICAgICAgcmV0dXJuIG9uQ29tcGxldGVkKCk7XG4gICAgfTtcblxuICAgIE9uQ29tcGxldGVkTm90aWZpY2F0aW9uLnByb3RvdHlwZS5fYWNjZXB0T2JzZXJ2YWJsZSA9IGZ1bmN0aW9uIChvKSB7XG4gICAgICByZXR1cm4gby5vbkNvbXBsZXRlZCgpO1xuICAgIH07XG5cbiAgICBPbkNvbXBsZXRlZE5vdGlmaWNhdGlvbi5wcm90b3R5cGUudG9TdHJpbmcgPSBmdW5jdGlvbiAoKSB7XG4gICAgICByZXR1cm4gJ09uQ29tcGxldGVkKCknO1xuICAgIH07XG5cbiAgICByZXR1cm4gT25Db21wbGV0ZWROb3RpZmljYXRpb247XG4gIH0oTm90aWZpY2F0aW9uKSk7XG5cbiAgLyoqXG4gICAqIENyZWF0ZXMgYW4gb2JqZWN0IHRoYXQgcmVwcmVzZW50cyBhbiBPbk5leHQgbm90aWZpY2F0aW9uIHRvIGFuIG9ic2VydmVyLlxuICAgKiBAcGFyYW0ge0FueX0gdmFsdWUgVGhlIHZhbHVlIGNvbnRhaW5lZCBpbiB0aGUgbm90aWZpY2F0aW9uLlxuICAgKiBAcmV0dXJucyB7Tm90aWZpY2F0aW9ufSBUaGUgT25OZXh0IG5vdGlmaWNhdGlvbiBjb250YWluaW5nIHRoZSB2YWx1ZS5cbiAgICovXG4gIHZhciBub3RpZmljYXRpb25DcmVhdGVPbk5leHQgPSBOb3RpZmljYXRpb24uY3JlYXRlT25OZXh0ID0gZnVuY3Rpb24gKHZhbHVlKSB7XG4gICAgcmV0dXJuIG5ldyBPbk5leHROb3RpZmljYXRpb24odmFsdWUpO1xuICB9O1xuXG4gIC8qKlxuICAgKiBDcmVhdGVzIGFuIG9iamVjdCB0aGF0IHJlcHJlc2VudHMgYW4gT25FcnJvciBub3RpZmljYXRpb24gdG8gYW4gb2JzZXJ2ZXIuXG4gICAqIEBwYXJhbSB7QW55fSBlcnJvciBUaGUgZXhjZXB0aW9uIGNvbnRhaW5lZCBpbiB0aGUgbm90aWZpY2F0aW9uLlxuICAgKiBAcmV0dXJucyB7Tm90aWZpY2F0aW9ufSBUaGUgT25FcnJvciBub3RpZmljYXRpb24gY29udGFpbmluZyB0aGUgZXhjZXB0aW9uLlxuICAgKi9cbiAgdmFyIG5vdGlmaWNhdGlvbkNyZWF0ZU9uRXJyb3IgPSBOb3RpZmljYXRpb24uY3JlYXRlT25FcnJvciA9IGZ1bmN0aW9uIChlcnJvcikge1xuICAgIHJldHVybiBuZXcgT25FcnJvck5vdGlmaWNhdGlvbihlcnJvcik7XG4gIH07XG5cbiAgLyoqXG4gICAqIENyZWF0ZXMgYW4gb2JqZWN0IHRoYXQgcmVwcmVzZW50cyBhbiBPbkNvbXBsZXRlZCBub3RpZmljYXRpb24gdG8gYW4gb2JzZXJ2ZXIuXG4gICAqIEByZXR1cm5zIHtOb3RpZmljYXRpb259IFRoZSBPbkNvbXBsZXRlZCBub3RpZmljYXRpb24uXG4gICAqL1xuICB2YXIgbm90aWZpY2F0aW9uQ3JlYXRlT25Db21wbGV0ZWQgPSBOb3RpZmljYXRpb24uY3JlYXRlT25Db21wbGV0ZWQgPSBmdW5jdGlvbiAoKSB7XG4gICAgcmV0dXJuIG5ldyBPbkNvbXBsZXRlZE5vdGlmaWNhdGlvbigpO1xuICB9O1xuXG4gIC8qKlxuICAgKiBTdXBwb3J0cyBwdXNoLXN0eWxlIGl0ZXJhdGlvbiBvdmVyIGFuIG9ic2VydmFibGUgc2VxdWVuY2UuXG4gICAqL1xuICB2YXIgT2JzZXJ2ZXIgPSBSeC5PYnNlcnZlciA9IGZ1bmN0aW9uICgpIHsgfTtcblxuICAvKipcbiAgICogIENyZWF0ZXMgYSBub3RpZmljYXRpb24gY2FsbGJhY2sgZnJvbSBhbiBvYnNlcnZlci5cbiAgICogQHJldHVybnMgVGhlIGFjdGlvbiB0aGF0IGZvcndhcmRzIGl0cyBpbnB1dCBub3RpZmljYXRpb24gdG8gdGhlIHVuZGVybHlpbmcgb2JzZXJ2ZXIuXG4gICAqL1xuICBPYnNlcnZlci5wcm90b3R5cGUudG9Ob3RpZmllciA9IGZ1bmN0aW9uICgpIHtcbiAgICB2YXIgb2JzZXJ2ZXIgPSB0aGlzO1xuICAgIHJldHVybiBmdW5jdGlvbiAobikgeyByZXR1cm4gbi5hY2NlcHQob2JzZXJ2ZXIpOyB9O1xuICB9O1xuXG4gIC8qKlxuICAgKiAgSGlkZXMgdGhlIGlkZW50aXR5IG9mIGFuIG9ic2VydmVyLlxuICAgKiBAcmV0dXJucyBBbiBvYnNlcnZlciB0aGF0IGhpZGVzIHRoZSBpZGVudGl0eSBvZiB0aGUgc3BlY2lmaWVkIG9ic2VydmVyLlxuICAgKi9cbiAgT2JzZXJ2ZXIucHJvdG90eXBlLmFzT2JzZXJ2ZXIgPSBmdW5jdGlvbiAoKSB7XG4gICAgdmFyIHNlbGYgPSB0aGlzO1xuICAgIHJldHVybiBuZXcgQW5vbnltb3VzT2JzZXJ2ZXIoXG4gICAgICBmdW5jdGlvbiAoeCkgeyBzZWxmLm9uTmV4dCh4KTsgfSxcbiAgICAgIGZ1bmN0aW9uIChlcnIpIHsgc2VsZi5vbkVycm9yKGVycik7IH0sXG4gICAgICBmdW5jdGlvbiAoKSB7IHNlbGYub25Db21wbGV0ZWQoKTsgfSk7XG4gIH07XG5cbiAgLyoqXG4gICAqICBDaGVja3MgYWNjZXNzIHRvIHRoZSBvYnNlcnZlciBmb3IgZ3JhbW1hciB2aW9sYXRpb25zLiBUaGlzIGluY2x1ZGVzIGNoZWNraW5nIGZvciBtdWx0aXBsZSBPbkVycm9yIG9yIE9uQ29tcGxldGVkIGNhbGxzLCBhcyB3ZWxsIGFzIHJlZW50cmFuY3kgaW4gYW55IG9mIHRoZSBvYnNlcnZlciBtZXRob2RzLlxuICAgKiAgSWYgYSB2aW9sYXRpb24gaXMgZGV0ZWN0ZWQsIGFuIEVycm9yIGlzIHRocm93biBmcm9tIHRoZSBvZmZlbmRpbmcgb2JzZXJ2ZXIgbWV0aG9kIGNhbGwuXG4gICAqIEByZXR1cm5zIEFuIG9ic2VydmVyIHRoYXQgY2hlY2tzIGNhbGxiYWNrcyBpbnZvY2F0aW9ucyBhZ2FpbnN0IHRoZSBvYnNlcnZlciBncmFtbWFyIGFuZCwgaWYgdGhlIGNoZWNrcyBwYXNzLCBmb3J3YXJkcyB0aG9zZSB0byB0aGUgc3BlY2lmaWVkIG9ic2VydmVyLlxuICAgKi9cbiAgT2JzZXJ2ZXIucHJvdG90eXBlLmNoZWNrZWQgPSBmdW5jdGlvbiAoKSB7IHJldHVybiBuZXcgQ2hlY2tlZE9ic2VydmVyKHRoaXMpOyB9O1xuXG4gIC8qKlxuICAgKiAgQ3JlYXRlcyBhbiBvYnNlcnZlciBmcm9tIHRoZSBzcGVjaWZpZWQgT25OZXh0LCBhbG9uZyB3aXRoIG9wdGlvbmFsIE9uRXJyb3IsIGFuZCBPbkNvbXBsZXRlZCBhY3Rpb25zLlxuICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBbb25OZXh0XSBPYnNlcnZlcidzIE9uTmV4dCBhY3Rpb24gaW1wbGVtZW50YXRpb24uXG4gICAqIEBwYXJhbSB7RnVuY3Rpb259IFtvbkVycm9yXSBPYnNlcnZlcidzIE9uRXJyb3IgYWN0aW9uIGltcGxlbWVudGF0aW9uLlxuICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBbb25Db21wbGV0ZWRdIE9ic2VydmVyJ3MgT25Db21wbGV0ZWQgYWN0aW9uIGltcGxlbWVudGF0aW9uLlxuICAgKiBAcmV0dXJucyB7T2JzZXJ2ZXJ9IFRoZSBvYnNlcnZlciBvYmplY3QgaW1wbGVtZW50ZWQgdXNpbmcgdGhlIGdpdmVuIGFjdGlvbnMuXG4gICAqL1xuICB2YXIgb2JzZXJ2ZXJDcmVhdGUgPSBPYnNlcnZlci5jcmVhdGUgPSBmdW5jdGlvbiAob25OZXh0LCBvbkVycm9yLCBvbkNvbXBsZXRlZCkge1xuICAgIG9uTmV4dCB8fCAob25OZXh0ID0gbm9vcCk7XG4gICAgb25FcnJvciB8fCAob25FcnJvciA9IGRlZmF1bHRFcnJvcik7XG4gICAgb25Db21wbGV0ZWQgfHwgKG9uQ29tcGxldGVkID0gbm9vcCk7XG4gICAgcmV0dXJuIG5ldyBBbm9ueW1vdXNPYnNlcnZlcihvbk5leHQsIG9uRXJyb3IsIG9uQ29tcGxldGVkKTtcbiAgfTtcblxuICAvKipcbiAgICogIENyZWF0ZXMgYW4gb2JzZXJ2ZXIgZnJvbSBhIG5vdGlmaWNhdGlvbiBjYWxsYmFjay5cbiAgICogQHBhcmFtIHtGdW5jdGlvbn0gaGFuZGxlciBBY3Rpb24gdGhhdCBoYW5kbGVzIGEgbm90aWZpY2F0aW9uLlxuICAgKiBAcmV0dXJucyBUaGUgb2JzZXJ2ZXIgb2JqZWN0IHRoYXQgaW52b2tlcyB0aGUgc3BlY2lmaWVkIGhhbmRsZXIgdXNpbmcgYSBub3RpZmljYXRpb24gY29ycmVzcG9uZGluZyB0byBlYWNoIG1lc3NhZ2UgaXQgcmVjZWl2ZXMuXG4gICAqL1xuICBPYnNlcnZlci5mcm9tTm90aWZpZXIgPSBmdW5jdGlvbiAoaGFuZGxlciwgdGhpc0FyZykge1xuICAgIHZhciBjYiA9IGJpbmRDYWxsYmFjayhoYW5kbGVyLCB0aGlzQXJnLCAxKTtcbiAgICByZXR1cm4gbmV3IEFub255bW91c09ic2VydmVyKGZ1bmN0aW9uICh4KSB7XG4gICAgICByZXR1cm4gY2Iobm90aWZpY2F0aW9uQ3JlYXRlT25OZXh0KHgpKTtcbiAgICB9LCBmdW5jdGlvbiAoZSkge1xuICAgICAgcmV0dXJuIGNiKG5vdGlmaWNhdGlvbkNyZWF0ZU9uRXJyb3IoZSkpO1xuICAgIH0sIGZ1bmN0aW9uICgpIHtcbiAgICAgIHJldHVybiBjYihub3RpZmljYXRpb25DcmVhdGVPbkNvbXBsZXRlZCgpKTtcbiAgICB9KTtcbiAgfTtcblxuICAvKipcbiAgICogU2NoZWR1bGVzIHRoZSBpbnZvY2F0aW9uIG9mIG9ic2VydmVyIG1ldGhvZHMgb24gdGhlIGdpdmVuIHNjaGVkdWxlci5cbiAgICogQHBhcmFtIHtTY2hlZHVsZXJ9IHNjaGVkdWxlciBTY2hlZHVsZXIgdG8gc2NoZWR1bGUgb2JzZXJ2ZXIgbWVzc2FnZXMgb24uXG4gICAqIEByZXR1cm5zIHtPYnNlcnZlcn0gT2JzZXJ2ZXIgd2hvc2UgbWVzc2FnZXMgYXJlIHNjaGVkdWxlZCBvbiB0aGUgZ2l2ZW4gc2NoZWR1bGVyLlxuICAgKi9cbiAgT2JzZXJ2ZXIucHJvdG90eXBlLm5vdGlmeU9uID0gZnVuY3Rpb24gKHNjaGVkdWxlcikge1xuICAgIHJldHVybiBuZXcgT2JzZXJ2ZU9uT2JzZXJ2ZXIoc2NoZWR1bGVyLCB0aGlzKTtcbiAgfTtcblxuICBPYnNlcnZlci5wcm90b3R5cGUubWFrZVNhZmUgPSBmdW5jdGlvbihkaXNwb3NhYmxlKSB7XG4gICAgcmV0dXJuIG5ldyBBbm9ueW1vdXNTYWZlT2JzZXJ2ZXIodGhpcy5fb25OZXh0LCB0aGlzLl9vbkVycm9yLCB0aGlzLl9vbkNvbXBsZXRlZCwgZGlzcG9zYWJsZSk7XG4gIH07XG5cbiAgLyoqXG4gICAqIEFic3RyYWN0IGJhc2UgY2xhc3MgZm9yIGltcGxlbWVudGF0aW9ucyBvZiB0aGUgT2JzZXJ2ZXIgY2xhc3MuXG4gICAqIFRoaXMgYmFzZSBjbGFzcyBlbmZvcmNlcyB0aGUgZ3JhbW1hciBvZiBvYnNlcnZlcnMgd2hlcmUgT25FcnJvciBhbmQgT25Db21wbGV0ZWQgYXJlIHRlcm1pbmFsIG1lc3NhZ2VzLlxuICAgKi9cbiAgdmFyIEFic3RyYWN0T2JzZXJ2ZXIgPSBSeC5pbnRlcm5hbHMuQWJzdHJhY3RPYnNlcnZlciA9IChmdW5jdGlvbiAoX19zdXBlcl9fKSB7XG4gICAgaW5oZXJpdHMoQWJzdHJhY3RPYnNlcnZlciwgX19zdXBlcl9fKTtcblxuICAgIC8qKlxuICAgICAqIENyZWF0ZXMgYSBuZXcgb2JzZXJ2ZXIgaW4gYSBub24tc3RvcHBlZCBzdGF0ZS5cbiAgICAgKi9cbiAgICBmdW5jdGlvbiBBYnN0cmFjdE9ic2VydmVyKCkge1xuICAgICAgdGhpcy5pc1N0b3BwZWQgPSBmYWxzZTtcbiAgICB9XG5cbiAgICAvLyBNdXN0IGJlIGltcGxlbWVudGVkIGJ5IG90aGVyIG9ic2VydmVyc1xuICAgIEFic3RyYWN0T2JzZXJ2ZXIucHJvdG90eXBlLm5leHQgPSBub3RJbXBsZW1lbnRlZDtcbiAgICBBYnN0cmFjdE9ic2VydmVyLnByb3RvdHlwZS5lcnJvciA9IG5vdEltcGxlbWVudGVkO1xuICAgIEFic3RyYWN0T2JzZXJ2ZXIucHJvdG90eXBlLmNvbXBsZXRlZCA9IG5vdEltcGxlbWVudGVkO1xuXG4gICAgLyoqXG4gICAgICogTm90aWZpZXMgdGhlIG9ic2VydmVyIG9mIGEgbmV3IGVsZW1lbnQgaW4gdGhlIHNlcXVlbmNlLlxuICAgICAqIEBwYXJhbSB7QW55fSB2YWx1ZSBOZXh0IGVsZW1lbnQgaW4gdGhlIHNlcXVlbmNlLlxuICAgICAqL1xuICAgIEFic3RyYWN0T2JzZXJ2ZXIucHJvdG90eXBlLm9uTmV4dCA9IGZ1bmN0aW9uICh2YWx1ZSkge1xuICAgICAgIXRoaXMuaXNTdG9wcGVkICYmIHRoaXMubmV4dCh2YWx1ZSk7XG4gICAgfTtcblxuICAgIC8qKlxuICAgICAqIE5vdGlmaWVzIHRoZSBvYnNlcnZlciB0aGF0IGFuIGV4Y2VwdGlvbiBoYXMgb2NjdXJyZWQuXG4gICAgICogQHBhcmFtIHtBbnl9IGVycm9yIFRoZSBlcnJvciB0aGF0IGhhcyBvY2N1cnJlZC5cbiAgICAgKi9cbiAgICBBYnN0cmFjdE9ic2VydmVyLnByb3RvdHlwZS5vbkVycm9yID0gZnVuY3Rpb24gKGVycm9yKSB7XG4gICAgICBpZiAoIXRoaXMuaXNTdG9wcGVkKSB7XG4gICAgICAgIHRoaXMuaXNTdG9wcGVkID0gdHJ1ZTtcbiAgICAgICAgdGhpcy5lcnJvcihlcnJvcik7XG4gICAgICB9XG4gICAgfTtcblxuICAgIC8qKlxuICAgICAqIE5vdGlmaWVzIHRoZSBvYnNlcnZlciBvZiB0aGUgZW5kIG9mIHRoZSBzZXF1ZW5jZS5cbiAgICAgKi9cbiAgICBBYnN0cmFjdE9ic2VydmVyLnByb3RvdHlwZS5vbkNvbXBsZXRlZCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgIGlmICghdGhpcy5pc1N0b3BwZWQpIHtcbiAgICAgICAgdGhpcy5pc1N0b3BwZWQgPSB0cnVlO1xuICAgICAgICB0aGlzLmNvbXBsZXRlZCgpO1xuICAgICAgfVxuICAgIH07XG5cbiAgICAvKipcbiAgICAgKiBEaXNwb3NlcyB0aGUgb2JzZXJ2ZXIsIGNhdXNpbmcgaXQgdG8gdHJhbnNpdGlvbiB0byB0aGUgc3RvcHBlZCBzdGF0ZS5cbiAgICAgKi9cbiAgICBBYnN0cmFjdE9ic2VydmVyLnByb3RvdHlwZS5kaXNwb3NlID0gZnVuY3Rpb24gKCkgeyB0aGlzLmlzU3RvcHBlZCA9IHRydWU7IH07XG5cbiAgICBBYnN0cmFjdE9ic2VydmVyLnByb3RvdHlwZS5mYWlsID0gZnVuY3Rpb24gKGUpIHtcbiAgICAgIGlmICghdGhpcy5pc1N0b3BwZWQpIHtcbiAgICAgICAgdGhpcy5pc1N0b3BwZWQgPSB0cnVlO1xuICAgICAgICB0aGlzLmVycm9yKGUpO1xuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgIH1cblxuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH07XG5cbiAgICByZXR1cm4gQWJzdHJhY3RPYnNlcnZlcjtcbiAgfShPYnNlcnZlcikpO1xuXG4gIC8qKlxuICAgKiBDbGFzcyB0byBjcmVhdGUgYW4gT2JzZXJ2ZXIgaW5zdGFuY2UgZnJvbSBkZWxlZ2F0ZS1iYXNlZCBpbXBsZW1lbnRhdGlvbnMgb2YgdGhlIG9uKiBtZXRob2RzLlxuICAgKi9cbiAgdmFyIEFub255bW91c09ic2VydmVyID0gUnguQW5vbnltb3VzT2JzZXJ2ZXIgPSAoZnVuY3Rpb24gKF9fc3VwZXJfXykge1xuICAgIGluaGVyaXRzKEFub255bW91c09ic2VydmVyLCBfX3N1cGVyX18pO1xuXG4gICAgLyoqXG4gICAgICogQ3JlYXRlcyBhbiBvYnNlcnZlciBmcm9tIHRoZSBzcGVjaWZpZWQgT25OZXh0LCBPbkVycm9yLCBhbmQgT25Db21wbGV0ZWQgYWN0aW9ucy5cbiAgICAgKiBAcGFyYW0ge0FueX0gb25OZXh0IE9ic2VydmVyJ3MgT25OZXh0IGFjdGlvbiBpbXBsZW1lbnRhdGlvbi5cbiAgICAgKiBAcGFyYW0ge0FueX0gb25FcnJvciBPYnNlcnZlcidzIE9uRXJyb3IgYWN0aW9uIGltcGxlbWVudGF0aW9uLlxuICAgICAqIEBwYXJhbSB7QW55fSBvbkNvbXBsZXRlZCBPYnNlcnZlcidzIE9uQ29tcGxldGVkIGFjdGlvbiBpbXBsZW1lbnRhdGlvbi5cbiAgICAgKi9cbiAgICBmdW5jdGlvbiBBbm9ueW1vdXNPYnNlcnZlcihvbk5leHQsIG9uRXJyb3IsIG9uQ29tcGxldGVkKSB7XG4gICAgICBfX3N1cGVyX18uY2FsbCh0aGlzKTtcbiAgICAgIHRoaXMuX29uTmV4dCA9IG9uTmV4dDtcbiAgICAgIHRoaXMuX29uRXJyb3IgPSBvbkVycm9yO1xuICAgICAgdGhpcy5fb25Db21wbGV0ZWQgPSBvbkNvbXBsZXRlZDtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBDYWxscyB0aGUgb25OZXh0IGFjdGlvbi5cbiAgICAgKiBAcGFyYW0ge0FueX0gdmFsdWUgTmV4dCBlbGVtZW50IGluIHRoZSBzZXF1ZW5jZS5cbiAgICAgKi9cbiAgICBBbm9ueW1vdXNPYnNlcnZlci5wcm90b3R5cGUubmV4dCA9IGZ1bmN0aW9uICh2YWx1ZSkge1xuICAgICAgdGhpcy5fb25OZXh0KHZhbHVlKTtcbiAgICB9O1xuXG4gICAgLyoqXG4gICAgICogQ2FsbHMgdGhlIG9uRXJyb3IgYWN0aW9uLlxuICAgICAqIEBwYXJhbSB7QW55fSBlcnJvciBUaGUgZXJyb3IgdGhhdCBoYXMgb2NjdXJyZWQuXG4gICAgICovXG4gICAgQW5vbnltb3VzT2JzZXJ2ZXIucHJvdG90eXBlLmVycm9yID0gZnVuY3Rpb24gKGVycm9yKSB7XG4gICAgICB0aGlzLl9vbkVycm9yKGVycm9yKTtcbiAgICB9O1xuXG4gICAgLyoqXG4gICAgICogIENhbGxzIHRoZSBvbkNvbXBsZXRlZCBhY3Rpb24uXG4gICAgICovXG4gICAgQW5vbnltb3VzT2JzZXJ2ZXIucHJvdG90eXBlLmNvbXBsZXRlZCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgIHRoaXMuX29uQ29tcGxldGVkKCk7XG4gICAgfTtcblxuICAgIHJldHVybiBBbm9ueW1vdXNPYnNlcnZlcjtcbiAgfShBYnN0cmFjdE9ic2VydmVyKSk7XG5cbiAgdmFyIENoZWNrZWRPYnNlcnZlciA9IChmdW5jdGlvbiAoX19zdXBlcl9fKSB7XG4gICAgaW5oZXJpdHMoQ2hlY2tlZE9ic2VydmVyLCBfX3N1cGVyX18pO1xuXG4gICAgZnVuY3Rpb24gQ2hlY2tlZE9ic2VydmVyKG9ic2VydmVyKSB7XG4gICAgICBfX3N1cGVyX18uY2FsbCh0aGlzKTtcbiAgICAgIHRoaXMuX29ic2VydmVyID0gb2JzZXJ2ZXI7XG4gICAgICB0aGlzLl9zdGF0ZSA9IDA7IC8vIDAgLSBpZGxlLCAxIC0gYnVzeSwgMiAtIGRvbmVcbiAgICB9XG5cbiAgICB2YXIgQ2hlY2tlZE9ic2VydmVyUHJvdG90eXBlID0gQ2hlY2tlZE9ic2VydmVyLnByb3RvdHlwZTtcblxuICAgIENoZWNrZWRPYnNlcnZlclByb3RvdHlwZS5vbk5leHQgPSBmdW5jdGlvbiAodmFsdWUpIHtcbiAgICAgIHRoaXMuY2hlY2tBY2Nlc3MoKTtcbiAgICAgIHZhciByZXMgPSB0cnlDYXRjaCh0aGlzLl9vYnNlcnZlci5vbk5leHQpLmNhbGwodGhpcy5fb2JzZXJ2ZXIsIHZhbHVlKTtcbiAgICAgIHRoaXMuX3N0YXRlID0gMDtcbiAgICAgIHJlcyA9PT0gZXJyb3JPYmogJiYgdGhyb3dlcihyZXMuZSk7XG4gICAgfTtcblxuICAgIENoZWNrZWRPYnNlcnZlclByb3RvdHlwZS5vbkVycm9yID0gZnVuY3Rpb24gKGVycikge1xuICAgICAgdGhpcy5jaGVja0FjY2VzcygpO1xuICAgICAgdmFyIHJlcyA9IHRyeUNhdGNoKHRoaXMuX29ic2VydmVyLm9uRXJyb3IpLmNhbGwodGhpcy5fb2JzZXJ2ZXIsIGVycik7XG4gICAgICB0aGlzLl9zdGF0ZSA9IDI7XG4gICAgICByZXMgPT09IGVycm9yT2JqICYmIHRocm93ZXIocmVzLmUpO1xuICAgIH07XG5cbiAgICBDaGVja2VkT2JzZXJ2ZXJQcm90b3R5cGUub25Db21wbGV0ZWQgPSBmdW5jdGlvbiAoKSB7XG4gICAgICB0aGlzLmNoZWNrQWNjZXNzKCk7XG4gICAgICB2YXIgcmVzID0gdHJ5Q2F0Y2godGhpcy5fb2JzZXJ2ZXIub25Db21wbGV0ZWQpLmNhbGwodGhpcy5fb2JzZXJ2ZXIpO1xuICAgICAgdGhpcy5fc3RhdGUgPSAyO1xuICAgICAgcmVzID09PSBlcnJvck9iaiAmJiB0aHJvd2VyKHJlcy5lKTtcbiAgICB9O1xuXG4gICAgQ2hlY2tlZE9ic2VydmVyUHJvdG90eXBlLmNoZWNrQWNjZXNzID0gZnVuY3Rpb24gKCkge1xuICAgICAgaWYgKHRoaXMuX3N0YXRlID09PSAxKSB7IHRocm93IG5ldyBFcnJvcignUmUtZW50cmFuY3kgZGV0ZWN0ZWQnKTsgfVxuICAgICAgaWYgKHRoaXMuX3N0YXRlID09PSAyKSB7IHRocm93IG5ldyBFcnJvcignT2JzZXJ2ZXIgY29tcGxldGVkJyk7IH1cbiAgICAgIGlmICh0aGlzLl9zdGF0ZSA9PT0gMCkgeyB0aGlzLl9zdGF0ZSA9IDE7IH1cbiAgICB9O1xuXG4gICAgcmV0dXJuIENoZWNrZWRPYnNlcnZlcjtcbiAgfShPYnNlcnZlcikpO1xuXG4gIHZhciBTY2hlZHVsZWRPYnNlcnZlciA9IFJ4LmludGVybmFscy5TY2hlZHVsZWRPYnNlcnZlciA9IChmdW5jdGlvbiAoX19zdXBlcl9fKSB7XG4gICAgaW5oZXJpdHMoU2NoZWR1bGVkT2JzZXJ2ZXIsIF9fc3VwZXJfXyk7XG5cbiAgICBmdW5jdGlvbiBTY2hlZHVsZWRPYnNlcnZlcihzY2hlZHVsZXIsIG9ic2VydmVyKSB7XG4gICAgICBfX3N1cGVyX18uY2FsbCh0aGlzKTtcbiAgICAgIHRoaXMuc2NoZWR1bGVyID0gc2NoZWR1bGVyO1xuICAgICAgdGhpcy5vYnNlcnZlciA9IG9ic2VydmVyO1xuICAgICAgdGhpcy5pc0FjcXVpcmVkID0gZmFsc2U7XG4gICAgICB0aGlzLmhhc0ZhdWx0ZWQgPSBmYWxzZTtcbiAgICAgIHRoaXMucXVldWUgPSBbXTtcbiAgICAgIHRoaXMuZGlzcG9zYWJsZSA9IG5ldyBTZXJpYWxEaXNwb3NhYmxlKCk7XG4gICAgfVxuXG4gICAgU2NoZWR1bGVkT2JzZXJ2ZXIucHJvdG90eXBlLm5leHQgPSBmdW5jdGlvbiAodmFsdWUpIHtcbiAgICAgIHZhciBzZWxmID0gdGhpcztcbiAgICAgIHRoaXMucXVldWUucHVzaChmdW5jdGlvbiAoKSB7IHNlbGYub2JzZXJ2ZXIub25OZXh0KHZhbHVlKTsgfSk7XG4gICAgfTtcblxuICAgIFNjaGVkdWxlZE9ic2VydmVyLnByb3RvdHlwZS5lcnJvciA9IGZ1bmN0aW9uIChlKSB7XG4gICAgICB2YXIgc2VsZiA9IHRoaXM7XG4gICAgICB0aGlzLnF1ZXVlLnB1c2goZnVuY3Rpb24gKCkgeyBzZWxmLm9ic2VydmVyLm9uRXJyb3IoZSk7IH0pO1xuICAgIH07XG5cbiAgICBTY2hlZHVsZWRPYnNlcnZlci5wcm90b3R5cGUuY29tcGxldGVkID0gZnVuY3Rpb24gKCkge1xuICAgICAgdmFyIHNlbGYgPSB0aGlzO1xuICAgICAgdGhpcy5xdWV1ZS5wdXNoKGZ1bmN0aW9uICgpIHsgc2VsZi5vYnNlcnZlci5vbkNvbXBsZXRlZCgpOyB9KTtcbiAgICB9O1xuXG4gICAgU2NoZWR1bGVkT2JzZXJ2ZXIucHJvdG90eXBlLmVuc3VyZUFjdGl2ZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgIHZhciBpc093bmVyID0gZmFsc2U7XG4gICAgICBpZiAoIXRoaXMuaGFzRmF1bHRlZCAmJiB0aGlzLnF1ZXVlLmxlbmd0aCA+IDApIHtcbiAgICAgICAgaXNPd25lciA9ICF0aGlzLmlzQWNxdWlyZWQ7XG4gICAgICAgIHRoaXMuaXNBY3F1aXJlZCA9IHRydWU7XG4gICAgICB9XG4gICAgICBpZiAoaXNPd25lcikge1xuICAgICAgICB0aGlzLmRpc3Bvc2FibGUuc2V0RGlzcG9zYWJsZSh0aGlzLnNjaGVkdWxlci5zY2hlZHVsZVJlY3Vyc2l2ZSh0aGlzLCBmdW5jdGlvbiAocGFyZW50LCBzZWxmKSB7XG4gICAgICAgICAgdmFyIHdvcms7XG4gICAgICAgICAgaWYgKHBhcmVudC5xdWV1ZS5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICB3b3JrID0gcGFyZW50LnF1ZXVlLnNoaWZ0KCk7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHBhcmVudC5pc0FjcXVpcmVkID0gZmFsc2U7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgfVxuICAgICAgICAgIHZhciByZXMgPSB0cnlDYXRjaCh3b3JrKSgpO1xuICAgICAgICAgIGlmIChyZXMgPT09IGVycm9yT2JqKSB7XG4gICAgICAgICAgICBwYXJlbnQucXVldWUgPSBbXTtcbiAgICAgICAgICAgIHBhcmVudC5oYXNGYXVsdGVkID0gdHJ1ZTtcbiAgICAgICAgICAgIHJldHVybiB0aHJvd2VyKHJlcy5lKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgc2VsZihwYXJlbnQpO1xuICAgICAgICB9KSk7XG4gICAgICB9XG4gICAgfTtcblxuICAgIFNjaGVkdWxlZE9ic2VydmVyLnByb3RvdHlwZS5kaXNwb3NlID0gZnVuY3Rpb24gKCkge1xuICAgICAgX19zdXBlcl9fLnByb3RvdHlwZS5kaXNwb3NlLmNhbGwodGhpcyk7XG4gICAgICB0aGlzLmRpc3Bvc2FibGUuZGlzcG9zZSgpO1xuICAgIH07XG5cbiAgICByZXR1cm4gU2NoZWR1bGVkT2JzZXJ2ZXI7XG4gIH0oQWJzdHJhY3RPYnNlcnZlcikpO1xuXG4gIHZhciBPYnNlcnZlT25PYnNlcnZlciA9IChmdW5jdGlvbiAoX19zdXBlcl9fKSB7XG4gICAgaW5oZXJpdHMoT2JzZXJ2ZU9uT2JzZXJ2ZXIsIF9fc3VwZXJfXyk7XG5cbiAgICBmdW5jdGlvbiBPYnNlcnZlT25PYnNlcnZlcihzY2hlZHVsZXIsIG9ic2VydmVyLCBjYW5jZWwpIHtcbiAgICAgIF9fc3VwZXJfXy5jYWxsKHRoaXMsIHNjaGVkdWxlciwgb2JzZXJ2ZXIpO1xuICAgICAgdGhpcy5fY2FuY2VsID0gY2FuY2VsO1xuICAgIH1cblxuICAgIE9ic2VydmVPbk9ic2VydmVyLnByb3RvdHlwZS5uZXh0ID0gZnVuY3Rpb24gKHZhbHVlKSB7XG4gICAgICBfX3N1cGVyX18ucHJvdG90eXBlLm5leHQuY2FsbCh0aGlzLCB2YWx1ZSk7XG4gICAgICB0aGlzLmVuc3VyZUFjdGl2ZSgpO1xuICAgIH07XG5cbiAgICBPYnNlcnZlT25PYnNlcnZlci5wcm90b3R5cGUuZXJyb3IgPSBmdW5jdGlvbiAoZSkge1xuICAgICAgX19zdXBlcl9fLnByb3RvdHlwZS5lcnJvci5jYWxsKHRoaXMsIGUpO1xuICAgICAgdGhpcy5lbnN1cmVBY3RpdmUoKTtcbiAgICB9O1xuXG4gICAgT2JzZXJ2ZU9uT2JzZXJ2ZXIucHJvdG90eXBlLmNvbXBsZXRlZCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgIF9fc3VwZXJfXy5wcm90b3R5cGUuY29tcGxldGVkLmNhbGwodGhpcyk7XG4gICAgICB0aGlzLmVuc3VyZUFjdGl2ZSgpO1xuICAgIH07XG5cbiAgICBPYnNlcnZlT25PYnNlcnZlci5wcm90b3R5cGUuZGlzcG9zZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgIF9fc3VwZXJfXy5wcm90b3R5cGUuZGlzcG9zZS5jYWxsKHRoaXMpO1xuICAgICAgdGhpcy5fY2FuY2VsICYmIHRoaXMuX2NhbmNlbC5kaXNwb3NlKCk7XG4gICAgICB0aGlzLl9jYW5jZWwgPSBudWxsO1xuICAgIH07XG5cbiAgICByZXR1cm4gT2JzZXJ2ZU9uT2JzZXJ2ZXI7XG4gIH0pKFNjaGVkdWxlZE9ic2VydmVyKTtcblxuICB2YXIgb2JzZXJ2YWJsZVByb3RvO1xuXG4gIC8qKlxuICAgKiBSZXByZXNlbnRzIGEgcHVzaC1zdHlsZSBjb2xsZWN0aW9uLlxuICAgKi9cbiAgdmFyIE9ic2VydmFibGUgPSBSeC5PYnNlcnZhYmxlID0gKGZ1bmN0aW9uICgpIHtcblxuICAgIGZ1bmN0aW9uIG1ha2VTdWJzY3JpYmUoc2VsZiwgc3Vic2NyaWJlKSB7XG4gICAgICByZXR1cm4gZnVuY3Rpb24gKG8pIHtcbiAgICAgICAgdmFyIG9sZE9uRXJyb3IgPSBvLm9uRXJyb3I7XG4gICAgICAgIG8ub25FcnJvciA9IGZ1bmN0aW9uIChlKSB7XG4gICAgICAgICAgbWFrZVN0YWNrVHJhY2VMb25nKGUsIHNlbGYpO1xuICAgICAgICAgIG9sZE9uRXJyb3IuY2FsbChvLCBlKTtcbiAgICAgICAgfTtcblxuICAgICAgICByZXR1cm4gc3Vic2NyaWJlLmNhbGwoc2VsZiwgbyk7XG4gICAgICB9O1xuICAgIH1cblxuICAgIGZ1bmN0aW9uIE9ic2VydmFibGUoKSB7XG4gICAgICBpZiAoUnguY29uZmlnLmxvbmdTdGFja1N1cHBvcnQgJiYgaGFzU3RhY2tzKSB7XG4gICAgICAgIHZhciBvbGRTdWJzY3JpYmUgPSB0aGlzLl9zdWJzY3JpYmU7XG4gICAgICAgIHZhciBlID0gdHJ5Q2F0Y2godGhyb3dlcikobmV3IEVycm9yKCkpLmU7XG4gICAgICAgIHRoaXMuc3RhY2sgPSBlLnN0YWNrLnN1YnN0cmluZyhlLnN0YWNrLmluZGV4T2YoJ1xcbicpICsgMSk7XG4gICAgICAgIHRoaXMuX3N1YnNjcmliZSA9IG1ha2VTdWJzY3JpYmUodGhpcywgb2xkU3Vic2NyaWJlKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICBvYnNlcnZhYmxlUHJvdG8gPSBPYnNlcnZhYmxlLnByb3RvdHlwZTtcblxuICAgIC8qKlxuICAgICogRGV0ZXJtaW5lcyB3aGV0aGVyIHRoZSBnaXZlbiBvYmplY3QgaXMgYW4gT2JzZXJ2YWJsZVxuICAgICogQHBhcmFtIHtBbnl9IEFuIG9iamVjdCB0byBkZXRlcm1pbmUgd2hldGhlciBpdCBpcyBhbiBPYnNlcnZhYmxlXG4gICAgKiBAcmV0dXJucyB7Qm9vbGVhbn0gdHJ1ZSBpZiBhbiBPYnNlcnZhYmxlLCBlbHNlIGZhbHNlLlxuICAgICovXG4gICAgT2JzZXJ2YWJsZS5pc09ic2VydmFibGUgPSBmdW5jdGlvbiAobykge1xuICAgICAgcmV0dXJuIG8gJiYgaXNGdW5jdGlvbihvLnN1YnNjcmliZSk7XG4gICAgfTtcblxuICAgIC8qKlxuICAgICAqICBTdWJzY3JpYmVzIGFuIG8gdG8gdGhlIG9ic2VydmFibGUgc2VxdWVuY2UuXG4gICAgICogIEBwYXJhbSB7TWl4ZWR9IFtvT3JPbk5leHRdIFRoZSBvYmplY3QgdGhhdCBpcyB0byByZWNlaXZlIG5vdGlmaWNhdGlvbnMgb3IgYW4gYWN0aW9uIHRvIGludm9rZSBmb3IgZWFjaCBlbGVtZW50IGluIHRoZSBvYnNlcnZhYmxlIHNlcXVlbmNlLlxuICAgICAqICBAcGFyYW0ge0Z1bmN0aW9ufSBbb25FcnJvcl0gQWN0aW9uIHRvIGludm9rZSB1cG9uIGV4Y2VwdGlvbmFsIHRlcm1pbmF0aW9uIG9mIHRoZSBvYnNlcnZhYmxlIHNlcXVlbmNlLlxuICAgICAqICBAcGFyYW0ge0Z1bmN0aW9ufSBbb25Db21wbGV0ZWRdIEFjdGlvbiB0byBpbnZva2UgdXBvbiBncmFjZWZ1bCB0ZXJtaW5hdGlvbiBvZiB0aGUgb2JzZXJ2YWJsZSBzZXF1ZW5jZS5cbiAgICAgKiAgQHJldHVybnMge0RpcG9zYWJsZX0gQSBkaXNwb3NhYmxlIGhhbmRsaW5nIHRoZSBzdWJzY3JpcHRpb25zIGFuZCB1bnN1YnNjcmlwdGlvbnMuXG4gICAgICovXG4gICAgb2JzZXJ2YWJsZVByb3RvLnN1YnNjcmliZSA9IG9ic2VydmFibGVQcm90by5mb3JFYWNoID0gZnVuY3Rpb24gKG9Pck9uTmV4dCwgb25FcnJvciwgb25Db21wbGV0ZWQpIHtcbiAgICAgIHJldHVybiB0aGlzLl9zdWJzY3JpYmUodHlwZW9mIG9Pck9uTmV4dCA9PT0gJ29iamVjdCcgP1xuICAgICAgICBvT3JPbk5leHQgOlxuICAgICAgICBvYnNlcnZlckNyZWF0ZShvT3JPbk5leHQsIG9uRXJyb3IsIG9uQ29tcGxldGVkKSk7XG4gICAgfTtcblxuICAgIC8qKlxuICAgICAqIFN1YnNjcmliZXMgdG8gdGhlIG5leHQgdmFsdWUgaW4gdGhlIHNlcXVlbmNlIHdpdGggYW4gb3B0aW9uYWwgXCJ0aGlzXCIgYXJndW1lbnQuXG4gICAgICogQHBhcmFtIHtGdW5jdGlvbn0gb25OZXh0IFRoZSBmdW5jdGlvbiB0byBpbnZva2Ugb24gZWFjaCBlbGVtZW50IGluIHRoZSBvYnNlcnZhYmxlIHNlcXVlbmNlLlxuICAgICAqIEBwYXJhbSB7QW55fSBbdGhpc0FyZ10gT2JqZWN0IHRvIHVzZSBhcyB0aGlzIHdoZW4gZXhlY3V0aW5nIGNhbGxiYWNrLlxuICAgICAqIEByZXR1cm5zIHtEaXNwb3NhYmxlfSBBIGRpc3Bvc2FibGUgaGFuZGxpbmcgdGhlIHN1YnNjcmlwdGlvbnMgYW5kIHVuc3Vic2NyaXB0aW9ucy5cbiAgICAgKi9cbiAgICBvYnNlcnZhYmxlUHJvdG8uc3Vic2NyaWJlT25OZXh0ID0gZnVuY3Rpb24gKG9uTmV4dCwgdGhpc0FyZykge1xuICAgICAgcmV0dXJuIHRoaXMuX3N1YnNjcmliZShvYnNlcnZlckNyZWF0ZSh0eXBlb2YgdGhpc0FyZyAhPT0gJ3VuZGVmaW5lZCcgPyBmdW5jdGlvbih4KSB7IG9uTmV4dC5jYWxsKHRoaXNBcmcsIHgpOyB9IDogb25OZXh0KSk7XG4gICAgfTtcblxuICAgIC8qKlxuICAgICAqIFN1YnNjcmliZXMgdG8gYW4gZXhjZXB0aW9uYWwgY29uZGl0aW9uIGluIHRoZSBzZXF1ZW5jZSB3aXRoIGFuIG9wdGlvbmFsIFwidGhpc1wiIGFyZ3VtZW50LlxuICAgICAqIEBwYXJhbSB7RnVuY3Rpb259IG9uRXJyb3IgVGhlIGZ1bmN0aW9uIHRvIGludm9rZSB1cG9uIGV4Y2VwdGlvbmFsIHRlcm1pbmF0aW9uIG9mIHRoZSBvYnNlcnZhYmxlIHNlcXVlbmNlLlxuICAgICAqIEBwYXJhbSB7QW55fSBbdGhpc0FyZ10gT2JqZWN0IHRvIHVzZSBhcyB0aGlzIHdoZW4gZXhlY3V0aW5nIGNhbGxiYWNrLlxuICAgICAqIEByZXR1cm5zIHtEaXNwb3NhYmxlfSBBIGRpc3Bvc2FibGUgaGFuZGxpbmcgdGhlIHN1YnNjcmlwdGlvbnMgYW5kIHVuc3Vic2NyaXB0aW9ucy5cbiAgICAgKi9cbiAgICBvYnNlcnZhYmxlUHJvdG8uc3Vic2NyaWJlT25FcnJvciA9IGZ1bmN0aW9uIChvbkVycm9yLCB0aGlzQXJnKSB7XG4gICAgICByZXR1cm4gdGhpcy5fc3Vic2NyaWJlKG9ic2VydmVyQ3JlYXRlKG51bGwsIHR5cGVvZiB0aGlzQXJnICE9PSAndW5kZWZpbmVkJyA/IGZ1bmN0aW9uKGUpIHsgb25FcnJvci5jYWxsKHRoaXNBcmcsIGUpOyB9IDogb25FcnJvcikpO1xuICAgIH07XG5cbiAgICAvKipcbiAgICAgKiBTdWJzY3JpYmVzIHRvIHRoZSBuZXh0IHZhbHVlIGluIHRoZSBzZXF1ZW5jZSB3aXRoIGFuIG9wdGlvbmFsIFwidGhpc1wiIGFyZ3VtZW50LlxuICAgICAqIEBwYXJhbSB7RnVuY3Rpb259IG9uQ29tcGxldGVkIFRoZSBmdW5jdGlvbiB0byBpbnZva2UgdXBvbiBncmFjZWZ1bCB0ZXJtaW5hdGlvbiBvZiB0aGUgb2JzZXJ2YWJsZSBzZXF1ZW5jZS5cbiAgICAgKiBAcGFyYW0ge0FueX0gW3RoaXNBcmddIE9iamVjdCB0byB1c2UgYXMgdGhpcyB3aGVuIGV4ZWN1dGluZyBjYWxsYmFjay5cbiAgICAgKiBAcmV0dXJucyB7RGlzcG9zYWJsZX0gQSBkaXNwb3NhYmxlIGhhbmRsaW5nIHRoZSBzdWJzY3JpcHRpb25zIGFuZCB1bnN1YnNjcmlwdGlvbnMuXG4gICAgICovXG4gICAgb2JzZXJ2YWJsZVByb3RvLnN1YnNjcmliZU9uQ29tcGxldGVkID0gZnVuY3Rpb24gKG9uQ29tcGxldGVkLCB0aGlzQXJnKSB7XG4gICAgICByZXR1cm4gdGhpcy5fc3Vic2NyaWJlKG9ic2VydmVyQ3JlYXRlKG51bGwsIG51bGwsIHR5cGVvZiB0aGlzQXJnICE9PSAndW5kZWZpbmVkJyA/IGZ1bmN0aW9uKCkgeyBvbkNvbXBsZXRlZC5jYWxsKHRoaXNBcmcpOyB9IDogb25Db21wbGV0ZWQpKTtcbiAgICB9O1xuXG4gICAgcmV0dXJuIE9ic2VydmFibGU7XG4gIH0pKCk7XG5cbiAgdmFyIE9ic2VydmFibGVCYXNlID0gUnguT2JzZXJ2YWJsZUJhc2UgPSAoZnVuY3Rpb24gKF9fc3VwZXJfXykge1xuICAgIGluaGVyaXRzKE9ic2VydmFibGVCYXNlLCBfX3N1cGVyX18pO1xuXG4gICAgZnVuY3Rpb24gZml4U3Vic2NyaWJlcihzdWJzY3JpYmVyKSB7XG4gICAgICByZXR1cm4gc3Vic2NyaWJlciAmJiBpc0Z1bmN0aW9uKHN1YnNjcmliZXIuZGlzcG9zZSkgPyBzdWJzY3JpYmVyIDpcbiAgICAgICAgaXNGdW5jdGlvbihzdWJzY3JpYmVyKSA/IGRpc3Bvc2FibGVDcmVhdGUoc3Vic2NyaWJlcikgOiBkaXNwb3NhYmxlRW1wdHk7XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gc2V0RGlzcG9zYWJsZShzLCBzdGF0ZSkge1xuICAgICAgdmFyIGFkbyA9IHN0YXRlWzBdLCBzZWxmID0gc3RhdGVbMV07XG4gICAgICB2YXIgc3ViID0gdHJ5Q2F0Y2goc2VsZi5zdWJzY3JpYmVDb3JlKS5jYWxsKHNlbGYsIGFkbyk7XG4gICAgICBpZiAoc3ViID09PSBlcnJvck9iaiAmJiAhYWRvLmZhaWwoZXJyb3JPYmouZSkpIHsgdGhyb3dlcihlcnJvck9iai5lKTsgfVxuICAgICAgYWRvLnNldERpc3Bvc2FibGUoZml4U3Vic2NyaWJlcihzdWIpKTtcbiAgICB9XG5cbiAgICBmdW5jdGlvbiBPYnNlcnZhYmxlQmFzZSgpIHtcbiAgICAgIF9fc3VwZXJfXy5jYWxsKHRoaXMpO1xuICAgIH1cblxuICAgIE9ic2VydmFibGVCYXNlLnByb3RvdHlwZS5fc3Vic2NyaWJlID0gZnVuY3Rpb24gKG8pIHtcbiAgICAgIHZhciBhZG8gPSBuZXcgQXV0b0RldGFjaE9ic2VydmVyKG8pLCBzdGF0ZSA9IFthZG8sIHRoaXNdO1xuXG4gICAgICBpZiAoY3VycmVudFRocmVhZFNjaGVkdWxlci5zY2hlZHVsZVJlcXVpcmVkKCkpIHtcbiAgICAgICAgY3VycmVudFRocmVhZFNjaGVkdWxlci5zY2hlZHVsZShzdGF0ZSwgc2V0RGlzcG9zYWJsZSk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBzZXREaXNwb3NhYmxlKG51bGwsIHN0YXRlKTtcbiAgICAgIH1cbiAgICAgIHJldHVybiBhZG87XG4gICAgfTtcblxuICAgIE9ic2VydmFibGVCYXNlLnByb3RvdHlwZS5zdWJzY3JpYmVDb3JlID0gbm90SW1wbGVtZW50ZWQ7XG5cbiAgICByZXR1cm4gT2JzZXJ2YWJsZUJhc2U7XG4gIH0oT2JzZXJ2YWJsZSkpO1xuXG52YXIgRmxhdE1hcE9ic2VydmFibGUgPSBSeC5GbGF0TWFwT2JzZXJ2YWJsZSA9IChmdW5jdGlvbihfX3N1cGVyX18pIHtcblxuICAgIGluaGVyaXRzKEZsYXRNYXBPYnNlcnZhYmxlLCBfX3N1cGVyX18pO1xuXG4gICAgZnVuY3Rpb24gRmxhdE1hcE9ic2VydmFibGUoc291cmNlLCBzZWxlY3RvciwgcmVzdWx0U2VsZWN0b3IsIHRoaXNBcmcpIHtcbiAgICAgIHRoaXMucmVzdWx0U2VsZWN0b3IgPSBpc0Z1bmN0aW9uKHJlc3VsdFNlbGVjdG9yKSA/IHJlc3VsdFNlbGVjdG9yIDogbnVsbDtcbiAgICAgIHRoaXMuc2VsZWN0b3IgPSBiaW5kQ2FsbGJhY2soaXNGdW5jdGlvbihzZWxlY3RvcikgPyBzZWxlY3RvciA6IGZ1bmN0aW9uKCkgeyByZXR1cm4gc2VsZWN0b3I7IH0sIHRoaXNBcmcsIDMpO1xuICAgICAgdGhpcy5zb3VyY2UgPSBzb3VyY2U7XG4gICAgICBfX3N1cGVyX18uY2FsbCh0aGlzKTtcbiAgICB9XG5cbiAgICBGbGF0TWFwT2JzZXJ2YWJsZS5wcm90b3R5cGUuc3Vic2NyaWJlQ29yZSA9IGZ1bmN0aW9uKG8pIHtcbiAgICAgIHJldHVybiB0aGlzLnNvdXJjZS5zdWJzY3JpYmUobmV3IElubmVyT2JzZXJ2ZXIobywgdGhpcy5zZWxlY3RvciwgdGhpcy5yZXN1bHRTZWxlY3RvciwgdGhpcykpO1xuICAgIH07XG5cbiAgICBpbmhlcml0cyhJbm5lck9ic2VydmVyLCBBYnN0cmFjdE9ic2VydmVyKTtcbiAgICBmdW5jdGlvbiBJbm5lck9ic2VydmVyKG9ic2VydmVyLCBzZWxlY3RvciwgcmVzdWx0U2VsZWN0b3IsIHNvdXJjZSkge1xuICAgICAgdGhpcy5pID0gMDtcbiAgICAgIHRoaXMuc2VsZWN0b3IgPSBzZWxlY3RvcjtcbiAgICAgIHRoaXMucmVzdWx0U2VsZWN0b3IgPSByZXN1bHRTZWxlY3RvcjtcbiAgICAgIHRoaXMuc291cmNlID0gc291cmNlO1xuICAgICAgdGhpcy5vID0gb2JzZXJ2ZXI7XG4gICAgICBBYnN0cmFjdE9ic2VydmVyLmNhbGwodGhpcyk7XG4gICAgfVxuXG4gICAgSW5uZXJPYnNlcnZlci5wcm90b3R5cGUuX3dyYXBSZXN1bHQgPSBmdW5jdGlvbihyZXN1bHQsIHgsIGkpIHtcbiAgICAgIHJldHVybiB0aGlzLnJlc3VsdFNlbGVjdG9yID9cbiAgICAgICAgcmVzdWx0Lm1hcChmdW5jdGlvbih5LCBpMikgeyByZXR1cm4gdGhpcy5yZXN1bHRTZWxlY3Rvcih4LCB5LCBpLCBpMik7IH0sIHRoaXMpIDpcbiAgICAgICAgcmVzdWx0O1xuICAgIH07XG5cbiAgICBJbm5lck9ic2VydmVyLnByb3RvdHlwZS5uZXh0ID0gZnVuY3Rpb24oeCkge1xuICAgICAgdmFyIGkgPSB0aGlzLmkrKztcbiAgICAgIHZhciByZXN1bHQgPSB0cnlDYXRjaCh0aGlzLnNlbGVjdG9yKSh4LCBpLCB0aGlzLnNvdXJjZSk7XG4gICAgICBpZiAocmVzdWx0ID09PSBlcnJvck9iaikgeyByZXR1cm4gdGhpcy5vLm9uRXJyb3IocmVzdWx0LmUpOyB9XG5cbiAgICAgIGlzUHJvbWlzZShyZXN1bHQpICYmIChyZXN1bHQgPSBvYnNlcnZhYmxlRnJvbVByb21pc2UocmVzdWx0KSk7XG4gICAgICAoaXNBcnJheUxpa2UocmVzdWx0KSB8fCBpc0l0ZXJhYmxlKHJlc3VsdCkpICYmIChyZXN1bHQgPSBPYnNlcnZhYmxlLmZyb20ocmVzdWx0KSk7XG4gICAgICB0aGlzLm8ub25OZXh0KHRoaXMuX3dyYXBSZXN1bHQocmVzdWx0LCB4LCBpKSk7XG4gICAgfTtcblxuICAgIElubmVyT2JzZXJ2ZXIucHJvdG90eXBlLmVycm9yID0gZnVuY3Rpb24oZSkgeyB0aGlzLm8ub25FcnJvcihlKTsgfTtcblxuICAgIElubmVyT2JzZXJ2ZXIucHJvdG90eXBlLm9uQ29tcGxldGVkID0gZnVuY3Rpb24oKSB7IHRoaXMuby5vbkNvbXBsZXRlZCgpOyB9O1xuXG4gICAgcmV0dXJuIEZsYXRNYXBPYnNlcnZhYmxlO1xuXG59KE9ic2VydmFibGVCYXNlKSk7XG5cbiAgdmFyIEVudW1lcmFibGUgPSBSeC5pbnRlcm5hbHMuRW51bWVyYWJsZSA9IGZ1bmN0aW9uICgpIHsgfTtcblxuICBmdW5jdGlvbiBJc0Rpc3Bvc2VkRGlzcG9zYWJsZShzdGF0ZSkge1xuICAgIHRoaXMuX3MgPSBzdGF0ZTtcbiAgICB0aGlzLmlzRGlzcG9zZWQgPSBmYWxzZTtcbiAgfVxuXG4gIElzRGlzcG9zZWREaXNwb3NhYmxlLnByb3RvdHlwZS5kaXNwb3NlID0gZnVuY3Rpb24gKCkge1xuICAgIGlmICghdGhpcy5pc0Rpc3Bvc2VkKSB7XG4gICAgICB0aGlzLmlzRGlzcG9zZWQgPSB0cnVlO1xuICAgICAgdGhpcy5fcy5pc0Rpc3Bvc2VkID0gdHJ1ZTtcbiAgICB9XG4gIH07XG5cbiAgdmFyIENvbmNhdEVudW1lcmFibGVPYnNlcnZhYmxlID0gKGZ1bmN0aW9uKF9fc3VwZXJfXykge1xuICAgIGluaGVyaXRzKENvbmNhdEVudW1lcmFibGVPYnNlcnZhYmxlLCBfX3N1cGVyX18pO1xuICAgIGZ1bmN0aW9uIENvbmNhdEVudW1lcmFibGVPYnNlcnZhYmxlKHNvdXJjZXMpIHtcbiAgICAgIHRoaXMuc291cmNlcyA9IHNvdXJjZXM7XG4gICAgICBfX3N1cGVyX18uY2FsbCh0aGlzKTtcbiAgICB9XG5cbiAgICBDb25jYXRFbnVtZXJhYmxlT2JzZXJ2YWJsZS5wcm90b3R5cGUuc3Vic2NyaWJlQ29yZSA9IGZ1bmN0aW9uIChvKSB7XG4gICAgICB2YXIgc3RhdGUgPSB7IGlzRGlzcG9zZWQ6IGZhbHNlIH0sIHN1YnNjcmlwdGlvbiA9IG5ldyBTZXJpYWxEaXNwb3NhYmxlKCk7XG4gICAgICB2YXIgY2FuY2VsYWJsZSA9IGN1cnJlbnRUaHJlYWRTY2hlZHVsZXIuc2NoZWR1bGVSZWN1cnNpdmUodGhpcy5zb3VyY2VzWyRpdGVyYXRvciRdKCksIGZ1bmN0aW9uIChlLCBzZWxmKSB7XG4gICAgICAgIGlmIChzdGF0ZS5pc0Rpc3Bvc2VkKSB7IHJldHVybjsgfVxuICAgICAgICB2YXIgY3VycmVudEl0ZW0gPSB0cnlDYXRjaChlLm5leHQpLmNhbGwoZSk7XG4gICAgICAgIGlmIChjdXJyZW50SXRlbSA9PT0gZXJyb3JPYmopIHsgcmV0dXJuIG8ub25FcnJvcihjdXJyZW50SXRlbS5lKTsgfVxuXG4gICAgICAgIGlmIChjdXJyZW50SXRlbS5kb25lKSB7XG4gICAgICAgICAgcmV0dXJuIG8ub25Db21wbGV0ZWQoKTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIENoZWNrIGlmIHByb21pc2VcbiAgICAgICAgdmFyIGN1cnJlbnRWYWx1ZSA9IGN1cnJlbnRJdGVtLnZhbHVlO1xuICAgICAgICBpc1Byb21pc2UoY3VycmVudFZhbHVlKSAmJiAoY3VycmVudFZhbHVlID0gb2JzZXJ2YWJsZUZyb21Qcm9taXNlKGN1cnJlbnRWYWx1ZSkpO1xuXG4gICAgICAgIHZhciBkID0gbmV3IFNpbmdsZUFzc2lnbm1lbnREaXNwb3NhYmxlKCk7XG4gICAgICAgIHN1YnNjcmlwdGlvbi5zZXREaXNwb3NhYmxlKGQpO1xuICAgICAgICBkLnNldERpc3Bvc2FibGUoY3VycmVudFZhbHVlLnN1YnNjcmliZShuZXcgSW5uZXJPYnNlcnZlcihvLCBzZWxmLCBlKSkpO1xuICAgICAgfSk7XG5cbiAgICAgIHJldHVybiBuZXcgTkFyeURpc3Bvc2FibGUoW3N1YnNjcmlwdGlvbiwgY2FuY2VsYWJsZSwgbmV3IElzRGlzcG9zZWREaXNwb3NhYmxlKHN0YXRlKV0pO1xuICAgIH07XG5cbiAgICBpbmhlcml0cyhJbm5lck9ic2VydmVyLCBBYnN0cmFjdE9ic2VydmVyKTtcbiAgICBmdW5jdGlvbiBJbm5lck9ic2VydmVyKG8sIHMsIGUpIHtcbiAgICAgIHRoaXMuX28gPSBvO1xuICAgICAgdGhpcy5fcyA9IHM7XG4gICAgICB0aGlzLl9lID0gZTtcbiAgICAgIEFic3RyYWN0T2JzZXJ2ZXIuY2FsbCh0aGlzKTtcbiAgICB9XG4gICAgSW5uZXJPYnNlcnZlci5wcm90b3R5cGUub25OZXh0ID0gZnVuY3Rpb24gKHgpIHsgdGhpcy5fby5vbk5leHQoeCk7IH07XG4gICAgSW5uZXJPYnNlcnZlci5wcm90b3R5cGUub25FcnJvciA9IGZ1bmN0aW9uIChlKSB7IHRoaXMuX28ub25FcnJvcihlKTsgfTtcbiAgICBJbm5lck9ic2VydmVyLnByb3RvdHlwZS5vbkNvbXBsZXRlZCA9IGZ1bmN0aW9uICgpIHsgdGhpcy5fcyh0aGlzLl9lKTsgfTtcblxuICAgIHJldHVybiBDb25jYXRFbnVtZXJhYmxlT2JzZXJ2YWJsZTtcbiAgfShPYnNlcnZhYmxlQmFzZSkpO1xuXG4gIEVudW1lcmFibGUucHJvdG90eXBlLmNvbmNhdCA9IGZ1bmN0aW9uICgpIHtcbiAgICByZXR1cm4gbmV3IENvbmNhdEVudW1lcmFibGVPYnNlcnZhYmxlKHRoaXMpO1xuICB9O1xuXG4gIHZhciBDYXRjaEVycm9yT2JzZXJ2YWJsZSA9IChmdW5jdGlvbihfX3N1cGVyX18pIHtcbiAgICBpbmhlcml0cyhDYXRjaEVycm9yT2JzZXJ2YWJsZSwgX19zdXBlcl9fKTtcbiAgICBmdW5jdGlvbiBDYXRjaEVycm9yT2JzZXJ2YWJsZShzb3VyY2VzKSB7XG4gICAgICB0aGlzLnNvdXJjZXMgPSBzb3VyY2VzO1xuICAgICAgX19zdXBlcl9fLmNhbGwodGhpcyk7XG4gICAgfVxuXG4gICAgQ2F0Y2hFcnJvck9ic2VydmFibGUucHJvdG90eXBlLnN1YnNjcmliZUNvcmUgPSBmdW5jdGlvbiAobykge1xuICAgICAgdmFyIGUgPSB0aGlzLnNvdXJjZXNbJGl0ZXJhdG9yJF0oKTtcblxuICAgICAgdmFyIHN0YXRlID0geyBpc0Rpc3Bvc2VkOiBmYWxzZSB9LCBzdWJzY3JpcHRpb24gPSBuZXcgU2VyaWFsRGlzcG9zYWJsZSgpO1xuICAgICAgdmFyIGNhbmNlbGFibGUgPSBjdXJyZW50VGhyZWFkU2NoZWR1bGVyLnNjaGVkdWxlUmVjdXJzaXZlKG51bGwsIGZ1bmN0aW9uIChsYXN0RXhjZXB0aW9uLCBzZWxmKSB7XG4gICAgICAgIGlmIChzdGF0ZS5pc0Rpc3Bvc2VkKSB7IHJldHVybjsgfVxuICAgICAgICB2YXIgY3VycmVudEl0ZW0gPSB0cnlDYXRjaChlLm5leHQpLmNhbGwoZSk7XG4gICAgICAgIGlmIChjdXJyZW50SXRlbSA9PT0gZXJyb3JPYmopIHsgcmV0dXJuIG8ub25FcnJvcihjdXJyZW50SXRlbS5lKTsgfVxuXG4gICAgICAgIGlmIChjdXJyZW50SXRlbS5kb25lKSB7XG4gICAgICAgICAgcmV0dXJuIGxhc3RFeGNlcHRpb24gIT09IG51bGwgPyBvLm9uRXJyb3IobGFzdEV4Y2VwdGlvbikgOiBvLm9uQ29tcGxldGVkKCk7XG4gICAgICAgIH1cblxuICAgICAgICAvLyBDaGVjayBpZiBwcm9taXNlXG4gICAgICAgIHZhciBjdXJyZW50VmFsdWUgPSBjdXJyZW50SXRlbS52YWx1ZTtcbiAgICAgICAgaXNQcm9taXNlKGN1cnJlbnRWYWx1ZSkgJiYgKGN1cnJlbnRWYWx1ZSA9IG9ic2VydmFibGVGcm9tUHJvbWlzZShjdXJyZW50VmFsdWUpKTtcblxuICAgICAgICB2YXIgZCA9IG5ldyBTaW5nbGVBc3NpZ25tZW50RGlzcG9zYWJsZSgpO1xuICAgICAgICBzdWJzY3JpcHRpb24uc2V0RGlzcG9zYWJsZShkKTtcbiAgICAgICAgZC5zZXREaXNwb3NhYmxlKGN1cnJlbnRWYWx1ZS5zdWJzY3JpYmUobmV3IElubmVyT2JzZXJ2ZXIobywgc2VsZikpKTtcbiAgICAgIH0pO1xuICAgICAgcmV0dXJuIG5ldyBOQXJ5RGlzcG9zYWJsZShbc3Vic2NyaXB0aW9uLCBjYW5jZWxhYmxlLCBuZXcgSXNEaXNwb3NlZERpc3Bvc2FibGUoc3RhdGUpXSk7XG4gICAgfTtcblxuICAgIGluaGVyaXRzKElubmVyT2JzZXJ2ZXIsIEFic3RyYWN0T2JzZXJ2ZXIpO1xuICAgIGZ1bmN0aW9uIElubmVyT2JzZXJ2ZXIobywgcmVjdXJzZSkge1xuICAgICAgdGhpcy5fbyA9IG87XG4gICAgICB0aGlzLl9yZWN1cnNlID0gcmVjdXJzZTtcbiAgICAgIEFic3RyYWN0T2JzZXJ2ZXIuY2FsbCh0aGlzKTtcbiAgICB9XG5cbiAgICBJbm5lck9ic2VydmVyLnByb3RvdHlwZS5uZXh0ID0gZnVuY3Rpb24gKHgpIHsgdGhpcy5fby5vbk5leHQoeCk7IH07XG4gICAgSW5uZXJPYnNlcnZlci5wcm90b3R5cGUuZXJyb3IgPSBmdW5jdGlvbiAoZSkgeyB0aGlzLl9yZWN1cnNlKGUpOyB9O1xuICAgIElubmVyT2JzZXJ2ZXIucHJvdG90eXBlLmNvbXBsZXRlZCA9IGZ1bmN0aW9uICgpIHsgdGhpcy5fby5vbkNvbXBsZXRlZCgpOyB9O1xuXG4gICAgcmV0dXJuIENhdGNoRXJyb3JPYnNlcnZhYmxlO1xuICB9KE9ic2VydmFibGVCYXNlKSk7XG5cbiAgRW51bWVyYWJsZS5wcm90b3R5cGUuY2F0Y2hFcnJvciA9IGZ1bmN0aW9uICgpIHtcbiAgICByZXR1cm4gbmV3IENhdGNoRXJyb3JPYnNlcnZhYmxlKHRoaXMpO1xuICB9O1xuXG4gIEVudW1lcmFibGUucHJvdG90eXBlLmNhdGNoRXJyb3JXaGVuID0gZnVuY3Rpb24gKG5vdGlmaWNhdGlvbkhhbmRsZXIpIHtcbiAgICB2YXIgc291cmNlcyA9IHRoaXM7XG4gICAgcmV0dXJuIG5ldyBBbm9ueW1vdXNPYnNlcnZhYmxlKGZ1bmN0aW9uIChvKSB7XG4gICAgICB2YXIgZXhjZXB0aW9ucyA9IG5ldyBTdWJqZWN0KCksXG4gICAgICAgIG5vdGlmaWVyID0gbmV3IFN1YmplY3QoKSxcbiAgICAgICAgaGFuZGxlZCA9IG5vdGlmaWNhdGlvbkhhbmRsZXIoZXhjZXB0aW9ucyksXG4gICAgICAgIG5vdGlmaWNhdGlvbkRpc3Bvc2FibGUgPSBoYW5kbGVkLnN1YnNjcmliZShub3RpZmllcik7XG5cbiAgICAgIHZhciBlID0gc291cmNlc1skaXRlcmF0b3IkXSgpO1xuXG4gICAgICB2YXIgc3RhdGUgPSB7IGlzRGlzcG9zZWQ6IGZhbHNlIH0sXG4gICAgICAgIGxhc3RFeGNlcHRpb24sXG4gICAgICAgIHN1YnNjcmlwdGlvbiA9IG5ldyBTZXJpYWxEaXNwb3NhYmxlKCk7XG4gICAgICB2YXIgY2FuY2VsYWJsZSA9IGN1cnJlbnRUaHJlYWRTY2hlZHVsZXIuc2NoZWR1bGVSZWN1cnNpdmUobnVsbCwgZnVuY3Rpb24gKF8sIHNlbGYpIHtcbiAgICAgICAgaWYgKHN0YXRlLmlzRGlzcG9zZWQpIHsgcmV0dXJuOyB9XG4gICAgICAgIHZhciBjdXJyZW50SXRlbSA9IHRyeUNhdGNoKGUubmV4dCkuY2FsbChlKTtcbiAgICAgICAgaWYgKGN1cnJlbnRJdGVtID09PSBlcnJvck9iaikgeyByZXR1cm4gby5vbkVycm9yKGN1cnJlbnRJdGVtLmUpOyB9XG5cbiAgICAgICAgaWYgKGN1cnJlbnRJdGVtLmRvbmUpIHtcbiAgICAgICAgICBpZiAobGFzdEV4Y2VwdGlvbikge1xuICAgICAgICAgICAgby5vbkVycm9yKGxhc3RFeGNlcHRpb24pO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBvLm9uQ29tcGxldGVkKCk7XG4gICAgICAgICAgfVxuICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIENoZWNrIGlmIHByb21pc2VcbiAgICAgICAgdmFyIGN1cnJlbnRWYWx1ZSA9IGN1cnJlbnRJdGVtLnZhbHVlO1xuICAgICAgICBpc1Byb21pc2UoY3VycmVudFZhbHVlKSAmJiAoY3VycmVudFZhbHVlID0gb2JzZXJ2YWJsZUZyb21Qcm9taXNlKGN1cnJlbnRWYWx1ZSkpO1xuXG4gICAgICAgIHZhciBvdXRlciA9IG5ldyBTaW5nbGVBc3NpZ25tZW50RGlzcG9zYWJsZSgpO1xuICAgICAgICB2YXIgaW5uZXIgPSBuZXcgU2luZ2xlQXNzaWdubWVudERpc3Bvc2FibGUoKTtcbiAgICAgICAgc3Vic2NyaXB0aW9uLnNldERpc3Bvc2FibGUobmV3IEJpbmFyeURpc3Bvc2FibGUoaW5uZXIsIG91dGVyKSk7XG4gICAgICAgIG91dGVyLnNldERpc3Bvc2FibGUoY3VycmVudFZhbHVlLnN1YnNjcmliZShcbiAgICAgICAgICBmdW5jdGlvbih4KSB7IG8ub25OZXh0KHgpOyB9LFxuICAgICAgICAgIGZ1bmN0aW9uIChleG4pIHtcbiAgICAgICAgICAgIGlubmVyLnNldERpc3Bvc2FibGUobm90aWZpZXIuc3Vic2NyaWJlKHNlbGYsIGZ1bmN0aW9uKGV4KSB7XG4gICAgICAgICAgICAgIG8ub25FcnJvcihleCk7XG4gICAgICAgICAgICB9LCBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgby5vbkNvbXBsZXRlZCgpO1xuICAgICAgICAgICAgfSkpO1xuXG4gICAgICAgICAgICBleGNlcHRpb25zLm9uTmV4dChleG4pO1xuICAgICAgICAgIH0sXG4gICAgICAgICAgZnVuY3Rpb24oKSB7IG8ub25Db21wbGV0ZWQoKTsgfSkpO1xuICAgICAgfSk7XG5cbiAgICAgIHJldHVybiBuZXcgTkFyeURpc3Bvc2FibGUoW25vdGlmaWNhdGlvbkRpc3Bvc2FibGUsIHN1YnNjcmlwdGlvbiwgY2FuY2VsYWJsZSwgbmV3IElzRGlzcG9zZWREaXNwb3NhYmxlKHN0YXRlKV0pO1xuICAgIH0pO1xuICB9O1xuXG4gIHZhciBSZXBlYXRFbnVtZXJhYmxlID0gKGZ1bmN0aW9uIChfX3N1cGVyX18pIHtcbiAgICBpbmhlcml0cyhSZXBlYXRFbnVtZXJhYmxlLCBfX3N1cGVyX18pO1xuXG4gICAgZnVuY3Rpb24gUmVwZWF0RW51bWVyYWJsZSh2LCBjKSB7XG4gICAgICB0aGlzLnYgPSB2O1xuICAgICAgdGhpcy5jID0gYyA9PSBudWxsID8gLTEgOiBjO1xuICAgIH1cbiAgICBSZXBlYXRFbnVtZXJhYmxlLnByb3RvdHlwZVskaXRlcmF0b3IkXSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgIHJldHVybiBuZXcgUmVwZWF0RW51bWVyYXRvcih0aGlzKTtcbiAgICB9O1xuXG4gICAgZnVuY3Rpb24gUmVwZWF0RW51bWVyYXRvcihwKSB7XG4gICAgICB0aGlzLnYgPSBwLnY7XG4gICAgICB0aGlzLmwgPSBwLmM7XG4gICAgfVxuICAgIFJlcGVhdEVudW1lcmF0b3IucHJvdG90eXBlLm5leHQgPSBmdW5jdGlvbiAoKSB7XG4gICAgICBpZiAodGhpcy5sID09PSAwKSB7IHJldHVybiBkb25lRW51bWVyYXRvcjsgfVxuICAgICAgaWYgKHRoaXMubCA+IDApIHsgdGhpcy5sLS07IH1cbiAgICAgIHJldHVybiB7IGRvbmU6IGZhbHNlLCB2YWx1ZTogdGhpcy52IH07XG4gICAgfTtcblxuICAgIHJldHVybiBSZXBlYXRFbnVtZXJhYmxlO1xuICB9KEVudW1lcmFibGUpKTtcblxuICB2YXIgZW51bWVyYWJsZVJlcGVhdCA9IEVudW1lcmFibGUucmVwZWF0ID0gZnVuY3Rpb24gKHZhbHVlLCByZXBlYXRDb3VudCkge1xuICAgIHJldHVybiBuZXcgUmVwZWF0RW51bWVyYWJsZSh2YWx1ZSwgcmVwZWF0Q291bnQpO1xuICB9O1xuXG4gIHZhciBPZkVudW1lcmFibGUgPSAoZnVuY3Rpb24oX19zdXBlcl9fKSB7XG4gICAgaW5oZXJpdHMoT2ZFbnVtZXJhYmxlLCBfX3N1cGVyX18pO1xuICAgIGZ1bmN0aW9uIE9mRW51bWVyYWJsZShzLCBmbiwgdGhpc0FyZykge1xuICAgICAgdGhpcy5zID0gcztcbiAgICAgIHRoaXMuZm4gPSBmbiA/IGJpbmRDYWxsYmFjayhmbiwgdGhpc0FyZywgMykgOiBudWxsO1xuICAgIH1cbiAgICBPZkVudW1lcmFibGUucHJvdG90eXBlWyRpdGVyYXRvciRdID0gZnVuY3Rpb24gKCkge1xuICAgICAgcmV0dXJuIG5ldyBPZkVudW1lcmF0b3IodGhpcyk7XG4gICAgfTtcblxuICAgIGZ1bmN0aW9uIE9mRW51bWVyYXRvcihwKSB7XG4gICAgICB0aGlzLmkgPSAtMTtcbiAgICAgIHRoaXMucyA9IHAucztcbiAgICAgIHRoaXMubCA9IHRoaXMucy5sZW5ndGg7XG4gICAgICB0aGlzLmZuID0gcC5mbjtcbiAgICB9XG4gICAgT2ZFbnVtZXJhdG9yLnByb3RvdHlwZS5uZXh0ID0gZnVuY3Rpb24gKCkge1xuICAgICByZXR1cm4gKyt0aGlzLmkgPCB0aGlzLmwgP1xuICAgICAgIHsgZG9uZTogZmFsc2UsIHZhbHVlOiAhdGhpcy5mbiA/IHRoaXMuc1t0aGlzLmldIDogdGhpcy5mbih0aGlzLnNbdGhpcy5pXSwgdGhpcy5pLCB0aGlzLnMpIH0gOlxuICAgICAgIGRvbmVFbnVtZXJhdG9yO1xuICAgIH07XG5cbiAgICByZXR1cm4gT2ZFbnVtZXJhYmxlO1xuICB9KEVudW1lcmFibGUpKTtcblxuICB2YXIgZW51bWVyYWJsZU9mID0gRW51bWVyYWJsZS5vZiA9IGZ1bmN0aW9uIChzb3VyY2UsIHNlbGVjdG9yLCB0aGlzQXJnKSB7XG4gICAgcmV0dXJuIG5ldyBPZkVudW1lcmFibGUoc291cmNlLCBzZWxlY3RvciwgdGhpc0FyZyk7XG4gIH07XG5cbnZhciBPYnNlcnZlT25PYnNlcnZhYmxlID0gKGZ1bmN0aW9uIChfX3N1cGVyX18pIHtcbiAgaW5oZXJpdHMoT2JzZXJ2ZU9uT2JzZXJ2YWJsZSwgX19zdXBlcl9fKTtcbiAgZnVuY3Rpb24gT2JzZXJ2ZU9uT2JzZXJ2YWJsZShzb3VyY2UsIHMpIHtcbiAgICB0aGlzLnNvdXJjZSA9IHNvdXJjZTtcbiAgICB0aGlzLl9zID0gcztcbiAgICBfX3N1cGVyX18uY2FsbCh0aGlzKTtcbiAgfVxuXG4gIE9ic2VydmVPbk9ic2VydmFibGUucHJvdG90eXBlLnN1YnNjcmliZUNvcmUgPSBmdW5jdGlvbiAobykge1xuICAgIHJldHVybiB0aGlzLnNvdXJjZS5zdWJzY3JpYmUobmV3IE9ic2VydmVPbk9ic2VydmVyKHRoaXMuX3MsIG8pKTtcbiAgfTtcblxuICByZXR1cm4gT2JzZXJ2ZU9uT2JzZXJ2YWJsZTtcbn0oT2JzZXJ2YWJsZUJhc2UpKTtcblxuICAgLyoqXG4gICAqICBXcmFwcyB0aGUgc291cmNlIHNlcXVlbmNlIGluIG9yZGVyIHRvIHJ1biBpdHMgb2JzZXJ2ZXIgY2FsbGJhY2tzIG9uIHRoZSBzcGVjaWZpZWQgc2NoZWR1bGVyLlxuICAgKlxuICAgKiAgVGhpcyBvbmx5IGludm9rZXMgb2JzZXJ2ZXIgY2FsbGJhY2tzIG9uIGEgc2NoZWR1bGVyLiBJbiBjYXNlIHRoZSBzdWJzY3JpcHRpb24gYW5kL29yIHVuc3Vic2NyaXB0aW9uIGFjdGlvbnMgaGF2ZSBzaWRlLWVmZmVjdHNcbiAgICogIHRoYXQgcmVxdWlyZSB0byBiZSBydW4gb24gYSBzY2hlZHVsZXIsIHVzZSBzdWJzY3JpYmVPbi5cbiAgICpcbiAgICogIEBwYXJhbSB7U2NoZWR1bGVyfSBzY2hlZHVsZXIgU2NoZWR1bGVyIHRvIG5vdGlmeSBvYnNlcnZlcnMgb24uXG4gICAqICBAcmV0dXJucyB7T2JzZXJ2YWJsZX0gVGhlIHNvdXJjZSBzZXF1ZW5jZSB3aG9zZSBvYnNlcnZhdGlvbnMgaGFwcGVuIG9uIHRoZSBzcGVjaWZpZWQgc2NoZWR1bGVyLlxuICAgKi9cbiAgb2JzZXJ2YWJsZVByb3RvLm9ic2VydmVPbiA9IGZ1bmN0aW9uIChzY2hlZHVsZXIpIHtcbiAgICByZXR1cm4gbmV3IE9ic2VydmVPbk9ic2VydmFibGUodGhpcywgc2NoZWR1bGVyKTtcbiAgfTtcblxuICB2YXIgU3Vic2NyaWJlT25PYnNlcnZhYmxlID0gKGZ1bmN0aW9uIChfX3N1cGVyX18pIHtcbiAgICBpbmhlcml0cyhTdWJzY3JpYmVPbk9ic2VydmFibGUsIF9fc3VwZXJfXyk7XG4gICAgZnVuY3Rpb24gU3Vic2NyaWJlT25PYnNlcnZhYmxlKHNvdXJjZSwgcykge1xuICAgICAgdGhpcy5zb3VyY2UgPSBzb3VyY2U7XG4gICAgICB0aGlzLl9zID0gcztcbiAgICAgIF9fc3VwZXJfXy5jYWxsKHRoaXMpO1xuICAgIH1cblxuICAgIGZ1bmN0aW9uIHNjaGVkdWxlTWV0aG9kKHNjaGVkdWxlciwgc3RhdGUpIHtcbiAgICAgIHZhciBzb3VyY2UgPSBzdGF0ZVswXSwgZCA9IHN0YXRlWzFdLCBvID0gc3RhdGVbMl07XG4gICAgICBkLnNldERpc3Bvc2FibGUobmV3IFNjaGVkdWxlZERpc3Bvc2FibGUoc2NoZWR1bGVyLCBzb3VyY2Uuc3Vic2NyaWJlKG8pKSk7XG4gICAgfVxuXG4gICAgU3Vic2NyaWJlT25PYnNlcnZhYmxlLnByb3RvdHlwZS5zdWJzY3JpYmVDb3JlID0gZnVuY3Rpb24gKG8pIHtcbiAgICAgIHZhciBtID0gbmV3IFNpbmdsZUFzc2lnbm1lbnREaXNwb3NhYmxlKCksIGQgPSBuZXcgU2VyaWFsRGlzcG9zYWJsZSgpO1xuICAgICAgZC5zZXREaXNwb3NhYmxlKG0pO1xuICAgICAgbS5zZXREaXNwb3NhYmxlKHRoaXMuX3Muc2NoZWR1bGUoW3RoaXMuc291cmNlLCBkLCBvXSwgc2NoZWR1bGVNZXRob2QpKTtcbiAgICAgIHJldHVybiBkO1xuICAgIH07XG5cbiAgICByZXR1cm4gU3Vic2NyaWJlT25PYnNlcnZhYmxlO1xuICB9KE9ic2VydmFibGVCYXNlKSk7XG5cbiAgIC8qKlxuICAgKiAgV3JhcHMgdGhlIHNvdXJjZSBzZXF1ZW5jZSBpbiBvcmRlciB0byBydW4gaXRzIHN1YnNjcmlwdGlvbiBhbmQgdW5zdWJzY3JpcHRpb24gbG9naWMgb24gdGhlIHNwZWNpZmllZCBzY2hlZHVsZXIuIFRoaXMgb3BlcmF0aW9uIGlzIG5vdCBjb21tb25seSB1c2VkO1xuICAgKiAgc2VlIHRoZSByZW1hcmtzIHNlY3Rpb24gZm9yIG1vcmUgaW5mb3JtYXRpb24gb24gdGhlIGRpc3RpbmN0aW9uIGJldHdlZW4gc3Vic2NyaWJlT24gYW5kIG9ic2VydmVPbi5cblxuICAgKiAgVGhpcyBvbmx5IHBlcmZvcm1zIHRoZSBzaWRlLWVmZmVjdHMgb2Ygc3Vic2NyaXB0aW9uIGFuZCB1bnN1YnNjcmlwdGlvbiBvbiB0aGUgc3BlY2lmaWVkIHNjaGVkdWxlci4gSW4gb3JkZXIgdG8gaW52b2tlIG9ic2VydmVyXG4gICAqICBjYWxsYmFja3Mgb24gYSBzY2hlZHVsZXIsIHVzZSBvYnNlcnZlT24uXG5cbiAgICogIEBwYXJhbSB7U2NoZWR1bGVyfSBzY2hlZHVsZXIgU2NoZWR1bGVyIHRvIHBlcmZvcm0gc3Vic2NyaXB0aW9uIGFuZCB1bnN1YnNjcmlwdGlvbiBhY3Rpb25zIG9uLlxuICAgKiAgQHJldHVybnMge09ic2VydmFibGV9IFRoZSBzb3VyY2Ugc2VxdWVuY2Ugd2hvc2Ugc3Vic2NyaXB0aW9ucyBhbmQgdW5zdWJzY3JpcHRpb25zIGhhcHBlbiBvbiB0aGUgc3BlY2lmaWVkIHNjaGVkdWxlci5cbiAgICovXG4gIG9ic2VydmFibGVQcm90by5zdWJzY3JpYmVPbiA9IGZ1bmN0aW9uIChzY2hlZHVsZXIpIHtcbiAgICByZXR1cm4gbmV3IFN1YnNjcmliZU9uT2JzZXJ2YWJsZSh0aGlzLCBzY2hlZHVsZXIpO1xuICB9O1xuXG4gIHZhciBGcm9tUHJvbWlzZU9ic2VydmFibGUgPSAoZnVuY3Rpb24oX19zdXBlcl9fKSB7XG4gICAgaW5oZXJpdHMoRnJvbVByb21pc2VPYnNlcnZhYmxlLCBfX3N1cGVyX18pO1xuICAgIGZ1bmN0aW9uIEZyb21Qcm9taXNlT2JzZXJ2YWJsZShwKSB7XG4gICAgICB0aGlzLnAgPSBwO1xuICAgICAgX19zdXBlcl9fLmNhbGwodGhpcyk7XG4gICAgfVxuXG4gICAgRnJvbVByb21pc2VPYnNlcnZhYmxlLnByb3RvdHlwZS5zdWJzY3JpYmVDb3JlID0gZnVuY3Rpb24obykge1xuICAgICAgdGhpcy5wXG4gICAgICAgIC50aGVuKGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgby5vbk5leHQoZGF0YSk7XG4gICAgICAgICAgby5vbkNvbXBsZXRlZCgpO1xuICAgICAgICB9LCBmdW5jdGlvbiAoZXJyKSB7XG4gICAgICAgICAgby5vbkVycm9yKGVycik7XG4gICAgICAgIH0pO1xuICAgICAgcmV0dXJuIGRpc3Bvc2FibGVFbXB0eTtcbiAgICB9O1xuXG4gICAgcmV0dXJuIEZyb21Qcm9taXNlT2JzZXJ2YWJsZTtcbiAgfShPYnNlcnZhYmxlQmFzZSkpO1xuXG4gIC8qKlxuICAqIENvbnZlcnRzIGEgUHJvbWlzZSB0byBhbiBPYnNlcnZhYmxlIHNlcXVlbmNlXG4gICogQHBhcmFtIHtQcm9taXNlfSBBbiBFUzYgQ29tcGxpYW50IHByb21pc2UuXG4gICogQHJldHVybnMge09ic2VydmFibGV9IEFuIE9ic2VydmFibGUgc2VxdWVuY2Ugd2hpY2ggd3JhcHMgdGhlIGV4aXN0aW5nIHByb21pc2Ugc3VjY2VzcyBhbmQgZmFpbHVyZS5cbiAgKi9cbiAgdmFyIG9ic2VydmFibGVGcm9tUHJvbWlzZSA9IE9ic2VydmFibGUuZnJvbVByb21pc2UgPSBmdW5jdGlvbiAocHJvbWlzZSkge1xuICAgIHJldHVybiBuZXcgRnJvbVByb21pc2VPYnNlcnZhYmxlKHByb21pc2UpO1xuICB9O1xuXG4gIC8qXG4gICAqIENvbnZlcnRzIGFuIGV4aXN0aW5nIG9ic2VydmFibGUgc2VxdWVuY2UgdG8gYW4gRVM2IENvbXBhdGlibGUgUHJvbWlzZVxuICAgKiBAZXhhbXBsZVxuICAgKiB2YXIgcHJvbWlzZSA9IFJ4Lk9ic2VydmFibGUucmV0dXJuKDQyKS50b1Byb21pc2UoUlNWUC5Qcm9taXNlKTtcbiAgICpcbiAgICogLy8gV2l0aCBjb25maWdcbiAgICogUnguY29uZmlnLlByb21pc2UgPSBSU1ZQLlByb21pc2U7XG4gICAqIHZhciBwcm9taXNlID0gUnguT2JzZXJ2YWJsZS5yZXR1cm4oNDIpLnRvUHJvbWlzZSgpO1xuICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBbcHJvbWlzZUN0b3JdIFRoZSBjb25zdHJ1Y3RvciBvZiB0aGUgcHJvbWlzZS4gSWYgbm90IHByb3ZpZGVkLCBpdCBsb29rcyBmb3IgaXQgaW4gUnguY29uZmlnLlByb21pc2UuXG4gICAqIEByZXR1cm5zIHtQcm9taXNlfSBBbiBFUzYgY29tcGF0aWJsZSBwcm9taXNlIHdpdGggdGhlIGxhc3QgdmFsdWUgZnJvbSB0aGUgb2JzZXJ2YWJsZSBzZXF1ZW5jZS5cbiAgICovXG4gIG9ic2VydmFibGVQcm90by50b1Byb21pc2UgPSBmdW5jdGlvbiAocHJvbWlzZUN0b3IpIHtcbiAgICBwcm9taXNlQ3RvciB8fCAocHJvbWlzZUN0b3IgPSBSeC5jb25maWcuUHJvbWlzZSk7XG4gICAgaWYgKCFwcm9taXNlQ3RvcikgeyB0aHJvdyBuZXcgTm90U3VwcG9ydGVkRXJyb3IoJ1Byb21pc2UgdHlwZSBub3QgcHJvdmlkZWQgbm9yIGluIFJ4LmNvbmZpZy5Qcm9taXNlJyk7IH1cbiAgICB2YXIgc291cmNlID0gdGhpcztcbiAgICByZXR1cm4gbmV3IHByb21pc2VDdG9yKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHtcbiAgICAgIC8vIE5vIGNhbmNlbGxhdGlvbiBjYW4gYmUgZG9uZVxuICAgICAgdmFyIHZhbHVlO1xuICAgICAgc291cmNlLnN1YnNjcmliZShmdW5jdGlvbiAodikge1xuICAgICAgICB2YWx1ZSA9IHY7XG4gICAgICB9LCByZWplY3QsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmVzb2x2ZSh2YWx1ZSk7XG4gICAgICB9KTtcbiAgICB9KTtcbiAgfTtcblxuICB2YXIgVG9BcnJheU9ic2VydmFibGUgPSAoZnVuY3Rpb24oX19zdXBlcl9fKSB7XG4gICAgaW5oZXJpdHMoVG9BcnJheU9ic2VydmFibGUsIF9fc3VwZXJfXyk7XG4gICAgZnVuY3Rpb24gVG9BcnJheU9ic2VydmFibGUoc291cmNlKSB7XG4gICAgICB0aGlzLnNvdXJjZSA9IHNvdXJjZTtcbiAgICAgIF9fc3VwZXJfXy5jYWxsKHRoaXMpO1xuICAgIH1cblxuICAgIFRvQXJyYXlPYnNlcnZhYmxlLnByb3RvdHlwZS5zdWJzY3JpYmVDb3JlID0gZnVuY3Rpb24obykge1xuICAgICAgcmV0dXJuIHRoaXMuc291cmNlLnN1YnNjcmliZShuZXcgSW5uZXJPYnNlcnZlcihvKSk7XG4gICAgfTtcblxuICAgIGluaGVyaXRzKElubmVyT2JzZXJ2ZXIsIEFic3RyYWN0T2JzZXJ2ZXIpO1xuICAgIGZ1bmN0aW9uIElubmVyT2JzZXJ2ZXIobykge1xuICAgICAgdGhpcy5vID0gbztcbiAgICAgIHRoaXMuYSA9IFtdO1xuICAgICAgQWJzdHJhY3RPYnNlcnZlci5jYWxsKHRoaXMpO1xuICAgIH1cbiAgICBcbiAgICBJbm5lck9ic2VydmVyLnByb3RvdHlwZS5uZXh0ID0gZnVuY3Rpb24gKHgpIHsgdGhpcy5hLnB1c2goeCk7IH07XG4gICAgSW5uZXJPYnNlcnZlci5wcm90b3R5cGUuZXJyb3IgPSBmdW5jdGlvbiAoZSkgeyB0aGlzLm8ub25FcnJvcihlKTsgIH07XG4gICAgSW5uZXJPYnNlcnZlci5wcm90b3R5cGUuY29tcGxldGVkID0gZnVuY3Rpb24gKCkgeyB0aGlzLm8ub25OZXh0KHRoaXMuYSk7IHRoaXMuby5vbkNvbXBsZXRlZCgpOyB9O1xuXG4gICAgcmV0dXJuIFRvQXJyYXlPYnNlcnZhYmxlO1xuICB9KE9ic2VydmFibGVCYXNlKSk7XG5cbiAgLyoqXG4gICogQ3JlYXRlcyBhbiBhcnJheSBmcm9tIGFuIG9ic2VydmFibGUgc2VxdWVuY2UuXG4gICogQHJldHVybnMge09ic2VydmFibGV9IEFuIG9ic2VydmFibGUgc2VxdWVuY2UgY29udGFpbmluZyBhIHNpbmdsZSBlbGVtZW50IHdpdGggYSBsaXN0IGNvbnRhaW5pbmcgYWxsIHRoZSBlbGVtZW50cyBvZiB0aGUgc291cmNlIHNlcXVlbmNlLlxuICAqL1xuICBvYnNlcnZhYmxlUHJvdG8udG9BcnJheSA9IGZ1bmN0aW9uICgpIHtcbiAgICByZXR1cm4gbmV3IFRvQXJyYXlPYnNlcnZhYmxlKHRoaXMpO1xuICB9O1xuXG4gIC8qKlxuICAgKiAgQ3JlYXRlcyBhbiBvYnNlcnZhYmxlIHNlcXVlbmNlIGZyb20gYSBzcGVjaWZpZWQgc3Vic2NyaWJlIG1ldGhvZCBpbXBsZW1lbnRhdGlvbi5cbiAgICogQGV4YW1wbGVcbiAgICogIHZhciByZXMgPSBSeC5PYnNlcnZhYmxlLmNyZWF0ZShmdW5jdGlvbiAob2JzZXJ2ZXIpIHsgcmV0dXJuIGZ1bmN0aW9uICgpIHsgfSApO1xuICAgKiAgdmFyIHJlcyA9IFJ4Lk9ic2VydmFibGUuY3JlYXRlKGZ1bmN0aW9uIChvYnNlcnZlcikgeyByZXR1cm4gUnguRGlzcG9zYWJsZS5lbXB0eTsgfSApO1xuICAgKiAgdmFyIHJlcyA9IFJ4Lk9ic2VydmFibGUuY3JlYXRlKGZ1bmN0aW9uIChvYnNlcnZlcikgeyB9ICk7XG4gICAqIEBwYXJhbSB7RnVuY3Rpb259IHN1YnNjcmliZSBJbXBsZW1lbnRhdGlvbiBvZiB0aGUgcmVzdWx0aW5nIG9ic2VydmFibGUgc2VxdWVuY2UncyBzdWJzY3JpYmUgbWV0aG9kLCByZXR1cm5pbmcgYSBmdW5jdGlvbiB0aGF0IHdpbGwgYmUgd3JhcHBlZCBpbiBhIERpc3Bvc2FibGUuXG4gICAqIEByZXR1cm5zIHtPYnNlcnZhYmxlfSBUaGUgb2JzZXJ2YWJsZSBzZXF1ZW5jZSB3aXRoIHRoZSBzcGVjaWZpZWQgaW1wbGVtZW50YXRpb24gZm9yIHRoZSBTdWJzY3JpYmUgbWV0aG9kLlxuICAgKi9cbiAgT2JzZXJ2YWJsZS5jcmVhdGUgPSBmdW5jdGlvbiAoc3Vic2NyaWJlLCBwYXJlbnQpIHtcbiAgICByZXR1cm4gbmV3IEFub255bW91c09ic2VydmFibGUoc3Vic2NyaWJlLCBwYXJlbnQpO1xuICB9O1xuXG4gIHZhciBEZWZlciA9IChmdW5jdGlvbihfX3N1cGVyX18pIHtcbiAgICBpbmhlcml0cyhEZWZlciwgX19zdXBlcl9fKTtcbiAgICBmdW5jdGlvbiBEZWZlcihmYWN0b3J5KSB7XG4gICAgICB0aGlzLl9mID0gZmFjdG9yeTtcbiAgICAgIF9fc3VwZXJfXy5jYWxsKHRoaXMpO1xuICAgIH1cblxuICAgIERlZmVyLnByb3RvdHlwZS5zdWJzY3JpYmVDb3JlID0gZnVuY3Rpb24gKG8pIHtcbiAgICAgIHZhciByZXN1bHQgPSB0cnlDYXRjaCh0aGlzLl9mKSgpO1xuICAgICAgaWYgKHJlc3VsdCA9PT0gZXJyb3JPYmopIHsgcmV0dXJuIG9ic2VydmFibGVUaHJvdyhyZXN1bHQuZSkuc3Vic2NyaWJlKG8pO31cbiAgICAgIGlzUHJvbWlzZShyZXN1bHQpICYmIChyZXN1bHQgPSBvYnNlcnZhYmxlRnJvbVByb21pc2UocmVzdWx0KSk7XG4gICAgICByZXR1cm4gcmVzdWx0LnN1YnNjcmliZShvKTtcbiAgICB9O1xuXG4gICAgcmV0dXJuIERlZmVyO1xuICB9KE9ic2VydmFibGVCYXNlKSk7XG5cbiAgLyoqXG4gICAqICBSZXR1cm5zIGFuIG9ic2VydmFibGUgc2VxdWVuY2UgdGhhdCBpbnZva2VzIHRoZSBzcGVjaWZpZWQgZmFjdG9yeSBmdW5jdGlvbiB3aGVuZXZlciBhIG5ldyBvYnNlcnZlciBzdWJzY3JpYmVzLlxuICAgKlxuICAgKiBAZXhhbXBsZVxuICAgKiAgdmFyIHJlcyA9IFJ4Lk9ic2VydmFibGUuZGVmZXIoZnVuY3Rpb24gKCkgeyByZXR1cm4gUnguT2JzZXJ2YWJsZS5mcm9tQXJyYXkoWzEsMiwzXSk7IH0pO1xuICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBvYnNlcnZhYmxlRmFjdG9yeSBPYnNlcnZhYmxlIGZhY3RvcnkgZnVuY3Rpb24gdG8gaW52b2tlIGZvciBlYWNoIG9ic2VydmVyIHRoYXQgc3Vic2NyaWJlcyB0byB0aGUgcmVzdWx0aW5nIHNlcXVlbmNlIG9yIFByb21pc2UuXG4gICAqIEByZXR1cm5zIHtPYnNlcnZhYmxlfSBBbiBvYnNlcnZhYmxlIHNlcXVlbmNlIHdob3NlIG9ic2VydmVycyB0cmlnZ2VyIGFuIGludm9jYXRpb24gb2YgdGhlIGdpdmVuIG9ic2VydmFibGUgZmFjdG9yeSBmdW5jdGlvbi5cbiAgICovXG4gIHZhciBvYnNlcnZhYmxlRGVmZXIgPSBPYnNlcnZhYmxlLmRlZmVyID0gZnVuY3Rpb24gKG9ic2VydmFibGVGYWN0b3J5KSB7XG4gICAgcmV0dXJuIG5ldyBEZWZlcihvYnNlcnZhYmxlRmFjdG9yeSk7XG4gIH07XG5cbiAgdmFyIEVtcHR5T2JzZXJ2YWJsZSA9IChmdW5jdGlvbihfX3N1cGVyX18pIHtcbiAgICBpbmhlcml0cyhFbXB0eU9ic2VydmFibGUsIF9fc3VwZXJfXyk7XG4gICAgZnVuY3Rpb24gRW1wdHlPYnNlcnZhYmxlKHNjaGVkdWxlcikge1xuICAgICAgdGhpcy5zY2hlZHVsZXIgPSBzY2hlZHVsZXI7XG4gICAgICBfX3N1cGVyX18uY2FsbCh0aGlzKTtcbiAgICB9XG5cbiAgICBFbXB0eU9ic2VydmFibGUucHJvdG90eXBlLnN1YnNjcmliZUNvcmUgPSBmdW5jdGlvbiAob2JzZXJ2ZXIpIHtcbiAgICAgIHZhciBzaW5rID0gbmV3IEVtcHR5U2luayhvYnNlcnZlciwgdGhpcy5zY2hlZHVsZXIpO1xuICAgICAgcmV0dXJuIHNpbmsucnVuKCk7XG4gICAgfTtcblxuICAgIGZ1bmN0aW9uIEVtcHR5U2luayhvYnNlcnZlciwgc2NoZWR1bGVyKSB7XG4gICAgICB0aGlzLm9ic2VydmVyID0gb2JzZXJ2ZXI7XG4gICAgICB0aGlzLnNjaGVkdWxlciA9IHNjaGVkdWxlcjtcbiAgICB9XG5cbiAgICBmdW5jdGlvbiBzY2hlZHVsZUl0ZW0ocywgc3RhdGUpIHtcbiAgICAgIHN0YXRlLm9uQ29tcGxldGVkKCk7XG4gICAgICByZXR1cm4gZGlzcG9zYWJsZUVtcHR5O1xuICAgIH1cblxuICAgIEVtcHR5U2luay5wcm90b3R5cGUucnVuID0gZnVuY3Rpb24gKCkge1xuICAgICAgdmFyIHN0YXRlID0gdGhpcy5vYnNlcnZlcjtcbiAgICAgIHJldHVybiB0aGlzLnNjaGVkdWxlciA9PT0gaW1tZWRpYXRlU2NoZWR1bGVyID9cbiAgICAgICAgc2NoZWR1bGVJdGVtKG51bGwsIHN0YXRlKSA6XG4gICAgICAgIHRoaXMuc2NoZWR1bGVyLnNjaGVkdWxlKHN0YXRlLCBzY2hlZHVsZUl0ZW0pO1xuICAgIH07XG5cbiAgICByZXR1cm4gRW1wdHlPYnNlcnZhYmxlO1xuICB9KE9ic2VydmFibGVCYXNlKSk7XG5cbiAgdmFyIEVNUFRZX09CU0VSVkFCTEUgPSBuZXcgRW1wdHlPYnNlcnZhYmxlKGltbWVkaWF0ZVNjaGVkdWxlcik7XG5cbiAgLyoqXG4gICAqICBSZXR1cm5zIGFuIGVtcHR5IG9ic2VydmFibGUgc2VxdWVuY2UsIHVzaW5nIHRoZSBzcGVjaWZpZWQgc2NoZWR1bGVyIHRvIHNlbmQgb3V0IHRoZSBzaW5nbGUgT25Db21wbGV0ZWQgbWVzc2FnZS5cbiAgICpcbiAgICogQGV4YW1wbGVcbiAgICogIHZhciByZXMgPSBSeC5PYnNlcnZhYmxlLmVtcHR5KCk7XG4gICAqICB2YXIgcmVzID0gUnguT2JzZXJ2YWJsZS5lbXB0eShSeC5TY2hlZHVsZXIudGltZW91dCk7XG4gICAqIEBwYXJhbSB7U2NoZWR1bGVyfSBbc2NoZWR1bGVyXSBTY2hlZHVsZXIgdG8gc2VuZCB0aGUgdGVybWluYXRpb24gY2FsbCBvbi5cbiAgICogQHJldHVybnMge09ic2VydmFibGV9IEFuIG9ic2VydmFibGUgc2VxdWVuY2Ugd2l0aCBubyBlbGVtZW50cy5cbiAgICovXG4gIHZhciBvYnNlcnZhYmxlRW1wdHkgPSBPYnNlcnZhYmxlLmVtcHR5ID0gZnVuY3Rpb24gKHNjaGVkdWxlcikge1xuICAgIGlzU2NoZWR1bGVyKHNjaGVkdWxlcikgfHwgKHNjaGVkdWxlciA9IGltbWVkaWF0ZVNjaGVkdWxlcik7XG4gICAgcmV0dXJuIHNjaGVkdWxlciA9PT0gaW1tZWRpYXRlU2NoZWR1bGVyID8gRU1QVFlfT0JTRVJWQUJMRSA6IG5ldyBFbXB0eU9ic2VydmFibGUoc2NoZWR1bGVyKTtcbiAgfTtcblxuICB2YXIgRnJvbU9ic2VydmFibGUgPSAoZnVuY3Rpb24oX19zdXBlcl9fKSB7XG4gICAgaW5oZXJpdHMoRnJvbU9ic2VydmFibGUsIF9fc3VwZXJfXyk7XG4gICAgZnVuY3Rpb24gRnJvbU9ic2VydmFibGUoaXRlcmFibGUsIG1hcHBlciwgc2NoZWR1bGVyKSB7XG4gICAgICB0aGlzLml0ZXJhYmxlID0gaXRlcmFibGU7XG4gICAgICB0aGlzLm1hcHBlciA9IG1hcHBlcjtcbiAgICAgIHRoaXMuc2NoZWR1bGVyID0gc2NoZWR1bGVyO1xuICAgICAgX19zdXBlcl9fLmNhbGwodGhpcyk7XG4gICAgfVxuXG4gICAgRnJvbU9ic2VydmFibGUucHJvdG90eXBlLnN1YnNjcmliZUNvcmUgPSBmdW5jdGlvbiAobykge1xuICAgICAgdmFyIHNpbmsgPSBuZXcgRnJvbVNpbmsobywgdGhpcyk7XG4gICAgICByZXR1cm4gc2luay5ydW4oKTtcbiAgICB9O1xuXG4gICAgcmV0dXJuIEZyb21PYnNlcnZhYmxlO1xuICB9KE9ic2VydmFibGVCYXNlKSk7XG5cbiAgdmFyIEZyb21TaW5rID0gKGZ1bmN0aW9uICgpIHtcbiAgICBmdW5jdGlvbiBGcm9tU2luayhvLCBwYXJlbnQpIHtcbiAgICAgIHRoaXMubyA9IG87XG4gICAgICB0aGlzLnBhcmVudCA9IHBhcmVudDtcbiAgICB9XG5cbiAgICBGcm9tU2luay5wcm90b3R5cGUucnVuID0gZnVuY3Rpb24gKCkge1xuICAgICAgdmFyIGxpc3QgPSBPYmplY3QodGhpcy5wYXJlbnQuaXRlcmFibGUpLFxuICAgICAgICAgIGl0ID0gZ2V0SXRlcmFibGUobGlzdCksXG4gICAgICAgICAgbyA9IHRoaXMubyxcbiAgICAgICAgICBtYXBwZXIgPSB0aGlzLnBhcmVudC5tYXBwZXI7XG5cbiAgICAgIGZ1bmN0aW9uIGxvb3BSZWN1cnNpdmUoaSwgcmVjdXJzZSkge1xuICAgICAgICB2YXIgbmV4dCA9IHRyeUNhdGNoKGl0Lm5leHQpLmNhbGwoaXQpO1xuICAgICAgICBpZiAobmV4dCA9PT0gZXJyb3JPYmopIHsgcmV0dXJuIG8ub25FcnJvcihuZXh0LmUpOyB9XG4gICAgICAgIGlmIChuZXh0LmRvbmUpIHsgcmV0dXJuIG8ub25Db21wbGV0ZWQoKTsgfVxuXG4gICAgICAgIHZhciByZXN1bHQgPSBuZXh0LnZhbHVlO1xuXG4gICAgICAgIGlmIChpc0Z1bmN0aW9uKG1hcHBlcikpIHtcbiAgICAgICAgICByZXN1bHQgPSB0cnlDYXRjaChtYXBwZXIpKHJlc3VsdCwgaSk7XG4gICAgICAgICAgaWYgKHJlc3VsdCA9PT0gZXJyb3JPYmopIHsgcmV0dXJuIG8ub25FcnJvcihyZXN1bHQuZSk7IH1cbiAgICAgICAgfVxuXG4gICAgICAgIG8ub25OZXh0KHJlc3VsdCk7XG4gICAgICAgIHJlY3Vyc2UoaSArIDEpO1xuICAgICAgfVxuXG4gICAgICByZXR1cm4gdGhpcy5wYXJlbnQuc2NoZWR1bGVyLnNjaGVkdWxlUmVjdXJzaXZlKDAsIGxvb3BSZWN1cnNpdmUpO1xuICAgIH07XG5cbiAgICByZXR1cm4gRnJvbVNpbms7XG4gIH0oKSk7XG5cbiAgdmFyIG1heFNhZmVJbnRlZ2VyID0gTWF0aC5wb3coMiwgNTMpIC0gMTtcblxuICBmdW5jdGlvbiBTdHJpbmdJdGVyYWJsZShzKSB7XG4gICAgdGhpcy5fcyA9IHM7XG4gIH1cblxuICBTdHJpbmdJdGVyYWJsZS5wcm90b3R5cGVbJGl0ZXJhdG9yJF0gPSBmdW5jdGlvbiAoKSB7XG4gICAgcmV0dXJuIG5ldyBTdHJpbmdJdGVyYXRvcih0aGlzLl9zKTtcbiAgfTtcblxuICBmdW5jdGlvbiBTdHJpbmdJdGVyYXRvcihzKSB7XG4gICAgdGhpcy5fcyA9IHM7XG4gICAgdGhpcy5fbCA9IHMubGVuZ3RoO1xuICAgIHRoaXMuX2kgPSAwO1xuICB9XG5cbiAgU3RyaW5nSXRlcmF0b3IucHJvdG90eXBlWyRpdGVyYXRvciRdID0gZnVuY3Rpb24gKCkge1xuICAgIHJldHVybiB0aGlzO1xuICB9O1xuXG4gIFN0cmluZ0l0ZXJhdG9yLnByb3RvdHlwZS5uZXh0ID0gZnVuY3Rpb24gKCkge1xuICAgIHJldHVybiB0aGlzLl9pIDwgdGhpcy5fbCA/IHsgZG9uZTogZmFsc2UsIHZhbHVlOiB0aGlzLl9zLmNoYXJBdCh0aGlzLl9pKyspIH0gOiBkb25lRW51bWVyYXRvcjtcbiAgfTtcblxuICBmdW5jdGlvbiBBcnJheUl0ZXJhYmxlKGEpIHtcbiAgICB0aGlzLl9hID0gYTtcbiAgfVxuXG4gIEFycmF5SXRlcmFibGUucHJvdG90eXBlWyRpdGVyYXRvciRdID0gZnVuY3Rpb24gKCkge1xuICAgIHJldHVybiBuZXcgQXJyYXlJdGVyYXRvcih0aGlzLl9hKTtcbiAgfTtcblxuICBmdW5jdGlvbiBBcnJheUl0ZXJhdG9yKGEpIHtcbiAgICB0aGlzLl9hID0gYTtcbiAgICB0aGlzLl9sID0gdG9MZW5ndGgoYSk7XG4gICAgdGhpcy5faSA9IDA7XG4gIH1cblxuICBBcnJheUl0ZXJhdG9yLnByb3RvdHlwZVskaXRlcmF0b3IkXSA9IGZ1bmN0aW9uICgpIHtcbiAgICByZXR1cm4gdGhpcztcbiAgfTtcblxuICBBcnJheUl0ZXJhdG9yLnByb3RvdHlwZS5uZXh0ID0gZnVuY3Rpb24gKCkge1xuICAgIHJldHVybiB0aGlzLl9pIDwgdGhpcy5fbCA/IHsgZG9uZTogZmFsc2UsIHZhbHVlOiB0aGlzLl9hW3RoaXMuX2krK10gfSA6IGRvbmVFbnVtZXJhdG9yO1xuICB9O1xuXG4gIGZ1bmN0aW9uIG51bWJlcklzRmluaXRlKHZhbHVlKSB7XG4gICAgcmV0dXJuIHR5cGVvZiB2YWx1ZSA9PT0gJ251bWJlcicgJiYgcm9vdC5pc0Zpbml0ZSh2YWx1ZSk7XG4gIH1cblxuICBmdW5jdGlvbiBpc05hbihuKSB7XG4gICAgcmV0dXJuIG4gIT09IG47XG4gIH1cblxuICBmdW5jdGlvbiBnZXRJdGVyYWJsZShvKSB7XG4gICAgdmFyIGkgPSBvWyRpdGVyYXRvciRdLCBpdDtcbiAgICBpZiAoIWkgJiYgdHlwZW9mIG8gPT09ICdzdHJpbmcnKSB7XG4gICAgICBpdCA9IG5ldyBTdHJpbmdJdGVyYWJsZShvKTtcbiAgICAgIHJldHVybiBpdFskaXRlcmF0b3IkXSgpO1xuICAgIH1cbiAgICBpZiAoIWkgJiYgby5sZW5ndGggIT09IHVuZGVmaW5lZCkge1xuICAgICAgaXQgPSBuZXcgQXJyYXlJdGVyYWJsZShvKTtcbiAgICAgIHJldHVybiBpdFskaXRlcmF0b3IkXSgpO1xuICAgIH1cbiAgICBpZiAoIWkpIHsgdGhyb3cgbmV3IFR5cGVFcnJvcignT2JqZWN0IGlzIG5vdCBpdGVyYWJsZScpOyB9XG4gICAgcmV0dXJuIG9bJGl0ZXJhdG9yJF0oKTtcbiAgfVxuXG4gIGZ1bmN0aW9uIHNpZ24odmFsdWUpIHtcbiAgICB2YXIgbnVtYmVyID0gK3ZhbHVlO1xuICAgIGlmIChudW1iZXIgPT09IDApIHsgcmV0dXJuIG51bWJlcjsgfVxuICAgIGlmIChpc05hTihudW1iZXIpKSB7IHJldHVybiBudW1iZXI7IH1cbiAgICByZXR1cm4gbnVtYmVyIDwgMCA/IC0xIDogMTtcbiAgfVxuXG4gIGZ1bmN0aW9uIHRvTGVuZ3RoKG8pIHtcbiAgICB2YXIgbGVuID0gK28ubGVuZ3RoO1xuICAgIGlmIChpc05hTihsZW4pKSB7IHJldHVybiAwOyB9XG4gICAgaWYgKGxlbiA9PT0gMCB8fCAhbnVtYmVySXNGaW5pdGUobGVuKSkgeyByZXR1cm4gbGVuOyB9XG4gICAgbGVuID0gc2lnbihsZW4pICogTWF0aC5mbG9vcihNYXRoLmFicyhsZW4pKTtcbiAgICBpZiAobGVuIDw9IDApIHsgcmV0dXJuIDA7IH1cbiAgICBpZiAobGVuID4gbWF4U2FmZUludGVnZXIpIHsgcmV0dXJuIG1heFNhZmVJbnRlZ2VyOyB9XG4gICAgcmV0dXJuIGxlbjtcbiAgfVxuXG4gIC8qKlxuICAqIFRoaXMgbWV0aG9kIGNyZWF0ZXMgYSBuZXcgT2JzZXJ2YWJsZSBzZXF1ZW5jZSBmcm9tIGFuIGFycmF5LWxpa2Ugb3IgaXRlcmFibGUgb2JqZWN0LlxuICAqIEBwYXJhbSB7QW55fSBhcnJheUxpa2UgQW4gYXJyYXktbGlrZSBvciBpdGVyYWJsZSBvYmplY3QgdG8gY29udmVydCB0byBhbiBPYnNlcnZhYmxlIHNlcXVlbmNlLlxuICAqIEBwYXJhbSB7RnVuY3Rpb259IFttYXBGbl0gTWFwIGZ1bmN0aW9uIHRvIGNhbGwgb24gZXZlcnkgZWxlbWVudCBvZiB0aGUgYXJyYXkuXG4gICogQHBhcmFtIHtBbnl9IFt0aGlzQXJnXSBUaGUgY29udGV4dCB0byB1c2UgY2FsbGluZyB0aGUgbWFwRm4gaWYgcHJvdmlkZWQuXG4gICogQHBhcmFtIHtTY2hlZHVsZXJ9IFtzY2hlZHVsZXJdIE9wdGlvbmFsIHNjaGVkdWxlciB0byB1c2UgZm9yIHNjaGVkdWxpbmcuICBJZiBub3QgcHJvdmlkZWQsIGRlZmF1bHRzIHRvIFNjaGVkdWxlci5jdXJyZW50VGhyZWFkLlxuICAqL1xuICB2YXIgb2JzZXJ2YWJsZUZyb20gPSBPYnNlcnZhYmxlLmZyb20gPSBmdW5jdGlvbiAoaXRlcmFibGUsIG1hcEZuLCB0aGlzQXJnLCBzY2hlZHVsZXIpIHtcbiAgICBpZiAoaXRlcmFibGUgPT0gbnVsbCkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKCdpdGVyYWJsZSBjYW5ub3QgYmUgbnVsbC4nKVxuICAgIH1cbiAgICBpZiAobWFwRm4gJiYgIWlzRnVuY3Rpb24obWFwRm4pKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ21hcEZuIHdoZW4gcHJvdmlkZWQgbXVzdCBiZSBhIGZ1bmN0aW9uJyk7XG4gICAgfVxuICAgIGlmIChtYXBGbikge1xuICAgICAgdmFyIG1hcHBlciA9IGJpbmRDYWxsYmFjayhtYXBGbiwgdGhpc0FyZywgMik7XG4gICAgfVxuICAgIGlzU2NoZWR1bGVyKHNjaGVkdWxlcikgfHwgKHNjaGVkdWxlciA9IGN1cnJlbnRUaHJlYWRTY2hlZHVsZXIpO1xuICAgIHJldHVybiBuZXcgRnJvbU9ic2VydmFibGUoaXRlcmFibGUsIG1hcHBlciwgc2NoZWR1bGVyKTtcbiAgfVxuXG4gIHZhciBGcm9tQXJyYXlPYnNlcnZhYmxlID0gKGZ1bmN0aW9uKF9fc3VwZXJfXykge1xuICAgIGluaGVyaXRzKEZyb21BcnJheU9ic2VydmFibGUsIF9fc3VwZXJfXyk7XG4gICAgZnVuY3Rpb24gRnJvbUFycmF5T2JzZXJ2YWJsZShhcmdzLCBzY2hlZHVsZXIpIHtcbiAgICAgIHRoaXMuYXJncyA9IGFyZ3M7XG4gICAgICB0aGlzLnNjaGVkdWxlciA9IHNjaGVkdWxlcjtcbiAgICAgIF9fc3VwZXJfXy5jYWxsKHRoaXMpO1xuICAgIH1cblxuICAgIEZyb21BcnJheU9ic2VydmFibGUucHJvdG90eXBlLnN1YnNjcmliZUNvcmUgPSBmdW5jdGlvbiAob2JzZXJ2ZXIpIHtcbiAgICAgIHZhciBzaW5rID0gbmV3IEZyb21BcnJheVNpbmsob2JzZXJ2ZXIsIHRoaXMpO1xuICAgICAgcmV0dXJuIHNpbmsucnVuKCk7XG4gICAgfTtcblxuICAgIHJldHVybiBGcm9tQXJyYXlPYnNlcnZhYmxlO1xuICB9KE9ic2VydmFibGVCYXNlKSk7XG5cbiAgZnVuY3Rpb24gRnJvbUFycmF5U2luayhvYnNlcnZlciwgcGFyZW50KSB7XG4gICAgdGhpcy5vYnNlcnZlciA9IG9ic2VydmVyO1xuICAgIHRoaXMucGFyZW50ID0gcGFyZW50O1xuICB9XG5cbiAgRnJvbUFycmF5U2luay5wcm90b3R5cGUucnVuID0gZnVuY3Rpb24gKCkge1xuICAgIHZhciBvYnNlcnZlciA9IHRoaXMub2JzZXJ2ZXIsIGFyZ3MgPSB0aGlzLnBhcmVudC5hcmdzLCBsZW4gPSBhcmdzLmxlbmd0aDtcbiAgICBmdW5jdGlvbiBsb29wUmVjdXJzaXZlKGksIHJlY3Vyc2UpIHtcbiAgICAgIGlmIChpIDwgbGVuKSB7XG4gICAgICAgIG9ic2VydmVyLm9uTmV4dChhcmdzW2ldKTtcbiAgICAgICAgcmVjdXJzZShpICsgMSk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBvYnNlcnZlci5vbkNvbXBsZXRlZCgpO1xuICAgICAgfVxuICAgIH1cblxuICAgIHJldHVybiB0aGlzLnBhcmVudC5zY2hlZHVsZXIuc2NoZWR1bGVSZWN1cnNpdmUoMCwgbG9vcFJlY3Vyc2l2ZSk7XG4gIH07XG5cbiAgLyoqXG4gICogIENvbnZlcnRzIGFuIGFycmF5IHRvIGFuIG9ic2VydmFibGUgc2VxdWVuY2UsIHVzaW5nIGFuIG9wdGlvbmFsIHNjaGVkdWxlciB0byBlbnVtZXJhdGUgdGhlIGFycmF5LlxuICAqIEBkZXByZWNhdGVkIHVzZSBPYnNlcnZhYmxlLmZyb20gb3IgT2JzZXJ2YWJsZS5vZlxuICAqIEBwYXJhbSB7U2NoZWR1bGVyfSBbc2NoZWR1bGVyXSBTY2hlZHVsZXIgdG8gcnVuIHRoZSBlbnVtZXJhdGlvbiBvZiB0aGUgaW5wdXQgc2VxdWVuY2Ugb24uXG4gICogQHJldHVybnMge09ic2VydmFibGV9IFRoZSBvYnNlcnZhYmxlIHNlcXVlbmNlIHdob3NlIGVsZW1lbnRzIGFyZSBwdWxsZWQgZnJvbSB0aGUgZ2l2ZW4gZW51bWVyYWJsZSBzZXF1ZW5jZS5cbiAgKi9cbiAgdmFyIG9ic2VydmFibGVGcm9tQXJyYXkgPSBPYnNlcnZhYmxlLmZyb21BcnJheSA9IGZ1bmN0aW9uIChhcnJheSwgc2NoZWR1bGVyKSB7XG4gICAgaXNTY2hlZHVsZXIoc2NoZWR1bGVyKSB8fCAoc2NoZWR1bGVyID0gY3VycmVudFRocmVhZFNjaGVkdWxlcik7XG4gICAgcmV0dXJuIG5ldyBGcm9tQXJyYXlPYnNlcnZhYmxlKGFycmF5LCBzY2hlZHVsZXIpXG4gIH07XG5cbiAgdmFyIEdlbmVyYXRlT2JzZXJ2YWJsZSA9IChmdW5jdGlvbiAoX19zdXBlcl9fKSB7XG4gICAgaW5oZXJpdHMoR2VuZXJhdGVPYnNlcnZhYmxlLCBfX3N1cGVyX18pO1xuICAgIGZ1bmN0aW9uIEdlbmVyYXRlT2JzZXJ2YWJsZShzdGF0ZSwgY25kRm4sIGl0ckZuLCByZXNGbiwgcykge1xuICAgICAgdGhpcy5fc3RhdGUgPSBzdGF0ZTtcbiAgICAgIHRoaXMuX2NuZEZuID0gY25kRm47XG4gICAgICB0aGlzLl9pdHJGbiA9IGl0ckZuO1xuICAgICAgdGhpcy5fcmVzRm4gPSByZXNGbjtcbiAgICAgIHRoaXMuX3MgPSBzO1xuICAgICAgdGhpcy5fZmlyc3QgPSB0cnVlO1xuICAgICAgX19zdXBlcl9fLmNhbGwodGhpcyk7XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gc2NoZWR1bGVSZWN1cnNpdmUoc2VsZiwgcmVjdXJzZSkge1xuICAgICAgaWYgKHNlbGYuX2ZpcnN0KSB7XG4gICAgICAgIHNlbGYuX2ZpcnN0ID0gZmFsc2U7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBzZWxmLl9zdGF0ZSA9IHRyeUNhdGNoKHNlbGYuX2l0ckZuKShzZWxmLl9zdGF0ZSk7XG4gICAgICAgIGlmIChzZWxmLl9zdGF0ZSA9PT0gZXJyb3JPYmopIHsgcmV0dXJuIHNlbGYuX28ub25FcnJvcihzZWxmLl9zdGF0ZS5lKTsgfVxuICAgICAgfVxuICAgICAgdmFyIGhhc1Jlc3VsdCA9IHRyeUNhdGNoKHNlbGYuX2NuZEZuKShzZWxmLl9zdGF0ZSk7XG4gICAgICBpZiAoaGFzUmVzdWx0ID09PSBlcnJvck9iaikgeyByZXR1cm4gc2VsZi5fby5vbkVycm9yKGhhc1Jlc3VsdC5lKTsgfVxuICAgICAgaWYgKGhhc1Jlc3VsdCkge1xuICAgICAgICB2YXIgcmVzdWx0ID0gdHJ5Q2F0Y2goc2VsZi5fcmVzRm4pKHNlbGYuX3N0YXRlKTtcbiAgICAgICAgaWYgKHJlc3VsdCA9PT0gZXJyb3JPYmopIHsgcmV0dXJuIHNlbGYuX28ub25FcnJvcihyZXN1bHQuZSk7IH1cbiAgICAgICAgc2VsZi5fby5vbk5leHQocmVzdWx0KTtcbiAgICAgICAgcmVjdXJzZShzZWxmKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHNlbGYuX28ub25Db21wbGV0ZWQoKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICBHZW5lcmF0ZU9ic2VydmFibGUucHJvdG90eXBlLnN1YnNjcmliZUNvcmUgPSBmdW5jdGlvbiAobykge1xuICAgICAgdGhpcy5fbyA9IG87XG4gICAgICByZXR1cm4gdGhpcy5fcy5zY2hlZHVsZVJlY3Vyc2l2ZSh0aGlzLCBzY2hlZHVsZVJlY3Vyc2l2ZSk7XG4gICAgfTtcblxuICAgIHJldHVybiBHZW5lcmF0ZU9ic2VydmFibGU7XG4gIH0oT2JzZXJ2YWJsZUJhc2UpKTtcblxuICAvKipcbiAgICogIEdlbmVyYXRlcyBhbiBvYnNlcnZhYmxlIHNlcXVlbmNlIGJ5IHJ1bm5pbmcgYSBzdGF0ZS1kcml2ZW4gbG9vcCBwcm9kdWNpbmcgdGhlIHNlcXVlbmNlJ3MgZWxlbWVudHMsIHVzaW5nIHRoZSBzcGVjaWZpZWQgc2NoZWR1bGVyIHRvIHNlbmQgb3V0IG9ic2VydmVyIG1lc3NhZ2VzLlxuICAgKlxuICAgKiBAZXhhbXBsZVxuICAgKiAgdmFyIHJlcyA9IFJ4Lk9ic2VydmFibGUuZ2VuZXJhdGUoMCwgZnVuY3Rpb24gKHgpIHsgcmV0dXJuIHggPCAxMDsgfSwgZnVuY3Rpb24gKHgpIHsgcmV0dXJuIHggKyAxOyB9LCBmdW5jdGlvbiAoeCkgeyByZXR1cm4geDsgfSk7XG4gICAqICB2YXIgcmVzID0gUnguT2JzZXJ2YWJsZS5nZW5lcmF0ZSgwLCBmdW5jdGlvbiAoeCkgeyByZXR1cm4geCA8IDEwOyB9LCBmdW5jdGlvbiAoeCkgeyByZXR1cm4geCArIDE7IH0sIGZ1bmN0aW9uICh4KSB7IHJldHVybiB4OyB9LCBSeC5TY2hlZHVsZXIudGltZW91dCk7XG4gICAqIEBwYXJhbSB7TWl4ZWR9IGluaXRpYWxTdGF0ZSBJbml0aWFsIHN0YXRlLlxuICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBjb25kaXRpb24gQ29uZGl0aW9uIHRvIHRlcm1pbmF0ZSBnZW5lcmF0aW9uICh1cG9uIHJldHVybmluZyBmYWxzZSkuXG4gICAqIEBwYXJhbSB7RnVuY3Rpb259IGl0ZXJhdGUgSXRlcmF0aW9uIHN0ZXAgZnVuY3Rpb24uXG4gICAqIEBwYXJhbSB7RnVuY3Rpb259IHJlc3VsdFNlbGVjdG9yIFNlbGVjdG9yIGZ1bmN0aW9uIGZvciByZXN1bHRzIHByb2R1Y2VkIGluIHRoZSBzZXF1ZW5jZS5cbiAgICogQHBhcmFtIHtTY2hlZHVsZXJ9IFtzY2hlZHVsZXJdIFNjaGVkdWxlciBvbiB3aGljaCB0byBydW4gdGhlIGdlbmVyYXRvciBsb29wLiBJZiBub3QgcHJvdmlkZWQsIGRlZmF1bHRzIHRvIFNjaGVkdWxlci5jdXJyZW50VGhyZWFkLlxuICAgKiBAcmV0dXJucyB7T2JzZXJ2YWJsZX0gVGhlIGdlbmVyYXRlZCBzZXF1ZW5jZS5cbiAgICovXG4gIE9ic2VydmFibGUuZ2VuZXJhdGUgPSBmdW5jdGlvbiAoaW5pdGlhbFN0YXRlLCBjb25kaXRpb24sIGl0ZXJhdGUsIHJlc3VsdFNlbGVjdG9yLCBzY2hlZHVsZXIpIHtcbiAgICBpc1NjaGVkdWxlcihzY2hlZHVsZXIpIHx8IChzY2hlZHVsZXIgPSBjdXJyZW50VGhyZWFkU2NoZWR1bGVyKTtcbiAgICByZXR1cm4gbmV3IEdlbmVyYXRlT2JzZXJ2YWJsZShpbml0aWFsU3RhdGUsIGNvbmRpdGlvbiwgaXRlcmF0ZSwgcmVzdWx0U2VsZWN0b3IsIHNjaGVkdWxlcik7XG4gIH07XG5cbiAgZnVuY3Rpb24gb2JzZXJ2YWJsZU9mIChzY2hlZHVsZXIsIGFycmF5KSB7XG4gICAgaXNTY2hlZHVsZXIoc2NoZWR1bGVyKSB8fCAoc2NoZWR1bGVyID0gY3VycmVudFRocmVhZFNjaGVkdWxlcik7XG4gICAgcmV0dXJuIG5ldyBGcm9tQXJyYXlPYnNlcnZhYmxlKGFycmF5LCBzY2hlZHVsZXIpO1xuICB9XG5cbiAgLyoqXG4gICogIFRoaXMgbWV0aG9kIGNyZWF0ZXMgYSBuZXcgT2JzZXJ2YWJsZSBpbnN0YW5jZSB3aXRoIGEgdmFyaWFibGUgbnVtYmVyIG9mIGFyZ3VtZW50cywgcmVnYXJkbGVzcyBvZiBudW1iZXIgb3IgdHlwZSBvZiB0aGUgYXJndW1lbnRzLlxuICAqIEByZXR1cm5zIHtPYnNlcnZhYmxlfSBUaGUgb2JzZXJ2YWJsZSBzZXF1ZW5jZSB3aG9zZSBlbGVtZW50cyBhcmUgcHVsbGVkIGZyb20gdGhlIGdpdmVuIGFyZ3VtZW50cy5cbiAgKi9cbiAgT2JzZXJ2YWJsZS5vZiA9IGZ1bmN0aW9uICgpIHtcbiAgICB2YXIgbGVuID0gYXJndW1lbnRzLmxlbmd0aCwgYXJncyA9IG5ldyBBcnJheShsZW4pO1xuICAgIGZvcih2YXIgaSA9IDA7IGkgPCBsZW47IGkrKykgeyBhcmdzW2ldID0gYXJndW1lbnRzW2ldOyB9XG4gICAgcmV0dXJuIG5ldyBGcm9tQXJyYXlPYnNlcnZhYmxlKGFyZ3MsIGN1cnJlbnRUaHJlYWRTY2hlZHVsZXIpO1xuICB9O1xuXG4gIC8qKlxuICAqICBUaGlzIG1ldGhvZCBjcmVhdGVzIGEgbmV3IE9ic2VydmFibGUgaW5zdGFuY2Ugd2l0aCBhIHZhcmlhYmxlIG51bWJlciBvZiBhcmd1bWVudHMsIHJlZ2FyZGxlc3Mgb2YgbnVtYmVyIG9yIHR5cGUgb2YgdGhlIGFyZ3VtZW50cy5cbiAgKiBAcGFyYW0ge1NjaGVkdWxlcn0gc2NoZWR1bGVyIEEgc2NoZWR1bGVyIHRvIHVzZSBmb3Igc2NoZWR1bGluZyB0aGUgYXJndW1lbnRzLlxuICAqIEByZXR1cm5zIHtPYnNlcnZhYmxlfSBUaGUgb2JzZXJ2YWJsZSBzZXF1ZW5jZSB3aG9zZSBlbGVtZW50cyBhcmUgcHVsbGVkIGZyb20gdGhlIGdpdmVuIGFyZ3VtZW50cy5cbiAgKi9cbiAgT2JzZXJ2YWJsZS5vZldpdGhTY2hlZHVsZXIgPSBmdW5jdGlvbiAoc2NoZWR1bGVyKSB7XG4gICAgdmFyIGxlbiA9IGFyZ3VtZW50cy5sZW5ndGgsIGFyZ3MgPSBuZXcgQXJyYXkobGVuIC0gMSk7XG4gICAgZm9yKHZhciBpID0gMTsgaSA8IGxlbjsgaSsrKSB7IGFyZ3NbaSAtIDFdID0gYXJndW1lbnRzW2ldOyB9XG4gICAgcmV0dXJuIG5ldyBGcm9tQXJyYXlPYnNlcnZhYmxlKGFyZ3MsIHNjaGVkdWxlcik7XG4gIH07XG5cbiAgLyoqXG4gICAqIENyZWF0ZXMgYW4gT2JzZXJ2YWJsZSBzZXF1ZW5jZSBmcm9tIGNoYW5nZXMgdG8gYW4gYXJyYXkgdXNpbmcgQXJyYXkub2JzZXJ2ZS5cbiAgICogQHBhcmFtIHtBcnJheX0gYXJyYXkgQW4gYXJyYXkgdG8gb2JzZXJ2ZSBjaGFuZ2VzLlxuICAgKiBAcmV0dXJucyB7T2JzZXJ2YWJsZX0gQW4gb2JzZXJ2YWJsZSBzZXF1ZW5jZSBjb250YWluaW5nIGNoYW5nZXMgdG8gYW4gYXJyYXkgZnJvbSBBcnJheS5vYnNlcnZlLlxuICAgKi9cbiAgT2JzZXJ2YWJsZS5vZkFycmF5Q2hhbmdlcyA9IGZ1bmN0aW9uKGFycmF5KSB7XG4gICAgaWYgKCFBcnJheS5pc0FycmF5KGFycmF5KSkgeyB0aHJvdyBuZXcgVHlwZUVycm9yKCdBcnJheS5vYnNlcnZlIG9ubHkgYWNjZXB0cyBhcnJheXMuJyk7IH1cbiAgICBpZiAodHlwZW9mIEFycmF5Lm9ic2VydmUgIT09ICdmdW5jdGlvbicgJiYgdHlwZW9mIEFycmF5LnVub2JzZXJ2ZSAhPT0gJ2Z1bmN0aW9uJykgeyB0aHJvdyBuZXcgVHlwZUVycm9yKCdBcnJheS5vYnNlcnZlIGlzIG5vdCBzdXBwb3J0ZWQgb24geW91ciBwbGF0Zm9ybScpIH1cbiAgICByZXR1cm4gbmV3IEFub255bW91c09ic2VydmFibGUoZnVuY3Rpb24ob2JzZXJ2ZXIpIHtcbiAgICAgIGZ1bmN0aW9uIG9ic2VydmVyRm4oY2hhbmdlcykge1xuICAgICAgICBmb3IodmFyIGkgPSAwLCBsZW4gPSBjaGFuZ2VzLmxlbmd0aDsgaSA8IGxlbjsgaSsrKSB7XG4gICAgICAgICAgb2JzZXJ2ZXIub25OZXh0KGNoYW5nZXNbaV0pO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICBcbiAgICAgIEFycmF5Lm9ic2VydmUoYXJyYXksIG9ic2VydmVyRm4pO1xuXG4gICAgICByZXR1cm4gZnVuY3Rpb24gKCkge1xuICAgICAgICBBcnJheS51bm9ic2VydmUoYXJyYXksIG9ic2VydmVyRm4pO1xuICAgICAgfTtcbiAgICB9KTtcbiAgfTtcblxuICAvKipcbiAgICogQ3JlYXRlcyBhbiBPYnNlcnZhYmxlIHNlcXVlbmNlIGZyb20gY2hhbmdlcyB0byBhbiBvYmplY3QgdXNpbmcgT2JqZWN0Lm9ic2VydmUuXG4gICAqIEBwYXJhbSB7T2JqZWN0fSBvYmogQW4gb2JqZWN0IHRvIG9ic2VydmUgY2hhbmdlcy5cbiAgICogQHJldHVybnMge09ic2VydmFibGV9IEFuIG9ic2VydmFibGUgc2VxdWVuY2UgY29udGFpbmluZyBjaGFuZ2VzIHRvIGFuIG9iamVjdCBmcm9tIE9iamVjdC5vYnNlcnZlLlxuICAgKi9cbiAgT2JzZXJ2YWJsZS5vZk9iamVjdENoYW5nZXMgPSBmdW5jdGlvbihvYmopIHtcbiAgICBpZiAob2JqID09IG51bGwpIHsgdGhyb3cgbmV3IFR5cGVFcnJvcignb2JqZWN0IG11c3Qgbm90IGJlIG51bGwgb3IgdW5kZWZpbmVkLicpOyB9XG4gICAgaWYgKHR5cGVvZiBPYmplY3Qub2JzZXJ2ZSAhPT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YgT2JqZWN0LnVub2JzZXJ2ZSAhPT0gJ2Z1bmN0aW9uJykgeyB0aHJvdyBuZXcgVHlwZUVycm9yKCdPYmplY3Qub2JzZXJ2ZSBpcyBub3Qgc3VwcG9ydGVkIG9uIHlvdXIgcGxhdGZvcm0nKSB9XG4gICAgcmV0dXJuIG5ldyBBbm9ueW1vdXNPYnNlcnZhYmxlKGZ1bmN0aW9uKG9ic2VydmVyKSB7XG4gICAgICBmdW5jdGlvbiBvYnNlcnZlckZuKGNoYW5nZXMpIHtcbiAgICAgICAgZm9yKHZhciBpID0gMCwgbGVuID0gY2hhbmdlcy5sZW5ndGg7IGkgPCBsZW47IGkrKykge1xuICAgICAgICAgIG9ic2VydmVyLm9uTmV4dChjaGFuZ2VzW2ldKTtcbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICBPYmplY3Qub2JzZXJ2ZShvYmosIG9ic2VydmVyRm4pO1xuXG4gICAgICByZXR1cm4gZnVuY3Rpb24gKCkge1xuICAgICAgICBPYmplY3QudW5vYnNlcnZlKG9iaiwgb2JzZXJ2ZXJGbik7XG4gICAgICB9O1xuICAgIH0pO1xuICB9O1xuXG4gIHZhciBOZXZlck9ic2VydmFibGUgPSAoZnVuY3Rpb24oX19zdXBlcl9fKSB7XG4gICAgaW5oZXJpdHMoTmV2ZXJPYnNlcnZhYmxlLCBfX3N1cGVyX18pO1xuICAgIGZ1bmN0aW9uIE5ldmVyT2JzZXJ2YWJsZSgpIHtcbiAgICAgIF9fc3VwZXJfXy5jYWxsKHRoaXMpO1xuICAgIH1cblxuICAgIE5ldmVyT2JzZXJ2YWJsZS5wcm90b3R5cGUuc3Vic2NyaWJlQ29yZSA9IGZ1bmN0aW9uIChvYnNlcnZlcikge1xuICAgICAgcmV0dXJuIGRpc3Bvc2FibGVFbXB0eTtcbiAgICB9O1xuXG4gICAgcmV0dXJuIE5ldmVyT2JzZXJ2YWJsZTtcbiAgfShPYnNlcnZhYmxlQmFzZSkpO1xuXG4gIHZhciBORVZFUl9PQlNFUlZBQkxFID0gbmV3IE5ldmVyT2JzZXJ2YWJsZSgpO1xuXG4gIC8qKlxuICAgKiBSZXR1cm5zIGEgbm9uLXRlcm1pbmF0aW5nIG9ic2VydmFibGUgc2VxdWVuY2UsIHdoaWNoIGNhbiBiZSB1c2VkIHRvIGRlbm90ZSBhbiBpbmZpbml0ZSBkdXJhdGlvbiAoZS5nLiB3aGVuIHVzaW5nIHJlYWN0aXZlIGpvaW5zKS5cbiAgICogQHJldHVybnMge09ic2VydmFibGV9IEFuIG9ic2VydmFibGUgc2VxdWVuY2Ugd2hvc2Ugb2JzZXJ2ZXJzIHdpbGwgbmV2ZXIgZ2V0IGNhbGxlZC5cbiAgICovXG4gIHZhciBvYnNlcnZhYmxlTmV2ZXIgPSBPYnNlcnZhYmxlLm5ldmVyID0gZnVuY3Rpb24gKCkge1xuICAgIHJldHVybiBORVZFUl9PQlNFUlZBQkxFO1xuICB9O1xuXG4gIHZhciBQYWlyc09ic2VydmFibGUgPSAoZnVuY3Rpb24oX19zdXBlcl9fKSB7XG4gICAgaW5oZXJpdHMoUGFpcnNPYnNlcnZhYmxlLCBfX3N1cGVyX18pO1xuICAgIGZ1bmN0aW9uIFBhaXJzT2JzZXJ2YWJsZShvYmosIHNjaGVkdWxlcikge1xuICAgICAgdGhpcy5vYmogPSBvYmo7XG4gICAgICB0aGlzLmtleXMgPSBPYmplY3Qua2V5cyhvYmopO1xuICAgICAgdGhpcy5zY2hlZHVsZXIgPSBzY2hlZHVsZXI7XG4gICAgICBfX3N1cGVyX18uY2FsbCh0aGlzKTtcbiAgICB9XG5cbiAgICBQYWlyc09ic2VydmFibGUucHJvdG90eXBlLnN1YnNjcmliZUNvcmUgPSBmdW5jdGlvbiAob2JzZXJ2ZXIpIHtcbiAgICAgIHZhciBzaW5rID0gbmV3IFBhaXJzU2luayhvYnNlcnZlciwgdGhpcyk7XG4gICAgICByZXR1cm4gc2luay5ydW4oKTtcbiAgICB9O1xuXG4gICAgcmV0dXJuIFBhaXJzT2JzZXJ2YWJsZTtcbiAgfShPYnNlcnZhYmxlQmFzZSkpO1xuXG4gIGZ1bmN0aW9uIFBhaXJzU2luayhvYnNlcnZlciwgcGFyZW50KSB7XG4gICAgdGhpcy5vYnNlcnZlciA9IG9ic2VydmVyO1xuICAgIHRoaXMucGFyZW50ID0gcGFyZW50O1xuICB9XG5cbiAgUGFpcnNTaW5rLnByb3RvdHlwZS5ydW4gPSBmdW5jdGlvbiAoKSB7XG4gICAgdmFyIG9ic2VydmVyID0gdGhpcy5vYnNlcnZlciwgb2JqID0gdGhpcy5wYXJlbnQub2JqLCBrZXlzID0gdGhpcy5wYXJlbnQua2V5cywgbGVuID0ga2V5cy5sZW5ndGg7XG4gICAgZnVuY3Rpb24gbG9vcFJlY3Vyc2l2ZShpLCByZWN1cnNlKSB7XG4gICAgICBpZiAoaSA8IGxlbikge1xuICAgICAgICB2YXIga2V5ID0ga2V5c1tpXTtcbiAgICAgICAgb2JzZXJ2ZXIub25OZXh0KFtrZXksIG9ialtrZXldXSk7XG4gICAgICAgIHJlY3Vyc2UoaSArIDEpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgb2JzZXJ2ZXIub25Db21wbGV0ZWQoKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICByZXR1cm4gdGhpcy5wYXJlbnQuc2NoZWR1bGVyLnNjaGVkdWxlUmVjdXJzaXZlKDAsIGxvb3BSZWN1cnNpdmUpO1xuICB9O1xuXG4gIC8qKlxuICAgKiBDb252ZXJ0IGFuIG9iamVjdCBpbnRvIGFuIG9ic2VydmFibGUgc2VxdWVuY2Ugb2YgW2tleSwgdmFsdWVdIHBhaXJzLlxuICAgKiBAcGFyYW0ge09iamVjdH0gb2JqIFRoZSBvYmplY3QgdG8gaW5zcGVjdC5cbiAgICogQHBhcmFtIHtTY2hlZHVsZXJ9IFtzY2hlZHVsZXJdIFNjaGVkdWxlciB0byBydW4gdGhlIGVudW1lcmF0aW9uIG9mIHRoZSBpbnB1dCBzZXF1ZW5jZSBvbi5cbiAgICogQHJldHVybnMge09ic2VydmFibGV9IEFuIG9ic2VydmFibGUgc2VxdWVuY2Ugb2YgW2tleSwgdmFsdWVdIHBhaXJzIGZyb20gdGhlIG9iamVjdC5cbiAgICovXG4gIE9ic2VydmFibGUucGFpcnMgPSBmdW5jdGlvbiAob2JqLCBzY2hlZHVsZXIpIHtcbiAgICBzY2hlZHVsZXIgfHwgKHNjaGVkdWxlciA9IGN1cnJlbnRUaHJlYWRTY2hlZHVsZXIpO1xuICAgIHJldHVybiBuZXcgUGFpcnNPYnNlcnZhYmxlKG9iaiwgc2NoZWR1bGVyKTtcbiAgfTtcblxuICAgIHZhciBSYW5nZU9ic2VydmFibGUgPSAoZnVuY3Rpb24oX19zdXBlcl9fKSB7XG4gICAgaW5oZXJpdHMoUmFuZ2VPYnNlcnZhYmxlLCBfX3N1cGVyX18pO1xuICAgIGZ1bmN0aW9uIFJhbmdlT2JzZXJ2YWJsZShzdGFydCwgY291bnQsIHNjaGVkdWxlcikge1xuICAgICAgdGhpcy5zdGFydCA9IHN0YXJ0O1xuICAgICAgdGhpcy5yYW5nZUNvdW50ID0gY291bnQ7XG4gICAgICB0aGlzLnNjaGVkdWxlciA9IHNjaGVkdWxlcjtcbiAgICAgIF9fc3VwZXJfXy5jYWxsKHRoaXMpO1xuICAgIH1cblxuICAgIFJhbmdlT2JzZXJ2YWJsZS5wcm90b3R5cGUuc3Vic2NyaWJlQ29yZSA9IGZ1bmN0aW9uIChvYnNlcnZlcikge1xuICAgICAgdmFyIHNpbmsgPSBuZXcgUmFuZ2VTaW5rKG9ic2VydmVyLCB0aGlzKTtcbiAgICAgIHJldHVybiBzaW5rLnJ1bigpO1xuICAgIH07XG5cbiAgICByZXR1cm4gUmFuZ2VPYnNlcnZhYmxlO1xuICB9KE9ic2VydmFibGVCYXNlKSk7XG5cbiAgdmFyIFJhbmdlU2luayA9IChmdW5jdGlvbiAoKSB7XG4gICAgZnVuY3Rpb24gUmFuZ2VTaW5rKG9ic2VydmVyLCBwYXJlbnQpIHtcbiAgICAgIHRoaXMub2JzZXJ2ZXIgPSBvYnNlcnZlcjtcbiAgICAgIHRoaXMucGFyZW50ID0gcGFyZW50O1xuICAgIH1cblxuICAgIFJhbmdlU2luay5wcm90b3R5cGUucnVuID0gZnVuY3Rpb24gKCkge1xuICAgICAgdmFyIHN0YXJ0ID0gdGhpcy5wYXJlbnQuc3RhcnQsIGNvdW50ID0gdGhpcy5wYXJlbnQucmFuZ2VDb3VudCwgb2JzZXJ2ZXIgPSB0aGlzLm9ic2VydmVyO1xuICAgICAgZnVuY3Rpb24gbG9vcFJlY3Vyc2l2ZShpLCByZWN1cnNlKSB7XG4gICAgICAgIGlmIChpIDwgY291bnQpIHtcbiAgICAgICAgICBvYnNlcnZlci5vbk5leHQoc3RhcnQgKyBpKTtcbiAgICAgICAgICByZWN1cnNlKGkgKyAxKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBvYnNlcnZlci5vbkNvbXBsZXRlZCgpO1xuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIHJldHVybiB0aGlzLnBhcmVudC5zY2hlZHVsZXIuc2NoZWR1bGVSZWN1cnNpdmUoMCwgbG9vcFJlY3Vyc2l2ZSk7XG4gICAgfTtcblxuICAgIHJldHVybiBSYW5nZVNpbms7XG4gIH0oKSk7XG5cbiAgLyoqXG4gICogIEdlbmVyYXRlcyBhbiBvYnNlcnZhYmxlIHNlcXVlbmNlIG9mIGludGVncmFsIG51bWJlcnMgd2l0aGluIGEgc3BlY2lmaWVkIHJhbmdlLCB1c2luZyB0aGUgc3BlY2lmaWVkIHNjaGVkdWxlciB0byBzZW5kIG91dCBvYnNlcnZlciBtZXNzYWdlcy5cbiAgKiBAcGFyYW0ge051bWJlcn0gc3RhcnQgVGhlIHZhbHVlIG9mIHRoZSBmaXJzdCBpbnRlZ2VyIGluIHRoZSBzZXF1ZW5jZS5cbiAgKiBAcGFyYW0ge051bWJlcn0gY291bnQgVGhlIG51bWJlciBvZiBzZXF1ZW50aWFsIGludGVnZXJzIHRvIGdlbmVyYXRlLlxuICAqIEBwYXJhbSB7U2NoZWR1bGVyfSBbc2NoZWR1bGVyXSBTY2hlZHVsZXIgdG8gcnVuIHRoZSBnZW5lcmF0b3IgbG9vcCBvbi4gSWYgbm90IHNwZWNpZmllZCwgZGVmYXVsdHMgdG8gU2NoZWR1bGVyLmN1cnJlbnRUaHJlYWQuXG4gICogQHJldHVybnMge09ic2VydmFibGV9IEFuIG9ic2VydmFibGUgc2VxdWVuY2UgdGhhdCBjb250YWlucyBhIHJhbmdlIG9mIHNlcXVlbnRpYWwgaW50ZWdyYWwgbnVtYmVycy5cbiAgKi9cbiAgT2JzZXJ2YWJsZS5yYW5nZSA9IGZ1bmN0aW9uIChzdGFydCwgY291bnQsIHNjaGVkdWxlcikge1xuICAgIGlzU2NoZWR1bGVyKHNjaGVkdWxlcikgfHwgKHNjaGVkdWxlciA9IGN1cnJlbnRUaHJlYWRTY2hlZHVsZXIpO1xuICAgIHJldHVybiBuZXcgUmFuZ2VPYnNlcnZhYmxlKHN0YXJ0LCBjb3VudCwgc2NoZWR1bGVyKTtcbiAgfTtcblxuICB2YXIgUmVwZWF0T2JzZXJ2YWJsZSA9IChmdW5jdGlvbihfX3N1cGVyX18pIHtcbiAgICBpbmhlcml0cyhSZXBlYXRPYnNlcnZhYmxlLCBfX3N1cGVyX18pO1xuICAgIGZ1bmN0aW9uIFJlcGVhdE9ic2VydmFibGUodmFsdWUsIHJlcGVhdENvdW50LCBzY2hlZHVsZXIpIHtcbiAgICAgIHRoaXMudmFsdWUgPSB2YWx1ZTtcbiAgICAgIHRoaXMucmVwZWF0Q291bnQgPSByZXBlYXRDb3VudCA9PSBudWxsID8gLTEgOiByZXBlYXRDb3VudDtcbiAgICAgIHRoaXMuc2NoZWR1bGVyID0gc2NoZWR1bGVyO1xuICAgICAgX19zdXBlcl9fLmNhbGwodGhpcyk7XG4gICAgfVxuXG4gICAgUmVwZWF0T2JzZXJ2YWJsZS5wcm90b3R5cGUuc3Vic2NyaWJlQ29yZSA9IGZ1bmN0aW9uIChvYnNlcnZlcikge1xuICAgICAgdmFyIHNpbmsgPSBuZXcgUmVwZWF0U2luayhvYnNlcnZlciwgdGhpcyk7XG4gICAgICByZXR1cm4gc2luay5ydW4oKTtcbiAgICB9O1xuXG4gICAgcmV0dXJuIFJlcGVhdE9ic2VydmFibGU7XG4gIH0oT2JzZXJ2YWJsZUJhc2UpKTtcblxuICBmdW5jdGlvbiBSZXBlYXRTaW5rKG9ic2VydmVyLCBwYXJlbnQpIHtcbiAgICB0aGlzLm9ic2VydmVyID0gb2JzZXJ2ZXI7XG4gICAgdGhpcy5wYXJlbnQgPSBwYXJlbnQ7XG4gIH1cblxuICBSZXBlYXRTaW5rLnByb3RvdHlwZS5ydW4gPSBmdW5jdGlvbiAoKSB7XG4gICAgdmFyIG9ic2VydmVyID0gdGhpcy5vYnNlcnZlciwgdmFsdWUgPSB0aGlzLnBhcmVudC52YWx1ZTtcbiAgICBmdW5jdGlvbiBsb29wUmVjdXJzaXZlKGksIHJlY3Vyc2UpIHtcbiAgICAgIGlmIChpID09PSAtMSB8fCBpID4gMCkge1xuICAgICAgICBvYnNlcnZlci5vbk5leHQodmFsdWUpO1xuICAgICAgICBpID4gMCAmJiBpLS07XG4gICAgICB9XG4gICAgICBpZiAoaSA9PT0gMCkgeyByZXR1cm4gb2JzZXJ2ZXIub25Db21wbGV0ZWQoKTsgfVxuICAgICAgcmVjdXJzZShpKTtcbiAgICB9XG5cbiAgICByZXR1cm4gdGhpcy5wYXJlbnQuc2NoZWR1bGVyLnNjaGVkdWxlUmVjdXJzaXZlKHRoaXMucGFyZW50LnJlcGVhdENvdW50LCBsb29wUmVjdXJzaXZlKTtcbiAgfTtcblxuICAvKipcbiAgICogIEdlbmVyYXRlcyBhbiBvYnNlcnZhYmxlIHNlcXVlbmNlIHRoYXQgcmVwZWF0cyB0aGUgZ2l2ZW4gZWxlbWVudCB0aGUgc3BlY2lmaWVkIG51bWJlciBvZiB0aW1lcywgdXNpbmcgdGhlIHNwZWNpZmllZCBzY2hlZHVsZXIgdG8gc2VuZCBvdXQgb2JzZXJ2ZXIgbWVzc2FnZXMuXG4gICAqIEBwYXJhbSB7TWl4ZWR9IHZhbHVlIEVsZW1lbnQgdG8gcmVwZWF0LlxuICAgKiBAcGFyYW0ge051bWJlcn0gcmVwZWF0Q291bnQgW09wdGlvbmFdIE51bWJlciBvZiB0aW1lcyB0byByZXBlYXQgdGhlIGVsZW1lbnQuIElmIG5vdCBzcGVjaWZpZWQsIHJlcGVhdHMgaW5kZWZpbml0ZWx5LlxuICAgKiBAcGFyYW0ge1NjaGVkdWxlcn0gc2NoZWR1bGVyIFNjaGVkdWxlciB0byBydW4gdGhlIHByb2R1Y2VyIGxvb3Agb24uIElmIG5vdCBzcGVjaWZpZWQsIGRlZmF1bHRzIHRvIFNjaGVkdWxlci5pbW1lZGlhdGUuXG4gICAqIEByZXR1cm5zIHtPYnNlcnZhYmxlfSBBbiBvYnNlcnZhYmxlIHNlcXVlbmNlIHRoYXQgcmVwZWF0cyB0aGUgZ2l2ZW4gZWxlbWVudCB0aGUgc3BlY2lmaWVkIG51bWJlciBvZiB0aW1lcy5cbiAgICovXG4gIE9ic2VydmFibGUucmVwZWF0ID0gZnVuY3Rpb24gKHZhbHVlLCByZXBlYXRDb3VudCwgc2NoZWR1bGVyKSB7XG4gICAgaXNTY2hlZHVsZXIoc2NoZWR1bGVyKSB8fCAoc2NoZWR1bGVyID0gY3VycmVudFRocmVhZFNjaGVkdWxlcik7XG4gICAgcmV0dXJuIG5ldyBSZXBlYXRPYnNlcnZhYmxlKHZhbHVlLCByZXBlYXRDb3VudCwgc2NoZWR1bGVyKTtcbiAgfTtcblxuICB2YXIgSnVzdE9ic2VydmFibGUgPSAoZnVuY3Rpb24oX19zdXBlcl9fKSB7XG4gICAgaW5oZXJpdHMoSnVzdE9ic2VydmFibGUsIF9fc3VwZXJfXyk7XG4gICAgZnVuY3Rpb24gSnVzdE9ic2VydmFibGUodmFsdWUsIHNjaGVkdWxlcikge1xuICAgICAgdGhpcy52YWx1ZSA9IHZhbHVlO1xuICAgICAgdGhpcy5zY2hlZHVsZXIgPSBzY2hlZHVsZXI7XG4gICAgICBfX3N1cGVyX18uY2FsbCh0aGlzKTtcbiAgICB9XG5cbiAgICBKdXN0T2JzZXJ2YWJsZS5wcm90b3R5cGUuc3Vic2NyaWJlQ29yZSA9IGZ1bmN0aW9uIChvYnNlcnZlcikge1xuICAgICAgdmFyIHNpbmsgPSBuZXcgSnVzdFNpbmsob2JzZXJ2ZXIsIHRoaXMudmFsdWUsIHRoaXMuc2NoZWR1bGVyKTtcbiAgICAgIHJldHVybiBzaW5rLnJ1bigpO1xuICAgIH07XG5cbiAgICBmdW5jdGlvbiBKdXN0U2luayhvYnNlcnZlciwgdmFsdWUsIHNjaGVkdWxlcikge1xuICAgICAgdGhpcy5vYnNlcnZlciA9IG9ic2VydmVyO1xuICAgICAgdGhpcy52YWx1ZSA9IHZhbHVlO1xuICAgICAgdGhpcy5zY2hlZHVsZXIgPSBzY2hlZHVsZXI7XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gc2NoZWR1bGVJdGVtKHMsIHN0YXRlKSB7XG4gICAgICB2YXIgdmFsdWUgPSBzdGF0ZVswXSwgb2JzZXJ2ZXIgPSBzdGF0ZVsxXTtcbiAgICAgIG9ic2VydmVyLm9uTmV4dCh2YWx1ZSk7XG4gICAgICBvYnNlcnZlci5vbkNvbXBsZXRlZCgpO1xuICAgICAgcmV0dXJuIGRpc3Bvc2FibGVFbXB0eTtcbiAgICB9XG5cbiAgICBKdXN0U2luay5wcm90b3R5cGUucnVuID0gZnVuY3Rpb24gKCkge1xuICAgICAgdmFyIHN0YXRlID0gW3RoaXMudmFsdWUsIHRoaXMub2JzZXJ2ZXJdO1xuICAgICAgcmV0dXJuIHRoaXMuc2NoZWR1bGVyID09PSBpbW1lZGlhdGVTY2hlZHVsZXIgP1xuICAgICAgICBzY2hlZHVsZUl0ZW0obnVsbCwgc3RhdGUpIDpcbiAgICAgICAgdGhpcy5zY2hlZHVsZXIuc2NoZWR1bGUoc3RhdGUsIHNjaGVkdWxlSXRlbSk7XG4gICAgfTtcblxuICAgIHJldHVybiBKdXN0T2JzZXJ2YWJsZTtcbiAgfShPYnNlcnZhYmxlQmFzZSkpO1xuXG4gIC8qKlxuICAgKiAgUmV0dXJucyBhbiBvYnNlcnZhYmxlIHNlcXVlbmNlIHRoYXQgY29udGFpbnMgYSBzaW5nbGUgZWxlbWVudCwgdXNpbmcgdGhlIHNwZWNpZmllZCBzY2hlZHVsZXIgdG8gc2VuZCBvdXQgb2JzZXJ2ZXIgbWVzc2FnZXMuXG4gICAqICBUaGVyZSBpcyBhbiBhbGlhcyBjYWxsZWQgJ2p1c3QnIG9yIGJyb3dzZXJzIDxJRTkuXG4gICAqIEBwYXJhbSB7TWl4ZWR9IHZhbHVlIFNpbmdsZSBlbGVtZW50IGluIHRoZSByZXN1bHRpbmcgb2JzZXJ2YWJsZSBzZXF1ZW5jZS5cbiAgICogQHBhcmFtIHtTY2hlZHVsZXJ9IHNjaGVkdWxlciBTY2hlZHVsZXIgdG8gc2VuZCB0aGUgc2luZ2xlIGVsZW1lbnQgb24uIElmIG5vdCBzcGVjaWZpZWQsIGRlZmF1bHRzIHRvIFNjaGVkdWxlci5pbW1lZGlhdGUuXG4gICAqIEByZXR1cm5zIHtPYnNlcnZhYmxlfSBBbiBvYnNlcnZhYmxlIHNlcXVlbmNlIGNvbnRhaW5pbmcgdGhlIHNpbmdsZSBzcGVjaWZpZWQgZWxlbWVudC5cbiAgICovXG4gIHZhciBvYnNlcnZhYmxlUmV0dXJuID0gT2JzZXJ2YWJsZVsncmV0dXJuJ10gPSBPYnNlcnZhYmxlLmp1c3QgPSBmdW5jdGlvbiAodmFsdWUsIHNjaGVkdWxlcikge1xuICAgIGlzU2NoZWR1bGVyKHNjaGVkdWxlcikgfHwgKHNjaGVkdWxlciA9IGltbWVkaWF0ZVNjaGVkdWxlcik7XG4gICAgcmV0dXJuIG5ldyBKdXN0T2JzZXJ2YWJsZSh2YWx1ZSwgc2NoZWR1bGVyKTtcbiAgfTtcblxuICB2YXIgVGhyb3dPYnNlcnZhYmxlID0gKGZ1bmN0aW9uKF9fc3VwZXJfXykge1xuICAgIGluaGVyaXRzKFRocm93T2JzZXJ2YWJsZSwgX19zdXBlcl9fKTtcbiAgICBmdW5jdGlvbiBUaHJvd09ic2VydmFibGUoZXJyb3IsIHNjaGVkdWxlcikge1xuICAgICAgdGhpcy5lcnJvciA9IGVycm9yO1xuICAgICAgdGhpcy5zY2hlZHVsZXIgPSBzY2hlZHVsZXI7XG4gICAgICBfX3N1cGVyX18uY2FsbCh0aGlzKTtcbiAgICB9XG5cbiAgICBUaHJvd09ic2VydmFibGUucHJvdG90eXBlLnN1YnNjcmliZUNvcmUgPSBmdW5jdGlvbiAobykge1xuICAgICAgdmFyIHNpbmsgPSBuZXcgVGhyb3dTaW5rKG8sIHRoaXMpO1xuICAgICAgcmV0dXJuIHNpbmsucnVuKCk7XG4gICAgfTtcblxuICAgIGZ1bmN0aW9uIFRocm93U2luayhvLCBwKSB7XG4gICAgICB0aGlzLm8gPSBvO1xuICAgICAgdGhpcy5wID0gcDtcbiAgICB9XG5cbiAgICBmdW5jdGlvbiBzY2hlZHVsZUl0ZW0ocywgc3RhdGUpIHtcbiAgICAgIHZhciBlID0gc3RhdGVbMF0sIG8gPSBzdGF0ZVsxXTtcbiAgICAgIG8ub25FcnJvcihlKTtcbiAgICB9XG5cbiAgICBUaHJvd1NpbmsucHJvdG90eXBlLnJ1biA9IGZ1bmN0aW9uICgpIHtcbiAgICAgIHJldHVybiB0aGlzLnAuc2NoZWR1bGVyLnNjaGVkdWxlKFt0aGlzLnAuZXJyb3IsIHRoaXMub10sIHNjaGVkdWxlSXRlbSk7XG4gICAgfTtcblxuICAgIHJldHVybiBUaHJvd09ic2VydmFibGU7XG4gIH0oT2JzZXJ2YWJsZUJhc2UpKTtcblxuICAvKipcbiAgICogIFJldHVybnMgYW4gb2JzZXJ2YWJsZSBzZXF1ZW5jZSB0aGF0IHRlcm1pbmF0ZXMgd2l0aCBhbiBleGNlcHRpb24sIHVzaW5nIHRoZSBzcGVjaWZpZWQgc2NoZWR1bGVyIHRvIHNlbmQgb3V0IHRoZSBzaW5nbGUgb25FcnJvciBtZXNzYWdlLlxuICAgKiAgVGhlcmUgaXMgYW4gYWxpYXMgdG8gdGhpcyBtZXRob2QgY2FsbGVkICd0aHJvd0Vycm9yJyBmb3IgYnJvd3NlcnMgPElFOS5cbiAgICogQHBhcmFtIHtNaXhlZH0gZXJyb3IgQW4gb2JqZWN0IHVzZWQgZm9yIHRoZSBzZXF1ZW5jZSdzIHRlcm1pbmF0aW9uLlxuICAgKiBAcGFyYW0ge1NjaGVkdWxlcn0gc2NoZWR1bGVyIFNjaGVkdWxlciB0byBzZW5kIHRoZSBleGNlcHRpb25hbCB0ZXJtaW5hdGlvbiBjYWxsIG9uLiBJZiBub3Qgc3BlY2lmaWVkLCBkZWZhdWx0cyB0byBTY2hlZHVsZXIuaW1tZWRpYXRlLlxuICAgKiBAcmV0dXJucyB7T2JzZXJ2YWJsZX0gVGhlIG9ic2VydmFibGUgc2VxdWVuY2UgdGhhdCB0ZXJtaW5hdGVzIGV4Y2VwdGlvbmFsbHkgd2l0aCB0aGUgc3BlY2lmaWVkIGV4Y2VwdGlvbiBvYmplY3QuXG4gICAqL1xuICB2YXIgb2JzZXJ2YWJsZVRocm93ID0gT2JzZXJ2YWJsZVsndGhyb3cnXSA9IGZ1bmN0aW9uIChlcnJvciwgc2NoZWR1bGVyKSB7XG4gICAgaXNTY2hlZHVsZXIoc2NoZWR1bGVyKSB8fCAoc2NoZWR1bGVyID0gaW1tZWRpYXRlU2NoZWR1bGVyKTtcbiAgICByZXR1cm4gbmV3IFRocm93T2JzZXJ2YWJsZShlcnJvciwgc2NoZWR1bGVyKTtcbiAgfTtcblxuICB2YXIgVXNpbmdPYnNlcnZhYmxlID0gKGZ1bmN0aW9uIChfX3N1cGVyX18pIHtcbiAgICBpbmhlcml0cyhVc2luZ09ic2VydmFibGUsIF9fc3VwZXJfXyk7XG4gICAgZnVuY3Rpb24gVXNpbmdPYnNlcnZhYmxlKHJlc0ZuLCBvYnNGbikge1xuICAgICAgdGhpcy5fcmVzRm4gPSByZXNGbjtcbiAgICAgIHRoaXMuX29ic0ZuID0gb2JzRm47XG4gICAgICBfX3N1cGVyX18uY2FsbCh0aGlzKTtcbiAgICB9XG5cbiAgICBVc2luZ09ic2VydmFibGUucHJvdG90eXBlLnN1YnNjcmliZUNvcmUgPSBmdW5jdGlvbiAobykge1xuICAgICAgdmFyIGRpc3Bvc2FibGUgPSBkaXNwb3NhYmxlRW1wdHk7XG4gICAgICB2YXIgcmVzb3VyY2UgPSB0cnlDYXRjaCh0aGlzLl9yZXNGbikoKTtcbiAgICAgIGlmIChyZXNvdXJjZSA9PT0gZXJyb3JPYmopIHtcbiAgICAgICAgcmV0dXJuIG5ldyBCaW5hcnlEaXNwb3NhYmxlKG9ic2VydmFibGVUaHJvdyhyZXNvdXJjZS5lKS5zdWJzY3JpYmUobyksIGRpc3Bvc2FibGUpO1xuICAgICAgfVxuICAgICAgcmVzb3VyY2UgJiYgKGRpc3Bvc2FibGUgPSByZXNvdXJjZSk7XG4gICAgICB2YXIgc291cmNlID0gdHJ5Q2F0Y2godGhpcy5fb2JzRm4pKHJlc291cmNlKTtcbiAgICAgIGlmIChzb3VyY2UgPT09IGVycm9yT2JqKSB7XG4gICAgICAgIHJldHVybiBuZXcgQmluYXJ5RGlzcG9zYWJsZShvYnNlcnZhYmxlVGhyb3coc291cmNlLmUpLnN1YnNjcmliZShvKSwgZGlzcG9zYWJsZSk7XG4gICAgICB9XG4gICAgICByZXR1cm4gbmV3IEJpbmFyeURpc3Bvc2FibGUoc291cmNlLnN1YnNjcmliZShvKSwgZGlzcG9zYWJsZSk7XG4gICAgfTtcblxuICAgIHJldHVybiBVc2luZ09ic2VydmFibGU7XG4gIH0oT2JzZXJ2YWJsZUJhc2UpKTtcblxuICAvKipcbiAgICogQ29uc3RydWN0cyBhbiBvYnNlcnZhYmxlIHNlcXVlbmNlIHRoYXQgZGVwZW5kcyBvbiBhIHJlc291cmNlIG9iamVjdCwgd2hvc2UgbGlmZXRpbWUgaXMgdGllZCB0byB0aGUgcmVzdWx0aW5nIG9ic2VydmFibGUgc2VxdWVuY2UncyBsaWZldGltZS5cbiAgICogQHBhcmFtIHtGdW5jdGlvbn0gcmVzb3VyY2VGYWN0b3J5IEZhY3RvcnkgZnVuY3Rpb24gdG8gb2J0YWluIGEgcmVzb3VyY2Ugb2JqZWN0LlxuICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBvYnNlcnZhYmxlRmFjdG9yeSBGYWN0b3J5IGZ1bmN0aW9uIHRvIG9idGFpbiBhbiBvYnNlcnZhYmxlIHNlcXVlbmNlIHRoYXQgZGVwZW5kcyBvbiB0aGUgb2J0YWluZWQgcmVzb3VyY2UuXG4gICAqIEByZXR1cm5zIHtPYnNlcnZhYmxlfSBBbiBvYnNlcnZhYmxlIHNlcXVlbmNlIHdob3NlIGxpZmV0aW1lIGNvbnRyb2xzIHRoZSBsaWZldGltZSBvZiB0aGUgZGVwZW5kZW50IHJlc291cmNlIG9iamVjdC5cbiAgICovXG4gIE9ic2VydmFibGUudXNpbmcgPSBmdW5jdGlvbiAocmVzb3VyY2VGYWN0b3J5LCBvYnNlcnZhYmxlRmFjdG9yeSkge1xuICAgIHJldHVybiBuZXcgVXNpbmdPYnNlcnZhYmxlKHJlc291cmNlRmFjdG9yeSwgb2JzZXJ2YWJsZUZhY3RvcnkpO1xuICB9O1xuXG4gIC8qKlxuICAgKiBQcm9wYWdhdGVzIHRoZSBvYnNlcnZhYmxlIHNlcXVlbmNlIG9yIFByb21pc2UgdGhhdCByZWFjdHMgZmlyc3QuXG4gICAqIEBwYXJhbSB7T2JzZXJ2YWJsZX0gcmlnaHRTb3VyY2UgU2Vjb25kIG9ic2VydmFibGUgc2VxdWVuY2Ugb3IgUHJvbWlzZS5cbiAgICogQHJldHVybnMge09ic2VydmFibGV9IHtPYnNlcnZhYmxlfSBBbiBvYnNlcnZhYmxlIHNlcXVlbmNlIHRoYXQgc3VyZmFjZXMgZWl0aGVyIG9mIHRoZSBnaXZlbiBzZXF1ZW5jZXMsIHdoaWNoZXZlciByZWFjdGVkIGZpcnN0LlxuICAgKi9cbiAgb2JzZXJ2YWJsZVByb3RvLmFtYiA9IGZ1bmN0aW9uIChyaWdodFNvdXJjZSkge1xuICAgIHZhciBsZWZ0U291cmNlID0gdGhpcztcbiAgICByZXR1cm4gbmV3IEFub255bW91c09ic2VydmFibGUoZnVuY3Rpb24gKG9ic2VydmVyKSB7XG4gICAgICB2YXIgY2hvaWNlLFxuICAgICAgICBsZWZ0Q2hvaWNlID0gJ0wnLCByaWdodENob2ljZSA9ICdSJyxcbiAgICAgICAgbGVmdFN1YnNjcmlwdGlvbiA9IG5ldyBTaW5nbGVBc3NpZ25tZW50RGlzcG9zYWJsZSgpLFxuICAgICAgICByaWdodFN1YnNjcmlwdGlvbiA9IG5ldyBTaW5nbGVBc3NpZ25tZW50RGlzcG9zYWJsZSgpO1xuXG4gICAgICBpc1Byb21pc2UocmlnaHRTb3VyY2UpICYmIChyaWdodFNvdXJjZSA9IG9ic2VydmFibGVGcm9tUHJvbWlzZShyaWdodFNvdXJjZSkpO1xuXG4gICAgICBmdW5jdGlvbiBjaG9pY2VMKCkge1xuICAgICAgICBpZiAoIWNob2ljZSkge1xuICAgICAgICAgIGNob2ljZSA9IGxlZnRDaG9pY2U7XG4gICAgICAgICAgcmlnaHRTdWJzY3JpcHRpb24uZGlzcG9zZSgpO1xuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIGZ1bmN0aW9uIGNob2ljZVIoKSB7XG4gICAgICAgIGlmICghY2hvaWNlKSB7XG4gICAgICAgICAgY2hvaWNlID0gcmlnaHRDaG9pY2U7XG4gICAgICAgICAgbGVmdFN1YnNjcmlwdGlvbi5kaXNwb3NlKCk7XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgdmFyIGxlZnRTdWJzY3JpYmUgPSBvYnNlcnZlckNyZWF0ZShcbiAgICAgICAgZnVuY3Rpb24gKGxlZnQpIHtcbiAgICAgICAgICBjaG9pY2VMKCk7XG4gICAgICAgICAgY2hvaWNlID09PSBsZWZ0Q2hvaWNlICYmIG9ic2VydmVyLm9uTmV4dChsZWZ0KTtcbiAgICAgICAgfSxcbiAgICAgICAgZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgICBjaG9pY2VMKCk7XG4gICAgICAgICAgY2hvaWNlID09PSBsZWZ0Q2hvaWNlICYmIG9ic2VydmVyLm9uRXJyb3IoZSk7XG4gICAgICAgIH0sXG4gICAgICAgIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICBjaG9pY2VMKCk7XG4gICAgICAgICAgY2hvaWNlID09PSBsZWZ0Q2hvaWNlICYmIG9ic2VydmVyLm9uQ29tcGxldGVkKCk7XG4gICAgICAgIH1cbiAgICAgICk7XG4gICAgICB2YXIgcmlnaHRTdWJzY3JpYmUgPSBvYnNlcnZlckNyZWF0ZShcbiAgICAgICAgZnVuY3Rpb24gKHJpZ2h0KSB7XG4gICAgICAgICAgY2hvaWNlUigpO1xuICAgICAgICAgIGNob2ljZSA9PT0gcmlnaHRDaG9pY2UgJiYgb2JzZXJ2ZXIub25OZXh0KHJpZ2h0KTtcbiAgICAgICAgfSxcbiAgICAgICAgZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgICBjaG9pY2VSKCk7XG4gICAgICAgICAgY2hvaWNlID09PSByaWdodENob2ljZSAmJiBvYnNlcnZlci5vbkVycm9yKGUpO1xuICAgICAgICB9LFxuICAgICAgICBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgY2hvaWNlUigpO1xuICAgICAgICAgIGNob2ljZSA9PT0gcmlnaHRDaG9pY2UgJiYgb2JzZXJ2ZXIub25Db21wbGV0ZWQoKTtcbiAgICAgICAgfVxuICAgICAgKTtcblxuICAgICAgbGVmdFN1YnNjcmlwdGlvbi5zZXREaXNwb3NhYmxlKGxlZnRTb3VyY2Uuc3Vic2NyaWJlKGxlZnRTdWJzY3JpYmUpKTtcbiAgICAgIHJpZ2h0U3Vic2NyaXB0aW9uLnNldERpc3Bvc2FibGUocmlnaHRTb3VyY2Uuc3Vic2NyaWJlKHJpZ2h0U3Vic2NyaWJlKSk7XG5cbiAgICAgIHJldHVybiBuZXcgQmluYXJ5RGlzcG9zYWJsZShsZWZ0U3Vic2NyaXB0aW9uLCByaWdodFN1YnNjcmlwdGlvbik7XG4gICAgfSk7XG4gIH07XG5cbiAgZnVuY3Rpb24gYW1iKHAsIGMpIHsgcmV0dXJuIHAuYW1iKGMpOyB9XG5cbiAgLyoqXG4gICAqIFByb3BhZ2F0ZXMgdGhlIG9ic2VydmFibGUgc2VxdWVuY2Ugb3IgUHJvbWlzZSB0aGF0IHJlYWN0cyBmaXJzdC5cbiAgICogQHJldHVybnMge09ic2VydmFibGV9IEFuIG9ic2VydmFibGUgc2VxdWVuY2UgdGhhdCBzdXJmYWNlcyBhbnkgb2YgdGhlIGdpdmVuIHNlcXVlbmNlcywgd2hpY2hldmVyIHJlYWN0ZWQgZmlyc3QuXG4gICAqL1xuICBPYnNlcnZhYmxlLmFtYiA9IGZ1bmN0aW9uICgpIHtcbiAgICB2YXIgYWNjID0gb2JzZXJ2YWJsZU5ldmVyKCksIGl0ZW1zO1xuICAgIGlmIChBcnJheS5pc0FycmF5KGFyZ3VtZW50c1swXSkpIHtcbiAgICAgIGl0ZW1zID0gYXJndW1lbnRzWzBdO1xuICAgIH0gZWxzZSB7XG4gICAgICB2YXIgbGVuID0gYXJndW1lbnRzLmxlbmd0aDtcbiAgICAgIGl0ZW1zID0gbmV3IEFycmF5KGl0ZW1zKTtcbiAgICAgIGZvcih2YXIgaSA9IDA7IGkgPCBsZW47IGkrKykgeyBpdGVtc1tpXSA9IGFyZ3VtZW50c1tpXTsgfVxuICAgIH1cbiAgICBmb3IgKHZhciBpID0gMCwgbGVuID0gaXRlbXMubGVuZ3RoOyBpIDwgbGVuOyBpKyspIHtcbiAgICAgIGFjYyA9IGFtYihhY2MsIGl0ZW1zW2ldKTtcbiAgICB9XG4gICAgcmV0dXJuIGFjYztcbiAgfTtcblxuICB2YXIgQ2F0Y2hPYnNlcnZhYmxlID0gKGZ1bmN0aW9uIChfX3N1cGVyX18pIHtcbiAgICBpbmhlcml0cyhDYXRjaE9ic2VydmFibGUsIF9fc3VwZXJfXyk7XG4gICAgZnVuY3Rpb24gQ2F0Y2hPYnNlcnZhYmxlKHNvdXJjZSwgZm4pIHtcbiAgICAgIHRoaXMuc291cmNlID0gc291cmNlO1xuICAgICAgdGhpcy5fZm4gPSBmbjtcbiAgICAgIF9fc3VwZXJfXy5jYWxsKHRoaXMpO1xuICAgIH1cblxuICAgIENhdGNoT2JzZXJ2YWJsZS5wcm90b3R5cGUuc3Vic2NyaWJlQ29yZSA9IGZ1bmN0aW9uIChvKSB7XG4gICAgICB2YXIgZDEgPSBuZXcgU2luZ2xlQXNzaWdubWVudERpc3Bvc2FibGUoKSwgc3Vic2NyaXB0aW9uID0gbmV3IFNlcmlhbERpc3Bvc2FibGUoKTtcbiAgICAgIHN1YnNjcmlwdGlvbi5zZXREaXNwb3NhYmxlKGQxKTtcbiAgICAgIGQxLnNldERpc3Bvc2FibGUodGhpcy5zb3VyY2Uuc3Vic2NyaWJlKG5ldyBDYXRjaE9ic2VydmVyKG8sIHN1YnNjcmlwdGlvbiwgdGhpcy5fZm4pKSk7XG4gICAgICByZXR1cm4gc3Vic2NyaXB0aW9uO1xuICAgIH07XG5cbiAgICByZXR1cm4gQ2F0Y2hPYnNlcnZhYmxlO1xuICB9KE9ic2VydmFibGVCYXNlKSk7XG5cbiAgdmFyIENhdGNoT2JzZXJ2ZXIgPSAoZnVuY3Rpb24oX19zdXBlcl9fKSB7XG4gICAgaW5oZXJpdHMoQ2F0Y2hPYnNlcnZlciwgX19zdXBlcl9fKTtcbiAgICBmdW5jdGlvbiBDYXRjaE9ic2VydmVyKG8sIHMsIGZuKSB7XG4gICAgICB0aGlzLl9vID0gbztcbiAgICAgIHRoaXMuX3MgPSBzO1xuICAgICAgdGhpcy5fZm4gPSBmbjtcbiAgICAgIF9fc3VwZXJfXy5jYWxsKHRoaXMpO1xuICAgIH1cblxuICAgIENhdGNoT2JzZXJ2ZXIucHJvdG90eXBlLm5leHQgPSBmdW5jdGlvbiAoeCkgeyB0aGlzLl9vLm9uTmV4dCh4KTsgfTtcbiAgICBDYXRjaE9ic2VydmVyLnByb3RvdHlwZS5jb21wbGV0ZWQgPSBmdW5jdGlvbiAoKSB7IHJldHVybiB0aGlzLl9vLm9uQ29tcGxldGVkKCk7IH07XG4gICAgQ2F0Y2hPYnNlcnZlci5wcm90b3R5cGUuZXJyb3IgPSBmdW5jdGlvbiAoZSkge1xuICAgICAgdmFyIHJlc3VsdCA9IHRyeUNhdGNoKHRoaXMuX2ZuKShlKTtcbiAgICAgIGlmIChyZXN1bHQgPT09IGVycm9yT2JqKSB7IHJldHVybiB0aGlzLl9vLm9uRXJyb3IocmVzdWx0LmUpOyB9XG4gICAgICBpc1Byb21pc2UocmVzdWx0KSAmJiAocmVzdWx0ID0gb2JzZXJ2YWJsZUZyb21Qcm9taXNlKHJlc3VsdCkpO1xuXG4gICAgICB2YXIgZCA9IG5ldyBTaW5nbGVBc3NpZ25tZW50RGlzcG9zYWJsZSgpO1xuICAgICAgdGhpcy5fcy5zZXREaXNwb3NhYmxlKGQpO1xuICAgICAgZC5zZXREaXNwb3NhYmxlKHJlc3VsdC5zdWJzY3JpYmUodGhpcy5fbykpO1xuICAgIH07XG5cbiAgICByZXR1cm4gQ2F0Y2hPYnNlcnZlcjtcbiAgfShBYnN0cmFjdE9ic2VydmVyKSk7XG5cbiAgLyoqXG4gICAqIENvbnRpbnVlcyBhbiBvYnNlcnZhYmxlIHNlcXVlbmNlIHRoYXQgaXMgdGVybWluYXRlZCBieSBhbiBleGNlcHRpb24gd2l0aCB0aGUgbmV4dCBvYnNlcnZhYmxlIHNlcXVlbmNlLlxuICAgKiBAcGFyYW0ge01peGVkfSBoYW5kbGVyT3JTZWNvbmQgRXhjZXB0aW9uIGhhbmRsZXIgZnVuY3Rpb24gdGhhdCByZXR1cm5zIGFuIG9ic2VydmFibGUgc2VxdWVuY2UgZ2l2ZW4gdGhlIGVycm9yIHRoYXQgb2NjdXJyZWQgaW4gdGhlIGZpcnN0IHNlcXVlbmNlLCBvciBhIHNlY29uZCBvYnNlcnZhYmxlIHNlcXVlbmNlIHVzZWQgdG8gcHJvZHVjZSByZXN1bHRzIHdoZW4gYW4gZXJyb3Igb2NjdXJyZWQgaW4gdGhlIGZpcnN0IHNlcXVlbmNlLlxuICAgKiBAcmV0dXJucyB7T2JzZXJ2YWJsZX0gQW4gb2JzZXJ2YWJsZSBzZXF1ZW5jZSBjb250YWluaW5nIHRoZSBmaXJzdCBzZXF1ZW5jZSdzIGVsZW1lbnRzLCBmb2xsb3dlZCBieSB0aGUgZWxlbWVudHMgb2YgdGhlIGhhbmRsZXIgc2VxdWVuY2UgaW4gY2FzZSBhbiBleGNlcHRpb24gb2NjdXJyZWQuXG4gICAqL1xuICBvYnNlcnZhYmxlUHJvdG9bJ2NhdGNoJ10gPSBmdW5jdGlvbiAoaGFuZGxlck9yU2Vjb25kKSB7XG4gICAgcmV0dXJuIGlzRnVuY3Rpb24oaGFuZGxlck9yU2Vjb25kKSA/IG5ldyBDYXRjaE9ic2VydmFibGUodGhpcywgaGFuZGxlck9yU2Vjb25kKSA6IG9ic2VydmFibGVDYXRjaChbdGhpcywgaGFuZGxlck9yU2Vjb25kXSk7XG4gIH07XG5cbiAgLyoqXG4gICAqIENvbnRpbnVlcyBhbiBvYnNlcnZhYmxlIHNlcXVlbmNlIHRoYXQgaXMgdGVybWluYXRlZCBieSBhbiBleGNlcHRpb24gd2l0aCB0aGUgbmV4dCBvYnNlcnZhYmxlIHNlcXVlbmNlLlxuICAgKiBAcGFyYW0ge0FycmF5IHwgQXJndW1lbnRzfSBhcmdzIEFyZ3VtZW50cyBvciBhbiBhcnJheSB0byB1c2UgYXMgdGhlIG5leHQgc2VxdWVuY2UgaWYgYW4gZXJyb3Igb2NjdXJzLlxuICAgKiBAcmV0dXJucyB7T2JzZXJ2YWJsZX0gQW4gb2JzZXJ2YWJsZSBzZXF1ZW5jZSBjb250YWluaW5nIGVsZW1lbnRzIGZyb20gY29uc2VjdXRpdmUgc291cmNlIHNlcXVlbmNlcyB1bnRpbCBhIHNvdXJjZSBzZXF1ZW5jZSB0ZXJtaW5hdGVzIHN1Y2Nlc3NmdWxseS5cbiAgICovXG4gIHZhciBvYnNlcnZhYmxlQ2F0Y2ggPSBPYnNlcnZhYmxlWydjYXRjaCddID0gZnVuY3Rpb24gKCkge1xuICAgIHZhciBpdGVtcztcbiAgICBpZiAoQXJyYXkuaXNBcnJheShhcmd1bWVudHNbMF0pKSB7XG4gICAgICBpdGVtcyA9IGFyZ3VtZW50c1swXTtcbiAgICB9IGVsc2Uge1xuICAgICAgdmFyIGxlbiA9IGFyZ3VtZW50cy5sZW5ndGg7XG4gICAgICBpdGVtcyA9IG5ldyBBcnJheShsZW4pO1xuICAgICAgZm9yKHZhciBpID0gMDsgaSA8IGxlbjsgaSsrKSB7IGl0ZW1zW2ldID0gYXJndW1lbnRzW2ldOyB9XG4gICAgfVxuICAgIHJldHVybiBlbnVtZXJhYmxlT2YoaXRlbXMpLmNhdGNoRXJyb3IoKTtcbiAgfTtcblxuICAvKipcbiAgICogTWVyZ2VzIHRoZSBzcGVjaWZpZWQgb2JzZXJ2YWJsZSBzZXF1ZW5jZXMgaW50byBvbmUgb2JzZXJ2YWJsZSBzZXF1ZW5jZSBieSB1c2luZyB0aGUgc2VsZWN0b3IgZnVuY3Rpb24gd2hlbmV2ZXIgYW55IG9mIHRoZSBvYnNlcnZhYmxlIHNlcXVlbmNlcyBvciBQcm9taXNlcyBwcm9kdWNlcyBhbiBlbGVtZW50LlxuICAgKiBUaGlzIGNhbiBiZSBpbiB0aGUgZm9ybSBvZiBhbiBhcmd1bWVudCBsaXN0IG9mIG9ic2VydmFibGVzIG9yIGFuIGFycmF5LlxuICAgKlxuICAgKiBAZXhhbXBsZVxuICAgKiAxIC0gb2JzID0gb2JzZXJ2YWJsZS5jb21iaW5lTGF0ZXN0KG9iczEsIG9iczIsIG9iczMsIGZ1bmN0aW9uIChvMSwgbzIsIG8zKSB7IHJldHVybiBvMSArIG8yICsgbzM7IH0pO1xuICAgKiAyIC0gb2JzID0gb2JzZXJ2YWJsZS5jb21iaW5lTGF0ZXN0KFtvYnMxLCBvYnMyLCBvYnMzXSwgZnVuY3Rpb24gKG8xLCBvMiwgbzMpIHsgcmV0dXJuIG8xICsgbzIgKyBvMzsgfSk7XG4gICAqIEByZXR1cm5zIHtPYnNlcnZhYmxlfSBBbiBvYnNlcnZhYmxlIHNlcXVlbmNlIGNvbnRhaW5pbmcgdGhlIHJlc3VsdCBvZiBjb21iaW5pbmcgZWxlbWVudHMgb2YgdGhlIHNvdXJjZXMgdXNpbmcgdGhlIHNwZWNpZmllZCByZXN1bHQgc2VsZWN0b3IgZnVuY3Rpb24uXG4gICAqL1xuICBvYnNlcnZhYmxlUHJvdG8uY29tYmluZUxhdGVzdCA9IGZ1bmN0aW9uICgpIHtcbiAgICB2YXIgbGVuID0gYXJndW1lbnRzLmxlbmd0aCwgYXJncyA9IG5ldyBBcnJheShsZW4pO1xuICAgIGZvcih2YXIgaSA9IDA7IGkgPCBsZW47IGkrKykgeyBhcmdzW2ldID0gYXJndW1lbnRzW2ldOyB9XG4gICAgaWYgKEFycmF5LmlzQXJyYXkoYXJnc1swXSkpIHtcbiAgICAgIGFyZ3NbMF0udW5zaGlmdCh0aGlzKTtcbiAgICB9IGVsc2Uge1xuICAgICAgYXJncy51bnNoaWZ0KHRoaXMpO1xuICAgIH1cbiAgICByZXR1cm4gY29tYmluZUxhdGVzdC5hcHBseSh0aGlzLCBhcmdzKTtcbiAgfTtcblxuICBmdW5jdGlvbiBmYWxzZUZhY3RvcnkoKSB7IHJldHVybiBmYWxzZTsgfVxuICBmdW5jdGlvbiBhcmd1bWVudHNUb0FycmF5KCkge1xuICAgIHZhciBsZW4gPSBhcmd1bWVudHMubGVuZ3RoLCBhcmdzID0gbmV3IEFycmF5KGxlbik7XG4gICAgZm9yKHZhciBpID0gMDsgaSA8IGxlbjsgaSsrKSB7IGFyZ3NbaV0gPSBhcmd1bWVudHNbaV07IH1cbiAgICByZXR1cm4gYXJncztcbiAgfVxuXG4gIHZhciBDb21iaW5lTGF0ZXN0T2JzZXJ2YWJsZSA9IChmdW5jdGlvbihfX3N1cGVyX18pIHtcbiAgICBpbmhlcml0cyhDb21iaW5lTGF0ZXN0T2JzZXJ2YWJsZSwgX19zdXBlcl9fKTtcbiAgICBmdW5jdGlvbiBDb21iaW5lTGF0ZXN0T2JzZXJ2YWJsZShwYXJhbXMsIGNiKSB7XG4gICAgICB2YXIgbGVuID0gcGFyYW1zLmxlbmd0aDtcbiAgICAgIHRoaXMuX3BhcmFtcyA9IHBhcmFtcztcbiAgICAgIHRoaXMuX2NiID0gY2I7XG4gICAgICB0aGlzLl9odiA9IGFycmF5SW5pdGlhbGl6ZShsZW4sIGZhbHNlRmFjdG9yeSk7XG4gICAgICB0aGlzLl9odkFsbCA9IGZhbHNlO1xuICAgICAgdGhpcy5fZG9uZSA9IGFycmF5SW5pdGlhbGl6ZShsZW4sIGZhbHNlRmFjdG9yeSk7XG4gICAgICB0aGlzLl92ID0gbmV3IEFycmF5KGxlbik7XG4gICAgICBfX3N1cGVyX18uY2FsbCh0aGlzKTtcbiAgICB9XG5cbiAgICBDb21iaW5lTGF0ZXN0T2JzZXJ2YWJsZS5wcm90b3R5cGUuc3Vic2NyaWJlQ29yZSA9IGZ1bmN0aW9uKG9ic2VydmVyKSB7XG4gICAgICB2YXIgbGVuID0gdGhpcy5fcGFyYW1zLmxlbmd0aCwgc3Vic2NyaXB0aW9ucyA9IG5ldyBBcnJheShsZW4pO1xuXG4gICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGxlbjsgaSsrKSB7XG4gICAgICAgIHZhciBzb3VyY2UgPSB0aGlzLl9wYXJhbXNbaV0sIHNhZCA9IG5ldyBTaW5nbGVBc3NpZ25tZW50RGlzcG9zYWJsZSgpO1xuICAgICAgICBzdWJzY3JpcHRpb25zW2ldID0gc2FkO1xuICAgICAgICBpc1Byb21pc2Uoc291cmNlKSAmJiAoc291cmNlID0gb2JzZXJ2YWJsZUZyb21Qcm9taXNlKHNvdXJjZSkpO1xuICAgICAgICBzYWQuc2V0RGlzcG9zYWJsZShzb3VyY2Uuc3Vic2NyaWJlKG5ldyBDb21iaW5lTGF0ZXN0T2JzZXJ2ZXIob2JzZXJ2ZXIsIGksIHRoaXMpKSk7XG4gICAgICB9XG5cbiAgICAgIHJldHVybiBuZXcgTkFyeURpc3Bvc2FibGUoc3Vic2NyaXB0aW9ucyk7XG4gICAgfTtcblxuICAgIHJldHVybiBDb21iaW5lTGF0ZXN0T2JzZXJ2YWJsZTtcbiAgfShPYnNlcnZhYmxlQmFzZSkpO1xuXG4gIHZhciBDb21iaW5lTGF0ZXN0T2JzZXJ2ZXIgPSAoZnVuY3Rpb24gKF9fc3VwZXJfXykge1xuICAgIGluaGVyaXRzKENvbWJpbmVMYXRlc3RPYnNlcnZlciwgX19zdXBlcl9fKTtcbiAgICBmdW5jdGlvbiBDb21iaW5lTGF0ZXN0T2JzZXJ2ZXIobywgaSwgcCkge1xuICAgICAgdGhpcy5fbyA9IG87XG4gICAgICB0aGlzLl9pID0gaTtcbiAgICAgIHRoaXMuX3AgPSBwO1xuICAgICAgX19zdXBlcl9fLmNhbGwodGhpcyk7XG4gICAgfVxuXG4gICAgQ29tYmluZUxhdGVzdE9ic2VydmVyLnByb3RvdHlwZS5uZXh0ID0gZnVuY3Rpb24gKHgpIHtcbiAgICAgIHRoaXMuX3AuX3ZbdGhpcy5faV0gPSB4O1xuICAgICAgdGhpcy5fcC5faHZbdGhpcy5faV0gPSB0cnVlO1xuICAgICAgaWYgKHRoaXMuX3AuX2h2QWxsIHx8ICh0aGlzLl9wLl9odkFsbCA9IHRoaXMuX3AuX2h2LmV2ZXJ5KGlkZW50aXR5KSkpIHtcbiAgICAgICAgdmFyIHJlcyA9IHRyeUNhdGNoKHRoaXMuX3AuX2NiKS5hcHBseShudWxsLCB0aGlzLl9wLl92KTtcbiAgICAgICAgaWYgKHJlcyA9PT0gZXJyb3JPYmopIHsgcmV0dXJuIHRoaXMuX28ub25FcnJvcihyZXMuZSk7IH1cbiAgICAgICAgdGhpcy5fby5vbk5leHQocmVzKTtcbiAgICAgIH0gZWxzZSBpZiAodGhpcy5fcC5fZG9uZS5maWx0ZXIoZnVuY3Rpb24gKHgsIGopIHsgcmV0dXJuIGogIT09IHRoaXMuX2k7IH0sIHRoaXMpLmV2ZXJ5KGlkZW50aXR5KSkge1xuICAgICAgICB0aGlzLl9vLm9uQ29tcGxldGVkKCk7XG4gICAgICB9XG4gICAgfTtcblxuICAgIENvbWJpbmVMYXRlc3RPYnNlcnZlci5wcm90b3R5cGUuZXJyb3IgPSBmdW5jdGlvbiAoZSkge1xuICAgICAgdGhpcy5fby5vbkVycm9yKGUpO1xuICAgIH07XG5cbiAgICBDb21iaW5lTGF0ZXN0T2JzZXJ2ZXIucHJvdG90eXBlLmNvbXBsZXRlZCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgIHRoaXMuX3AuX2RvbmVbdGhpcy5faV0gPSB0cnVlO1xuICAgICAgdGhpcy5fcC5fZG9uZS5ldmVyeShpZGVudGl0eSkgJiYgdGhpcy5fby5vbkNvbXBsZXRlZCgpO1xuICAgIH07XG5cbiAgICByZXR1cm4gQ29tYmluZUxhdGVzdE9ic2VydmVyO1xuICB9KEFic3RyYWN0T2JzZXJ2ZXIpKTtcblxuICAvKipcbiAgKiBNZXJnZXMgdGhlIHNwZWNpZmllZCBvYnNlcnZhYmxlIHNlcXVlbmNlcyBpbnRvIG9uZSBvYnNlcnZhYmxlIHNlcXVlbmNlIGJ5IHVzaW5nIHRoZSBzZWxlY3RvciBmdW5jdGlvbiB3aGVuZXZlciBhbnkgb2YgdGhlIG9ic2VydmFibGUgc2VxdWVuY2VzIG9yIFByb21pc2VzIHByb2R1Y2VzIGFuIGVsZW1lbnQuXG4gICpcbiAgKiBAZXhhbXBsZVxuICAqIDEgLSBvYnMgPSBSeC5PYnNlcnZhYmxlLmNvbWJpbmVMYXRlc3Qob2JzMSwgb2JzMiwgb2JzMywgZnVuY3Rpb24gKG8xLCBvMiwgbzMpIHsgcmV0dXJuIG8xICsgbzIgKyBvMzsgfSk7XG4gICogMiAtIG9icyA9IFJ4Lk9ic2VydmFibGUuY29tYmluZUxhdGVzdChbb2JzMSwgb2JzMiwgb2JzM10sIGZ1bmN0aW9uIChvMSwgbzIsIG8zKSB7IHJldHVybiBvMSArIG8yICsgbzM7IH0pO1xuICAqIEByZXR1cm5zIHtPYnNlcnZhYmxlfSBBbiBvYnNlcnZhYmxlIHNlcXVlbmNlIGNvbnRhaW5pbmcgdGhlIHJlc3VsdCBvZiBjb21iaW5pbmcgZWxlbWVudHMgb2YgdGhlIHNvdXJjZXMgdXNpbmcgdGhlIHNwZWNpZmllZCByZXN1bHQgc2VsZWN0b3IgZnVuY3Rpb24uXG4gICovXG4gIHZhciBjb21iaW5lTGF0ZXN0ID0gT2JzZXJ2YWJsZS5jb21iaW5lTGF0ZXN0ID0gZnVuY3Rpb24gKCkge1xuICAgIHZhciBsZW4gPSBhcmd1bWVudHMubGVuZ3RoLCBhcmdzID0gbmV3IEFycmF5KGxlbik7XG4gICAgZm9yKHZhciBpID0gMDsgaSA8IGxlbjsgaSsrKSB7IGFyZ3NbaV0gPSBhcmd1bWVudHNbaV07IH1cbiAgICB2YXIgcmVzdWx0U2VsZWN0b3IgPSBpc0Z1bmN0aW9uKGFyZ3NbbGVuIC0gMV0pID8gYXJncy5wb3AoKSA6IGFyZ3VtZW50c1RvQXJyYXk7XG4gICAgQXJyYXkuaXNBcnJheShhcmdzWzBdKSAmJiAoYXJncyA9IGFyZ3NbMF0pO1xuICAgIHJldHVybiBuZXcgQ29tYmluZUxhdGVzdE9ic2VydmFibGUoYXJncywgcmVzdWx0U2VsZWN0b3IpO1xuICB9O1xuXG4gIC8qKlxuICAgKiBDb25jYXRlbmF0ZXMgYWxsIHRoZSBvYnNlcnZhYmxlIHNlcXVlbmNlcy4gIFRoaXMgdGFrZXMgaW4gZWl0aGVyIGFuIGFycmF5IG9yIHZhcmlhYmxlIGFyZ3VtZW50cyB0byBjb25jYXRlbmF0ZS5cbiAgICogQHJldHVybnMge09ic2VydmFibGV9IEFuIG9ic2VydmFibGUgc2VxdWVuY2UgdGhhdCBjb250YWlucyB0aGUgZWxlbWVudHMgb2YgZWFjaCBnaXZlbiBzZXF1ZW5jZSwgaW4gc2VxdWVudGlhbCBvcmRlci5cbiAgICovXG4gIG9ic2VydmFibGVQcm90by5jb25jYXQgPSBmdW5jdGlvbiAoKSB7XG4gICAgZm9yKHZhciBhcmdzID0gW10sIGkgPSAwLCBsZW4gPSBhcmd1bWVudHMubGVuZ3RoOyBpIDwgbGVuOyBpKyspIHsgYXJncy5wdXNoKGFyZ3VtZW50c1tpXSk7IH1cbiAgICBhcmdzLnVuc2hpZnQodGhpcyk7XG4gICAgcmV0dXJuIG9ic2VydmFibGVDb25jYXQuYXBwbHkobnVsbCwgYXJncyk7XG4gIH07XG5cbiAgdmFyIENvbmNhdE9ic2VydmFibGUgPSAoZnVuY3Rpb24oX19zdXBlcl9fKSB7XG4gICAgaW5oZXJpdHMoQ29uY2F0T2JzZXJ2YWJsZSwgX19zdXBlcl9fKTtcbiAgICBmdW5jdGlvbiBDb25jYXRPYnNlcnZhYmxlKHNvdXJjZXMpIHtcbiAgICAgIHRoaXMuc291cmNlcyA9IHNvdXJjZXM7XG4gICAgICBfX3N1cGVyX18uY2FsbCh0aGlzKTtcbiAgICB9XG5cbiAgICBDb25jYXRPYnNlcnZhYmxlLnByb3RvdHlwZS5zdWJzY3JpYmVDb3JlID0gZnVuY3Rpb24obykge1xuICAgICAgdmFyIHNpbmsgPSBuZXcgQ29uY2F0U2luayh0aGlzLnNvdXJjZXMsIG8pO1xuICAgICAgcmV0dXJuIHNpbmsucnVuKCk7XG4gICAgfTtcblxuICAgIGZ1bmN0aW9uIENvbmNhdFNpbmsoc291cmNlcywgbykge1xuICAgICAgdGhpcy5zb3VyY2VzID0gc291cmNlcztcbiAgICAgIHRoaXMubyA9IG87XG4gICAgfVxuICAgIENvbmNhdFNpbmsucHJvdG90eXBlLnJ1biA9IGZ1bmN0aW9uICgpIHtcbiAgICAgIHZhciBpc0Rpc3Bvc2VkLCBzdWJzY3JpcHRpb24gPSBuZXcgU2VyaWFsRGlzcG9zYWJsZSgpLCBzb3VyY2VzID0gdGhpcy5zb3VyY2VzLCBsZW5ndGggPSBzb3VyY2VzLmxlbmd0aCwgbyA9IHRoaXMubztcbiAgICAgIHZhciBjYW5jZWxhYmxlID0gaW1tZWRpYXRlU2NoZWR1bGVyLnNjaGVkdWxlUmVjdXJzaXZlKDAsIGZ1bmN0aW9uIChpLCBzZWxmKSB7XG4gICAgICAgIGlmIChpc0Rpc3Bvc2VkKSB7IHJldHVybjsgfVxuICAgICAgICBpZiAoaSA9PT0gbGVuZ3RoKSB7XG4gICAgICAgICAgcmV0dXJuIG8ub25Db21wbGV0ZWQoKTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIENoZWNrIGlmIHByb21pc2VcbiAgICAgICAgdmFyIGN1cnJlbnRWYWx1ZSA9IHNvdXJjZXNbaV07XG4gICAgICAgIGlzUHJvbWlzZShjdXJyZW50VmFsdWUpICYmIChjdXJyZW50VmFsdWUgPSBvYnNlcnZhYmxlRnJvbVByb21pc2UoY3VycmVudFZhbHVlKSk7XG5cbiAgICAgICAgdmFyIGQgPSBuZXcgU2luZ2xlQXNzaWdubWVudERpc3Bvc2FibGUoKTtcbiAgICAgICAgc3Vic2NyaXB0aW9uLnNldERpc3Bvc2FibGUoZCk7XG4gICAgICAgIGQuc2V0RGlzcG9zYWJsZShjdXJyZW50VmFsdWUuc3Vic2NyaWJlKFxuICAgICAgICAgIGZ1bmN0aW9uICh4KSB7IG8ub25OZXh0KHgpOyB9LFxuICAgICAgICAgIGZ1bmN0aW9uIChlKSB7IG8ub25FcnJvcihlKTsgfSxcbiAgICAgICAgICBmdW5jdGlvbiAoKSB7IHNlbGYoaSArIDEpOyB9XG4gICAgICAgICkpO1xuICAgICAgfSk7XG5cbiAgICAgIHJldHVybiBuZXcgQ29tcG9zaXRlRGlzcG9zYWJsZShzdWJzY3JpcHRpb24sIGNhbmNlbGFibGUsIGRpc3Bvc2FibGVDcmVhdGUoZnVuY3Rpb24gKCkge1xuICAgICAgICBpc0Rpc3Bvc2VkID0gdHJ1ZTtcbiAgICAgIH0pKTtcbiAgICB9O1xuXG5cbiAgICByZXR1cm4gQ29uY2F0T2JzZXJ2YWJsZTtcbiAgfShPYnNlcnZhYmxlQmFzZSkpO1xuXG4gIC8qKlxuICAgKiBDb25jYXRlbmF0ZXMgYWxsIHRoZSBvYnNlcnZhYmxlIHNlcXVlbmNlcy5cbiAgICogQHBhcmFtIHtBcnJheSB8IEFyZ3VtZW50c30gYXJncyBBcmd1bWVudHMgb3IgYW4gYXJyYXkgdG8gY29uY2F0IHRvIHRoZSBvYnNlcnZhYmxlIHNlcXVlbmNlLlxuICAgKiBAcmV0dXJucyB7T2JzZXJ2YWJsZX0gQW4gb2JzZXJ2YWJsZSBzZXF1ZW5jZSB0aGF0IGNvbnRhaW5zIHRoZSBlbGVtZW50cyBvZiBlYWNoIGdpdmVuIHNlcXVlbmNlLCBpbiBzZXF1ZW50aWFsIG9yZGVyLlxuICAgKi9cbiAgdmFyIG9ic2VydmFibGVDb25jYXQgPSBPYnNlcnZhYmxlLmNvbmNhdCA9IGZ1bmN0aW9uICgpIHtcbiAgICB2YXIgYXJncztcbiAgICBpZiAoQXJyYXkuaXNBcnJheShhcmd1bWVudHNbMF0pKSB7XG4gICAgICBhcmdzID0gYXJndW1lbnRzWzBdO1xuICAgIH0gZWxzZSB7XG4gICAgICBhcmdzID0gbmV3IEFycmF5KGFyZ3VtZW50cy5sZW5ndGgpO1xuICAgICAgZm9yKHZhciBpID0gMCwgbGVuID0gYXJndW1lbnRzLmxlbmd0aDsgaSA8IGxlbjsgaSsrKSB7IGFyZ3NbaV0gPSBhcmd1bWVudHNbaV07IH1cbiAgICB9XG4gICAgcmV0dXJuIG5ldyBDb25jYXRPYnNlcnZhYmxlKGFyZ3MpO1xuICB9O1xuXG4gIC8qKlxuICAgKiBDb25jYXRlbmF0ZXMgYW4gb2JzZXJ2YWJsZSBzZXF1ZW5jZSBvZiBvYnNlcnZhYmxlIHNlcXVlbmNlcy5cbiAgICogQHJldHVybnMge09ic2VydmFibGV9IEFuIG9ic2VydmFibGUgc2VxdWVuY2UgdGhhdCBjb250YWlucyB0aGUgZWxlbWVudHMgb2YgZWFjaCBvYnNlcnZlZCBpbm5lciBzZXF1ZW5jZSwgaW4gc2VxdWVudGlhbCBvcmRlci5cbiAgICovXG4gIG9ic2VydmFibGVQcm90by5jb25jYXRBbGwgPSBmdW5jdGlvbiAoKSB7XG4gICAgcmV0dXJuIHRoaXMubWVyZ2UoMSk7XG4gIH07XG5cbiAgdmFyIE1lcmdlT2JzZXJ2YWJsZSA9IChmdW5jdGlvbiAoX19zdXBlcl9fKSB7XG4gICAgaW5oZXJpdHMoTWVyZ2VPYnNlcnZhYmxlLCBfX3N1cGVyX18pO1xuXG4gICAgZnVuY3Rpb24gTWVyZ2VPYnNlcnZhYmxlKHNvdXJjZSwgbWF4Q29uY3VycmVudCkge1xuICAgICAgdGhpcy5zb3VyY2UgPSBzb3VyY2U7XG4gICAgICB0aGlzLm1heENvbmN1cnJlbnQgPSBtYXhDb25jdXJyZW50O1xuICAgICAgX19zdXBlcl9fLmNhbGwodGhpcyk7XG4gICAgfVxuXG4gICAgTWVyZ2VPYnNlcnZhYmxlLnByb3RvdHlwZS5zdWJzY3JpYmVDb3JlID0gZnVuY3Rpb24ob2JzZXJ2ZXIpIHtcbiAgICAgIHZhciBnID0gbmV3IENvbXBvc2l0ZURpc3Bvc2FibGUoKTtcbiAgICAgIGcuYWRkKHRoaXMuc291cmNlLnN1YnNjcmliZShuZXcgTWVyZ2VPYnNlcnZlcihvYnNlcnZlciwgdGhpcy5tYXhDb25jdXJyZW50LCBnKSkpO1xuICAgICAgcmV0dXJuIGc7XG4gICAgfTtcblxuICAgIHJldHVybiBNZXJnZU9ic2VydmFibGU7XG5cbiAgfShPYnNlcnZhYmxlQmFzZSkpO1xuXG4gIHZhciBNZXJnZU9ic2VydmVyID0gKGZ1bmN0aW9uICgpIHtcbiAgICBmdW5jdGlvbiBNZXJnZU9ic2VydmVyKG8sIG1heCwgZykge1xuICAgICAgdGhpcy5vID0gbztcbiAgICAgIHRoaXMubWF4ID0gbWF4O1xuICAgICAgdGhpcy5nID0gZztcbiAgICAgIHRoaXMuZG9uZSA9IGZhbHNlO1xuICAgICAgdGhpcy5xID0gW107XG4gICAgICB0aGlzLmFjdGl2ZUNvdW50ID0gMDtcbiAgICAgIHRoaXMuaXNTdG9wcGVkID0gZmFsc2U7XG4gICAgfVxuICAgIE1lcmdlT2JzZXJ2ZXIucHJvdG90eXBlLmhhbmRsZVN1YnNjcmliZSA9IGZ1bmN0aW9uICh4cykge1xuICAgICAgdmFyIHNhZCA9IG5ldyBTaW5nbGVBc3NpZ25tZW50RGlzcG9zYWJsZSgpO1xuICAgICAgdGhpcy5nLmFkZChzYWQpO1xuICAgICAgaXNQcm9taXNlKHhzKSAmJiAoeHMgPSBvYnNlcnZhYmxlRnJvbVByb21pc2UoeHMpKTtcbiAgICAgIHNhZC5zZXREaXNwb3NhYmxlKHhzLnN1YnNjcmliZShuZXcgSW5uZXJPYnNlcnZlcih0aGlzLCBzYWQpKSk7XG4gICAgfTtcbiAgICBNZXJnZU9ic2VydmVyLnByb3RvdHlwZS5vbk5leHQgPSBmdW5jdGlvbiAoaW5uZXJTb3VyY2UpIHtcbiAgICAgIGlmICh0aGlzLmlzU3RvcHBlZCkgeyByZXR1cm47IH1cbiAgICAgICAgaWYodGhpcy5hY3RpdmVDb3VudCA8IHRoaXMubWF4KSB7XG4gICAgICAgICAgdGhpcy5hY3RpdmVDb3VudCsrO1xuICAgICAgICAgIHRoaXMuaGFuZGxlU3Vic2NyaWJlKGlubmVyU291cmNlKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICB0aGlzLnEucHVzaChpbm5lclNvdXJjZSk7XG4gICAgICAgIH1cbiAgICAgIH07XG4gICAgICBNZXJnZU9ic2VydmVyLnByb3RvdHlwZS5vbkVycm9yID0gZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgaWYgKCF0aGlzLmlzU3RvcHBlZCkge1xuICAgICAgICAgIHRoaXMuaXNTdG9wcGVkID0gdHJ1ZTtcbiAgICAgICAgICB0aGlzLm8ub25FcnJvcihlKTtcbiAgICAgICAgfVxuICAgICAgfTtcbiAgICAgIE1lcmdlT2JzZXJ2ZXIucHJvdG90eXBlLm9uQ29tcGxldGVkID0gZnVuY3Rpb24gKCkge1xuICAgICAgICBpZiAoIXRoaXMuaXNTdG9wcGVkKSB7XG4gICAgICAgICAgdGhpcy5pc1N0b3BwZWQgPSB0cnVlO1xuICAgICAgICAgIHRoaXMuZG9uZSA9IHRydWU7XG4gICAgICAgICAgdGhpcy5hY3RpdmVDb3VudCA9PT0gMCAmJiB0aGlzLm8ub25Db21wbGV0ZWQoKTtcbiAgICAgICAgfVxuICAgICAgfTtcbiAgICAgIE1lcmdlT2JzZXJ2ZXIucHJvdG90eXBlLmRpc3Bvc2UgPSBmdW5jdGlvbigpIHsgdGhpcy5pc1N0b3BwZWQgPSB0cnVlOyB9O1xuICAgICAgTWVyZ2VPYnNlcnZlci5wcm90b3R5cGUuZmFpbCA9IGZ1bmN0aW9uIChlKSB7XG4gICAgICAgIGlmICghdGhpcy5pc1N0b3BwZWQpIHtcbiAgICAgICAgICB0aGlzLmlzU3RvcHBlZCA9IHRydWU7XG4gICAgICAgICAgdGhpcy5vLm9uRXJyb3IoZSk7XG4gICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICB9O1xuXG4gICAgICBmdW5jdGlvbiBJbm5lck9ic2VydmVyKHBhcmVudCwgc2FkKSB7XG4gICAgICAgIHRoaXMucGFyZW50ID0gcGFyZW50O1xuICAgICAgICB0aGlzLnNhZCA9IHNhZDtcbiAgICAgICAgdGhpcy5pc1N0b3BwZWQgPSBmYWxzZTtcbiAgICAgIH1cbiAgICAgIElubmVyT2JzZXJ2ZXIucHJvdG90eXBlLm9uTmV4dCA9IGZ1bmN0aW9uICh4KSB7IGlmKCF0aGlzLmlzU3RvcHBlZCkgeyB0aGlzLnBhcmVudC5vLm9uTmV4dCh4KTsgfSB9O1xuICAgICAgSW5uZXJPYnNlcnZlci5wcm90b3R5cGUub25FcnJvciA9IGZ1bmN0aW9uIChlKSB7XG4gICAgICAgIGlmICghdGhpcy5pc1N0b3BwZWQpIHtcbiAgICAgICAgICB0aGlzLmlzU3RvcHBlZCA9IHRydWU7XG4gICAgICAgICAgdGhpcy5wYXJlbnQuby5vbkVycm9yKGUpO1xuICAgICAgICB9XG4gICAgICB9O1xuICAgICAgSW5uZXJPYnNlcnZlci5wcm90b3R5cGUub25Db21wbGV0ZWQgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGlmKCF0aGlzLmlzU3RvcHBlZCkge1xuICAgICAgICAgIHRoaXMuaXNTdG9wcGVkID0gdHJ1ZTtcbiAgICAgICAgICB2YXIgcGFyZW50ID0gdGhpcy5wYXJlbnQ7XG4gICAgICAgICAgcGFyZW50LmcucmVtb3ZlKHRoaXMuc2FkKTtcbiAgICAgICAgICBpZiAocGFyZW50LnEubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgcGFyZW50LmhhbmRsZVN1YnNjcmliZShwYXJlbnQucS5zaGlmdCgpKTtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgcGFyZW50LmFjdGl2ZUNvdW50LS07XG4gICAgICAgICAgICBwYXJlbnQuZG9uZSAmJiBwYXJlbnQuYWN0aXZlQ291bnQgPT09IDAgJiYgcGFyZW50Lm8ub25Db21wbGV0ZWQoKTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH07XG4gICAgICBJbm5lck9ic2VydmVyLnByb3RvdHlwZS5kaXNwb3NlID0gZnVuY3Rpb24oKSB7IHRoaXMuaXNTdG9wcGVkID0gdHJ1ZTsgfTtcbiAgICAgIElubmVyT2JzZXJ2ZXIucHJvdG90eXBlLmZhaWwgPSBmdW5jdGlvbiAoZSkge1xuICAgICAgICBpZiAoIXRoaXMuaXNTdG9wcGVkKSB7XG4gICAgICAgICAgdGhpcy5pc1N0b3BwZWQgPSB0cnVlO1xuICAgICAgICAgIHRoaXMucGFyZW50Lm8ub25FcnJvcihlKTtcbiAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgIH07XG5cbiAgICAgIHJldHVybiBNZXJnZU9ic2VydmVyO1xuICB9KCkpO1xuXG5cblxuXG5cbiAgLyoqXG4gICogTWVyZ2VzIGFuIG9ic2VydmFibGUgc2VxdWVuY2Ugb2Ygb2JzZXJ2YWJsZSBzZXF1ZW5jZXMgaW50byBhbiBvYnNlcnZhYmxlIHNlcXVlbmNlLCBsaW1pdGluZyB0aGUgbnVtYmVyIG9mIGNvbmN1cnJlbnQgc3Vic2NyaXB0aW9ucyB0byBpbm5lciBzZXF1ZW5jZXMuXG4gICogT3IgbWVyZ2VzIHR3byBvYnNlcnZhYmxlIHNlcXVlbmNlcyBpbnRvIGEgc2luZ2xlIG9ic2VydmFibGUgc2VxdWVuY2UuXG4gICpcbiAgKiBAZXhhbXBsZVxuICAqIDEgLSBtZXJnZWQgPSBzb3VyY2VzLm1lcmdlKDEpO1xuICAqIDIgLSBtZXJnZWQgPSBzb3VyY2UubWVyZ2Uob3RoZXJTb3VyY2UpO1xuICAqIEBwYXJhbSB7TWl4ZWR9IFttYXhDb25jdXJyZW50T3JPdGhlcl0gTWF4aW11bSBudW1iZXIgb2YgaW5uZXIgb2JzZXJ2YWJsZSBzZXF1ZW5jZXMgYmVpbmcgc3Vic2NyaWJlZCB0byBjb25jdXJyZW50bHkgb3IgdGhlIHNlY29uZCBvYnNlcnZhYmxlIHNlcXVlbmNlLlxuICAqIEByZXR1cm5zIHtPYnNlcnZhYmxlfSBUaGUgb2JzZXJ2YWJsZSBzZXF1ZW5jZSB0aGF0IG1lcmdlcyB0aGUgZWxlbWVudHMgb2YgdGhlIGlubmVyIHNlcXVlbmNlcy5cbiAgKi9cbiAgb2JzZXJ2YWJsZVByb3RvLm1lcmdlID0gZnVuY3Rpb24gKG1heENvbmN1cnJlbnRPck90aGVyKSB7XG4gICAgcmV0dXJuIHR5cGVvZiBtYXhDb25jdXJyZW50T3JPdGhlciAhPT0gJ251bWJlcicgP1xuICAgICAgb2JzZXJ2YWJsZU1lcmdlKHRoaXMsIG1heENvbmN1cnJlbnRPck90aGVyKSA6XG4gICAgICBuZXcgTWVyZ2VPYnNlcnZhYmxlKHRoaXMsIG1heENvbmN1cnJlbnRPck90aGVyKTtcbiAgfTtcblxuICAvKipcbiAgICogTWVyZ2VzIGFsbCB0aGUgb2JzZXJ2YWJsZSBzZXF1ZW5jZXMgaW50byBhIHNpbmdsZSBvYnNlcnZhYmxlIHNlcXVlbmNlLlxuICAgKiBUaGUgc2NoZWR1bGVyIGlzIG9wdGlvbmFsIGFuZCBpZiBub3Qgc3BlY2lmaWVkLCB0aGUgaW1tZWRpYXRlIHNjaGVkdWxlciBpcyB1c2VkLlxuICAgKiBAcmV0dXJucyB7T2JzZXJ2YWJsZX0gVGhlIG9ic2VydmFibGUgc2VxdWVuY2UgdGhhdCBtZXJnZXMgdGhlIGVsZW1lbnRzIG9mIHRoZSBvYnNlcnZhYmxlIHNlcXVlbmNlcy5cbiAgICovXG4gIHZhciBvYnNlcnZhYmxlTWVyZ2UgPSBPYnNlcnZhYmxlLm1lcmdlID0gZnVuY3Rpb24gKCkge1xuICAgIHZhciBzY2hlZHVsZXIsIHNvdXJjZXMgPSBbXSwgaSwgbGVuID0gYXJndW1lbnRzLmxlbmd0aDtcbiAgICBpZiAoIWFyZ3VtZW50c1swXSkge1xuICAgICAgc2NoZWR1bGVyID0gaW1tZWRpYXRlU2NoZWR1bGVyO1xuICAgICAgZm9yKGkgPSAxOyBpIDwgbGVuOyBpKyspIHsgc291cmNlcy5wdXNoKGFyZ3VtZW50c1tpXSk7IH1cbiAgICB9IGVsc2UgaWYgKGlzU2NoZWR1bGVyKGFyZ3VtZW50c1swXSkpIHtcbiAgICAgIHNjaGVkdWxlciA9IGFyZ3VtZW50c1swXTtcbiAgICAgIGZvcihpID0gMTsgaSA8IGxlbjsgaSsrKSB7IHNvdXJjZXMucHVzaChhcmd1bWVudHNbaV0pOyB9XG4gICAgfSBlbHNlIHtcbiAgICAgIHNjaGVkdWxlciA9IGltbWVkaWF0ZVNjaGVkdWxlcjtcbiAgICAgIGZvcihpID0gMDsgaSA8IGxlbjsgaSsrKSB7IHNvdXJjZXMucHVzaChhcmd1bWVudHNbaV0pOyB9XG4gICAgfVxuICAgIGlmIChBcnJheS5pc0FycmF5KHNvdXJjZXNbMF0pKSB7XG4gICAgICBzb3VyY2VzID0gc291cmNlc1swXTtcbiAgICB9XG4gICAgcmV0dXJuIG9ic2VydmFibGVPZihzY2hlZHVsZXIsIHNvdXJjZXMpLm1lcmdlQWxsKCk7XG4gIH07XG5cbiAgdmFyIE1lcmdlQWxsT2JzZXJ2YWJsZSA9IChmdW5jdGlvbiAoX19zdXBlcl9fKSB7XG4gICAgaW5oZXJpdHMoTWVyZ2VBbGxPYnNlcnZhYmxlLCBfX3N1cGVyX18pO1xuXG4gICAgZnVuY3Rpb24gTWVyZ2VBbGxPYnNlcnZhYmxlKHNvdXJjZSkge1xuICAgICAgdGhpcy5zb3VyY2UgPSBzb3VyY2U7XG4gICAgICBfX3N1cGVyX18uY2FsbCh0aGlzKTtcbiAgICB9XG5cbiAgICBNZXJnZUFsbE9ic2VydmFibGUucHJvdG90eXBlLnN1YnNjcmliZUNvcmUgPSBmdW5jdGlvbiAob2JzZXJ2ZXIpIHtcbiAgICAgIHZhciBnID0gbmV3IENvbXBvc2l0ZURpc3Bvc2FibGUoKSwgbSA9IG5ldyBTaW5nbGVBc3NpZ25tZW50RGlzcG9zYWJsZSgpO1xuICAgICAgZy5hZGQobSk7XG4gICAgICBtLnNldERpc3Bvc2FibGUodGhpcy5zb3VyY2Uuc3Vic2NyaWJlKG5ldyBNZXJnZUFsbE9ic2VydmVyKG9ic2VydmVyLCBnKSkpO1xuICAgICAgcmV0dXJuIGc7XG4gICAgfTtcblxuICAgIGZ1bmN0aW9uIE1lcmdlQWxsT2JzZXJ2ZXIobywgZykge1xuICAgICAgdGhpcy5vID0gbztcbiAgICAgIHRoaXMuZyA9IGc7XG4gICAgICB0aGlzLmlzU3RvcHBlZCA9IGZhbHNlO1xuICAgICAgdGhpcy5kb25lID0gZmFsc2U7XG4gICAgfVxuICAgIE1lcmdlQWxsT2JzZXJ2ZXIucHJvdG90eXBlLm9uTmV4dCA9IGZ1bmN0aW9uKGlubmVyU291cmNlKSB7XG4gICAgICBpZih0aGlzLmlzU3RvcHBlZCkgeyByZXR1cm47IH1cbiAgICAgIHZhciBzYWQgPSBuZXcgU2luZ2xlQXNzaWdubWVudERpc3Bvc2FibGUoKTtcbiAgICAgIHRoaXMuZy5hZGQoc2FkKTtcblxuICAgICAgaXNQcm9taXNlKGlubmVyU291cmNlKSAmJiAoaW5uZXJTb3VyY2UgPSBvYnNlcnZhYmxlRnJvbVByb21pc2UoaW5uZXJTb3VyY2UpKTtcblxuICAgICAgc2FkLnNldERpc3Bvc2FibGUoaW5uZXJTb3VyY2Uuc3Vic2NyaWJlKG5ldyBJbm5lck9ic2VydmVyKHRoaXMsIHNhZCkpKTtcbiAgICB9O1xuICAgIE1lcmdlQWxsT2JzZXJ2ZXIucHJvdG90eXBlLm9uRXJyb3IgPSBmdW5jdGlvbiAoZSkge1xuICAgICAgaWYoIXRoaXMuaXNTdG9wcGVkKSB7XG4gICAgICAgIHRoaXMuaXNTdG9wcGVkID0gdHJ1ZTtcbiAgICAgICAgdGhpcy5vLm9uRXJyb3IoZSk7XG4gICAgICB9XG4gICAgfTtcbiAgICBNZXJnZUFsbE9ic2VydmVyLnByb3RvdHlwZS5vbkNvbXBsZXRlZCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgIGlmKCF0aGlzLmlzU3RvcHBlZCkge1xuICAgICAgICB0aGlzLmlzU3RvcHBlZCA9IHRydWU7XG4gICAgICAgIHRoaXMuZG9uZSA9IHRydWU7XG4gICAgICAgIHRoaXMuZy5sZW5ndGggPT09IDEgJiYgdGhpcy5vLm9uQ29tcGxldGVkKCk7XG4gICAgICB9XG4gICAgfTtcbiAgICBNZXJnZUFsbE9ic2VydmVyLnByb3RvdHlwZS5kaXNwb3NlID0gZnVuY3Rpb24oKSB7IHRoaXMuaXNTdG9wcGVkID0gdHJ1ZTsgfTtcbiAgICBNZXJnZUFsbE9ic2VydmVyLnByb3RvdHlwZS5mYWlsID0gZnVuY3Rpb24gKGUpIHtcbiAgICAgIGlmICghdGhpcy5pc1N0b3BwZWQpIHtcbiAgICAgICAgdGhpcy5pc1N0b3BwZWQgPSB0cnVlO1xuICAgICAgICB0aGlzLm8ub25FcnJvcihlKTtcbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICB9XG5cbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9O1xuXG4gICAgZnVuY3Rpb24gSW5uZXJPYnNlcnZlcihwYXJlbnQsIHNhZCkge1xuICAgICAgdGhpcy5wYXJlbnQgPSBwYXJlbnQ7XG4gICAgICB0aGlzLnNhZCA9IHNhZDtcbiAgICAgIHRoaXMuaXNTdG9wcGVkID0gZmFsc2U7XG4gICAgfVxuICAgIElubmVyT2JzZXJ2ZXIucHJvdG90eXBlLm9uTmV4dCA9IGZ1bmN0aW9uICh4KSB7IGlmICghdGhpcy5pc1N0b3BwZWQpIHsgdGhpcy5wYXJlbnQuby5vbk5leHQoeCk7IH0gfTtcbiAgICBJbm5lck9ic2VydmVyLnByb3RvdHlwZS5vbkVycm9yID0gZnVuY3Rpb24gKGUpIHtcbiAgICAgIGlmKCF0aGlzLmlzU3RvcHBlZCkge1xuICAgICAgICB0aGlzLmlzU3RvcHBlZCA9IHRydWU7XG4gICAgICAgIHRoaXMucGFyZW50Lm8ub25FcnJvcihlKTtcbiAgICAgIH1cbiAgICB9O1xuICAgIElubmVyT2JzZXJ2ZXIucHJvdG90eXBlLm9uQ29tcGxldGVkID0gZnVuY3Rpb24gKCkge1xuICAgICAgaWYoIXRoaXMuaXNTdG9wcGVkKSB7XG4gICAgICAgIHZhciBwYXJlbnQgPSB0aGlzLnBhcmVudDtcbiAgICAgICAgdGhpcy5pc1N0b3BwZWQgPSB0cnVlO1xuICAgICAgICBwYXJlbnQuZy5yZW1vdmUodGhpcy5zYWQpO1xuICAgICAgICBwYXJlbnQuZG9uZSAmJiBwYXJlbnQuZy5sZW5ndGggPT09IDEgJiYgcGFyZW50Lm8ub25Db21wbGV0ZWQoKTtcbiAgICAgIH1cbiAgICB9O1xuICAgIElubmVyT2JzZXJ2ZXIucHJvdG90eXBlLmRpc3Bvc2UgPSBmdW5jdGlvbigpIHsgdGhpcy5pc1N0b3BwZWQgPSB0cnVlOyB9O1xuICAgIElubmVyT2JzZXJ2ZXIucHJvdG90eXBlLmZhaWwgPSBmdW5jdGlvbiAoZSkge1xuICAgICAgaWYgKCF0aGlzLmlzU3RvcHBlZCkge1xuICAgICAgICB0aGlzLmlzU3RvcHBlZCA9IHRydWU7XG4gICAgICAgIHRoaXMucGFyZW50Lm8ub25FcnJvcihlKTtcbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICB9XG5cbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9O1xuXG4gICAgcmV0dXJuIE1lcmdlQWxsT2JzZXJ2YWJsZTtcbiAgfShPYnNlcnZhYmxlQmFzZSkpO1xuXG4gIC8qKlxuICAqIE1lcmdlcyBhbiBvYnNlcnZhYmxlIHNlcXVlbmNlIG9mIG9ic2VydmFibGUgc2VxdWVuY2VzIGludG8gYW4gb2JzZXJ2YWJsZSBzZXF1ZW5jZS5cbiAgKiBAcmV0dXJucyB7T2JzZXJ2YWJsZX0gVGhlIG9ic2VydmFibGUgc2VxdWVuY2UgdGhhdCBtZXJnZXMgdGhlIGVsZW1lbnRzIG9mIHRoZSBpbm5lciBzZXF1ZW5jZXMuXG4gICovXG4gIG9ic2VydmFibGVQcm90by5tZXJnZUFsbCA9IGZ1bmN0aW9uICgpIHtcbiAgICByZXR1cm4gbmV3IE1lcmdlQWxsT2JzZXJ2YWJsZSh0aGlzKTtcbiAgfTtcblxuICB2YXIgQ29tcG9zaXRlRXJyb3IgPSBSeC5Db21wb3NpdGVFcnJvciA9IGZ1bmN0aW9uKGVycm9ycykge1xuICAgIHRoaXMubmFtZSA9IFwiTm90SW1wbGVtZW50ZWRFcnJvclwiO1xuICAgIHRoaXMuaW5uZXJFcnJvcnMgPSBlcnJvcnM7XG4gICAgdGhpcy5tZXNzYWdlID0gJ1RoaXMgY29udGFpbnMgbXVsdGlwbGUgZXJyb3JzLiBDaGVjayB0aGUgaW5uZXJFcnJvcnMnO1xuICAgIEVycm9yLmNhbGwodGhpcyk7XG4gIH1cbiAgQ29tcG9zaXRlRXJyb3IucHJvdG90eXBlID0gRXJyb3IucHJvdG90eXBlO1xuXG4gIC8qKlxuICAqIEZsYXR0ZW5zIGFuIE9ic2VydmFibGUgdGhhdCBlbWl0cyBPYnNlcnZhYmxlcyBpbnRvIG9uZSBPYnNlcnZhYmxlLCBpbiBhIHdheSB0aGF0IGFsbG93cyBhbiBPYnNlcnZlciB0b1xuICAqIHJlY2VpdmUgYWxsIHN1Y2Nlc3NmdWxseSBlbWl0dGVkIGl0ZW1zIGZyb20gYWxsIG9mIHRoZSBzb3VyY2UgT2JzZXJ2YWJsZXMgd2l0aG91dCBiZWluZyBpbnRlcnJ1cHRlZCBieVxuICAqIGFuIGVycm9yIG5vdGlmaWNhdGlvbiBmcm9tIG9uZSBvZiB0aGVtLlxuICAqXG4gICogVGhpcyBiZWhhdmVzIGxpa2UgT2JzZXJ2YWJsZS5wcm90b3R5cGUubWVyZ2VBbGwgZXhjZXB0IHRoYXQgaWYgYW55IG9mIHRoZSBtZXJnZWQgT2JzZXJ2YWJsZXMgbm90aWZ5IG9mIGFuXG4gICogZXJyb3IgdmlhIHRoZSBPYnNlcnZlcidzIG9uRXJyb3IsIG1lcmdlRGVsYXlFcnJvciB3aWxsIHJlZnJhaW4gZnJvbSBwcm9wYWdhdGluZyB0aGF0XG4gICogZXJyb3Igbm90aWZpY2F0aW9uIHVudGlsIGFsbCBvZiB0aGUgbWVyZ2VkIE9ic2VydmFibGVzIGhhdmUgZmluaXNoZWQgZW1pdHRpbmcgaXRlbXMuXG4gICogQHBhcmFtIHtBcnJheSB8IEFyZ3VtZW50c30gYXJncyBBcmd1bWVudHMgb3IgYW4gYXJyYXkgdG8gbWVyZ2UuXG4gICogQHJldHVybnMge09ic2VydmFibGV9IGFuIE9ic2VydmFibGUgdGhhdCBlbWl0cyBhbGwgb2YgdGhlIGl0ZW1zIGVtaXR0ZWQgYnkgdGhlIE9ic2VydmFibGVzIGVtaXR0ZWQgYnkgdGhlIE9ic2VydmFibGVcbiAgKi9cbiAgT2JzZXJ2YWJsZS5tZXJnZURlbGF5RXJyb3IgPSBmdW5jdGlvbigpIHtcbiAgICB2YXIgYXJncztcbiAgICBpZiAoQXJyYXkuaXNBcnJheShhcmd1bWVudHNbMF0pKSB7XG4gICAgICBhcmdzID0gYXJndW1lbnRzWzBdO1xuICAgIH0gZWxzZSB7XG4gICAgICB2YXIgbGVuID0gYXJndW1lbnRzLmxlbmd0aDtcbiAgICAgIGFyZ3MgPSBuZXcgQXJyYXkobGVuKTtcbiAgICAgIGZvcih2YXIgaSA9IDA7IGkgPCBsZW47IGkrKykgeyBhcmdzW2ldID0gYXJndW1lbnRzW2ldOyB9XG4gICAgfVxuICAgIHZhciBzb3VyY2UgPSBvYnNlcnZhYmxlT2YobnVsbCwgYXJncyk7XG5cbiAgICByZXR1cm4gbmV3IEFub255bW91c09ic2VydmFibGUoZnVuY3Rpb24gKG8pIHtcbiAgICAgIHZhciBncm91cCA9IG5ldyBDb21wb3NpdGVEaXNwb3NhYmxlKCksXG4gICAgICAgIG0gPSBuZXcgU2luZ2xlQXNzaWdubWVudERpc3Bvc2FibGUoKSxcbiAgICAgICAgaXNTdG9wcGVkID0gZmFsc2UsXG4gICAgICAgIGVycm9ycyA9IFtdO1xuXG4gICAgICBmdW5jdGlvbiBzZXRDb21wbGV0aW9uKCkge1xuICAgICAgICBpZiAoZXJyb3JzLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICAgIG8ub25Db21wbGV0ZWQoKTtcbiAgICAgICAgfSBlbHNlIGlmIChlcnJvcnMubGVuZ3RoID09PSAxKSB7XG4gICAgICAgICAgby5vbkVycm9yKGVycm9yc1swXSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgby5vbkVycm9yKG5ldyBDb21wb3NpdGVFcnJvcihlcnJvcnMpKTtcbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICBncm91cC5hZGQobSk7XG5cbiAgICAgIG0uc2V0RGlzcG9zYWJsZShzb3VyY2Uuc3Vic2NyaWJlKFxuICAgICAgICBmdW5jdGlvbiAoaW5uZXJTb3VyY2UpIHtcbiAgICAgICAgICB2YXIgaW5uZXJTdWJzY3JpcHRpb24gPSBuZXcgU2luZ2xlQXNzaWdubWVudERpc3Bvc2FibGUoKTtcbiAgICAgICAgICBncm91cC5hZGQoaW5uZXJTdWJzY3JpcHRpb24pO1xuXG4gICAgICAgICAgLy8gQ2hlY2sgZm9yIHByb21pc2VzIHN1cHBvcnRcbiAgICAgICAgICBpc1Byb21pc2UoaW5uZXJTb3VyY2UpICYmIChpbm5lclNvdXJjZSA9IG9ic2VydmFibGVGcm9tUHJvbWlzZShpbm5lclNvdXJjZSkpO1xuXG4gICAgICAgICAgaW5uZXJTdWJzY3JpcHRpb24uc2V0RGlzcG9zYWJsZShpbm5lclNvdXJjZS5zdWJzY3JpYmUoXG4gICAgICAgICAgICBmdW5jdGlvbiAoeCkgeyBvLm9uTmV4dCh4KTsgfSxcbiAgICAgICAgICAgIGZ1bmN0aW9uIChlKSB7XG4gICAgICAgICAgICAgIGVycm9ycy5wdXNoKGUpO1xuICAgICAgICAgICAgICBncm91cC5yZW1vdmUoaW5uZXJTdWJzY3JpcHRpb24pO1xuICAgICAgICAgICAgICBpc1N0b3BwZWQgJiYgZ3JvdXAubGVuZ3RoID09PSAxICYmIHNldENvbXBsZXRpb24oKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgIGdyb3VwLnJlbW92ZShpbm5lclN1YnNjcmlwdGlvbik7XG4gICAgICAgICAgICAgIGlzU3RvcHBlZCAmJiBncm91cC5sZW5ndGggPT09IDEgJiYgc2V0Q29tcGxldGlvbigpO1xuICAgICAgICAgIH0pKTtcbiAgICAgICAgfSxcbiAgICAgICAgZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgICBlcnJvcnMucHVzaChlKTtcbiAgICAgICAgICBpc1N0b3BwZWQgPSB0cnVlO1xuICAgICAgICAgIGdyb3VwLmxlbmd0aCA9PT0gMSAmJiBzZXRDb21wbGV0aW9uKCk7XG4gICAgICAgIH0sXG4gICAgICAgIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICBpc1N0b3BwZWQgPSB0cnVlO1xuICAgICAgICAgIGdyb3VwLmxlbmd0aCA9PT0gMSAmJiBzZXRDb21wbGV0aW9uKCk7XG4gICAgICAgIH0pKTtcbiAgICAgIHJldHVybiBncm91cDtcbiAgICB9KTtcbiAgfTtcblxuICAvKipcbiAgICogQ29udGludWVzIGFuIG9ic2VydmFibGUgc2VxdWVuY2UgdGhhdCBpcyB0ZXJtaW5hdGVkIG5vcm1hbGx5IG9yIGJ5IGFuIGV4Y2VwdGlvbiB3aXRoIHRoZSBuZXh0IG9ic2VydmFibGUgc2VxdWVuY2UuXG4gICAqIEBwYXJhbSB7T2JzZXJ2YWJsZX0gc2Vjb25kIFNlY29uZCBvYnNlcnZhYmxlIHNlcXVlbmNlIHVzZWQgdG8gcHJvZHVjZSByZXN1bHRzIGFmdGVyIHRoZSBmaXJzdCBzZXF1ZW5jZSB0ZXJtaW5hdGVzLlxuICAgKiBAcmV0dXJucyB7T2JzZXJ2YWJsZX0gQW4gb2JzZXJ2YWJsZSBzZXF1ZW5jZSB0aGF0IGNvbmNhdGVuYXRlcyB0aGUgZmlyc3QgYW5kIHNlY29uZCBzZXF1ZW5jZSwgZXZlbiBpZiB0aGUgZmlyc3Qgc2VxdWVuY2UgdGVybWluYXRlcyBleGNlcHRpb25hbGx5LlxuICAgKi9cbiAgb2JzZXJ2YWJsZVByb3RvLm9uRXJyb3JSZXN1bWVOZXh0ID0gZnVuY3Rpb24gKHNlY29uZCkge1xuICAgIGlmICghc2Vjb25kKSB7IHRocm93IG5ldyBFcnJvcignU2Vjb25kIG9ic2VydmFibGUgaXMgcmVxdWlyZWQnKTsgfVxuICAgIHJldHVybiBvbkVycm9yUmVzdW1lTmV4dChbdGhpcywgc2Vjb25kXSk7XG4gIH07XG5cbiAgLyoqXG4gICAqIENvbnRpbnVlcyBhbiBvYnNlcnZhYmxlIHNlcXVlbmNlIHRoYXQgaXMgdGVybWluYXRlZCBub3JtYWxseSBvciBieSBhbiBleGNlcHRpb24gd2l0aCB0aGUgbmV4dCBvYnNlcnZhYmxlIHNlcXVlbmNlLlxuICAgKlxuICAgKiBAZXhhbXBsZVxuICAgKiAxIC0gcmVzID0gUnguT2JzZXJ2YWJsZS5vbkVycm9yUmVzdW1lTmV4dCh4cywgeXMsIHpzKTtcbiAgICogMSAtIHJlcyA9IFJ4Lk9ic2VydmFibGUub25FcnJvclJlc3VtZU5leHQoW3hzLCB5cywgenNdKTtcbiAgICogQHJldHVybnMge09ic2VydmFibGV9IEFuIG9ic2VydmFibGUgc2VxdWVuY2UgdGhhdCBjb25jYXRlbmF0ZXMgdGhlIHNvdXJjZSBzZXF1ZW5jZXMsIGV2ZW4gaWYgYSBzZXF1ZW5jZSB0ZXJtaW5hdGVzIGV4Y2VwdGlvbmFsbHkuXG4gICAqL1xuICB2YXIgb25FcnJvclJlc3VtZU5leHQgPSBPYnNlcnZhYmxlLm9uRXJyb3JSZXN1bWVOZXh0ID0gZnVuY3Rpb24gKCkge1xuICAgIHZhciBzb3VyY2VzID0gW107XG4gICAgaWYgKEFycmF5LmlzQXJyYXkoYXJndW1lbnRzWzBdKSkge1xuICAgICAgc291cmNlcyA9IGFyZ3VtZW50c1swXTtcbiAgICB9IGVsc2Uge1xuICAgICAgZm9yKHZhciBpID0gMCwgbGVuID0gYXJndW1lbnRzLmxlbmd0aDsgaSA8IGxlbjsgaSsrKSB7IHNvdXJjZXMucHVzaChhcmd1bWVudHNbaV0pOyB9XG4gICAgfVxuICAgIHJldHVybiBuZXcgQW5vbnltb3VzT2JzZXJ2YWJsZShmdW5jdGlvbiAob2JzZXJ2ZXIpIHtcbiAgICAgIHZhciBwb3MgPSAwLCBzdWJzY3JpcHRpb24gPSBuZXcgU2VyaWFsRGlzcG9zYWJsZSgpLFxuICAgICAgY2FuY2VsYWJsZSA9IGltbWVkaWF0ZVNjaGVkdWxlci5zY2hlZHVsZVJlY3Vyc2l2ZShudWxsLCBmdW5jdGlvbiAoXywgc2VsZikge1xuICAgICAgICB2YXIgY3VycmVudCwgZDtcbiAgICAgICAgaWYgKHBvcyA8IHNvdXJjZXMubGVuZ3RoKSB7XG4gICAgICAgICAgY3VycmVudCA9IHNvdXJjZXNbcG9zKytdO1xuICAgICAgICAgIGlzUHJvbWlzZShjdXJyZW50KSAmJiAoY3VycmVudCA9IG9ic2VydmFibGVGcm9tUHJvbWlzZShjdXJyZW50KSk7XG4gICAgICAgICAgZCA9IG5ldyBTaW5nbGVBc3NpZ25tZW50RGlzcG9zYWJsZSgpO1xuICAgICAgICAgIHN1YnNjcmlwdGlvbi5zZXREaXNwb3NhYmxlKGQpO1xuICAgICAgICAgIGQuc2V0RGlzcG9zYWJsZShjdXJyZW50LnN1YnNjcmliZShvYnNlcnZlci5vbk5leHQuYmluZChvYnNlcnZlciksIHNlbGYsIHNlbGYpKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBvYnNlcnZlci5vbkNvbXBsZXRlZCgpO1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICAgIHJldHVybiBuZXcgQmluYXJ5RGlzcG9zYWJsZShzdWJzY3JpcHRpb24sIGNhbmNlbGFibGUpO1xuICAgIH0pO1xuICB9O1xuXG4gIHZhciBTa2lwVW50aWxPYnNlcnZhYmxlID0gKGZ1bmN0aW9uKF9fc3VwZXJfXykge1xuICAgIGluaGVyaXRzKFNraXBVbnRpbE9ic2VydmFibGUsIF9fc3VwZXJfXyk7XG5cbiAgICBmdW5jdGlvbiBTa2lwVW50aWxPYnNlcnZhYmxlKHNvdXJjZSwgb3RoZXIpIHtcbiAgICAgIHRoaXMuX3MgPSBzb3VyY2U7XG4gICAgICB0aGlzLl9vID0gaXNQcm9taXNlKG90aGVyKSA/IG9ic2VydmFibGVGcm9tUHJvbWlzZShvdGhlcikgOiBvdGhlcjtcbiAgICAgIHRoaXMuX29wZW4gPSBmYWxzZTtcbiAgICAgIF9fc3VwZXJfXy5jYWxsKHRoaXMpO1xuICAgIH1cblxuICAgIFNraXBVbnRpbE9ic2VydmFibGUucHJvdG90eXBlLnN1YnNjcmliZUNvcmUgPSBmdW5jdGlvbihvKSB7XG4gICAgICB2YXIgbGVmdFN1YnNjcmlwdGlvbiA9IG5ldyBTaW5nbGVBc3NpZ25tZW50RGlzcG9zYWJsZSgpO1xuICAgICAgbGVmdFN1YnNjcmlwdGlvbi5zZXREaXNwb3NhYmxlKHRoaXMuX3Muc3Vic2NyaWJlKG5ldyBTa2lwVW50aWxTb3VyY2VPYnNlcnZlcihvLCB0aGlzKSkpO1xuXG4gICAgICBpc1Byb21pc2UodGhpcy5fbykgJiYgKHRoaXMuX28gPSBvYnNlcnZhYmxlRnJvbVByb21pc2UodGhpcy5fbykpO1xuXG4gICAgICB2YXIgcmlnaHRTdWJzY3JpcHRpb24gPSBuZXcgU2luZ2xlQXNzaWdubWVudERpc3Bvc2FibGUoKTtcbiAgICAgIHJpZ2h0U3Vic2NyaXB0aW9uLnNldERpc3Bvc2FibGUodGhpcy5fby5zdWJzY3JpYmUobmV3IFNraXBVbnRpbE90aGVyT2JzZXJ2ZXIobywgdGhpcywgcmlnaHRTdWJzY3JpcHRpb24pKSk7XG5cbiAgICAgIHJldHVybiBuZXcgQmluYXJ5RGlzcG9zYWJsZShsZWZ0U3Vic2NyaXB0aW9uLCByaWdodFN1YnNjcmlwdGlvbik7XG4gICAgfTtcblxuICAgIHJldHVybiBTa2lwVW50aWxPYnNlcnZhYmxlO1xuICB9KE9ic2VydmFibGVCYXNlKSk7XG5cbiAgdmFyIFNraXBVbnRpbFNvdXJjZU9ic2VydmVyID0gKGZ1bmN0aW9uKF9fc3VwZXJfXykge1xuICAgIGluaGVyaXRzKFNraXBVbnRpbFNvdXJjZU9ic2VydmVyLCBfX3N1cGVyX18pO1xuICAgIGZ1bmN0aW9uIFNraXBVbnRpbFNvdXJjZU9ic2VydmVyKG8sIHApIHtcbiAgICAgIHRoaXMuX28gPSBvO1xuICAgICAgdGhpcy5fcCA9IHA7XG4gICAgICBfX3N1cGVyX18uY2FsbCh0aGlzKTtcbiAgICB9XG5cbiAgICBTa2lwVW50aWxTb3VyY2VPYnNlcnZlci5wcm90b3R5cGUubmV4dCA9IGZ1bmN0aW9uICh4KSB7XG4gICAgICB0aGlzLl9wLl9vcGVuICYmIHRoaXMuX28ub25OZXh0KHgpO1xuICAgIH07XG5cbiAgICBTa2lwVW50aWxTb3VyY2VPYnNlcnZlci5wcm90b3R5cGUuZXJyb3IgPSBmdW5jdGlvbiAoZXJyKSB7XG4gICAgICB0aGlzLl9vLm9uRXJyb3IoZXJyKTtcbiAgICB9O1xuXG4gICAgU2tpcFVudGlsU291cmNlT2JzZXJ2ZXIucHJvdG90eXBlLm9uQ29tcGxldGVkID0gZnVuY3Rpb24gKCkge1xuICAgICAgdGhpcy5fcC5fb3BlbiAmJiB0aGlzLl9vLm9uQ29tcGxldGVkKCk7XG4gICAgfTtcblxuICAgIHJldHVybiBTa2lwVW50aWxTb3VyY2VPYnNlcnZlcjtcbiAgfShBYnN0cmFjdE9ic2VydmVyKSk7XG5cbiAgdmFyIFNraXBVbnRpbE90aGVyT2JzZXJ2ZXIgPSAoZnVuY3Rpb24oX19zdXBlcl9fKSB7XG4gICAgaW5oZXJpdHMoU2tpcFVudGlsT3RoZXJPYnNlcnZlciwgX19zdXBlcl9fKTtcbiAgICBmdW5jdGlvbiBTa2lwVW50aWxPdGhlck9ic2VydmVyKG8sIHAsIHIpIHtcbiAgICAgIHRoaXMuX28gPSBvO1xuICAgICAgdGhpcy5fcCA9IHA7XG4gICAgICB0aGlzLl9yID0gcjtcbiAgICAgIF9fc3VwZXJfXy5jYWxsKHRoaXMpO1xuICAgIH1cblxuICAgIFNraXBVbnRpbE90aGVyT2JzZXJ2ZXIucHJvdG90eXBlLm5leHQgPSBmdW5jdGlvbiAoKSB7XG4gICAgICB0aGlzLl9wLl9vcGVuID0gdHJ1ZTtcbiAgICAgIHRoaXMuX3IuZGlzcG9zZSgpO1xuICAgIH07XG5cbiAgICBTa2lwVW50aWxPdGhlck9ic2VydmVyLnByb3RvdHlwZS5lcnJvciA9IGZ1bmN0aW9uIChlcnIpIHtcbiAgICAgIHRoaXMuX28ub25FcnJvcihlcnIpO1xuICAgIH07XG5cbiAgICBTa2lwVW50aWxPdGhlck9ic2VydmVyLnByb3RvdHlwZS5vbkNvbXBsZXRlZCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgIHRoaXMuX3IuZGlzcG9zZSgpO1xuICAgIH07XG5cbiAgICByZXR1cm4gU2tpcFVudGlsT3RoZXJPYnNlcnZlcjtcbiAgfShBYnN0cmFjdE9ic2VydmVyKSk7XG5cbiAgLyoqXG4gICAqIFJldHVybnMgdGhlIHZhbHVlcyBmcm9tIHRoZSBzb3VyY2Ugb2JzZXJ2YWJsZSBzZXF1ZW5jZSBvbmx5IGFmdGVyIHRoZSBvdGhlciBvYnNlcnZhYmxlIHNlcXVlbmNlIHByb2R1Y2VzIGEgdmFsdWUuXG4gICAqIEBwYXJhbSB7T2JzZXJ2YWJsZSB8IFByb21pc2V9IG90aGVyIFRoZSBvYnNlcnZhYmxlIHNlcXVlbmNlIG9yIFByb21pc2UgdGhhdCB0cmlnZ2VycyBwcm9wYWdhdGlvbiBvZiBlbGVtZW50cyBvZiB0aGUgc291cmNlIHNlcXVlbmNlLlxuICAgKiBAcmV0dXJucyB7T2JzZXJ2YWJsZX0gQW4gb2JzZXJ2YWJsZSBzZXF1ZW5jZSBjb250YWluaW5nIHRoZSBlbGVtZW50cyBvZiB0aGUgc291cmNlIHNlcXVlbmNlIHN0YXJ0aW5nIGZyb20gdGhlIHBvaW50IHRoZSBvdGhlciBzZXF1ZW5jZSB0cmlnZ2VyZWQgcHJvcGFnYXRpb24uXG4gICAqL1xuICBvYnNlcnZhYmxlUHJvdG8uc2tpcFVudGlsID0gZnVuY3Rpb24gKG90aGVyKSB7XG4gICAgcmV0dXJuIG5ldyBTa2lwVW50aWxPYnNlcnZhYmxlKHRoaXMsIG90aGVyKTtcbiAgfTtcblxuICB2YXIgU3dpdGNoT2JzZXJ2YWJsZSA9IChmdW5jdGlvbihfX3N1cGVyX18pIHtcbiAgICBpbmhlcml0cyhTd2l0Y2hPYnNlcnZhYmxlLCBfX3N1cGVyX18pO1xuICAgIGZ1bmN0aW9uIFN3aXRjaE9ic2VydmFibGUoc291cmNlKSB7XG4gICAgICB0aGlzLnNvdXJjZSA9IHNvdXJjZTtcbiAgICAgIF9fc3VwZXJfXy5jYWxsKHRoaXMpO1xuICAgIH1cblxuICAgIFN3aXRjaE9ic2VydmFibGUucHJvdG90eXBlLnN1YnNjcmliZUNvcmUgPSBmdW5jdGlvbiAobykge1xuICAgICAgdmFyIGlubmVyID0gbmV3IFNlcmlhbERpc3Bvc2FibGUoKSwgcyA9IHRoaXMuc291cmNlLnN1YnNjcmliZShuZXcgU3dpdGNoT2JzZXJ2ZXIobywgaW5uZXIpKTtcbiAgICAgIHJldHVybiBuZXcgQmluYXJ5RGlzcG9zYWJsZShzLCBpbm5lcik7XG4gICAgfTtcblxuICAgIGluaGVyaXRzKFN3aXRjaE9ic2VydmVyLCBBYnN0cmFjdE9ic2VydmVyKTtcbiAgICBmdW5jdGlvbiBTd2l0Y2hPYnNlcnZlcihvLCBpbm5lcikge1xuICAgICAgdGhpcy5vID0gbztcbiAgICAgIHRoaXMuaW5uZXIgPSBpbm5lcjtcbiAgICAgIHRoaXMuc3RvcHBlZCA9IGZhbHNlO1xuICAgICAgdGhpcy5sYXRlc3QgPSAwO1xuICAgICAgdGhpcy5oYXNMYXRlc3QgPSBmYWxzZTtcbiAgICAgIEFic3RyYWN0T2JzZXJ2ZXIuY2FsbCh0aGlzKTtcbiAgICB9XG5cbiAgICBTd2l0Y2hPYnNlcnZlci5wcm90b3R5cGUubmV4dCA9IGZ1bmN0aW9uIChpbm5lclNvdXJjZSkge1xuICAgICAgdmFyIGQgPSBuZXcgU2luZ2xlQXNzaWdubWVudERpc3Bvc2FibGUoKSwgaWQgPSArK3RoaXMubGF0ZXN0O1xuICAgICAgdGhpcy5oYXNMYXRlc3QgPSB0cnVlO1xuICAgICAgdGhpcy5pbm5lci5zZXREaXNwb3NhYmxlKGQpO1xuICAgICAgaXNQcm9taXNlKGlubmVyU291cmNlKSAmJiAoaW5uZXJTb3VyY2UgPSBvYnNlcnZhYmxlRnJvbVByb21pc2UoaW5uZXJTb3VyY2UpKTtcbiAgICAgIGQuc2V0RGlzcG9zYWJsZShpbm5lclNvdXJjZS5zdWJzY3JpYmUobmV3IElubmVyT2JzZXJ2ZXIodGhpcywgaWQpKSk7XG4gICAgfTtcblxuICAgIFN3aXRjaE9ic2VydmVyLnByb3RvdHlwZS5lcnJvciA9IGZ1bmN0aW9uIChlKSB7XG4gICAgICB0aGlzLm8ub25FcnJvcihlKTtcbiAgICB9O1xuXG4gICAgU3dpdGNoT2JzZXJ2ZXIucHJvdG90eXBlLmNvbXBsZXRlZCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgIHRoaXMuc3RvcHBlZCA9IHRydWU7XG4gICAgICAhdGhpcy5oYXNMYXRlc3QgJiYgdGhpcy5vLm9uQ29tcGxldGVkKCk7XG4gICAgfTtcblxuICAgIGluaGVyaXRzKElubmVyT2JzZXJ2ZXIsIEFic3RyYWN0T2JzZXJ2ZXIpO1xuICAgIGZ1bmN0aW9uIElubmVyT2JzZXJ2ZXIocGFyZW50LCBpZCkge1xuICAgICAgdGhpcy5wYXJlbnQgPSBwYXJlbnQ7XG4gICAgICB0aGlzLmlkID0gaWQ7XG4gICAgICBBYnN0cmFjdE9ic2VydmVyLmNhbGwodGhpcyk7XG4gICAgfVxuICAgIElubmVyT2JzZXJ2ZXIucHJvdG90eXBlLm5leHQgPSBmdW5jdGlvbiAoeCkge1xuICAgICAgdGhpcy5wYXJlbnQubGF0ZXN0ID09PSB0aGlzLmlkICYmIHRoaXMucGFyZW50Lm8ub25OZXh0KHgpO1xuICAgIH07XG5cbiAgICBJbm5lck9ic2VydmVyLnByb3RvdHlwZS5lcnJvciA9IGZ1bmN0aW9uIChlKSB7XG4gICAgICB0aGlzLnBhcmVudC5sYXRlc3QgPT09IHRoaXMuaWQgJiYgdGhpcy5wYXJlbnQuby5vbkVycm9yKGUpO1xuICAgIH07XG5cbiAgICBJbm5lck9ic2VydmVyLnByb3RvdHlwZS5jb21wbGV0ZWQgPSBmdW5jdGlvbiAoKSB7XG4gICAgICBpZiAodGhpcy5wYXJlbnQubGF0ZXN0ID09PSB0aGlzLmlkKSB7XG4gICAgICAgIHRoaXMucGFyZW50Lmhhc0xhdGVzdCA9IGZhbHNlO1xuICAgICAgICB0aGlzLnBhcmVudC5pc1N0b3BwZWQgJiYgdGhpcy5wYXJlbnQuby5vbkNvbXBsZXRlZCgpO1xuICAgICAgfVxuICAgIH07XG5cbiAgICByZXR1cm4gU3dpdGNoT2JzZXJ2YWJsZTtcbiAgfShPYnNlcnZhYmxlQmFzZSkpO1xuXG4gIC8qKlxuICAqIFRyYW5zZm9ybXMgYW4gb2JzZXJ2YWJsZSBzZXF1ZW5jZSBvZiBvYnNlcnZhYmxlIHNlcXVlbmNlcyBpbnRvIGFuIG9ic2VydmFibGUgc2VxdWVuY2UgcHJvZHVjaW5nIHZhbHVlcyBvbmx5IGZyb20gdGhlIG1vc3QgcmVjZW50IG9ic2VydmFibGUgc2VxdWVuY2UuXG4gICogQHJldHVybnMge09ic2VydmFibGV9IFRoZSBvYnNlcnZhYmxlIHNlcXVlbmNlIHRoYXQgYXQgYW55IHBvaW50IGluIHRpbWUgcHJvZHVjZXMgdGhlIGVsZW1lbnRzIG9mIHRoZSBtb3N0IHJlY2VudCBpbm5lciBvYnNlcnZhYmxlIHNlcXVlbmNlIHRoYXQgaGFzIGJlZW4gcmVjZWl2ZWQuXG4gICovXG4gIG9ic2VydmFibGVQcm90b1snc3dpdGNoJ10gPSBvYnNlcnZhYmxlUHJvdG8uc3dpdGNoTGF0ZXN0ID0gZnVuY3Rpb24gKCkge1xuICAgIHJldHVybiBuZXcgU3dpdGNoT2JzZXJ2YWJsZSh0aGlzKTtcbiAgfTtcblxuICB2YXIgVGFrZVVudGlsT2JzZXJ2YWJsZSA9IChmdW5jdGlvbihfX3N1cGVyX18pIHtcbiAgICBpbmhlcml0cyhUYWtlVW50aWxPYnNlcnZhYmxlLCBfX3N1cGVyX18pO1xuXG4gICAgZnVuY3Rpb24gVGFrZVVudGlsT2JzZXJ2YWJsZShzb3VyY2UsIG90aGVyKSB7XG4gICAgICB0aGlzLnNvdXJjZSA9IHNvdXJjZTtcbiAgICAgIHRoaXMub3RoZXIgPSBpc1Byb21pc2Uob3RoZXIpID8gb2JzZXJ2YWJsZUZyb21Qcm9taXNlKG90aGVyKSA6IG90aGVyO1xuICAgICAgX19zdXBlcl9fLmNhbGwodGhpcyk7XG4gICAgfVxuXG4gICAgVGFrZVVudGlsT2JzZXJ2YWJsZS5wcm90b3R5cGUuc3Vic2NyaWJlQ29yZSA9IGZ1bmN0aW9uKG8pIHtcbiAgICAgIHJldHVybiBuZXcgQmluYXJ5RGlzcG9zYWJsZShcbiAgICAgICAgdGhpcy5zb3VyY2Uuc3Vic2NyaWJlKG8pLFxuICAgICAgICB0aGlzLm90aGVyLnN1YnNjcmliZShuZXcgVGFrZVVudGlsT2JzZXJ2ZXIobykpXG4gICAgICApO1xuICAgIH07XG5cbiAgICByZXR1cm4gVGFrZVVudGlsT2JzZXJ2YWJsZTtcbiAgfShPYnNlcnZhYmxlQmFzZSkpO1xuXG4gIHZhciBUYWtlVW50aWxPYnNlcnZlciA9IChmdW5jdGlvbihfX3N1cGVyX18pIHtcbiAgICBpbmhlcml0cyhUYWtlVW50aWxPYnNlcnZlciwgX19zdXBlcl9fKTtcbiAgICBmdW5jdGlvbiBUYWtlVW50aWxPYnNlcnZlcihvKSB7XG4gICAgICB0aGlzLl9vID0gbztcbiAgICAgIF9fc3VwZXJfXy5jYWxsKHRoaXMpO1xuICAgIH1cblxuICAgIFRha2VVbnRpbE9ic2VydmVyLnByb3RvdHlwZS5uZXh0ID0gZnVuY3Rpb24gKCkge1xuICAgICAgdGhpcy5fby5vbkNvbXBsZXRlZCgpO1xuICAgIH07XG5cbiAgICBUYWtlVW50aWxPYnNlcnZlci5wcm90b3R5cGUuZXJyb3IgPSBmdW5jdGlvbiAoZXJyKSB7XG4gICAgICB0aGlzLl9vLm9uRXJyb3IoZXJyKTtcbiAgICB9O1xuXG4gICAgVGFrZVVudGlsT2JzZXJ2ZXIucHJvdG90eXBlLm9uQ29tcGxldGVkID0gbm9vcDtcblxuICAgIHJldHVybiBUYWtlVW50aWxPYnNlcnZlcjtcbiAgfShBYnN0cmFjdE9ic2VydmVyKSk7XG5cbiAgLyoqXG4gICAqIFJldHVybnMgdGhlIHZhbHVlcyBmcm9tIHRoZSBzb3VyY2Ugb2JzZXJ2YWJsZSBzZXF1ZW5jZSB1bnRpbCB0aGUgb3RoZXIgb2JzZXJ2YWJsZSBzZXF1ZW5jZSBwcm9kdWNlcyBhIHZhbHVlLlxuICAgKiBAcGFyYW0ge09ic2VydmFibGUgfCBQcm9taXNlfSBvdGhlciBPYnNlcnZhYmxlIHNlcXVlbmNlIG9yIFByb21pc2UgdGhhdCB0ZXJtaW5hdGVzIHByb3BhZ2F0aW9uIG9mIGVsZW1lbnRzIG9mIHRoZSBzb3VyY2Ugc2VxdWVuY2UuXG4gICAqIEByZXR1cm5zIHtPYnNlcnZhYmxlfSBBbiBvYnNlcnZhYmxlIHNlcXVlbmNlIGNvbnRhaW5pbmcgdGhlIGVsZW1lbnRzIG9mIHRoZSBzb3VyY2Ugc2VxdWVuY2UgdXAgdG8gdGhlIHBvaW50IHRoZSBvdGhlciBzZXF1ZW5jZSBpbnRlcnJ1cHRlZCBmdXJ0aGVyIHByb3BhZ2F0aW9uLlxuICAgKi9cbiAgb2JzZXJ2YWJsZVByb3RvLnRha2VVbnRpbCA9IGZ1bmN0aW9uIChvdGhlcikge1xuICAgIHJldHVybiBuZXcgVGFrZVVudGlsT2JzZXJ2YWJsZSh0aGlzLCBvdGhlcik7XG4gIH07XG5cbiAgZnVuY3Rpb24gZmFsc2VGYWN0b3J5KCkgeyByZXR1cm4gZmFsc2U7IH1cbiAgZnVuY3Rpb24gYXJndW1lbnRzVG9BcnJheSgpIHtcbiAgICB2YXIgbGVuID0gYXJndW1lbnRzLmxlbmd0aCwgYXJncyA9IG5ldyBBcnJheShsZW4pO1xuICAgIGZvcih2YXIgaSA9IDA7IGkgPCBsZW47IGkrKykgeyBhcmdzW2ldID0gYXJndW1lbnRzW2ldOyB9XG4gICAgcmV0dXJuIGFyZ3M7XG4gIH1cblxuICB2YXIgV2l0aExhdGVzdEZyb21PYnNlcnZhYmxlID0gKGZ1bmN0aW9uKF9fc3VwZXJfXykge1xuICAgIGluaGVyaXRzKFdpdGhMYXRlc3RGcm9tT2JzZXJ2YWJsZSwgX19zdXBlcl9fKTtcbiAgICBmdW5jdGlvbiBXaXRoTGF0ZXN0RnJvbU9ic2VydmFibGUoc291cmNlLCBzb3VyY2VzLCByZXN1bHRTZWxlY3Rvcikge1xuICAgICAgdmFyIGxlbiA9IHNvdXJjZXMubGVuZ3RoO1xuICAgICAgdGhpcy5fcyA9IHNvdXJjZTtcbiAgICAgIHRoaXMuX3NzID0gc291cmNlcztcbiAgICAgIHRoaXMuX2NiID0gcmVzdWx0U2VsZWN0b3I7XG4gICAgICB0aGlzLl9odiA9IGFycmF5SW5pdGlhbGl6ZShsZW4sIGZhbHNlRmFjdG9yeSk7XG4gICAgICB0aGlzLl9odkFsbCA9IGZhbHNlO1xuICAgICAgdGhpcy5fdiA9IG5ldyBBcnJheShsZW4pO1xuICAgICAgX19zdXBlcl9fLmNhbGwodGhpcyk7XG4gICAgfVxuXG4gICAgV2l0aExhdGVzdEZyb21PYnNlcnZhYmxlLnByb3RvdHlwZS5zdWJzY3JpYmVDb3JlID0gZnVuY3Rpb24gKG8pIHtcbiAgICAgIHZhciBuID0gdGhpcy5fc3MubGVuZ3RoLCBzdWJzY3JpcHRpb25zID0gbmV3IEFycmF5KG4gKyAxKTtcbiAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbjsgaSsrKSB7XG4gICAgICAgIHZhciBvdGhlciA9IHRoaXMuX3NzW2ldLCBzYWQgPSBuZXcgU2luZ2xlQXNzaWdubWVudERpc3Bvc2FibGUoKTtcbiAgICAgICAgaXNQcm9taXNlKG90aGVyKSAmJiAob3RoZXIgPSBvYnNlcnZhYmxlRnJvbVByb21pc2Uob3RoZXIpKTtcbiAgICAgICAgc2FkLnNldERpc3Bvc2FibGUob3RoZXIuc3Vic2NyaWJlKG5ldyBXaXRoTGF0ZXN0RnJvbU90aGVyT2JzZXJ2ZXIobywgaSwgdGhpcykpKTtcbiAgICAgICAgc3Vic2NyaXB0aW9uc1tpXSA9IHNhZDtcbiAgICAgIH1cblxuICAgICAgdmFyIHNhZCA9IG5ldyBTaW5nbGVBc3NpZ25tZW50RGlzcG9zYWJsZSgpO1xuICAgICAgc2FkLnNldERpc3Bvc2FibGUodGhpcy5fcy5zdWJzY3JpYmUobmV3IFdpdGhMYXRlc3RGcm9tU291cmNlT2JzZXJ2ZXIobywgdGhpcykpKTtcbiAgICAgIHN1YnNjcmlwdGlvbnNbbl0gPSBzYWQ7XG5cbiAgICAgIHJldHVybiBuZXcgTkFyeURpc3Bvc2FibGUoc3Vic2NyaXB0aW9ucyk7XG4gICAgfTtcblxuICAgIHJldHVybiBXaXRoTGF0ZXN0RnJvbU9ic2VydmFibGU7XG4gIH0oT2JzZXJ2YWJsZUJhc2UpKTtcblxuICB2YXIgV2l0aExhdGVzdEZyb21PdGhlck9ic2VydmVyID0gKGZ1bmN0aW9uIChfX3N1cGVyX18pIHtcbiAgICBpbmhlcml0cyhXaXRoTGF0ZXN0RnJvbU90aGVyT2JzZXJ2ZXIsIF9fc3VwZXJfXyk7XG4gICAgZnVuY3Rpb24gV2l0aExhdGVzdEZyb21PdGhlck9ic2VydmVyKG8sIGksIHApIHtcbiAgICAgIHRoaXMuX28gPSBvO1xuICAgICAgdGhpcy5faSA9IGk7XG4gICAgICB0aGlzLl9wID0gcDtcbiAgICAgIF9fc3VwZXJfXy5jYWxsKHRoaXMpO1xuICAgIH1cblxuICAgIFdpdGhMYXRlc3RGcm9tT3RoZXJPYnNlcnZlci5wcm90b3R5cGUubmV4dCA9IGZ1bmN0aW9uICh4KSB7XG4gICAgICB0aGlzLl9wLl92W3RoaXMuX2ldID0geDtcbiAgICAgIHRoaXMuX3AuX2h2W3RoaXMuX2ldID0gdHJ1ZTtcbiAgICAgIHRoaXMuX3AuX2h2QWxsID0gdGhpcy5fcC5faHYuZXZlcnkoaWRlbnRpdHkpO1xuICAgIH07XG5cbiAgICBXaXRoTGF0ZXN0RnJvbU90aGVyT2JzZXJ2ZXIucHJvdG90eXBlLmVycm9yID0gZnVuY3Rpb24gKGUpIHtcbiAgICAgIHRoaXMuX28ub25FcnJvcihlKTtcbiAgICB9O1xuXG4gICAgV2l0aExhdGVzdEZyb21PdGhlck9ic2VydmVyLnByb3RvdHlwZS5jb21wbGV0ZWQgPSBub29wO1xuXG4gICAgcmV0dXJuIFdpdGhMYXRlc3RGcm9tT3RoZXJPYnNlcnZlcjtcbiAgfShBYnN0cmFjdE9ic2VydmVyKSk7XG5cbiAgdmFyIFdpdGhMYXRlc3RGcm9tU291cmNlT2JzZXJ2ZXIgPSAoZnVuY3Rpb24gKF9fc3VwZXJfXykge1xuICAgIGluaGVyaXRzKFdpdGhMYXRlc3RGcm9tU291cmNlT2JzZXJ2ZXIsIF9fc3VwZXJfXyk7XG4gICAgZnVuY3Rpb24gV2l0aExhdGVzdEZyb21Tb3VyY2VPYnNlcnZlcihvLCBwKSB7XG4gICAgICB0aGlzLl9vID0gbztcbiAgICAgIHRoaXMuX3AgPSBwO1xuICAgICAgX19zdXBlcl9fLmNhbGwodGhpcyk7XG4gICAgfVxuXG4gICAgV2l0aExhdGVzdEZyb21Tb3VyY2VPYnNlcnZlci5wcm90b3R5cGUubmV4dCA9IGZ1bmN0aW9uICh4KSB7XG4gICAgICB2YXIgYWxsVmFsdWVzID0gW3hdLmNvbmNhdCh0aGlzLl9wLl92KTtcbiAgICAgIGlmICghdGhpcy5fcC5faHZBbGwpIHsgcmV0dXJuOyB9XG4gICAgICB2YXIgcmVzID0gdHJ5Q2F0Y2godGhpcy5fcC5fY2IpLmFwcGx5KG51bGwsIGFsbFZhbHVlcyk7XG4gICAgICBpZiAocmVzID09PSBlcnJvck9iaikgeyByZXR1cm4gdGhpcy5fby5vbkVycm9yKHJlcy5lKTsgfVxuICAgICAgdGhpcy5fby5vbk5leHQocmVzKTtcbiAgICB9O1xuXG4gICAgV2l0aExhdGVzdEZyb21Tb3VyY2VPYnNlcnZlci5wcm90b3R5cGUuZXJyb3IgPSBmdW5jdGlvbiAoZSkge1xuICAgICAgdGhpcy5fby5vbkVycm9yKGUpO1xuICAgIH07XG5cbiAgICBXaXRoTGF0ZXN0RnJvbVNvdXJjZU9ic2VydmVyLnByb3RvdHlwZS5jb21wbGV0ZWQgPSBmdW5jdGlvbiAoKSB7XG4gICAgICB0aGlzLl9vLm9uQ29tcGxldGVkKCk7XG4gICAgfTtcblxuICAgIHJldHVybiBXaXRoTGF0ZXN0RnJvbVNvdXJjZU9ic2VydmVyO1xuICB9KEFic3RyYWN0T2JzZXJ2ZXIpKTtcblxuICAvKipcbiAgICogTWVyZ2VzIHRoZSBzcGVjaWZpZWQgb2JzZXJ2YWJsZSBzZXF1ZW5jZXMgaW50byBvbmUgb2JzZXJ2YWJsZSBzZXF1ZW5jZSBieSB1c2luZyB0aGUgc2VsZWN0b3IgZnVuY3Rpb24gb25seSB3aGVuIHRoZSAoZmlyc3QpIHNvdXJjZSBvYnNlcnZhYmxlIHNlcXVlbmNlIHByb2R1Y2VzIGFuIGVsZW1lbnQuXG4gICAqIEByZXR1cm5zIHtPYnNlcnZhYmxlfSBBbiBvYnNlcnZhYmxlIHNlcXVlbmNlIGNvbnRhaW5pbmcgdGhlIHJlc3VsdCBvZiBjb21iaW5pbmcgZWxlbWVudHMgb2YgdGhlIHNvdXJjZXMgdXNpbmcgdGhlIHNwZWNpZmllZCByZXN1bHQgc2VsZWN0b3IgZnVuY3Rpb24uXG4gICAqL1xuICBvYnNlcnZhYmxlUHJvdG8ud2l0aExhdGVzdEZyb20gPSBmdW5jdGlvbiAoKSB7XG4gICAgaWYgKGFyZ3VtZW50cy5sZW5ndGggPT09IDApIHsgdGhyb3cgbmV3IEVycm9yKCdpbnZhbGlkIGFyZ3VtZW50cycpOyB9XG5cbiAgICB2YXIgbGVuID0gYXJndW1lbnRzLmxlbmd0aCwgYXJncyA9IG5ldyBBcnJheShsZW4pO1xuICAgIGZvcih2YXIgaSA9IDA7IGkgPCBsZW47IGkrKykgeyBhcmdzW2ldID0gYXJndW1lbnRzW2ldOyB9XG4gICAgdmFyIHJlc3VsdFNlbGVjdG9yID0gaXNGdW5jdGlvbihhcmdzW2xlbiAtIDFdKSA/IGFyZ3MucG9wKCkgOiBhcmd1bWVudHNUb0FycmF5O1xuICAgIEFycmF5LmlzQXJyYXkoYXJnc1swXSkgJiYgKGFyZ3MgPSBhcmdzWzBdKTtcblxuICAgIHJldHVybiBuZXcgV2l0aExhdGVzdEZyb21PYnNlcnZhYmxlKHRoaXMsIGFyZ3MsIHJlc3VsdFNlbGVjdG9yKTtcbiAgfTtcblxuICBmdW5jdGlvbiBmYWxzZUZhY3RvcnkoKSB7IHJldHVybiBmYWxzZTsgfVxuICBmdW5jdGlvbiBlbXB0eUFycmF5RmFjdG9yeSgpIHsgcmV0dXJuIFtdOyB9XG5cbiAgdmFyIFppcE9ic2VydmFibGUgPSAoZnVuY3Rpb24oX19zdXBlcl9fKSB7XG4gICAgaW5oZXJpdHMoWmlwT2JzZXJ2YWJsZSwgX19zdXBlcl9fKTtcbiAgICBmdW5jdGlvbiBaaXBPYnNlcnZhYmxlKHNvdXJjZXMsIHJlc3VsdFNlbGVjdG9yKSB7XG4gICAgICB2YXIgbGVuID0gc291cmNlcy5sZW5ndGg7XG4gICAgICB0aGlzLl9zID0gc291cmNlcztcbiAgICAgIHRoaXMuX2NiID0gcmVzdWx0U2VsZWN0b3I7XG4gICAgICB0aGlzLl9kb25lID0gYXJyYXlJbml0aWFsaXplKGxlbiwgZmFsc2VGYWN0b3J5KTtcbiAgICAgIHRoaXMuX3EgPSBhcnJheUluaXRpYWxpemUobGVuLCBlbXB0eUFycmF5RmFjdG9yeSk7XG4gICAgICBfX3N1cGVyX18uY2FsbCh0aGlzKTtcbiAgICB9XG5cbiAgICBaaXBPYnNlcnZhYmxlLnByb3RvdHlwZS5zdWJzY3JpYmVDb3JlID0gZnVuY3Rpb24ob2JzZXJ2ZXIpIHtcbiAgICAgIHZhciBuID0gdGhpcy5fcy5sZW5ndGgsIHN1YnNjcmlwdGlvbnMgPSBuZXcgQXJyYXkobik7XG5cbiAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbjsgaSsrKSB7XG4gICAgICAgIHZhciBzb3VyY2UgPSB0aGlzLl9zW2ldLCBzYWQgPSBuZXcgU2luZ2xlQXNzaWdubWVudERpc3Bvc2FibGUoKTtcbiAgICAgICAgc3Vic2NyaXB0aW9uc1tpXSA9IHNhZDtcbiAgICAgICAgaXNQcm9taXNlKHNvdXJjZSkgJiYgKHNvdXJjZSA9IG9ic2VydmFibGVGcm9tUHJvbWlzZShzb3VyY2UpKTtcbiAgICAgICAgc2FkLnNldERpc3Bvc2FibGUoc291cmNlLnN1YnNjcmliZShuZXcgWmlwT2JzZXJ2ZXIob2JzZXJ2ZXIsIGksIHRoaXMpKSk7XG4gICAgICB9XG5cbiAgICAgIHJldHVybiBuZXcgTkFyeURpc3Bvc2FibGUoc3Vic2NyaXB0aW9ucyk7XG4gICAgfTtcblxuICAgIHJldHVybiBaaXBPYnNlcnZhYmxlO1xuICB9KE9ic2VydmFibGVCYXNlKSk7XG5cbiAgdmFyIFppcE9ic2VydmVyID0gKGZ1bmN0aW9uIChfX3N1cGVyX18pIHtcbiAgICBpbmhlcml0cyhaaXBPYnNlcnZlciwgX19zdXBlcl9fKTtcbiAgICBmdW5jdGlvbiBaaXBPYnNlcnZlcihvLCBpLCBwKSB7XG4gICAgICB0aGlzLl9vID0gbztcbiAgICAgIHRoaXMuX2kgPSBpO1xuICAgICAgdGhpcy5fcCA9IHA7XG4gICAgICBfX3N1cGVyX18uY2FsbCh0aGlzKTtcbiAgICB9XG5cbiAgICBaaXBPYnNlcnZlci5wcm90b3R5cGUubmV4dCA9IGZ1bmN0aW9uICh4KSB7XG4gICAgICB0aGlzLl9wLl9xW3RoaXMuX2ldLnB1c2goeCk7XG4gICAgICBpZiAodGhpcy5fcC5fcS5ldmVyeShmdW5jdGlvbiAoeCkgeyByZXR1cm4geC5sZW5ndGggPiAwOyB9KSkge1xuICAgICAgICB2YXIgcXVldWVkVmFsdWVzID0gdGhpcy5fcC5fcS5tYXAoZnVuY3Rpb24gKHgpIHsgcmV0dXJuIHguc2hpZnQoKTsgfSk7XG4gICAgICAgIHZhciByZXMgPSB0cnlDYXRjaCh0aGlzLl9wLl9jYikuYXBwbHkobnVsbCwgcXVldWVkVmFsdWVzKTtcbiAgICAgICAgaWYgKHJlcyA9PT0gZXJyb3JPYmopIHsgcmV0dXJuIHRoaXMuX28ub25FcnJvcihyZXMuZSk7IH1cbiAgICAgICAgdGhpcy5fby5vbk5leHQocmVzKTtcbiAgICAgIH0gZWxzZSBpZiAodGhpcy5fcC5fZG9uZS5maWx0ZXIoZnVuY3Rpb24gKHgsIGopIHsgcmV0dXJuIGogIT09IHRoaXMuX2k7IH0sIHRoaXMpLmV2ZXJ5KGlkZW50aXR5KSkge1xuICAgICAgICB0aGlzLl9vLm9uQ29tcGxldGVkKCk7XG4gICAgICB9XG4gICAgfTtcblxuICAgIFppcE9ic2VydmVyLnByb3RvdHlwZS5lcnJvciA9IGZ1bmN0aW9uIChlKSB7XG4gICAgICB0aGlzLl9vLm9uRXJyb3IoZSk7XG4gICAgfTtcblxuICAgIFppcE9ic2VydmVyLnByb3RvdHlwZS5jb21wbGV0ZWQgPSBmdW5jdGlvbiAoKSB7XG4gICAgICB0aGlzLl9wLl9kb25lW3RoaXMuX2ldID0gdHJ1ZTtcbiAgICAgIHRoaXMuX3AuX2RvbmUuZXZlcnkoaWRlbnRpdHkpICYmIHRoaXMuX28ub25Db21wbGV0ZWQoKTtcbiAgICB9O1xuXG4gICAgcmV0dXJuIFppcE9ic2VydmVyO1xuICB9KEFic3RyYWN0T2JzZXJ2ZXIpKTtcblxuICAvKipcbiAgICogTWVyZ2VzIHRoZSBzcGVjaWZpZWQgb2JzZXJ2YWJsZSBzZXF1ZW5jZXMgaW50byBvbmUgb2JzZXJ2YWJsZSBzZXF1ZW5jZSBieSB1c2luZyB0aGUgc2VsZWN0b3IgZnVuY3Rpb24gd2hlbmV2ZXIgYWxsIG9mIHRoZSBvYnNlcnZhYmxlIHNlcXVlbmNlcyBvciBhbiBhcnJheSBoYXZlIHByb2R1Y2VkIGFuIGVsZW1lbnQgYXQgYSBjb3JyZXNwb25kaW5nIGluZGV4LlxuICAgKiBUaGUgbGFzdCBlbGVtZW50IGluIHRoZSBhcmd1bWVudHMgbXVzdCBiZSBhIGZ1bmN0aW9uIHRvIGludm9rZSBmb3IgZWFjaCBzZXJpZXMgb2YgZWxlbWVudHMgYXQgY29ycmVzcG9uZGluZyBpbmRleGVzIGluIHRoZSBhcmdzLlxuICAgKiBAcmV0dXJucyB7T2JzZXJ2YWJsZX0gQW4gb2JzZXJ2YWJsZSBzZXF1ZW5jZSBjb250YWluaW5nIHRoZSByZXN1bHQgb2YgY29tYmluaW5nIGVsZW1lbnRzIG9mIHRoZSBhcmdzIHVzaW5nIHRoZSBzcGVjaWZpZWQgcmVzdWx0IHNlbGVjdG9yIGZ1bmN0aW9uLlxuICAgKi9cbiAgb2JzZXJ2YWJsZVByb3RvLnppcCA9IGZ1bmN0aW9uICgpIHtcbiAgICBpZiAoYXJndW1lbnRzLmxlbmd0aCA9PT0gMCkgeyB0aHJvdyBuZXcgRXJyb3IoJ2ludmFsaWQgYXJndW1lbnRzJyk7IH1cblxuICAgIHZhciBsZW4gPSBhcmd1bWVudHMubGVuZ3RoLCBhcmdzID0gbmV3IEFycmF5KGxlbik7XG4gICAgZm9yKHZhciBpID0gMDsgaSA8IGxlbjsgaSsrKSB7IGFyZ3NbaV0gPSBhcmd1bWVudHNbaV07IH1cbiAgICB2YXIgcmVzdWx0U2VsZWN0b3IgPSBpc0Z1bmN0aW9uKGFyZ3NbbGVuIC0gMV0pID8gYXJncy5wb3AoKSA6IGFyZ3VtZW50c1RvQXJyYXk7XG4gICAgQXJyYXkuaXNBcnJheShhcmdzWzBdKSAmJiAoYXJncyA9IGFyZ3NbMF0pO1xuXG4gICAgdmFyIHBhcmVudCA9IHRoaXM7XG4gICAgYXJncy51bnNoaWZ0KHBhcmVudCk7XG5cbiAgICByZXR1cm4gbmV3IFppcE9ic2VydmFibGUoYXJncywgcmVzdWx0U2VsZWN0b3IpO1xuICB9O1xuXG4gIC8qKlxuICAgKiBNZXJnZXMgdGhlIHNwZWNpZmllZCBvYnNlcnZhYmxlIHNlcXVlbmNlcyBpbnRvIG9uZSBvYnNlcnZhYmxlIHNlcXVlbmNlIGJ5IHVzaW5nIHRoZSBzZWxlY3RvciBmdW5jdGlvbiB3aGVuZXZlciBhbGwgb2YgdGhlIG9ic2VydmFibGUgc2VxdWVuY2VzIGhhdmUgcHJvZHVjZWQgYW4gZWxlbWVudCBhdCBhIGNvcnJlc3BvbmRpbmcgaW5kZXguXG4gICAqIEBwYXJhbSBhcmd1bWVudHMgT2JzZXJ2YWJsZSBzb3VyY2VzLlxuICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSByZXN1bHRTZWxlY3RvciBGdW5jdGlvbiB0byBpbnZva2UgZm9yIGVhY2ggc2VyaWVzIG9mIGVsZW1lbnRzIGF0IGNvcnJlc3BvbmRpbmcgaW5kZXhlcyBpbiB0aGUgc291cmNlcy5cbiAgICogQHJldHVybnMge09ic2VydmFibGV9IEFuIG9ic2VydmFibGUgc2VxdWVuY2UgY29udGFpbmluZyB0aGUgcmVzdWx0IG9mIGNvbWJpbmluZyBlbGVtZW50cyBvZiB0aGUgc291cmNlcyB1c2luZyB0aGUgc3BlY2lmaWVkIHJlc3VsdCBzZWxlY3RvciBmdW5jdGlvbi5cbiAgICovXG4gIE9ic2VydmFibGUuemlwID0gZnVuY3Rpb24gKCkge1xuICAgIHZhciBsZW4gPSBhcmd1bWVudHMubGVuZ3RoLCBhcmdzID0gbmV3IEFycmF5KGxlbik7XG4gICAgZm9yKHZhciBpID0gMDsgaSA8IGxlbjsgaSsrKSB7IGFyZ3NbaV0gPSBhcmd1bWVudHNbaV07IH1cbiAgICBpZiAoQXJyYXkuaXNBcnJheShhcmdzWzBdKSkge1xuICAgICAgYXJncyA9IGlzRnVuY3Rpb24oYXJnc1sxXSkgPyBhcmdzWzBdLmNvbmNhdChhcmdzWzFdKSA6IGFyZ3NbMF07XG4gICAgfVxuICAgIHZhciBmaXJzdCA9IGFyZ3Muc2hpZnQoKTtcbiAgICByZXR1cm4gZmlyc3QuemlwLmFwcGx5KGZpcnN0LCBhcmdzKTtcbiAgfTtcblxuZnVuY3Rpb24gZmFsc2VGYWN0b3J5KCkgeyByZXR1cm4gZmFsc2U7IH1cbmZ1bmN0aW9uIGVtcHR5QXJyYXlGYWN0b3J5KCkgeyByZXR1cm4gW107IH1cbmZ1bmN0aW9uIGFyZ3VtZW50c1RvQXJyYXkoKSB7XG4gIHZhciBsZW4gPSBhcmd1bWVudHMubGVuZ3RoLCBhcmdzID0gbmV3IEFycmF5KGxlbik7XG4gIGZvcih2YXIgaSA9IDA7IGkgPCBsZW47IGkrKykgeyBhcmdzW2ldID0gYXJndW1lbnRzW2ldOyB9XG4gIHJldHVybiBhcmdzO1xufVxuXG4vKipcbiAqIE1lcmdlcyB0aGUgc3BlY2lmaWVkIG9ic2VydmFibGUgc2VxdWVuY2VzIGludG8gb25lIG9ic2VydmFibGUgc2VxdWVuY2UgYnkgdXNpbmcgdGhlIHNlbGVjdG9yIGZ1bmN0aW9uIHdoZW5ldmVyIGFsbCBvZiB0aGUgb2JzZXJ2YWJsZSBzZXF1ZW5jZXMgb3IgYW4gYXJyYXkgaGF2ZSBwcm9kdWNlZCBhbiBlbGVtZW50IGF0IGEgY29ycmVzcG9uZGluZyBpbmRleC5cbiAqIFRoZSBsYXN0IGVsZW1lbnQgaW4gdGhlIGFyZ3VtZW50cyBtdXN0IGJlIGEgZnVuY3Rpb24gdG8gaW52b2tlIGZvciBlYWNoIHNlcmllcyBvZiBlbGVtZW50cyBhdCBjb3JyZXNwb25kaW5nIGluZGV4ZXMgaW4gdGhlIGFyZ3MuXG4gKiBAcmV0dXJucyB7T2JzZXJ2YWJsZX0gQW4gb2JzZXJ2YWJsZSBzZXF1ZW5jZSBjb250YWluaW5nIHRoZSByZXN1bHQgb2YgY29tYmluaW5nIGVsZW1lbnRzIG9mIHRoZSBhcmdzIHVzaW5nIHRoZSBzcGVjaWZpZWQgcmVzdWx0IHNlbGVjdG9yIGZ1bmN0aW9uLlxuICovXG5vYnNlcnZhYmxlUHJvdG8uemlwSXRlcmFibGUgPSBmdW5jdGlvbiAoKSB7XG4gIGlmIChhcmd1bWVudHMubGVuZ3RoID09PSAwKSB7IHRocm93IG5ldyBFcnJvcignaW52YWxpZCBhcmd1bWVudHMnKTsgfVxuXG4gIHZhciBsZW4gPSBhcmd1bWVudHMubGVuZ3RoLCBhcmdzID0gbmV3IEFycmF5KGxlbik7XG4gIGZvcih2YXIgaSA9IDA7IGkgPCBsZW47IGkrKykgeyBhcmdzW2ldID0gYXJndW1lbnRzW2ldOyB9XG4gIHZhciByZXN1bHRTZWxlY3RvciA9IGlzRnVuY3Rpb24oYXJnc1tsZW4gLSAxXSkgPyBhcmdzLnBvcCgpIDogYXJndW1lbnRzVG9BcnJheTtcblxuICB2YXIgcGFyZW50ID0gdGhpcztcbiAgYXJncy51bnNoaWZ0KHBhcmVudCk7XG4gIHJldHVybiBuZXcgQW5vbnltb3VzT2JzZXJ2YWJsZShmdW5jdGlvbiAobykge1xuICAgIHZhciBuID0gYXJncy5sZW5ndGgsXG4gICAgICBxdWV1ZXMgPSBhcnJheUluaXRpYWxpemUobiwgZW1wdHlBcnJheUZhY3RvcnkpLFxuICAgICAgaXNEb25lID0gYXJyYXlJbml0aWFsaXplKG4sIGZhbHNlRmFjdG9yeSk7XG5cbiAgICB2YXIgc3Vic2NyaXB0aW9ucyA9IG5ldyBBcnJheShuKTtcbiAgICBmb3IgKHZhciBpZHggPSAwOyBpZHggPCBuOyBpZHgrKykge1xuICAgICAgKGZ1bmN0aW9uIChpKSB7XG4gICAgICAgIHZhciBzb3VyY2UgPSBhcmdzW2ldLCBzYWQgPSBuZXcgU2luZ2xlQXNzaWdubWVudERpc3Bvc2FibGUoKTtcblxuICAgICAgICAoaXNBcnJheUxpa2Uoc291cmNlKSB8fCBpc0l0ZXJhYmxlKHNvdXJjZSkpICYmIChzb3VyY2UgPSBvYnNlcnZhYmxlRnJvbShzb3VyY2UpKTtcblxuICAgICAgICBzYWQuc2V0RGlzcG9zYWJsZShzb3VyY2Uuc3Vic2NyaWJlKGZ1bmN0aW9uICh4KSB7XG4gICAgICAgICAgcXVldWVzW2ldLnB1c2goeCk7XG4gICAgICAgICAgaWYgKHF1ZXVlcy5ldmVyeShmdW5jdGlvbiAoeCkgeyByZXR1cm4geC5sZW5ndGggPiAwOyB9KSkge1xuICAgICAgICAgICAgdmFyIHF1ZXVlZFZhbHVlcyA9IHF1ZXVlcy5tYXAoZnVuY3Rpb24gKHgpIHsgcmV0dXJuIHguc2hpZnQoKTsgfSksXG4gICAgICAgICAgICAgICAgcmVzID0gdHJ5Q2F0Y2gocmVzdWx0U2VsZWN0b3IpLmFwcGx5KHBhcmVudCwgcXVldWVkVmFsdWVzKTtcbiAgICAgICAgICAgIGlmIChyZXMgPT09IGVycm9yT2JqKSB7IHJldHVybiBvLm9uRXJyb3IocmVzLmUpOyB9XG4gICAgICAgICAgICBvLm9uTmV4dChyZXMpO1xuICAgICAgICAgIH0gZWxzZSBpZiAoaXNEb25lLmZpbHRlcihmdW5jdGlvbiAoeCwgaikgeyByZXR1cm4gaiAhPT0gaTsgfSkuZXZlcnkoaWRlbnRpdHkpKSB7XG4gICAgICAgICAgICBvLm9uQ29tcGxldGVkKCk7XG4gICAgICAgICAgfVxuICAgICAgICB9LCBmdW5jdGlvbiAoZSkgeyBvLm9uRXJyb3IoZSk7IH0sIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICBpc0RvbmVbaV0gPSB0cnVlO1xuICAgICAgICAgIGlzRG9uZS5ldmVyeShpZGVudGl0eSkgJiYgby5vbkNvbXBsZXRlZCgpO1xuICAgICAgICB9KSk7XG4gICAgICAgIHN1YnNjcmlwdGlvbnNbaV0gPSBzYWQ7XG4gICAgICB9KShpZHgpO1xuICAgIH1cblxuICAgIHJldHVybiBuZXcgQ29tcG9zaXRlRGlzcG9zYWJsZShzdWJzY3JpcHRpb25zKTtcbiAgfSwgcGFyZW50KTtcbn07XG5cbiAgZnVuY3Rpb24gYXNPYnNlcnZhYmxlKHNvdXJjZSkge1xuICAgIHJldHVybiBmdW5jdGlvbiBzdWJzY3JpYmUobykgeyByZXR1cm4gc291cmNlLnN1YnNjcmliZShvKTsgfTtcbiAgfVxuXG4gIC8qKlxuICAgKiAgSGlkZXMgdGhlIGlkZW50aXR5IG9mIGFuIG9ic2VydmFibGUgc2VxdWVuY2UuXG4gICAqIEByZXR1cm5zIHtPYnNlcnZhYmxlfSBBbiBvYnNlcnZhYmxlIHNlcXVlbmNlIHRoYXQgaGlkZXMgdGhlIGlkZW50aXR5IG9mIHRoZSBzb3VyY2Ugc2VxdWVuY2UuXG4gICAqL1xuICBvYnNlcnZhYmxlUHJvdG8uYXNPYnNlcnZhYmxlID0gZnVuY3Rpb24gKCkge1xuICAgIHJldHVybiBuZXcgQW5vbnltb3VzT2JzZXJ2YWJsZShhc09ic2VydmFibGUodGhpcyksIHRoaXMpO1xuICB9O1xuXG4gIGZ1bmN0aW9uIHRvQXJyYXkoeCkgeyByZXR1cm4geC50b0FycmF5KCk7IH1cbiAgZnVuY3Rpb24gbm90RW1wdHkoeCkgeyByZXR1cm4geC5sZW5ndGggPiAwOyB9XG5cbiAgLyoqXG4gICAqICBQcm9qZWN0cyBlYWNoIGVsZW1lbnQgb2YgYW4gb2JzZXJ2YWJsZSBzZXF1ZW5jZSBpbnRvIHplcm8gb3IgbW9yZSBidWZmZXJzIHdoaWNoIGFyZSBwcm9kdWNlZCBiYXNlZCBvbiBlbGVtZW50IGNvdW50IGluZm9ybWF0aW9uLlxuICAgKiBAcGFyYW0ge051bWJlcn0gY291bnQgTGVuZ3RoIG9mIGVhY2ggYnVmZmVyLlxuICAgKiBAcGFyYW0ge051bWJlcn0gW3NraXBdIE51bWJlciBvZiBlbGVtZW50cyB0byBza2lwIGJldHdlZW4gY3JlYXRpb24gb2YgY29uc2VjdXRpdmUgYnVmZmVycy4gSWYgbm90IHByb3ZpZGVkLCBkZWZhdWx0cyB0byB0aGUgY291bnQuXG4gICAqIEByZXR1cm5zIHtPYnNlcnZhYmxlfSBBbiBvYnNlcnZhYmxlIHNlcXVlbmNlIG9mIGJ1ZmZlcnMuXG4gICAqL1xuICBvYnNlcnZhYmxlUHJvdG8uYnVmZmVyV2l0aENvdW50ID0gZnVuY3Rpb24gKGNvdW50LCBza2lwKSB7XG4gICAgdHlwZW9mIHNraXAgIT09ICdudW1iZXInICYmIChza2lwID0gY291bnQpO1xuICAgIHJldHVybiB0aGlzLndpbmRvd1dpdGhDb3VudChjb3VudCwgc2tpcClcbiAgICAgIC5mbGF0TWFwKHRvQXJyYXkpXG4gICAgICAuZmlsdGVyKG5vdEVtcHR5KTtcbiAgfTtcblxuICB2YXIgRGVtYXRlcmlhbGl6ZU9ic2VydmFibGUgPSAoZnVuY3Rpb24gKF9fc3VwZXJfXykge1xuICAgIGluaGVyaXRzKERlbWF0ZXJpYWxpemVPYnNlcnZhYmxlLCBfX3N1cGVyX18pO1xuICAgIGZ1bmN0aW9uIERlbWF0ZXJpYWxpemVPYnNlcnZhYmxlKHNvdXJjZSkge1xuICAgICAgdGhpcy5zb3VyY2UgPSBzb3VyY2U7XG4gICAgICBfX3N1cGVyX18uY2FsbCh0aGlzKTtcbiAgICB9XG5cbiAgICBEZW1hdGVyaWFsaXplT2JzZXJ2YWJsZS5wcm90b3R5cGUuc3Vic2NyaWJlQ29yZSA9IGZ1bmN0aW9uIChvKSB7XG4gICAgICByZXR1cm4gdGhpcy5zb3VyY2Uuc3Vic2NyaWJlKG5ldyBEZW1hdGVyaWFsaXplT2JzZXJ2ZXIobykpO1xuICAgIH07XG5cbiAgICByZXR1cm4gRGVtYXRlcmlhbGl6ZU9ic2VydmFibGU7XG4gIH0oT2JzZXJ2YWJsZUJhc2UpKTtcblxuICB2YXIgRGVtYXRlcmlhbGl6ZU9ic2VydmVyID0gKGZ1bmN0aW9uIChfX3N1cGVyX18pIHtcbiAgICBpbmhlcml0cyhEZW1hdGVyaWFsaXplT2JzZXJ2ZXIsIF9fc3VwZXJfXyk7XG5cbiAgICBmdW5jdGlvbiBEZW1hdGVyaWFsaXplT2JzZXJ2ZXIobykge1xuICAgICAgdGhpcy5fbyA9IG87XG4gICAgICBfX3N1cGVyX18uY2FsbCh0aGlzKTtcbiAgICB9XG5cbiAgICBEZW1hdGVyaWFsaXplT2JzZXJ2ZXIucHJvdG90eXBlLm5leHQgPSBmdW5jdGlvbiAoeCkgeyB4LmFjY2VwdCh0aGlzLl9vKTsgfTtcbiAgICBEZW1hdGVyaWFsaXplT2JzZXJ2ZXIucHJvdG90eXBlLmVycm9yID0gZnVuY3Rpb24gKGUpIHsgdGhpcy5fby5vbkVycm9yKGUpOyB9O1xuICAgIERlbWF0ZXJpYWxpemVPYnNlcnZlci5wcm90b3R5cGUuY29tcGxldGVkID0gZnVuY3Rpb24gKCkgeyB0aGlzLl9vLm9uQ29tcGxldGVkKCk7IH07XG5cbiAgICByZXR1cm4gRGVtYXRlcmlhbGl6ZU9ic2VydmVyO1xuICB9KEFic3RyYWN0T2JzZXJ2ZXIpKTtcblxuICAvKipcbiAgICogRGVtYXRlcmlhbGl6ZXMgdGhlIGV4cGxpY2l0IG5vdGlmaWNhdGlvbiB2YWx1ZXMgb2YgYW4gb2JzZXJ2YWJsZSBzZXF1ZW5jZSBhcyBpbXBsaWNpdCBub3RpZmljYXRpb25zLlxuICAgKiBAcmV0dXJucyB7T2JzZXJ2YWJsZX0gQW4gb2JzZXJ2YWJsZSBzZXF1ZW5jZSBleGhpYml0aW5nIHRoZSBiZWhhdmlvciBjb3JyZXNwb25kaW5nIHRvIHRoZSBzb3VyY2Ugc2VxdWVuY2UncyBub3RpZmljYXRpb24gdmFsdWVzLlxuICAgKi9cbiAgb2JzZXJ2YWJsZVByb3RvLmRlbWF0ZXJpYWxpemUgPSBmdW5jdGlvbiAoKSB7XG4gICAgcmV0dXJuIG5ldyBEZW1hdGVyaWFsaXplT2JzZXJ2YWJsZSh0aGlzKTtcbiAgfTtcblxuICB2YXIgRGlzdGluY3RVbnRpbENoYW5nZWRPYnNlcnZhYmxlID0gKGZ1bmN0aW9uKF9fc3VwZXJfXykge1xuICAgIGluaGVyaXRzKERpc3RpbmN0VW50aWxDaGFuZ2VkT2JzZXJ2YWJsZSwgX19zdXBlcl9fKTtcbiAgICBmdW5jdGlvbiBEaXN0aW5jdFVudGlsQ2hhbmdlZE9ic2VydmFibGUoc291cmNlLCBrZXlGbiwgY29tcGFyZXIpIHtcbiAgICAgIHRoaXMuc291cmNlID0gc291cmNlO1xuICAgICAgdGhpcy5rZXlGbiA9IGtleUZuO1xuICAgICAgdGhpcy5jb21wYXJlciA9IGNvbXBhcmVyO1xuICAgICAgX19zdXBlcl9fLmNhbGwodGhpcyk7XG4gICAgfVxuXG4gICAgRGlzdGluY3RVbnRpbENoYW5nZWRPYnNlcnZhYmxlLnByb3RvdHlwZS5zdWJzY3JpYmVDb3JlID0gZnVuY3Rpb24gKG8pIHtcbiAgICAgIHJldHVybiB0aGlzLnNvdXJjZS5zdWJzY3JpYmUobmV3IERpc3RpbmN0VW50aWxDaGFuZ2VkT2JzZXJ2ZXIobywgdGhpcy5rZXlGbiwgdGhpcy5jb21wYXJlcikpO1xuICAgIH07XG5cbiAgICByZXR1cm4gRGlzdGluY3RVbnRpbENoYW5nZWRPYnNlcnZhYmxlO1xuICB9KE9ic2VydmFibGVCYXNlKSk7XG5cbiAgdmFyIERpc3RpbmN0VW50aWxDaGFuZ2VkT2JzZXJ2ZXIgPSAoZnVuY3Rpb24oX19zdXBlcl9fKSB7XG4gICAgaW5oZXJpdHMoRGlzdGluY3RVbnRpbENoYW5nZWRPYnNlcnZlciwgX19zdXBlcl9fKTtcbiAgICBmdW5jdGlvbiBEaXN0aW5jdFVudGlsQ2hhbmdlZE9ic2VydmVyKG8sIGtleUZuLCBjb21wYXJlcikge1xuICAgICAgdGhpcy5vID0gbztcbiAgICAgIHRoaXMua2V5Rm4gPSBrZXlGbjtcbiAgICAgIHRoaXMuY29tcGFyZXIgPSBjb21wYXJlcjtcbiAgICAgIHRoaXMuaGFzQ3VycmVudEtleSA9IGZhbHNlO1xuICAgICAgdGhpcy5jdXJyZW50S2V5ID0gbnVsbDtcbiAgICAgIF9fc3VwZXJfXy5jYWxsKHRoaXMpO1xuICAgIH1cblxuICAgIERpc3RpbmN0VW50aWxDaGFuZ2VkT2JzZXJ2ZXIucHJvdG90eXBlLm5leHQgPSBmdW5jdGlvbiAoeCkge1xuICAgICAgdmFyIGtleSA9IHgsIGNvbXBhcmVyRXF1YWxzO1xuICAgICAgaWYgKGlzRnVuY3Rpb24odGhpcy5rZXlGbikpIHtcbiAgICAgICAga2V5ID0gdHJ5Q2F0Y2godGhpcy5rZXlGbikoeCk7XG4gICAgICAgIGlmIChrZXkgPT09IGVycm9yT2JqKSB7IHJldHVybiB0aGlzLm8ub25FcnJvcihrZXkuZSk7IH1cbiAgICAgIH1cbiAgICAgIGlmICh0aGlzLmhhc0N1cnJlbnRLZXkpIHtcbiAgICAgICAgY29tcGFyZXJFcXVhbHMgPSB0cnlDYXRjaCh0aGlzLmNvbXBhcmVyKSh0aGlzLmN1cnJlbnRLZXksIGtleSk7XG4gICAgICAgIGlmIChjb21wYXJlckVxdWFscyA9PT0gZXJyb3JPYmopIHsgcmV0dXJuIHRoaXMuby5vbkVycm9yKGNvbXBhcmVyRXF1YWxzLmUpOyB9XG4gICAgICB9XG4gICAgICBpZiAoIXRoaXMuaGFzQ3VycmVudEtleSB8fCAhY29tcGFyZXJFcXVhbHMpIHtcbiAgICAgICAgdGhpcy5oYXNDdXJyZW50S2V5ID0gdHJ1ZTtcbiAgICAgICAgdGhpcy5jdXJyZW50S2V5ID0ga2V5O1xuICAgICAgICB0aGlzLm8ub25OZXh0KHgpO1xuICAgICAgfVxuICAgIH07XG4gICAgRGlzdGluY3RVbnRpbENoYW5nZWRPYnNlcnZlci5wcm90b3R5cGUuZXJyb3IgPSBmdW5jdGlvbihlKSB7XG4gICAgICB0aGlzLm8ub25FcnJvcihlKTtcbiAgICB9O1xuICAgIERpc3RpbmN0VW50aWxDaGFuZ2VkT2JzZXJ2ZXIucHJvdG90eXBlLmNvbXBsZXRlZCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgIHRoaXMuby5vbkNvbXBsZXRlZCgpO1xuICAgIH07XG5cbiAgICByZXR1cm4gRGlzdGluY3RVbnRpbENoYW5nZWRPYnNlcnZlcjtcbiAgfShBYnN0cmFjdE9ic2VydmVyKSk7XG5cbiAgLyoqXG4gICogIFJldHVybnMgYW4gb2JzZXJ2YWJsZSBzZXF1ZW5jZSB0aGF0IGNvbnRhaW5zIG9ubHkgZGlzdGluY3QgY29udGlndW91cyBlbGVtZW50cyBhY2NvcmRpbmcgdG8gdGhlIGtleUZuIGFuZCB0aGUgY29tcGFyZXIuXG4gICogQHBhcmFtIHtGdW5jdGlvbn0gW2tleUZuXSBBIGZ1bmN0aW9uIHRvIGNvbXB1dGUgdGhlIGNvbXBhcmlzb24ga2V5IGZvciBlYWNoIGVsZW1lbnQuIElmIG5vdCBwcm92aWRlZCwgaXQgcHJvamVjdHMgdGhlIHZhbHVlLlxuICAqIEBwYXJhbSB7RnVuY3Rpb259IFtjb21wYXJlcl0gRXF1YWxpdHkgY29tcGFyZXIgZm9yIGNvbXB1dGVkIGtleSB2YWx1ZXMuIElmIG5vdCBwcm92aWRlZCwgZGVmYXVsdHMgdG8gYW4gZXF1YWxpdHkgY29tcGFyZXIgZnVuY3Rpb24uXG4gICogQHJldHVybnMge09ic2VydmFibGV9IEFuIG9ic2VydmFibGUgc2VxdWVuY2Ugb25seSBjb250YWluaW5nIHRoZSBkaXN0aW5jdCBjb250aWd1b3VzIGVsZW1lbnRzLCBiYXNlZCBvbiBhIGNvbXB1dGVkIGtleSB2YWx1ZSwgZnJvbSB0aGUgc291cmNlIHNlcXVlbmNlLlxuICAqL1xuICBvYnNlcnZhYmxlUHJvdG8uZGlzdGluY3RVbnRpbENoYW5nZWQgPSBmdW5jdGlvbiAoa2V5Rm4sIGNvbXBhcmVyKSB7XG4gICAgY29tcGFyZXIgfHwgKGNvbXBhcmVyID0gZGVmYXVsdENvbXBhcmVyKTtcbiAgICByZXR1cm4gbmV3IERpc3RpbmN0VW50aWxDaGFuZ2VkT2JzZXJ2YWJsZSh0aGlzLCBrZXlGbiwgY29tcGFyZXIpO1xuICB9O1xuXG4gIHZhciBUYXBPYnNlcnZhYmxlID0gKGZ1bmN0aW9uKF9fc3VwZXJfXykge1xuICAgIGluaGVyaXRzKFRhcE9ic2VydmFibGUsX19zdXBlcl9fKTtcbiAgICBmdW5jdGlvbiBUYXBPYnNlcnZhYmxlKHNvdXJjZSwgb2JzZXJ2ZXJPck9uTmV4dCwgb25FcnJvciwgb25Db21wbGV0ZWQpIHtcbiAgICAgIHRoaXMuc291cmNlID0gc291cmNlO1xuICAgICAgdGhpcy5fb04gPSBvYnNlcnZlck9yT25OZXh0O1xuICAgICAgdGhpcy5fb0UgPSBvbkVycm9yO1xuICAgICAgdGhpcy5fb0MgPSBvbkNvbXBsZXRlZDtcbiAgICAgIF9fc3VwZXJfXy5jYWxsKHRoaXMpO1xuICAgIH1cblxuICAgIFRhcE9ic2VydmFibGUucHJvdG90eXBlLnN1YnNjcmliZUNvcmUgPSBmdW5jdGlvbihvKSB7XG4gICAgICByZXR1cm4gdGhpcy5zb3VyY2Uuc3Vic2NyaWJlKG5ldyBJbm5lck9ic2VydmVyKG8sIHRoaXMpKTtcbiAgICB9O1xuXG4gICAgaW5oZXJpdHMoSW5uZXJPYnNlcnZlciwgQWJzdHJhY3RPYnNlcnZlcik7XG4gICAgZnVuY3Rpb24gSW5uZXJPYnNlcnZlcihvLCBwKSB7XG4gICAgICB0aGlzLm8gPSBvO1xuICAgICAgdGhpcy50ID0gIXAuX29OIHx8IGlzRnVuY3Rpb24ocC5fb04pID9cbiAgICAgICAgb2JzZXJ2ZXJDcmVhdGUocC5fb04gfHwgbm9vcCwgcC5fb0UgfHwgbm9vcCwgcC5fb0MgfHwgbm9vcCkgOlxuICAgICAgICBwLl9vTjtcbiAgICAgIHRoaXMuaXNTdG9wcGVkID0gZmFsc2U7XG4gICAgICBBYnN0cmFjdE9ic2VydmVyLmNhbGwodGhpcyk7XG4gICAgfVxuICAgIElubmVyT2JzZXJ2ZXIucHJvdG90eXBlLm5leHQgPSBmdW5jdGlvbih4KSB7XG4gICAgICB2YXIgcmVzID0gdHJ5Q2F0Y2godGhpcy50Lm9uTmV4dCkuY2FsbCh0aGlzLnQsIHgpO1xuICAgICAgaWYgKHJlcyA9PT0gZXJyb3JPYmopIHsgdGhpcy5vLm9uRXJyb3IocmVzLmUpOyB9XG4gICAgICB0aGlzLm8ub25OZXh0KHgpO1xuICAgIH07XG4gICAgSW5uZXJPYnNlcnZlci5wcm90b3R5cGUuZXJyb3IgPSBmdW5jdGlvbihlcnIpIHtcbiAgICAgIHZhciByZXMgPSB0cnlDYXRjaCh0aGlzLnQub25FcnJvcikuY2FsbCh0aGlzLnQsIGVycik7XG4gICAgICBpZiAocmVzID09PSBlcnJvck9iaikgeyByZXR1cm4gdGhpcy5vLm9uRXJyb3IocmVzLmUpOyB9XG4gICAgICB0aGlzLm8ub25FcnJvcihlcnIpO1xuICAgIH07XG4gICAgSW5uZXJPYnNlcnZlci5wcm90b3R5cGUuY29tcGxldGVkID0gZnVuY3Rpb24oKSB7XG4gICAgICB2YXIgcmVzID0gdHJ5Q2F0Y2godGhpcy50Lm9uQ29tcGxldGVkKS5jYWxsKHRoaXMudCk7XG4gICAgICBpZiAocmVzID09PSBlcnJvck9iaikgeyByZXR1cm4gdGhpcy5vLm9uRXJyb3IocmVzLmUpOyB9XG4gICAgICB0aGlzLm8ub25Db21wbGV0ZWQoKTtcbiAgICB9O1xuXG4gICAgcmV0dXJuIFRhcE9ic2VydmFibGU7XG4gIH0oT2JzZXJ2YWJsZUJhc2UpKTtcblxuICAvKipcbiAgKiAgSW52b2tlcyBhbiBhY3Rpb24gZm9yIGVhY2ggZWxlbWVudCBpbiB0aGUgb2JzZXJ2YWJsZSBzZXF1ZW5jZSBhbmQgaW52b2tlcyBhbiBhY3Rpb24gdXBvbiBncmFjZWZ1bCBvciBleGNlcHRpb25hbCB0ZXJtaW5hdGlvbiBvZiB0aGUgb2JzZXJ2YWJsZSBzZXF1ZW5jZS5cbiAgKiAgVGhpcyBtZXRob2QgY2FuIGJlIHVzZWQgZm9yIGRlYnVnZ2luZywgbG9nZ2luZywgZXRjLiBvZiBxdWVyeSBiZWhhdmlvciBieSBpbnRlcmNlcHRpbmcgdGhlIG1lc3NhZ2Ugc3RyZWFtIHRvIHJ1biBhcmJpdHJhcnkgYWN0aW9ucyBmb3IgbWVzc2FnZXMgb24gdGhlIHBpcGVsaW5lLlxuICAqIEBwYXJhbSB7RnVuY3Rpb24gfCBPYnNlcnZlcn0gb2JzZXJ2ZXJPck9uTmV4dCBBY3Rpb24gdG8gaW52b2tlIGZvciBlYWNoIGVsZW1lbnQgaW4gdGhlIG9ic2VydmFibGUgc2VxdWVuY2Ugb3IgYW4gby5cbiAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBbb25FcnJvcl0gIEFjdGlvbiB0byBpbnZva2UgdXBvbiBleGNlcHRpb25hbCB0ZXJtaW5hdGlvbiBvZiB0aGUgb2JzZXJ2YWJsZSBzZXF1ZW5jZS4gVXNlZCBpZiBvbmx5IHRoZSBvYnNlcnZlck9yT25OZXh0IHBhcmFtZXRlciBpcyBhbHNvIGEgZnVuY3Rpb24uXG4gICogQHBhcmFtIHtGdW5jdGlvbn0gW29uQ29tcGxldGVkXSAgQWN0aW9uIHRvIGludm9rZSB1cG9uIGdyYWNlZnVsIHRlcm1pbmF0aW9uIG9mIHRoZSBvYnNlcnZhYmxlIHNlcXVlbmNlLiBVc2VkIGlmIG9ubHkgdGhlIG9ic2VydmVyT3JPbk5leHQgcGFyYW1ldGVyIGlzIGFsc28gYSBmdW5jdGlvbi5cbiAgKiBAcmV0dXJucyB7T2JzZXJ2YWJsZX0gVGhlIHNvdXJjZSBzZXF1ZW5jZSB3aXRoIHRoZSBzaWRlLWVmZmVjdGluZyBiZWhhdmlvciBhcHBsaWVkLlxuICAqL1xuICBvYnNlcnZhYmxlUHJvdG9bJ2RvJ10gPSBvYnNlcnZhYmxlUHJvdG8udGFwID0gb2JzZXJ2YWJsZVByb3RvLmRvQWN0aW9uID0gZnVuY3Rpb24gKG9ic2VydmVyT3JPbk5leHQsIG9uRXJyb3IsIG9uQ29tcGxldGVkKSB7XG4gICAgcmV0dXJuIG5ldyBUYXBPYnNlcnZhYmxlKHRoaXMsIG9ic2VydmVyT3JPbk5leHQsIG9uRXJyb3IsIG9uQ29tcGxldGVkKTtcbiAgfTtcblxuICAvKipcbiAgKiAgSW52b2tlcyBhbiBhY3Rpb24gZm9yIGVhY2ggZWxlbWVudCBpbiB0aGUgb2JzZXJ2YWJsZSBzZXF1ZW5jZS5cbiAgKiAgVGhpcyBtZXRob2QgY2FuIGJlIHVzZWQgZm9yIGRlYnVnZ2luZywgbG9nZ2luZywgZXRjLiBvZiBxdWVyeSBiZWhhdmlvciBieSBpbnRlcmNlcHRpbmcgdGhlIG1lc3NhZ2Ugc3RyZWFtIHRvIHJ1biBhcmJpdHJhcnkgYWN0aW9ucyBmb3IgbWVzc2FnZXMgb24gdGhlIHBpcGVsaW5lLlxuICAqIEBwYXJhbSB7RnVuY3Rpb259IG9uTmV4dCBBY3Rpb24gdG8gaW52b2tlIGZvciBlYWNoIGVsZW1lbnQgaW4gdGhlIG9ic2VydmFibGUgc2VxdWVuY2UuXG4gICogQHBhcmFtIHtBbnl9IFt0aGlzQXJnXSBPYmplY3QgdG8gdXNlIGFzIHRoaXMgd2hlbiBleGVjdXRpbmcgY2FsbGJhY2suXG4gICogQHJldHVybnMge09ic2VydmFibGV9IFRoZSBzb3VyY2Ugc2VxdWVuY2Ugd2l0aCB0aGUgc2lkZS1lZmZlY3RpbmcgYmVoYXZpb3IgYXBwbGllZC5cbiAgKi9cbiAgb2JzZXJ2YWJsZVByb3RvLmRvT25OZXh0ID0gb2JzZXJ2YWJsZVByb3RvLnRhcE9uTmV4dCA9IGZ1bmN0aW9uIChvbk5leHQsIHRoaXNBcmcpIHtcbiAgICByZXR1cm4gdGhpcy50YXAodHlwZW9mIHRoaXNBcmcgIT09ICd1bmRlZmluZWQnID8gZnVuY3Rpb24gKHgpIHsgb25OZXh0LmNhbGwodGhpc0FyZywgeCk7IH0gOiBvbk5leHQpO1xuICB9O1xuXG4gIC8qKlxuICAqICBJbnZva2VzIGFuIGFjdGlvbiB1cG9uIGV4Y2VwdGlvbmFsIHRlcm1pbmF0aW9uIG9mIHRoZSBvYnNlcnZhYmxlIHNlcXVlbmNlLlxuICAqICBUaGlzIG1ldGhvZCBjYW4gYmUgdXNlZCBmb3IgZGVidWdnaW5nLCBsb2dnaW5nLCBldGMuIG9mIHF1ZXJ5IGJlaGF2aW9yIGJ5IGludGVyY2VwdGluZyB0aGUgbWVzc2FnZSBzdHJlYW0gdG8gcnVuIGFyYml0cmFyeSBhY3Rpb25zIGZvciBtZXNzYWdlcyBvbiB0aGUgcGlwZWxpbmUuXG4gICogQHBhcmFtIHtGdW5jdGlvbn0gb25FcnJvciBBY3Rpb24gdG8gaW52b2tlIHVwb24gZXhjZXB0aW9uYWwgdGVybWluYXRpb24gb2YgdGhlIG9ic2VydmFibGUgc2VxdWVuY2UuXG4gICogQHBhcmFtIHtBbnl9IFt0aGlzQXJnXSBPYmplY3QgdG8gdXNlIGFzIHRoaXMgd2hlbiBleGVjdXRpbmcgY2FsbGJhY2suXG4gICogQHJldHVybnMge09ic2VydmFibGV9IFRoZSBzb3VyY2Ugc2VxdWVuY2Ugd2l0aCB0aGUgc2lkZS1lZmZlY3RpbmcgYmVoYXZpb3IgYXBwbGllZC5cbiAgKi9cbiAgb2JzZXJ2YWJsZVByb3RvLmRvT25FcnJvciA9IG9ic2VydmFibGVQcm90by50YXBPbkVycm9yID0gZnVuY3Rpb24gKG9uRXJyb3IsIHRoaXNBcmcpIHtcbiAgICByZXR1cm4gdGhpcy50YXAobm9vcCwgdHlwZW9mIHRoaXNBcmcgIT09ICd1bmRlZmluZWQnID8gZnVuY3Rpb24gKGUpIHsgb25FcnJvci5jYWxsKHRoaXNBcmcsIGUpOyB9IDogb25FcnJvcik7XG4gIH07XG5cbiAgLyoqXG4gICogIEludm9rZXMgYW4gYWN0aW9uIHVwb24gZ3JhY2VmdWwgdGVybWluYXRpb24gb2YgdGhlIG9ic2VydmFibGUgc2VxdWVuY2UuXG4gICogIFRoaXMgbWV0aG9kIGNhbiBiZSB1c2VkIGZvciBkZWJ1Z2dpbmcsIGxvZ2dpbmcsIGV0Yy4gb2YgcXVlcnkgYmVoYXZpb3IgYnkgaW50ZXJjZXB0aW5nIHRoZSBtZXNzYWdlIHN0cmVhbSB0byBydW4gYXJiaXRyYXJ5IGFjdGlvbnMgZm9yIG1lc3NhZ2VzIG9uIHRoZSBwaXBlbGluZS5cbiAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBvbkNvbXBsZXRlZCBBY3Rpb24gdG8gaW52b2tlIHVwb24gZ3JhY2VmdWwgdGVybWluYXRpb24gb2YgdGhlIG9ic2VydmFibGUgc2VxdWVuY2UuXG4gICogQHBhcmFtIHtBbnl9IFt0aGlzQXJnXSBPYmplY3QgdG8gdXNlIGFzIHRoaXMgd2hlbiBleGVjdXRpbmcgY2FsbGJhY2suXG4gICogQHJldHVybnMge09ic2VydmFibGV9IFRoZSBzb3VyY2Ugc2VxdWVuY2Ugd2l0aCB0aGUgc2lkZS1lZmZlY3RpbmcgYmVoYXZpb3IgYXBwbGllZC5cbiAgKi9cbiAgb2JzZXJ2YWJsZVByb3RvLmRvT25Db21wbGV0ZWQgPSBvYnNlcnZhYmxlUHJvdG8udGFwT25Db21wbGV0ZWQgPSBmdW5jdGlvbiAob25Db21wbGV0ZWQsIHRoaXNBcmcpIHtcbiAgICByZXR1cm4gdGhpcy50YXAobm9vcCwgbnVsbCwgdHlwZW9mIHRoaXNBcmcgIT09ICd1bmRlZmluZWQnID8gZnVuY3Rpb24gKCkgeyBvbkNvbXBsZXRlZC5jYWxsKHRoaXNBcmcpOyB9IDogb25Db21wbGV0ZWQpO1xuICB9O1xuXG4gIC8qKlxuICAgKiAgSW52b2tlcyBhIHNwZWNpZmllZCBhY3Rpb24gYWZ0ZXIgdGhlIHNvdXJjZSBvYnNlcnZhYmxlIHNlcXVlbmNlIHRlcm1pbmF0ZXMgZ3JhY2VmdWxseSBvciBleGNlcHRpb25hbGx5LlxuICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBmaW5hbGx5QWN0aW9uIEFjdGlvbiB0byBpbnZva2UgYWZ0ZXIgdGhlIHNvdXJjZSBvYnNlcnZhYmxlIHNlcXVlbmNlIHRlcm1pbmF0ZXMuXG4gICAqIEByZXR1cm5zIHtPYnNlcnZhYmxlfSBTb3VyY2Ugc2VxdWVuY2Ugd2l0aCB0aGUgYWN0aW9uLWludm9raW5nIHRlcm1pbmF0aW9uIGJlaGF2aW9yIGFwcGxpZWQuXG4gICAqL1xuICBvYnNlcnZhYmxlUHJvdG9bJ2ZpbmFsbHknXSA9IGZ1bmN0aW9uIChhY3Rpb24pIHtcbiAgICB2YXIgc291cmNlID0gdGhpcztcbiAgICByZXR1cm4gbmV3IEFub255bW91c09ic2VydmFibGUoZnVuY3Rpb24gKG9ic2VydmVyKSB7XG4gICAgICB2YXIgc3Vic2NyaXB0aW9uID0gdHJ5Q2F0Y2goc291cmNlLnN1YnNjcmliZSkuY2FsbChzb3VyY2UsIG9ic2VydmVyKTtcbiAgICAgIGlmIChzdWJzY3JpcHRpb24gPT09IGVycm9yT2JqKSB7XG4gICAgICAgIGFjdGlvbigpO1xuICAgICAgICByZXR1cm4gdGhyb3dlcihzdWJzY3JpcHRpb24uZSk7XG4gICAgICB9XG4gICAgICByZXR1cm4gZGlzcG9zYWJsZUNyZWF0ZShmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciByID0gdHJ5Q2F0Y2goc3Vic2NyaXB0aW9uLmRpc3Bvc2UpLmNhbGwoc3Vic2NyaXB0aW9uKTtcbiAgICAgICAgYWN0aW9uKCk7XG4gICAgICAgIHIgPT09IGVycm9yT2JqICYmIHRocm93ZXIoci5lKTtcbiAgICAgIH0pO1xuICAgIH0sIHRoaXMpO1xuICB9O1xuXG4gIHZhciBJZ25vcmVFbGVtZW50c09ic2VydmFibGUgPSAoZnVuY3Rpb24oX19zdXBlcl9fKSB7XG4gICAgaW5oZXJpdHMoSWdub3JlRWxlbWVudHNPYnNlcnZhYmxlLCBfX3N1cGVyX18pO1xuXG4gICAgZnVuY3Rpb24gSWdub3JlRWxlbWVudHNPYnNlcnZhYmxlKHNvdXJjZSkge1xuICAgICAgdGhpcy5zb3VyY2UgPSBzb3VyY2U7XG4gICAgICBfX3N1cGVyX18uY2FsbCh0aGlzKTtcbiAgICB9XG5cbiAgICBJZ25vcmVFbGVtZW50c09ic2VydmFibGUucHJvdG90eXBlLnN1YnNjcmliZUNvcmUgPSBmdW5jdGlvbiAobykge1xuICAgICAgcmV0dXJuIHRoaXMuc291cmNlLnN1YnNjcmliZShuZXcgSW5uZXJPYnNlcnZlcihvKSk7XG4gICAgfTtcblxuICAgIGZ1bmN0aW9uIElubmVyT2JzZXJ2ZXIobykge1xuICAgICAgdGhpcy5vID0gbztcbiAgICAgIHRoaXMuaXNTdG9wcGVkID0gZmFsc2U7XG4gICAgfVxuICAgIElubmVyT2JzZXJ2ZXIucHJvdG90eXBlLm9uTmV4dCA9IG5vb3A7XG4gICAgSW5uZXJPYnNlcnZlci5wcm90b3R5cGUub25FcnJvciA9IGZ1bmN0aW9uIChlcnIpIHtcbiAgICAgIGlmKCF0aGlzLmlzU3RvcHBlZCkge1xuICAgICAgICB0aGlzLmlzU3RvcHBlZCA9IHRydWU7XG4gICAgICAgIHRoaXMuby5vbkVycm9yKGVycik7XG4gICAgICB9XG4gICAgfTtcbiAgICBJbm5lck9ic2VydmVyLnByb3RvdHlwZS5vbkNvbXBsZXRlZCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgIGlmKCF0aGlzLmlzU3RvcHBlZCkge1xuICAgICAgICB0aGlzLmlzU3RvcHBlZCA9IHRydWU7XG4gICAgICAgIHRoaXMuby5vbkNvbXBsZXRlZCgpO1xuICAgICAgfVxuICAgIH07XG4gICAgSW5uZXJPYnNlcnZlci5wcm90b3R5cGUuZGlzcG9zZSA9IGZ1bmN0aW9uKCkgeyB0aGlzLmlzU3RvcHBlZCA9IHRydWU7IH07XG4gICAgSW5uZXJPYnNlcnZlci5wcm90b3R5cGUuZmFpbCA9IGZ1bmN0aW9uIChlKSB7XG4gICAgICBpZiAoIXRoaXMuaXNTdG9wcGVkKSB7XG4gICAgICAgIHRoaXMuaXNTdG9wcGVkID0gdHJ1ZTtcbiAgICAgICAgdGhpcy5vYnNlcnZlci5vbkVycm9yKGUpO1xuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgIH1cblxuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH07XG5cbiAgICByZXR1cm4gSWdub3JlRWxlbWVudHNPYnNlcnZhYmxlO1xuICB9KE9ic2VydmFibGVCYXNlKSk7XG5cbiAgLyoqXG4gICAqICBJZ25vcmVzIGFsbCBlbGVtZW50cyBpbiBhbiBvYnNlcnZhYmxlIHNlcXVlbmNlIGxlYXZpbmcgb25seSB0aGUgdGVybWluYXRpb24gbWVzc2FnZXMuXG4gICAqIEByZXR1cm5zIHtPYnNlcnZhYmxlfSBBbiBlbXB0eSBvYnNlcnZhYmxlIHNlcXVlbmNlIHRoYXQgc2lnbmFscyB0ZXJtaW5hdGlvbiwgc3VjY2Vzc2Z1bCBvciBleGNlcHRpb25hbCwgb2YgdGhlIHNvdXJjZSBzZXF1ZW5jZS5cbiAgICovXG4gIG9ic2VydmFibGVQcm90by5pZ25vcmVFbGVtZW50cyA9IGZ1bmN0aW9uICgpIHtcbiAgICByZXR1cm4gbmV3IElnbm9yZUVsZW1lbnRzT2JzZXJ2YWJsZSh0aGlzKTtcbiAgfTtcblxuICB2YXIgTWF0ZXJpYWxpemVPYnNlcnZhYmxlID0gKGZ1bmN0aW9uIChfX3N1cGVyX18pIHtcbiAgICBpbmhlcml0cyhNYXRlcmlhbGl6ZU9ic2VydmFibGUsIF9fc3VwZXJfXyk7XG4gICAgZnVuY3Rpb24gTWF0ZXJpYWxpemVPYnNlcnZhYmxlKHNvdXJjZSwgZm4pIHtcbiAgICAgIHRoaXMuc291cmNlID0gc291cmNlO1xuICAgICAgX19zdXBlcl9fLmNhbGwodGhpcyk7XG4gICAgfVxuXG4gICAgTWF0ZXJpYWxpemVPYnNlcnZhYmxlLnByb3RvdHlwZS5zdWJzY3JpYmVDb3JlID0gZnVuY3Rpb24gKG8pIHtcbiAgICAgIHJldHVybiB0aGlzLnNvdXJjZS5zdWJzY3JpYmUobmV3IE1hdGVyaWFsaXplT2JzZXJ2ZXIobykpO1xuICAgIH07XG5cbiAgICByZXR1cm4gTWF0ZXJpYWxpemVPYnNlcnZhYmxlO1xuICB9KE9ic2VydmFibGVCYXNlKSk7XG5cbiAgdmFyIE1hdGVyaWFsaXplT2JzZXJ2ZXIgPSAoZnVuY3Rpb24gKF9fc3VwZXJfXykge1xuICAgIGluaGVyaXRzKE1hdGVyaWFsaXplT2JzZXJ2ZXIsIF9fc3VwZXJfXyk7XG5cbiAgICBmdW5jdGlvbiBNYXRlcmlhbGl6ZU9ic2VydmVyKG8pIHtcbiAgICAgIHRoaXMuX28gPSBvO1xuICAgICAgX19zdXBlcl9fLmNhbGwodGhpcyk7XG4gICAgfVxuXG4gICAgTWF0ZXJpYWxpemVPYnNlcnZlci5wcm90b3R5cGUubmV4dCA9IGZ1bmN0aW9uICh4KSB7IHRoaXMuX28ub25OZXh0KG5vdGlmaWNhdGlvbkNyZWF0ZU9uTmV4dCh4KSkgfTtcbiAgICBNYXRlcmlhbGl6ZU9ic2VydmVyLnByb3RvdHlwZS5lcnJvciA9IGZ1bmN0aW9uIChlKSB7IHRoaXMuX28ub25OZXh0KG5vdGlmaWNhdGlvbkNyZWF0ZU9uRXJyb3IoZSkpOyB0aGlzLl9vLm9uQ29tcGxldGVkKCk7IH07XG4gICAgTWF0ZXJpYWxpemVPYnNlcnZlci5wcm90b3R5cGUuY29tcGxldGVkID0gZnVuY3Rpb24gKCkgeyB0aGlzLl9vLm9uTmV4dChub3RpZmljYXRpb25DcmVhdGVPbkNvbXBsZXRlZCgpKTsgdGhpcy5fby5vbkNvbXBsZXRlZCgpOyB9O1xuXG4gICAgcmV0dXJuIE1hdGVyaWFsaXplT2JzZXJ2ZXI7XG4gIH0oQWJzdHJhY3RPYnNlcnZlcikpO1xuXG4gIC8qKlxuICAgKiAgTWF0ZXJpYWxpemVzIHRoZSBpbXBsaWNpdCBub3RpZmljYXRpb25zIG9mIGFuIG9ic2VydmFibGUgc2VxdWVuY2UgYXMgZXhwbGljaXQgbm90aWZpY2F0aW9uIHZhbHVlcy5cbiAgICogQHJldHVybnMge09ic2VydmFibGV9IEFuIG9ic2VydmFibGUgc2VxdWVuY2UgY29udGFpbmluZyB0aGUgbWF0ZXJpYWxpemVkIG5vdGlmaWNhdGlvbiB2YWx1ZXMgZnJvbSB0aGUgc291cmNlIHNlcXVlbmNlLlxuICAgKi9cbiAgb2JzZXJ2YWJsZVByb3RvLm1hdGVyaWFsaXplID0gZnVuY3Rpb24gKCkge1xuICAgIHJldHVybiBuZXcgTWF0ZXJpYWxpemVPYnNlcnZhYmxlKHRoaXMpO1xuICB9O1xuXG4gIC8qKlxuICAgKiAgUmVwZWF0cyB0aGUgb2JzZXJ2YWJsZSBzZXF1ZW5jZSBhIHNwZWNpZmllZCBudW1iZXIgb2YgdGltZXMuIElmIHRoZSByZXBlYXQgY291bnQgaXMgbm90IHNwZWNpZmllZCwgdGhlIHNlcXVlbmNlIHJlcGVhdHMgaW5kZWZpbml0ZWx5LlxuICAgKiBAcGFyYW0ge051bWJlcn0gW3JlcGVhdENvdW50XSAgTnVtYmVyIG9mIHRpbWVzIHRvIHJlcGVhdCB0aGUgc2VxdWVuY2UuIElmIG5vdCBwcm92aWRlZCwgcmVwZWF0cyB0aGUgc2VxdWVuY2UgaW5kZWZpbml0ZWx5LlxuICAgKiBAcmV0dXJucyB7T2JzZXJ2YWJsZX0gVGhlIG9ic2VydmFibGUgc2VxdWVuY2UgcHJvZHVjaW5nIHRoZSBlbGVtZW50cyBvZiB0aGUgZ2l2ZW4gc2VxdWVuY2UgcmVwZWF0ZWRseS5cbiAgICovXG4gIG9ic2VydmFibGVQcm90by5yZXBlYXQgPSBmdW5jdGlvbiAocmVwZWF0Q291bnQpIHtcbiAgICByZXR1cm4gZW51bWVyYWJsZVJlcGVhdCh0aGlzLCByZXBlYXRDb3VudCkuY29uY2F0KCk7XG4gIH07XG5cbiAgLyoqXG4gICAqICBSZXBlYXRzIHRoZSBzb3VyY2Ugb2JzZXJ2YWJsZSBzZXF1ZW5jZSB0aGUgc3BlY2lmaWVkIG51bWJlciBvZiB0aW1lcyBvciB1bnRpbCBpdCBzdWNjZXNzZnVsbHkgdGVybWluYXRlcy4gSWYgdGhlIHJldHJ5IGNvdW50IGlzIG5vdCBzcGVjaWZpZWQsIGl0IHJldHJpZXMgaW5kZWZpbml0ZWx5LlxuICAgKiAgTm90ZSBpZiB5b3UgZW5jb3VudGVyIGFuIGVycm9yIGFuZCB3YW50IGl0IHRvIHJldHJ5IG9uY2UsIHRoZW4geW91IG11c3QgdXNlIC5yZXRyeSgyKTtcbiAgICpcbiAgICogQGV4YW1wbGVcbiAgICogIHZhciByZXMgPSByZXRyaWVkID0gcmV0cnkucmVwZWF0KCk7XG4gICAqICB2YXIgcmVzID0gcmV0cmllZCA9IHJldHJ5LnJlcGVhdCgyKTtcbiAgICogQHBhcmFtIHtOdW1iZXJ9IFtyZXRyeUNvdW50XSAgTnVtYmVyIG9mIHRpbWVzIHRvIHJldHJ5IHRoZSBzZXF1ZW5jZS4gSWYgbm90IHByb3ZpZGVkLCByZXRyeSB0aGUgc2VxdWVuY2UgaW5kZWZpbml0ZWx5LlxuICAgKiBAcmV0dXJucyB7T2JzZXJ2YWJsZX0gQW4gb2JzZXJ2YWJsZSBzZXF1ZW5jZSBwcm9kdWNpbmcgdGhlIGVsZW1lbnRzIG9mIHRoZSBnaXZlbiBzZXF1ZW5jZSByZXBlYXRlZGx5IHVudGlsIGl0IHRlcm1pbmF0ZXMgc3VjY2Vzc2Z1bGx5LlxuICAgKi9cbiAgb2JzZXJ2YWJsZVByb3RvLnJldHJ5ID0gZnVuY3Rpb24gKHJldHJ5Q291bnQpIHtcbiAgICByZXR1cm4gZW51bWVyYWJsZVJlcGVhdCh0aGlzLCByZXRyeUNvdW50KS5jYXRjaEVycm9yKCk7XG4gIH07XG5cbiAgLyoqXG4gICAqICBSZXBlYXRzIHRoZSBzb3VyY2Ugb2JzZXJ2YWJsZSBzZXF1ZW5jZSB1cG9uIGVycm9yIGVhY2ggdGltZSB0aGUgbm90aWZpZXIgZW1pdHMgb3IgdW50aWwgaXQgc3VjY2Vzc2Z1bGx5IHRlcm1pbmF0ZXMuIFxuICAgKiAgaWYgdGhlIG5vdGlmaWVyIGNvbXBsZXRlcywgdGhlIG9ic2VydmFibGUgc2VxdWVuY2UgY29tcGxldGVzLlxuICAgKlxuICAgKiBAZXhhbXBsZVxuICAgKiAgdmFyIHRpbWVyID0gT2JzZXJ2YWJsZS50aW1lcig1MDApO1xuICAgKiAgdmFyIHNvdXJjZSA9IG9ic2VydmFibGUucmV0cnlXaGVuKHRpbWVyKTtcbiAgICogQHBhcmFtIHtPYnNlcnZhYmxlfSBbbm90aWZpZXJdIEFuIG9ic2VydmFibGUgdGhhdCB0cmlnZ2VycyB0aGUgcmV0cmllcyBvciBjb21wbGV0ZXMgdGhlIG9ic2VydmFibGUgd2l0aCBvbk5leHQgb3Igb25Db21wbGV0ZWQgcmVzcGVjdGl2ZWx5LlxuICAgKiBAcmV0dXJucyB7T2JzZXJ2YWJsZX0gQW4gb2JzZXJ2YWJsZSBzZXF1ZW5jZSBwcm9kdWNpbmcgdGhlIGVsZW1lbnRzIG9mIHRoZSBnaXZlbiBzZXF1ZW5jZSByZXBlYXRlZGx5IHVudGlsIGl0IHRlcm1pbmF0ZXMgc3VjY2Vzc2Z1bGx5LlxuICAgKi9cbiAgb2JzZXJ2YWJsZVByb3RvLnJldHJ5V2hlbiA9IGZ1bmN0aW9uIChub3RpZmllcikge1xuICAgIHJldHVybiBlbnVtZXJhYmxlUmVwZWF0KHRoaXMpLmNhdGNoRXJyb3JXaGVuKG5vdGlmaWVyKTtcbiAgfTtcbiAgdmFyIFNjYW5PYnNlcnZhYmxlID0gKGZ1bmN0aW9uKF9fc3VwZXJfXykge1xuICAgIGluaGVyaXRzKFNjYW5PYnNlcnZhYmxlLCBfX3N1cGVyX18pO1xuICAgIGZ1bmN0aW9uIFNjYW5PYnNlcnZhYmxlKHNvdXJjZSwgYWNjdW11bGF0b3IsIGhhc1NlZWQsIHNlZWQpIHtcbiAgICAgIHRoaXMuc291cmNlID0gc291cmNlO1xuICAgICAgdGhpcy5hY2N1bXVsYXRvciA9IGFjY3VtdWxhdG9yO1xuICAgICAgdGhpcy5oYXNTZWVkID0gaGFzU2VlZDtcbiAgICAgIHRoaXMuc2VlZCA9IHNlZWQ7XG4gICAgICBfX3N1cGVyX18uY2FsbCh0aGlzKTtcbiAgICB9XG5cbiAgICBTY2FuT2JzZXJ2YWJsZS5wcm90b3R5cGUuc3Vic2NyaWJlQ29yZSA9IGZ1bmN0aW9uKG8pIHtcbiAgICAgIHJldHVybiB0aGlzLnNvdXJjZS5zdWJzY3JpYmUobmV3IFNjYW5PYnNlcnZlcihvLHRoaXMpKTtcbiAgICB9O1xuXG4gICAgcmV0dXJuIFNjYW5PYnNlcnZhYmxlO1xuICB9KE9ic2VydmFibGVCYXNlKSk7XG5cbiAgdmFyIFNjYW5PYnNlcnZlciA9IChmdW5jdGlvbiAoX19zdXBlcl9fKSB7XG4gICAgaW5oZXJpdHMoU2Nhbk9ic2VydmVyLCBfX3N1cGVyX18pO1xuICAgIGZ1bmN0aW9uIFNjYW5PYnNlcnZlcihvLCBwYXJlbnQpIHtcbiAgICAgIHRoaXMuX28gPSBvO1xuICAgICAgdGhpcy5fcCA9IHBhcmVudDtcbiAgICAgIHRoaXMuX2ZuID0gcGFyZW50LmFjY3VtdWxhdG9yO1xuICAgICAgdGhpcy5faHMgPSBwYXJlbnQuaGFzU2VlZDtcbiAgICAgIHRoaXMuX3MgPSBwYXJlbnQuc2VlZDtcbiAgICAgIHRoaXMuX2hhID0gZmFsc2U7XG4gICAgICB0aGlzLl9hID0gbnVsbDtcbiAgICAgIHRoaXMuX2h2ID0gZmFsc2U7XG4gICAgICB0aGlzLl9pID0gMDtcbiAgICAgIF9fc3VwZXJfXy5jYWxsKHRoaXMpO1xuICAgIH1cblxuICAgIFNjYW5PYnNlcnZlci5wcm90b3R5cGUubmV4dCA9IGZ1bmN0aW9uICh4KSB7XG4gICAgICAhdGhpcy5faHYgJiYgKHRoaXMuX2h2ID0gdHJ1ZSk7XG4gICAgICBpZiAodGhpcy5faGEpIHtcbiAgICAgICAgdGhpcy5fYSA9IHRyeUNhdGNoKHRoaXMuX2ZuKSh0aGlzLl9hLCB4LCB0aGlzLl9pLCB0aGlzLl9wKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHRoaXMuX2EgPSB0aGlzLl9ocyA/IHRyeUNhdGNoKHRoaXMuX2ZuKSh0aGlzLl9zLCB4LCB0aGlzLl9pLCB0aGlzLl9wKSA6IHg7XG4gICAgICAgIHRoaXMuX2hhID0gdHJ1ZTtcbiAgICAgIH1cbiAgICAgIGlmICh0aGlzLl9hID09PSBlcnJvck9iaikgeyByZXR1cm4gdGhpcy5fby5vbkVycm9yKHRoaXMuX2EuZSk7IH1cbiAgICAgIHRoaXMuX28ub25OZXh0KHRoaXMuX2EpO1xuICAgICAgdGhpcy5faSsrO1xuICAgIH07XG5cbiAgICBTY2FuT2JzZXJ2ZXIucHJvdG90eXBlLmVycm9yID0gZnVuY3Rpb24gKGUpIHtcbiAgICAgIHRoaXMuX28ub25FcnJvcihlKTtcbiAgICB9O1xuXG4gICAgU2Nhbk9ic2VydmVyLnByb3RvdHlwZS5jb21wbGV0ZWQgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAhdGhpcy5faHYgJiYgdGhpcy5faHMgJiYgdGhpcy5fby5vbk5leHQodGhpcy5fcyk7XG4gICAgICB0aGlzLl9vLm9uQ29tcGxldGVkKCk7XG4gICAgfTtcblxuICAgIHJldHVybiBTY2FuT2JzZXJ2ZXI7XG4gIH0oQWJzdHJhY3RPYnNlcnZlcikpO1xuXG4gIC8qKlxuICAqICBBcHBsaWVzIGFuIGFjY3VtdWxhdG9yIGZ1bmN0aW9uIG92ZXIgYW4gb2JzZXJ2YWJsZSBzZXF1ZW5jZSBhbmQgcmV0dXJucyBlYWNoIGludGVybWVkaWF0ZSByZXN1bHQuIFRoZSBvcHRpb25hbCBzZWVkIHZhbHVlIGlzIHVzZWQgYXMgdGhlIGluaXRpYWwgYWNjdW11bGF0b3IgdmFsdWUuXG4gICogIEZvciBhZ2dyZWdhdGlvbiBiZWhhdmlvciB3aXRoIG5vIGludGVybWVkaWF0ZSByZXN1bHRzLCBzZWUgT2JzZXJ2YWJsZS5hZ2dyZWdhdGUuXG4gICogQHBhcmFtIHtNaXhlZH0gW3NlZWRdIFRoZSBpbml0aWFsIGFjY3VtdWxhdG9yIHZhbHVlLlxuICAqIEBwYXJhbSB7RnVuY3Rpb259IGFjY3VtdWxhdG9yIEFuIGFjY3VtdWxhdG9yIGZ1bmN0aW9uIHRvIGJlIGludm9rZWQgb24gZWFjaCBlbGVtZW50LlxuICAqIEByZXR1cm5zIHtPYnNlcnZhYmxlfSBBbiBvYnNlcnZhYmxlIHNlcXVlbmNlIGNvbnRhaW5pbmcgdGhlIGFjY3VtdWxhdGVkIHZhbHVlcy5cbiAgKi9cbiAgb2JzZXJ2YWJsZVByb3RvLnNjYW4gPSBmdW5jdGlvbiAoKSB7XG4gICAgdmFyIGhhc1NlZWQgPSBmYWxzZSwgc2VlZCwgYWNjdW11bGF0b3IgPSBhcmd1bWVudHNbMF07XG4gICAgaWYgKGFyZ3VtZW50cy5sZW5ndGggPT09IDIpIHtcbiAgICAgIGhhc1NlZWQgPSB0cnVlO1xuICAgICAgc2VlZCA9IGFyZ3VtZW50c1sxXTtcbiAgICB9XG4gICAgcmV0dXJuIG5ldyBTY2FuT2JzZXJ2YWJsZSh0aGlzLCBhY2N1bXVsYXRvciwgaGFzU2VlZCwgc2VlZCk7XG4gIH07XG5cbiAgdmFyIFNraXBMYXN0T2JzZXJ2YWJsZSA9IChmdW5jdGlvbiAoX19zdXBlcl9fKSB7XG4gICAgaW5oZXJpdHMoU2tpcExhc3RPYnNlcnZhYmxlLCBfX3N1cGVyX18pO1xuICAgIGZ1bmN0aW9uIFNraXBMYXN0T2JzZXJ2YWJsZShzb3VyY2UsIGMpIHtcbiAgICAgIHRoaXMuc291cmNlID0gc291cmNlO1xuICAgICAgdGhpcy5fYyA9IGM7XG4gICAgICBfX3N1cGVyX18uY2FsbCh0aGlzKTtcbiAgICB9XG5cbiAgICBTa2lwTGFzdE9ic2VydmFibGUucHJvdG90eXBlLnN1YnNjcmliZUNvcmUgPSBmdW5jdGlvbiAobykge1xuICAgICAgcmV0dXJuIHRoaXMuc291cmNlLnN1YnNjcmliZShuZXcgU2tpcExhc3RPYnNlcnZlcihvLCB0aGlzLl9jKSk7XG4gICAgfTtcblxuICAgIHJldHVybiBTa2lwTGFzdE9ic2VydmFibGU7XG4gIH0oT2JzZXJ2YWJsZUJhc2UpKTtcblxuICB2YXIgU2tpcExhc3RPYnNlcnZlciA9IChmdW5jdGlvbiAoX19zdXBlcl9fKSB7XG4gICAgaW5oZXJpdHMoU2tpcExhc3RPYnNlcnZlciwgX19zdXBlcl9fKTtcbiAgICBmdW5jdGlvbiBTa2lwTGFzdE9ic2VydmVyKG8sIGMpIHtcbiAgICAgIHRoaXMuX28gPSBvO1xuICAgICAgdGhpcy5fYyA9IGM7XG4gICAgICB0aGlzLl9xID0gW107XG4gICAgICBfX3N1cGVyX18uY2FsbCh0aGlzKTtcbiAgICB9XG5cbiAgICBTa2lwTGFzdE9ic2VydmVyLnByb3RvdHlwZS5uZXh0ID0gZnVuY3Rpb24gKHgpIHtcbiAgICAgIHRoaXMuX3EucHVzaCh4KTtcbiAgICAgIHRoaXMuX3EubGVuZ3RoID4gdGhpcy5fYyAmJiB0aGlzLl9vLm9uTmV4dCh0aGlzLl9xLnNoaWZ0KCkpO1xuICAgIH07XG5cbiAgICBTa2lwTGFzdE9ic2VydmVyLnByb3RvdHlwZS5lcnJvciA9IGZ1bmN0aW9uIChlKSB7XG4gICAgICB0aGlzLl9vLm9uRXJyb3IoZSk7XG4gICAgfTtcblxuICAgIFNraXBMYXN0T2JzZXJ2ZXIucHJvdG90eXBlLmNvbXBsZXRlZCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgIHRoaXMuX28ub25Db21wbGV0ZWQoKTtcbiAgICB9O1xuXG4gICAgcmV0dXJuIFNraXBMYXN0T2JzZXJ2ZXI7XG4gIH0oQWJzdHJhY3RPYnNlcnZlcikpO1xuXG4gIC8qKlxuICAgKiAgQnlwYXNzZXMgYSBzcGVjaWZpZWQgbnVtYmVyIG9mIGVsZW1lbnRzIGF0IHRoZSBlbmQgb2YgYW4gb2JzZXJ2YWJsZSBzZXF1ZW5jZS5cbiAgICogQGRlc2NyaXB0aW9uXG4gICAqICBUaGlzIG9wZXJhdG9yIGFjY3VtdWxhdGVzIGEgcXVldWUgd2l0aCBhIGxlbmd0aCBlbm91Z2ggdG8gc3RvcmUgdGhlIGZpcnN0IGBjb3VudGAgZWxlbWVudHMuIEFzIG1vcmUgZWxlbWVudHMgYXJlXG4gICAqICByZWNlaXZlZCwgZWxlbWVudHMgYXJlIHRha2VuIGZyb20gdGhlIGZyb250IG9mIHRoZSBxdWV1ZSBhbmQgcHJvZHVjZWQgb24gdGhlIHJlc3VsdCBzZXF1ZW5jZS4gVGhpcyBjYXVzZXMgZWxlbWVudHMgdG8gYmUgZGVsYXllZC5cbiAgICogQHBhcmFtIGNvdW50IE51bWJlciBvZiBlbGVtZW50cyB0byBieXBhc3MgYXQgdGhlIGVuZCBvZiB0aGUgc291cmNlIHNlcXVlbmNlLlxuICAgKiBAcmV0dXJucyB7T2JzZXJ2YWJsZX0gQW4gb2JzZXJ2YWJsZSBzZXF1ZW5jZSBjb250YWluaW5nIHRoZSBzb3VyY2Ugc2VxdWVuY2UgZWxlbWVudHMgZXhjZXB0IGZvciB0aGUgYnlwYXNzZWQgb25lcyBhdCB0aGUgZW5kLlxuICAgKi9cbiAgb2JzZXJ2YWJsZVByb3RvLnNraXBMYXN0ID0gZnVuY3Rpb24gKGNvdW50KSB7XG4gICAgaWYgKGNvdW50IDwgMCkgeyB0aHJvdyBuZXcgQXJndW1lbnRPdXRPZlJhbmdlRXJyb3IoKTsgfVxuICAgIHJldHVybiBuZXcgU2tpcExhc3RPYnNlcnZhYmxlKHRoaXMsIGNvdW50KTtcbiAgfTtcblxuICAvKipcbiAgICogIFByZXBlbmRzIGEgc2VxdWVuY2Ugb2YgdmFsdWVzIHRvIGFuIG9ic2VydmFibGUgc2VxdWVuY2Ugd2l0aCBhbiBvcHRpb25hbCBzY2hlZHVsZXIgYW5kIGFuIGFyZ3VtZW50IGxpc3Qgb2YgdmFsdWVzIHRvIHByZXBlbmQuXG4gICAqICBAZXhhbXBsZVxuICAgKiAgdmFyIHJlcyA9IHNvdXJjZS5zdGFydFdpdGgoMSwgMiwgMyk7XG4gICAqICB2YXIgcmVzID0gc291cmNlLnN0YXJ0V2l0aChSeC5TY2hlZHVsZXIudGltZW91dCwgMSwgMiwgMyk7XG4gICAqIEBwYXJhbSB7QXJndW1lbnRzfSBhcmdzIFRoZSBzcGVjaWZpZWQgdmFsdWVzIHRvIHByZXBlbmQgdG8gdGhlIG9ic2VydmFibGUgc2VxdWVuY2VcbiAgICogQHJldHVybnMge09ic2VydmFibGV9IFRoZSBzb3VyY2Ugc2VxdWVuY2UgcHJlcGVuZGVkIHdpdGggdGhlIHNwZWNpZmllZCB2YWx1ZXMuXG4gICAqL1xuICBvYnNlcnZhYmxlUHJvdG8uc3RhcnRXaXRoID0gZnVuY3Rpb24gKCkge1xuICAgIHZhciB2YWx1ZXMsIHNjaGVkdWxlciwgc3RhcnQgPSAwO1xuICAgIGlmICghIWFyZ3VtZW50cy5sZW5ndGggJiYgaXNTY2hlZHVsZXIoYXJndW1lbnRzWzBdKSkge1xuICAgICAgc2NoZWR1bGVyID0gYXJndW1lbnRzWzBdO1xuICAgICAgc3RhcnQgPSAxO1xuICAgIH0gZWxzZSB7XG4gICAgICBzY2hlZHVsZXIgPSBpbW1lZGlhdGVTY2hlZHVsZXI7XG4gICAgfVxuICAgIGZvcih2YXIgYXJncyA9IFtdLCBpID0gc3RhcnQsIGxlbiA9IGFyZ3VtZW50cy5sZW5ndGg7IGkgPCBsZW47IGkrKykgeyBhcmdzLnB1c2goYXJndW1lbnRzW2ldKTsgfVxuICAgIHJldHVybiBlbnVtZXJhYmxlT2YoW29ic2VydmFibGVGcm9tQXJyYXkoYXJncywgc2NoZWR1bGVyKSwgdGhpc10pLmNvbmNhdCgpO1xuICB9O1xuXG4gIHZhciBUYWtlTGFzdE9ic2VydmVyID0gKGZ1bmN0aW9uIChfX3N1cGVyX18pIHtcbiAgICBpbmhlcml0cyhUYWtlTGFzdE9ic2VydmVyLCBfX3N1cGVyX18pO1xuICAgIGZ1bmN0aW9uIFRha2VMYXN0T2JzZXJ2ZXIobywgYykge1xuICAgICAgdGhpcy5fbyA9IG87XG4gICAgICB0aGlzLl9jID0gYztcbiAgICAgIHRoaXMuX3EgPSBbXTtcbiAgICAgIF9fc3VwZXJfXy5jYWxsKHRoaXMpO1xuICAgIH1cblxuICAgIFRha2VMYXN0T2JzZXJ2ZXIucHJvdG90eXBlLm5leHQgPSBmdW5jdGlvbiAoeCkge1xuICAgICAgdGhpcy5fcS5wdXNoKHgpO1xuICAgICAgdGhpcy5fcS5sZW5ndGggPiB0aGlzLl9jICYmIHRoaXMuX3Euc2hpZnQoKTtcbiAgICB9O1xuXG4gICAgVGFrZUxhc3RPYnNlcnZlci5wcm90b3R5cGUuZXJyb3IgPSBmdW5jdGlvbiAoZSkge1xuICAgICAgdGhpcy5fby5vbkVycm9yKGUpO1xuICAgIH07XG5cbiAgICBUYWtlTGFzdE9ic2VydmVyLnByb3RvdHlwZS5jb21wbGV0ZWQgPSBmdW5jdGlvbiAoKSB7XG4gICAgICB3aGlsZSAodGhpcy5fcS5sZW5ndGggPiAwKSB7IHRoaXMuX28ub25OZXh0KHRoaXMuX3Euc2hpZnQoKSk7IH1cbiAgICAgIHRoaXMuX28ub25Db21wbGV0ZWQoKTtcbiAgICB9O1xuXG4gICAgcmV0dXJuIFRha2VMYXN0T2JzZXJ2ZXI7XG4gIH0oQWJzdHJhY3RPYnNlcnZlcikpO1xuXG4gIC8qKlxuICAgKiAgUmV0dXJucyBhIHNwZWNpZmllZCBudW1iZXIgb2YgY29udGlndW91cyBlbGVtZW50cyBmcm9tIHRoZSBlbmQgb2YgYW4gb2JzZXJ2YWJsZSBzZXF1ZW5jZS5cbiAgICogQGRlc2NyaXB0aW9uXG4gICAqICBUaGlzIG9wZXJhdG9yIGFjY3VtdWxhdGVzIGEgYnVmZmVyIHdpdGggYSBsZW5ndGggZW5vdWdoIHRvIHN0b3JlIGVsZW1lbnRzIGNvdW50IGVsZW1lbnRzLiBVcG9uIGNvbXBsZXRpb24gb2ZcbiAgICogIHRoZSBzb3VyY2Ugc2VxdWVuY2UsIHRoaXMgYnVmZmVyIGlzIGRyYWluZWQgb24gdGhlIHJlc3VsdCBzZXF1ZW5jZS4gVGhpcyBjYXVzZXMgdGhlIGVsZW1lbnRzIHRvIGJlIGRlbGF5ZWQuXG4gICAqIEBwYXJhbSB7TnVtYmVyfSBjb3VudCBOdW1iZXIgb2YgZWxlbWVudHMgdG8gdGFrZSBmcm9tIHRoZSBlbmQgb2YgdGhlIHNvdXJjZSBzZXF1ZW5jZS5cbiAgICogQHJldHVybnMge09ic2VydmFibGV9IEFuIG9ic2VydmFibGUgc2VxdWVuY2UgY29udGFpbmluZyB0aGUgc3BlY2lmaWVkIG51bWJlciBvZiBlbGVtZW50cyBmcm9tIHRoZSBlbmQgb2YgdGhlIHNvdXJjZSBzZXF1ZW5jZS5cbiAgICovXG4gIG9ic2VydmFibGVQcm90by50YWtlTGFzdCA9IGZ1bmN0aW9uIChjb3VudCkge1xuICAgIGlmIChjb3VudCA8IDApIHsgdGhyb3cgbmV3IEFyZ3VtZW50T3V0T2ZSYW5nZUVycm9yKCk7IH1cbiAgICB2YXIgc291cmNlID0gdGhpcztcbiAgICByZXR1cm4gbmV3IEFub255bW91c09ic2VydmFibGUoZnVuY3Rpb24gKG8pIHtcbiAgICAgIHJldHVybiBzb3VyY2Uuc3Vic2NyaWJlKG5ldyBUYWtlTGFzdE9ic2VydmVyKG8sIGNvdW50KSk7XG4gICAgfSwgc291cmNlKTtcbiAgfTtcblxuICB2YXIgVGFrZUxhc3RCdWZmZXJPYnNlcnZlciA9IChmdW5jdGlvbiAoX19zdXBlcl9fKSB7XG4gICAgaW5oZXJpdHMoVGFrZUxhc3RCdWZmZXJPYnNlcnZlciwgX19zdXBlcl9fKTtcbiAgICBmdW5jdGlvbiBUYWtlTGFzdEJ1ZmZlck9ic2VydmVyKG8sIGMpIHtcbiAgICAgIHRoaXMuX28gPSBvO1xuICAgICAgdGhpcy5fYyA9IGM7XG4gICAgICB0aGlzLl9xID0gW107XG4gICAgICBfX3N1cGVyX18uY2FsbCh0aGlzKTtcbiAgICB9XG5cbiAgICBUYWtlTGFzdEJ1ZmZlck9ic2VydmVyLnByb3RvdHlwZS5uZXh0ID0gZnVuY3Rpb24gKHgpIHtcbiAgICAgIHRoaXMuX3EucHVzaCh4KTtcbiAgICAgIHRoaXMuX3EubGVuZ3RoID4gdGhpcy5fYyAmJiB0aGlzLl9xLnNoaWZ0KCk7XG4gICAgfTtcblxuICAgIFRha2VMYXN0QnVmZmVyT2JzZXJ2ZXIucHJvdG90eXBlLmVycm9yID0gZnVuY3Rpb24gKGUpIHtcbiAgICAgIHRoaXMuX28ub25FcnJvcihlKTtcbiAgICB9O1xuXG4gICAgVGFrZUxhc3RCdWZmZXJPYnNlcnZlci5wcm90b3R5cGUuY29tcGxldGVkID0gZnVuY3Rpb24gKCkge1xuICAgICAgdGhpcy5fby5vbk5leHQodGhpcy5fcSk7XG4gICAgICB0aGlzLl9vLm9uQ29tcGxldGVkKCk7XG4gICAgfTtcblxuICAgIHJldHVybiBUYWtlTGFzdEJ1ZmZlck9ic2VydmVyO1xuICB9KEFic3RyYWN0T2JzZXJ2ZXIpKTtcblxuICAvKipcbiAgICogIFJldHVybnMgYW4gYXJyYXkgd2l0aCB0aGUgc3BlY2lmaWVkIG51bWJlciBvZiBjb250aWd1b3VzIGVsZW1lbnRzIGZyb20gdGhlIGVuZCBvZiBhbiBvYnNlcnZhYmxlIHNlcXVlbmNlLlxuICAgKlxuICAgKiBAZGVzY3JpcHRpb25cbiAgICogIFRoaXMgb3BlcmF0b3IgYWNjdW11bGF0ZXMgYSBidWZmZXIgd2l0aCBhIGxlbmd0aCBlbm91Z2ggdG8gc3RvcmUgY291bnQgZWxlbWVudHMuIFVwb24gY29tcGxldGlvbiBvZiB0aGVcbiAgICogIHNvdXJjZSBzZXF1ZW5jZSwgdGhpcyBidWZmZXIgaXMgcHJvZHVjZWQgb24gdGhlIHJlc3VsdCBzZXF1ZW5jZS5cbiAgICogQHBhcmFtIHtOdW1iZXJ9IGNvdW50IE51bWJlciBvZiBlbGVtZW50cyB0byB0YWtlIGZyb20gdGhlIGVuZCBvZiB0aGUgc291cmNlIHNlcXVlbmNlLlxuICAgKiBAcmV0dXJucyB7T2JzZXJ2YWJsZX0gQW4gb2JzZXJ2YWJsZSBzZXF1ZW5jZSBjb250YWluaW5nIGEgc2luZ2xlIGFycmF5IHdpdGggdGhlIHNwZWNpZmllZCBudW1iZXIgb2YgZWxlbWVudHMgZnJvbSB0aGUgZW5kIG9mIHRoZSBzb3VyY2Ugc2VxdWVuY2UuXG4gICAqL1xuICBvYnNlcnZhYmxlUHJvdG8udGFrZUxhc3RCdWZmZXIgPSBmdW5jdGlvbiAoY291bnQpIHtcbiAgICBpZiAoY291bnQgPCAwKSB7IHRocm93IG5ldyBBcmd1bWVudE91dE9mUmFuZ2VFcnJvcigpOyB9XG4gICAgdmFyIHNvdXJjZSA9IHRoaXM7XG4gICAgcmV0dXJuIG5ldyBBbm9ueW1vdXNPYnNlcnZhYmxlKGZ1bmN0aW9uIChvKSB7XG4gICAgICByZXR1cm4gc291cmNlLnN1YnNjcmliZShuZXcgVGFrZUxhc3RCdWZmZXJPYnNlcnZlcihvLCBjb3VudCkpO1xuICAgIH0sIHNvdXJjZSk7XG4gIH07XG5cbiAgLyoqXG4gICAqICBQcm9qZWN0cyBlYWNoIGVsZW1lbnQgb2YgYW4gb2JzZXJ2YWJsZSBzZXF1ZW5jZSBpbnRvIHplcm8gb3IgbW9yZSB3aW5kb3dzIHdoaWNoIGFyZSBwcm9kdWNlZCBiYXNlZCBvbiBlbGVtZW50IGNvdW50IGluZm9ybWF0aW9uLlxuICAgKiBAcGFyYW0ge051bWJlcn0gY291bnQgTGVuZ3RoIG9mIGVhY2ggd2luZG93LlxuICAgKiBAcGFyYW0ge051bWJlcn0gW3NraXBdIE51bWJlciBvZiBlbGVtZW50cyB0byBza2lwIGJldHdlZW4gY3JlYXRpb24gb2YgY29uc2VjdXRpdmUgd2luZG93cy4gSWYgbm90IHNwZWNpZmllZCwgZGVmYXVsdHMgdG8gdGhlIGNvdW50LlxuICAgKiBAcmV0dXJucyB7T2JzZXJ2YWJsZX0gQW4gb2JzZXJ2YWJsZSBzZXF1ZW5jZSBvZiB3aW5kb3dzLlxuICAgKi9cbiAgb2JzZXJ2YWJsZVByb3RvLndpbmRvd1dpdGhDb3VudCA9IGZ1bmN0aW9uIChjb3VudCwgc2tpcCkge1xuICAgIHZhciBzb3VyY2UgPSB0aGlzO1xuICAgICtjb3VudCB8fCAoY291bnQgPSAwKTtcbiAgICBNYXRoLmFicyhjb3VudCkgPT09IEluZmluaXR5ICYmIChjb3VudCA9IDApO1xuICAgIGlmIChjb3VudCA8PSAwKSB7IHRocm93IG5ldyBBcmd1bWVudE91dE9mUmFuZ2VFcnJvcigpOyB9XG4gICAgc2tpcCA9PSBudWxsICYmIChza2lwID0gY291bnQpO1xuICAgICtza2lwIHx8IChza2lwID0gMCk7XG4gICAgTWF0aC5hYnMoc2tpcCkgPT09IEluZmluaXR5ICYmIChza2lwID0gMCk7XG5cbiAgICBpZiAoc2tpcCA8PSAwKSB7IHRocm93IG5ldyBBcmd1bWVudE91dE9mUmFuZ2VFcnJvcigpOyB9XG4gICAgcmV0dXJuIG5ldyBBbm9ueW1vdXNPYnNlcnZhYmxlKGZ1bmN0aW9uIChvYnNlcnZlcikge1xuICAgICAgdmFyIG0gPSBuZXcgU2luZ2xlQXNzaWdubWVudERpc3Bvc2FibGUoKSxcbiAgICAgICAgcmVmQ291bnREaXNwb3NhYmxlID0gbmV3IFJlZkNvdW50RGlzcG9zYWJsZShtKSxcbiAgICAgICAgbiA9IDAsXG4gICAgICAgIHEgPSBbXTtcblxuICAgICAgZnVuY3Rpb24gY3JlYXRlV2luZG93ICgpIHtcbiAgICAgICAgdmFyIHMgPSBuZXcgU3ViamVjdCgpO1xuICAgICAgICBxLnB1c2gocyk7XG4gICAgICAgIG9ic2VydmVyLm9uTmV4dChhZGRSZWYocywgcmVmQ291bnREaXNwb3NhYmxlKSk7XG4gICAgICB9XG5cbiAgICAgIGNyZWF0ZVdpbmRvdygpO1xuXG4gICAgICBtLnNldERpc3Bvc2FibGUoc291cmNlLnN1YnNjcmliZShcbiAgICAgICAgZnVuY3Rpb24gKHgpIHtcbiAgICAgICAgICBmb3IgKHZhciBpID0gMCwgbGVuID0gcS5sZW5ndGg7IGkgPCBsZW47IGkrKykgeyBxW2ldLm9uTmV4dCh4KTsgfVxuICAgICAgICAgIHZhciBjID0gbiAtIGNvdW50ICsgMTtcbiAgICAgICAgICBjID49IDAgJiYgYyAlIHNraXAgPT09IDAgJiYgcS5zaGlmdCgpLm9uQ29tcGxldGVkKCk7XG4gICAgICAgICAgKytuICUgc2tpcCA9PT0gMCAmJiBjcmVhdGVXaW5kb3coKTtcbiAgICAgICAgfSxcbiAgICAgICAgZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgICB3aGlsZSAocS5sZW5ndGggPiAwKSB7IHEuc2hpZnQoKS5vbkVycm9yKGUpOyB9XG4gICAgICAgICAgb2JzZXJ2ZXIub25FcnJvcihlKTtcbiAgICAgICAgfSxcbiAgICAgICAgZnVuY3Rpb24gKCkge1xuICAgICAgICAgIHdoaWxlIChxLmxlbmd0aCA+IDApIHsgcS5zaGlmdCgpLm9uQ29tcGxldGVkKCk7IH1cbiAgICAgICAgICBvYnNlcnZlci5vbkNvbXBsZXRlZCgpO1xuICAgICAgICB9XG4gICAgICApKTtcbiAgICAgIHJldHVybiByZWZDb3VudERpc3Bvc2FibGU7XG4gICAgfSwgc291cmNlKTtcbiAgfTtcblxuICBmdW5jdGlvbiBjb25jYXRNYXAoc291cmNlLCBzZWxlY3RvciwgdGhpc0FyZykge1xuICAgIHZhciBzZWxlY3RvckZ1bmMgPSBiaW5kQ2FsbGJhY2soc2VsZWN0b3IsIHRoaXNBcmcsIDMpO1xuICAgIHJldHVybiBzb3VyY2UubWFwKGZ1bmN0aW9uICh4LCBpKSB7XG4gICAgICB2YXIgcmVzdWx0ID0gc2VsZWN0b3JGdW5jKHgsIGksIHNvdXJjZSk7XG4gICAgICBpc1Byb21pc2UocmVzdWx0KSAmJiAocmVzdWx0ID0gb2JzZXJ2YWJsZUZyb21Qcm9taXNlKHJlc3VsdCkpO1xuICAgICAgKGlzQXJyYXlMaWtlKHJlc3VsdCkgfHwgaXNJdGVyYWJsZShyZXN1bHQpKSAmJiAocmVzdWx0ID0gb2JzZXJ2YWJsZUZyb20ocmVzdWx0KSk7XG4gICAgICByZXR1cm4gcmVzdWx0O1xuICAgIH0pLmNvbmNhdEFsbCgpO1xuICB9XG5cbiAgLyoqXG4gICAqICBPbmUgb2YgdGhlIEZvbGxvd2luZzpcbiAgICogIFByb2plY3RzIGVhY2ggZWxlbWVudCBvZiBhbiBvYnNlcnZhYmxlIHNlcXVlbmNlIHRvIGFuIG9ic2VydmFibGUgc2VxdWVuY2UgYW5kIG1lcmdlcyB0aGUgcmVzdWx0aW5nIG9ic2VydmFibGUgc2VxdWVuY2VzIGludG8gb25lIG9ic2VydmFibGUgc2VxdWVuY2UuXG4gICAqXG4gICAqIEBleGFtcGxlXG4gICAqICB2YXIgcmVzID0gc291cmNlLmNvbmNhdE1hcChmdW5jdGlvbiAoeCkgeyByZXR1cm4gUnguT2JzZXJ2YWJsZS5yYW5nZSgwLCB4KTsgfSk7XG4gICAqICBPcjpcbiAgICogIFByb2plY3RzIGVhY2ggZWxlbWVudCBvZiBhbiBvYnNlcnZhYmxlIHNlcXVlbmNlIHRvIGFuIG9ic2VydmFibGUgc2VxdWVuY2UsIGludm9rZXMgdGhlIHJlc3VsdCBzZWxlY3RvciBmb3IgdGhlIHNvdXJjZSBlbGVtZW50IGFuZCBlYWNoIG9mIHRoZSBjb3JyZXNwb25kaW5nIGlubmVyIHNlcXVlbmNlJ3MgZWxlbWVudHMsIGFuZCBtZXJnZXMgdGhlIHJlc3VsdHMgaW50byBvbmUgb2JzZXJ2YWJsZSBzZXF1ZW5jZS5cbiAgICpcbiAgICogIHZhciByZXMgPSBzb3VyY2UuY29uY2F0TWFwKGZ1bmN0aW9uICh4KSB7IHJldHVybiBSeC5PYnNlcnZhYmxlLnJhbmdlKDAsIHgpOyB9LCBmdW5jdGlvbiAoeCwgeSkgeyByZXR1cm4geCArIHk7IH0pO1xuICAgKiAgT3I6XG4gICAqICBQcm9qZWN0cyBlYWNoIGVsZW1lbnQgb2YgdGhlIHNvdXJjZSBvYnNlcnZhYmxlIHNlcXVlbmNlIHRvIHRoZSBvdGhlciBvYnNlcnZhYmxlIHNlcXVlbmNlIGFuZCBtZXJnZXMgdGhlIHJlc3VsdGluZyBvYnNlcnZhYmxlIHNlcXVlbmNlcyBpbnRvIG9uZSBvYnNlcnZhYmxlIHNlcXVlbmNlLlxuICAgKlxuICAgKiAgdmFyIHJlcyA9IHNvdXJjZS5jb25jYXRNYXAoUnguT2JzZXJ2YWJsZS5mcm9tQXJyYXkoWzEsMiwzXSkpO1xuICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBzZWxlY3RvciBBIHRyYW5zZm9ybSBmdW5jdGlvbiB0byBhcHBseSB0byBlYWNoIGVsZW1lbnQgb3IgYW4gb2JzZXJ2YWJsZSBzZXF1ZW5jZSB0byBwcm9qZWN0IGVhY2ggZWxlbWVudCBmcm9tIHRoZVxuICAgKiBzb3VyY2Ugc2VxdWVuY2Ugb250byB3aGljaCBjb3VsZCBiZSBlaXRoZXIgYW4gb2JzZXJ2YWJsZSBvciBQcm9taXNlLlxuICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBbcmVzdWx0U2VsZWN0b3JdICBBIHRyYW5zZm9ybSBmdW5jdGlvbiB0byBhcHBseSB0byBlYWNoIGVsZW1lbnQgb2YgdGhlIGludGVybWVkaWF0ZSBzZXF1ZW5jZS5cbiAgICogQHJldHVybnMge09ic2VydmFibGV9IEFuIG9ic2VydmFibGUgc2VxdWVuY2Ugd2hvc2UgZWxlbWVudHMgYXJlIHRoZSByZXN1bHQgb2YgaW52b2tpbmcgdGhlIG9uZS10by1tYW55IHRyYW5zZm9ybSBmdW5jdGlvbiBjb2xsZWN0aW9uU2VsZWN0b3Igb24gZWFjaCBlbGVtZW50IG9mIHRoZSBpbnB1dCBzZXF1ZW5jZSBhbmQgdGhlbiBtYXBwaW5nIGVhY2ggb2YgdGhvc2Ugc2VxdWVuY2UgZWxlbWVudHMgYW5kIHRoZWlyIGNvcnJlc3BvbmRpbmcgc291cmNlIGVsZW1lbnQgdG8gYSByZXN1bHQgZWxlbWVudC5cbiAgICovXG4gIG9ic2VydmFibGVQcm90by5zZWxlY3RDb25jYXQgPSBvYnNlcnZhYmxlUHJvdG8uY29uY2F0TWFwID0gZnVuY3Rpb24gKHNlbGVjdG9yLCByZXN1bHRTZWxlY3RvciwgdGhpc0FyZykge1xuICAgIGlmIChpc0Z1bmN0aW9uKHNlbGVjdG9yKSAmJiBpc0Z1bmN0aW9uKHJlc3VsdFNlbGVjdG9yKSkge1xuICAgICAgcmV0dXJuIHRoaXMuY29uY2F0TWFwKGZ1bmN0aW9uICh4LCBpKSB7XG4gICAgICAgIHZhciBzZWxlY3RvclJlc3VsdCA9IHNlbGVjdG9yKHgsIGkpO1xuICAgICAgICBpc1Byb21pc2Uoc2VsZWN0b3JSZXN1bHQpICYmIChzZWxlY3RvclJlc3VsdCA9IG9ic2VydmFibGVGcm9tUHJvbWlzZShzZWxlY3RvclJlc3VsdCkpO1xuICAgICAgICAoaXNBcnJheUxpa2Uoc2VsZWN0b3JSZXN1bHQpIHx8IGlzSXRlcmFibGUoc2VsZWN0b3JSZXN1bHQpKSAmJiAoc2VsZWN0b3JSZXN1bHQgPSBvYnNlcnZhYmxlRnJvbShzZWxlY3RvclJlc3VsdCkpO1xuXG4gICAgICAgIHJldHVybiBzZWxlY3RvclJlc3VsdC5tYXAoZnVuY3Rpb24gKHksIGkyKSB7XG4gICAgICAgICAgcmV0dXJuIHJlc3VsdFNlbGVjdG9yKHgsIHksIGksIGkyKTtcbiAgICAgICAgfSk7XG4gICAgICB9KTtcbiAgICB9XG4gICAgcmV0dXJuIGlzRnVuY3Rpb24oc2VsZWN0b3IpID9cbiAgICAgIGNvbmNhdE1hcCh0aGlzLCBzZWxlY3RvciwgdGhpc0FyZykgOlxuICAgICAgY29uY2F0TWFwKHRoaXMsIGZ1bmN0aW9uICgpIHsgcmV0dXJuIHNlbGVjdG9yOyB9KTtcbiAgfTtcblxuICAvKipcbiAgICogUHJvamVjdHMgZWFjaCBub3RpZmljYXRpb24gb2YgYW4gb2JzZXJ2YWJsZSBzZXF1ZW5jZSB0byBhbiBvYnNlcnZhYmxlIHNlcXVlbmNlIGFuZCBjb25jYXRzIHRoZSByZXN1bHRpbmcgb2JzZXJ2YWJsZSBzZXF1ZW5jZXMgaW50byBvbmUgb2JzZXJ2YWJsZSBzZXF1ZW5jZS5cbiAgICogQHBhcmFtIHtGdW5jdGlvbn0gb25OZXh0IEEgdHJhbnNmb3JtIGZ1bmN0aW9uIHRvIGFwcGx5IHRvIGVhY2ggZWxlbWVudDsgdGhlIHNlY29uZCBwYXJhbWV0ZXIgb2YgdGhlIGZ1bmN0aW9uIHJlcHJlc2VudHMgdGhlIGluZGV4IG9mIHRoZSBzb3VyY2UgZWxlbWVudC5cbiAgICogQHBhcmFtIHtGdW5jdGlvbn0gb25FcnJvciBBIHRyYW5zZm9ybSBmdW5jdGlvbiB0byBhcHBseSB3aGVuIGFuIGVycm9yIG9jY3VycyBpbiB0aGUgc291cmNlIHNlcXVlbmNlLlxuICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBvbkNvbXBsZXRlZCBBIHRyYW5zZm9ybSBmdW5jdGlvbiB0byBhcHBseSB3aGVuIHRoZSBlbmQgb2YgdGhlIHNvdXJjZSBzZXF1ZW5jZSBpcyByZWFjaGVkLlxuICAgKiBAcGFyYW0ge0FueX0gW3RoaXNBcmddIEFuIG9wdGlvbmFsIFwidGhpc1wiIHRvIHVzZSB0byBpbnZva2UgZWFjaCB0cmFuc2Zvcm0uXG4gICAqIEByZXR1cm5zIHtPYnNlcnZhYmxlfSBBbiBvYnNlcnZhYmxlIHNlcXVlbmNlIHdob3NlIGVsZW1lbnRzIGFyZSB0aGUgcmVzdWx0IG9mIGludm9raW5nIHRoZSBvbmUtdG8tbWFueSB0cmFuc2Zvcm0gZnVuY3Rpb24gY29ycmVzcG9uZGluZyB0byBlYWNoIG5vdGlmaWNhdGlvbiBpbiB0aGUgaW5wdXQgc2VxdWVuY2UuXG4gICAqL1xuICBvYnNlcnZhYmxlUHJvdG8uY29uY2F0TWFwT2JzZXJ2ZXIgPSBvYnNlcnZhYmxlUHJvdG8uc2VsZWN0Q29uY2F0T2JzZXJ2ZXIgPSBmdW5jdGlvbihvbk5leHQsIG9uRXJyb3IsIG9uQ29tcGxldGVkLCB0aGlzQXJnKSB7XG4gICAgdmFyIHNvdXJjZSA9IHRoaXMsXG4gICAgICAgIG9uTmV4dEZ1bmMgPSBiaW5kQ2FsbGJhY2sob25OZXh0LCB0aGlzQXJnLCAyKSxcbiAgICAgICAgb25FcnJvckZ1bmMgPSBiaW5kQ2FsbGJhY2sob25FcnJvciwgdGhpc0FyZywgMSksXG4gICAgICAgIG9uQ29tcGxldGVkRnVuYyA9IGJpbmRDYWxsYmFjayhvbkNvbXBsZXRlZCwgdGhpc0FyZywgMCk7XG4gICAgcmV0dXJuIG5ldyBBbm9ueW1vdXNPYnNlcnZhYmxlKGZ1bmN0aW9uIChvYnNlcnZlcikge1xuICAgICAgdmFyIGluZGV4ID0gMDtcbiAgICAgIHJldHVybiBzb3VyY2Uuc3Vic2NyaWJlKFxuICAgICAgICBmdW5jdGlvbiAoeCkge1xuICAgICAgICAgIHZhciByZXN1bHQ7XG4gICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIHJlc3VsdCA9IG9uTmV4dEZ1bmMoeCwgaW5kZXgrKyk7XG4gICAgICAgICAgfSBjYXRjaCAoZSkge1xuICAgICAgICAgICAgb2JzZXJ2ZXIub25FcnJvcihlKTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICB9XG4gICAgICAgICAgaXNQcm9taXNlKHJlc3VsdCkgJiYgKHJlc3VsdCA9IG9ic2VydmFibGVGcm9tUHJvbWlzZShyZXN1bHQpKTtcbiAgICAgICAgICBvYnNlcnZlci5vbk5leHQocmVzdWx0KTtcbiAgICAgICAgfSxcbiAgICAgICAgZnVuY3Rpb24gKGVycikge1xuICAgICAgICAgIHZhciByZXN1bHQ7XG4gICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIHJlc3VsdCA9IG9uRXJyb3JGdW5jKGVycik7XG4gICAgICAgICAgfSBjYXRjaCAoZSkge1xuICAgICAgICAgICAgb2JzZXJ2ZXIub25FcnJvcihlKTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICB9XG4gICAgICAgICAgaXNQcm9taXNlKHJlc3VsdCkgJiYgKHJlc3VsdCA9IG9ic2VydmFibGVGcm9tUHJvbWlzZShyZXN1bHQpKTtcbiAgICAgICAgICBvYnNlcnZlci5vbk5leHQocmVzdWx0KTtcbiAgICAgICAgICBvYnNlcnZlci5vbkNvbXBsZXRlZCgpO1xuICAgICAgICB9LFxuICAgICAgICBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgdmFyIHJlc3VsdDtcbiAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgcmVzdWx0ID0gb25Db21wbGV0ZWRGdW5jKCk7XG4gICAgICAgICAgfSBjYXRjaCAoZSkge1xuICAgICAgICAgICAgb2JzZXJ2ZXIub25FcnJvcihlKTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICB9XG4gICAgICAgICAgaXNQcm9taXNlKHJlc3VsdCkgJiYgKHJlc3VsdCA9IG9ic2VydmFibGVGcm9tUHJvbWlzZShyZXN1bHQpKTtcbiAgICAgICAgICBvYnNlcnZlci5vbk5leHQocmVzdWx0KTtcbiAgICAgICAgICBvYnNlcnZlci5vbkNvbXBsZXRlZCgpO1xuICAgICAgICB9KTtcbiAgICB9LCB0aGlzKS5jb25jYXRBbGwoKTtcbiAgfTtcblxuICB2YXIgRGVmYXVsdElmRW1wdHlPYnNlcnZlciA9IChmdW5jdGlvbiAoX19zdXBlcl9fKSB7XG4gICAgaW5oZXJpdHMoRGVmYXVsdElmRW1wdHlPYnNlcnZlciwgX19zdXBlcl9fKTtcbiAgICBmdW5jdGlvbiBEZWZhdWx0SWZFbXB0eU9ic2VydmVyKG8sIGQpIHtcbiAgICAgIHRoaXMuX28gPSBvO1xuICAgICAgdGhpcy5fZCA9IGQ7XG4gICAgICB0aGlzLl9mID0gZmFsc2U7XG4gICAgICBfX3N1cGVyX18uY2FsbCh0aGlzKTtcbiAgICB9XG5cbiAgICBEZWZhdWx0SWZFbXB0eU9ic2VydmVyLnByb3RvdHlwZS5uZXh0ID0gZnVuY3Rpb24gKHgpIHtcbiAgICAgIHRoaXMuX2YgPSB0cnVlO1xuICAgICAgdGhpcy5fby5vbk5leHQoeCk7XG4gICAgfTtcblxuICAgIERlZmF1bHRJZkVtcHR5T2JzZXJ2ZXIucHJvdG90eXBlLmVycm9yID0gZnVuY3Rpb24gKGUpIHtcbiAgICAgIHRoaXMuX28ub25FcnJvcihlKTtcbiAgICB9O1xuXG4gICAgRGVmYXVsdElmRW1wdHlPYnNlcnZlci5wcm90b3R5cGUuY29tcGxldGVkID0gZnVuY3Rpb24gKCkge1xuICAgICAgIXRoaXMuX2YgJiYgdGhpcy5fby5vbk5leHQoZGVmYXVsdFZhbHVlKTtcbiAgICAgIHRoaXMuX28ub25Db21wbGV0ZWQoKTtcbiAgICB9O1xuXG4gICAgcmV0dXJuIERlZmF1bHRJZkVtcHR5T2JzZXJ2ZXI7XG4gIH0oQWJzdHJhY3RPYnNlcnZlcikpO1xuXG4gIC8qKlxuICAgKiAgUmV0dXJucyB0aGUgZWxlbWVudHMgb2YgdGhlIHNwZWNpZmllZCBzZXF1ZW5jZSBvciB0aGUgc3BlY2lmaWVkIHZhbHVlIGluIGEgc2luZ2xldG9uIHNlcXVlbmNlIGlmIHRoZSBzZXF1ZW5jZSBpcyBlbXB0eS5cbiAgICpcbiAgICogIHZhciByZXMgPSBvYnMgPSB4cy5kZWZhdWx0SWZFbXB0eSgpO1xuICAgKiAgMiAtIG9icyA9IHhzLmRlZmF1bHRJZkVtcHR5KGZhbHNlKTtcbiAgICpcbiAgICogQG1lbWJlck9mIE9ic2VydmFibGUjXG4gICAqIEBwYXJhbSBkZWZhdWx0VmFsdWUgVGhlIHZhbHVlIHRvIHJldHVybiBpZiB0aGUgc2VxdWVuY2UgaXMgZW1wdHkuIElmIG5vdCBwcm92aWRlZCwgdGhpcyBkZWZhdWx0cyB0byBudWxsLlxuICAgKiBAcmV0dXJucyB7T2JzZXJ2YWJsZX0gQW4gb2JzZXJ2YWJsZSBzZXF1ZW5jZSB0aGF0IGNvbnRhaW5zIHRoZSBzcGVjaWZpZWQgZGVmYXVsdCB2YWx1ZSBpZiB0aGUgc291cmNlIGlzIGVtcHR5OyBvdGhlcndpc2UsIHRoZSBlbGVtZW50cyBvZiB0aGUgc291cmNlIGl0c2VsZi5cbiAgICovXG4gICAgb2JzZXJ2YWJsZVByb3RvLmRlZmF1bHRJZkVtcHR5ID0gZnVuY3Rpb24gKGRlZmF1bHRWYWx1ZSkge1xuICAgICAgdmFyIHNvdXJjZSA9IHRoaXM7XG4gICAgICBkZWZhdWx0VmFsdWUgPT09IHVuZGVmaW5lZCAmJiAoZGVmYXVsdFZhbHVlID0gbnVsbCk7XG4gICAgICByZXR1cm4gbmV3IEFub255bW91c09ic2VydmFibGUoZnVuY3Rpb24gKG8pIHtcbiAgICAgICAgcmV0dXJuIHNvdXJjZS5zdWJzY3JpYmUobmV3IERlZmF1bHRJZkVtcHR5T2JzZXJ2ZXIobywgZGVmYXVsdFZhbHVlKSk7XG4gICAgICB9LCBzb3VyY2UpO1xuICAgIH07XG5cbiAgLy8gU3dhcCBvdXQgZm9yIEFycmF5LmZpbmRJbmRleFxuICBmdW5jdGlvbiBhcnJheUluZGV4T2ZDb21wYXJlcihhcnJheSwgaXRlbSwgY29tcGFyZXIpIHtcbiAgICBmb3IgKHZhciBpID0gMCwgbGVuID0gYXJyYXkubGVuZ3RoOyBpIDwgbGVuOyBpKyspIHtcbiAgICAgIGlmIChjb21wYXJlcihhcnJheVtpXSwgaXRlbSkpIHsgcmV0dXJuIGk7IH1cbiAgICB9XG4gICAgcmV0dXJuIC0xO1xuICB9XG5cbiAgZnVuY3Rpb24gSGFzaFNldChjb21wYXJlcikge1xuICAgIHRoaXMuY29tcGFyZXIgPSBjb21wYXJlcjtcbiAgICB0aGlzLnNldCA9IFtdO1xuICB9XG4gIEhhc2hTZXQucHJvdG90eXBlLnB1c2ggPSBmdW5jdGlvbih2YWx1ZSkge1xuICAgIHZhciByZXRWYWx1ZSA9IGFycmF5SW5kZXhPZkNvbXBhcmVyKHRoaXMuc2V0LCB2YWx1ZSwgdGhpcy5jb21wYXJlcikgPT09IC0xO1xuICAgIHJldFZhbHVlICYmIHRoaXMuc2V0LnB1c2godmFsdWUpO1xuICAgIHJldHVybiByZXRWYWx1ZTtcbiAgfTtcblxuICB2YXIgRGlzdGluY3RPYnNlcnZhYmxlID0gKGZ1bmN0aW9uIChfX3N1cGVyX18pIHtcbiAgICBpbmhlcml0cyhEaXN0aW5jdE9ic2VydmFibGUsIF9fc3VwZXJfXyk7XG4gICAgZnVuY3Rpb24gRGlzdGluY3RPYnNlcnZhYmxlKHNvdXJjZSwga2V5Rm4sIGNtcEZuKSB7XG4gICAgICB0aGlzLnNvdXJjZSA9IHNvdXJjZTtcbiAgICAgIHRoaXMuX2tleUZuID0ga2V5Rm47XG4gICAgICB0aGlzLl9jbXBGbiA9IGNtcEZuO1xuICAgICAgX19zdXBlcl9fLmNhbGwodGhpcyk7XG4gICAgfVxuXG4gICAgRGlzdGluY3RPYnNlcnZhYmxlLnByb3RvdHlwZS5zdWJzY3JpYmVDb3JlID0gZnVuY3Rpb24gKG8pIHtcbiAgICAgIHJldHVybiB0aGlzLnNvdXJjZS5zdWJzY3JpYmUobmV3IERpc3RpbmN0T2JzZXJ2ZXIobywgdGhpcy5fa2V5Rm4sIHRoaXMuX2NtcEZuKSk7XG4gICAgfTtcblxuICAgIHJldHVybiBEaXN0aW5jdE9ic2VydmFibGU7XG4gIH0oT2JzZXJ2YWJsZUJhc2UpKTtcblxuICB2YXIgRGlzdGluY3RPYnNlcnZlciA9IChmdW5jdGlvbiAoX19zdXBlcl9fKSB7XG4gICAgaW5oZXJpdHMoRGlzdGluY3RPYnNlcnZlciwgX19zdXBlcl9fKTtcbiAgICBmdW5jdGlvbiBEaXN0aW5jdE9ic2VydmVyKG8sIGtleUZuLCBjbXBGbikge1xuICAgICAgdGhpcy5fbyA9IG87XG4gICAgICB0aGlzLl9rZXlGbiA9IGtleUZuO1xuICAgICAgdGhpcy5faCA9IG5ldyBIYXNoU2V0KGNtcEZuKTtcbiAgICAgIF9fc3VwZXJfXy5jYWxsKHRoaXMpO1xuICAgIH1cblxuICAgIERpc3RpbmN0T2JzZXJ2ZXIucHJvdG90eXBlLm5leHQgPSBmdW5jdGlvbiAoeCkge1xuICAgICAgdmFyIGtleSA9IHg7XG4gICAgICBpZiAoaXNGdW5jdGlvbih0aGlzLl9rZXlGbikpIHtcbiAgICAgICAga2V5ID0gdHJ5Q2F0Y2godGhpcy5fa2V5Rm4pKHgpO1xuICAgICAgICBpZiAoa2V5ID09PSBlcnJvck9iaikgeyByZXR1cm4gdGhpcy5fby5vbkVycm9yKGtleS5lKTsgfVxuICAgICAgfVxuICAgICAgdGhpcy5faC5wdXNoKGtleSkgJiYgdGhpcy5fby5vbk5leHQoeCk7XG4gICAgfTtcblxuICAgIERpc3RpbmN0T2JzZXJ2ZXIucHJvdG90eXBlLmVycm9yID0gZnVuY3Rpb24gKGUpIHsgdGhpcy5fby5vbkVycm9yKGUpOyB9O1xuICAgIERpc3RpbmN0T2JzZXJ2ZXIucHJvdG90eXBlLmNvbXBsZXRlZCA9IGZ1bmN0aW9uICgpIHsgdGhpcy5fby5vbkNvbXBsZXRlZCgpOyB9O1xuXG4gICAgcmV0dXJuIERpc3RpbmN0T2JzZXJ2ZXI7XG4gIH0oQWJzdHJhY3RPYnNlcnZlcikpO1xuXG4gIC8qKlxuICAgKiAgUmV0dXJucyBhbiBvYnNlcnZhYmxlIHNlcXVlbmNlIHRoYXQgY29udGFpbnMgb25seSBkaXN0aW5jdCBlbGVtZW50cyBhY2NvcmRpbmcgdG8gdGhlIGtleVNlbGVjdG9yIGFuZCB0aGUgY29tcGFyZXIuXG4gICAqICBVc2FnZSBvZiB0aGlzIG9wZXJhdG9yIHNob3VsZCBiZSBjb25zaWRlcmVkIGNhcmVmdWxseSBkdWUgdG8gdGhlIG1haW50ZW5hbmNlIG9mIGFuIGludGVybmFsIGxvb2t1cCBzdHJ1Y3R1cmUgd2hpY2ggY2FuIGdyb3cgbGFyZ2UuXG4gICAqXG4gICAqIEBleGFtcGxlXG4gICAqICB2YXIgcmVzID0gb2JzID0geHMuZGlzdGluY3QoKTtcbiAgICogIDIgLSBvYnMgPSB4cy5kaXN0aW5jdChmdW5jdGlvbiAoeCkgeyByZXR1cm4geC5pZDsgfSk7XG4gICAqICAyIC0gb2JzID0geHMuZGlzdGluY3QoZnVuY3Rpb24gKHgpIHsgcmV0dXJuIHguaWQ7IH0sIGZ1bmN0aW9uIChhLGIpIHsgcmV0dXJuIGEgPT09IGI7IH0pO1xuICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBba2V5U2VsZWN0b3JdICBBIGZ1bmN0aW9uIHRvIGNvbXB1dGUgdGhlIGNvbXBhcmlzb24ga2V5IGZvciBlYWNoIGVsZW1lbnQuXG4gICAqIEBwYXJhbSB7RnVuY3Rpb259IFtjb21wYXJlcl0gIFVzZWQgdG8gY29tcGFyZSBpdGVtcyBpbiB0aGUgY29sbGVjdGlvbi5cbiAgICogQHJldHVybnMge09ic2VydmFibGV9IEFuIG9ic2VydmFibGUgc2VxdWVuY2Ugb25seSBjb250YWluaW5nIHRoZSBkaXN0aW5jdCBlbGVtZW50cywgYmFzZWQgb24gYSBjb21wdXRlZCBrZXkgdmFsdWUsIGZyb20gdGhlIHNvdXJjZSBzZXF1ZW5jZS5cbiAgICovXG4gIG9ic2VydmFibGVQcm90by5kaXN0aW5jdCA9IGZ1bmN0aW9uIChrZXlTZWxlY3RvciwgY29tcGFyZXIpIHtcbiAgICBjb21wYXJlciB8fCAoY29tcGFyZXIgPSBkZWZhdWx0Q29tcGFyZXIpO1xuICAgIHJldHVybiBuZXcgRGlzdGluY3RPYnNlcnZhYmxlKHRoaXMsIGtleVNlbGVjdG9yLCBjb21wYXJlcik7XG4gIH07XG5cbiAgLyoqXG4gICAqICBHcm91cHMgdGhlIGVsZW1lbnRzIG9mIGFuIG9ic2VydmFibGUgc2VxdWVuY2UgYWNjb3JkaW5nIHRvIGEgc3BlY2lmaWVkIGtleSBzZWxlY3RvciBmdW5jdGlvbiBhbmQgY29tcGFyZXIgYW5kIHNlbGVjdHMgdGhlIHJlc3VsdGluZyBlbGVtZW50cyBieSB1c2luZyBhIHNwZWNpZmllZCBmdW5jdGlvbi5cbiAgICpcbiAgICogQGV4YW1wbGVcbiAgICogIHZhciByZXMgPSBvYnNlcnZhYmxlLmdyb3VwQnkoZnVuY3Rpb24gKHgpIHsgcmV0dXJuIHguaWQ7IH0pO1xuICAgKiAgMiAtIG9ic2VydmFibGUuZ3JvdXBCeShmdW5jdGlvbiAoeCkgeyByZXR1cm4geC5pZDsgfSksIGZ1bmN0aW9uICh4KSB7IHJldHVybiB4Lm5hbWU7IH0pO1xuICAgKiAgMyAtIG9ic2VydmFibGUuZ3JvdXBCeShmdW5jdGlvbiAoeCkgeyByZXR1cm4geC5pZDsgfSksIGZ1bmN0aW9uICh4KSB7IHJldHVybiB4Lm5hbWU7IH0sIGZ1bmN0aW9uICh4KSB7IHJldHVybiB4LnRvU3RyaW5nKCk7IH0pO1xuICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBrZXlTZWxlY3RvciBBIGZ1bmN0aW9uIHRvIGV4dHJhY3QgdGhlIGtleSBmb3IgZWFjaCBlbGVtZW50LlxuICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBbZWxlbWVudFNlbGVjdG9yXSAgQSBmdW5jdGlvbiB0byBtYXAgZWFjaCBzb3VyY2UgZWxlbWVudCB0byBhbiBlbGVtZW50IGluIGFuIG9ic2VydmFibGUgZ3JvdXAuXG4gICAqIEByZXR1cm5zIHtPYnNlcnZhYmxlfSBBIHNlcXVlbmNlIG9mIG9ic2VydmFibGUgZ3JvdXBzLCBlYWNoIG9mIHdoaWNoIGNvcnJlc3BvbmRzIHRvIGEgdW5pcXVlIGtleSB2YWx1ZSwgY29udGFpbmluZyBhbGwgZWxlbWVudHMgdGhhdCBzaGFyZSB0aGF0IHNhbWUga2V5IHZhbHVlLlxuICAgKi9cbiAgb2JzZXJ2YWJsZVByb3RvLmdyb3VwQnkgPSBmdW5jdGlvbiAoa2V5U2VsZWN0b3IsIGVsZW1lbnRTZWxlY3Rvcikge1xuICAgIHJldHVybiB0aGlzLmdyb3VwQnlVbnRpbChrZXlTZWxlY3RvciwgZWxlbWVudFNlbGVjdG9yLCBvYnNlcnZhYmxlTmV2ZXIpO1xuICB9O1xuXG4gICAgLyoqXG4gICAgICogIEdyb3VwcyB0aGUgZWxlbWVudHMgb2YgYW4gb2JzZXJ2YWJsZSBzZXF1ZW5jZSBhY2NvcmRpbmcgdG8gYSBzcGVjaWZpZWQga2V5IHNlbGVjdG9yIGZ1bmN0aW9uLlxuICAgICAqICBBIGR1cmF0aW9uIHNlbGVjdG9yIGZ1bmN0aW9uIGlzIHVzZWQgdG8gY29udHJvbCB0aGUgbGlmZXRpbWUgb2YgZ3JvdXBzLiBXaGVuIGEgZ3JvdXAgZXhwaXJlcywgaXQgcmVjZWl2ZXMgYW4gT25Db21wbGV0ZWQgbm90aWZpY2F0aW9uLiBXaGVuIGEgbmV3IGVsZW1lbnQgd2l0aCB0aGUgc2FtZVxuICAgICAqICBrZXkgdmFsdWUgYXMgYSByZWNsYWltZWQgZ3JvdXAgb2NjdXJzLCB0aGUgZ3JvdXAgd2lsbCBiZSByZWJvcm4gd2l0aCBhIG5ldyBsaWZldGltZSByZXF1ZXN0LlxuICAgICAqXG4gICAgICogQGV4YW1wbGVcbiAgICAgKiAgdmFyIHJlcyA9IG9ic2VydmFibGUuZ3JvdXBCeVVudGlsKGZ1bmN0aW9uICh4KSB7IHJldHVybiB4LmlkOyB9LCBudWxsLCAgZnVuY3Rpb24gKCkgeyByZXR1cm4gUnguT2JzZXJ2YWJsZS5uZXZlcigpOyB9KTtcbiAgICAgKiAgMiAtIG9ic2VydmFibGUuZ3JvdXBCeShmdW5jdGlvbiAoeCkgeyByZXR1cm4geC5pZDsgfSksIGZ1bmN0aW9uICh4KSB7IHJldHVybiB4Lm5hbWU7IH0sICBmdW5jdGlvbiAoKSB7IHJldHVybiBSeC5PYnNlcnZhYmxlLm5ldmVyKCk7IH0pO1xuICAgICAqICAzIC0gb2JzZXJ2YWJsZS5ncm91cEJ5KGZ1bmN0aW9uICh4KSB7IHJldHVybiB4LmlkOyB9KSwgZnVuY3Rpb24gKHgpIHsgcmV0dXJuIHgubmFtZTsgfSwgIGZ1bmN0aW9uICgpIHsgcmV0dXJuIFJ4Lk9ic2VydmFibGUubmV2ZXIoKTsgfSwgZnVuY3Rpb24gKHgpIHsgcmV0dXJuIHgudG9TdHJpbmcoKTsgfSk7XG4gICAgICogQHBhcmFtIHtGdW5jdGlvbn0ga2V5U2VsZWN0b3IgQSBmdW5jdGlvbiB0byBleHRyYWN0IHRoZSBrZXkgZm9yIGVhY2ggZWxlbWVudC5cbiAgICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBkdXJhdGlvblNlbGVjdG9yIEEgZnVuY3Rpb24gdG8gc2lnbmFsIHRoZSBleHBpcmF0aW9uIG9mIGEgZ3JvdXAuXG4gICAgICogQHJldHVybnMge09ic2VydmFibGV9XG4gICAgICogIEEgc2VxdWVuY2Ugb2Ygb2JzZXJ2YWJsZSBncm91cHMsIGVhY2ggb2Ygd2hpY2ggY29ycmVzcG9uZHMgdG8gYSB1bmlxdWUga2V5IHZhbHVlLCBjb250YWluaW5nIGFsbCBlbGVtZW50cyB0aGF0IHNoYXJlIHRoYXQgc2FtZSBrZXkgdmFsdWUuXG4gICAgICogIElmIGEgZ3JvdXAncyBsaWZldGltZSBleHBpcmVzLCBhIG5ldyBncm91cCB3aXRoIHRoZSBzYW1lIGtleSB2YWx1ZSBjYW4gYmUgY3JlYXRlZCBvbmNlIGFuIGVsZW1lbnQgd2l0aCBzdWNoIGEga2V5IHZhbHVlIGlzIGVuY291dGVyZWQuXG4gICAgICpcbiAgICAgKi9cbiAgICBvYnNlcnZhYmxlUHJvdG8uZ3JvdXBCeVVudGlsID0gZnVuY3Rpb24gKGtleVNlbGVjdG9yLCBlbGVtZW50U2VsZWN0b3IsIGR1cmF0aW9uU2VsZWN0b3IpIHtcbiAgICAgIHZhciBzb3VyY2UgPSB0aGlzO1xuICAgICAgcmV0dXJuIG5ldyBBbm9ueW1vdXNPYnNlcnZhYmxlKGZ1bmN0aW9uIChvKSB7XG4gICAgICAgIHZhciBtYXAgPSBuZXcgTWFwKCksXG4gICAgICAgICAgZ3JvdXBEaXNwb3NhYmxlID0gbmV3IENvbXBvc2l0ZURpc3Bvc2FibGUoKSxcbiAgICAgICAgICByZWZDb3VudERpc3Bvc2FibGUgPSBuZXcgUmVmQ291bnREaXNwb3NhYmxlKGdyb3VwRGlzcG9zYWJsZSksXG4gICAgICAgICAgaGFuZGxlRXJyb3IgPSBmdW5jdGlvbiAoZSkgeyByZXR1cm4gZnVuY3Rpb24gKGl0ZW0pIHsgaXRlbS5vbkVycm9yKGUpOyB9OyB9O1xuXG4gICAgICAgIGdyb3VwRGlzcG9zYWJsZS5hZGQoXG4gICAgICAgICAgc291cmNlLnN1YnNjcmliZShmdW5jdGlvbiAoeCkge1xuICAgICAgICAgICAgdmFyIGtleSA9IHRyeUNhdGNoKGtleVNlbGVjdG9yKSh4KTtcbiAgICAgICAgICAgIGlmIChrZXkgPT09IGVycm9yT2JqKSB7XG4gICAgICAgICAgICAgIG1hcC5mb3JFYWNoKGhhbmRsZUVycm9yKGtleS5lKSk7XG4gICAgICAgICAgICAgIHJldHVybiBvLm9uRXJyb3Ioa2V5LmUpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB2YXIgZmlyZU5ld01hcEVudHJ5ID0gZmFsc2UsIHdyaXRlciA9IG1hcC5nZXQoa2V5KTtcbiAgICAgICAgICAgIGlmICh3cml0ZXIgPT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICB3cml0ZXIgPSBuZXcgU3ViamVjdCgpO1xuICAgICAgICAgICAgICBtYXAuc2V0KGtleSwgd3JpdGVyKTtcbiAgICAgICAgICAgICAgZmlyZU5ld01hcEVudHJ5ID0gdHJ1ZTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKGZpcmVOZXdNYXBFbnRyeSkge1xuICAgICAgICAgICAgICB2YXIgZ3JvdXAgPSBuZXcgR3JvdXBlZE9ic2VydmFibGUoa2V5LCB3cml0ZXIsIHJlZkNvdW50RGlzcG9zYWJsZSksXG4gICAgICAgICAgICAgICAgZHVyYXRpb25Hcm91cCA9IG5ldyBHcm91cGVkT2JzZXJ2YWJsZShrZXksIHdyaXRlcik7XG4gICAgICAgICAgICAgIHZhciBkdXJhdGlvbiA9IHRyeUNhdGNoKGR1cmF0aW9uU2VsZWN0b3IpKGR1cmF0aW9uR3JvdXApO1xuICAgICAgICAgICAgICBpZiAoZHVyYXRpb24gPT09IGVycm9yT2JqKSB7XG4gICAgICAgICAgICAgICAgbWFwLmZvckVhY2goaGFuZGxlRXJyb3IoZHVyYXRpb24uZSkpO1xuICAgICAgICAgICAgICAgIHJldHVybiBvLm9uRXJyb3IoZHVyYXRpb24uZSk7XG4gICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICBvLm9uTmV4dChncm91cCk7XG5cbiAgICAgICAgICAgICAgdmFyIG1kID0gbmV3IFNpbmdsZUFzc2lnbm1lbnREaXNwb3NhYmxlKCk7XG4gICAgICAgICAgICAgIGdyb3VwRGlzcG9zYWJsZS5hZGQobWQpO1xuXG4gICAgICAgICAgICAgIG1kLnNldERpc3Bvc2FibGUoZHVyYXRpb24udGFrZSgxKS5zdWJzY3JpYmUoXG4gICAgICAgICAgICAgICAgbm9vcCxcbiAgICAgICAgICAgICAgICBmdW5jdGlvbiAoZSkge1xuICAgICAgICAgICAgICAgICAgbWFwLmZvckVhY2goaGFuZGxlRXJyb3IoZSkpO1xuICAgICAgICAgICAgICAgICAgby5vbkVycm9yKGUpO1xuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgaWYgKG1hcFsnZGVsZXRlJ10oa2V5KSkgeyB3cml0ZXIub25Db21wbGV0ZWQoKTsgfVxuICAgICAgICAgICAgICAgICAgZ3JvdXBEaXNwb3NhYmxlLnJlbW92ZShtZCk7XG4gICAgICAgICAgICAgICAgfSkpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB2YXIgZWxlbWVudCA9IHg7XG4gICAgICAgICAgICBpZiAoaXNGdW5jdGlvbihlbGVtZW50U2VsZWN0b3IpKSB7XG4gICAgICAgICAgICAgIGVsZW1lbnQgPSB0cnlDYXRjaChlbGVtZW50U2VsZWN0b3IpKHgpO1xuICAgICAgICAgICAgICBpZiAoZWxlbWVudCA9PT0gZXJyb3JPYmopIHtcbiAgICAgICAgICAgICAgICBtYXAuZm9yRWFjaChoYW5kbGVFcnJvcihlbGVtZW50LmUpKTtcbiAgICAgICAgICAgICAgICByZXR1cm4gby5vbkVycm9yKGVsZW1lbnQuZSk7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgd3JpdGVyLm9uTmV4dChlbGVtZW50KTtcbiAgICAgICAgfSwgZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgICBtYXAuZm9yRWFjaChoYW5kbGVFcnJvcihlKSk7XG4gICAgICAgICAgby5vbkVycm9yKGUpO1xuICAgICAgICB9LCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgbWFwLmZvckVhY2goZnVuY3Rpb24gKGl0ZW0pIHsgaXRlbS5vbkNvbXBsZXRlZCgpOyB9KTtcbiAgICAgICAgICBvLm9uQ29tcGxldGVkKCk7XG4gICAgICAgIH0pKTtcblxuICAgICAgcmV0dXJuIHJlZkNvdW50RGlzcG9zYWJsZTtcbiAgICB9LCBzb3VyY2UpO1xuICB9O1xuXG4gIHZhciBNYXBPYnNlcnZhYmxlID0gKGZ1bmN0aW9uIChfX3N1cGVyX18pIHtcbiAgICBpbmhlcml0cyhNYXBPYnNlcnZhYmxlLCBfX3N1cGVyX18pO1xuXG4gICAgZnVuY3Rpb24gTWFwT2JzZXJ2YWJsZShzb3VyY2UsIHNlbGVjdG9yLCB0aGlzQXJnKSB7XG4gICAgICB0aGlzLnNvdXJjZSA9IHNvdXJjZTtcbiAgICAgIHRoaXMuc2VsZWN0b3IgPSBiaW5kQ2FsbGJhY2soc2VsZWN0b3IsIHRoaXNBcmcsIDMpO1xuICAgICAgX19zdXBlcl9fLmNhbGwodGhpcyk7XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gaW5uZXJNYXAoc2VsZWN0b3IsIHNlbGYpIHtcbiAgICAgIHJldHVybiBmdW5jdGlvbiAoeCwgaSwgbykgeyByZXR1cm4gc2VsZWN0b3IuY2FsbCh0aGlzLCBzZWxmLnNlbGVjdG9yKHgsIGksIG8pLCBpLCBvKTsgfVxuICAgIH1cblxuICAgIE1hcE9ic2VydmFibGUucHJvdG90eXBlLmludGVybmFsTWFwID0gZnVuY3Rpb24gKHNlbGVjdG9yLCB0aGlzQXJnKSB7XG4gICAgICByZXR1cm4gbmV3IE1hcE9ic2VydmFibGUodGhpcy5zb3VyY2UsIGlubmVyTWFwKHNlbGVjdG9yLCB0aGlzKSwgdGhpc0FyZyk7XG4gICAgfTtcblxuICAgIE1hcE9ic2VydmFibGUucHJvdG90eXBlLnN1YnNjcmliZUNvcmUgPSBmdW5jdGlvbiAobykge1xuICAgICAgcmV0dXJuIHRoaXMuc291cmNlLnN1YnNjcmliZShuZXcgSW5uZXJPYnNlcnZlcihvLCB0aGlzLnNlbGVjdG9yLCB0aGlzKSk7XG4gICAgfTtcblxuICAgIGluaGVyaXRzKElubmVyT2JzZXJ2ZXIsIEFic3RyYWN0T2JzZXJ2ZXIpO1xuICAgIGZ1bmN0aW9uIElubmVyT2JzZXJ2ZXIobywgc2VsZWN0b3IsIHNvdXJjZSkge1xuICAgICAgdGhpcy5vID0gbztcbiAgICAgIHRoaXMuc2VsZWN0b3IgPSBzZWxlY3RvcjtcbiAgICAgIHRoaXMuc291cmNlID0gc291cmNlO1xuICAgICAgdGhpcy5pID0gMDtcbiAgICAgIEFic3RyYWN0T2JzZXJ2ZXIuY2FsbCh0aGlzKTtcbiAgICB9XG5cbiAgICBJbm5lck9ic2VydmVyLnByb3RvdHlwZS5uZXh0ID0gZnVuY3Rpb24oeCkge1xuICAgICAgdmFyIHJlc3VsdCA9IHRyeUNhdGNoKHRoaXMuc2VsZWN0b3IpKHgsIHRoaXMuaSsrLCB0aGlzLnNvdXJjZSk7XG4gICAgICBpZiAocmVzdWx0ID09PSBlcnJvck9iaikgeyByZXR1cm4gdGhpcy5vLm9uRXJyb3IocmVzdWx0LmUpOyB9XG4gICAgICB0aGlzLm8ub25OZXh0KHJlc3VsdCk7XG4gICAgfTtcblxuICAgIElubmVyT2JzZXJ2ZXIucHJvdG90eXBlLmVycm9yID0gZnVuY3Rpb24gKGUpIHtcbiAgICAgIHRoaXMuby5vbkVycm9yKGUpO1xuICAgIH07XG5cbiAgICBJbm5lck9ic2VydmVyLnByb3RvdHlwZS5jb21wbGV0ZWQgPSBmdW5jdGlvbiAoKSB7XG4gICAgICB0aGlzLm8ub25Db21wbGV0ZWQoKTtcbiAgICB9O1xuXG4gICAgcmV0dXJuIE1hcE9ic2VydmFibGU7XG5cbiAgfShPYnNlcnZhYmxlQmFzZSkpO1xuXG4gIC8qKlxuICAqIFByb2plY3RzIGVhY2ggZWxlbWVudCBvZiBhbiBvYnNlcnZhYmxlIHNlcXVlbmNlIGludG8gYSBuZXcgZm9ybSBieSBpbmNvcnBvcmF0aW5nIHRoZSBlbGVtZW50J3MgaW5kZXguXG4gICogQHBhcmFtIHtGdW5jdGlvbn0gc2VsZWN0b3IgQSB0cmFuc2Zvcm0gZnVuY3Rpb24gdG8gYXBwbHkgdG8gZWFjaCBzb3VyY2UgZWxlbWVudDsgdGhlIHNlY29uZCBwYXJhbWV0ZXIgb2YgdGhlIGZ1bmN0aW9uIHJlcHJlc2VudHMgdGhlIGluZGV4IG9mIHRoZSBzb3VyY2UgZWxlbWVudC5cbiAgKiBAcGFyYW0ge0FueX0gW3RoaXNBcmddIE9iamVjdCB0byB1c2UgYXMgdGhpcyB3aGVuIGV4ZWN1dGluZyBjYWxsYmFjay5cbiAgKiBAcmV0dXJucyB7T2JzZXJ2YWJsZX0gQW4gb2JzZXJ2YWJsZSBzZXF1ZW5jZSB3aG9zZSBlbGVtZW50cyBhcmUgdGhlIHJlc3VsdCBvZiBpbnZva2luZyB0aGUgdHJhbnNmb3JtIGZ1bmN0aW9uIG9uIGVhY2ggZWxlbWVudCBvZiBzb3VyY2UuXG4gICovXG4gIG9ic2VydmFibGVQcm90by5tYXAgPSBvYnNlcnZhYmxlUHJvdG8uc2VsZWN0ID0gZnVuY3Rpb24gKHNlbGVjdG9yLCB0aGlzQXJnKSB7XG4gICAgdmFyIHNlbGVjdG9yRm4gPSB0eXBlb2Ygc2VsZWN0b3IgPT09ICdmdW5jdGlvbicgPyBzZWxlY3RvciA6IGZ1bmN0aW9uICgpIHsgcmV0dXJuIHNlbGVjdG9yOyB9O1xuICAgIHJldHVybiB0aGlzIGluc3RhbmNlb2YgTWFwT2JzZXJ2YWJsZSA/XG4gICAgICB0aGlzLmludGVybmFsTWFwKHNlbGVjdG9yRm4sIHRoaXNBcmcpIDpcbiAgICAgIG5ldyBNYXBPYnNlcnZhYmxlKHRoaXMsIHNlbGVjdG9yRm4sIHRoaXNBcmcpO1xuICB9O1xuXG4gIGZ1bmN0aW9uIHBsdWNrZXIoYXJncywgbGVuKSB7XG4gICAgcmV0dXJuIGZ1bmN0aW9uIG1hcHBlcih4KSB7XG4gICAgICB2YXIgY3VycmVudFByb3AgPSB4O1xuICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBsZW47IGkrKykge1xuICAgICAgICB2YXIgcCA9IGN1cnJlbnRQcm9wW2FyZ3NbaV1dO1xuICAgICAgICBpZiAodHlwZW9mIHAgIT09ICd1bmRlZmluZWQnKSB7XG4gICAgICAgICAgY3VycmVudFByb3AgPSBwO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHJldHVybiB1bmRlZmluZWQ7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIHJldHVybiBjdXJyZW50UHJvcDtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogUmV0cmlldmVzIHRoZSB2YWx1ZSBvZiBhIHNwZWNpZmllZCBuZXN0ZWQgcHJvcGVydHkgZnJvbSBhbGwgZWxlbWVudHMgaW5cbiAgICogdGhlIE9ic2VydmFibGUgc2VxdWVuY2UuXG4gICAqIEBwYXJhbSB7QXJndW1lbnRzfSBhcmd1bWVudHMgVGhlIG5lc3RlZCBwcm9wZXJ0aWVzIHRvIHBsdWNrLlxuICAgKiBAcmV0dXJucyB7T2JzZXJ2YWJsZX0gUmV0dXJucyBhIG5ldyBPYnNlcnZhYmxlIHNlcXVlbmNlIG9mIHByb3BlcnR5IHZhbHVlcy5cbiAgICovXG4gIG9ic2VydmFibGVQcm90by5wbHVjayA9IGZ1bmN0aW9uICgpIHtcbiAgICB2YXIgbGVuID0gYXJndW1lbnRzLmxlbmd0aCwgYXJncyA9IG5ldyBBcnJheShsZW4pO1xuICAgIGlmIChsZW4gPT09IDApIHsgdGhyb3cgbmV3IEVycm9yKCdMaXN0IG9mIHByb3BlcnRpZXMgY2Fubm90IGJlIGVtcHR5LicpOyB9XG4gICAgZm9yKHZhciBpID0gMDsgaSA8IGxlbjsgaSsrKSB7IGFyZ3NbaV0gPSBhcmd1bWVudHNbaV07IH1cbiAgICByZXR1cm4gdGhpcy5tYXAocGx1Y2tlcihhcmdzLCBsZW4pKTtcbiAgfTtcblxub2JzZXJ2YWJsZVByb3RvLmZsYXRNYXAgPSBvYnNlcnZhYmxlUHJvdG8uc2VsZWN0TWFueSA9IGZ1bmN0aW9uKHNlbGVjdG9yLCByZXN1bHRTZWxlY3RvciwgdGhpc0FyZykge1xuICAgIHJldHVybiBuZXcgRmxhdE1hcE9ic2VydmFibGUodGhpcywgc2VsZWN0b3IsIHJlc3VsdFNlbGVjdG9yLCB0aGlzQXJnKS5tZXJnZUFsbCgpO1xufTtcblxuXG4vL1xuLy9SeC5PYnNlcnZhYmxlLnByb3RvdHlwZS5mbGF0TWFwV2l0aE1heENvbmN1cnJlbnQgPSBmdW5jdGlvbihsaW1pdCwgc2VsZWN0b3IsIHJlc3VsdFNlbGVjdG9yLCB0aGlzQXJnKSB7XG4vLyAgICByZXR1cm4gbmV3IEZsYXRNYXBPYnNlcnZhYmxlKHRoaXMsIHNlbGVjdG9yLCByZXN1bHRTZWxlY3RvciwgdGhpc0FyZykubWVyZ2UobGltaXQpO1xuLy99O1xuLy9cblxuICAvKipcbiAgICogUHJvamVjdHMgZWFjaCBub3RpZmljYXRpb24gb2YgYW4gb2JzZXJ2YWJsZSBzZXF1ZW5jZSB0byBhbiBvYnNlcnZhYmxlIHNlcXVlbmNlIGFuZCBtZXJnZXMgdGhlIHJlc3VsdGluZyBvYnNlcnZhYmxlIHNlcXVlbmNlcyBpbnRvIG9uZSBvYnNlcnZhYmxlIHNlcXVlbmNlLlxuICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBvbk5leHQgQSB0cmFuc2Zvcm0gZnVuY3Rpb24gdG8gYXBwbHkgdG8gZWFjaCBlbGVtZW50OyB0aGUgc2Vjb25kIHBhcmFtZXRlciBvZiB0aGUgZnVuY3Rpb24gcmVwcmVzZW50cyB0aGUgaW5kZXggb2YgdGhlIHNvdXJjZSBlbGVtZW50LlxuICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBvbkVycm9yIEEgdHJhbnNmb3JtIGZ1bmN0aW9uIHRvIGFwcGx5IHdoZW4gYW4gZXJyb3Igb2NjdXJzIGluIHRoZSBzb3VyY2Ugc2VxdWVuY2UuXG4gICAqIEBwYXJhbSB7RnVuY3Rpb259IG9uQ29tcGxldGVkIEEgdHJhbnNmb3JtIGZ1bmN0aW9uIHRvIGFwcGx5IHdoZW4gdGhlIGVuZCBvZiB0aGUgc291cmNlIHNlcXVlbmNlIGlzIHJlYWNoZWQuXG4gICAqIEBwYXJhbSB7QW55fSBbdGhpc0FyZ10gQW4gb3B0aW9uYWwgXCJ0aGlzXCIgdG8gdXNlIHRvIGludm9rZSBlYWNoIHRyYW5zZm9ybS5cbiAgICogQHJldHVybnMge09ic2VydmFibGV9IEFuIG9ic2VydmFibGUgc2VxdWVuY2Ugd2hvc2UgZWxlbWVudHMgYXJlIHRoZSByZXN1bHQgb2YgaW52b2tpbmcgdGhlIG9uZS10by1tYW55IHRyYW5zZm9ybSBmdW5jdGlvbiBjb3JyZXNwb25kaW5nIHRvIGVhY2ggbm90aWZpY2F0aW9uIGluIHRoZSBpbnB1dCBzZXF1ZW5jZS5cbiAgICovXG4gIG9ic2VydmFibGVQcm90by5mbGF0TWFwT2JzZXJ2ZXIgPSBvYnNlcnZhYmxlUHJvdG8uc2VsZWN0TWFueU9ic2VydmVyID0gZnVuY3Rpb24gKG9uTmV4dCwgb25FcnJvciwgb25Db21wbGV0ZWQsIHRoaXNBcmcpIHtcbiAgICB2YXIgc291cmNlID0gdGhpcztcbiAgICByZXR1cm4gbmV3IEFub255bW91c09ic2VydmFibGUoZnVuY3Rpb24gKG9ic2VydmVyKSB7XG4gICAgICB2YXIgaW5kZXggPSAwO1xuXG4gICAgICByZXR1cm4gc291cmNlLnN1YnNjcmliZShcbiAgICAgICAgZnVuY3Rpb24gKHgpIHtcbiAgICAgICAgICB2YXIgcmVzdWx0O1xuICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICByZXN1bHQgPSBvbk5leHQuY2FsbCh0aGlzQXJnLCB4LCBpbmRleCsrKTtcbiAgICAgICAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgICAgICBvYnNlcnZlci5vbkVycm9yKGUpO1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgIH1cbiAgICAgICAgICBpc1Byb21pc2UocmVzdWx0KSAmJiAocmVzdWx0ID0gb2JzZXJ2YWJsZUZyb21Qcm9taXNlKHJlc3VsdCkpO1xuICAgICAgICAgIG9ic2VydmVyLm9uTmV4dChyZXN1bHQpO1xuICAgICAgICB9LFxuICAgICAgICBmdW5jdGlvbiAoZXJyKSB7XG4gICAgICAgICAgdmFyIHJlc3VsdDtcbiAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgcmVzdWx0ID0gb25FcnJvci5jYWxsKHRoaXNBcmcsIGVycik7XG4gICAgICAgICAgfSBjYXRjaCAoZSkge1xuICAgICAgICAgICAgb2JzZXJ2ZXIub25FcnJvcihlKTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICB9XG4gICAgICAgICAgaXNQcm9taXNlKHJlc3VsdCkgJiYgKHJlc3VsdCA9IG9ic2VydmFibGVGcm9tUHJvbWlzZShyZXN1bHQpKTtcbiAgICAgICAgICBvYnNlcnZlci5vbk5leHQocmVzdWx0KTtcbiAgICAgICAgICBvYnNlcnZlci5vbkNvbXBsZXRlZCgpO1xuICAgICAgICB9LFxuICAgICAgICBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgdmFyIHJlc3VsdDtcbiAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgcmVzdWx0ID0gb25Db21wbGV0ZWQuY2FsbCh0aGlzQXJnKTtcbiAgICAgICAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgICAgICBvYnNlcnZlci5vbkVycm9yKGUpO1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgIH1cbiAgICAgICAgICBpc1Byb21pc2UocmVzdWx0KSAmJiAocmVzdWx0ID0gb2JzZXJ2YWJsZUZyb21Qcm9taXNlKHJlc3VsdCkpO1xuICAgICAgICAgIG9ic2VydmVyLm9uTmV4dChyZXN1bHQpO1xuICAgICAgICAgIG9ic2VydmVyLm9uQ29tcGxldGVkKCk7XG4gICAgICAgIH0pO1xuICAgIH0sIHNvdXJjZSkubWVyZ2VBbGwoKTtcbiAgfTtcblxuUnguT2JzZXJ2YWJsZS5wcm90b3R5cGUuZmxhdE1hcExhdGVzdCA9IGZ1bmN0aW9uKHNlbGVjdG9yLCByZXN1bHRTZWxlY3RvciwgdGhpc0FyZykge1xuICAgIHJldHVybiBuZXcgRmxhdE1hcE9ic2VydmFibGUodGhpcywgc2VsZWN0b3IsIHJlc3VsdFNlbGVjdG9yLCB0aGlzQXJnKS5zd2l0Y2hMYXRlc3QoKTtcbn07XG4gIHZhciBTa2lwT2JzZXJ2YWJsZSA9IChmdW5jdGlvbihfX3N1cGVyX18pIHtcbiAgICBpbmhlcml0cyhTa2lwT2JzZXJ2YWJsZSwgX19zdXBlcl9fKTtcbiAgICBmdW5jdGlvbiBTa2lwT2JzZXJ2YWJsZShzb3VyY2UsIGNvdW50KSB7XG4gICAgICB0aGlzLnNvdXJjZSA9IHNvdXJjZTtcbiAgICAgIHRoaXMuc2tpcENvdW50ID0gY291bnQ7XG4gICAgICBfX3N1cGVyX18uY2FsbCh0aGlzKTtcbiAgICB9XG4gICAgXG4gICAgU2tpcE9ic2VydmFibGUucHJvdG90eXBlLnN1YnNjcmliZUNvcmUgPSBmdW5jdGlvbiAobykge1xuICAgICAgcmV0dXJuIHRoaXMuc291cmNlLnN1YnNjcmliZShuZXcgSW5uZXJPYnNlcnZlcihvLCB0aGlzLnNraXBDb3VudCkpO1xuICAgIH07XG4gICAgXG4gICAgZnVuY3Rpb24gSW5uZXJPYnNlcnZlcihvLCBjKSB7XG4gICAgICB0aGlzLmMgPSBjO1xuICAgICAgdGhpcy5yID0gYztcbiAgICAgIHRoaXMubyA9IG87XG4gICAgICB0aGlzLmlzU3RvcHBlZCA9IGZhbHNlO1xuICAgIH1cbiAgICBJbm5lck9ic2VydmVyLnByb3RvdHlwZS5vbk5leHQgPSBmdW5jdGlvbiAoeCkge1xuICAgICAgaWYgKHRoaXMuaXNTdG9wcGVkKSB7IHJldHVybjsgfVxuICAgICAgaWYgKHRoaXMuciA8PSAwKSB7IFxuICAgICAgICB0aGlzLm8ub25OZXh0KHgpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdGhpcy5yLS07XG4gICAgICB9XG4gICAgfTtcbiAgICBJbm5lck9ic2VydmVyLnByb3RvdHlwZS5vbkVycm9yID0gZnVuY3Rpb24oZSkge1xuICAgICAgaWYgKCF0aGlzLmlzU3RvcHBlZCkgeyB0aGlzLmlzU3RvcHBlZCA9IHRydWU7IHRoaXMuby5vbkVycm9yKGUpOyB9XG4gICAgfTtcbiAgICBJbm5lck9ic2VydmVyLnByb3RvdHlwZS5vbkNvbXBsZXRlZCA9IGZ1bmN0aW9uKCkge1xuICAgICAgaWYgKCF0aGlzLmlzU3RvcHBlZCkgeyB0aGlzLmlzU3RvcHBlZCA9IHRydWU7IHRoaXMuby5vbkNvbXBsZXRlZCgpOyB9XG4gICAgfTtcbiAgICBJbm5lck9ic2VydmVyLnByb3RvdHlwZS5kaXNwb3NlID0gZnVuY3Rpb24oKSB7IHRoaXMuaXNTdG9wcGVkID0gdHJ1ZTsgfTtcbiAgICBJbm5lck9ic2VydmVyLnByb3RvdHlwZS5mYWlsID0gZnVuY3Rpb24oZSkge1xuICAgICAgaWYgKCF0aGlzLmlzU3RvcHBlZCkge1xuICAgICAgICB0aGlzLmlzU3RvcHBlZCA9IHRydWU7XG4gICAgICAgIHRoaXMuby5vbkVycm9yKGUpO1xuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgIH1cbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9O1xuICAgIFxuICAgIHJldHVybiBTa2lwT2JzZXJ2YWJsZTtcbiAgfShPYnNlcnZhYmxlQmFzZSkpOyAgXG4gIFxuICAvKipcbiAgICogQnlwYXNzZXMgYSBzcGVjaWZpZWQgbnVtYmVyIG9mIGVsZW1lbnRzIGluIGFuIG9ic2VydmFibGUgc2VxdWVuY2UgYW5kIHRoZW4gcmV0dXJucyB0aGUgcmVtYWluaW5nIGVsZW1lbnRzLlxuICAgKiBAcGFyYW0ge051bWJlcn0gY291bnQgVGhlIG51bWJlciBvZiBlbGVtZW50cyB0byBza2lwIGJlZm9yZSByZXR1cm5pbmcgdGhlIHJlbWFpbmluZyBlbGVtZW50cy5cbiAgICogQHJldHVybnMge09ic2VydmFibGV9IEFuIG9ic2VydmFibGUgc2VxdWVuY2UgdGhhdCBjb250YWlucyB0aGUgZWxlbWVudHMgdGhhdCBvY2N1ciBhZnRlciB0aGUgc3BlY2lmaWVkIGluZGV4IGluIHRoZSBpbnB1dCBzZXF1ZW5jZS5cbiAgICovXG4gIG9ic2VydmFibGVQcm90by5za2lwID0gZnVuY3Rpb24gKGNvdW50KSB7XG4gICAgaWYgKGNvdW50IDwgMCkgeyB0aHJvdyBuZXcgQXJndW1lbnRPdXRPZlJhbmdlRXJyb3IoKTsgfVxuICAgIHJldHVybiBuZXcgU2tpcE9ic2VydmFibGUodGhpcywgY291bnQpO1xuICB9O1xuICB2YXIgU2tpcFdoaWxlT2JzZXJ2YWJsZSA9IChmdW5jdGlvbiAoX19zdXBlcl9fKSB7XG4gICAgaW5oZXJpdHMoU2tpcFdoaWxlT2JzZXJ2YWJsZSwgX19zdXBlcl9fKTtcbiAgICBmdW5jdGlvbiBTa2lwV2hpbGVPYnNlcnZhYmxlKHNvdXJjZSwgZm4pIHtcbiAgICAgIHRoaXMuc291cmNlID0gc291cmNlO1xuICAgICAgdGhpcy5fZm4gPSBmbjtcbiAgICAgIF9fc3VwZXJfXy5jYWxsKHRoaXMpO1xuICAgIH1cblxuICAgIFNraXBXaGlsZU9ic2VydmFibGUucHJvdG90eXBlLnN1YnNjcmliZUNvcmUgPSBmdW5jdGlvbiAobykge1xuICAgICAgcmV0dXJuIHRoaXMuc291cmNlLnN1YnNjcmliZShuZXcgU2tpcFdoaWxlT2JzZXJ2ZXIobywgdGhpcykpO1xuICAgIH07XG5cbiAgICByZXR1cm4gU2tpcFdoaWxlT2JzZXJ2YWJsZTtcbiAgfShPYnNlcnZhYmxlQmFzZSkpO1xuXG4gIHZhciBTa2lwV2hpbGVPYnNlcnZlciA9IChmdW5jdGlvbiAoX19zdXBlcl9fKSB7XG4gICAgaW5oZXJpdHMoU2tpcFdoaWxlT2JzZXJ2ZXIsIF9fc3VwZXJfXyk7XG5cbiAgICBmdW5jdGlvbiBTa2lwV2hpbGVPYnNlcnZlcihvLCBwKSB7XG4gICAgICB0aGlzLl9vID0gbztcbiAgICAgIHRoaXMuX3AgPSBwO1xuICAgICAgdGhpcy5faSA9IDA7XG4gICAgICB0aGlzLl9yID0gZmFsc2U7XG4gICAgICBfX3N1cGVyX18uY2FsbCh0aGlzKTtcbiAgICB9XG5cbiAgICBTa2lwV2hpbGVPYnNlcnZlci5wcm90b3R5cGUubmV4dCA9IGZ1bmN0aW9uICh4KSB7XG4gICAgICBpZiAoIXRoaXMuX3IpIHtcbiAgICAgICAgdmFyIHJlcyA9IHRyeUNhdGNoKHRoaXMuX3AuX2ZuKSh4LCB0aGlzLl9pKyssIHRoaXMuX3ApO1xuICAgICAgICBpZiAocmVzID09PSBlcnJvck9iaikgeyByZXR1cm4gdGhpcy5fby5vbkVycm9yKHJlcy5lKTsgfVxuICAgICAgICB0aGlzLl9yID0gIXJlcztcbiAgICAgIH1cbiAgICAgIHRoaXMuX3IgJiYgdGhpcy5fby5vbk5leHQoeCk7XG4gICAgfTtcbiAgICBTa2lwV2hpbGVPYnNlcnZlci5wcm90b3R5cGUuZXJyb3IgPSBmdW5jdGlvbiAoZSkgeyB0aGlzLl9vLm9uRXJyb3IoZSk7IH07XG4gICAgU2tpcFdoaWxlT2JzZXJ2ZXIucHJvdG90eXBlLmNvbXBsZXRlZCA9IGZ1bmN0aW9uICgpIHsgdGhpcy5fby5vbkNvbXBsZXRlZCgpOyB9O1xuXG4gICAgcmV0dXJuIFNraXBXaGlsZU9ic2VydmVyO1xuICB9KEFic3RyYWN0T2JzZXJ2ZXIpKTtcblxuICAvKipcbiAgICogIEJ5cGFzc2VzIGVsZW1lbnRzIGluIGFuIG9ic2VydmFibGUgc2VxdWVuY2UgYXMgbG9uZyBhcyBhIHNwZWNpZmllZCBjb25kaXRpb24gaXMgdHJ1ZSBhbmQgdGhlbiByZXR1cm5zIHRoZSByZW1haW5pbmcgZWxlbWVudHMuXG4gICAqICBUaGUgZWxlbWVudCdzIGluZGV4IGlzIHVzZWQgaW4gdGhlIGxvZ2ljIG9mIHRoZSBwcmVkaWNhdGUgZnVuY3Rpb24uXG4gICAqXG4gICAqICB2YXIgcmVzID0gc291cmNlLnNraXBXaGlsZShmdW5jdGlvbiAodmFsdWUpIHsgcmV0dXJuIHZhbHVlIDwgMTA7IH0pO1xuICAgKiAgdmFyIHJlcyA9IHNvdXJjZS5za2lwV2hpbGUoZnVuY3Rpb24gKHZhbHVlLCBpbmRleCkgeyByZXR1cm4gdmFsdWUgPCAxMCB8fCBpbmRleCA8IDEwOyB9KTtcbiAgICogQHBhcmFtIHtGdW5jdGlvbn0gcHJlZGljYXRlIEEgZnVuY3Rpb24gdG8gdGVzdCBlYWNoIGVsZW1lbnQgZm9yIGEgY29uZGl0aW9uOyB0aGUgc2Vjb25kIHBhcmFtZXRlciBvZiB0aGUgZnVuY3Rpb24gcmVwcmVzZW50cyB0aGUgaW5kZXggb2YgdGhlIHNvdXJjZSBlbGVtZW50LlxuICAgKiBAcGFyYW0ge0FueX0gW3RoaXNBcmddIE9iamVjdCB0byB1c2UgYXMgdGhpcyB3aGVuIGV4ZWN1dGluZyBjYWxsYmFjay5cbiAgICogQHJldHVybnMge09ic2VydmFibGV9IEFuIG9ic2VydmFibGUgc2VxdWVuY2UgdGhhdCBjb250YWlucyB0aGUgZWxlbWVudHMgZnJvbSB0aGUgaW5wdXQgc2VxdWVuY2Ugc3RhcnRpbmcgYXQgdGhlIGZpcnN0IGVsZW1lbnQgaW4gdGhlIGxpbmVhciBzZXJpZXMgdGhhdCBkb2VzIG5vdCBwYXNzIHRoZSB0ZXN0IHNwZWNpZmllZCBieSBwcmVkaWNhdGUuXG4gICAqL1xuICBvYnNlcnZhYmxlUHJvdG8uc2tpcFdoaWxlID0gZnVuY3Rpb24gKHByZWRpY2F0ZSwgdGhpc0FyZykge1xuICAgIHZhciBmbiA9IGJpbmRDYWxsYmFjayhwcmVkaWNhdGUsIHRoaXNBcmcsIDMpO1xuICAgIHJldHVybiBuZXcgU2tpcFdoaWxlT2JzZXJ2YWJsZSh0aGlzLCBmbik7XG4gIH07XG5cbiAgdmFyIFRha2VPYnNlcnZhYmxlID0gKGZ1bmN0aW9uKF9fc3VwZXJfXykge1xuICAgIGluaGVyaXRzKFRha2VPYnNlcnZhYmxlLCBfX3N1cGVyX18pO1xuICAgIFxuICAgIGZ1bmN0aW9uIFRha2VPYnNlcnZhYmxlKHNvdXJjZSwgY291bnQpIHtcbiAgICAgIHRoaXMuc291cmNlID0gc291cmNlO1xuICAgICAgdGhpcy50YWtlQ291bnQgPSBjb3VudDtcbiAgICAgIF9fc3VwZXJfXy5jYWxsKHRoaXMpO1xuICAgIH1cbiAgICBcbiAgICBUYWtlT2JzZXJ2YWJsZS5wcm90b3R5cGUuc3Vic2NyaWJlQ29yZSA9IGZ1bmN0aW9uIChvKSB7XG4gICAgICByZXR1cm4gdGhpcy5zb3VyY2Uuc3Vic2NyaWJlKG5ldyBJbm5lck9ic2VydmVyKG8sIHRoaXMudGFrZUNvdW50KSk7XG4gICAgfTtcbiAgICBcbiAgICBmdW5jdGlvbiBJbm5lck9ic2VydmVyKG8sIGMpIHtcbiAgICAgIHRoaXMubyA9IG87XG4gICAgICB0aGlzLmMgPSBjO1xuICAgICAgdGhpcy5yID0gYztcbiAgICAgIHRoaXMuaXNTdG9wcGVkID0gZmFsc2U7XG4gICAgfVxuICAgIElubmVyT2JzZXJ2ZXIucHJvdG90eXBlID0ge1xuICAgICAgb25OZXh0OiBmdW5jdGlvbiAoeCkge1xuICAgICAgICBpZiAodGhpcy5pc1N0b3BwZWQpIHsgcmV0dXJuOyB9XG4gICAgICAgIGlmICh0aGlzLnItLSA+IDApIHtcbiAgICAgICAgICB0aGlzLm8ub25OZXh0KHgpO1xuICAgICAgICAgIHRoaXMuciA8PSAwICYmIHRoaXMuby5vbkNvbXBsZXRlZCgpO1xuICAgICAgICB9XG4gICAgICB9LFxuICAgICAgb25FcnJvcjogZnVuY3Rpb24gKGVycikge1xuICAgICAgICBpZiAoIXRoaXMuaXNTdG9wcGVkKSB7XG4gICAgICAgICAgdGhpcy5pc1N0b3BwZWQgPSB0cnVlO1xuICAgICAgICAgIHRoaXMuby5vbkVycm9yKGVycik7XG4gICAgICAgIH1cbiAgICAgIH0sXG4gICAgICBvbkNvbXBsZXRlZDogZnVuY3Rpb24gKCkge1xuICAgICAgICBpZiAoIXRoaXMuaXNTdG9wcGVkKSB7XG4gICAgICAgICAgdGhpcy5pc1N0b3BwZWQgPSB0cnVlO1xuICAgICAgICAgIHRoaXMuby5vbkNvbXBsZXRlZCgpO1xuICAgICAgICB9XG4gICAgICB9LFxuICAgICAgZGlzcG9zZTogZnVuY3Rpb24gKCkgeyB0aGlzLmlzU3RvcHBlZCA9IHRydWU7IH0sXG4gICAgICBmYWlsOiBmdW5jdGlvbiAoZSkge1xuICAgICAgICBpZiAoIXRoaXMuaXNTdG9wcGVkKSB7XG4gICAgICAgICAgdGhpcy5pc1N0b3BwZWQgPSB0cnVlO1xuICAgICAgICAgIHRoaXMuby5vbkVycm9yKGUpO1xuICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgIH1cbiAgICB9O1xuICAgIFxuICAgIHJldHVybiBUYWtlT2JzZXJ2YWJsZTtcbiAgfShPYnNlcnZhYmxlQmFzZSkpOyAgXG4gIFxuICAvKipcbiAgICogIFJldHVybnMgYSBzcGVjaWZpZWQgbnVtYmVyIG9mIGNvbnRpZ3VvdXMgZWxlbWVudHMgZnJvbSB0aGUgc3RhcnQgb2YgYW4gb2JzZXJ2YWJsZSBzZXF1ZW5jZSwgdXNpbmcgdGhlIHNwZWNpZmllZCBzY2hlZHVsZXIgZm9yIHRoZSBlZGdlIGNhc2Ugb2YgdGFrZSgwKS5cbiAgICogQHBhcmFtIHtOdW1iZXJ9IGNvdW50IFRoZSBudW1iZXIgb2YgZWxlbWVudHMgdG8gcmV0dXJuLlxuICAgKiBAcGFyYW0ge1NjaGVkdWxlcn0gW3NjaGVkdWxlcl0gU2NoZWR1bGVyIHVzZWQgdG8gcHJvZHVjZSBhbiBPbkNvbXBsZXRlZCBtZXNzYWdlIGluIGNhc2UgPHBhcmFtcmVmIG5hbWU9XCJjb3VudCBjb3VudDwvcGFyYW1yZWY+IGlzIHNldCB0byAwLlxuICAgKiBAcmV0dXJucyB7T2JzZXJ2YWJsZX0gQW4gb2JzZXJ2YWJsZSBzZXF1ZW5jZSB0aGF0IGNvbnRhaW5zIHRoZSBzcGVjaWZpZWQgbnVtYmVyIG9mIGVsZW1lbnRzIGZyb20gdGhlIHN0YXJ0IG9mIHRoZSBpbnB1dCBzZXF1ZW5jZS5cbiAgICovXG4gIG9ic2VydmFibGVQcm90by50YWtlID0gZnVuY3Rpb24gKGNvdW50LCBzY2hlZHVsZXIpIHtcbiAgICBpZiAoY291bnQgPCAwKSB7IHRocm93IG5ldyBBcmd1bWVudE91dE9mUmFuZ2VFcnJvcigpOyB9XG4gICAgaWYgKGNvdW50ID09PSAwKSB7IHJldHVybiBvYnNlcnZhYmxlRW1wdHkoc2NoZWR1bGVyKTsgfVxuICAgIHJldHVybiBuZXcgVGFrZU9ic2VydmFibGUodGhpcywgY291bnQpO1xuICB9O1xuXG4gIHZhciBUYWtlV2hpbGVPYnNlcnZhYmxlID0gKGZ1bmN0aW9uIChfX3N1cGVyX18pIHtcbiAgICBpbmhlcml0cyhUYWtlV2hpbGVPYnNlcnZhYmxlLCBfX3N1cGVyX18pO1xuICAgIGZ1bmN0aW9uIFRha2VXaGlsZU9ic2VydmFibGUoc291cmNlLCBmbikge1xuICAgICAgdGhpcy5zb3VyY2UgPSBzb3VyY2U7XG4gICAgICB0aGlzLl9mbiA9IGZuO1xuICAgICAgX19zdXBlcl9fLmNhbGwodGhpcyk7XG4gICAgfVxuXG4gICAgVGFrZVdoaWxlT2JzZXJ2YWJsZS5wcm90b3R5cGUuc3Vic2NyaWJlQ29yZSA9IGZ1bmN0aW9uIChvKSB7XG4gICAgICByZXR1cm4gdGhpcy5zb3VyY2Uuc3Vic2NyaWJlKG5ldyBUYWtlV2hpbGVPYnNlcnZlcihvLCB0aGlzKSk7XG4gICAgfTtcblxuICAgIHJldHVybiBUYWtlV2hpbGVPYnNlcnZhYmxlO1xuICB9KE9ic2VydmFibGVCYXNlKSk7XG5cbiAgdmFyIFRha2VXaGlsZU9ic2VydmVyID0gKGZ1bmN0aW9uIChfX3N1cGVyX18pIHtcbiAgICBpbmhlcml0cyhUYWtlV2hpbGVPYnNlcnZlciwgX19zdXBlcl9fKTtcblxuICAgIGZ1bmN0aW9uIFRha2VXaGlsZU9ic2VydmVyKG8sIHApIHtcbiAgICAgIHRoaXMuX28gPSBvO1xuICAgICAgdGhpcy5fcCA9IHA7XG4gICAgICB0aGlzLl9pID0gMDtcbiAgICAgIHRoaXMuX3IgPSB0cnVlO1xuICAgICAgX19zdXBlcl9fLmNhbGwodGhpcyk7XG4gICAgfVxuXG4gICAgVGFrZVdoaWxlT2JzZXJ2ZXIucHJvdG90eXBlLm5leHQgPSBmdW5jdGlvbiAoeCkge1xuICAgICAgaWYgKHRoaXMuX3IpIHtcbiAgICAgICAgdGhpcy5fciA9IHRyeUNhdGNoKHRoaXMuX3AuX2ZuKSh4LCB0aGlzLl9pKyssIHRoaXMuX3ApO1xuICAgICAgICBpZiAodGhpcy5fciA9PT0gZXJyb3JPYmopIHsgcmV0dXJuIHRoaXMuX28ub25FcnJvcih0aGlzLl9yLmUpOyB9XG4gICAgICB9XG4gICAgICBpZiAodGhpcy5fcikge1xuICAgICAgICB0aGlzLl9vLm9uTmV4dCh4KTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHRoaXMuX28ub25Db21wbGV0ZWQoKTtcbiAgICAgIH1cbiAgICB9O1xuICAgIFRha2VXaGlsZU9ic2VydmVyLnByb3RvdHlwZS5lcnJvciA9IGZ1bmN0aW9uIChlKSB7IHRoaXMuX28ub25FcnJvcihlKTsgfTtcbiAgICBUYWtlV2hpbGVPYnNlcnZlci5wcm90b3R5cGUuY29tcGxldGVkID0gZnVuY3Rpb24gKCkgeyB0aGlzLl9vLm9uQ29tcGxldGVkKCk7IH07XG5cbiAgICByZXR1cm4gVGFrZVdoaWxlT2JzZXJ2ZXI7XG4gIH0oQWJzdHJhY3RPYnNlcnZlcikpO1xuXG4gIC8qKlxuICAgKiAgUmV0dXJucyBlbGVtZW50cyBmcm9tIGFuIG9ic2VydmFibGUgc2VxdWVuY2UgYXMgbG9uZyBhcyBhIHNwZWNpZmllZCBjb25kaXRpb24gaXMgdHJ1ZS5cbiAgICogIFRoZSBlbGVtZW50J3MgaW5kZXggaXMgdXNlZCBpbiB0aGUgbG9naWMgb2YgdGhlIHByZWRpY2F0ZSBmdW5jdGlvbi5cbiAgICogQHBhcmFtIHtGdW5jdGlvbn0gcHJlZGljYXRlIEEgZnVuY3Rpb24gdG8gdGVzdCBlYWNoIGVsZW1lbnQgZm9yIGEgY29uZGl0aW9uOyB0aGUgc2Vjb25kIHBhcmFtZXRlciBvZiB0aGUgZnVuY3Rpb24gcmVwcmVzZW50cyB0aGUgaW5kZXggb2YgdGhlIHNvdXJjZSBlbGVtZW50LlxuICAgKiBAcGFyYW0ge0FueX0gW3RoaXNBcmddIE9iamVjdCB0byB1c2UgYXMgdGhpcyB3aGVuIGV4ZWN1dGluZyBjYWxsYmFjay5cbiAgICogQHJldHVybnMge09ic2VydmFibGV9IEFuIG9ic2VydmFibGUgc2VxdWVuY2UgdGhhdCBjb250YWlucyB0aGUgZWxlbWVudHMgZnJvbSB0aGUgaW5wdXQgc2VxdWVuY2UgdGhhdCBvY2N1ciBiZWZvcmUgdGhlIGVsZW1lbnQgYXQgd2hpY2ggdGhlIHRlc3Qgbm8gbG9uZ2VyIHBhc3Nlcy5cbiAgICovXG4gIG9ic2VydmFibGVQcm90by50YWtlV2hpbGUgPSBmdW5jdGlvbiAocHJlZGljYXRlLCB0aGlzQXJnKSB7XG4gICAgdmFyIGZuID0gYmluZENhbGxiYWNrKHByZWRpY2F0ZSwgdGhpc0FyZywgMyk7XG4gICAgcmV0dXJuIG5ldyBUYWtlV2hpbGVPYnNlcnZhYmxlKHRoaXMsIGZuKTtcbiAgfTtcblxuICB2YXIgRmlsdGVyT2JzZXJ2YWJsZSA9IChmdW5jdGlvbiAoX19zdXBlcl9fKSB7XG4gICAgaW5oZXJpdHMoRmlsdGVyT2JzZXJ2YWJsZSwgX19zdXBlcl9fKTtcblxuICAgIGZ1bmN0aW9uIEZpbHRlck9ic2VydmFibGUoc291cmNlLCBwcmVkaWNhdGUsIHRoaXNBcmcpIHtcbiAgICAgIHRoaXMuc291cmNlID0gc291cmNlO1xuICAgICAgdGhpcy5wcmVkaWNhdGUgPSBiaW5kQ2FsbGJhY2socHJlZGljYXRlLCB0aGlzQXJnLCAzKTtcbiAgICAgIF9fc3VwZXJfXy5jYWxsKHRoaXMpO1xuICAgIH1cblxuICAgIEZpbHRlck9ic2VydmFibGUucHJvdG90eXBlLnN1YnNjcmliZUNvcmUgPSBmdW5jdGlvbiAobykge1xuICAgICAgcmV0dXJuIHRoaXMuc291cmNlLnN1YnNjcmliZShuZXcgSW5uZXJPYnNlcnZlcihvLCB0aGlzLnByZWRpY2F0ZSwgdGhpcykpO1xuICAgIH07XG5cbiAgICBmdW5jdGlvbiBpbm5lclByZWRpY2F0ZShwcmVkaWNhdGUsIHNlbGYpIHtcbiAgICAgIHJldHVybiBmdW5jdGlvbih4LCBpLCBvKSB7IHJldHVybiBzZWxmLnByZWRpY2F0ZSh4LCBpLCBvKSAmJiBwcmVkaWNhdGUuY2FsbCh0aGlzLCB4LCBpLCBvKTsgfVxuICAgIH1cblxuICAgIEZpbHRlck9ic2VydmFibGUucHJvdG90eXBlLmludGVybmFsRmlsdGVyID0gZnVuY3Rpb24ocHJlZGljYXRlLCB0aGlzQXJnKSB7XG4gICAgICByZXR1cm4gbmV3IEZpbHRlck9ic2VydmFibGUodGhpcy5zb3VyY2UsIGlubmVyUHJlZGljYXRlKHByZWRpY2F0ZSwgdGhpcyksIHRoaXNBcmcpO1xuICAgIH07XG5cbiAgICBpbmhlcml0cyhJbm5lck9ic2VydmVyLCBBYnN0cmFjdE9ic2VydmVyKTtcbiAgICBmdW5jdGlvbiBJbm5lck9ic2VydmVyKG8sIHByZWRpY2F0ZSwgc291cmNlKSB7XG4gICAgICB0aGlzLm8gPSBvO1xuICAgICAgdGhpcy5wcmVkaWNhdGUgPSBwcmVkaWNhdGU7XG4gICAgICB0aGlzLnNvdXJjZSA9IHNvdXJjZTtcbiAgICAgIHRoaXMuaSA9IDA7XG4gICAgICBBYnN0cmFjdE9ic2VydmVyLmNhbGwodGhpcyk7XG4gICAgfVxuXG4gICAgSW5uZXJPYnNlcnZlci5wcm90b3R5cGUubmV4dCA9IGZ1bmN0aW9uKHgpIHtcbiAgICAgIHZhciBzaG91bGRZaWVsZCA9IHRyeUNhdGNoKHRoaXMucHJlZGljYXRlKSh4LCB0aGlzLmkrKywgdGhpcy5zb3VyY2UpO1xuICAgICAgaWYgKHNob3VsZFlpZWxkID09PSBlcnJvck9iaikge1xuICAgICAgICByZXR1cm4gdGhpcy5vLm9uRXJyb3Ioc2hvdWxkWWllbGQuZSk7XG4gICAgICB9XG4gICAgICBzaG91bGRZaWVsZCAmJiB0aGlzLm8ub25OZXh0KHgpO1xuICAgIH07XG5cbiAgICBJbm5lck9ic2VydmVyLnByb3RvdHlwZS5lcnJvciA9IGZ1bmN0aW9uIChlKSB7XG4gICAgICB0aGlzLm8ub25FcnJvcihlKTtcbiAgICB9O1xuXG4gICAgSW5uZXJPYnNlcnZlci5wcm90b3R5cGUuY29tcGxldGVkID0gZnVuY3Rpb24gKCkge1xuICAgICAgdGhpcy5vLm9uQ29tcGxldGVkKCk7XG4gICAgfTtcblxuICAgIHJldHVybiBGaWx0ZXJPYnNlcnZhYmxlO1xuXG4gIH0oT2JzZXJ2YWJsZUJhc2UpKTtcblxuICAvKipcbiAgKiAgRmlsdGVycyB0aGUgZWxlbWVudHMgb2YgYW4gb2JzZXJ2YWJsZSBzZXF1ZW5jZSBiYXNlZCBvbiBhIHByZWRpY2F0ZSBieSBpbmNvcnBvcmF0aW5nIHRoZSBlbGVtZW50J3MgaW5kZXguXG4gICogQHBhcmFtIHtGdW5jdGlvbn0gcHJlZGljYXRlIEEgZnVuY3Rpb24gdG8gdGVzdCBlYWNoIHNvdXJjZSBlbGVtZW50IGZvciBhIGNvbmRpdGlvbjsgdGhlIHNlY29uZCBwYXJhbWV0ZXIgb2YgdGhlIGZ1bmN0aW9uIHJlcHJlc2VudHMgdGhlIGluZGV4IG9mIHRoZSBzb3VyY2UgZWxlbWVudC5cbiAgKiBAcGFyYW0ge0FueX0gW3RoaXNBcmddIE9iamVjdCB0byB1c2UgYXMgdGhpcyB3aGVuIGV4ZWN1dGluZyBjYWxsYmFjay5cbiAgKiBAcmV0dXJucyB7T2JzZXJ2YWJsZX0gQW4gb2JzZXJ2YWJsZSBzZXF1ZW5jZSB0aGF0IGNvbnRhaW5zIGVsZW1lbnRzIGZyb20gdGhlIGlucHV0IHNlcXVlbmNlIHRoYXQgc2F0aXNmeSB0aGUgY29uZGl0aW9uLlxuICAqL1xuICBvYnNlcnZhYmxlUHJvdG8uZmlsdGVyID0gb2JzZXJ2YWJsZVByb3RvLndoZXJlID0gZnVuY3Rpb24gKHByZWRpY2F0ZSwgdGhpc0FyZykge1xuICAgIHJldHVybiB0aGlzIGluc3RhbmNlb2YgRmlsdGVyT2JzZXJ2YWJsZSA/IHRoaXMuaW50ZXJuYWxGaWx0ZXIocHJlZGljYXRlLCB0aGlzQXJnKSA6XG4gICAgICBuZXcgRmlsdGVyT2JzZXJ2YWJsZSh0aGlzLCBwcmVkaWNhdGUsIHRoaXNBcmcpO1xuICB9O1xuXG4gIHZhciBFeHRyZW1hQnlPYnNlcnZhYmxlID0gKGZ1bmN0aW9uIChfX3N1cGVyX18pIHtcbiAgICBpbmhlcml0cyhFeHRyZW1hQnlPYnNlcnZhYmxlLCBfX3N1cGVyX18pO1xuICAgIGZ1bmN0aW9uIEV4dHJlbWFCeU9ic2VydmFibGUoc291cmNlLCBrLCBjKSB7XG4gICAgICB0aGlzLnNvdXJjZSA9IHNvdXJjZTtcbiAgICAgIHRoaXMuX2sgPSBrO1xuICAgICAgdGhpcy5fYyA9IGM7XG4gICAgICBfX3N1cGVyX18uY2FsbCh0aGlzKTtcbiAgICB9XG5cbiAgICBFeHRyZW1hQnlPYnNlcnZhYmxlLnByb3RvdHlwZS5zdWJzY3JpYmVDb3JlID0gZnVuY3Rpb24gKG8pIHtcbiAgICAgIHJldHVybiB0aGlzLnNvdXJjZS5zdWJzY3JpYmUobmV3IEV4dHJlbWFCeU9ic2VydmVyKG8sIHRoaXMuX2ssIHRoaXMuX2MpKTtcbiAgICB9O1xuXG4gICAgcmV0dXJuIEV4dHJlbWFCeU9ic2VydmFibGU7XG4gIH0oT2JzZXJ2YWJsZUJhc2UpKTtcblxuICB2YXIgRXh0cmVtYUJ5T2JzZXJ2ZXIgPSAoZnVuY3Rpb24gKF9fc3VwZXJfXykge1xuICAgIGluaGVyaXRzKEV4dHJlbWFCeU9ic2VydmVyLCBfX3N1cGVyX18pO1xuICAgIGZ1bmN0aW9uIEV4dHJlbWFCeU9ic2VydmVyKG8sIGssIGMpIHtcbiAgICAgIHRoaXMuX28gPSBvO1xuICAgICAgdGhpcy5fayA9IGs7XG4gICAgICB0aGlzLl9jID0gYztcbiAgICAgIHRoaXMuX3YgPSBudWxsO1xuICAgICAgdGhpcy5faHYgPSBmYWxzZTtcbiAgICAgIHRoaXMuX2wgPSBbXTtcbiAgICAgIF9fc3VwZXJfXy5jYWxsKHRoaXMpO1xuICAgIH1cblxuICAgIEV4dHJlbWFCeU9ic2VydmVyLnByb3RvdHlwZS5uZXh0ID0gZnVuY3Rpb24gKHgpIHtcbiAgICAgIHZhciBrZXkgPSB0cnlDYXRjaCh0aGlzLl9rKSh4KTtcbiAgICAgIGlmIChrZXkgPT09IGVycm9yT2JqKSB7IHJldHVybiB0aGlzLl9vLm9uRXJyb3Ioa2V5LmUpOyB9XG4gICAgICB2YXIgY29tcGFyaXNvbiA9IDA7XG4gICAgICBpZiAoIXRoaXMuX2h2KSB7XG4gICAgICAgIHRoaXMuX2h2ID0gdHJ1ZTtcbiAgICAgICAgdGhpcy5fdiA9IGtleTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGNvbXBhcmlzb24gPSB0cnlDYXRjaCh0aGlzLl9jKShrZXksIHRoaXMuX3YpO1xuICAgICAgICBpZiAoY29tcGFyaXNvbiA9PT0gZXJyb3JPYmopIHsgcmV0dXJuIHRoaXMuX28ub25FcnJvcihjb21wYXJpc29uLmUpOyB9XG4gICAgICB9XG4gICAgICBpZiAoY29tcGFyaXNvbiA+IDApIHtcbiAgICAgICAgdGhpcy5fdiA9IGtleTtcbiAgICAgICAgdGhpcy5fbCA9IFtdO1xuICAgICAgfVxuICAgICAgaWYgKGNvbXBhcmlzb24gPj0gMCkgeyB0aGlzLl9sLnB1c2goeCk7IH1cbiAgICB9O1xuXG4gICAgRXh0cmVtYUJ5T2JzZXJ2ZXIucHJvdG90eXBlLmVycm9yID0gZnVuY3Rpb24gKGUpIHtcbiAgICAgIHRoaXMuX28ub25FcnJvcihlKTtcbiAgICB9O1xuXG4gICAgRXh0cmVtYUJ5T2JzZXJ2ZXIucHJvdG90eXBlLmNvbXBsZXRlZCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgIHRoaXMuX28ub25OZXh0KHRoaXMuX2wpO1xuICAgICAgdGhpcy5fby5vbkNvbXBsZXRlZCgpO1xuICAgIH07XG5cbiAgICByZXR1cm4gRXh0cmVtYUJ5T2JzZXJ2ZXI7XG4gIH0oQWJzdHJhY3RPYnNlcnZlcikpO1xuXG4gIGZ1bmN0aW9uIGZpcnN0T25seSh4KSB7XG4gICAgaWYgKHgubGVuZ3RoID09PSAwKSB7IHRocm93IG5ldyBFbXB0eUVycm9yKCk7IH1cbiAgICByZXR1cm4geFswXTtcbiAgfVxuXG4gIHZhciBSZWR1Y2VPYnNlcnZhYmxlID0gKGZ1bmN0aW9uKF9fc3VwZXJfXykge1xuICAgIGluaGVyaXRzKFJlZHVjZU9ic2VydmFibGUsIF9fc3VwZXJfXyk7XG4gICAgZnVuY3Rpb24gUmVkdWNlT2JzZXJ2YWJsZShzb3VyY2UsIGFjY3VtdWxhdG9yLCBoYXNTZWVkLCBzZWVkKSB7XG4gICAgICB0aGlzLnNvdXJjZSA9IHNvdXJjZTtcbiAgICAgIHRoaXMuYWNjdW11bGF0b3IgPSBhY2N1bXVsYXRvcjtcbiAgICAgIHRoaXMuaGFzU2VlZCA9IGhhc1NlZWQ7XG4gICAgICB0aGlzLnNlZWQgPSBzZWVkO1xuICAgICAgX19zdXBlcl9fLmNhbGwodGhpcyk7XG4gICAgfVxuXG4gICAgUmVkdWNlT2JzZXJ2YWJsZS5wcm90b3R5cGUuc3Vic2NyaWJlQ29yZSA9IGZ1bmN0aW9uKG9ic2VydmVyKSB7XG4gICAgICByZXR1cm4gdGhpcy5zb3VyY2Uuc3Vic2NyaWJlKG5ldyBSZWR1Y2VPYnNlcnZlcihvYnNlcnZlcix0aGlzKSk7XG4gICAgfTtcblxuICAgIHJldHVybiBSZWR1Y2VPYnNlcnZhYmxlO1xuICB9KE9ic2VydmFibGVCYXNlKSk7XG5cbiAgdmFyIFJlZHVjZU9ic2VydmVyID0gKGZ1bmN0aW9uIChfX3N1cGVyX18pIHtcbiAgICBpbmhlcml0cyhSZWR1Y2VPYnNlcnZlciwgX19zdXBlcl9fKTtcbiAgICBmdW5jdGlvbiBSZWR1Y2VPYnNlcnZlcihvLCBwYXJlbnQpIHtcbiAgICAgIHRoaXMuX28gPSBvO1xuICAgICAgdGhpcy5fcCA9IHBhcmVudDtcbiAgICAgIHRoaXMuX2ZuID0gcGFyZW50LmFjY3VtdWxhdG9yO1xuICAgICAgdGhpcy5faHMgPSBwYXJlbnQuaGFzU2VlZDtcbiAgICAgIHRoaXMuX3MgPSBwYXJlbnQuc2VlZDtcbiAgICAgIHRoaXMuX2hhID0gZmFsc2U7XG4gICAgICB0aGlzLl9hID0gbnVsbDtcbiAgICAgIHRoaXMuX2h2ID0gZmFsc2U7XG4gICAgICB0aGlzLl9pID0gMDtcbiAgICAgIF9fc3VwZXJfXy5jYWxsKHRoaXMpO1xuICAgIH1cblxuICAgIFJlZHVjZU9ic2VydmVyLnByb3RvdHlwZS5uZXh0ID0gZnVuY3Rpb24gKHgpIHtcbiAgICAgICF0aGlzLl9odiAmJiAodGhpcy5faHYgPSB0cnVlKTtcbiAgICAgIGlmICh0aGlzLl9oYSkge1xuICAgICAgICB0aGlzLl9hID0gdHJ5Q2F0Y2godGhpcy5fZm4pKHRoaXMuX2EsIHgsIHRoaXMuX2ksIHRoaXMuX3ApO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdGhpcy5fYSA9IHRoaXMuX2hzID8gdHJ5Q2F0Y2godGhpcy5fZm4pKHRoaXMuX3MsIHgsIHRoaXMuX2ksIHRoaXMuX3ApIDogeDtcbiAgICAgICAgdGhpcy5faGEgPSB0cnVlO1xuICAgICAgfVxuICAgICAgaWYgKHRoaXMuX2EgPT09IGVycm9yT2JqKSB7IHJldHVybiB0aGlzLl9vLm9uRXJyb3IodGhpcy5fYS5lKTsgfVxuICAgICAgdGhpcy5faSsrO1xuICAgIH07XG5cbiAgICBSZWR1Y2VPYnNlcnZlci5wcm90b3R5cGUuZXJyb3IgPSBmdW5jdGlvbiAoZSkge1xuICAgICAgdGhpcy5fby5vbkVycm9yKGUpO1xuICAgIH07XG5cbiAgICBSZWR1Y2VPYnNlcnZlci5wcm90b3R5cGUuY29tcGxldGVkID0gZnVuY3Rpb24gKCkge1xuICAgICAgdGhpcy5faHYgJiYgdGhpcy5fby5vbk5leHQodGhpcy5fYSk7XG4gICAgICAhdGhpcy5faHYgJiYgdGhpcy5faHMgJiYgdGhpcy5fby5vbk5leHQodGhpcy5fcyk7XG4gICAgICAhdGhpcy5faHYgJiYgIXRoaXMuX2hzICYmIHRoaXMuX28ub25FcnJvcihuZXcgRW1wdHlFcnJvcigpKTtcbiAgICAgIHRoaXMuX28ub25Db21wbGV0ZWQoKTtcbiAgICB9O1xuXG4gICAgcmV0dXJuIFJlZHVjZU9ic2VydmVyO1xuICB9KEFic3RyYWN0T2JzZXJ2ZXIpKTtcblxuICAvKipcbiAgKiBBcHBsaWVzIGFuIGFjY3VtdWxhdG9yIGZ1bmN0aW9uIG92ZXIgYW4gb2JzZXJ2YWJsZSBzZXF1ZW5jZSwgcmV0dXJuaW5nIHRoZSByZXN1bHQgb2YgdGhlIGFnZ3JlZ2F0aW9uIGFzIGEgc2luZ2xlIGVsZW1lbnQgaW4gdGhlIHJlc3VsdCBzZXF1ZW5jZS4gVGhlIHNwZWNpZmllZCBzZWVkIHZhbHVlIGlzIHVzZWQgYXMgdGhlIGluaXRpYWwgYWNjdW11bGF0b3IgdmFsdWUuXG4gICogRm9yIGFnZ3JlZ2F0aW9uIGJlaGF2aW9yIHdpdGggaW5jcmVtZW50YWwgaW50ZXJtZWRpYXRlIHJlc3VsdHMsIHNlZSBPYnNlcnZhYmxlLnNjYW4uXG4gICogQHBhcmFtIHtGdW5jdGlvbn0gYWNjdW11bGF0b3IgQW4gYWNjdW11bGF0b3IgZnVuY3Rpb24gdG8gYmUgaW52b2tlZCBvbiBlYWNoIGVsZW1lbnQuXG4gICogQHBhcmFtIHtBbnl9IFtzZWVkXSBUaGUgaW5pdGlhbCBhY2N1bXVsYXRvciB2YWx1ZS5cbiAgKiBAcmV0dXJucyB7T2JzZXJ2YWJsZX0gQW4gb2JzZXJ2YWJsZSBzZXF1ZW5jZSBjb250YWluaW5nIGEgc2luZ2xlIGVsZW1lbnQgd2l0aCB0aGUgZmluYWwgYWNjdW11bGF0b3IgdmFsdWUuXG4gICovXG4gIG9ic2VydmFibGVQcm90by5yZWR1Y2UgPSBmdW5jdGlvbiAoKSB7XG4gICAgdmFyIGhhc1NlZWQgPSBmYWxzZSwgc2VlZCwgYWNjdW11bGF0b3IgPSBhcmd1bWVudHNbMF07XG4gICAgaWYgKGFyZ3VtZW50cy5sZW5ndGggPT09IDIpIHtcbiAgICAgIGhhc1NlZWQgPSB0cnVlO1xuICAgICAgc2VlZCA9IGFyZ3VtZW50c1sxXTtcbiAgICB9XG4gICAgcmV0dXJuIG5ldyBSZWR1Y2VPYnNlcnZhYmxlKHRoaXMsIGFjY3VtdWxhdG9yLCBoYXNTZWVkLCBzZWVkKTtcbiAgfTtcblxuICB2YXIgU29tZU9ic2VydmFibGUgPSAoZnVuY3Rpb24gKF9fc3VwZXJfXykge1xuICAgIGluaGVyaXRzKFNvbWVPYnNlcnZhYmxlLCBfX3N1cGVyX18pO1xuICAgIGZ1bmN0aW9uIFNvbWVPYnNlcnZhYmxlKHNvdXJjZSwgZm4pIHtcbiAgICAgIHRoaXMuc291cmNlID0gc291cmNlO1xuICAgICAgdGhpcy5fZm4gPSBmbjtcbiAgICAgIF9fc3VwZXJfXy5jYWxsKHRoaXMpO1xuICAgIH1cblxuICAgIFNvbWVPYnNlcnZhYmxlLnByb3RvdHlwZS5zdWJzY3JpYmVDb3JlID0gZnVuY3Rpb24gKG8pIHtcbiAgICAgIHJldHVybiB0aGlzLnNvdXJjZS5zdWJzY3JpYmUobmV3IFNvbWVPYnNlcnZlcihvLCB0aGlzLl9mbiwgdGhpcy5zb3VyY2UpKTtcbiAgICB9O1xuXG4gICAgcmV0dXJuIFNvbWVPYnNlcnZhYmxlO1xuICB9KE9ic2VydmFibGVCYXNlKSk7XG5cbiAgdmFyIFNvbWVPYnNlcnZlciA9IChmdW5jdGlvbiAoX19zdXBlcl9fKSB7XG4gICAgaW5oZXJpdHMoU29tZU9ic2VydmVyLCBfX3N1cGVyX18pO1xuXG4gICAgZnVuY3Rpb24gU29tZU9ic2VydmVyKG8sIGZuLCBzKSB7XG4gICAgICB0aGlzLl9vID0gbztcbiAgICAgIHRoaXMuX2ZuID0gZm47XG4gICAgICB0aGlzLl9zID0gcztcbiAgICAgIHRoaXMuX2kgPSAwO1xuICAgICAgX19zdXBlcl9fLmNhbGwodGhpcyk7XG4gICAgfVxuXG4gICAgU29tZU9ic2VydmVyLnByb3RvdHlwZS5uZXh0ID0gZnVuY3Rpb24gKHgpIHtcbiAgICAgIHZhciByZXN1bHQgPSB0cnlDYXRjaCh0aGlzLl9mbikoeCwgdGhpcy5faSsrLCB0aGlzLl9zKTtcbiAgICAgIGlmIChyZXN1bHQgPT09IGVycm9yT2JqKSB7IHJldHVybiB0aGlzLl9vLm9uRXJyb3IocmVzdWx0LmUpOyB9XG4gICAgICBpZiAoQm9vbGVhbihyZXN1bHQpKSB7XG4gICAgICAgIHRoaXMuX28ub25OZXh0KHRydWUpO1xuICAgICAgICB0aGlzLl9vLm9uQ29tcGxldGVkKCk7XG4gICAgICB9XG4gICAgfTtcbiAgICBTb21lT2JzZXJ2ZXIucHJvdG90eXBlLmVycm9yID0gZnVuY3Rpb24gKGUpIHsgdGhpcy5fby5vbkVycm9yKGUpOyB9O1xuICAgIFNvbWVPYnNlcnZlci5wcm90b3R5cGUuY29tcGxldGVkID0gZnVuY3Rpb24gKCkge1xuICAgICAgdGhpcy5fby5vbk5leHQoZmFsc2UpO1xuICAgICAgdGhpcy5fby5vbkNvbXBsZXRlZCgpO1xuICAgIH07XG5cbiAgICByZXR1cm4gU29tZU9ic2VydmVyO1xuICB9KEFic3RyYWN0T2JzZXJ2ZXIpKTtcblxuICAvKipcbiAgICogRGV0ZXJtaW5lcyB3aGV0aGVyIGFueSBlbGVtZW50IG9mIGFuIG9ic2VydmFibGUgc2VxdWVuY2Ugc2F0aXNmaWVzIGEgY29uZGl0aW9uIGlmIHByZXNlbnQsIGVsc2UgaWYgYW55IGl0ZW1zIGFyZSBpbiB0aGUgc2VxdWVuY2UuXG4gICAqIEBwYXJhbSB7RnVuY3Rpb259IFtwcmVkaWNhdGVdIEEgZnVuY3Rpb24gdG8gdGVzdCBlYWNoIGVsZW1lbnQgZm9yIGEgY29uZGl0aW9uLlxuICAgKiBAcmV0dXJucyB7T2JzZXJ2YWJsZX0gQW4gb2JzZXJ2YWJsZSBzZXF1ZW5jZSBjb250YWluaW5nIGEgc2luZ2xlIGVsZW1lbnQgZGV0ZXJtaW5pbmcgd2hldGhlciBhbnkgZWxlbWVudHMgaW4gdGhlIHNvdXJjZSBzZXF1ZW5jZSBwYXNzIHRoZSB0ZXN0IGluIHRoZSBzcGVjaWZpZWQgcHJlZGljYXRlIGlmIGdpdmVuLCBlbHNlIGlmIGFueSBpdGVtcyBhcmUgaW4gdGhlIHNlcXVlbmNlLlxuICAgKi9cbiAgb2JzZXJ2YWJsZVByb3RvLnNvbWUgPSBmdW5jdGlvbiAocHJlZGljYXRlLCB0aGlzQXJnKSB7XG4gICAgdmFyIGZuID0gYmluZENhbGxiYWNrKHByZWRpY2F0ZSwgdGhpc0FyZywgMyk7XG4gICAgcmV0dXJuIG5ldyBTb21lT2JzZXJ2YWJsZSh0aGlzLCBmbik7XG4gIH07XG5cbiAgdmFyIElzRW1wdHlPYnNlcnZhYmxlID0gKGZ1bmN0aW9uIChfX3N1cGVyX18pIHtcbiAgICBpbmhlcml0cyhJc0VtcHR5T2JzZXJ2YWJsZSwgX19zdXBlcl9fKTtcbiAgICBmdW5jdGlvbiBJc0VtcHR5T2JzZXJ2YWJsZShzb3VyY2UpIHtcbiAgICAgIHRoaXMuc291cmNlID0gc291cmNlO1xuICAgICAgX19zdXBlcl9fLmNhbGwodGhpcyk7XG4gICAgfVxuXG4gICAgSXNFbXB0eU9ic2VydmFibGUucHJvdG90eXBlLnN1YnNjcmliZUNvcmUgPSBmdW5jdGlvbiAobykge1xuICAgICAgcmV0dXJuIHRoaXMuc291cmNlLnN1YnNjcmliZShuZXcgSXNFbXB0eU9ic2VydmVyKG8pKTtcbiAgICB9O1xuXG4gICAgcmV0dXJuIElzRW1wdHlPYnNlcnZhYmxlO1xuICB9KE9ic2VydmFibGVCYXNlKSk7XG5cbiAgdmFyIElzRW1wdHlPYnNlcnZlciA9IChmdW5jdGlvbihfX3N1cGVyX18pIHtcbiAgICBpbmhlcml0cyhJc0VtcHR5T2JzZXJ2ZXIsIF9fc3VwZXJfXyk7XG4gICAgZnVuY3Rpb24gSXNFbXB0eU9ic2VydmVyKG8pIHtcbiAgICAgIHRoaXMuX28gPSBvO1xuICAgICAgX19zdXBlcl9fLmNhbGwodGhpcyk7XG4gICAgfVxuXG4gICAgSXNFbXB0eU9ic2VydmVyLnByb3RvdHlwZS5uZXh0ID0gZnVuY3Rpb24gKCkge1xuICAgICAgdGhpcy5fby5vbk5leHQoZmFsc2UpO1xuICAgICAgdGhpcy5fby5vbkNvbXBsZXRlZCgpO1xuICAgIH07XG4gICAgSXNFbXB0eU9ic2VydmVyLnByb3RvdHlwZS5lcnJvciA9IGZ1bmN0aW9uIChlKSB7IHRoaXMuX28ub25FcnJvcihlKTsgfTtcbiAgICBJc0VtcHR5T2JzZXJ2ZXIucHJvdG90eXBlLmNvbXBsZXRlZCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgIHRoaXMuX28ub25OZXh0KHRydWUpO1xuICAgICAgdGhpcy5fby5vbkNvbXBsZXRlZCgpO1xuICAgIH07XG5cbiAgICByZXR1cm4gSXNFbXB0eU9ic2VydmVyO1xuICB9KEFic3RyYWN0T2JzZXJ2ZXIpKTtcblxuICAvKipcbiAgICogRGV0ZXJtaW5lcyB3aGV0aGVyIGFuIG9ic2VydmFibGUgc2VxdWVuY2UgaXMgZW1wdHkuXG4gICAqIEByZXR1cm5zIHtPYnNlcnZhYmxlfSBBbiBvYnNlcnZhYmxlIHNlcXVlbmNlIGNvbnRhaW5pbmcgYSBzaW5nbGUgZWxlbWVudCBkZXRlcm1pbmluZyB3aGV0aGVyIHRoZSBzb3VyY2Ugc2VxdWVuY2UgaXMgZW1wdHkuXG4gICAqL1xuICBvYnNlcnZhYmxlUHJvdG8uaXNFbXB0eSA9IGZ1bmN0aW9uICgpIHtcbiAgICByZXR1cm4gbmV3IElzRW1wdHlPYnNlcnZhYmxlKHRoaXMpO1xuICB9O1xuXG4gIHZhciBFdmVyeU9ic2VydmFibGUgPSAoZnVuY3Rpb24gKF9fc3VwZXJfXykge1xuICAgIGluaGVyaXRzKEV2ZXJ5T2JzZXJ2YWJsZSwgX19zdXBlcl9fKTtcbiAgICBmdW5jdGlvbiBFdmVyeU9ic2VydmFibGUoc291cmNlLCBmbikge1xuICAgICAgdGhpcy5zb3VyY2UgPSBzb3VyY2U7XG4gICAgICB0aGlzLl9mbiA9IGZuO1xuICAgICAgX19zdXBlcl9fLmNhbGwodGhpcyk7XG4gICAgfVxuXG4gICAgRXZlcnlPYnNlcnZhYmxlLnByb3RvdHlwZS5zdWJzY3JpYmVDb3JlID0gZnVuY3Rpb24gKG8pIHtcbiAgICAgIHJldHVybiB0aGlzLnNvdXJjZS5zdWJzY3JpYmUobmV3IEV2ZXJ5T2JzZXJ2ZXIobywgdGhpcy5fZm4sIHRoaXMuc291cmNlKSk7XG4gICAgfTtcblxuICAgIHJldHVybiBFdmVyeU9ic2VydmFibGU7XG4gIH0oT2JzZXJ2YWJsZUJhc2UpKTtcblxuICB2YXIgRXZlcnlPYnNlcnZlciA9IChmdW5jdGlvbiAoX19zdXBlcl9fKSB7XG4gICAgaW5oZXJpdHMoRXZlcnlPYnNlcnZlciwgX19zdXBlcl9fKTtcblxuICAgIGZ1bmN0aW9uIEV2ZXJ5T2JzZXJ2ZXIobywgZm4sIHMpIHtcbiAgICAgIHRoaXMuX28gPSBvO1xuICAgICAgdGhpcy5fZm4gPSBmbjtcbiAgICAgIHRoaXMuX3MgPSBzO1xuICAgICAgdGhpcy5faSA9IDA7XG4gICAgICBfX3N1cGVyX18uY2FsbCh0aGlzKTtcbiAgICB9XG5cbiAgICBFdmVyeU9ic2VydmVyLnByb3RvdHlwZS5uZXh0ID0gZnVuY3Rpb24gKHgpIHtcbiAgICAgIHZhciByZXN1bHQgPSB0cnlDYXRjaCh0aGlzLl9mbikoeCwgdGhpcy5faSsrLCB0aGlzLl9zKTtcbiAgICAgIGlmIChyZXN1bHQgPT09IGVycm9yT2JqKSB7IHJldHVybiB0aGlzLl9vLm9uRXJyb3IocmVzdWx0LmUpOyB9XG4gICAgICBpZiAoIUJvb2xlYW4ocmVzdWx0KSkge1xuICAgICAgICB0aGlzLl9vLm9uTmV4dChmYWxzZSk7XG4gICAgICAgIHRoaXMuX28ub25Db21wbGV0ZWQoKTtcbiAgICAgIH1cbiAgICB9O1xuICAgIEV2ZXJ5T2JzZXJ2ZXIucHJvdG90eXBlLmVycm9yID0gZnVuY3Rpb24gKGUpIHsgdGhpcy5fby5vbkVycm9yKGUpOyB9O1xuICAgIEV2ZXJ5T2JzZXJ2ZXIucHJvdG90eXBlLmNvbXBsZXRlZCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgIHRoaXMuX28ub25OZXh0KHRydWUpO1xuICAgICAgdGhpcy5fby5vbkNvbXBsZXRlZCgpO1xuICAgIH07XG5cbiAgICByZXR1cm4gRXZlcnlPYnNlcnZlcjtcbiAgfShBYnN0cmFjdE9ic2VydmVyKSk7XG5cbiAgLyoqXG4gICAqIERldGVybWluZXMgd2hldGhlciBhbGwgZWxlbWVudHMgb2YgYW4gb2JzZXJ2YWJsZSBzZXF1ZW5jZSBzYXRpc2Z5IGEgY29uZGl0aW9uLlxuICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBbcHJlZGljYXRlXSBBIGZ1bmN0aW9uIHRvIHRlc3QgZWFjaCBlbGVtZW50IGZvciBhIGNvbmRpdGlvbi5cbiAgICogQHBhcmFtIHtBbnl9IFt0aGlzQXJnXSBPYmplY3QgdG8gdXNlIGFzIHRoaXMgd2hlbiBleGVjdXRpbmcgY2FsbGJhY2suXG4gICAqIEByZXR1cm5zIHtPYnNlcnZhYmxlfSBBbiBvYnNlcnZhYmxlIHNlcXVlbmNlIGNvbnRhaW5pbmcgYSBzaW5nbGUgZWxlbWVudCBkZXRlcm1pbmluZyB3aGV0aGVyIGFsbCBlbGVtZW50cyBpbiB0aGUgc291cmNlIHNlcXVlbmNlIHBhc3MgdGhlIHRlc3QgaW4gdGhlIHNwZWNpZmllZCBwcmVkaWNhdGUuXG4gICAqL1xuICBvYnNlcnZhYmxlUHJvdG8uZXZlcnkgPSBmdW5jdGlvbiAocHJlZGljYXRlLCB0aGlzQXJnKSB7XG4gICAgdmFyIGZuID0gYmluZENhbGxiYWNrKHByZWRpY2F0ZSwgdGhpc0FyZywgMyk7XG4gICAgcmV0dXJuIG5ldyBFdmVyeU9ic2VydmFibGUodGhpcywgZm4pO1xuICB9O1xuXG4gIHZhciBJbmNsdWRlc09ic2VydmFibGUgPSAoZnVuY3Rpb24gKF9fc3VwZXJfXykge1xuICAgIGluaGVyaXRzKEluY2x1ZGVzT2JzZXJ2YWJsZSwgX19zdXBlcl9fKTtcbiAgICBmdW5jdGlvbiBJbmNsdWRlc09ic2VydmFibGUoc291cmNlLCBlbGVtLCBpZHgpIHtcbiAgICAgIHZhciBuID0gK2lkeCB8fCAwO1xuICAgICAgTWF0aC5hYnMobikgPT09IEluZmluaXR5ICYmIChuID0gMCk7XG5cbiAgICAgIHRoaXMuc291cmNlID0gc291cmNlO1xuICAgICAgdGhpcy5fZWxlbSA9IGVsZW07XG4gICAgICB0aGlzLl9uID0gbjtcbiAgICAgIF9fc3VwZXJfXy5jYWxsKHRoaXMpO1xuICAgIH1cblxuICAgIEluY2x1ZGVzT2JzZXJ2YWJsZS5wcm90b3R5cGUuc3Vic2NyaWJlQ29yZSA9IGZ1bmN0aW9uIChvKSB7XG4gICAgICBpZiAodGhpcy5fbiA8IDApIHtcbiAgICAgICAgby5vbk5leHQoZmFsc2UpO1xuICAgICAgICBvLm9uQ29tcGxldGVkKCk7XG4gICAgICAgIHJldHVybiBkaXNwb3NhYmxlRW1wdHk7XG4gICAgICB9XG5cbiAgICAgIHJldHVybiB0aGlzLnNvdXJjZS5zdWJzY3JpYmUobmV3IEluY2x1ZGVzT2JzZXJ2ZXIobywgdGhpcy5fZWxlbSwgdGhpcy5fbikpO1xuICAgIH07XG5cbiAgICByZXR1cm4gSW5jbHVkZXNPYnNlcnZhYmxlO1xuICB9KE9ic2VydmFibGVCYXNlKSk7XG5cbiAgdmFyIEluY2x1ZGVzT2JzZXJ2ZXIgPSAoZnVuY3Rpb24gKF9fc3VwZXJfXykge1xuICAgIGluaGVyaXRzKEluY2x1ZGVzT2JzZXJ2ZXIsIF9fc3VwZXJfXyk7XG4gICAgZnVuY3Rpb24gSW5jbHVkZXNPYnNlcnZlcihvLCBlbGVtLCBuKSB7XG4gICAgICB0aGlzLl9vID0gbztcbiAgICAgIHRoaXMuX2VsZW0gPSBlbGVtO1xuICAgICAgdGhpcy5fbiA9IG47XG4gICAgICB0aGlzLl9pID0gMDtcbiAgICAgIF9fc3VwZXJfXy5jYWxsKHRoaXMpO1xuICAgIH1cblxuICAgIGZ1bmN0aW9uIGNvbXBhcmVyKGEsIGIpIHtcbiAgICAgIHJldHVybiAoYSA9PT0gMCAmJiBiID09PSAwKSB8fCAoYSA9PT0gYiB8fCAoaXNOYU4oYSkgJiYgaXNOYU4oYikpKTtcbiAgICB9XG5cbiAgICBJbmNsdWRlc09ic2VydmVyLnByb3RvdHlwZS5uZXh0ID0gZnVuY3Rpb24gKHgpIHtcbiAgICAgIGlmICh0aGlzLl9pKysgPj0gdGhpcy5fbiAmJiBjb21wYXJlcih4LCB0aGlzLl9lbGVtKSkge1xuICAgICAgICB0aGlzLl9vLm9uTmV4dCh0cnVlKTtcbiAgICAgICAgdGhpcy5fby5vbkNvbXBsZXRlZCgpO1xuICAgICAgfVxuICAgIH07XG4gICAgSW5jbHVkZXNPYnNlcnZlci5wcm90b3R5cGUuZXJyb3IgPSBmdW5jdGlvbiAoZSkgeyB0aGlzLl9vLm9uRXJyb3IoZSk7IH07XG4gICAgSW5jbHVkZXNPYnNlcnZlci5wcm90b3R5cGUuY29tcGxldGVkID0gZnVuY3Rpb24gKCkgeyB0aGlzLl9vLm9uTmV4dChmYWxzZSk7IHRoaXMuX28ub25Db21wbGV0ZWQoKTsgfTtcblxuICAgIHJldHVybiBJbmNsdWRlc09ic2VydmVyO1xuICB9KEFic3RyYWN0T2JzZXJ2ZXIpKTtcblxuICAvKipcbiAgICogRGV0ZXJtaW5lcyB3aGV0aGVyIGFuIG9ic2VydmFibGUgc2VxdWVuY2UgaW5jbHVkZXMgYSBzcGVjaWZpZWQgZWxlbWVudCB3aXRoIGFuIG9wdGlvbmFsIGVxdWFsaXR5IGNvbXBhcmVyLlxuICAgKiBAcGFyYW0gc2VhcmNoRWxlbWVudCBUaGUgdmFsdWUgdG8gbG9jYXRlIGluIHRoZSBzb3VyY2Ugc2VxdWVuY2UuXG4gICAqIEBwYXJhbSB7TnVtYmVyfSBbZnJvbUluZGV4XSBBbiBlcXVhbGl0eSBjb21wYXJlciB0byBjb21wYXJlIGVsZW1lbnRzLlxuICAgKiBAcmV0dXJucyB7T2JzZXJ2YWJsZX0gQW4gb2JzZXJ2YWJsZSBzZXF1ZW5jZSBjb250YWluaW5nIGEgc2luZ2xlIGVsZW1lbnQgZGV0ZXJtaW5pbmcgd2hldGhlciB0aGUgc291cmNlIHNlcXVlbmNlIGluY2x1ZGVzIGFuIGVsZW1lbnQgdGhhdCBoYXMgdGhlIHNwZWNpZmllZCB2YWx1ZSBmcm9tIHRoZSBnaXZlbiBpbmRleC5cbiAgICovXG4gIG9ic2VydmFibGVQcm90by5pbmNsdWRlcyA9IGZ1bmN0aW9uIChzZWFyY2hFbGVtZW50LCBmcm9tSW5kZXgpIHtcbiAgICByZXR1cm4gbmV3IEluY2x1ZGVzT2JzZXJ2YWJsZSh0aGlzLCBzZWFyY2hFbGVtZW50LCBmcm9tSW5kZXgpO1xuICB9O1xuXG4gIHZhciBDb3VudE9ic2VydmFibGUgPSAoZnVuY3Rpb24gKF9fc3VwZXJfXykge1xuICAgIGluaGVyaXRzKENvdW50T2JzZXJ2YWJsZSwgX19zdXBlcl9fKTtcbiAgICBmdW5jdGlvbiBDb3VudE9ic2VydmFibGUoc291cmNlLCBmbikge1xuICAgICAgdGhpcy5zb3VyY2UgPSBzb3VyY2U7XG4gICAgICB0aGlzLl9mbiA9IGZuO1xuICAgICAgX19zdXBlcl9fLmNhbGwodGhpcyk7XG4gICAgfVxuXG4gICAgQ291bnRPYnNlcnZhYmxlLnByb3RvdHlwZS5zdWJzY3JpYmVDb3JlID0gZnVuY3Rpb24gKG8pIHtcbiAgICAgIHJldHVybiB0aGlzLnNvdXJjZS5zdWJzY3JpYmUobmV3IENvdW50T2JzZXJ2ZXIobywgdGhpcy5fZm4sIHRoaXMuc291cmNlKSk7XG4gICAgfTtcblxuICAgIHJldHVybiBDb3VudE9ic2VydmFibGU7XG4gIH0oT2JzZXJ2YWJsZUJhc2UpKTtcblxuICB2YXIgQ291bnRPYnNlcnZlciA9IChmdW5jdGlvbiAoX19zdXBlcl9fKSB7XG4gICAgaW5oZXJpdHMoQ291bnRPYnNlcnZlciwgX19zdXBlcl9fKTtcblxuICAgIGZ1bmN0aW9uIENvdW50T2JzZXJ2ZXIobywgZm4sIHMpIHtcbiAgICAgIHRoaXMuX28gPSBvO1xuICAgICAgdGhpcy5fZm4gPSBmbjtcbiAgICAgIHRoaXMuX3MgPSBzO1xuICAgICAgdGhpcy5faSA9IDA7XG4gICAgICB0aGlzLl9jID0gMDtcbiAgICAgIF9fc3VwZXJfXy5jYWxsKHRoaXMpO1xuICAgIH1cblxuICAgIENvdW50T2JzZXJ2ZXIucHJvdG90eXBlLm5leHQgPSBmdW5jdGlvbiAoeCkge1xuICAgICAgaWYgKHRoaXMuX2ZuKSB7XG4gICAgICAgIHZhciByZXN1bHQgPSB0cnlDYXRjaCh0aGlzLl9mbikoeCwgdGhpcy5faSsrLCB0aGlzLl9zKTtcbiAgICAgICAgaWYgKHJlc3VsdCA9PT0gZXJyb3JPYmopIHsgcmV0dXJuIHRoaXMuX28ub25FcnJvcihyZXN1bHQuZSk7IH1cbiAgICAgICAgQm9vbGVhbihyZXN1bHQpICYmICh0aGlzLl9jKyspO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdGhpcy5fYysrO1xuICAgICAgfVxuICAgIH07XG4gICAgQ291bnRPYnNlcnZlci5wcm90b3R5cGUuZXJyb3IgPSBmdW5jdGlvbiAoZSkgeyB0aGlzLl9vLm9uRXJyb3IoZSk7IH07XG4gICAgQ291bnRPYnNlcnZlci5wcm90b3R5cGUuY29tcGxldGVkID0gZnVuY3Rpb24gKCkge1xuICAgICAgdGhpcy5fby5vbk5leHQodGhpcy5fYyk7XG4gICAgICB0aGlzLl9vLm9uQ29tcGxldGVkKCk7XG4gICAgfTtcblxuICAgIHJldHVybiBDb3VudE9ic2VydmVyO1xuICB9KEFic3RyYWN0T2JzZXJ2ZXIpKTtcblxuICAvKipcbiAgICogUmV0dXJucyBhbiBvYnNlcnZhYmxlIHNlcXVlbmNlIGNvbnRhaW5pbmcgYSB2YWx1ZSB0aGF0IHJlcHJlc2VudHMgaG93IG1hbnkgZWxlbWVudHMgaW4gdGhlIHNwZWNpZmllZCBvYnNlcnZhYmxlIHNlcXVlbmNlIHNhdGlzZnkgYSBjb25kaXRpb24gaWYgcHJvdmlkZWQsIGVsc2UgdGhlIGNvdW50IG9mIGl0ZW1zLlxuICAgKiBAZXhhbXBsZVxuICAgKiByZXMgPSBzb3VyY2UuY291bnQoKTtcbiAgICogcmVzID0gc291cmNlLmNvdW50KGZ1bmN0aW9uICh4KSB7IHJldHVybiB4ID4gMzsgfSk7XG4gICAqIEBwYXJhbSB7RnVuY3Rpb259IFtwcmVkaWNhdGVdQSBmdW5jdGlvbiB0byB0ZXN0IGVhY2ggZWxlbWVudCBmb3IgYSBjb25kaXRpb24uXG4gICAqIEBwYXJhbSB7QW55fSBbdGhpc0FyZ10gT2JqZWN0IHRvIHVzZSBhcyB0aGlzIHdoZW4gZXhlY3V0aW5nIGNhbGxiYWNrLlxuICAgKiBAcmV0dXJucyB7T2JzZXJ2YWJsZX0gQW4gb2JzZXJ2YWJsZSBzZXF1ZW5jZSBjb250YWluaW5nIGEgc2luZ2xlIGVsZW1lbnQgd2l0aCBhIG51bWJlciB0aGF0IHJlcHJlc2VudHMgaG93IG1hbnkgZWxlbWVudHMgaW4gdGhlIGlucHV0IHNlcXVlbmNlIHNhdGlzZnkgdGhlIGNvbmRpdGlvbiBpbiB0aGUgcHJlZGljYXRlIGZ1bmN0aW9uIGlmIHByb3ZpZGVkLCBlbHNlIHRoZSBjb3VudCBvZiBpdGVtcyBpbiB0aGUgc2VxdWVuY2UuXG4gICAqL1xuICBvYnNlcnZhYmxlUHJvdG8uY291bnQgPSBmdW5jdGlvbiAocHJlZGljYXRlLCB0aGlzQXJnKSB7XG4gICAgdmFyIGZuID0gYmluZENhbGxiYWNrKHByZWRpY2F0ZSwgdGhpc0FyZywgMyk7XG4gICAgcmV0dXJuIG5ldyBDb3VudE9ic2VydmFibGUodGhpcywgZm4pO1xuICB9O1xuXG4gIHZhciBJbmRleE9mT2JzZXJ2YWJsZSA9IChmdW5jdGlvbiAoX19zdXBlcl9fKSB7XG4gICAgaW5oZXJpdHMoSW5kZXhPZk9ic2VydmFibGUsIF9fc3VwZXJfXyk7XG4gICAgZnVuY3Rpb24gSW5kZXhPZk9ic2VydmFibGUoc291cmNlLCBlLCBuKSB7XG4gICAgICB0aGlzLnNvdXJjZSA9IHNvdXJjZTtcbiAgICAgIHRoaXMuX2UgPSBlO1xuICAgICAgdGhpcy5fbiA9IG47XG4gICAgICBfX3N1cGVyX18uY2FsbCh0aGlzKTtcbiAgICB9XG5cbiAgICBJbmRleE9mT2JzZXJ2YWJsZS5wcm90b3R5cGUuc3Vic2NyaWJlQ29yZSA9IGZ1bmN0aW9uIChvKSB7XG4gICAgICBpZiAodGhpcy5fbiA8IDApIHtcbiAgICAgICAgby5vbk5leHQoLTEpO1xuICAgICAgICBvLm9uQ29tcGxldGVkKCk7XG4gICAgICAgIHJldHVybiBkaXNwb3NhYmxlRW1wdHk7XG4gICAgICB9XG5cbiAgICAgIHJldHVybiB0aGlzLnNvdXJjZS5zdWJzY3JpYmUobmV3IEluZGV4T2ZPYnNlcnZlcihvLCB0aGlzLl9lLCB0aGlzLl9uKSk7XG4gICAgfTtcblxuICAgIHJldHVybiBJbmRleE9mT2JzZXJ2YWJsZTtcbiAgfShPYnNlcnZhYmxlQmFzZSkpO1xuXG4gIHZhciBJbmRleE9mT2JzZXJ2ZXIgPSAoZnVuY3Rpb24gKF9fc3VwZXJfXykge1xuICAgIGluaGVyaXRzKEluZGV4T2ZPYnNlcnZlciwgX19zdXBlcl9fKTtcbiAgICBmdW5jdGlvbiBJbmRleE9mT2JzZXJ2ZXIobywgZSwgbikge1xuICAgICAgdGhpcy5fbyA9IG87XG4gICAgICB0aGlzLl9lID0gZTtcbiAgICAgIHRoaXMuX24gPSBuO1xuICAgICAgdGhpcy5faSA9IDA7XG4gICAgICBfX3N1cGVyX18uY2FsbCh0aGlzKTtcbiAgICB9XG5cbiAgICBJbmRleE9mT2JzZXJ2ZXIucHJvdG90eXBlLm5leHQgPSBmdW5jdGlvbiAoeCkge1xuICAgICAgaWYgKHRoaXMuX2kgPj0gdGhpcy5fbiAmJiB4ID09PSB0aGlzLl9lKSB7XG4gICAgICAgIHRoaXMuX28ub25OZXh0KHRoaXMuX2kpO1xuICAgICAgICB0aGlzLl9vLm9uQ29tcGxldGVkKCk7XG4gICAgICB9XG4gICAgICB0aGlzLl9pKys7XG4gICAgfTtcbiAgICBJbmRleE9mT2JzZXJ2ZXIucHJvdG90eXBlLmVycm9yID0gZnVuY3Rpb24gKGUpIHsgdGhpcy5fby5vbkVycm9yKGUpOyB9O1xuICAgIEluZGV4T2ZPYnNlcnZlci5wcm90b3R5cGUuY29tcGxldGVkID0gZnVuY3Rpb24gKCkgeyB0aGlzLl9vLm9uTmV4dCgtMSk7IHRoaXMuX28ub25Db21wbGV0ZWQoKTsgfTtcblxuICAgIHJldHVybiBJbmRleE9mT2JzZXJ2ZXI7XG4gIH0oQWJzdHJhY3RPYnNlcnZlcikpO1xuXG4gIC8qKlxuICAgKiBSZXR1cm5zIHRoZSBmaXJzdCBpbmRleCBhdCB3aGljaCBhIGdpdmVuIGVsZW1lbnQgY2FuIGJlIGZvdW5kIGluIHRoZSBvYnNlcnZhYmxlIHNlcXVlbmNlLCBvciAtMSBpZiBpdCBpcyBub3QgcHJlc2VudC5cbiAgICogQHBhcmFtIHtBbnl9IHNlYXJjaEVsZW1lbnQgRWxlbWVudCB0byBsb2NhdGUgaW4gdGhlIGFycmF5LlxuICAgKiBAcGFyYW0ge051bWJlcn0gW2Zyb21JbmRleF0gVGhlIGluZGV4IHRvIHN0YXJ0IHRoZSBzZWFyY2guICBJZiBub3Qgc3BlY2lmaWVkLCBkZWZhdWx0cyB0byAwLlxuICAgKiBAcmV0dXJucyB7T2JzZXJ2YWJsZX0gQW5kIG9ic2VydmFibGUgc2VxdWVuY2UgY29udGFpbmluZyB0aGUgZmlyc3QgaW5kZXggYXQgd2hpY2ggYSBnaXZlbiBlbGVtZW50IGNhbiBiZSBmb3VuZCBpbiB0aGUgb2JzZXJ2YWJsZSBzZXF1ZW5jZSwgb3IgLTEgaWYgaXQgaXMgbm90IHByZXNlbnQuXG4gICAqL1xuICBvYnNlcnZhYmxlUHJvdG8uaW5kZXhPZiA9IGZ1bmN0aW9uKHNlYXJjaEVsZW1lbnQsIGZyb21JbmRleCkge1xuICAgIHZhciBuID0gK2Zyb21JbmRleCB8fCAwO1xuICAgIE1hdGguYWJzKG4pID09PSBJbmZpbml0eSAmJiAobiA9IDApO1xuICAgIHJldHVybiBuZXcgSW5kZXhPZk9ic2VydmFibGUodGhpcywgc2VhcmNoRWxlbWVudCwgbik7XG4gIH07XG5cbiAgdmFyIFN1bU9ic2VydmFibGUgPSAoZnVuY3Rpb24gKF9fc3VwZXJfXykge1xuICAgIGluaGVyaXRzKFN1bU9ic2VydmFibGUsIF9fc3VwZXJfXyk7XG4gICAgZnVuY3Rpb24gU3VtT2JzZXJ2YWJsZShzb3VyY2UsIGZuKSB7XG4gICAgICB0aGlzLnNvdXJjZSA9IHNvdXJjZTtcbiAgICAgIHRoaXMuX2ZuID0gZm47XG4gICAgICBfX3N1cGVyX18uY2FsbCh0aGlzKTtcbiAgICB9XG5cbiAgICBTdW1PYnNlcnZhYmxlLnByb3RvdHlwZS5zdWJzY3JpYmVDb3JlID0gZnVuY3Rpb24gKG8pIHtcbiAgICAgIHJldHVybiB0aGlzLnNvdXJjZS5zdWJzY3JpYmUobmV3IFN1bU9ic2VydmVyKG8sIHRoaXMuX2ZuLCB0aGlzLnNvdXJjZSkpO1xuICAgIH07XG5cbiAgICByZXR1cm4gU3VtT2JzZXJ2YWJsZTtcbiAgfShPYnNlcnZhYmxlQmFzZSkpO1xuXG4gIHZhciBTdW1PYnNlcnZlciA9IChmdW5jdGlvbiAoX19zdXBlcl9fKSB7XG4gICAgaW5oZXJpdHMoU3VtT2JzZXJ2ZXIsIF9fc3VwZXJfXyk7XG5cbiAgICBmdW5jdGlvbiBTdW1PYnNlcnZlcihvLCBmbiwgcykge1xuICAgICAgdGhpcy5fbyA9IG87XG4gICAgICB0aGlzLl9mbiA9IGZuO1xuICAgICAgdGhpcy5fcyA9IHM7XG4gICAgICB0aGlzLl9pID0gMDtcbiAgICAgIHRoaXMuX2MgPSAwO1xuICAgICAgX19zdXBlcl9fLmNhbGwodGhpcyk7XG4gICAgfVxuXG4gICAgU3VtT2JzZXJ2ZXIucHJvdG90eXBlLm5leHQgPSBmdW5jdGlvbiAoeCkge1xuICAgICAgaWYgKHRoaXMuX2ZuKSB7XG4gICAgICAgIHZhciByZXN1bHQgPSB0cnlDYXRjaCh0aGlzLl9mbikoeCwgdGhpcy5faSsrLCB0aGlzLl9zKTtcbiAgICAgICAgaWYgKHJlc3VsdCA9PT0gZXJyb3JPYmopIHsgcmV0dXJuIHRoaXMuX28ub25FcnJvcihyZXN1bHQuZSk7IH1cbiAgICAgICAgdGhpcy5fYyArPSByZXN1bHQ7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICB0aGlzLl9jICs9IHg7XG4gICAgICB9XG4gICAgfTtcbiAgICBTdW1PYnNlcnZlci5wcm90b3R5cGUuZXJyb3IgPSBmdW5jdGlvbiAoZSkgeyB0aGlzLl9vLm9uRXJyb3IoZSk7IH07XG4gICAgU3VtT2JzZXJ2ZXIucHJvdG90eXBlLmNvbXBsZXRlZCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgIHRoaXMuX28ub25OZXh0KHRoaXMuX2MpO1xuICAgICAgdGhpcy5fby5vbkNvbXBsZXRlZCgpO1xuICAgIH07XG5cbiAgICByZXR1cm4gU3VtT2JzZXJ2ZXI7XG4gIH0oQWJzdHJhY3RPYnNlcnZlcikpO1xuXG4gIC8qKlxuICAgKiBDb21wdXRlcyB0aGUgc3VtIG9mIGEgc2VxdWVuY2Ugb2YgdmFsdWVzIHRoYXQgYXJlIG9idGFpbmVkIGJ5IGludm9raW5nIGFuIG9wdGlvbmFsIHRyYW5zZm9ybSBmdW5jdGlvbiBvbiBlYWNoIGVsZW1lbnQgb2YgdGhlIGlucHV0IHNlcXVlbmNlLCBlbHNlIGlmIG5vdCBzcGVjaWZpZWQgY29tcHV0ZXMgdGhlIHN1bSBvbiBlYWNoIGl0ZW0gaW4gdGhlIHNlcXVlbmNlLlxuICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBbc2VsZWN0b3JdIEEgdHJhbnNmb3JtIGZ1bmN0aW9uIHRvIGFwcGx5IHRvIGVhY2ggZWxlbWVudC5cbiAgICogQHBhcmFtIHtBbnl9IFt0aGlzQXJnXSBPYmplY3QgdG8gdXNlIGFzIHRoaXMgd2hlbiBleGVjdXRpbmcgY2FsbGJhY2suXG4gICAqIEByZXR1cm5zIHtPYnNlcnZhYmxlfSBBbiBvYnNlcnZhYmxlIHNlcXVlbmNlIGNvbnRhaW5pbmcgYSBzaW5nbGUgZWxlbWVudCB3aXRoIHRoZSBzdW0gb2YgdGhlIHZhbHVlcyBpbiB0aGUgc291cmNlIHNlcXVlbmNlLlxuICAgKi9cbiAgb2JzZXJ2YWJsZVByb3RvLnN1bSA9IGZ1bmN0aW9uIChrZXlTZWxlY3RvciwgdGhpc0FyZykge1xuICAgIHZhciBmbiA9IGJpbmRDYWxsYmFjayhrZXlTZWxlY3RvciwgdGhpc0FyZywgMyk7XG4gICAgcmV0dXJuIG5ldyBTdW1PYnNlcnZhYmxlKHRoaXMsIGZuKTtcbiAgfTtcblxuICAvKipcbiAgICogUmV0dXJucyB0aGUgZWxlbWVudHMgaW4gYW4gb2JzZXJ2YWJsZSBzZXF1ZW5jZSB3aXRoIHRoZSBtaW5pbXVtIGtleSB2YWx1ZSBhY2NvcmRpbmcgdG8gdGhlIHNwZWNpZmllZCBjb21wYXJlci5cbiAgICogQGV4YW1wbGVcbiAgICogdmFyIHJlcyA9IHNvdXJjZS5taW5CeShmdW5jdGlvbiAoeCkgeyByZXR1cm4geC52YWx1ZTsgfSk7XG4gICAqIHZhciByZXMgPSBzb3VyY2UubWluQnkoZnVuY3Rpb24gKHgpIHsgcmV0dXJuIHgudmFsdWU7IH0sIGZ1bmN0aW9uICh4LCB5KSB7IHJldHVybiB4IC0geTsgfSk7XG4gICAqIEBwYXJhbSB7RnVuY3Rpb259IGtleVNlbGVjdG9yIEtleSBzZWxlY3RvciBmdW5jdGlvbi5cbiAgICogQHBhcmFtIHtGdW5jdGlvbn0gW2NvbXBhcmVyXSBDb21wYXJlciB1c2VkIHRvIGNvbXBhcmUga2V5IHZhbHVlcy5cbiAgICogQHJldHVybnMge09ic2VydmFibGV9IEFuIG9ic2VydmFibGUgc2VxdWVuY2UgY29udGFpbmluZyBhIGxpc3Qgb2YgemVybyBvciBtb3JlIGVsZW1lbnRzIHRoYXQgaGF2ZSBhIG1pbmltdW0ga2V5IHZhbHVlLlxuICAgKi9cbiAgb2JzZXJ2YWJsZVByb3RvLm1pbkJ5ID0gZnVuY3Rpb24gKGtleVNlbGVjdG9yLCBjb21wYXJlcikge1xuICAgIGNvbXBhcmVyIHx8IChjb21wYXJlciA9IGRlZmF1bHRTdWJDb21wYXJlcik7XG4gICAgcmV0dXJuIG5ldyBFeHRyZW1hQnlPYnNlcnZhYmxlKHRoaXMsIGtleVNlbGVjdG9yLCBmdW5jdGlvbiAoeCwgeSkgeyByZXR1cm4gY29tcGFyZXIoeCwgeSkgKiAtMTsgfSk7XG4gIH07XG5cbiAgLyoqXG4gICAqIFJldHVybnMgdGhlIG1pbmltdW0gZWxlbWVudCBpbiBhbiBvYnNlcnZhYmxlIHNlcXVlbmNlIGFjY29yZGluZyB0byB0aGUgb3B0aW9uYWwgY29tcGFyZXIgZWxzZSBhIGRlZmF1bHQgZ3JlYXRlciB0aGFuIGxlc3MgdGhhbiBjaGVjay5cbiAgICogQGV4YW1wbGVcbiAgICogdmFyIHJlcyA9IHNvdXJjZS5taW4oKTtcbiAgICogdmFyIHJlcyA9IHNvdXJjZS5taW4oZnVuY3Rpb24gKHgsIHkpIHsgcmV0dXJuIHgudmFsdWUgLSB5LnZhbHVlOyB9KTtcbiAgICogQHBhcmFtIHtGdW5jdGlvbn0gW2NvbXBhcmVyXSBDb21wYXJlciB1c2VkIHRvIGNvbXBhcmUgZWxlbWVudHMuXG4gICAqIEByZXR1cm5zIHtPYnNlcnZhYmxlfSBBbiBvYnNlcnZhYmxlIHNlcXVlbmNlIGNvbnRhaW5pbmcgYSBzaW5nbGUgZWxlbWVudCB3aXRoIHRoZSBtaW5pbXVtIGVsZW1lbnQgaW4gdGhlIHNvdXJjZSBzZXF1ZW5jZS5cbiAgICovXG4gIG9ic2VydmFibGVQcm90by5taW4gPSBmdW5jdGlvbiAoY29tcGFyZXIpIHtcbiAgICByZXR1cm4gdGhpcy5taW5CeShpZGVudGl0eSwgY29tcGFyZXIpLm1hcChmdW5jdGlvbiAoeCkgeyByZXR1cm4gZmlyc3RPbmx5KHgpOyB9KTtcbiAgfTtcblxuICAvKipcbiAgICogUmV0dXJucyB0aGUgZWxlbWVudHMgaW4gYW4gb2JzZXJ2YWJsZSBzZXF1ZW5jZSB3aXRoIHRoZSBtYXhpbXVtICBrZXkgdmFsdWUgYWNjb3JkaW5nIHRvIHRoZSBzcGVjaWZpZWQgY29tcGFyZXIuXG4gICAqIEBleGFtcGxlXG4gICAqIHZhciByZXMgPSBzb3VyY2UubWF4QnkoZnVuY3Rpb24gKHgpIHsgcmV0dXJuIHgudmFsdWU7IH0pO1xuICAgKiB2YXIgcmVzID0gc291cmNlLm1heEJ5KGZ1bmN0aW9uICh4KSB7IHJldHVybiB4LnZhbHVlOyB9LCBmdW5jdGlvbiAoeCwgeSkgeyByZXR1cm4geCAtIHk7OyB9KTtcbiAgICogQHBhcmFtIHtGdW5jdGlvbn0ga2V5U2VsZWN0b3IgS2V5IHNlbGVjdG9yIGZ1bmN0aW9uLlxuICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBbY29tcGFyZXJdICBDb21wYXJlciB1c2VkIHRvIGNvbXBhcmUga2V5IHZhbHVlcy5cbiAgICogQHJldHVybnMge09ic2VydmFibGV9IEFuIG9ic2VydmFibGUgc2VxdWVuY2UgY29udGFpbmluZyBhIGxpc3Qgb2YgemVybyBvciBtb3JlIGVsZW1lbnRzIHRoYXQgaGF2ZSBhIG1heGltdW0ga2V5IHZhbHVlLlxuICAgKi9cbiAgb2JzZXJ2YWJsZVByb3RvLm1heEJ5ID0gZnVuY3Rpb24gKGtleVNlbGVjdG9yLCBjb21wYXJlcikge1xuICAgIGNvbXBhcmVyIHx8IChjb21wYXJlciA9IGRlZmF1bHRTdWJDb21wYXJlcik7XG4gICAgcmV0dXJuIG5ldyBFeHRyZW1hQnlPYnNlcnZhYmxlKHRoaXMsIGtleVNlbGVjdG9yLCBjb21wYXJlcik7XG4gIH07XG5cbiAgLyoqXG4gICAqIFJldHVybnMgdGhlIG1heGltdW0gdmFsdWUgaW4gYW4gb2JzZXJ2YWJsZSBzZXF1ZW5jZSBhY2NvcmRpbmcgdG8gdGhlIHNwZWNpZmllZCBjb21wYXJlci5cbiAgICogQGV4YW1wbGVcbiAgICogdmFyIHJlcyA9IHNvdXJjZS5tYXgoKTtcbiAgICogdmFyIHJlcyA9IHNvdXJjZS5tYXgoZnVuY3Rpb24gKHgsIHkpIHsgcmV0dXJuIHgudmFsdWUgLSB5LnZhbHVlOyB9KTtcbiAgICogQHBhcmFtIHtGdW5jdGlvbn0gW2NvbXBhcmVyXSBDb21wYXJlciB1c2VkIHRvIGNvbXBhcmUgZWxlbWVudHMuXG4gICAqIEByZXR1cm5zIHtPYnNlcnZhYmxlfSBBbiBvYnNlcnZhYmxlIHNlcXVlbmNlIGNvbnRhaW5pbmcgYSBzaW5nbGUgZWxlbWVudCB3aXRoIHRoZSBtYXhpbXVtIGVsZW1lbnQgaW4gdGhlIHNvdXJjZSBzZXF1ZW5jZS5cbiAgICovXG4gIG9ic2VydmFibGVQcm90by5tYXggPSBmdW5jdGlvbiAoY29tcGFyZXIpIHtcbiAgICByZXR1cm4gdGhpcy5tYXhCeShpZGVudGl0eSwgY29tcGFyZXIpLm1hcChmdW5jdGlvbiAoeCkgeyByZXR1cm4gZmlyc3RPbmx5KHgpOyB9KTtcbiAgfTtcblxuICB2YXIgQXZlcmFnZU9ic2VydmFibGUgPSAoZnVuY3Rpb24gKF9fc3VwZXJfXykge1xuICAgIGluaGVyaXRzKEF2ZXJhZ2VPYnNlcnZhYmxlLCBfX3N1cGVyX18pO1xuICAgIGZ1bmN0aW9uIEF2ZXJhZ2VPYnNlcnZhYmxlKHNvdXJjZSwgZm4pIHtcbiAgICAgIHRoaXMuc291cmNlID0gc291cmNlO1xuICAgICAgdGhpcy5fZm4gPSBmbjtcbiAgICAgIF9fc3VwZXJfXy5jYWxsKHRoaXMpO1xuICAgIH1cblxuICAgIEF2ZXJhZ2VPYnNlcnZhYmxlLnByb3RvdHlwZS5zdWJzY3JpYmVDb3JlID0gZnVuY3Rpb24gKG8pIHtcbiAgICAgIHJldHVybiB0aGlzLnNvdXJjZS5zdWJzY3JpYmUobmV3IEF2ZXJhZ2VPYnNlcnZlcihvLCB0aGlzLl9mbiwgdGhpcy5zb3VyY2UpKTtcbiAgICB9O1xuXG4gICAgcmV0dXJuIEF2ZXJhZ2VPYnNlcnZhYmxlO1xuICB9KE9ic2VydmFibGVCYXNlKSk7XG5cbiAgdmFyIEF2ZXJhZ2VPYnNlcnZlciA9IChmdW5jdGlvbihfX3N1cGVyX18pIHtcbiAgICBpbmhlcml0cyhBdmVyYWdlT2JzZXJ2ZXIsIF9fc3VwZXJfXyk7XG4gICAgZnVuY3Rpb24gQXZlcmFnZU9ic2VydmVyKG8sIGZuLCBzKSB7XG4gICAgICB0aGlzLl9vID0gbztcbiAgICAgIHRoaXMuX2ZuID0gZm47XG4gICAgICB0aGlzLl9zID0gcztcbiAgICAgIHRoaXMuX2MgPSAwO1xuICAgICAgdGhpcy5fdCA9IDA7XG4gICAgICBfX3N1cGVyX18uY2FsbCh0aGlzKTtcbiAgICB9XG5cbiAgICBBdmVyYWdlT2JzZXJ2ZXIucHJvdG90eXBlLm5leHQgPSBmdW5jdGlvbiAoeCkge1xuICAgICAgaWYodGhpcy5fZm4pIHtcbiAgICAgICAgdmFyIHIgPSB0cnlDYXRjaCh0aGlzLl9mbikoeCwgdGhpcy5fYysrLCB0aGlzLl9zKTtcbiAgICAgICAgaWYgKHIgPT09IGVycm9yT2JqKSB7IHJldHVybiB0aGlzLl9vLm9uRXJyb3Ioci5lKTsgfVxuICAgICAgICB0aGlzLl90ICs9IHI7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICB0aGlzLl9jKys7XG4gICAgICAgIHRoaXMuX3QgKz0geDtcbiAgICAgIH1cbiAgICB9O1xuICAgIEF2ZXJhZ2VPYnNlcnZlci5wcm90b3R5cGUuZXJyb3IgPSBmdW5jdGlvbiAoZSkgeyB0aGlzLl9vLm9uRXJyb3IoZSk7IH07XG4gICAgQXZlcmFnZU9ic2VydmVyLnByb3RvdHlwZS5jb21wbGV0ZWQgPSBmdW5jdGlvbiAoKSB7XG4gICAgICBpZiAodGhpcy5fYyA9PT0gMCkgeyByZXR1cm4gdGhpcy5fby5vbkVycm9yKG5ldyBFbXB0eUVycm9yKCkpOyB9XG4gICAgICB0aGlzLl9vLm9uTmV4dCh0aGlzLl90IC8gdGhpcy5fYyk7XG4gICAgICB0aGlzLl9vLm9uQ29tcGxldGVkKCk7XG4gICAgfTtcblxuICAgIHJldHVybiBBdmVyYWdlT2JzZXJ2ZXI7XG4gIH0oQWJzdHJhY3RPYnNlcnZlcikpO1xuXG4gIC8qKlxuICAgKiBDb21wdXRlcyB0aGUgYXZlcmFnZSBvZiBhbiBvYnNlcnZhYmxlIHNlcXVlbmNlIG9mIHZhbHVlcyB0aGF0IGFyZSBpbiB0aGUgc2VxdWVuY2Ugb3Igb2J0YWluZWQgYnkgaW52b2tpbmcgYSB0cmFuc2Zvcm0gZnVuY3Rpb24gb24gZWFjaCBlbGVtZW50IG9mIHRoZSBpbnB1dCBzZXF1ZW5jZSBpZiBwcmVzZW50LlxuICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBbc2VsZWN0b3JdIEEgdHJhbnNmb3JtIGZ1bmN0aW9uIHRvIGFwcGx5IHRvIGVhY2ggZWxlbWVudC5cbiAgICogQHBhcmFtIHtBbnl9IFt0aGlzQXJnXSBPYmplY3QgdG8gdXNlIGFzIHRoaXMgd2hlbiBleGVjdXRpbmcgY2FsbGJhY2suXG4gICAqIEByZXR1cm5zIHtPYnNlcnZhYmxlfSBBbiBvYnNlcnZhYmxlIHNlcXVlbmNlIGNvbnRhaW5pbmcgYSBzaW5nbGUgZWxlbWVudCB3aXRoIHRoZSBhdmVyYWdlIG9mIHRoZSBzZXF1ZW5jZSBvZiB2YWx1ZXMuXG4gICAqL1xuICBvYnNlcnZhYmxlUHJvdG8uYXZlcmFnZSA9IGZ1bmN0aW9uIChrZXlTZWxlY3RvciwgdGhpc0FyZykge1xuICAgIHZhciBzb3VyY2UgPSB0aGlzLCBmbjtcbiAgICBpZiAoaXNGdW5jdGlvbihrZXlTZWxlY3RvcikpIHtcbiAgICAgIGZuID0gYmluZENhbGxiYWNrKGtleVNlbGVjdG9yLCB0aGlzQXJnLCAzKTtcbiAgICB9XG4gICAgcmV0dXJuIG5ldyBBdmVyYWdlT2JzZXJ2YWJsZShzb3VyY2UsIGZuKTtcbiAgfTtcblxuICAvKipcbiAgICogIERldGVybWluZXMgd2hldGhlciB0d28gc2VxdWVuY2VzIGFyZSBlcXVhbCBieSBjb21wYXJpbmcgdGhlIGVsZW1lbnRzIHBhaXJ3aXNlIHVzaW5nIGEgc3BlY2lmaWVkIGVxdWFsaXR5IGNvbXBhcmVyLlxuICAgKlxuICAgKiBAZXhhbXBsZVxuICAgKiB2YXIgcmVzID0gcmVzID0gc291cmNlLnNlcXVlbmNlRXF1YWwoWzEsMiwzXSk7XG4gICAqIHZhciByZXMgPSByZXMgPSBzb3VyY2Uuc2VxdWVuY2VFcXVhbChbeyB2YWx1ZTogNDIgfV0sIGZ1bmN0aW9uICh4LCB5KSB7IHJldHVybiB4LnZhbHVlID09PSB5LnZhbHVlOyB9KTtcbiAgICogMyAtIHJlcyA9IHNvdXJjZS5zZXF1ZW5jZUVxdWFsKFJ4Lk9ic2VydmFibGUucmV0dXJuVmFsdWUoNDIpKTtcbiAgICogNCAtIHJlcyA9IHNvdXJjZS5zZXF1ZW5jZUVxdWFsKFJ4Lk9ic2VydmFibGUucmV0dXJuVmFsdWUoeyB2YWx1ZTogNDIgfSksIGZ1bmN0aW9uICh4LCB5KSB7IHJldHVybiB4LnZhbHVlID09PSB5LnZhbHVlOyB9KTtcbiAgICogQHBhcmFtIHtPYnNlcnZhYmxlfSBzZWNvbmQgU2Vjb25kIG9ic2VydmFibGUgc2VxdWVuY2Ugb3IgYXJyYXkgdG8gY29tcGFyZS5cbiAgICogQHBhcmFtIHtGdW5jdGlvbn0gW2NvbXBhcmVyXSBDb21wYXJlciB1c2VkIHRvIGNvbXBhcmUgZWxlbWVudHMgb2YgYm90aCBzZXF1ZW5jZXMuXG4gICAqIEByZXR1cm5zIHtPYnNlcnZhYmxlfSBBbiBvYnNlcnZhYmxlIHNlcXVlbmNlIHRoYXQgY29udGFpbnMgYSBzaW5nbGUgZWxlbWVudCB3aGljaCBpbmRpY2F0ZXMgd2hldGhlciBib3RoIHNlcXVlbmNlcyBhcmUgb2YgZXF1YWwgbGVuZ3RoIGFuZCB0aGVpciBjb3JyZXNwb25kaW5nIGVsZW1lbnRzIGFyZSBlcXVhbCBhY2NvcmRpbmcgdG8gdGhlIHNwZWNpZmllZCBlcXVhbGl0eSBjb21wYXJlci5cbiAgICovXG4gIG9ic2VydmFibGVQcm90by5zZXF1ZW5jZUVxdWFsID0gZnVuY3Rpb24gKHNlY29uZCwgY29tcGFyZXIpIHtcbiAgICB2YXIgZmlyc3QgPSB0aGlzO1xuICAgIGNvbXBhcmVyIHx8IChjb21wYXJlciA9IGRlZmF1bHRDb21wYXJlcik7XG4gICAgcmV0dXJuIG5ldyBBbm9ueW1vdXNPYnNlcnZhYmxlKGZ1bmN0aW9uIChvKSB7XG4gICAgICB2YXIgZG9uZWwgPSBmYWxzZSwgZG9uZXIgPSBmYWxzZSwgcWwgPSBbXSwgcXIgPSBbXTtcbiAgICAgIHZhciBzdWJzY3JpcHRpb24xID0gZmlyc3Quc3Vic2NyaWJlKGZ1bmN0aW9uICh4KSB7XG4gICAgICAgIGlmIChxci5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgdmFyIHYgPSBxci5zaGlmdCgpO1xuICAgICAgICAgIHZhciBlcXVhbCA9IHRyeUNhdGNoKGNvbXBhcmVyKSh2LCB4KTtcbiAgICAgICAgICBpZiAoZXF1YWwgPT09IGVycm9yT2JqKSB7IHJldHVybiBvLm9uRXJyb3IoZXF1YWwuZSk7IH1cbiAgICAgICAgICBpZiAoIWVxdWFsKSB7XG4gICAgICAgICAgICBvLm9uTmV4dChmYWxzZSk7XG4gICAgICAgICAgICBvLm9uQ29tcGxldGVkKCk7XG4gICAgICAgICAgfVxuICAgICAgICB9IGVsc2UgaWYgKGRvbmVyKSB7XG4gICAgICAgICAgby5vbk5leHQoZmFsc2UpO1xuICAgICAgICAgIG8ub25Db21wbGV0ZWQoKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBxbC5wdXNoKHgpO1xuICAgICAgICB9XG4gICAgICB9LCBmdW5jdGlvbihlKSB7IG8ub25FcnJvcihlKTsgfSwgZnVuY3Rpb24gKCkge1xuICAgICAgICBkb25lbCA9IHRydWU7XG4gICAgICAgIGlmIChxbC5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICBpZiAocXIubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgby5vbk5leHQoZmFsc2UpO1xuICAgICAgICAgICAgby5vbkNvbXBsZXRlZCgpO1xuICAgICAgICAgIH0gZWxzZSBpZiAoZG9uZXIpIHtcbiAgICAgICAgICAgIG8ub25OZXh0KHRydWUpO1xuICAgICAgICAgICAgby5vbkNvbXBsZXRlZCgpO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfSk7XG5cbiAgICAgIChpc0FycmF5TGlrZShzZWNvbmQpIHx8IGlzSXRlcmFibGUoc2Vjb25kKSkgJiYgKHNlY29uZCA9IG9ic2VydmFibGVGcm9tKHNlY29uZCkpO1xuICAgICAgaXNQcm9taXNlKHNlY29uZCkgJiYgKHNlY29uZCA9IG9ic2VydmFibGVGcm9tUHJvbWlzZShzZWNvbmQpKTtcbiAgICAgIHZhciBzdWJzY3JpcHRpb24yID0gc2Vjb25kLnN1YnNjcmliZShmdW5jdGlvbiAoeCkge1xuICAgICAgICBpZiAocWwubGVuZ3RoID4gMCkge1xuICAgICAgICAgIHZhciB2ID0gcWwuc2hpZnQoKTtcbiAgICAgICAgICB2YXIgZXF1YWwgPSB0cnlDYXRjaChjb21wYXJlcikodiwgeCk7XG4gICAgICAgICAgaWYgKGVxdWFsID09PSBlcnJvck9iaikgeyByZXR1cm4gby5vbkVycm9yKGVxdWFsLmUpOyB9XG4gICAgICAgICAgaWYgKCFlcXVhbCkge1xuICAgICAgICAgICAgby5vbk5leHQoZmFsc2UpO1xuICAgICAgICAgICAgby5vbkNvbXBsZXRlZCgpO1xuICAgICAgICAgIH1cbiAgICAgICAgfSBlbHNlIGlmIChkb25lbCkge1xuICAgICAgICAgIG8ub25OZXh0KGZhbHNlKTtcbiAgICAgICAgICBvLm9uQ29tcGxldGVkKCk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgcXIucHVzaCh4KTtcbiAgICAgICAgfVxuICAgICAgfSwgZnVuY3Rpb24oZSkgeyBvLm9uRXJyb3IoZSk7IH0sIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgZG9uZXIgPSB0cnVlO1xuICAgICAgICBpZiAocXIubGVuZ3RoID09PSAwKSB7XG4gICAgICAgICAgaWYgKHFsLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgIG8ub25OZXh0KGZhbHNlKTtcbiAgICAgICAgICAgIG8ub25Db21wbGV0ZWQoKTtcbiAgICAgICAgICB9IGVsc2UgaWYgKGRvbmVsKSB7XG4gICAgICAgICAgICBvLm9uTmV4dCh0cnVlKTtcbiAgICAgICAgICAgIG8ub25Db21wbGV0ZWQoKTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgICAgcmV0dXJuIG5ldyBCaW5hcnlEaXNwb3NhYmxlKHN1YnNjcmlwdGlvbjEsIHN1YnNjcmlwdGlvbjIpO1xuICAgIH0sIGZpcnN0KTtcbiAgfTtcblxuICB2YXIgRWxlbWVudEF0T2JzZXJ2YWJsZSA9IChmdW5jdGlvbiAoX19zdXBlcl9fKSB7XG4gICAgaW5oZXJpdHMoRWxlbWVudEF0T2JzZXJ2YWJsZSwgX19zdXBlcl9fKTtcbiAgICBmdW5jdGlvbiBFbGVtZW50QXRPYnNlcnZhYmxlKHNvdXJjZSwgaSwgZCkge1xuICAgICAgdGhpcy5zb3VyY2UgPSBzb3VyY2U7XG4gICAgICB0aGlzLl9pID0gaTtcbiAgICAgIHRoaXMuX2QgPSBkO1xuICAgICAgX19zdXBlcl9fLmNhbGwodGhpcyk7XG4gICAgfVxuXG4gICAgRWxlbWVudEF0T2JzZXJ2YWJsZS5wcm90b3R5cGUuc3Vic2NyaWJlQ29yZSA9IGZ1bmN0aW9uIChvKSB7XG4gICAgICByZXR1cm4gdGhpcy5zb3VyY2Uuc3Vic2NyaWJlKG5ldyBFbGVtZW50QXRPYnNlcnZlcihvLCB0aGlzLl9pLCB0aGlzLl9kKSk7XG4gICAgfTtcblxuICAgIHJldHVybiBFbGVtZW50QXRPYnNlcnZhYmxlO1xuICB9KE9ic2VydmFibGVCYXNlKSk7XG5cbiAgdmFyIEVsZW1lbnRBdE9ic2VydmVyID0gKGZ1bmN0aW9uIChfX3N1cGVyX18pIHtcbiAgICBpbmhlcml0cyhFbGVtZW50QXRPYnNlcnZlciwgX19zdXBlcl9fKTtcblxuICAgIGZ1bmN0aW9uIEVsZW1lbnRBdE9ic2VydmVyKG8sIGksIGQpIHtcbiAgICAgIHRoaXMuX28gPSBvO1xuICAgICAgdGhpcy5faSA9IGk7XG4gICAgICB0aGlzLl9kID0gZDtcbiAgICAgIF9fc3VwZXJfXy5jYWxsKHRoaXMpO1xuICAgIH1cblxuICAgIEVsZW1lbnRBdE9ic2VydmVyLnByb3RvdHlwZS5uZXh0ID0gZnVuY3Rpb24gKHgpIHtcbiAgICAgIGlmICh0aGlzLl9pLS0gPT09IDApIHtcbiAgICAgICAgdGhpcy5fby5vbk5leHQoeCk7XG4gICAgICAgIHRoaXMuX28ub25Db21wbGV0ZWQoKTtcbiAgICAgIH1cbiAgICB9O1xuICAgIEVsZW1lbnRBdE9ic2VydmVyLnByb3RvdHlwZS5lcnJvciA9IGZ1bmN0aW9uIChlKSB7IHRoaXMuX28ub25FcnJvcihlKTsgfTtcbiAgICBFbGVtZW50QXRPYnNlcnZlci5wcm90b3R5cGUuY29tcGxldGVkID0gZnVuY3Rpb24gKCkge1xuICAgICAgaWYgKHRoaXMuX2QgPT09IHVuZGVmaW5lZCkge1xuICAgICAgICB0aGlzLl9vLm9uRXJyb3IobmV3IEFyZ3VtZW50T3V0T2ZSYW5nZUVycm9yKCkpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdGhpcy5fby5vbk5leHQodGhpcy5fZCk7XG4gICAgICAgIHRoaXMuX28ub25Db21wbGV0ZWQoKTtcbiAgICAgIH1cbiAgICB9O1xuXG4gICAgcmV0dXJuIEVsZW1lbnRBdE9ic2VydmVyO1xuICB9KEFic3RyYWN0T2JzZXJ2ZXIpKTtcblxuICAvKipcbiAgICogUmV0dXJucyB0aGUgZWxlbWVudCBhdCBhIHNwZWNpZmllZCBpbmRleCBpbiBhIHNlcXVlbmNlIG9yIGRlZmF1bHQgdmFsdWUgaWYgbm90IGZvdW5kLlxuICAgKiBAcGFyYW0ge051bWJlcn0gaW5kZXggVGhlIHplcm8tYmFzZWQgaW5kZXggb2YgdGhlIGVsZW1lbnQgdG8gcmV0cmlldmUuXG4gICAqIEBwYXJhbSB7QW55fSBbZGVmYXVsdFZhbHVlXSBUaGUgZGVmYXVsdCB2YWx1ZSB0byB1c2UgaWYgZWxlbWVudEF0IGRvZXMgbm90IGZpbmQgYSB2YWx1ZS5cbiAgICogQHJldHVybnMge09ic2VydmFibGV9IEFuIG9ic2VydmFibGUgc2VxdWVuY2UgdGhhdCBwcm9kdWNlcyB0aGUgZWxlbWVudCBhdCB0aGUgc3BlY2lmaWVkIHBvc2l0aW9uIGluIHRoZSBzb3VyY2Ugc2VxdWVuY2UuXG4gICAqL1xuICBvYnNlcnZhYmxlUHJvdG8uZWxlbWVudEF0ID0gIGZ1bmN0aW9uIChpbmRleCwgZGVmYXVsdFZhbHVlKSB7XG4gICAgaWYgKGluZGV4IDwgMCkgeyB0aHJvdyBuZXcgQXJndW1lbnRPdXRPZlJhbmdlRXJyb3IoKTsgfVxuICAgIHJldHVybiBuZXcgRWxlbWVudEF0T2JzZXJ2YWJsZSh0aGlzLCBpbmRleCwgZGVmYXVsdFZhbHVlKTtcbiAgfTtcblxuICB2YXIgU2luZ2xlT2JzZXJ2ZXIgPSAoZnVuY3Rpb24oX19zdXBlcl9fKSB7XG4gICAgaW5oZXJpdHMoU2luZ2xlT2JzZXJ2ZXIsIF9fc3VwZXJfXyk7XG4gICAgZnVuY3Rpb24gU2luZ2xlT2JzZXJ2ZXIobywgb2JqLCBzKSB7XG4gICAgICB0aGlzLl9vID0gbztcbiAgICAgIHRoaXMuX29iaiA9IG9iajtcbiAgICAgIHRoaXMuX3MgPSBzO1xuICAgICAgdGhpcy5faSA9IDA7XG4gICAgICB0aGlzLl9odiA9IGZhbHNlO1xuICAgICAgdGhpcy5fdiA9IG51bGw7XG4gICAgICBfX3N1cGVyX18uY2FsbCh0aGlzKTtcbiAgICB9XG5cbiAgICBTaW5nbGVPYnNlcnZlci5wcm90b3R5cGUubmV4dCA9IGZ1bmN0aW9uICh4KSB7XG4gICAgICB2YXIgc2hvdWxkWWllbGQgPSBmYWxzZTtcbiAgICAgIGlmICh0aGlzLl9vYmoucHJlZGljYXRlKSB7XG4gICAgICAgIHZhciByZXMgPSB0cnlDYXRjaCh0aGlzLl9vYmoucHJlZGljYXRlKSh4LCB0aGlzLl9pKyssIHRoaXMuX3MpO1xuICAgICAgICBpZiAocmVzID09PSBlcnJvck9iaikgeyByZXR1cm4gdGhpcy5fby5vbkVycm9yKHJlcy5lKTsgfVxuICAgICAgICBCb29sZWFuKHJlcykgJiYgKHNob3VsZFlpZWxkID0gdHJ1ZSk7XG4gICAgICB9IGVsc2UgaWYgKCF0aGlzLl9vYmoucHJlZGljYXRlKSB7XG4gICAgICAgIHNob3VsZFlpZWxkID0gdHJ1ZTtcbiAgICAgIH1cbiAgICAgIGlmIChzaG91bGRZaWVsZCkge1xuICAgICAgICBpZiAodGhpcy5faHYpIHtcbiAgICAgICAgICByZXR1cm4gdGhpcy5fby5vbkVycm9yKG5ldyBFcnJvcignU2VxdWVuY2UgY29udGFpbnMgbW9yZSB0aGFuIG9uZSBtYXRjaGluZyBlbGVtZW50JykpO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuX2h2ID0gdHJ1ZTtcbiAgICAgICAgdGhpcy5fdiA9IHg7XG4gICAgICB9XG4gICAgfTtcbiAgICBTaW5nbGVPYnNlcnZlci5wcm90b3R5cGUuZXJyb3IgPSBmdW5jdGlvbiAoZSkgeyB0aGlzLl9vLm9uRXJyb3IoZSk7IH07XG4gICAgU2luZ2xlT2JzZXJ2ZXIucHJvdG90eXBlLmNvbXBsZXRlZCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgIGlmICh0aGlzLl9odikge1xuICAgICAgICB0aGlzLl9vLm9uTmV4dCh0aGlzLl92KTtcbiAgICAgICAgdGhpcy5fby5vbkNvbXBsZXRlZCgpO1xuICAgICAgfVxuICAgICAgZWxzZSBpZiAodGhpcy5fb2JqLmRlZmF1bHRWYWx1ZSA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgIHRoaXMuX28ub25FcnJvcihuZXcgRW1wdHlFcnJvcigpKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHRoaXMuX28ub25OZXh0KHRoaXMuX29iai5kZWZhdWx0VmFsdWUpO1xuICAgICAgICB0aGlzLl9vLm9uQ29tcGxldGVkKCk7XG4gICAgICB9XG4gICAgfTtcblxuICAgIHJldHVybiBTaW5nbGVPYnNlcnZlcjtcbiAgfShBYnN0cmFjdE9ic2VydmVyKSk7XG5cblxuICAgIC8qKlxuICAgICAqIFJldHVybnMgdGhlIG9ubHkgZWxlbWVudCBvZiBhbiBvYnNlcnZhYmxlIHNlcXVlbmNlIHRoYXQgc2F0aXNmaWVzIHRoZSBjb25kaXRpb24gaW4gdGhlIG9wdGlvbmFsIHByZWRpY2F0ZSwgYW5kIHJlcG9ydHMgYW4gZXhjZXB0aW9uIGlmIHRoZXJlIGlzIG5vdCBleGFjdGx5IG9uZSBlbGVtZW50IGluIHRoZSBvYnNlcnZhYmxlIHNlcXVlbmNlLlxuICAgICAqIEByZXR1cm5zIHtPYnNlcnZhYmxlfSBTZXF1ZW5jZSBjb250YWluaW5nIHRoZSBzaW5nbGUgZWxlbWVudCBpbiB0aGUgb2JzZXJ2YWJsZSBzZXF1ZW5jZSB0aGF0IHNhdGlzZmllcyB0aGUgY29uZGl0aW9uIGluIHRoZSBwcmVkaWNhdGUuXG4gICAgICovXG4gICAgb2JzZXJ2YWJsZVByb3RvLnNpbmdsZSA9IGZ1bmN0aW9uIChwcmVkaWNhdGUsIHRoaXNBcmcpIHtcbiAgICAgIHZhciBvYmogPSB7fSwgc291cmNlID0gdGhpcztcbiAgICAgIGlmICh0eXBlb2YgYXJndW1lbnRzWzBdID09PSAnb2JqZWN0Jykge1xuICAgICAgICBvYmogPSBhcmd1bWVudHNbMF07XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBvYmogPSB7XG4gICAgICAgICAgcHJlZGljYXRlOiBhcmd1bWVudHNbMF0sXG4gICAgICAgICAgdGhpc0FyZzogYXJndW1lbnRzWzFdLFxuICAgICAgICAgIGRlZmF1bHRWYWx1ZTogYXJndW1lbnRzWzJdXG4gICAgICAgIH07XG4gICAgICB9XG4gICAgICBpZiAoaXNGdW5jdGlvbiAob2JqLnByZWRpY2F0ZSkpIHtcbiAgICAgICAgdmFyIGZuID0gb2JqLnByZWRpY2F0ZTtcbiAgICAgICAgb2JqLnByZWRpY2F0ZSA9IGJpbmRDYWxsYmFjayhmbiwgb2JqLnRoaXNBcmcsIDMpO1xuICAgICAgfVxuICAgICAgcmV0dXJuIG5ldyBBbm9ueW1vdXNPYnNlcnZhYmxlKGZ1bmN0aW9uIChvKSB7XG4gICAgICAgIHJldHVybiBzb3VyY2Uuc3Vic2NyaWJlKG5ldyBTaW5nbGVPYnNlcnZlcihvLCBvYmosIHNvdXJjZSkpO1xuICAgICAgfSwgc291cmNlKTtcbiAgICB9O1xuXG4gIHZhciBGaXJzdE9ic2VydmFibGUgPSAoZnVuY3Rpb24gKF9fc3VwZXJfXykge1xuICAgIGluaGVyaXRzKEZpcnN0T2JzZXJ2YWJsZSwgX19zdXBlcl9fKTtcbiAgICBmdW5jdGlvbiBGaXJzdE9ic2VydmFibGUoc291cmNlLCBvYmopIHtcbiAgICAgIHRoaXMuc291cmNlID0gc291cmNlO1xuICAgICAgdGhpcy5fb2JqID0gb2JqO1xuICAgICAgX19zdXBlcl9fLmNhbGwodGhpcyk7XG4gICAgfVxuXG4gICAgRmlyc3RPYnNlcnZhYmxlLnByb3RvdHlwZS5zdWJzY3JpYmVDb3JlID0gZnVuY3Rpb24gKG8pIHtcbiAgICAgIHJldHVybiB0aGlzLnNvdXJjZS5zdWJzY3JpYmUobmV3IEZpcnN0T2JzZXJ2ZXIobywgdGhpcy5fb2JqLCB0aGlzLnNvdXJjZSkpO1xuICAgIH07XG5cbiAgICByZXR1cm4gRmlyc3RPYnNlcnZhYmxlO1xuICB9KE9ic2VydmFibGVCYXNlKSk7XG5cbiAgdmFyIEZpcnN0T2JzZXJ2ZXIgPSAoZnVuY3Rpb24oX19zdXBlcl9fKSB7XG4gICAgaW5oZXJpdHMoRmlyc3RPYnNlcnZlciwgX19zdXBlcl9fKTtcbiAgICBmdW5jdGlvbiBGaXJzdE9ic2VydmVyKG8sIG9iaiwgcykge1xuICAgICAgdGhpcy5fbyA9IG87XG4gICAgICB0aGlzLl9vYmogPSBvYmo7XG4gICAgICB0aGlzLl9zID0gcztcbiAgICAgIHRoaXMuX2kgPSAwO1xuICAgICAgX19zdXBlcl9fLmNhbGwodGhpcyk7XG4gICAgfVxuXG4gICAgRmlyc3RPYnNlcnZlci5wcm90b3R5cGUubmV4dCA9IGZ1bmN0aW9uICh4KSB7XG4gICAgICBpZiAodGhpcy5fb2JqLnByZWRpY2F0ZSkge1xuICAgICAgICB2YXIgcmVzID0gdHJ5Q2F0Y2godGhpcy5fb2JqLnByZWRpY2F0ZSkoeCwgdGhpcy5faSsrLCB0aGlzLl9zKTtcbiAgICAgICAgaWYgKHJlcyA9PT0gZXJyb3JPYmopIHsgcmV0dXJuIHRoaXMuX28ub25FcnJvcihyZXMuZSk7IH1cbiAgICAgICAgaWYgKEJvb2xlYW4ocmVzKSkge1xuICAgICAgICAgIHRoaXMuX28ub25OZXh0KHgpO1xuICAgICAgICAgIHRoaXMuX28ub25Db21wbGV0ZWQoKTtcbiAgICAgICAgfVxuICAgICAgfSBlbHNlIGlmICghdGhpcy5fb2JqLnByZWRpY2F0ZSkge1xuICAgICAgICB0aGlzLl9vLm9uTmV4dCh4KTtcbiAgICAgICAgdGhpcy5fby5vbkNvbXBsZXRlZCgpO1xuICAgICAgfVxuICAgIH07XG4gICAgRmlyc3RPYnNlcnZlci5wcm90b3R5cGUuZXJyb3IgPSBmdW5jdGlvbiAoZSkgeyB0aGlzLl9vLm9uRXJyb3IoZSk7IH07XG4gICAgRmlyc3RPYnNlcnZlci5wcm90b3R5cGUuY29tcGxldGVkID0gZnVuY3Rpb24gKCkge1xuICAgICAgaWYgKHRoaXMuX29iai5kZWZhdWx0VmFsdWUgPT09IHVuZGVmaW5lZCkge1xuICAgICAgICB0aGlzLl9vLm9uRXJyb3IobmV3IEVtcHR5RXJyb3IoKSk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICB0aGlzLl9vLm9uTmV4dCh0aGlzLl9vYmouZGVmYXVsdFZhbHVlKTtcbiAgICAgICAgdGhpcy5fby5vbkNvbXBsZXRlZCgpO1xuICAgICAgfVxuICAgIH07XG5cbiAgICByZXR1cm4gRmlyc3RPYnNlcnZlcjtcbiAgfShBYnN0cmFjdE9ic2VydmVyKSk7XG5cbiAgLyoqXG4gICAqIFJldHVybnMgdGhlIGZpcnN0IGVsZW1lbnQgb2YgYW4gb2JzZXJ2YWJsZSBzZXF1ZW5jZSB0aGF0IHNhdGlzZmllcyB0aGUgY29uZGl0aW9uIGluIHRoZSBwcmVkaWNhdGUgaWYgcHJlc2VudCBlbHNlIHRoZSBmaXJzdCBpdGVtIGluIHRoZSBzZXF1ZW5jZS5cbiAgICogQHJldHVybnMge09ic2VydmFibGV9IFNlcXVlbmNlIGNvbnRhaW5pbmcgdGhlIGZpcnN0IGVsZW1lbnQgaW4gdGhlIG9ic2VydmFibGUgc2VxdWVuY2UgdGhhdCBzYXRpc2ZpZXMgdGhlIGNvbmRpdGlvbiBpbiB0aGUgcHJlZGljYXRlIGlmIHByb3ZpZGVkLCBlbHNlIHRoZSBmaXJzdCBpdGVtIGluIHRoZSBzZXF1ZW5jZS5cbiAgICovXG4gIG9ic2VydmFibGVQcm90by5maXJzdCA9IGZ1bmN0aW9uICgpIHtcbiAgICB2YXIgb2JqID0ge30sIHNvdXJjZSA9IHRoaXM7XG4gICAgaWYgKHR5cGVvZiBhcmd1bWVudHNbMF0gPT09ICdvYmplY3QnKSB7XG4gICAgICBvYmogPSBhcmd1bWVudHNbMF07XG4gICAgfSBlbHNlIHtcbiAgICAgIG9iaiA9IHtcbiAgICAgICAgcHJlZGljYXRlOiBhcmd1bWVudHNbMF0sXG4gICAgICAgIHRoaXNBcmc6IGFyZ3VtZW50c1sxXSxcbiAgICAgICAgZGVmYXVsdFZhbHVlOiBhcmd1bWVudHNbMl1cbiAgICAgIH07XG4gICAgfVxuICAgIGlmIChpc0Z1bmN0aW9uIChvYmoucHJlZGljYXRlKSkge1xuICAgICAgdmFyIGZuID0gb2JqLnByZWRpY2F0ZTtcbiAgICAgIG9iai5wcmVkaWNhdGUgPSBiaW5kQ2FsbGJhY2soZm4sIG9iai50aGlzQXJnLCAzKTtcbiAgICB9XG4gICAgcmV0dXJuIG5ldyBGaXJzdE9ic2VydmFibGUodGhpcywgb2JqKTtcbiAgfTtcblxuICB2YXIgTGFzdE9ic2VydmFibGUgPSAoZnVuY3Rpb24gKF9fc3VwZXJfXykge1xuICAgIGluaGVyaXRzKExhc3RPYnNlcnZhYmxlLCBfX3N1cGVyX18pO1xuICAgIGZ1bmN0aW9uIExhc3RPYnNlcnZhYmxlKHNvdXJjZSwgb2JqKSB7XG4gICAgICB0aGlzLnNvdXJjZSA9IHNvdXJjZTtcbiAgICAgIHRoaXMuX29iaiA9IG9iajtcbiAgICAgIF9fc3VwZXJfXy5jYWxsKHRoaXMpO1xuICAgIH1cblxuICAgIExhc3RPYnNlcnZhYmxlLnByb3RvdHlwZS5zdWJzY3JpYmVDb3JlID0gZnVuY3Rpb24gKG8pIHtcbiAgICAgIHJldHVybiB0aGlzLnNvdXJjZS5zdWJzY3JpYmUobmV3IExhc3RPYnNlcnZlcihvLCB0aGlzLl9vYmosIHRoaXMuc291cmNlKSk7XG4gICAgfTtcblxuICAgIHJldHVybiBMYXN0T2JzZXJ2YWJsZTtcbiAgfShPYnNlcnZhYmxlQmFzZSkpO1xuXG4gIHZhciBMYXN0T2JzZXJ2ZXIgPSAoZnVuY3Rpb24oX19zdXBlcl9fKSB7XG4gICAgaW5oZXJpdHMoTGFzdE9ic2VydmVyLCBfX3N1cGVyX18pO1xuICAgIGZ1bmN0aW9uIExhc3RPYnNlcnZlcihvLCBvYmosIHMpIHtcbiAgICAgIHRoaXMuX28gPSBvO1xuICAgICAgdGhpcy5fb2JqID0gb2JqO1xuICAgICAgdGhpcy5fcyA9IHM7XG4gICAgICB0aGlzLl9pID0gMDtcbiAgICAgIHRoaXMuX2h2ID0gZmFsc2U7XG4gICAgICB0aGlzLl92ID0gbnVsbDtcbiAgICAgIF9fc3VwZXJfXy5jYWxsKHRoaXMpO1xuICAgIH1cblxuICAgIExhc3RPYnNlcnZlci5wcm90b3R5cGUubmV4dCA9IGZ1bmN0aW9uICh4KSB7XG4gICAgICB2YXIgc2hvdWxkWWllbGQgPSBmYWxzZTtcbiAgICAgIGlmICh0aGlzLl9vYmoucHJlZGljYXRlKSB7XG4gICAgICAgIHZhciByZXMgPSB0cnlDYXRjaCh0aGlzLl9vYmoucHJlZGljYXRlKSh4LCB0aGlzLl9pKyssIHRoaXMuX3MpO1xuICAgICAgICBpZiAocmVzID09PSBlcnJvck9iaikgeyByZXR1cm4gdGhpcy5fby5vbkVycm9yKHJlcy5lKTsgfVxuICAgICAgICBCb29sZWFuKHJlcykgJiYgKHNob3VsZFlpZWxkID0gdHJ1ZSk7XG4gICAgICB9IGVsc2UgaWYgKCF0aGlzLl9vYmoucHJlZGljYXRlKSB7XG4gICAgICAgIHNob3VsZFlpZWxkID0gdHJ1ZTtcbiAgICAgIH1cbiAgICAgIGlmIChzaG91bGRZaWVsZCkge1xuICAgICAgICB0aGlzLl9odiA9IHRydWU7XG4gICAgICAgIHRoaXMuX3YgPSB4O1xuICAgICAgfVxuICAgIH07XG4gICAgTGFzdE9ic2VydmVyLnByb3RvdHlwZS5lcnJvciA9IGZ1bmN0aW9uIChlKSB7IHRoaXMuX28ub25FcnJvcihlKTsgfTtcbiAgICBMYXN0T2JzZXJ2ZXIucHJvdG90eXBlLmNvbXBsZXRlZCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgIGlmICh0aGlzLl9odikge1xuICAgICAgICB0aGlzLl9vLm9uTmV4dCh0aGlzLl92KTtcbiAgICAgICAgdGhpcy5fby5vbkNvbXBsZXRlZCgpO1xuICAgICAgfVxuICAgICAgZWxzZSBpZiAodGhpcy5fb2JqLmRlZmF1bHRWYWx1ZSA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgIHRoaXMuX28ub25FcnJvcihuZXcgRW1wdHlFcnJvcigpKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHRoaXMuX28ub25OZXh0KHRoaXMuX29iai5kZWZhdWx0VmFsdWUpO1xuICAgICAgICB0aGlzLl9vLm9uQ29tcGxldGVkKCk7XG4gICAgICB9XG4gICAgfTtcblxuICAgIHJldHVybiBMYXN0T2JzZXJ2ZXI7XG4gIH0oQWJzdHJhY3RPYnNlcnZlcikpO1xuXG4gIC8qKlxuICAgKiBSZXR1cm5zIHRoZSBsYXN0IGVsZW1lbnQgb2YgYW4gb2JzZXJ2YWJsZSBzZXF1ZW5jZSB0aGF0IHNhdGlzZmllcyB0aGUgY29uZGl0aW9uIGluIHRoZSBwcmVkaWNhdGUgaWYgc3BlY2lmaWVkLCBlbHNlIHRoZSBsYXN0IGVsZW1lbnQuXG4gICAqIEByZXR1cm5zIHtPYnNlcnZhYmxlfSBTZXF1ZW5jZSBjb250YWluaW5nIHRoZSBsYXN0IGVsZW1lbnQgaW4gdGhlIG9ic2VydmFibGUgc2VxdWVuY2UgdGhhdCBzYXRpc2ZpZXMgdGhlIGNvbmRpdGlvbiBpbiB0aGUgcHJlZGljYXRlLlxuICAgKi9cbiAgb2JzZXJ2YWJsZVByb3RvLmxhc3QgPSBmdW5jdGlvbiAoKSB7XG4gICAgdmFyIG9iaiA9IHt9LCBzb3VyY2UgPSB0aGlzO1xuICAgIGlmICh0eXBlb2YgYXJndW1lbnRzWzBdID09PSAnb2JqZWN0Jykge1xuICAgICAgb2JqID0gYXJndW1lbnRzWzBdO1xuICAgIH0gZWxzZSB7XG4gICAgICBvYmogPSB7XG4gICAgICAgIHByZWRpY2F0ZTogYXJndW1lbnRzWzBdLFxuICAgICAgICB0aGlzQXJnOiBhcmd1bWVudHNbMV0sXG4gICAgICAgIGRlZmF1bHRWYWx1ZTogYXJndW1lbnRzWzJdXG4gICAgICB9O1xuICAgIH1cbiAgICBpZiAoaXNGdW5jdGlvbiAob2JqLnByZWRpY2F0ZSkpIHtcbiAgICAgIHZhciBmbiA9IG9iai5wcmVkaWNhdGU7XG4gICAgICBvYmoucHJlZGljYXRlID0gYmluZENhbGxiYWNrKGZuLCBvYmoudGhpc0FyZywgMyk7XG4gICAgfVxuICAgIHJldHVybiBuZXcgTGFzdE9ic2VydmFibGUodGhpcywgb2JqKTtcbiAgfTtcblxuICB2YXIgRmluZFZhbHVlT2JzZXJ2ZXIgPSAoZnVuY3Rpb24oX19zdXBlcl9fKSB7XG4gICAgaW5oZXJpdHMoRmluZFZhbHVlT2JzZXJ2ZXIsIF9fc3VwZXJfXyk7XG4gICAgZnVuY3Rpb24gRmluZFZhbHVlT2JzZXJ2ZXIob2JzZXJ2ZXIsIHNvdXJjZSwgY2FsbGJhY2ssIHlpZWxkSW5kZXgpIHtcbiAgICAgIHRoaXMuX28gPSBvYnNlcnZlcjtcbiAgICAgIHRoaXMuX3MgPSBzb3VyY2U7XG4gICAgICB0aGlzLl9jYiA9IGNhbGxiYWNrO1xuICAgICAgdGhpcy5feSA9IHlpZWxkSW5kZXg7XG4gICAgICB0aGlzLl9pID0gMDtcbiAgICAgIF9fc3VwZXJfXy5jYWxsKHRoaXMpO1xuICAgIH1cblxuICAgIEZpbmRWYWx1ZU9ic2VydmVyLnByb3RvdHlwZS5uZXh0ID0gZnVuY3Rpb24gKHgpIHtcbiAgICAgIHZhciBzaG91bGRSdW4gPSB0cnlDYXRjaCh0aGlzLl9jYikoeCwgdGhpcy5faSwgdGhpcy5fcyk7XG4gICAgICBpZiAoc2hvdWxkUnVuID09PSBlcnJvck9iaikgeyByZXR1cm4gdGhpcy5fby5vbkVycm9yKHNob3VsZFJ1bi5lKTsgfVxuICAgICAgaWYgKHNob3VsZFJ1bikge1xuICAgICAgICB0aGlzLl9vLm9uTmV4dCh0aGlzLl95ID8gdGhpcy5faSA6IHgpO1xuICAgICAgICB0aGlzLl9vLm9uQ29tcGxldGVkKCk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICB0aGlzLl9pKys7XG4gICAgICB9XG4gICAgfTtcblxuICAgIEZpbmRWYWx1ZU9ic2VydmVyLnByb3RvdHlwZS5lcnJvciA9IGZ1bmN0aW9uIChlKSB7XG4gICAgICB0aGlzLl9vLm9uRXJyb3IoZSk7XG4gICAgfTtcblxuICAgIEZpbmRWYWx1ZU9ic2VydmVyLnByb3RvdHlwZS5jb21wbGV0ZWQgPSBmdW5jdGlvbiAoKSB7XG4gICAgICB0aGlzLl95ICYmIHRoaXMuX28ub25OZXh0KC0xKTtcbiAgICAgIHRoaXMuX28ub25Db21wbGV0ZWQoKTtcbiAgICB9O1xuXG4gICAgcmV0dXJuIEZpbmRWYWx1ZU9ic2VydmVyO1xuICB9KEFic3RyYWN0T2JzZXJ2ZXIpKTtcblxuICBmdW5jdGlvbiBmaW5kVmFsdWUgKHNvdXJjZSwgcHJlZGljYXRlLCB0aGlzQXJnLCB5aWVsZEluZGV4KSB7XG4gICAgdmFyIGNhbGxiYWNrID0gYmluZENhbGxiYWNrKHByZWRpY2F0ZSwgdGhpc0FyZywgMyk7XG4gICAgcmV0dXJuIG5ldyBBbm9ueW1vdXNPYnNlcnZhYmxlKGZ1bmN0aW9uIChvKSB7XG4gICAgICByZXR1cm4gc291cmNlLnN1YnNjcmliZShuZXcgRmluZFZhbHVlT2JzZXJ2ZXIobywgc291cmNlLCBjYWxsYmFjaywgeWllbGRJbmRleCkpO1xuICAgIH0sIHNvdXJjZSk7XG4gIH1cblxuICAvKipcbiAgICogU2VhcmNoZXMgZm9yIGFuIGVsZW1lbnQgdGhhdCBtYXRjaGVzIHRoZSBjb25kaXRpb25zIGRlZmluZWQgYnkgdGhlIHNwZWNpZmllZCBwcmVkaWNhdGUsIGFuZCByZXR1cm5zIHRoZSBmaXJzdCBvY2N1cnJlbmNlIHdpdGhpbiB0aGUgZW50aXJlIE9ic2VydmFibGUgc2VxdWVuY2UuXG4gICAqIEBwYXJhbSB7RnVuY3Rpb259IHByZWRpY2F0ZSBUaGUgcHJlZGljYXRlIHRoYXQgZGVmaW5lcyB0aGUgY29uZGl0aW9ucyBvZiB0aGUgZWxlbWVudCB0byBzZWFyY2ggZm9yLlxuICAgKiBAcGFyYW0ge0FueX0gW3RoaXNBcmddIE9iamVjdCB0byB1c2UgYXMgYHRoaXNgIHdoZW4gZXhlY3V0aW5nIHRoZSBwcmVkaWNhdGUuXG4gICAqIEByZXR1cm5zIHtPYnNlcnZhYmxlfSBBbiBPYnNlcnZhYmxlIHNlcXVlbmNlIHdpdGggdGhlIGZpcnN0IGVsZW1lbnQgdGhhdCBtYXRjaGVzIHRoZSBjb25kaXRpb25zIGRlZmluZWQgYnkgdGhlIHNwZWNpZmllZCBwcmVkaWNhdGUsIGlmIGZvdW5kOyBvdGhlcndpc2UsIHVuZGVmaW5lZC5cbiAgICovXG4gIG9ic2VydmFibGVQcm90by5maW5kID0gZnVuY3Rpb24gKHByZWRpY2F0ZSwgdGhpc0FyZykge1xuICAgIHJldHVybiBmaW5kVmFsdWUodGhpcywgcHJlZGljYXRlLCB0aGlzQXJnLCBmYWxzZSk7XG4gIH07XG5cbiAgLyoqXG4gICAqIFNlYXJjaGVzIGZvciBhbiBlbGVtZW50IHRoYXQgbWF0Y2hlcyB0aGUgY29uZGl0aW9ucyBkZWZpbmVkIGJ5IHRoZSBzcGVjaWZpZWQgcHJlZGljYXRlLCBhbmQgcmV0dXJuc1xuICAgKiBhbiBPYnNlcnZhYmxlIHNlcXVlbmNlIHdpdGggdGhlIHplcm8tYmFzZWQgaW5kZXggb2YgdGhlIGZpcnN0IG9jY3VycmVuY2Ugd2l0aGluIHRoZSBlbnRpcmUgT2JzZXJ2YWJsZSBzZXF1ZW5jZS5cbiAgICogQHBhcmFtIHtGdW5jdGlvbn0gcHJlZGljYXRlIFRoZSBwcmVkaWNhdGUgdGhhdCBkZWZpbmVzIHRoZSBjb25kaXRpb25zIG9mIHRoZSBlbGVtZW50IHRvIHNlYXJjaCBmb3IuXG4gICAqIEBwYXJhbSB7QW55fSBbdGhpc0FyZ10gT2JqZWN0IHRvIHVzZSBhcyBgdGhpc2Agd2hlbiBleGVjdXRpbmcgdGhlIHByZWRpY2F0ZS5cbiAgICogQHJldHVybnMge09ic2VydmFibGV9IEFuIE9ic2VydmFibGUgc2VxdWVuY2Ugd2l0aCB0aGUgemVyby1iYXNlZCBpbmRleCBvZiB0aGUgZmlyc3Qgb2NjdXJyZW5jZSBvZiBhbiBlbGVtZW50IHRoYXQgbWF0Y2hlcyB0aGUgY29uZGl0aW9ucyBkZWZpbmVkIGJ5IG1hdGNoLCBpZiBmb3VuZDsgb3RoZXJ3aXNlLCDigJMxLlxuICAqL1xuICBvYnNlcnZhYmxlUHJvdG8uZmluZEluZGV4ID0gZnVuY3Rpb24gKHByZWRpY2F0ZSwgdGhpc0FyZykge1xuICAgIHJldHVybiBmaW5kVmFsdWUodGhpcywgcHJlZGljYXRlLCB0aGlzQXJnLCB0cnVlKTtcbiAgfTtcblxuICB2YXIgVG9TZXRPYnNlcnZhYmxlID0gKGZ1bmN0aW9uIChfX3N1cGVyX18pIHtcbiAgICBpbmhlcml0cyhUb1NldE9ic2VydmFibGUsIF9fc3VwZXJfXyk7XG4gICAgZnVuY3Rpb24gVG9TZXRPYnNlcnZhYmxlKHNvdXJjZSkge1xuICAgICAgdGhpcy5zb3VyY2UgPSBzb3VyY2U7XG4gICAgICBfX3N1cGVyX18uY2FsbCh0aGlzKTtcbiAgICB9XG5cbiAgICBUb1NldE9ic2VydmFibGUucHJvdG90eXBlLnN1YnNjcmliZUNvcmUgPSBmdW5jdGlvbiAobykge1xuICAgICAgcmV0dXJuIHRoaXMuc291cmNlLnN1YnNjcmliZShuZXcgVG9TZXRPYnNlcnZlcihvKSk7XG4gICAgfTtcblxuICAgIHJldHVybiBUb1NldE9ic2VydmFibGU7XG4gIH0oT2JzZXJ2YWJsZUJhc2UpKTtcblxuICB2YXIgVG9TZXRPYnNlcnZlciA9IChmdW5jdGlvbiAoX19zdXBlcl9fKSB7XG4gICAgaW5oZXJpdHMoVG9TZXRPYnNlcnZlciwgX19zdXBlcl9fKTtcbiAgICBmdW5jdGlvbiBUb1NldE9ic2VydmVyKG8pIHtcbiAgICAgIHRoaXMuX28gPSBvO1xuICAgICAgdGhpcy5fcyA9IG5ldyByb290LlNldCgpO1xuICAgICAgX19zdXBlcl9fLmNhbGwodGhpcyk7XG4gICAgfVxuXG4gICAgVG9TZXRPYnNlcnZlci5wcm90b3R5cGUubmV4dCA9IGZ1bmN0aW9uICh4KSB7XG4gICAgICB0aGlzLl9zLmFkZCh4KTtcbiAgICB9O1xuXG4gICAgVG9TZXRPYnNlcnZlci5wcm90b3R5cGUuZXJyb3IgPSBmdW5jdGlvbiAoZSkge1xuICAgICAgdGhpcy5fby5vbkVycm9yKGUpO1xuICAgIH07XG5cbiAgICBUb1NldE9ic2VydmVyLnByb3RvdHlwZS5jb21wbGV0ZWQgPSBmdW5jdGlvbiAoKSB7XG4gICAgICB0aGlzLl9vLm9uTmV4dCh0aGlzLl9zKTtcbiAgICAgIHRoaXMuX28ub25Db21wbGV0ZWQoKTtcbiAgICB9O1xuXG4gICAgcmV0dXJuIFRvU2V0T2JzZXJ2ZXI7XG4gIH0oQWJzdHJhY3RPYnNlcnZlcikpO1xuXG4gIC8qKlxuICAgKiBDb252ZXJ0cyB0aGUgb2JzZXJ2YWJsZSBzZXF1ZW5jZSB0byBhIFNldCBpZiBpdCBleGlzdHMuXG4gICAqIEByZXR1cm5zIHtPYnNlcnZhYmxlfSBBbiBvYnNlcnZhYmxlIHNlcXVlbmNlIHdpdGggYSBzaW5nbGUgdmFsdWUgb2YgYSBTZXQgY29udGFpbmluZyB0aGUgdmFsdWVzIGZyb20gdGhlIG9ic2VydmFibGUgc2VxdWVuY2UuXG4gICAqL1xuICBvYnNlcnZhYmxlUHJvdG8udG9TZXQgPSBmdW5jdGlvbiAoKSB7XG4gICAgaWYgKHR5cGVvZiByb290LlNldCA9PT0gJ3VuZGVmaW5lZCcpIHsgdGhyb3cgbmV3IFR5cGVFcnJvcigpOyB9XG4gICAgcmV0dXJuIG5ldyBUb1NldE9ic2VydmFibGUodGhpcyk7XG4gIH07XG5cbiAgdmFyIFRvTWFwT2JzZXJ2YWJsZSA9IChmdW5jdGlvbiAoX19zdXBlcl9fKSB7XG4gICAgaW5oZXJpdHMoVG9NYXBPYnNlcnZhYmxlLCBfX3N1cGVyX18pO1xuICAgIGZ1bmN0aW9uIFRvTWFwT2JzZXJ2YWJsZShzb3VyY2UsIGssIGUpIHtcbiAgICAgIHRoaXMuc291cmNlID0gc291cmNlO1xuICAgICAgdGhpcy5fayA9IGs7XG4gICAgICB0aGlzLl9lID0gZTtcbiAgICAgIF9fc3VwZXJfXy5jYWxsKHRoaXMpO1xuICAgIH1cblxuICAgIFRvTWFwT2JzZXJ2YWJsZS5wcm90b3R5cGUuc3Vic2NyaWJlQ29yZSA9IGZ1bmN0aW9uIChvKSB7XG4gICAgICByZXR1cm4gdGhpcy5zb3VyY2Uuc3Vic2NyaWJlKG5ldyBUb01hcE9ic2VydmVyKG8sIHRoaXMuX2ssIHRoaXMuX2UpKTtcbiAgICB9O1xuXG4gICAgcmV0dXJuIFRvTWFwT2JzZXJ2YWJsZTtcbiAgfShPYnNlcnZhYmxlQmFzZSkpO1xuXG4gIHZhciBUb01hcE9ic2VydmVyID0gKGZ1bmN0aW9uIChfX3N1cGVyX18pIHtcbiAgICBpbmhlcml0cyhUb01hcE9ic2VydmVyLCBfX3N1cGVyX18pO1xuICAgIGZ1bmN0aW9uIFRvTWFwT2JzZXJ2ZXIobywgaywgZSkge1xuICAgICAgdGhpcy5fbyA9IG87XG4gICAgICB0aGlzLl9rID0gaztcbiAgICAgIHRoaXMuX2UgPSBlO1xuICAgICAgdGhpcy5fbSA9IG5ldyByb290Lk1hcCgpO1xuICAgICAgX19zdXBlcl9fLmNhbGwodGhpcyk7XG4gICAgfVxuXG4gICAgVG9NYXBPYnNlcnZlci5wcm90b3R5cGUubmV4dCA9IGZ1bmN0aW9uICh4KSB7XG4gICAgICB2YXIga2V5ID0gdHJ5Q2F0Y2godGhpcy5faykoeCk7XG4gICAgICBpZiAoa2V5ID09PSBlcnJvck9iaikgeyByZXR1cm4gdGhpcy5fby5vbkVycm9yKGtleS5lKTsgfVxuICAgICAgdmFyIGVsZW0gPSB4O1xuICAgICAgaWYgKHRoaXMuX2UpIHtcbiAgICAgICAgZWxlbSA9IHRyeUNhdGNoKHRoaXMuX2UpKHgpO1xuICAgICAgICBpZiAoZWxlbSA9PT0gZXJyb3JPYmopIHsgcmV0dXJuIHRoaXMuX28ub25FcnJvcihlbGVtLmUpOyB9XG4gICAgICB9XG5cbiAgICAgIHRoaXMuX20uc2V0KGtleSwgZWxlbSk7XG4gICAgfTtcblxuICAgIFRvTWFwT2JzZXJ2ZXIucHJvdG90eXBlLmVycm9yID0gZnVuY3Rpb24gKGUpIHtcbiAgICAgIHRoaXMuX28ub25FcnJvcihlKTtcbiAgICB9O1xuXG4gICAgVG9NYXBPYnNlcnZlci5wcm90b3R5cGUuY29tcGxldGVkID0gZnVuY3Rpb24gKCkge1xuICAgICAgdGhpcy5fby5vbk5leHQodGhpcy5fbSk7XG4gICAgICB0aGlzLl9vLm9uQ29tcGxldGVkKCk7XG4gICAgfTtcblxuICAgIHJldHVybiBUb01hcE9ic2VydmVyO1xuICB9KEFic3RyYWN0T2JzZXJ2ZXIpKTtcblxuICAvKipcbiAgKiBDb252ZXJ0cyB0aGUgb2JzZXJ2YWJsZSBzZXF1ZW5jZSB0byBhIE1hcCBpZiBpdCBleGlzdHMuXG4gICogQHBhcmFtIHtGdW5jdGlvbn0ga2V5U2VsZWN0b3IgQSBmdW5jdGlvbiB3aGljaCBwcm9kdWNlcyB0aGUga2V5IGZvciB0aGUgTWFwLlxuICAqIEBwYXJhbSB7RnVuY3Rpb259IFtlbGVtZW50U2VsZWN0b3JdIEFuIG9wdGlvbmFsIGZ1bmN0aW9uIHdoaWNoIHByb2R1Y2VzIHRoZSBlbGVtZW50IGZvciB0aGUgTWFwLiBJZiBub3QgcHJlc2VudCwgZGVmYXVsdHMgdG8gdGhlIHZhbHVlIGZyb20gdGhlIG9ic2VydmFibGUgc2VxdWVuY2UuXG4gICogQHJldHVybnMge09ic2VydmFibGV9IEFuIG9ic2VydmFibGUgc2VxdWVuY2Ugd2l0aCBhIHNpbmdsZSB2YWx1ZSBvZiBhIE1hcCBjb250YWluaW5nIHRoZSB2YWx1ZXMgZnJvbSB0aGUgb2JzZXJ2YWJsZSBzZXF1ZW5jZS5cbiAgKi9cbiAgb2JzZXJ2YWJsZVByb3RvLnRvTWFwID0gZnVuY3Rpb24gKGtleVNlbGVjdG9yLCBlbGVtZW50U2VsZWN0b3IpIHtcbiAgICBpZiAodHlwZW9mIHJvb3QuTWFwID09PSAndW5kZWZpbmVkJykgeyB0aHJvdyBuZXcgVHlwZUVycm9yKCk7IH1cbiAgICByZXR1cm4gbmV3IFRvTWFwT2JzZXJ2YWJsZSh0aGlzLCBrZXlTZWxlY3RvciwgZWxlbWVudFNlbGVjdG9yKTtcbiAgfTtcblxuICB2YXIgU2xpY2VPYnNlcnZhYmxlID0gKGZ1bmN0aW9uIChfX3N1cGVyX18pIHtcbiAgICBpbmhlcml0cyhTbGljZU9ic2VydmFibGUsIF9fc3VwZXJfXyk7XG4gICAgZnVuY3Rpb24gU2xpY2VPYnNlcnZhYmxlKHNvdXJjZSwgYiwgZSkge1xuICAgICAgdGhpcy5zb3VyY2UgPSBzb3VyY2U7XG4gICAgICB0aGlzLl9iID0gYjtcbiAgICAgIHRoaXMuX2UgPSBlO1xuICAgICAgX19zdXBlcl9fLmNhbGwodGhpcyk7XG4gICAgfVxuXG4gICAgU2xpY2VPYnNlcnZhYmxlLnByb3RvdHlwZS5zdWJzY3JpYmVDb3JlID0gZnVuY3Rpb24gKG8pIHtcbiAgICAgIHJldHVybiB0aGlzLnNvdXJjZS5zdWJzY3JpYmUobmV3IFNsaWNlT2JzZXJ2ZXIobywgdGhpcy5fYiwgdGhpcy5fZSkpO1xuICAgIH07XG5cbiAgICByZXR1cm4gU2xpY2VPYnNlcnZhYmxlO1xuICB9KE9ic2VydmFibGVCYXNlKSk7XG5cbiAgdmFyIFNsaWNlT2JzZXJ2ZXIgPSAoZnVuY3Rpb24gKF9fc3VwZXJfXykge1xuICAgIGluaGVyaXRzKFNsaWNlT2JzZXJ2ZXIsIF9fc3VwZXJfXyk7XG5cbiAgICBmdW5jdGlvbiBTbGljZU9ic2VydmVyKG8sIGIsIGUpIHtcbiAgICAgIHRoaXMuX28gPSBvO1xuICAgICAgdGhpcy5fYiA9IGI7XG4gICAgICB0aGlzLl9lID0gZTtcbiAgICAgIHRoaXMuX2kgPSAwO1xuICAgICAgX19zdXBlcl9fLmNhbGwodGhpcyk7XG4gICAgfVxuXG4gICAgU2xpY2VPYnNlcnZlci5wcm90b3R5cGUubmV4dCA9IGZ1bmN0aW9uICh4KSB7XG4gICAgICBpZiAodGhpcy5faSA+PSB0aGlzLl9iKSB7XG4gICAgICAgIGlmICh0aGlzLl9lID09PSB0aGlzLl9pKSB7XG4gICAgICAgICAgdGhpcy5fby5vbkNvbXBsZXRlZCgpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHRoaXMuX28ub25OZXh0KHgpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICB0aGlzLl9pKys7XG4gICAgfTtcbiAgICBTbGljZU9ic2VydmVyLnByb3RvdHlwZS5lcnJvciA9IGZ1bmN0aW9uIChlKSB7IHRoaXMuX28ub25FcnJvcihlKTsgfTtcbiAgICBTbGljZU9ic2VydmVyLnByb3RvdHlwZS5jb21wbGV0ZWQgPSBmdW5jdGlvbiAoKSB7IHRoaXMuX28ub25Db21wbGV0ZWQoKTsgfTtcblxuICAgIHJldHVybiBTbGljZU9ic2VydmVyO1xuICB9KEFic3RyYWN0T2JzZXJ2ZXIpKTtcblxuICAvKlxuICAqIFRoZSBzbGljZSgpIG1ldGhvZCByZXR1cm5zIGEgc2hhbGxvdyBjb3B5IG9mIGEgcG9ydGlvbiBvZiBhbiBPYnNlcnZhYmxlIGludG8gYSBuZXcgT2JzZXJ2YWJsZSBvYmplY3QuXG4gICogVW5saWtlIHRoZSBhcnJheSB2ZXJzaW9uLCB0aGlzIGRvZXMgbm90IHN1cHBvcnQgbmVnYXRpdmUgbnVtYmVycyBmb3IgYmVpbmcgb3IgZW5kLlxuICAqIEBwYXJhbSB7TnVtYmVyfSBbYmVnaW5dIFplcm8tYmFzZWQgaW5kZXggYXQgd2hpY2ggdG8gYmVnaW4gZXh0cmFjdGlvbi4gSWYgb21pdHRlZCwgdGhpcyB3aWxsIGRlZmF1bHQgdG8gemVyby5cbiAgKiBAcGFyYW0ge051bWJlcn0gW2VuZF0gWmVyby1iYXNlZCBpbmRleCBhdCB3aGljaCB0byBlbmQgZXh0cmFjdGlvbi4gc2xpY2UgZXh0cmFjdHMgdXAgdG8gYnV0IG5vdCBpbmNsdWRpbmcgZW5kLlxuICAqIElmIG9taXR0ZWQsIHRoaXMgd2lsbCBlbWl0IHRoZSByZXN0IG9mIHRoZSBPYnNlcnZhYmxlIG9iamVjdC5cbiAgKiBAcmV0dXJucyB7T2JzZXJ2YWJsZX0gQSBzaGFsbG93IGNvcHkgb2YgYSBwb3J0aW9uIG9mIGFuIE9ic2VydmFibGUgaW50byBhIG5ldyBPYnNlcnZhYmxlIG9iamVjdC5cbiAgKi9cbiAgb2JzZXJ2YWJsZVByb3RvLnNsaWNlID0gZnVuY3Rpb24gKGJlZ2luLCBlbmQpIHtcbiAgICB2YXIgc3RhcnQgPSBiZWdpbiB8fCAwO1xuICAgIGlmIChzdGFydCA8IDApIHsgdGhyb3cgbmV3IFJ4LkFyZ3VtZW50T3V0T2ZSYW5nZUVycm9yKCk7IH1cbiAgICBpZiAodHlwZW9mIGVuZCA9PT0gJ251bWJlcicgJiYgZW5kIDwgc3RhcnQpIHtcbiAgICAgIHRocm93IG5ldyBSeC5Bcmd1bWVudE91dE9mUmFuZ2VFcnJvcigpO1xuICAgIH1cbiAgICByZXR1cm4gbmV3IFNsaWNlT2JzZXJ2YWJsZSh0aGlzLCBzdGFydCwgZW5kKTtcbiAgfTtcblxuICB2YXIgTGFzdEluZGV4T2ZPYnNlcnZhYmxlID0gKGZ1bmN0aW9uIChfX3N1cGVyX18pIHtcbiAgICBpbmhlcml0cyhMYXN0SW5kZXhPZk9ic2VydmFibGUsIF9fc3VwZXJfXyk7XG4gICAgZnVuY3Rpb24gTGFzdEluZGV4T2ZPYnNlcnZhYmxlKHNvdXJjZSwgZSwgbikge1xuICAgICAgdGhpcy5zb3VyY2UgPSBzb3VyY2U7XG4gICAgICB0aGlzLl9lID0gZTtcbiAgICAgIHRoaXMuX24gPSBuO1xuICAgICAgX19zdXBlcl9fLmNhbGwodGhpcyk7XG4gICAgfVxuXG4gICAgTGFzdEluZGV4T2ZPYnNlcnZhYmxlLnByb3RvdHlwZS5zdWJzY3JpYmVDb3JlID0gZnVuY3Rpb24gKG8pIHtcbiAgICAgIGlmICh0aGlzLl9uIDwgMCkge1xuICAgICAgICBvLm9uTmV4dCgtMSk7XG4gICAgICAgIG8ub25Db21wbGV0ZWQoKTtcbiAgICAgICAgcmV0dXJuIGRpc3Bvc2FibGVFbXB0eTtcbiAgICAgIH1cblxuICAgICAgcmV0dXJuIHRoaXMuc291cmNlLnN1YnNjcmliZShuZXcgTGFzdEluZGV4T2ZPYnNlcnZlcihvLCB0aGlzLl9lLCB0aGlzLl9uKSk7XG4gICAgfTtcblxuICAgIHJldHVybiBMYXN0SW5kZXhPZk9ic2VydmFibGU7XG4gIH0oT2JzZXJ2YWJsZUJhc2UpKTtcblxuICB2YXIgTGFzdEluZGV4T2ZPYnNlcnZlciA9IChmdW5jdGlvbiAoX19zdXBlcl9fKSB7XG4gICAgaW5oZXJpdHMoTGFzdEluZGV4T2ZPYnNlcnZlciwgX19zdXBlcl9fKTtcbiAgICBmdW5jdGlvbiBMYXN0SW5kZXhPZk9ic2VydmVyKG8sIGUsIG4pIHtcbiAgICAgIHRoaXMuX28gPSBvO1xuICAgICAgdGhpcy5fZSA9IGU7XG4gICAgICB0aGlzLl9uID0gbjtcbiAgICAgIHRoaXMuX3YgPSAwO1xuICAgICAgdGhpcy5faHYgPSBmYWxzZTtcbiAgICAgIHRoaXMuX2kgPSAwO1xuICAgICAgX19zdXBlcl9fLmNhbGwodGhpcyk7XG4gICAgfVxuXG4gICAgTGFzdEluZGV4T2ZPYnNlcnZlci5wcm90b3R5cGUubmV4dCA9IGZ1bmN0aW9uICh4KSB7XG4gICAgICBpZiAodGhpcy5faSA+PSB0aGlzLl9uICYmIHggPT09IHRoaXMuX2UpIHtcbiAgICAgICAgdGhpcy5faHYgPSB0cnVlO1xuICAgICAgICB0aGlzLl92ID0gdGhpcy5faTtcbiAgICAgIH1cbiAgICAgIHRoaXMuX2krKztcbiAgICB9O1xuICAgIExhc3RJbmRleE9mT2JzZXJ2ZXIucHJvdG90eXBlLmVycm9yID0gZnVuY3Rpb24gKGUpIHsgdGhpcy5fby5vbkVycm9yKGUpOyB9O1xuICAgIExhc3RJbmRleE9mT2JzZXJ2ZXIucHJvdG90eXBlLmNvbXBsZXRlZCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgIGlmICh0aGlzLl9odikge1xuICAgICAgICB0aGlzLl9vLm9uTmV4dCh0aGlzLl92KTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHRoaXMuX28ub25OZXh0KC0xKTtcbiAgICAgIH1cbiAgICAgIHRoaXMuX28ub25Db21wbGV0ZWQoKTtcbiAgICB9O1xuXG4gICAgcmV0dXJuIExhc3RJbmRleE9mT2JzZXJ2ZXI7XG4gIH0oQWJzdHJhY3RPYnNlcnZlcikpO1xuXG4gIC8qKlxuICAgKiBSZXR1cm5zIHRoZSBsYXN0IGluZGV4IGF0IHdoaWNoIGEgZ2l2ZW4gZWxlbWVudCBjYW4gYmUgZm91bmQgaW4gdGhlIG9ic2VydmFibGUgc2VxdWVuY2UsIG9yIC0xIGlmIGl0IGlzIG5vdCBwcmVzZW50LlxuICAgKiBAcGFyYW0ge0FueX0gc2VhcmNoRWxlbWVudCBFbGVtZW50IHRvIGxvY2F0ZSBpbiB0aGUgYXJyYXkuXG4gICAqIEBwYXJhbSB7TnVtYmVyfSBbZnJvbUluZGV4XSBUaGUgaW5kZXggdG8gc3RhcnQgdGhlIHNlYXJjaC4gIElmIG5vdCBzcGVjaWZpZWQsIGRlZmF1bHRzIHRvIDAuXG4gICAqIEByZXR1cm5zIHtPYnNlcnZhYmxlfSBBbmQgb2JzZXJ2YWJsZSBzZXF1ZW5jZSBjb250YWluaW5nIHRoZSBsYXN0IGluZGV4IGF0IHdoaWNoIGEgZ2l2ZW4gZWxlbWVudCBjYW4gYmUgZm91bmQgaW4gdGhlIG9ic2VydmFibGUgc2VxdWVuY2UsIG9yIC0xIGlmIGl0IGlzIG5vdCBwcmVzZW50LlxuICAgKi9cbiAgb2JzZXJ2YWJsZVByb3RvLmxhc3RJbmRleE9mID0gZnVuY3Rpb24oc2VhcmNoRWxlbWVudCwgZnJvbUluZGV4KSB7XG4gICAgdmFyIG4gPSArZnJvbUluZGV4IHx8IDA7XG4gICAgTWF0aC5hYnMobikgPT09IEluZmluaXR5ICYmIChuID0gMCk7XG4gICAgcmV0dXJuIG5ldyBMYXN0SW5kZXhPZk9ic2VydmFibGUodGhpcywgc2VhcmNoRWxlbWVudCwgbik7XG4gIH07XG5cbiAgT2JzZXJ2YWJsZS53cmFwID0gZnVuY3Rpb24gKGZuKSB7XG4gICAgY3JlYXRlT2JzZXJ2YWJsZS5fX2dlbmVyYXRvckZ1bmN0aW9uX18gPSBmbjtcbiAgICByZXR1cm4gY3JlYXRlT2JzZXJ2YWJsZTtcblxuICAgIGZ1bmN0aW9uIGNyZWF0ZU9ic2VydmFibGUoKSB7XG4gICAgICByZXR1cm4gT2JzZXJ2YWJsZS5zcGF3bi5jYWxsKHRoaXMsIGZuLmFwcGx5KHRoaXMsIGFyZ3VtZW50cykpO1xuICAgIH1cbiAgfTtcblxuICB2YXIgc3Bhd24gPSBPYnNlcnZhYmxlLnNwYXduID0gZnVuY3Rpb24gKCkge1xuICAgIHZhciBnZW4gPSBhcmd1bWVudHNbMF0sIHNlbGYgPSB0aGlzLCBhcmdzID0gW107XG4gICAgZm9yICh2YXIgaSA9IDEsIGxlbiA9IGFyZ3VtZW50cy5sZW5ndGg7IGkgPCBsZW47IGkrKykgeyBhcmdzLnB1c2goYXJndW1lbnRzW2ldKTsgfVxuXG4gICAgcmV0dXJuIG5ldyBBbm9ueW1vdXNPYnNlcnZhYmxlKGZ1bmN0aW9uIChvKSB7XG4gICAgICB2YXIgZyA9IG5ldyBDb21wb3NpdGVEaXNwb3NhYmxlKCk7XG5cbiAgICAgIGlmIChpc0Z1bmN0aW9uKGdlbikpIHsgZ2VuID0gZ2VuLmFwcGx5KHNlbGYsIGFyZ3MpOyB9XG4gICAgICBpZiAoIWdlbiB8fCAhaXNGdW5jdGlvbihnZW4ubmV4dCkpIHtcbiAgICAgICAgby5vbk5leHQoZ2VuKTtcbiAgICAgICAgcmV0dXJuIG8ub25Db21wbGV0ZWQoKTtcbiAgICAgIH1cblxuICAgICAgcHJvY2Vzc0dlbmVyYXRvcigpO1xuXG4gICAgICBmdW5jdGlvbiBwcm9jZXNzR2VuZXJhdG9yKHJlcykge1xuICAgICAgICB2YXIgcmV0ID0gdHJ5Q2F0Y2goZ2VuLm5leHQpLmNhbGwoZ2VuLCByZXMpO1xuICAgICAgICBpZiAocmV0ID09PSBlcnJvck9iaikgeyByZXR1cm4gby5vbkVycm9yKHJldC5lKTsgfVxuICAgICAgICBuZXh0KHJldCk7XG4gICAgICB9XG5cbiAgICAgIGZ1bmN0aW9uIG9uRXJyb3IoZXJyKSB7XG4gICAgICAgIHZhciByZXQgPSB0cnlDYXRjaChnZW4ubmV4dCkuY2FsbChnZW4sIGVycik7XG4gICAgICAgIGlmIChyZXQgPT09IGVycm9yT2JqKSB7IHJldHVybiBvLm9uRXJyb3IocmV0LmUpOyB9XG4gICAgICAgIG5leHQocmV0KTtcbiAgICAgIH1cblxuICAgICAgZnVuY3Rpb24gbmV4dChyZXQpIHtcbiAgICAgICAgaWYgKHJldC5kb25lKSB7XG4gICAgICAgICAgby5vbk5leHQocmV0LnZhbHVlKTtcbiAgICAgICAgICBvLm9uQ29tcGxldGVkKCk7XG4gICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIHZhciB2YWx1ZSA9IHRvT2JzZXJ2YWJsZS5jYWxsKHNlbGYsIHJldC52YWx1ZSk7XG4gICAgICAgIGlmIChPYnNlcnZhYmxlLmlzT2JzZXJ2YWJsZSh2YWx1ZSkpIHtcbiAgICAgICAgICBnLmFkZCh2YWx1ZS5zdWJzY3JpYmUocHJvY2Vzc0dlbmVyYXRvciwgb25FcnJvcikpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIG9uRXJyb3IobmV3IFR5cGVFcnJvcigndHlwZSBub3Qgc3VwcG9ydGVkJykpO1xuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIHJldHVybiBnO1xuICAgIH0pO1xuICB9O1xuXG4gIGZ1bmN0aW9uIHRvT2JzZXJ2YWJsZShvYmopIHtcbiAgICBpZiAoIW9iaikgeyByZXR1cm4gb2JqOyB9XG4gICAgaWYgKE9ic2VydmFibGUuaXNPYnNlcnZhYmxlKG9iaikpIHsgcmV0dXJuIG9iajsgfVxuICAgIGlmIChpc1Byb21pc2Uob2JqKSkgeyByZXR1cm4gT2JzZXJ2YWJsZS5mcm9tUHJvbWlzZShvYmopOyB9XG4gICAgaWYgKGlzR2VuZXJhdG9yRnVuY3Rpb24ob2JqKSB8fCBpc0dlbmVyYXRvcihvYmopKSB7IHJldHVybiBzcGF3bi5jYWxsKHRoaXMsIG9iaik7IH1cbiAgICBpZiAoaXNGdW5jdGlvbihvYmopKSB7IHJldHVybiB0aHVua1RvT2JzZXJ2YWJsZS5jYWxsKHRoaXMsIG9iaik7IH1cbiAgICBpZiAoaXNBcnJheUxpa2Uob2JqKSB8fCBpc0l0ZXJhYmxlKG9iaikpIHsgcmV0dXJuIGFycmF5VG9PYnNlcnZhYmxlLmNhbGwodGhpcywgb2JqKTsgfVxuICAgIGlmIChpc09iamVjdChvYmopKSB7cmV0dXJuIG9iamVjdFRvT2JzZXJ2YWJsZS5jYWxsKHRoaXMsIG9iaik7fVxuICAgIHJldHVybiBvYmo7XG4gIH1cblxuICBmdW5jdGlvbiBhcnJheVRvT2JzZXJ2YWJsZSAob2JqKSB7XG4gICAgcmV0dXJuIE9ic2VydmFibGUuZnJvbShvYmopXG4gICAgICAgIC5mbGF0TWFwKHRvT2JzZXJ2YWJsZSlcbiAgICAgICAgLnRvQXJyYXkoKTtcbiAgfVxuXG4gIGZ1bmN0aW9uIG9iamVjdFRvT2JzZXJ2YWJsZSAob2JqKSB7XG4gICAgdmFyIHJlc3VsdHMgPSBuZXcgb2JqLmNvbnN0cnVjdG9yKCksIGtleXMgPSBPYmplY3Qua2V5cyhvYmopLCBvYnNlcnZhYmxlcyA9IFtdO1xuICAgIGZvciAodmFyIGkgPSAwLCBsZW4gPSBrZXlzLmxlbmd0aDsgaSA8IGxlbjsgaSsrKSB7XG4gICAgICB2YXIga2V5ID0ga2V5c1tpXTtcbiAgICAgIHZhciBvYnNlcnZhYmxlID0gdG9PYnNlcnZhYmxlLmNhbGwodGhpcywgb2JqW2tleV0pO1xuXG4gICAgICBpZihvYnNlcnZhYmxlICYmIE9ic2VydmFibGUuaXNPYnNlcnZhYmxlKG9ic2VydmFibGUpKSB7XG4gICAgICAgIGRlZmVyKG9ic2VydmFibGUsIGtleSk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICByZXN1bHRzW2tleV0gPSBvYmpba2V5XTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICByZXR1cm4gT2JzZXJ2YWJsZS5mb3JrSm9pbi5hcHBseShPYnNlcnZhYmxlLCBvYnNlcnZhYmxlcykubWFwKGZ1bmN0aW9uKCkge1xuICAgICAgcmV0dXJuIHJlc3VsdHM7XG4gICAgfSk7XG5cblxuICAgIGZ1bmN0aW9uIGRlZmVyIChvYnNlcnZhYmxlLCBrZXkpIHtcbiAgICAgIHJlc3VsdHNba2V5XSA9IHVuZGVmaW5lZDtcbiAgICAgIG9ic2VydmFibGVzLnB1c2gob2JzZXJ2YWJsZS5tYXAoZnVuY3Rpb24gKG5leHQpIHtcbiAgICAgICAgcmVzdWx0c1trZXldID0gbmV4dDtcbiAgICAgIH0pKTtcbiAgICB9XG4gIH1cblxuICBmdW5jdGlvbiB0aHVua1RvT2JzZXJ2YWJsZShmbikge1xuICAgIHZhciBzZWxmID0gdGhpcztcbiAgICByZXR1cm4gbmV3IEFub255bW91c09ic2VydmFibGUoZnVuY3Rpb24gKG8pIHtcbiAgICAgIGZuLmNhbGwoc2VsZiwgZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgZXJyID0gYXJndW1lbnRzWzBdLCByZXMgPSBhcmd1bWVudHNbMV07XG4gICAgICAgIGlmIChlcnIpIHsgcmV0dXJuIG8ub25FcnJvcihlcnIpOyB9XG4gICAgICAgIGlmIChhcmd1bWVudHMubGVuZ3RoID4gMikge1xuICAgICAgICAgIHZhciBhcmdzID0gW107XG4gICAgICAgICAgZm9yICh2YXIgaSA9IDEsIGxlbiA9IGFyZ3VtZW50cy5sZW5ndGg7IGkgPCBsZW47IGkrKykgeyBhcmdzLnB1c2goYXJndW1lbnRzW2ldKTsgfVxuICAgICAgICAgIHJlcyA9IGFyZ3M7XG4gICAgICAgIH1cbiAgICAgICAgby5vbk5leHQocmVzKTtcbiAgICAgICAgby5vbkNvbXBsZXRlZCgpO1xuICAgICAgfSk7XG4gICAgfSk7XG4gIH1cblxuICBmdW5jdGlvbiBpc0dlbmVyYXRvcihvYmopIHtcbiAgICByZXR1cm4gaXNGdW5jdGlvbiAob2JqLm5leHQpICYmIGlzRnVuY3Rpb24gKG9iai50aHJvdyk7XG4gIH1cblxuICBmdW5jdGlvbiBpc0dlbmVyYXRvckZ1bmN0aW9uKG9iaikge1xuICAgIHZhciBjdG9yID0gb2JqLmNvbnN0cnVjdG9yO1xuICAgIGlmICghY3RvcikgeyByZXR1cm4gZmFsc2U7IH1cbiAgICBpZiAoY3Rvci5uYW1lID09PSAnR2VuZXJhdG9yRnVuY3Rpb24nIHx8IGN0b3IuZGlzcGxheU5hbWUgPT09ICdHZW5lcmF0b3JGdW5jdGlvbicpIHsgcmV0dXJuIHRydWU7IH1cbiAgICByZXR1cm4gaXNHZW5lcmF0b3IoY3Rvci5wcm90b3R5cGUpO1xuICB9XG5cbiAgZnVuY3Rpb24gaXNPYmplY3QodmFsKSB7XG4gICAgcmV0dXJuIE9iamVjdCA9PSB2YWwuY29uc3RydWN0b3I7XG4gIH1cblxuICAvKipcbiAgICogSW52b2tlcyB0aGUgc3BlY2lmaWVkIGZ1bmN0aW9uIGFzeW5jaHJvbm91c2x5IG9uIHRoZSBzcGVjaWZpZWQgc2NoZWR1bGVyLCBzdXJmYWNpbmcgdGhlIHJlc3VsdCB0aHJvdWdoIGFuIG9ic2VydmFibGUgc2VxdWVuY2UuXG4gICAqXG4gICAqIEBleGFtcGxlXG4gICAqIHZhciByZXMgPSBSeC5PYnNlcnZhYmxlLnN0YXJ0KGZ1bmN0aW9uICgpIHsgY29uc29sZS5sb2coJ2hlbGxvJyk7IH0pO1xuICAgKiB2YXIgcmVzID0gUnguT2JzZXJ2YWJsZS5zdGFydChmdW5jdGlvbiAoKSB7IGNvbnNvbGUubG9nKCdoZWxsbycpOyB9LCBSeC5TY2hlZHVsZXIudGltZW91dCk7XG4gICAqIHZhciByZXMgPSBSeC5PYnNlcnZhYmxlLnN0YXJ0KGZ1bmN0aW9uICgpIHsgdGhpcy5sb2coJ2hlbGxvJyk7IH0sIFJ4LlNjaGVkdWxlci50aW1lb3V0LCBjb25zb2xlKTtcbiAgICpcbiAgICogQHBhcmFtIHtGdW5jdGlvbn0gZnVuYyBGdW5jdGlvbiB0byBydW4gYXN5bmNocm9ub3VzbHkuXG4gICAqIEBwYXJhbSB7U2NoZWR1bGVyfSBbc2NoZWR1bGVyXSAgU2NoZWR1bGVyIHRvIHJ1biB0aGUgZnVuY3Rpb24gb24uIElmIG5vdCBzcGVjaWZpZWQsIGRlZmF1bHRzIHRvIFNjaGVkdWxlci50aW1lb3V0LlxuICAgKiBAcGFyYW0gW2NvbnRleHRdICBUaGUgY29udGV4dCBmb3IgdGhlIGZ1bmMgcGFyYW1ldGVyIHRvIGJlIGV4ZWN1dGVkLiAgSWYgbm90IHNwZWNpZmllZCwgZGVmYXVsdHMgdG8gdW5kZWZpbmVkLlxuICAgKiBAcmV0dXJucyB7T2JzZXJ2YWJsZX0gQW4gb2JzZXJ2YWJsZSBzZXF1ZW5jZSBleHBvc2luZyB0aGUgZnVuY3Rpb24ncyByZXN1bHQgdmFsdWUsIG9yIGFuIGV4Y2VwdGlvbi5cbiAgICpcbiAgICogUmVtYXJrc1xuICAgKiAqIFRoZSBmdW5jdGlvbiBpcyBjYWxsZWQgaW1tZWRpYXRlbHksIG5vdCBkdXJpbmcgdGhlIHN1YnNjcmlwdGlvbiBvZiB0aGUgcmVzdWx0aW5nIHNlcXVlbmNlLlxuICAgKiAqIE11bHRpcGxlIHN1YnNjcmlwdGlvbnMgdG8gdGhlIHJlc3VsdGluZyBzZXF1ZW5jZSBjYW4gb2JzZXJ2ZSB0aGUgZnVuY3Rpb24ncyByZXN1bHQuXG4gICAqL1xuICBPYnNlcnZhYmxlLnN0YXJ0ID0gZnVuY3Rpb24gKGZ1bmMsIGNvbnRleHQsIHNjaGVkdWxlcikge1xuICAgIHJldHVybiBvYnNlcnZhYmxlVG9Bc3luYyhmdW5jLCBjb250ZXh0LCBzY2hlZHVsZXIpKCk7XG4gIH07XG5cbiAgLyoqXG4gICAqIENvbnZlcnRzIHRoZSBmdW5jdGlvbiBpbnRvIGFuIGFzeW5jaHJvbm91cyBmdW5jdGlvbi4gRWFjaCBpbnZvY2F0aW9uIG9mIHRoZSByZXN1bHRpbmcgYXN5bmNocm9ub3VzIGZ1bmN0aW9uIGNhdXNlcyBhbiBpbnZvY2F0aW9uIG9mIHRoZSBvcmlnaW5hbCBzeW5jaHJvbm91cyBmdW5jdGlvbiBvbiB0aGUgc3BlY2lmaWVkIHNjaGVkdWxlci5cbiAgICogQHBhcmFtIHtGdW5jdGlvbn0gZnVuY3Rpb24gRnVuY3Rpb24gdG8gY29udmVydCB0byBhbiBhc3luY2hyb25vdXMgZnVuY3Rpb24uXG4gICAqIEBwYXJhbSB7U2NoZWR1bGVyfSBbc2NoZWR1bGVyXSBTY2hlZHVsZXIgdG8gcnVuIHRoZSBmdW5jdGlvbiBvbi4gSWYgbm90IHNwZWNpZmllZCwgZGVmYXVsdHMgdG8gU2NoZWR1bGVyLnRpbWVvdXQuXG4gICAqIEBwYXJhbSB7TWl4ZWR9IFtjb250ZXh0XSBUaGUgY29udGV4dCBmb3IgdGhlIGZ1bmMgcGFyYW1ldGVyIHRvIGJlIGV4ZWN1dGVkLiAgSWYgbm90IHNwZWNpZmllZCwgZGVmYXVsdHMgdG8gdW5kZWZpbmVkLlxuICAgKiBAcmV0dXJucyB7RnVuY3Rpb259IEFzeW5jaHJvbm91cyBmdW5jdGlvbi5cbiAgICovXG4gIHZhciBvYnNlcnZhYmxlVG9Bc3luYyA9IE9ic2VydmFibGUudG9Bc3luYyA9IGZ1bmN0aW9uIChmdW5jLCBjb250ZXh0LCBzY2hlZHVsZXIpIHtcbiAgICBpc1NjaGVkdWxlcihzY2hlZHVsZXIpIHx8IChzY2hlZHVsZXIgPSBkZWZhdWx0U2NoZWR1bGVyKTtcbiAgICByZXR1cm4gZnVuY3Rpb24gKCkge1xuICAgICAgdmFyIGFyZ3MgPSBhcmd1bWVudHMsXG4gICAgICAgIHN1YmplY3QgPSBuZXcgQXN5bmNTdWJqZWN0KCk7XG5cbiAgICAgIHNjaGVkdWxlci5zY2hlZHVsZShudWxsLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciByZXN1bHQ7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgcmVzdWx0ID0gZnVuYy5hcHBseShjb250ZXh0LCBhcmdzKTtcbiAgICAgICAgfSBjYXRjaCAoZSkge1xuICAgICAgICAgIHN1YmplY3Qub25FcnJvcihlKTtcbiAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgc3ViamVjdC5vbk5leHQocmVzdWx0KTtcbiAgICAgICAgc3ViamVjdC5vbkNvbXBsZXRlZCgpO1xuICAgICAgfSk7XG4gICAgICByZXR1cm4gc3ViamVjdC5hc09ic2VydmFibGUoKTtcbiAgICB9O1xuICB9O1xuXG5mdW5jdGlvbiBjcmVhdGVDYk9ic2VydmFibGUoZm4sIGN0eCwgc2VsZWN0b3IsIGFyZ3MpIHtcbiAgdmFyIG8gPSBuZXcgQXN5bmNTdWJqZWN0KCk7XG5cbiAgYXJncy5wdXNoKGNyZWF0ZUNiSGFuZGxlcihvLCBjdHgsIHNlbGVjdG9yKSk7XG4gIGZuLmFwcGx5KGN0eCwgYXJncyk7XG5cbiAgcmV0dXJuIG8uYXNPYnNlcnZhYmxlKCk7XG59XG5cbmZ1bmN0aW9uIGNyZWF0ZUNiSGFuZGxlcihvLCBjdHgsIHNlbGVjdG9yKSB7XG4gIHJldHVybiBmdW5jdGlvbiBoYW5kbGVyICgpIHtcbiAgICB2YXIgbGVuID0gYXJndW1lbnRzLmxlbmd0aCwgcmVzdWx0cyA9IG5ldyBBcnJheShsZW4pO1xuICAgIGZvcih2YXIgaSA9IDA7IGkgPCBsZW47IGkrKykgeyByZXN1bHRzW2ldID0gYXJndW1lbnRzW2ldOyB9XG5cbiAgICBpZiAoaXNGdW5jdGlvbihzZWxlY3RvcikpIHtcbiAgICAgIHJlc3VsdHMgPSB0cnlDYXRjaChzZWxlY3RvcikuYXBwbHkoY3R4LCByZXN1bHRzKTtcbiAgICAgIGlmIChyZXN1bHRzID09PSBlcnJvck9iaikgeyByZXR1cm4gby5vbkVycm9yKHJlc3VsdHMuZSk7IH1cbiAgICAgIG8ub25OZXh0KHJlc3VsdHMpO1xuICAgIH0gZWxzZSB7XG4gICAgICBpZiAocmVzdWx0cy5sZW5ndGggPD0gMSkge1xuICAgICAgICBvLm9uTmV4dChyZXN1bHRzWzBdKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIG8ub25OZXh0KHJlc3VsdHMpO1xuICAgICAgfVxuICAgIH1cblxuICAgIG8ub25Db21wbGV0ZWQoKTtcbiAgfTtcbn1cblxuLyoqXG4gKiBDb252ZXJ0cyBhIGNhbGxiYWNrIGZ1bmN0aW9uIHRvIGFuIG9ic2VydmFibGUgc2VxdWVuY2UuXG4gKlxuICogQHBhcmFtIHtGdW5jdGlvbn0gZm4gRnVuY3Rpb24gd2l0aCBhIGNhbGxiYWNrIGFzIHRoZSBsYXN0IHBhcmFtZXRlciB0byBjb252ZXJ0IHRvIGFuIE9ic2VydmFibGUgc2VxdWVuY2UuXG4gKiBAcGFyYW0ge01peGVkfSBbY3R4XSBUaGUgY29udGV4dCBmb3IgdGhlIGZ1bmMgcGFyYW1ldGVyIHRvIGJlIGV4ZWN1dGVkLiAgSWYgbm90IHNwZWNpZmllZCwgZGVmYXVsdHMgdG8gdW5kZWZpbmVkLlxuICogQHBhcmFtIHtGdW5jdGlvbn0gW3NlbGVjdG9yXSBBIHNlbGVjdG9yIHdoaWNoIHRha2VzIHRoZSBhcmd1bWVudHMgZnJvbSB0aGUgY2FsbGJhY2sgdG8gcHJvZHVjZSBhIHNpbmdsZSBpdGVtIHRvIHlpZWxkIG9uIG5leHQuXG4gKiBAcmV0dXJucyB7RnVuY3Rpb259IEEgZnVuY3Rpb24sIHdoZW4gZXhlY3V0ZWQgd2l0aCB0aGUgcmVxdWlyZWQgcGFyYW1ldGVycyBtaW51cyB0aGUgY2FsbGJhY2ssIHByb2R1Y2VzIGFuIE9ic2VydmFibGUgc2VxdWVuY2Ugd2l0aCBhIHNpbmdsZSB2YWx1ZSBvZiB0aGUgYXJndW1lbnRzIHRvIHRoZSBjYWxsYmFjayBhcyBhbiBhcnJheS5cbiAqL1xuT2JzZXJ2YWJsZS5mcm9tQ2FsbGJhY2sgPSBmdW5jdGlvbiAoZm4sIGN0eCwgc2VsZWN0b3IpIHtcbiAgcmV0dXJuIGZ1bmN0aW9uICgpIHtcbiAgICB0eXBlb2YgY3R4ID09PSAndW5kZWZpbmVkJyAmJiAoY3R4ID0gdGhpcyk7IFxuXG4gICAgdmFyIGxlbiA9IGFyZ3VtZW50cy5sZW5ndGgsIGFyZ3MgPSBuZXcgQXJyYXkobGVuKVxuICAgIGZvcih2YXIgaSA9IDA7IGkgPCBsZW47IGkrKykgeyBhcmdzW2ldID0gYXJndW1lbnRzW2ldOyB9XG4gICAgcmV0dXJuIGNyZWF0ZUNiT2JzZXJ2YWJsZShmbiwgY3R4LCBzZWxlY3RvciwgYXJncyk7XG4gIH07XG59O1xuXG5mdW5jdGlvbiBjcmVhdGVOb2RlT2JzZXJ2YWJsZShmbiwgY3R4LCBzZWxlY3RvciwgYXJncykge1xuICB2YXIgbyA9IG5ldyBBc3luY1N1YmplY3QoKTtcblxuICBhcmdzLnB1c2goY3JlYXRlTm9kZUhhbmRsZXIobywgY3R4LCBzZWxlY3RvcikpO1xuICBmbi5hcHBseShjdHgsIGFyZ3MpO1xuXG4gIHJldHVybiBvLmFzT2JzZXJ2YWJsZSgpO1xufVxuXG5mdW5jdGlvbiBjcmVhdGVOb2RlSGFuZGxlcihvLCBjdHgsIHNlbGVjdG9yKSB7XG4gIHJldHVybiBmdW5jdGlvbiBoYW5kbGVyICgpIHtcbiAgICB2YXIgZXJyID0gYXJndW1lbnRzWzBdO1xuICAgIGlmIChlcnIpIHsgcmV0dXJuIG8ub25FcnJvcihlcnIpOyB9XG5cbiAgICB2YXIgbGVuID0gYXJndW1lbnRzLmxlbmd0aCwgcmVzdWx0cyA9IFtdO1xuICAgIGZvcih2YXIgaSA9IDE7IGkgPCBsZW47IGkrKykgeyByZXN1bHRzW2kgLSAxXSA9IGFyZ3VtZW50c1tpXTsgfVxuXG4gICAgaWYgKGlzRnVuY3Rpb24oc2VsZWN0b3IpKSB7XG4gICAgICB2YXIgcmVzdWx0cyA9IHRyeUNhdGNoKHNlbGVjdG9yKS5hcHBseShjdHgsIHJlc3VsdHMpO1xuICAgICAgaWYgKHJlc3VsdHMgPT09IGVycm9yT2JqKSB7IHJldHVybiBvLm9uRXJyb3IocmVzdWx0cy5lKTsgfVxuICAgICAgby5vbk5leHQocmVzdWx0cyk7XG4gICAgfSBlbHNlIHtcbiAgICAgIGlmIChyZXN1bHRzLmxlbmd0aCA8PSAxKSB7XG4gICAgICAgIG8ub25OZXh0KHJlc3VsdHNbMF0pO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgby5vbk5leHQocmVzdWx0cyk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgby5vbkNvbXBsZXRlZCgpO1xuICB9O1xufVxuXG4vKipcbiAqIENvbnZlcnRzIGEgTm9kZS5qcyBjYWxsYmFjayBzdHlsZSBmdW5jdGlvbiB0byBhbiBvYnNlcnZhYmxlIHNlcXVlbmNlLiAgVGhpcyBtdXN0IGJlIGluIGZ1bmN0aW9uIChlcnIsIC4uLikgZm9ybWF0LlxuICogQHBhcmFtIHtGdW5jdGlvbn0gZm4gVGhlIGZ1bmN0aW9uIHRvIGNhbGxcbiAqIEBwYXJhbSB7TWl4ZWR9IFtjdHhdIFRoZSBjb250ZXh0IGZvciB0aGUgZnVuYyBwYXJhbWV0ZXIgdG8gYmUgZXhlY3V0ZWQuICBJZiBub3Qgc3BlY2lmaWVkLCBkZWZhdWx0cyB0byB1bmRlZmluZWQuXG4gKiBAcGFyYW0ge0Z1bmN0aW9ufSBbc2VsZWN0b3JdIEEgc2VsZWN0b3Igd2hpY2ggdGFrZXMgdGhlIGFyZ3VtZW50cyBmcm9tIHRoZSBjYWxsYmFjayBtaW51cyB0aGUgZXJyb3IgdG8gcHJvZHVjZSBhIHNpbmdsZSBpdGVtIHRvIHlpZWxkIG9uIG5leHQuXG4gKiBAcmV0dXJucyB7RnVuY3Rpb259IEFuIGFzeW5jIGZ1bmN0aW9uIHdoaWNoIHdoZW4gYXBwbGllZCwgcmV0dXJucyBhbiBvYnNlcnZhYmxlIHNlcXVlbmNlIHdpdGggdGhlIGNhbGxiYWNrIGFyZ3VtZW50cyBhcyBhbiBhcnJheS5cbiAqL1xuT2JzZXJ2YWJsZS5mcm9tTm9kZUNhbGxiYWNrID0gZnVuY3Rpb24gKGZuLCBjdHgsIHNlbGVjdG9yKSB7XG4gIHJldHVybiBmdW5jdGlvbiAoKSB7XG4gICAgdHlwZW9mIGN0eCA9PT0gJ3VuZGVmaW5lZCcgJiYgKGN0eCA9IHRoaXMpOyBcbiAgICB2YXIgbGVuID0gYXJndW1lbnRzLmxlbmd0aCwgYXJncyA9IG5ldyBBcnJheShsZW4pO1xuICAgIGZvcih2YXIgaSA9IDA7IGkgPCBsZW47IGkrKykgeyBhcmdzW2ldID0gYXJndW1lbnRzW2ldOyB9XG4gICAgcmV0dXJuIGNyZWF0ZU5vZGVPYnNlcnZhYmxlKGZuLCBjdHgsIHNlbGVjdG9yLCBhcmdzKTtcbiAgfTtcbn07XG5cbiAgZnVuY3Rpb24gTGlzdGVuRGlzcG9zYWJsZShlLCBuLCBmbikge1xuICAgIHRoaXMuX2UgPSBlO1xuICAgIHRoaXMuX24gPSBuO1xuICAgIHRoaXMuX2ZuID0gZm47XG4gICAgdGhpcy5fZS5hZGRFdmVudExpc3RlbmVyKHRoaXMuX24sIHRoaXMuX2ZuLCBmYWxzZSk7XG4gICAgdGhpcy5pc0Rpc3Bvc2VkID0gZmFsc2U7XG4gIH1cbiAgTGlzdGVuRGlzcG9zYWJsZS5wcm90b3R5cGUuZGlzcG9zZSA9IGZ1bmN0aW9uICgpIHtcbiAgICBpZiAoIXRoaXMuaXNEaXNwb3NlZCkge1xuICAgICAgdGhpcy5fZS5yZW1vdmVFdmVudExpc3RlbmVyKHRoaXMuX24sIHRoaXMuX2ZuLCBmYWxzZSk7XG4gICAgICB0aGlzLmlzRGlzcG9zZWQgPSB0cnVlO1xuICAgIH1cbiAgfTtcblxuICBmdW5jdGlvbiBjcmVhdGVFdmVudExpc3RlbmVyIChlbCwgZXZlbnROYW1lLCBoYW5kbGVyKSB7XG4gICAgdmFyIGRpc3Bvc2FibGVzID0gbmV3IENvbXBvc2l0ZURpc3Bvc2FibGUoKTtcblxuICAgIC8vIEFzdW1lIE5vZGVMaXN0IG9yIEhUTUxDb2xsZWN0aW9uXG4gICAgdmFyIGVsZW1Ub1N0cmluZyA9IE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbChlbCk7XG4gICAgaWYgKGVsZW1Ub1N0cmluZyA9PT0gJ1tvYmplY3QgTm9kZUxpc3RdJyB8fCBlbGVtVG9TdHJpbmcgPT09ICdbb2JqZWN0IEhUTUxDb2xsZWN0aW9uXScpIHtcbiAgICAgIGZvciAodmFyIGkgPSAwLCBsZW4gPSBlbC5sZW5ndGg7IGkgPCBsZW47IGkrKykge1xuICAgICAgICBkaXNwb3NhYmxlcy5hZGQoY3JlYXRlRXZlbnRMaXN0ZW5lcihlbC5pdGVtKGkpLCBldmVudE5hbWUsIGhhbmRsZXIpKTtcbiAgICAgIH1cbiAgICB9IGVsc2UgaWYgKGVsKSB7XG4gICAgICBkaXNwb3NhYmxlcy5hZGQobmV3IExpc3RlbkRpc3Bvc2FibGUoZWwsIGV2ZW50TmFtZSwgaGFuZGxlcikpO1xuICAgIH1cblxuICAgIHJldHVybiBkaXNwb3NhYmxlcztcbiAgfVxuXG4gIC8qKlxuICAgKiBDb25maWd1cmF0aW9uIG9wdGlvbiB0byBkZXRlcm1pbmUgd2hldGhlciB0byB1c2UgbmF0aXZlIGV2ZW50cyBvbmx5XG4gICAqL1xuICBSeC5jb25maWcudXNlTmF0aXZlRXZlbnRzID0gZmFsc2U7XG5cbiAgZnVuY3Rpb24gZXZlbnRIYW5kbGVyKG8sIHNlbGVjdG9yKSB7XG4gICAgcmV0dXJuIGZ1bmN0aW9uIGhhbmRsZXIgKCkge1xuICAgICAgdmFyIHJlc3VsdHMgPSBhcmd1bWVudHNbMF07XG4gICAgICBpZiAoaXNGdW5jdGlvbihzZWxlY3RvcikpIHtcbiAgICAgICAgcmVzdWx0cyA9IHRyeUNhdGNoKHNlbGVjdG9yKS5hcHBseShudWxsLCBhcmd1bWVudHMpO1xuICAgICAgICBpZiAocmVzdWx0cyA9PT0gZXJyb3JPYmopIHsgcmV0dXJuIG8ub25FcnJvcihyZXN1bHRzLmUpOyB9XG4gICAgICB9XG4gICAgICBvLm9uTmV4dChyZXN1bHRzKTtcbiAgICB9O1xuICB9XG5cbiAgLyoqXG4gICAqIENyZWF0ZXMgYW4gb2JzZXJ2YWJsZSBzZXF1ZW5jZSBieSBhZGRpbmcgYW4gZXZlbnQgbGlzdGVuZXIgdG8gdGhlIG1hdGNoaW5nIERPTUVsZW1lbnQgb3IgZWFjaCBpdGVtIGluIHRoZSBOb2RlTGlzdC5cbiAgICogQHBhcmFtIHtPYmplY3R9IGVsZW1lbnQgVGhlIERPTUVsZW1lbnQgb3IgTm9kZUxpc3QgdG8gYXR0YWNoIGEgbGlzdGVuZXIuXG4gICAqIEBwYXJhbSB7U3RyaW5nfSBldmVudE5hbWUgVGhlIGV2ZW50IG5hbWUgdG8gYXR0YWNoIHRoZSBvYnNlcnZhYmxlIHNlcXVlbmNlLlxuICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBbc2VsZWN0b3JdIEEgc2VsZWN0b3Igd2hpY2ggdGFrZXMgdGhlIGFyZ3VtZW50cyBmcm9tIHRoZSBldmVudCBoYW5kbGVyIHRvIHByb2R1Y2UgYSBzaW5nbGUgaXRlbSB0byB5aWVsZCBvbiBuZXh0LlxuICAgKiBAcmV0dXJucyB7T2JzZXJ2YWJsZX0gQW4gb2JzZXJ2YWJsZSBzZXF1ZW5jZSBvZiBldmVudHMgZnJvbSB0aGUgc3BlY2lmaWVkIGVsZW1lbnQgYW5kIHRoZSBzcGVjaWZpZWQgZXZlbnQuXG4gICAqL1xuICBPYnNlcnZhYmxlLmZyb21FdmVudCA9IGZ1bmN0aW9uIChlbGVtZW50LCBldmVudE5hbWUsIHNlbGVjdG9yKSB7XG4gICAgLy8gTm9kZS5qcyBzcGVjaWZpY1xuICAgIGlmIChlbGVtZW50LmFkZExpc3RlbmVyKSB7XG4gICAgICByZXR1cm4gZnJvbUV2ZW50UGF0dGVybihcbiAgICAgICAgZnVuY3Rpb24gKGgpIHsgZWxlbWVudC5hZGRMaXN0ZW5lcihldmVudE5hbWUsIGgpOyB9LFxuICAgICAgICBmdW5jdGlvbiAoaCkgeyBlbGVtZW50LnJlbW92ZUxpc3RlbmVyKGV2ZW50TmFtZSwgaCk7IH0sXG4gICAgICAgIHNlbGVjdG9yKTtcbiAgICB9XG5cbiAgICAvLyBVc2Ugb25seSBpZiBub24tbmF0aXZlIGV2ZW50cyBhcmUgYWxsb3dlZFxuICAgIGlmICghUnguY29uZmlnLnVzZU5hdGl2ZUV2ZW50cykge1xuICAgICAgLy8gSGFuZGxlcyBqcSwgQW5ndWxhci5qcywgWmVwdG8sIE1hcmlvbmV0dGUsIEVtYmVyLmpzXG4gICAgICBpZiAodHlwZW9mIGVsZW1lbnQub24gPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mIGVsZW1lbnQub2ZmID09PSAnZnVuY3Rpb24nKSB7XG4gICAgICAgIHJldHVybiBmcm9tRXZlbnRQYXR0ZXJuKFxuICAgICAgICAgIGZ1bmN0aW9uIChoKSB7IGVsZW1lbnQub24oZXZlbnROYW1lLCBoKTsgfSxcbiAgICAgICAgICBmdW5jdGlvbiAoaCkgeyBlbGVtZW50Lm9mZihldmVudE5hbWUsIGgpOyB9LFxuICAgICAgICAgIHNlbGVjdG9yKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICByZXR1cm4gbmV3IEFub255bW91c09ic2VydmFibGUoZnVuY3Rpb24gKG8pIHtcbiAgICAgIHJldHVybiBjcmVhdGVFdmVudExpc3RlbmVyKFxuICAgICAgICBlbGVtZW50LFxuICAgICAgICBldmVudE5hbWUsXG4gICAgICAgIGV2ZW50SGFuZGxlcihvLCBzZWxlY3RvcikpO1xuICAgIH0pLnB1Ymxpc2goKS5yZWZDb3VudCgpO1xuICB9O1xuXG4gIC8qKlxuICAgKiBDcmVhdGVzIGFuIG9ic2VydmFibGUgc2VxdWVuY2UgZnJvbSBhbiBldmVudCBlbWl0dGVyIHZpYSBhbiBhZGRIYW5kbGVyL3JlbW92ZUhhbmRsZXIgcGFpci5cbiAgICogQHBhcmFtIHtGdW5jdGlvbn0gYWRkSGFuZGxlciBUaGUgZnVuY3Rpb24gdG8gYWRkIGEgaGFuZGxlciB0byB0aGUgZW1pdHRlci5cbiAgICogQHBhcmFtIHtGdW5jdGlvbn0gW3JlbW92ZUhhbmRsZXJdIFRoZSBvcHRpb25hbCBmdW5jdGlvbiB0byByZW1vdmUgYSBoYW5kbGVyIGZyb20gYW4gZW1pdHRlci5cbiAgICogQHBhcmFtIHtGdW5jdGlvbn0gW3NlbGVjdG9yXSBBIHNlbGVjdG9yIHdoaWNoIHRha2VzIHRoZSBhcmd1bWVudHMgZnJvbSB0aGUgZXZlbnQgaGFuZGxlciB0byBwcm9kdWNlIGEgc2luZ2xlIGl0ZW0gdG8geWllbGQgb24gbmV4dC5cbiAgICogQHBhcmFtIHtTY2hlZHVsZXJ9IFtzY2hlZHVsZXJdIEEgc2NoZWR1bGVyIHVzZWQgdG8gc2NoZWR1bGUgdGhlIHJlbW92ZSBoYW5kbGVyLlxuICAgKiBAcmV0dXJucyB7T2JzZXJ2YWJsZX0gQW4gb2JzZXJ2YWJsZSBzZXF1ZW5jZSB3aGljaCB3cmFwcyBhbiBldmVudCBmcm9tIGFuIGV2ZW50IGVtaXR0ZXJcbiAgICovXG4gIHZhciBmcm9tRXZlbnRQYXR0ZXJuID0gT2JzZXJ2YWJsZS5mcm9tRXZlbnRQYXR0ZXJuID0gZnVuY3Rpb24gKGFkZEhhbmRsZXIsIHJlbW92ZUhhbmRsZXIsIHNlbGVjdG9yLCBzY2hlZHVsZXIpIHtcbiAgICBpc1NjaGVkdWxlcihzY2hlZHVsZXIpIHx8IChzY2hlZHVsZXIgPSBpbW1lZGlhdGVTY2hlZHVsZXIpO1xuICAgIHJldHVybiBuZXcgQW5vbnltb3VzT2JzZXJ2YWJsZShmdW5jdGlvbiAobykge1xuICAgICAgZnVuY3Rpb24gaW5uZXJIYW5kbGVyICgpIHtcbiAgICAgICAgdmFyIHJlc3VsdCA9IGFyZ3VtZW50c1swXTtcbiAgICAgICAgaWYgKGlzRnVuY3Rpb24oc2VsZWN0b3IpKSB7XG4gICAgICAgICAgcmVzdWx0ID0gdHJ5Q2F0Y2goc2VsZWN0b3IpLmFwcGx5KG51bGwsIGFyZ3VtZW50cyk7XG4gICAgICAgICAgaWYgKHJlc3VsdCA9PT0gZXJyb3JPYmopIHsgcmV0dXJuIG8ub25FcnJvcihyZXN1bHQuZSk7IH1cbiAgICAgICAgfVxuICAgICAgICBvLm9uTmV4dChyZXN1bHQpO1xuICAgICAgfVxuXG4gICAgICB2YXIgcmV0dXJuVmFsdWUgPSBhZGRIYW5kbGVyKGlubmVySGFuZGxlcik7XG4gICAgICByZXR1cm4gZGlzcG9zYWJsZUNyZWF0ZShmdW5jdGlvbiAoKSB7XG4gICAgICAgIGlzRnVuY3Rpb24ocmVtb3ZlSGFuZGxlcikgJiYgcmVtb3ZlSGFuZGxlcihpbm5lckhhbmRsZXIsIHJldHVyblZhbHVlKTtcbiAgICAgIH0pO1xuICAgIH0pLnB1Ymxpc2goKS5yZWZDb3VudCgpO1xuICB9O1xuXG4gIC8qKlxuICAgKiBJbnZva2VzIHRoZSBhc3luY2hyb25vdXMgZnVuY3Rpb24sIHN1cmZhY2luZyB0aGUgcmVzdWx0IHRocm91Z2ggYW4gb2JzZXJ2YWJsZSBzZXF1ZW5jZS5cbiAgICogQHBhcmFtIHtGdW5jdGlvbn0gZnVuY3Rpb25Bc3luYyBBc3luY2hyb25vdXMgZnVuY3Rpb24gd2hpY2ggcmV0dXJucyBhIFByb21pc2UgdG8gcnVuLlxuICAgKiBAcmV0dXJucyB7T2JzZXJ2YWJsZX0gQW4gb2JzZXJ2YWJsZSBzZXF1ZW5jZSBleHBvc2luZyB0aGUgZnVuY3Rpb24ncyByZXN1bHQgdmFsdWUsIG9yIGFuIGV4Y2VwdGlvbi5cbiAgICovXG4gIE9ic2VydmFibGUuc3RhcnRBc3luYyA9IGZ1bmN0aW9uIChmdW5jdGlvbkFzeW5jKSB7XG4gICAgdmFyIHByb21pc2UgPSB0cnlDYXRjaChmdW5jdGlvbkFzeW5jKSgpO1xuICAgIGlmIChwcm9taXNlID09PSBlcnJvck9iaikgeyByZXR1cm4gb2JzZXJ2YWJsZVRocm93KHByb21pc2UuZSk7IH1cbiAgICByZXR1cm4gb2JzZXJ2YWJsZUZyb21Qcm9taXNlKHByb21pc2UpO1xuICB9O1xuXG4gIHZhciBQYXVzYWJsZU9ic2VydmFibGUgPSAoZnVuY3Rpb24gKF9fc3VwZXJfXykge1xuICAgIGluaGVyaXRzKFBhdXNhYmxlT2JzZXJ2YWJsZSwgX19zdXBlcl9fKTtcbiAgICBmdW5jdGlvbiBQYXVzYWJsZU9ic2VydmFibGUoc291cmNlLCBwYXVzZXIpIHtcbiAgICAgIHRoaXMuc291cmNlID0gc291cmNlO1xuICAgICAgdGhpcy5jb250cm9sbGVyID0gbmV3IFN1YmplY3QoKTtcblxuICAgICAgaWYgKHBhdXNlciAmJiBwYXVzZXIuc3Vic2NyaWJlKSB7XG4gICAgICAgIHRoaXMucGF1c2VyID0gdGhpcy5jb250cm9sbGVyLm1lcmdlKHBhdXNlcik7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICB0aGlzLnBhdXNlciA9IHRoaXMuY29udHJvbGxlcjtcbiAgICAgIH1cblxuICAgICAgX19zdXBlcl9fLmNhbGwodGhpcyk7XG4gICAgfVxuXG4gICAgUGF1c2FibGVPYnNlcnZhYmxlLnByb3RvdHlwZS5fc3Vic2NyaWJlID0gZnVuY3Rpb24gKG8pIHtcbiAgICAgIHZhciBjb25uID0gdGhpcy5zb3VyY2UucHVibGlzaCgpLFxuICAgICAgICBzdWJzY3JpcHRpb24gPSBjb25uLnN1YnNjcmliZShvKSxcbiAgICAgICAgY29ubmVjdGlvbiA9IGRpc3Bvc2FibGVFbXB0eTtcblxuICAgICAgdmFyIHBhdXNhYmxlID0gdGhpcy5wYXVzZXIuZGlzdGluY3RVbnRpbENoYW5nZWQoKS5zdWJzY3JpYmUoZnVuY3Rpb24gKGIpIHtcbiAgICAgICAgaWYgKGIpIHtcbiAgICAgICAgICBjb25uZWN0aW9uID0gY29ubi5jb25uZWN0KCk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgY29ubmVjdGlvbi5kaXNwb3NlKCk7XG4gICAgICAgICAgY29ubmVjdGlvbiA9IGRpc3Bvc2FibGVFbXB0eTtcbiAgICAgICAgfVxuICAgICAgfSk7XG5cbiAgICAgIHJldHVybiBuZXcgTkFyeURpc3Bvc2FibGUoW3N1YnNjcmlwdGlvbiwgY29ubmVjdGlvbiwgcGF1c2FibGVdKTtcbiAgICB9O1xuXG4gICAgUGF1c2FibGVPYnNlcnZhYmxlLnByb3RvdHlwZS5wYXVzZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgIHRoaXMuY29udHJvbGxlci5vbk5leHQoZmFsc2UpO1xuICAgIH07XG5cbiAgICBQYXVzYWJsZU9ic2VydmFibGUucHJvdG90eXBlLnJlc3VtZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgIHRoaXMuY29udHJvbGxlci5vbk5leHQodHJ1ZSk7XG4gICAgfTtcblxuICAgIHJldHVybiBQYXVzYWJsZU9ic2VydmFibGU7XG5cbiAgfShPYnNlcnZhYmxlKSk7XG5cbiAgLyoqXG4gICAqIFBhdXNlcyB0aGUgdW5kZXJseWluZyBvYnNlcnZhYmxlIHNlcXVlbmNlIGJhc2VkIHVwb24gdGhlIG9ic2VydmFibGUgc2VxdWVuY2Ugd2hpY2ggeWllbGRzIHRydWUvZmFsc2UuXG4gICAqIEBleGFtcGxlXG4gICAqIHZhciBwYXVzZXIgPSBuZXcgUnguU3ViamVjdCgpO1xuICAgKiB2YXIgc291cmNlID0gUnguT2JzZXJ2YWJsZS5pbnRlcnZhbCgxMDApLnBhdXNhYmxlKHBhdXNlcik7XG4gICAqIEBwYXJhbSB7T2JzZXJ2YWJsZX0gcGF1c2VyIFRoZSBvYnNlcnZhYmxlIHNlcXVlbmNlIHVzZWQgdG8gcGF1c2UgdGhlIHVuZGVybHlpbmcgc2VxdWVuY2UuXG4gICAqIEByZXR1cm5zIHtPYnNlcnZhYmxlfSBUaGUgb2JzZXJ2YWJsZSBzZXF1ZW5jZSB3aGljaCBpcyBwYXVzZWQgYmFzZWQgdXBvbiB0aGUgcGF1c2VyLlxuICAgKi9cbiAgb2JzZXJ2YWJsZVByb3RvLnBhdXNhYmxlID0gZnVuY3Rpb24gKHBhdXNlcikge1xuICAgIHJldHVybiBuZXcgUGF1c2FibGVPYnNlcnZhYmxlKHRoaXMsIHBhdXNlcik7XG4gIH07XG5cbiAgZnVuY3Rpb24gY29tYmluZUxhdGVzdFNvdXJjZShzb3VyY2UsIHN1YmplY3QsIHJlc3VsdFNlbGVjdG9yKSB7XG4gICAgcmV0dXJuIG5ldyBBbm9ueW1vdXNPYnNlcnZhYmxlKGZ1bmN0aW9uIChvKSB7XG4gICAgICB2YXIgaGFzVmFsdWUgPSBbZmFsc2UsIGZhbHNlXSxcbiAgICAgICAgaGFzVmFsdWVBbGwgPSBmYWxzZSxcbiAgICAgICAgaXNEb25lID0gZmFsc2UsXG4gICAgICAgIHZhbHVlcyA9IG5ldyBBcnJheSgyKSxcbiAgICAgICAgZXJyO1xuXG4gICAgICBmdW5jdGlvbiBuZXh0KHgsIGkpIHtcbiAgICAgICAgdmFsdWVzW2ldID0geDtcbiAgICAgICAgaGFzVmFsdWVbaV0gPSB0cnVlO1xuICAgICAgICBpZiAoaGFzVmFsdWVBbGwgfHwgKGhhc1ZhbHVlQWxsID0gaGFzVmFsdWUuZXZlcnkoaWRlbnRpdHkpKSkge1xuICAgICAgICAgIGlmIChlcnIpIHsgcmV0dXJuIG8ub25FcnJvcihlcnIpOyB9XG4gICAgICAgICAgdmFyIHJlcyA9IHRyeUNhdGNoKHJlc3VsdFNlbGVjdG9yKS5hcHBseShudWxsLCB2YWx1ZXMpO1xuICAgICAgICAgIGlmIChyZXMgPT09IGVycm9yT2JqKSB7IHJldHVybiBvLm9uRXJyb3IocmVzLmUpOyB9XG4gICAgICAgICAgby5vbk5leHQocmVzKTtcbiAgICAgICAgfVxuICAgICAgICBpc0RvbmUgJiYgdmFsdWVzWzFdICYmIG8ub25Db21wbGV0ZWQoKTtcbiAgICAgIH1cblxuICAgICAgcmV0dXJuIG5ldyBCaW5hcnlEaXNwb3NhYmxlKFxuICAgICAgICBzb3VyY2Uuc3Vic2NyaWJlKFxuICAgICAgICAgIGZ1bmN0aW9uICh4KSB7XG4gICAgICAgICAgICBuZXh0KHgsIDApO1xuICAgICAgICAgIH0sXG4gICAgICAgICAgZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgICAgIGlmICh2YWx1ZXNbMV0pIHtcbiAgICAgICAgICAgICAgby5vbkVycm9yKGUpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgZXJyID0gZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9LFxuICAgICAgICAgIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIGlzRG9uZSA9IHRydWU7XG4gICAgICAgICAgICB2YWx1ZXNbMV0gJiYgby5vbkNvbXBsZXRlZCgpO1xuICAgICAgICAgIH0pLFxuICAgICAgICBzdWJqZWN0LnN1YnNjcmliZShcbiAgICAgICAgICBmdW5jdGlvbiAoeCkge1xuICAgICAgICAgICAgbmV4dCh4LCAxKTtcbiAgICAgICAgICB9LFxuICAgICAgICAgIGZ1bmN0aW9uIChlKSB7IG8ub25FcnJvcihlKTsgfSxcbiAgICAgICAgICBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICBpc0RvbmUgPSB0cnVlO1xuICAgICAgICAgICAgbmV4dCh0cnVlLCAxKTtcbiAgICAgICAgICB9KVxuICAgICAgICApO1xuICAgIH0sIHNvdXJjZSk7XG4gIH1cblxuICB2YXIgUGF1c2FibGVCdWZmZXJlZE9ic2VydmFibGUgPSAoZnVuY3Rpb24gKF9fc3VwZXJfXykge1xuICAgIGluaGVyaXRzKFBhdXNhYmxlQnVmZmVyZWRPYnNlcnZhYmxlLCBfX3N1cGVyX18pO1xuICAgIGZ1bmN0aW9uIFBhdXNhYmxlQnVmZmVyZWRPYnNlcnZhYmxlKHNvdXJjZSwgcGF1c2VyKSB7XG4gICAgICB0aGlzLnNvdXJjZSA9IHNvdXJjZTtcbiAgICAgIHRoaXMuY29udHJvbGxlciA9IG5ldyBTdWJqZWN0KCk7XG5cbiAgICAgIGlmIChwYXVzZXIgJiYgcGF1c2VyLnN1YnNjcmliZSkge1xuICAgICAgICB0aGlzLnBhdXNlciA9IHRoaXMuY29udHJvbGxlci5tZXJnZShwYXVzZXIpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdGhpcy5wYXVzZXIgPSB0aGlzLmNvbnRyb2xsZXI7XG4gICAgICB9XG5cbiAgICAgIF9fc3VwZXJfXy5jYWxsKHRoaXMpO1xuICAgIH1cblxuICAgIFBhdXNhYmxlQnVmZmVyZWRPYnNlcnZhYmxlLnByb3RvdHlwZS5fc3Vic2NyaWJlID0gZnVuY3Rpb24gKG8pIHtcbiAgICAgIHZhciBxID0gW10sIHByZXZpb3VzU2hvdWxkRmlyZTtcblxuICAgICAgZnVuY3Rpb24gZHJhaW5RdWV1ZSgpIHsgd2hpbGUgKHEubGVuZ3RoID4gMCkgeyBvLm9uTmV4dChxLnNoaWZ0KCkpOyB9IH1cblxuICAgICAgdmFyIHN1YnNjcmlwdGlvbiA9XG4gICAgICAgIGNvbWJpbmVMYXRlc3RTb3VyY2UoXG4gICAgICAgICAgdGhpcy5zb3VyY2UsXG4gICAgICAgICAgdGhpcy5wYXVzZXIuc3RhcnRXaXRoKGZhbHNlKS5kaXN0aW5jdFVudGlsQ2hhbmdlZCgpLFxuICAgICAgICAgIGZ1bmN0aW9uIChkYXRhLCBzaG91bGRGaXJlKSB7XG4gICAgICAgICAgICByZXR1cm4geyBkYXRhOiBkYXRhLCBzaG91bGRGaXJlOiBzaG91bGRGaXJlIH07XG4gICAgICAgICAgfSlcbiAgICAgICAgICAuc3Vic2NyaWJlKFxuICAgICAgICAgICAgZnVuY3Rpb24gKHJlc3VsdHMpIHtcbiAgICAgICAgICAgICAgaWYgKHByZXZpb3VzU2hvdWxkRmlyZSAhPT0gdW5kZWZpbmVkICYmIHJlc3VsdHMuc2hvdWxkRmlyZSAhPT0gcHJldmlvdXNTaG91bGRGaXJlKSB7XG4gICAgICAgICAgICAgICAgcHJldmlvdXNTaG91bGRGaXJlID0gcmVzdWx0cy5zaG91bGRGaXJlO1xuICAgICAgICAgICAgICAgIC8vIGNoYW5nZSBpbiBzaG91bGRGaXJlXG4gICAgICAgICAgICAgICAgaWYgKHJlc3VsdHMuc2hvdWxkRmlyZSkgeyBkcmFpblF1ZXVlKCk7IH1cbiAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBwcmV2aW91c1Nob3VsZEZpcmUgPSByZXN1bHRzLnNob3VsZEZpcmU7XG4gICAgICAgICAgICAgICAgLy8gbmV3IGRhdGFcbiAgICAgICAgICAgICAgICBpZiAocmVzdWx0cy5zaG91bGRGaXJlKSB7XG4gICAgICAgICAgICAgICAgICBvLm9uTmV4dChyZXN1bHRzLmRhdGEpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICBxLnB1c2gocmVzdWx0cy5kYXRhKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBmdW5jdGlvbiAoZXJyKSB7XG4gICAgICAgICAgICAgIGRyYWluUXVldWUoKTtcbiAgICAgICAgICAgICAgby5vbkVycm9yKGVycik7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICBkcmFpblF1ZXVlKCk7XG4gICAgICAgICAgICAgIG8ub25Db21wbGV0ZWQoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICApO1xuICAgICAgcmV0dXJuIHN1YnNjcmlwdGlvbjsgICAgICBcbiAgICB9O1xuXG4gICAgUGF1c2FibGVCdWZmZXJlZE9ic2VydmFibGUucHJvdG90eXBlLnBhdXNlID0gZnVuY3Rpb24gKCkge1xuICAgICAgdGhpcy5jb250cm9sbGVyLm9uTmV4dChmYWxzZSk7XG4gICAgfTtcblxuICAgIFBhdXNhYmxlQnVmZmVyZWRPYnNlcnZhYmxlLnByb3RvdHlwZS5yZXN1bWUgPSBmdW5jdGlvbiAoKSB7XG4gICAgICB0aGlzLmNvbnRyb2xsZXIub25OZXh0KHRydWUpO1xuICAgIH07XG5cbiAgICByZXR1cm4gUGF1c2FibGVCdWZmZXJlZE9ic2VydmFibGU7XG5cbiAgfShPYnNlcnZhYmxlKSk7XG5cbiAgLyoqXG4gICAqIFBhdXNlcyB0aGUgdW5kZXJseWluZyBvYnNlcnZhYmxlIHNlcXVlbmNlIGJhc2VkIHVwb24gdGhlIG9ic2VydmFibGUgc2VxdWVuY2Ugd2hpY2ggeWllbGRzIHRydWUvZmFsc2UsXG4gICAqIGFuZCB5aWVsZHMgdGhlIHZhbHVlcyB0aGF0IHdlcmUgYnVmZmVyZWQgd2hpbGUgcGF1c2VkLlxuICAgKiBAZXhhbXBsZVxuICAgKiB2YXIgcGF1c2VyID0gbmV3IFJ4LlN1YmplY3QoKTtcbiAgICogdmFyIHNvdXJjZSA9IFJ4Lk9ic2VydmFibGUuaW50ZXJ2YWwoMTAwKS5wYXVzYWJsZUJ1ZmZlcmVkKHBhdXNlcik7XG4gICAqIEBwYXJhbSB7T2JzZXJ2YWJsZX0gcGF1c2VyIFRoZSBvYnNlcnZhYmxlIHNlcXVlbmNlIHVzZWQgdG8gcGF1c2UgdGhlIHVuZGVybHlpbmcgc2VxdWVuY2UuXG4gICAqIEByZXR1cm5zIHtPYnNlcnZhYmxlfSBUaGUgb2JzZXJ2YWJsZSBzZXF1ZW5jZSB3aGljaCBpcyBwYXVzZWQgYmFzZWQgdXBvbiB0aGUgcGF1c2VyLlxuICAgKi9cbiAgb2JzZXJ2YWJsZVByb3RvLnBhdXNhYmxlQnVmZmVyZWQgPSBmdW5jdGlvbiAoc3ViamVjdCkge1xuICAgIHJldHVybiBuZXcgUGF1c2FibGVCdWZmZXJlZE9ic2VydmFibGUodGhpcywgc3ViamVjdCk7XG4gIH07XG5cbiAgdmFyIENvbnRyb2xsZWRPYnNlcnZhYmxlID0gKGZ1bmN0aW9uIChfX3N1cGVyX18pIHtcbiAgICBpbmhlcml0cyhDb250cm9sbGVkT2JzZXJ2YWJsZSwgX19zdXBlcl9fKTtcbiAgICBmdW5jdGlvbiBDb250cm9sbGVkT2JzZXJ2YWJsZSAoc291cmNlLCBlbmFibGVRdWV1ZSwgc2NoZWR1bGVyKSB7XG4gICAgICBfX3N1cGVyX18uY2FsbCh0aGlzKTtcbiAgICAgIHRoaXMuc3ViamVjdCA9IG5ldyBDb250cm9sbGVkU3ViamVjdChlbmFibGVRdWV1ZSwgc2NoZWR1bGVyKTtcbiAgICAgIHRoaXMuc291cmNlID0gc291cmNlLm11bHRpY2FzdCh0aGlzLnN1YmplY3QpLnJlZkNvdW50KCk7XG4gICAgfVxuXG4gICAgQ29udHJvbGxlZE9ic2VydmFibGUucHJvdG90eXBlLl9zdWJzY3JpYmUgPSBmdW5jdGlvbiAobykge1xuICAgICAgcmV0dXJuIHRoaXMuc291cmNlLnN1YnNjcmliZShvKTtcbiAgICB9O1xuXG4gICAgQ29udHJvbGxlZE9ic2VydmFibGUucHJvdG90eXBlLnJlcXVlc3QgPSBmdW5jdGlvbiAobnVtYmVyT2ZJdGVtcykge1xuICAgICAgcmV0dXJuIHRoaXMuc3ViamVjdC5yZXF1ZXN0KG51bWJlck9mSXRlbXMgPT0gbnVsbCA/IC0xIDogbnVtYmVyT2ZJdGVtcyk7XG4gICAgfTtcblxuICAgIHJldHVybiBDb250cm9sbGVkT2JzZXJ2YWJsZTtcblxuICB9KE9ic2VydmFibGUpKTtcblxuICB2YXIgQ29udHJvbGxlZFN1YmplY3QgPSAoZnVuY3Rpb24gKF9fc3VwZXJfXykge1xuICAgIGluaGVyaXRzKENvbnRyb2xsZWRTdWJqZWN0LCBfX3N1cGVyX18pO1xuICAgIGZ1bmN0aW9uIENvbnRyb2xsZWRTdWJqZWN0KGVuYWJsZVF1ZXVlLCBzY2hlZHVsZXIpIHtcbiAgICAgIGVuYWJsZVF1ZXVlID09IG51bGwgJiYgKGVuYWJsZVF1ZXVlID0gdHJ1ZSk7XG5cbiAgICAgIF9fc3VwZXJfXy5jYWxsKHRoaXMpO1xuICAgICAgdGhpcy5zdWJqZWN0ID0gbmV3IFN1YmplY3QoKTtcbiAgICAgIHRoaXMuZW5hYmxlUXVldWUgPSBlbmFibGVRdWV1ZTtcbiAgICAgIHRoaXMucXVldWUgPSBlbmFibGVRdWV1ZSA/IFtdIDogbnVsbDtcbiAgICAgIHRoaXMucmVxdWVzdGVkQ291bnQgPSAwO1xuICAgICAgdGhpcy5yZXF1ZXN0ZWREaXNwb3NhYmxlID0gbnVsbDtcbiAgICAgIHRoaXMuZXJyb3IgPSBudWxsO1xuICAgICAgdGhpcy5oYXNGYWlsZWQgPSBmYWxzZTtcbiAgICAgIHRoaXMuaGFzQ29tcGxldGVkID0gZmFsc2U7XG4gICAgICB0aGlzLnNjaGVkdWxlciA9IHNjaGVkdWxlciB8fCBjdXJyZW50VGhyZWFkU2NoZWR1bGVyO1xuICAgIH1cblxuICAgIGFkZFByb3BlcnRpZXMoQ29udHJvbGxlZFN1YmplY3QucHJvdG90eXBlLCBPYnNlcnZlciwge1xuICAgICAgX3N1YnNjcmliZTogZnVuY3Rpb24gKG8pIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuc3ViamVjdC5zdWJzY3JpYmUobyk7XG4gICAgICB9LFxuICAgICAgb25Db21wbGV0ZWQ6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdGhpcy5oYXNDb21wbGV0ZWQgPSB0cnVlO1xuICAgICAgICBpZiAoIXRoaXMuZW5hYmxlUXVldWUgfHwgdGhpcy5xdWV1ZS5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICB0aGlzLnN1YmplY3Qub25Db21wbGV0ZWQoKTtcbiAgICAgICAgICB0aGlzLmRpc3Bvc2VDdXJyZW50UmVxdWVzdCgpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHRoaXMucXVldWUucHVzaChOb3RpZmljYXRpb24uY3JlYXRlT25Db21wbGV0ZWQoKSk7XG4gICAgICAgIH1cbiAgICAgIH0sXG4gICAgICBvbkVycm9yOiBmdW5jdGlvbiAoZXJyb3IpIHtcbiAgICAgICAgdGhpcy5oYXNGYWlsZWQgPSB0cnVlO1xuICAgICAgICB0aGlzLmVycm9yID0gZXJyb3I7XG4gICAgICAgIGlmICghdGhpcy5lbmFibGVRdWV1ZSB8fCB0aGlzLnF1ZXVlLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICAgIHRoaXMuc3ViamVjdC5vbkVycm9yKGVycm9yKTtcbiAgICAgICAgICB0aGlzLmRpc3Bvc2VDdXJyZW50UmVxdWVzdCgpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHRoaXMucXVldWUucHVzaChOb3RpZmljYXRpb24uY3JlYXRlT25FcnJvcihlcnJvcikpO1xuICAgICAgICB9XG4gICAgICB9LFxuICAgICAgb25OZXh0OiBmdW5jdGlvbiAodmFsdWUpIHtcbiAgICAgICAgaWYgKHRoaXMucmVxdWVzdGVkQ291bnQgPD0gMCkge1xuICAgICAgICAgIHRoaXMuZW5hYmxlUXVldWUgJiYgdGhpcy5xdWV1ZS5wdXNoKE5vdGlmaWNhdGlvbi5jcmVhdGVPbk5leHQodmFsdWUpKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAodGhpcy5yZXF1ZXN0ZWRDb3VudC0tID09PSAwKSAmJiB0aGlzLmRpc3Bvc2VDdXJyZW50UmVxdWVzdCgpO1xuICAgICAgICAgIHRoaXMuc3ViamVjdC5vbk5leHQodmFsdWUpO1xuICAgICAgICB9XG4gICAgICB9LFxuICAgICAgX3Byb2Nlc3NSZXF1ZXN0OiBmdW5jdGlvbiAobnVtYmVyT2ZJdGVtcykge1xuICAgICAgICBpZiAodGhpcy5lbmFibGVRdWV1ZSkge1xuICAgICAgICAgIHdoaWxlICh0aGlzLnF1ZXVlLmxlbmd0aCA+IDAgJiYgKG51bWJlck9mSXRlbXMgPiAwIHx8IHRoaXMucXVldWVbMF0ua2luZCAhPT0gJ04nKSkge1xuICAgICAgICAgICAgdmFyIGZpcnN0ID0gdGhpcy5xdWV1ZS5zaGlmdCgpO1xuICAgICAgICAgICAgZmlyc3QuYWNjZXB0KHRoaXMuc3ViamVjdCk7XG4gICAgICAgICAgICBpZiAoZmlyc3Qua2luZCA9PT0gJ04nKSB7XG4gICAgICAgICAgICAgIG51bWJlck9mSXRlbXMtLTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgIHRoaXMuZGlzcG9zZUN1cnJlbnRSZXF1ZXN0KCk7XG4gICAgICAgICAgICAgIHRoaXMucXVldWUgPSBbXTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gbnVtYmVyT2ZJdGVtcztcbiAgICAgIH0sXG4gICAgICByZXF1ZXN0OiBmdW5jdGlvbiAobnVtYmVyKSB7XG4gICAgICAgIHRoaXMuZGlzcG9zZUN1cnJlbnRSZXF1ZXN0KCk7XG4gICAgICAgIHZhciBzZWxmID0gdGhpcztcblxuICAgICAgICB0aGlzLnJlcXVlc3RlZERpc3Bvc2FibGUgPSB0aGlzLnNjaGVkdWxlci5zY2hlZHVsZShudW1iZXIsXG4gICAgICAgIGZ1bmN0aW9uKHMsIGkpIHtcbiAgICAgICAgICB2YXIgcmVtYWluaW5nID0gc2VsZi5fcHJvY2Vzc1JlcXVlc3QoaSk7XG4gICAgICAgICAgdmFyIHN0b3BwZWQgPSBzZWxmLmhhc0NvbXBsZXRlZCB8fCBzZWxmLmhhc0ZhaWxlZDtcbiAgICAgICAgICBpZiAoIXN0b3BwZWQgJiYgcmVtYWluaW5nID4gMCkge1xuICAgICAgICAgICAgc2VsZi5yZXF1ZXN0ZWRDb3VudCA9IHJlbWFpbmluZztcblxuICAgICAgICAgICAgcmV0dXJuIGRpc3Bvc2FibGVDcmVhdGUoZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICBzZWxmLnJlcXVlc3RlZENvdW50ID0gMDtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAvLyBTY2hlZHVsZWQgaXRlbSBpcyBzdGlsbCBpbiBwcm9ncmVzcy4gUmV0dXJuIGEgbmV3XG4gICAgICAgICAgICAgIC8vIGRpc3Bvc2FibGUgdG8gYWxsb3cgdGhlIHJlcXVlc3QgdG8gYmUgaW50ZXJydXB0ZWRcbiAgICAgICAgICAgICAgLy8gdmlhIGRpc3Bvc2UuXG4gICAgICAgICAgfVxuICAgICAgICB9KTtcblxuICAgICAgICByZXR1cm4gdGhpcy5yZXF1ZXN0ZWREaXNwb3NhYmxlO1xuICAgICAgfSxcbiAgICAgIGRpc3Bvc2VDdXJyZW50UmVxdWVzdDogZnVuY3Rpb24gKCkge1xuICAgICAgICBpZiAodGhpcy5yZXF1ZXN0ZWREaXNwb3NhYmxlKSB7XG4gICAgICAgICAgdGhpcy5yZXF1ZXN0ZWREaXNwb3NhYmxlLmRpc3Bvc2UoKTtcbiAgICAgICAgICB0aGlzLnJlcXVlc3RlZERpc3Bvc2FibGUgPSBudWxsO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfSk7XG5cbiAgICByZXR1cm4gQ29udHJvbGxlZFN1YmplY3Q7XG4gIH0oT2JzZXJ2YWJsZSkpO1xuXG4gIC8qKlxuICAgKiBBdHRhY2hlcyBhIGNvbnRyb2xsZXIgdG8gdGhlIG9ic2VydmFibGUgc2VxdWVuY2Ugd2l0aCB0aGUgYWJpbGl0eSB0byBxdWV1ZS5cbiAgICogQGV4YW1wbGVcbiAgICogdmFyIHNvdXJjZSA9IFJ4Lk9ic2VydmFibGUuaW50ZXJ2YWwoMTAwKS5jb250cm9sbGVkKCk7XG4gICAqIHNvdXJjZS5yZXF1ZXN0KDMpOyAvLyBSZWFkcyAzIHZhbHVlc1xuICAgKiBAcGFyYW0ge2Jvb2x9IGVuYWJsZVF1ZXVlIHRydXRoeSB2YWx1ZSB0byBkZXRlcm1pbmUgaWYgdmFsdWVzIHNob3VsZCBiZSBxdWV1ZWQgcGVuZGluZyB0aGUgbmV4dCByZXF1ZXN0XG4gICAqIEBwYXJhbSB7U2NoZWR1bGVyfSBzY2hlZHVsZXIgZGV0ZXJtaW5lcyBob3cgdGhlIHJlcXVlc3RzIHdpbGwgYmUgc2NoZWR1bGVkXG4gICAqIEByZXR1cm5zIHtPYnNlcnZhYmxlfSBUaGUgb2JzZXJ2YWJsZSBzZXF1ZW5jZSB3aGljaCBvbmx5IHByb3BhZ2F0ZXMgdmFsdWVzIG9uIHJlcXVlc3QuXG4gICAqL1xuICBvYnNlcnZhYmxlUHJvdG8uY29udHJvbGxlZCA9IGZ1bmN0aW9uIChlbmFibGVRdWV1ZSwgc2NoZWR1bGVyKSB7XG5cbiAgICBpZiAoZW5hYmxlUXVldWUgJiYgaXNTY2hlZHVsZXIoZW5hYmxlUXVldWUpKSB7XG4gICAgICBzY2hlZHVsZXIgPSBlbmFibGVRdWV1ZTtcbiAgICAgIGVuYWJsZVF1ZXVlID0gdHJ1ZTtcbiAgICB9XG5cbiAgICBpZiAoZW5hYmxlUXVldWUgPT0gbnVsbCkgeyAgZW5hYmxlUXVldWUgPSB0cnVlOyB9XG4gICAgcmV0dXJuIG5ldyBDb250cm9sbGVkT2JzZXJ2YWJsZSh0aGlzLCBlbmFibGVRdWV1ZSwgc2NoZWR1bGVyKTtcbiAgfTtcblxuICB2YXIgU3RvcEFuZFdhaXRPYnNlcnZhYmxlID0gKGZ1bmN0aW9uIChfX3N1cGVyX18pIHtcbiAgICBpbmhlcml0cyhTdG9wQW5kV2FpdE9ic2VydmFibGUsIF9fc3VwZXJfXyk7XG4gICAgZnVuY3Rpb24gU3RvcEFuZFdhaXRPYnNlcnZhYmxlIChzb3VyY2UpIHtcbiAgICAgIF9fc3VwZXJfXy5jYWxsKHRoaXMpO1xuICAgICAgdGhpcy5zb3VyY2UgPSBzb3VyY2U7XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gc2NoZWR1bGVNZXRob2Qocywgc2VsZikge1xuICAgICAgc2VsZi5zb3VyY2UucmVxdWVzdCgxKTtcbiAgICB9XG5cbiAgICBTdG9wQW5kV2FpdE9ic2VydmFibGUucHJvdG90eXBlLl9zdWJzY3JpYmUgPSBmdW5jdGlvbiAobykge1xuICAgICAgdGhpcy5zdWJzY3JpcHRpb24gPSB0aGlzLnNvdXJjZS5zdWJzY3JpYmUobmV3IFN0b3BBbmRXYWl0T2JzZXJ2ZXIobywgdGhpcywgdGhpcy5zdWJzY3JpcHRpb24pKTtcbiAgICAgIHJldHVybiBuZXcgQmluYXJ5RGlzcG9zYWJsZShcbiAgICAgICAgdGhpcy5zdWJzY3JpcHRpb24sXG4gICAgICAgIGRlZmF1bHRTY2hlZHVsZXIuc2NoZWR1bGUodGhpcywgc2NoZWR1bGVNZXRob2QpXG4gICAgICApO1xuICAgIH07XG5cbiAgICB2YXIgU3RvcEFuZFdhaXRPYnNlcnZlciA9IChmdW5jdGlvbiAoX19zdWJfXykge1xuICAgICAgaW5oZXJpdHMoU3RvcEFuZFdhaXRPYnNlcnZlciwgX19zdWJfXyk7XG4gICAgICBmdW5jdGlvbiBTdG9wQW5kV2FpdE9ic2VydmVyIChvYnNlcnZlciwgb2JzZXJ2YWJsZSwgY2FuY2VsKSB7XG4gICAgICAgIF9fc3ViX18uY2FsbCh0aGlzKTtcbiAgICAgICAgdGhpcy5vYnNlcnZlciA9IG9ic2VydmVyO1xuICAgICAgICB0aGlzLm9ic2VydmFibGUgPSBvYnNlcnZhYmxlO1xuICAgICAgICB0aGlzLmNhbmNlbCA9IGNhbmNlbDtcbiAgICAgICAgdGhpcy5zY2hlZHVsZURpc3Bvc2FibGUgPSBudWxsO1xuICAgICAgfVxuXG4gICAgICBTdG9wQW5kV2FpdE9ic2VydmVyLnByb3RvdHlwZS5jb21wbGV0ZWQgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHRoaXMub2JzZXJ2ZXIub25Db21wbGV0ZWQoKTtcbiAgICAgICAgdGhpcy5kaXNwb3NlKCk7XG4gICAgICB9O1xuXG4gICAgICBTdG9wQW5kV2FpdE9ic2VydmVyLnByb3RvdHlwZS5lcnJvciA9IGZ1bmN0aW9uIChlcnJvcikge1xuICAgICAgICB0aGlzLm9ic2VydmVyLm9uRXJyb3IoZXJyb3IpO1xuICAgICAgICB0aGlzLmRpc3Bvc2UoKTtcbiAgICAgIH07XG5cbiAgICAgIGZ1bmN0aW9uIGlubmVyU2NoZWR1bGVNZXRob2Qocywgc2VsZikge1xuICAgICAgICBzZWxmLm9ic2VydmFibGUuc291cmNlLnJlcXVlc3QoMSk7XG4gICAgICB9XG5cbiAgICAgIFN0b3BBbmRXYWl0T2JzZXJ2ZXIucHJvdG90eXBlLm5leHQgPSBmdW5jdGlvbiAodmFsdWUpIHtcbiAgICAgICAgdGhpcy5vYnNlcnZlci5vbk5leHQodmFsdWUpO1xuICAgICAgICB0aGlzLnNjaGVkdWxlRGlzcG9zYWJsZSA9IGRlZmF1bHRTY2hlZHVsZXIuc2NoZWR1bGUodGhpcywgaW5uZXJTY2hlZHVsZU1ldGhvZCk7XG4gICAgICB9O1xuXG4gICAgICBTdG9wQW5kV2FpdE9ic2VydmFibGUuZGlzcG9zZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdGhpcy5vYnNlcnZlciA9IG51bGw7XG4gICAgICAgIGlmICh0aGlzLmNhbmNlbCkge1xuICAgICAgICAgIHRoaXMuY2FuY2VsLmRpc3Bvc2UoKTtcbiAgICAgICAgICB0aGlzLmNhbmNlbCA9IG51bGw7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHRoaXMuc2NoZWR1bGVEaXNwb3NhYmxlKSB7XG4gICAgICAgICAgdGhpcy5zY2hlZHVsZURpc3Bvc2FibGUuZGlzcG9zZSgpO1xuICAgICAgICAgIHRoaXMuc2NoZWR1bGVEaXNwb3NhYmxlID0gbnVsbDtcbiAgICAgICAgfVxuICAgICAgICBfX3N1Yl9fLnByb3RvdHlwZS5kaXNwb3NlLmNhbGwodGhpcyk7XG4gICAgICB9O1xuXG4gICAgICByZXR1cm4gU3RvcEFuZFdhaXRPYnNlcnZlcjtcbiAgICB9KEFic3RyYWN0T2JzZXJ2ZXIpKTtcblxuICAgIHJldHVybiBTdG9wQW5kV2FpdE9ic2VydmFibGU7XG4gIH0oT2JzZXJ2YWJsZSkpO1xuXG5cbiAgLyoqXG4gICAqIEF0dGFjaGVzIGEgc3RvcCBhbmQgd2FpdCBvYnNlcnZhYmxlIHRvIHRoZSBjdXJyZW50IG9ic2VydmFibGUuXG4gICAqIEByZXR1cm5zIHtPYnNlcnZhYmxlfSBBIHN0b3AgYW5kIHdhaXQgb2JzZXJ2YWJsZS5cbiAgICovXG4gIENvbnRyb2xsZWRPYnNlcnZhYmxlLnByb3RvdHlwZS5zdG9wQW5kV2FpdCA9IGZ1bmN0aW9uICgpIHtcbiAgICByZXR1cm4gbmV3IFN0b3BBbmRXYWl0T2JzZXJ2YWJsZSh0aGlzKTtcbiAgfTtcblxuICB2YXIgV2luZG93ZWRPYnNlcnZhYmxlID0gKGZ1bmN0aW9uIChfX3N1cGVyX18pIHtcbiAgICBpbmhlcml0cyhXaW5kb3dlZE9ic2VydmFibGUsIF9fc3VwZXJfXyk7XG4gICAgZnVuY3Rpb24gV2luZG93ZWRPYnNlcnZhYmxlKHNvdXJjZSwgd2luZG93U2l6ZSkge1xuICAgICAgX19zdXBlcl9fLmNhbGwodGhpcyk7XG4gICAgICB0aGlzLnNvdXJjZSA9IHNvdXJjZTtcbiAgICAgIHRoaXMud2luZG93U2l6ZSA9IHdpbmRvd1NpemU7XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gc2NoZWR1bGVNZXRob2Qocywgc2VsZikge1xuICAgICAgc2VsZi5zb3VyY2UucmVxdWVzdChzZWxmLndpbmRvd1NpemUpO1xuICAgIH1cblxuICAgIFdpbmRvd2VkT2JzZXJ2YWJsZS5wcm90b3R5cGUuX3N1YnNjcmliZSA9IGZ1bmN0aW9uIChvKSB7XG4gICAgICB0aGlzLnN1YnNjcmlwdGlvbiA9IHRoaXMuc291cmNlLnN1YnNjcmliZShuZXcgV2luZG93ZWRPYnNlcnZlcihvLCB0aGlzLCB0aGlzLnN1YnNjcmlwdGlvbikpO1xuICAgICAgcmV0dXJuIG5ldyBCaW5hcnlEaXNwb3NhYmxlKFxuICAgICAgICB0aGlzLnN1YnNjcmlwdGlvbixcbiAgICAgICAgZGVmYXVsdFNjaGVkdWxlci5zY2hlZHVsZSh0aGlzLCBzY2hlZHVsZU1ldGhvZClcbiAgICAgICk7XG4gICAgfTtcblxuICAgIHZhciBXaW5kb3dlZE9ic2VydmVyID0gKGZ1bmN0aW9uIChfX3N1Yl9fKSB7XG4gICAgICBpbmhlcml0cyhXaW5kb3dlZE9ic2VydmVyLCBfX3N1Yl9fKTtcbiAgICAgIGZ1bmN0aW9uIFdpbmRvd2VkT2JzZXJ2ZXIob2JzZXJ2ZXIsIG9ic2VydmFibGUsIGNhbmNlbCkge1xuICAgICAgICB0aGlzLm9ic2VydmVyID0gb2JzZXJ2ZXI7XG4gICAgICAgIHRoaXMub2JzZXJ2YWJsZSA9IG9ic2VydmFibGU7XG4gICAgICAgIHRoaXMuY2FuY2VsID0gY2FuY2VsO1xuICAgICAgICB0aGlzLnJlY2VpdmVkID0gMDtcbiAgICAgICAgdGhpcy5zY2hlZHVsZURpc3Bvc2FibGUgPSBudWxsO1xuICAgICAgICBfX3N1Yl9fLmNhbGwodGhpcyk7XG4gICAgICB9XG5cbiAgICAgIFdpbmRvd2VkT2JzZXJ2ZXIucHJvdG90eXBlLmNvbXBsZXRlZCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdGhpcy5vYnNlcnZlci5vbkNvbXBsZXRlZCgpO1xuICAgICAgICB0aGlzLmRpc3Bvc2UoKTtcbiAgICAgIH07XG5cbiAgICAgIFdpbmRvd2VkT2JzZXJ2ZXIucHJvdG90eXBlLmVycm9yID0gZnVuY3Rpb24gKGVycm9yKSB7XG4gICAgICAgIHRoaXMub2JzZXJ2ZXIub25FcnJvcihlcnJvcik7XG4gICAgICAgIHRoaXMuZGlzcG9zZSgpO1xuICAgICAgfTtcblxuICAgICAgZnVuY3Rpb24gaW5uZXJTY2hlZHVsZU1ldGhvZChzLCBzZWxmKSB7XG4gICAgICAgIHNlbGYub2JzZXJ2YWJsZS5zb3VyY2UucmVxdWVzdChzZWxmLm9ic2VydmFibGUud2luZG93U2l6ZSk7XG4gICAgICB9XG5cbiAgICAgIFdpbmRvd2VkT2JzZXJ2ZXIucHJvdG90eXBlLm5leHQgPSBmdW5jdGlvbiAodmFsdWUpIHtcbiAgICAgICAgdGhpcy5vYnNlcnZlci5vbk5leHQodmFsdWUpO1xuICAgICAgICB0aGlzLnJlY2VpdmVkID0gKyt0aGlzLnJlY2VpdmVkICUgdGhpcy5vYnNlcnZhYmxlLndpbmRvd1NpemU7XG4gICAgICAgIHRoaXMucmVjZWl2ZWQgPT09IDAgJiYgKHRoaXMuc2NoZWR1bGVEaXNwb3NhYmxlID0gZGVmYXVsdFNjaGVkdWxlci5zY2hlZHVsZSh0aGlzLCBpbm5lclNjaGVkdWxlTWV0aG9kKSk7XG4gICAgICB9O1xuXG4gICAgICBXaW5kb3dlZE9ic2VydmVyLnByb3RvdHlwZS5kaXNwb3NlID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB0aGlzLm9ic2VydmVyID0gbnVsbDtcbiAgICAgICAgaWYgKHRoaXMuY2FuY2VsKSB7XG4gICAgICAgICAgdGhpcy5jYW5jZWwuZGlzcG9zZSgpO1xuICAgICAgICAgIHRoaXMuY2FuY2VsID0gbnVsbDtcbiAgICAgICAgfVxuICAgICAgICBpZiAodGhpcy5zY2hlZHVsZURpc3Bvc2FibGUpIHtcbiAgICAgICAgICB0aGlzLnNjaGVkdWxlRGlzcG9zYWJsZS5kaXNwb3NlKCk7XG4gICAgICAgICAgdGhpcy5zY2hlZHVsZURpc3Bvc2FibGUgPSBudWxsO1xuICAgICAgICB9XG4gICAgICAgIF9fc3ViX18ucHJvdG90eXBlLmRpc3Bvc2UuY2FsbCh0aGlzKTtcbiAgICAgIH07XG5cbiAgICAgIHJldHVybiBXaW5kb3dlZE9ic2VydmVyO1xuICAgIH0oQWJzdHJhY3RPYnNlcnZlcikpO1xuXG4gICAgcmV0dXJuIFdpbmRvd2VkT2JzZXJ2YWJsZTtcbiAgfShPYnNlcnZhYmxlKSk7XG5cbiAgLyoqXG4gICAqIENyZWF0ZXMgYSBzbGlkaW5nIHdpbmRvd2VkIG9ic2VydmFibGUgYmFzZWQgdXBvbiB0aGUgd2luZG93IHNpemUuXG4gICAqIEBwYXJhbSB7TnVtYmVyfSB3aW5kb3dTaXplIFRoZSBudW1iZXIgb2YgaXRlbXMgaW4gdGhlIHdpbmRvd1xuICAgKiBAcmV0dXJucyB7T2JzZXJ2YWJsZX0gQSB3aW5kb3dlZCBvYnNlcnZhYmxlIGJhc2VkIHVwb24gdGhlIHdpbmRvdyBzaXplLlxuICAgKi9cbiAgQ29udHJvbGxlZE9ic2VydmFibGUucHJvdG90eXBlLndpbmRvd2VkID0gZnVuY3Rpb24gKHdpbmRvd1NpemUpIHtcbiAgICByZXR1cm4gbmV3IFdpbmRvd2VkT2JzZXJ2YWJsZSh0aGlzLCB3aW5kb3dTaXplKTtcbiAgfTtcblxuICAvKipcbiAgICogUGlwZXMgdGhlIGV4aXN0aW5nIE9ic2VydmFibGUgc2VxdWVuY2UgaW50byBhIE5vZGUuanMgU3RyZWFtLlxuICAgKiBAcGFyYW0ge1N0cmVhbX0gZGVzdCBUaGUgZGVzdGluYXRpb24gTm9kZS5qcyBzdHJlYW0uXG4gICAqIEByZXR1cm5zIHtTdHJlYW19IFRoZSBkZXN0aW5hdGlvbiBzdHJlYW0uXG4gICAqL1xuICBvYnNlcnZhYmxlUHJvdG8ucGlwZSA9IGZ1bmN0aW9uIChkZXN0KSB7XG4gICAgdmFyIHNvdXJjZSA9IHRoaXMucGF1c2FibGVCdWZmZXJlZCgpO1xuXG4gICAgZnVuY3Rpb24gb25EcmFpbigpIHtcbiAgICAgIHNvdXJjZS5yZXN1bWUoKTtcbiAgICB9XG5cbiAgICBkZXN0LmFkZExpc3RlbmVyKCdkcmFpbicsIG9uRHJhaW4pO1xuXG4gICAgc291cmNlLnN1YnNjcmliZShcbiAgICAgIGZ1bmN0aW9uICh4KSB7XG4gICAgICAgICFkZXN0LndyaXRlKFN0cmluZyh4KSkgJiYgc291cmNlLnBhdXNlKCk7XG4gICAgICB9LFxuICAgICAgZnVuY3Rpb24gKGVycikge1xuICAgICAgICBkZXN0LmVtaXQoJ2Vycm9yJywgZXJyKTtcbiAgICAgIH0sXG4gICAgICBmdW5jdGlvbiAoKSB7XG4gICAgICAgIC8vIEhhY2sgY2hlY2sgYmVjYXVzZSBTVERJTyBpcyBub3QgY2xvc2FibGVcbiAgICAgICAgIWRlc3QuX2lzU3RkaW8gJiYgZGVzdC5lbmQoKTtcbiAgICAgICAgZGVzdC5yZW1vdmVMaXN0ZW5lcignZHJhaW4nLCBvbkRyYWluKTtcbiAgICAgIH0pO1xuXG4gICAgc291cmNlLnJlc3VtZSgpO1xuXG4gICAgcmV0dXJuIGRlc3Q7XG4gIH07XG5cbiAgdmFyIE11bHRpY2FzdE9ic2VydmFibGUgPSAoZnVuY3Rpb24gKF9fc3VwZXJfXykge1xuICAgIGluaGVyaXRzKE11bHRpY2FzdE9ic2VydmFibGUsIF9fc3VwZXJfXyk7XG4gICAgZnVuY3Rpb24gTXVsdGljYXN0T2JzZXJ2YWJsZShzb3VyY2UsIGZuMSwgZm4yKSB7XG4gICAgICB0aGlzLnNvdXJjZSA9IHNvdXJjZTtcbiAgICAgIHRoaXMuX2ZuMSA9IGZuMTtcbiAgICAgIHRoaXMuX2ZuMiA9IGZuMjtcbiAgICAgIF9fc3VwZXJfXy5jYWxsKHRoaXMpO1xuICAgIH1cblxuICAgIE11bHRpY2FzdE9ic2VydmFibGUucHJvdG90eXBlLnN1YnNjcmliZUNvcmUgPSBmdW5jdGlvbiAobykge1xuICAgICAgdmFyIGNvbm5lY3RhYmxlID0gdGhpcy5zb3VyY2UubXVsdGljYXN0KHRoaXMuX2ZuMSgpKTtcbiAgICAgIHJldHVybiBuZXcgQmluYXJ5RGlzcG9zYWJsZSh0aGlzLl9mbjIoY29ubmVjdGFibGUpLnN1YnNjcmliZShvKSwgY29ubmVjdGFibGUuY29ubmVjdCgpKTtcbiAgICB9O1xuXG4gICAgcmV0dXJuIE11bHRpY2FzdE9ic2VydmFibGU7XG4gIH0oT2JzZXJ2YWJsZUJhc2UpKTtcblxuICAvKipcbiAgICogTXVsdGljYXN0cyB0aGUgc291cmNlIHNlcXVlbmNlIG5vdGlmaWNhdGlvbnMgdGhyb3VnaCBhbiBpbnN0YW50aWF0ZWQgc3ViamVjdCBpbnRvIGFsbCB1c2VzIG9mIHRoZSBzZXF1ZW5jZSB3aXRoaW4gYSBzZWxlY3RvciBmdW5jdGlvbi4gRWFjaFxuICAgKiBzdWJzY3JpcHRpb24gdG8gdGhlIHJlc3VsdGluZyBzZXF1ZW5jZSBjYXVzZXMgYSBzZXBhcmF0ZSBtdWx0aWNhc3QgaW52b2NhdGlvbiwgZXhwb3NpbmcgdGhlIHNlcXVlbmNlIHJlc3VsdGluZyBmcm9tIHRoZSBzZWxlY3RvciBmdW5jdGlvbidzXG4gICAqIGludm9jYXRpb24uIEZvciBzcGVjaWFsaXphdGlvbnMgd2l0aCBmaXhlZCBzdWJqZWN0IHR5cGVzLCBzZWUgUHVibGlzaCwgUHVibGlzaExhc3QsIGFuZCBSZXBsYXkuXG4gICAqXG4gICAqIEBleGFtcGxlXG4gICAqIDEgLSByZXMgPSBzb3VyY2UubXVsdGljYXN0KG9ic2VydmFibGUpO1xuICAgKiAyIC0gcmVzID0gc291cmNlLm11bHRpY2FzdChmdW5jdGlvbiAoKSB7IHJldHVybiBuZXcgU3ViamVjdCgpOyB9LCBmdW5jdGlvbiAoeCkgeyByZXR1cm4geDsgfSk7XG4gICAqXG4gICAqIEBwYXJhbSB7RnVuY3Rpb258U3ViamVjdH0gc3ViamVjdE9yU3ViamVjdFNlbGVjdG9yXG4gICAqIEZhY3RvcnkgZnVuY3Rpb24gdG8gY3JlYXRlIGFuIGludGVybWVkaWF0ZSBzdWJqZWN0IHRocm91Z2ggd2hpY2ggdGhlIHNvdXJjZSBzZXF1ZW5jZSdzIGVsZW1lbnRzIHdpbGwgYmUgbXVsdGljYXN0IHRvIHRoZSBzZWxlY3RvciBmdW5jdGlvbi5cbiAgICogT3I6XG4gICAqIFN1YmplY3QgdG8gcHVzaCBzb3VyY2UgZWxlbWVudHMgaW50by5cbiAgICpcbiAgICogQHBhcmFtIHtGdW5jdGlvbn0gW3NlbGVjdG9yXSBPcHRpb25hbCBzZWxlY3RvciBmdW5jdGlvbiB3aGljaCBjYW4gdXNlIHRoZSBtdWx0aWNhc3RlZCBzb3VyY2Ugc2VxdWVuY2Ugc3ViamVjdCB0byB0aGUgcG9saWNpZXMgZW5mb3JjZWQgYnkgdGhlIGNyZWF0ZWQgc3ViamVjdC4gU3BlY2lmaWVkIG9ubHkgaWYgPHBhcmFtcmVmIG5hbWU9XCJzdWJqZWN0T3JTdWJqZWN0U2VsZWN0b3JcIiBpcyBhIGZhY3RvcnkgZnVuY3Rpb24uXG4gICAqIEByZXR1cm5zIHtPYnNlcnZhYmxlfSBBbiBvYnNlcnZhYmxlIHNlcXVlbmNlIHRoYXQgY29udGFpbnMgdGhlIGVsZW1lbnRzIG9mIGEgc2VxdWVuY2UgcHJvZHVjZWQgYnkgbXVsdGljYXN0aW5nIHRoZSBzb3VyY2Ugc2VxdWVuY2Ugd2l0aGluIGEgc2VsZWN0b3IgZnVuY3Rpb24uXG4gICAqL1xuICBvYnNlcnZhYmxlUHJvdG8ubXVsdGljYXN0ID0gZnVuY3Rpb24gKHN1YmplY3RPclN1YmplY3RTZWxlY3Rvciwgc2VsZWN0b3IpIHtcbiAgICByZXR1cm4gaXNGdW5jdGlvbihzdWJqZWN0T3JTdWJqZWN0U2VsZWN0b3IpID9cbiAgICAgIG5ldyBNdWx0aWNhc3RPYnNlcnZhYmxlKHRoaXMsIHN1YmplY3RPclN1YmplY3RTZWxlY3Rvciwgc2VsZWN0b3IpIDpcbiAgICAgIG5ldyBDb25uZWN0YWJsZU9ic2VydmFibGUodGhpcywgc3ViamVjdE9yU3ViamVjdFNlbGVjdG9yKTtcbiAgfTtcblxuICAvKipcbiAgICogUmV0dXJucyBhbiBvYnNlcnZhYmxlIHNlcXVlbmNlIHRoYXQgaXMgdGhlIHJlc3VsdCBvZiBpbnZva2luZyB0aGUgc2VsZWN0b3Igb24gYSBjb25uZWN0YWJsZSBvYnNlcnZhYmxlIHNlcXVlbmNlIHRoYXQgc2hhcmVzIGEgc2luZ2xlIHN1YnNjcmlwdGlvbiB0byB0aGUgdW5kZXJseWluZyBzZXF1ZW5jZS5cbiAgICogVGhpcyBvcGVyYXRvciBpcyBhIHNwZWNpYWxpemF0aW9uIG9mIE11bHRpY2FzdCB1c2luZyBhIHJlZ3VsYXIgU3ViamVjdC5cbiAgICpcbiAgICogQGV4YW1wbGVcbiAgICogdmFyIHJlc3JlcyA9IHNvdXJjZS5wdWJsaXNoKCk7XG4gICAqIHZhciByZXMgPSBzb3VyY2UucHVibGlzaChmdW5jdGlvbiAoeCkgeyByZXR1cm4geDsgfSk7XG4gICAqXG4gICAqIEBwYXJhbSB7RnVuY3Rpb259IFtzZWxlY3Rvcl0gU2VsZWN0b3IgZnVuY3Rpb24gd2hpY2ggY2FuIHVzZSB0aGUgbXVsdGljYXN0ZWQgc291cmNlIHNlcXVlbmNlIGFzIG1hbnkgdGltZXMgYXMgbmVlZGVkLCB3aXRob3V0IGNhdXNpbmcgbXVsdGlwbGUgc3Vic2NyaXB0aW9ucyB0byB0aGUgc291cmNlIHNlcXVlbmNlLiBTdWJzY3JpYmVycyB0byB0aGUgZ2l2ZW4gc291cmNlIHdpbGwgcmVjZWl2ZSBhbGwgbm90aWZpY2F0aW9ucyBvZiB0aGUgc291cmNlIGZyb20gdGhlIHRpbWUgb2YgdGhlIHN1YnNjcmlwdGlvbiBvbi5cbiAgICogQHJldHVybnMge09ic2VydmFibGV9IEFuIG9ic2VydmFibGUgc2VxdWVuY2UgdGhhdCBjb250YWlucyB0aGUgZWxlbWVudHMgb2YgYSBzZXF1ZW5jZSBwcm9kdWNlZCBieSBtdWx0aWNhc3RpbmcgdGhlIHNvdXJjZSBzZXF1ZW5jZSB3aXRoaW4gYSBzZWxlY3RvciBmdW5jdGlvbi5cbiAgICovXG4gIG9ic2VydmFibGVQcm90by5wdWJsaXNoID0gZnVuY3Rpb24gKHNlbGVjdG9yKSB7XG4gICAgcmV0dXJuIHNlbGVjdG9yICYmIGlzRnVuY3Rpb24oc2VsZWN0b3IpID9cbiAgICAgIHRoaXMubXVsdGljYXN0KGZ1bmN0aW9uICgpIHsgcmV0dXJuIG5ldyBTdWJqZWN0KCk7IH0sIHNlbGVjdG9yKSA6XG4gICAgICB0aGlzLm11bHRpY2FzdChuZXcgU3ViamVjdCgpKTtcbiAgfTtcblxuICAvKipcbiAgICogUmV0dXJucyBhbiBvYnNlcnZhYmxlIHNlcXVlbmNlIHRoYXQgc2hhcmVzIGEgc2luZ2xlIHN1YnNjcmlwdGlvbiB0byB0aGUgdW5kZXJseWluZyBzZXF1ZW5jZS5cbiAgICogVGhpcyBvcGVyYXRvciBpcyBhIHNwZWNpYWxpemF0aW9uIG9mIHB1Ymxpc2ggd2hpY2ggY3JlYXRlcyBhIHN1YnNjcmlwdGlvbiB3aGVuIHRoZSBudW1iZXIgb2Ygb2JzZXJ2ZXJzIGdvZXMgZnJvbSB6ZXJvIHRvIG9uZSwgdGhlbiBzaGFyZXMgdGhhdCBzdWJzY3JpcHRpb24gd2l0aCBhbGwgc3Vic2VxdWVudCBvYnNlcnZlcnMgdW50aWwgdGhlIG51bWJlciBvZiBvYnNlcnZlcnMgcmV0dXJucyB0byB6ZXJvLCBhdCB3aGljaCBwb2ludCB0aGUgc3Vic2NyaXB0aW9uIGlzIGRpc3Bvc2VkLlxuICAgKiBAcmV0dXJucyB7T2JzZXJ2YWJsZX0gQW4gb2JzZXJ2YWJsZSBzZXF1ZW5jZSB0aGF0IGNvbnRhaW5zIHRoZSBlbGVtZW50cyBvZiBhIHNlcXVlbmNlIHByb2R1Y2VkIGJ5IG11bHRpY2FzdGluZyB0aGUgc291cmNlIHNlcXVlbmNlLlxuICAgKi9cbiAgb2JzZXJ2YWJsZVByb3RvLnNoYXJlID0gZnVuY3Rpb24gKCkge1xuICAgIHJldHVybiB0aGlzLnB1Ymxpc2goKS5yZWZDb3VudCgpO1xuICB9O1xuXG4gIC8qKlxuICAgKiBSZXR1cm5zIGFuIG9ic2VydmFibGUgc2VxdWVuY2UgdGhhdCBpcyB0aGUgcmVzdWx0IG9mIGludm9raW5nIHRoZSBzZWxlY3RvciBvbiBhIGNvbm5lY3RhYmxlIG9ic2VydmFibGUgc2VxdWVuY2UgdGhhdCBzaGFyZXMgYSBzaW5nbGUgc3Vic2NyaXB0aW9uIHRvIHRoZSB1bmRlcmx5aW5nIHNlcXVlbmNlIGNvbnRhaW5pbmcgb25seSB0aGUgbGFzdCBub3RpZmljYXRpb24uXG4gICAqIFRoaXMgb3BlcmF0b3IgaXMgYSBzcGVjaWFsaXphdGlvbiBvZiBNdWx0aWNhc3QgdXNpbmcgYSBBc3luY1N1YmplY3QuXG4gICAqXG4gICAqIEBleGFtcGxlXG4gICAqIHZhciByZXMgPSBzb3VyY2UucHVibGlzaExhc3QoKTtcbiAgICogdmFyIHJlcyA9IHNvdXJjZS5wdWJsaXNoTGFzdChmdW5jdGlvbiAoeCkgeyByZXR1cm4geDsgfSk7XG4gICAqXG4gICAqIEBwYXJhbSBzZWxlY3RvciBbT3B0aW9uYWxdIFNlbGVjdG9yIGZ1bmN0aW9uIHdoaWNoIGNhbiB1c2UgdGhlIG11bHRpY2FzdGVkIHNvdXJjZSBzZXF1ZW5jZSBhcyBtYW55IHRpbWVzIGFzIG5lZWRlZCwgd2l0aG91dCBjYXVzaW5nIG11bHRpcGxlIHN1YnNjcmlwdGlvbnMgdG8gdGhlIHNvdXJjZSBzZXF1ZW5jZS4gU3Vic2NyaWJlcnMgdG8gdGhlIGdpdmVuIHNvdXJjZSB3aWxsIG9ubHkgcmVjZWl2ZSB0aGUgbGFzdCBub3RpZmljYXRpb24gb2YgdGhlIHNvdXJjZS5cbiAgICogQHJldHVybnMge09ic2VydmFibGV9IEFuIG9ic2VydmFibGUgc2VxdWVuY2UgdGhhdCBjb250YWlucyB0aGUgZWxlbWVudHMgb2YgYSBzZXF1ZW5jZSBwcm9kdWNlZCBieSBtdWx0aWNhc3RpbmcgdGhlIHNvdXJjZSBzZXF1ZW5jZSB3aXRoaW4gYSBzZWxlY3RvciBmdW5jdGlvbi5cbiAgICovXG4gIG9ic2VydmFibGVQcm90by5wdWJsaXNoTGFzdCA9IGZ1bmN0aW9uIChzZWxlY3Rvcikge1xuICAgIHJldHVybiBzZWxlY3RvciAmJiBpc0Z1bmN0aW9uKHNlbGVjdG9yKSA/XG4gICAgICB0aGlzLm11bHRpY2FzdChmdW5jdGlvbiAoKSB7IHJldHVybiBuZXcgQXN5bmNTdWJqZWN0KCk7IH0sIHNlbGVjdG9yKSA6XG4gICAgICB0aGlzLm11bHRpY2FzdChuZXcgQXN5bmNTdWJqZWN0KCkpO1xuICB9O1xuXG4gIC8qKlxuICAgKiBSZXR1cm5zIGFuIG9ic2VydmFibGUgc2VxdWVuY2UgdGhhdCBpcyB0aGUgcmVzdWx0IG9mIGludm9raW5nIHRoZSBzZWxlY3RvciBvbiBhIGNvbm5lY3RhYmxlIG9ic2VydmFibGUgc2VxdWVuY2UgdGhhdCBzaGFyZXMgYSBzaW5nbGUgc3Vic2NyaXB0aW9uIHRvIHRoZSB1bmRlcmx5aW5nIHNlcXVlbmNlIGFuZCBzdGFydHMgd2l0aCBpbml0aWFsVmFsdWUuXG4gICAqIFRoaXMgb3BlcmF0b3IgaXMgYSBzcGVjaWFsaXphdGlvbiBvZiBNdWx0aWNhc3QgdXNpbmcgYSBCZWhhdmlvclN1YmplY3QuXG4gICAqXG4gICAqIEBleGFtcGxlXG4gICAqIHZhciByZXMgPSBzb3VyY2UucHVibGlzaFZhbHVlKDQyKTtcbiAgICogdmFyIHJlcyA9IHNvdXJjZS5wdWJsaXNoVmFsdWUoZnVuY3Rpb24gKHgpIHsgcmV0dXJuIHguc2VsZWN0KGZ1bmN0aW9uICh5KSB7IHJldHVybiB5ICogeTsgfSkgfSwgNDIpO1xuICAgKlxuICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBbc2VsZWN0b3JdIE9wdGlvbmFsIHNlbGVjdG9yIGZ1bmN0aW9uIHdoaWNoIGNhbiB1c2UgdGhlIG11bHRpY2FzdGVkIHNvdXJjZSBzZXF1ZW5jZSBhcyBtYW55IHRpbWVzIGFzIG5lZWRlZCwgd2l0aG91dCBjYXVzaW5nIG11bHRpcGxlIHN1YnNjcmlwdGlvbnMgdG8gdGhlIHNvdXJjZSBzZXF1ZW5jZS4gU3Vic2NyaWJlcnMgdG8gdGhlIGdpdmVuIHNvdXJjZSB3aWxsIHJlY2VpdmUgaW1tZWRpYXRlbHkgcmVjZWl2ZSB0aGUgaW5pdGlhbCB2YWx1ZSwgZm9sbG93ZWQgYnkgYWxsIG5vdGlmaWNhdGlvbnMgb2YgdGhlIHNvdXJjZSBmcm9tIHRoZSB0aW1lIG9mIHRoZSBzdWJzY3JpcHRpb24gb24uXG4gICAqIEBwYXJhbSB7TWl4ZWR9IGluaXRpYWxWYWx1ZSBJbml0aWFsIHZhbHVlIHJlY2VpdmVkIGJ5IG9ic2VydmVycyB1cG9uIHN1YnNjcmlwdGlvbi5cbiAgICogQHJldHVybnMge09ic2VydmFibGV9IEFuIG9ic2VydmFibGUgc2VxdWVuY2UgdGhhdCBjb250YWlucyB0aGUgZWxlbWVudHMgb2YgYSBzZXF1ZW5jZSBwcm9kdWNlZCBieSBtdWx0aWNhc3RpbmcgdGhlIHNvdXJjZSBzZXF1ZW5jZSB3aXRoaW4gYSBzZWxlY3RvciBmdW5jdGlvbi5cbiAgICovXG4gIG9ic2VydmFibGVQcm90by5wdWJsaXNoVmFsdWUgPSBmdW5jdGlvbiAoaW5pdGlhbFZhbHVlT3JTZWxlY3RvciwgaW5pdGlhbFZhbHVlKSB7XG4gICAgcmV0dXJuIGFyZ3VtZW50cy5sZW5ndGggPT09IDIgP1xuICAgICAgdGhpcy5tdWx0aWNhc3QoZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gbmV3IEJlaGF2aW9yU3ViamVjdChpbml0aWFsVmFsdWUpO1xuICAgICAgfSwgaW5pdGlhbFZhbHVlT3JTZWxlY3RvcikgOlxuICAgICAgdGhpcy5tdWx0aWNhc3QobmV3IEJlaGF2aW9yU3ViamVjdChpbml0aWFsVmFsdWVPclNlbGVjdG9yKSk7XG4gIH07XG5cbiAgLyoqXG4gICAqIFJldHVybnMgYW4gb2JzZXJ2YWJsZSBzZXF1ZW5jZSB0aGF0IHNoYXJlcyBhIHNpbmdsZSBzdWJzY3JpcHRpb24gdG8gdGhlIHVuZGVybHlpbmcgc2VxdWVuY2UgYW5kIHN0YXJ0cyB3aXRoIGFuIGluaXRpYWxWYWx1ZS5cbiAgICogVGhpcyBvcGVyYXRvciBpcyBhIHNwZWNpYWxpemF0aW9uIG9mIHB1Ymxpc2hWYWx1ZSB3aGljaCBjcmVhdGVzIGEgc3Vic2NyaXB0aW9uIHdoZW4gdGhlIG51bWJlciBvZiBvYnNlcnZlcnMgZ29lcyBmcm9tIHplcm8gdG8gb25lLCB0aGVuIHNoYXJlcyB0aGF0IHN1YnNjcmlwdGlvbiB3aXRoIGFsbCBzdWJzZXF1ZW50IG9ic2VydmVycyB1bnRpbCB0aGUgbnVtYmVyIG9mIG9ic2VydmVycyByZXR1cm5zIHRvIHplcm8sIGF0IHdoaWNoIHBvaW50IHRoZSBzdWJzY3JpcHRpb24gaXMgZGlzcG9zZWQuXG4gICAqIEBwYXJhbSB7TWl4ZWR9IGluaXRpYWxWYWx1ZSBJbml0aWFsIHZhbHVlIHJlY2VpdmVkIGJ5IG9ic2VydmVycyB1cG9uIHN1YnNjcmlwdGlvbi5cbiAgICogQHJldHVybnMge09ic2VydmFibGV9IEFuIG9ic2VydmFibGUgc2VxdWVuY2UgdGhhdCBjb250YWlucyB0aGUgZWxlbWVudHMgb2YgYSBzZXF1ZW5jZSBwcm9kdWNlZCBieSBtdWx0aWNhc3RpbmcgdGhlIHNvdXJjZSBzZXF1ZW5jZS5cbiAgICovXG4gIG9ic2VydmFibGVQcm90by5zaGFyZVZhbHVlID0gZnVuY3Rpb24gKGluaXRpYWxWYWx1ZSkge1xuICAgIHJldHVybiB0aGlzLnB1Ymxpc2hWYWx1ZShpbml0aWFsVmFsdWUpLnJlZkNvdW50KCk7XG4gIH07XG5cbiAgLyoqXG4gICAqIFJldHVybnMgYW4gb2JzZXJ2YWJsZSBzZXF1ZW5jZSB0aGF0IGlzIHRoZSByZXN1bHQgb2YgaW52b2tpbmcgdGhlIHNlbGVjdG9yIG9uIGEgY29ubmVjdGFibGUgb2JzZXJ2YWJsZSBzZXF1ZW5jZSB0aGF0IHNoYXJlcyBhIHNpbmdsZSBzdWJzY3JpcHRpb24gdG8gdGhlIHVuZGVybHlpbmcgc2VxdWVuY2UgcmVwbGF5aW5nIG5vdGlmaWNhdGlvbnMgc3ViamVjdCB0byBhIG1heGltdW0gdGltZSBsZW5ndGggZm9yIHRoZSByZXBsYXkgYnVmZmVyLlxuICAgKiBUaGlzIG9wZXJhdG9yIGlzIGEgc3BlY2lhbGl6YXRpb24gb2YgTXVsdGljYXN0IHVzaW5nIGEgUmVwbGF5U3ViamVjdC5cbiAgICpcbiAgICogQGV4YW1wbGVcbiAgICogdmFyIHJlcyA9IHNvdXJjZS5yZXBsYXkobnVsbCwgMyk7XG4gICAqIHZhciByZXMgPSBzb3VyY2UucmVwbGF5KG51bGwsIDMsIDUwMCk7XG4gICAqIHZhciByZXMgPSBzb3VyY2UucmVwbGF5KG51bGwsIDMsIDUwMCwgc2NoZWR1bGVyKTtcbiAgICogdmFyIHJlcyA9IHNvdXJjZS5yZXBsYXkoZnVuY3Rpb24gKHgpIHsgcmV0dXJuIHgudGFrZSg2KS5yZXBlYXQoKTsgfSwgMywgNTAwLCBzY2hlZHVsZXIpO1xuICAgKlxuICAgKiBAcGFyYW0gc2VsZWN0b3IgW09wdGlvbmFsXSBTZWxlY3RvciBmdW5jdGlvbiB3aGljaCBjYW4gdXNlIHRoZSBtdWx0aWNhc3RlZCBzb3VyY2Ugc2VxdWVuY2UgYXMgbWFueSB0aW1lcyBhcyBuZWVkZWQsIHdpdGhvdXQgY2F1c2luZyBtdWx0aXBsZSBzdWJzY3JpcHRpb25zIHRvIHRoZSBzb3VyY2Ugc2VxdWVuY2UuIFN1YnNjcmliZXJzIHRvIHRoZSBnaXZlbiBzb3VyY2Ugd2lsbCByZWNlaXZlIGFsbCB0aGUgbm90aWZpY2F0aW9ucyBvZiB0aGUgc291cmNlIHN1YmplY3QgdG8gdGhlIHNwZWNpZmllZCByZXBsYXkgYnVmZmVyIHRyaW1taW5nIHBvbGljeS5cbiAgICogQHBhcmFtIGJ1ZmZlclNpemUgW09wdGlvbmFsXSBNYXhpbXVtIGVsZW1lbnQgY291bnQgb2YgdGhlIHJlcGxheSBidWZmZXIuXG4gICAqIEBwYXJhbSB3aW5kb3dTaXplIFtPcHRpb25hbF0gTWF4aW11bSB0aW1lIGxlbmd0aCBvZiB0aGUgcmVwbGF5IGJ1ZmZlci5cbiAgICogQHBhcmFtIHNjaGVkdWxlciBbT3B0aW9uYWxdIFNjaGVkdWxlciB3aGVyZSBjb25uZWN0ZWQgb2JzZXJ2ZXJzIHdpdGhpbiB0aGUgc2VsZWN0b3IgZnVuY3Rpb24gd2lsbCBiZSBpbnZva2VkIG9uLlxuICAgKiBAcmV0dXJucyB7T2JzZXJ2YWJsZX0gQW4gb2JzZXJ2YWJsZSBzZXF1ZW5jZSB0aGF0IGNvbnRhaW5zIHRoZSBlbGVtZW50cyBvZiBhIHNlcXVlbmNlIHByb2R1Y2VkIGJ5IG11bHRpY2FzdGluZyB0aGUgc291cmNlIHNlcXVlbmNlIHdpdGhpbiBhIHNlbGVjdG9yIGZ1bmN0aW9uLlxuICAgKi9cbiAgb2JzZXJ2YWJsZVByb3RvLnJlcGxheSA9IGZ1bmN0aW9uIChzZWxlY3RvciwgYnVmZmVyU2l6ZSwgd2luZG93U2l6ZSwgc2NoZWR1bGVyKSB7XG4gICAgcmV0dXJuIHNlbGVjdG9yICYmIGlzRnVuY3Rpb24oc2VsZWN0b3IpID9cbiAgICAgIHRoaXMubXVsdGljYXN0KGZ1bmN0aW9uICgpIHsgcmV0dXJuIG5ldyBSZXBsYXlTdWJqZWN0KGJ1ZmZlclNpemUsIHdpbmRvd1NpemUsIHNjaGVkdWxlcik7IH0sIHNlbGVjdG9yKSA6XG4gICAgICB0aGlzLm11bHRpY2FzdChuZXcgUmVwbGF5U3ViamVjdChidWZmZXJTaXplLCB3aW5kb3dTaXplLCBzY2hlZHVsZXIpKTtcbiAgfTtcblxuICAvKipcbiAgICogUmV0dXJucyBhbiBvYnNlcnZhYmxlIHNlcXVlbmNlIHRoYXQgc2hhcmVzIGEgc2luZ2xlIHN1YnNjcmlwdGlvbiB0byB0aGUgdW5kZXJseWluZyBzZXF1ZW5jZSByZXBsYXlpbmcgbm90aWZpY2F0aW9ucyBzdWJqZWN0IHRvIGEgbWF4aW11bSB0aW1lIGxlbmd0aCBmb3IgdGhlIHJlcGxheSBidWZmZXIuXG4gICAqIFRoaXMgb3BlcmF0b3IgaXMgYSBzcGVjaWFsaXphdGlvbiBvZiByZXBsYXkgd2hpY2ggY3JlYXRlcyBhIHN1YnNjcmlwdGlvbiB3aGVuIHRoZSBudW1iZXIgb2Ygb2JzZXJ2ZXJzIGdvZXMgZnJvbSB6ZXJvIHRvIG9uZSwgdGhlbiBzaGFyZXMgdGhhdCBzdWJzY3JpcHRpb24gd2l0aCBhbGwgc3Vic2VxdWVudCBvYnNlcnZlcnMgdW50aWwgdGhlIG51bWJlciBvZiBvYnNlcnZlcnMgcmV0dXJucyB0byB6ZXJvLCBhdCB3aGljaCBwb2ludCB0aGUgc3Vic2NyaXB0aW9uIGlzIGRpc3Bvc2VkLlxuICAgKlxuICAgKiBAZXhhbXBsZVxuICAgKiB2YXIgcmVzID0gc291cmNlLnNoYXJlUmVwbGF5KDMpO1xuICAgKiB2YXIgcmVzID0gc291cmNlLnNoYXJlUmVwbGF5KDMsIDUwMCk7XG4gICAqIHZhciByZXMgPSBzb3VyY2Uuc2hhcmVSZXBsYXkoMywgNTAwLCBzY2hlZHVsZXIpO1xuICAgKlxuXG4gICAqIEBwYXJhbSBidWZmZXJTaXplIFtPcHRpb25hbF0gTWF4aW11bSBlbGVtZW50IGNvdW50IG9mIHRoZSByZXBsYXkgYnVmZmVyLlxuICAgKiBAcGFyYW0gd2luZG93IFtPcHRpb25hbF0gTWF4aW11bSB0aW1lIGxlbmd0aCBvZiB0aGUgcmVwbGF5IGJ1ZmZlci5cbiAgICogQHBhcmFtIHNjaGVkdWxlciBbT3B0aW9uYWxdIFNjaGVkdWxlciB3aGVyZSBjb25uZWN0ZWQgb2JzZXJ2ZXJzIHdpdGhpbiB0aGUgc2VsZWN0b3IgZnVuY3Rpb24gd2lsbCBiZSBpbnZva2VkIG9uLlxuICAgKiBAcmV0dXJucyB7T2JzZXJ2YWJsZX0gQW4gb2JzZXJ2YWJsZSBzZXF1ZW5jZSB0aGF0IGNvbnRhaW5zIHRoZSBlbGVtZW50cyBvZiBhIHNlcXVlbmNlIHByb2R1Y2VkIGJ5IG11bHRpY2FzdGluZyB0aGUgc291cmNlIHNlcXVlbmNlLlxuICAgKi9cbiAgb2JzZXJ2YWJsZVByb3RvLnNoYXJlUmVwbGF5ID0gZnVuY3Rpb24gKGJ1ZmZlclNpemUsIHdpbmRvd1NpemUsIHNjaGVkdWxlcikge1xuICAgIHJldHVybiB0aGlzLnJlcGxheShudWxsLCBidWZmZXJTaXplLCB3aW5kb3dTaXplLCBzY2hlZHVsZXIpLnJlZkNvdW50KCk7XG4gIH07XG5cbiAgdmFyIElubmVyU3Vic2NyaXB0aW9uID0gZnVuY3Rpb24gKHMsIG8pIHtcbiAgICB0aGlzLl9zID0gcztcbiAgICB0aGlzLl9vID0gbztcbiAgfTtcblxuICBJbm5lclN1YnNjcmlwdGlvbi5wcm90b3R5cGUuZGlzcG9zZSA9IGZ1bmN0aW9uICgpIHtcbiAgICBpZiAoIXRoaXMuX3MuaXNEaXNwb3NlZCAmJiB0aGlzLl9vICE9PSBudWxsKSB7XG4gICAgICB2YXIgaWR4ID0gdGhpcy5fcy5vYnNlcnZlcnMuaW5kZXhPZih0aGlzLl9vKTtcbiAgICAgIHRoaXMuX3Mub2JzZXJ2ZXJzLnNwbGljZShpZHgsIDEpO1xuICAgICAgdGhpcy5fbyA9IG51bGw7XG4gICAgfVxuICB9O1xuXG4gIC8qKlxuICAgKiAgUmVwcmVzZW50cyBhIHZhbHVlIHRoYXQgY2hhbmdlcyBvdmVyIHRpbWUuXG4gICAqICBPYnNlcnZlcnMgY2FuIHN1YnNjcmliZSB0byB0aGUgc3ViamVjdCB0byByZWNlaXZlIHRoZSBsYXN0IChvciBpbml0aWFsKSB2YWx1ZSBhbmQgYWxsIHN1YnNlcXVlbnQgbm90aWZpY2F0aW9ucy5cbiAgICovXG4gIHZhciBCZWhhdmlvclN1YmplY3QgPSBSeC5CZWhhdmlvclN1YmplY3QgPSAoZnVuY3Rpb24gKF9fc3VwZXJfXykge1xuICAgIGluaGVyaXRzKEJlaGF2aW9yU3ViamVjdCwgX19zdXBlcl9fKTtcbiAgICBmdW5jdGlvbiBCZWhhdmlvclN1YmplY3QodmFsdWUpIHtcbiAgICAgIF9fc3VwZXJfXy5jYWxsKHRoaXMpO1xuICAgICAgdGhpcy52YWx1ZSA9IHZhbHVlO1xuICAgICAgdGhpcy5vYnNlcnZlcnMgPSBbXTtcbiAgICAgIHRoaXMuaXNEaXNwb3NlZCA9IGZhbHNlO1xuICAgICAgdGhpcy5pc1N0b3BwZWQgPSBmYWxzZTtcbiAgICAgIHRoaXMuaGFzRXJyb3IgPSBmYWxzZTtcbiAgICB9XG5cbiAgICBhZGRQcm9wZXJ0aWVzKEJlaGF2aW9yU3ViamVjdC5wcm90b3R5cGUsIE9ic2VydmVyLCB7XG4gICAgICBfc3Vic2NyaWJlOiBmdW5jdGlvbiAobykge1xuICAgICAgICBjaGVja0Rpc3Bvc2VkKHRoaXMpO1xuICAgICAgICBpZiAoIXRoaXMuaXNTdG9wcGVkKSB7XG4gICAgICAgICAgdGhpcy5vYnNlcnZlcnMucHVzaChvKTtcbiAgICAgICAgICBvLm9uTmV4dCh0aGlzLnZhbHVlKTtcbiAgICAgICAgICByZXR1cm4gbmV3IElubmVyU3Vic2NyaXB0aW9uKHRoaXMsIG8pO1xuICAgICAgICB9XG4gICAgICAgIGlmICh0aGlzLmhhc0Vycm9yKSB7XG4gICAgICAgICAgby5vbkVycm9yKHRoaXMuZXJyb3IpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIG8ub25Db21wbGV0ZWQoKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gZGlzcG9zYWJsZUVtcHR5O1xuICAgICAgfSxcbiAgICAgIC8qKlxuICAgICAgICogR2V0cyB0aGUgY3VycmVudCB2YWx1ZSBvciB0aHJvd3MgYW4gZXhjZXB0aW9uLlxuICAgICAgICogVmFsdWUgaXMgZnJvemVuIGFmdGVyIG9uQ29tcGxldGVkIGlzIGNhbGxlZC5cbiAgICAgICAqIEFmdGVyIG9uRXJyb3IgaXMgY2FsbGVkIGFsd2F5cyB0aHJvd3MgdGhlIHNwZWNpZmllZCBleGNlcHRpb24uXG4gICAgICAgKiBBbiBleGNlcHRpb24gaXMgYWx3YXlzIHRocm93biBhZnRlciBkaXNwb3NlIGlzIGNhbGxlZC5cbiAgICAgICAqIEByZXR1cm5zIHtNaXhlZH0gVGhlIGluaXRpYWwgdmFsdWUgcGFzc2VkIHRvIHRoZSBjb25zdHJ1Y3RvciB1bnRpbCBvbk5leHQgaXMgY2FsbGVkOyBhZnRlciB3aGljaCwgdGhlIGxhc3QgdmFsdWUgcGFzc2VkIHRvIG9uTmV4dC5cbiAgICAgICAqL1xuICAgICAgZ2V0VmFsdWU6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICBjaGVja0Rpc3Bvc2VkKHRoaXMpO1xuICAgICAgICAgIGlmICh0aGlzLmhhc0Vycm9yKSB7XG4gICAgICAgICAgICAgIHRocm93IHRoaXMuZXJyb3I7XG4gICAgICAgICAgfVxuICAgICAgICAgIHJldHVybiB0aGlzLnZhbHVlO1xuICAgICAgfSxcbiAgICAgIC8qKlxuICAgICAgICogSW5kaWNhdGVzIHdoZXRoZXIgdGhlIHN1YmplY3QgaGFzIG9ic2VydmVycyBzdWJzY3JpYmVkIHRvIGl0LlxuICAgICAgICogQHJldHVybnMge0Jvb2xlYW59IEluZGljYXRlcyB3aGV0aGVyIHRoZSBzdWJqZWN0IGhhcyBvYnNlcnZlcnMgc3Vic2NyaWJlZCB0byBpdC5cbiAgICAgICAqL1xuICAgICAgaGFzT2JzZXJ2ZXJzOiBmdW5jdGlvbiAoKSB7IHJldHVybiB0aGlzLm9ic2VydmVycy5sZW5ndGggPiAwOyB9LFxuICAgICAgLyoqXG4gICAgICAgKiBOb3RpZmllcyBhbGwgc3Vic2NyaWJlZCBvYnNlcnZlcnMgYWJvdXQgdGhlIGVuZCBvZiB0aGUgc2VxdWVuY2UuXG4gICAgICAgKi9cbiAgICAgIG9uQ29tcGxldGVkOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGNoZWNrRGlzcG9zZWQodGhpcyk7XG4gICAgICAgIGlmICh0aGlzLmlzU3RvcHBlZCkgeyByZXR1cm47IH1cbiAgICAgICAgdGhpcy5pc1N0b3BwZWQgPSB0cnVlO1xuICAgICAgICBmb3IgKHZhciBpID0gMCwgb3MgPSBjbG9uZUFycmF5KHRoaXMub2JzZXJ2ZXJzKSwgbGVuID0gb3MubGVuZ3RoOyBpIDwgbGVuOyBpKyspIHtcbiAgICAgICAgICBvc1tpXS5vbkNvbXBsZXRlZCgpO1xuICAgICAgICB9XG5cbiAgICAgICAgdGhpcy5vYnNlcnZlcnMubGVuZ3RoID0gMDtcbiAgICAgIH0sXG4gICAgICAvKipcbiAgICAgICAqIE5vdGlmaWVzIGFsbCBzdWJzY3JpYmVkIG9ic2VydmVycyBhYm91dCB0aGUgZXhjZXB0aW9uLlxuICAgICAgICogQHBhcmFtIHtNaXhlZH0gZXJyb3IgVGhlIGV4Y2VwdGlvbiB0byBzZW5kIHRvIGFsbCBvYnNlcnZlcnMuXG4gICAgICAgKi9cbiAgICAgIG9uRXJyb3I6IGZ1bmN0aW9uIChlcnJvcikge1xuICAgICAgICBjaGVja0Rpc3Bvc2VkKHRoaXMpO1xuICAgICAgICBpZiAodGhpcy5pc1N0b3BwZWQpIHsgcmV0dXJuOyB9XG4gICAgICAgIHRoaXMuaXNTdG9wcGVkID0gdHJ1ZTtcbiAgICAgICAgdGhpcy5oYXNFcnJvciA9IHRydWU7XG4gICAgICAgIHRoaXMuZXJyb3IgPSBlcnJvcjtcblxuICAgICAgICBmb3IgKHZhciBpID0gMCwgb3MgPSBjbG9uZUFycmF5KHRoaXMub2JzZXJ2ZXJzKSwgbGVuID0gb3MubGVuZ3RoOyBpIDwgbGVuOyBpKyspIHtcbiAgICAgICAgICBvc1tpXS5vbkVycm9yKGVycm9yKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHRoaXMub2JzZXJ2ZXJzLmxlbmd0aCA9IDA7XG4gICAgICB9LFxuICAgICAgLyoqXG4gICAgICAgKiBOb3RpZmllcyBhbGwgc3Vic2NyaWJlZCBvYnNlcnZlcnMgYWJvdXQgdGhlIGFycml2YWwgb2YgdGhlIHNwZWNpZmllZCBlbGVtZW50IGluIHRoZSBzZXF1ZW5jZS5cbiAgICAgICAqIEBwYXJhbSB7TWl4ZWR9IHZhbHVlIFRoZSB2YWx1ZSB0byBzZW5kIHRvIGFsbCBvYnNlcnZlcnMuXG4gICAgICAgKi9cbiAgICAgIG9uTmV4dDogZnVuY3Rpb24gKHZhbHVlKSB7XG4gICAgICAgIGNoZWNrRGlzcG9zZWQodGhpcyk7XG4gICAgICAgIGlmICh0aGlzLmlzU3RvcHBlZCkgeyByZXR1cm47IH1cbiAgICAgICAgdGhpcy52YWx1ZSA9IHZhbHVlO1xuICAgICAgICBmb3IgKHZhciBpID0gMCwgb3MgPSBjbG9uZUFycmF5KHRoaXMub2JzZXJ2ZXJzKSwgbGVuID0gb3MubGVuZ3RoOyBpIDwgbGVuOyBpKyspIHtcbiAgICAgICAgICBvc1tpXS5vbk5leHQodmFsdWUpO1xuICAgICAgICB9XG4gICAgICB9LFxuICAgICAgLyoqXG4gICAgICAgKiBVbnN1YnNjcmliZSBhbGwgb2JzZXJ2ZXJzIGFuZCByZWxlYXNlIHJlc291cmNlcy5cbiAgICAgICAqL1xuICAgICAgZGlzcG9zZTogZnVuY3Rpb24gKCkge1xuICAgICAgICB0aGlzLmlzRGlzcG9zZWQgPSB0cnVlO1xuICAgICAgICB0aGlzLm9ic2VydmVycyA9IG51bGw7XG4gICAgICAgIHRoaXMudmFsdWUgPSBudWxsO1xuICAgICAgICB0aGlzLmVycm9yID0gbnVsbDtcbiAgICAgIH1cbiAgICB9KTtcblxuICAgIHJldHVybiBCZWhhdmlvclN1YmplY3Q7XG4gIH0oT2JzZXJ2YWJsZSkpO1xuXG4gIC8qKlxuICAgKiBSZXByZXNlbnRzIGFuIG9iamVjdCB0aGF0IGlzIGJvdGggYW4gb2JzZXJ2YWJsZSBzZXF1ZW5jZSBhcyB3ZWxsIGFzIGFuIG9ic2VydmVyLlxuICAgKiBFYWNoIG5vdGlmaWNhdGlvbiBpcyBicm9hZGNhc3RlZCB0byBhbGwgc3Vic2NyaWJlZCBhbmQgZnV0dXJlIG9ic2VydmVycywgc3ViamVjdCB0byBidWZmZXIgdHJpbW1pbmcgcG9saWNpZXMuXG4gICAqL1xuICB2YXIgUmVwbGF5U3ViamVjdCA9IFJ4LlJlcGxheVN1YmplY3QgPSAoZnVuY3Rpb24gKF9fc3VwZXJfXykge1xuXG4gICAgdmFyIG1heFNhZmVJbnRlZ2VyID0gTWF0aC5wb3coMiwgNTMpIC0gMTtcblxuICAgIGZ1bmN0aW9uIGNyZWF0ZVJlbW92YWJsZURpc3Bvc2FibGUoc3ViamVjdCwgb2JzZXJ2ZXIpIHtcbiAgICAgIHJldHVybiBkaXNwb3NhYmxlQ3JlYXRlKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgb2JzZXJ2ZXIuZGlzcG9zZSgpO1xuICAgICAgICAhc3ViamVjdC5pc0Rpc3Bvc2VkICYmIHN1YmplY3Qub2JzZXJ2ZXJzLnNwbGljZShzdWJqZWN0Lm9ic2VydmVycy5pbmRleE9mKG9ic2VydmVyKSwgMSk7XG4gICAgICB9KTtcbiAgICB9XG5cbiAgICBpbmhlcml0cyhSZXBsYXlTdWJqZWN0LCBfX3N1cGVyX18pO1xuXG4gICAgLyoqXG4gICAgICogIEluaXRpYWxpemVzIGEgbmV3IGluc3RhbmNlIG9mIHRoZSBSZXBsYXlTdWJqZWN0IGNsYXNzIHdpdGggdGhlIHNwZWNpZmllZCBidWZmZXIgc2l6ZSwgd2luZG93IHNpemUgYW5kIHNjaGVkdWxlci5cbiAgICAgKiAgQHBhcmFtIHtOdW1iZXJ9IFtidWZmZXJTaXplXSBNYXhpbXVtIGVsZW1lbnQgY291bnQgb2YgdGhlIHJlcGxheSBidWZmZXIuXG4gICAgICogIEBwYXJhbSB7TnVtYmVyfSBbd2luZG93U2l6ZV0gTWF4aW11bSB0aW1lIGxlbmd0aCBvZiB0aGUgcmVwbGF5IGJ1ZmZlci5cbiAgICAgKiAgQHBhcmFtIHtTY2hlZHVsZXJ9IFtzY2hlZHVsZXJdIFNjaGVkdWxlciB0aGUgb2JzZXJ2ZXJzIGFyZSBpbnZva2VkIG9uLlxuICAgICAqL1xuICAgIGZ1bmN0aW9uIFJlcGxheVN1YmplY3QoYnVmZmVyU2l6ZSwgd2luZG93U2l6ZSwgc2NoZWR1bGVyKSB7XG4gICAgICB0aGlzLmJ1ZmZlclNpemUgPSBidWZmZXJTaXplID09IG51bGwgPyBtYXhTYWZlSW50ZWdlciA6IGJ1ZmZlclNpemU7XG4gICAgICB0aGlzLndpbmRvd1NpemUgPSB3aW5kb3dTaXplID09IG51bGwgPyBtYXhTYWZlSW50ZWdlciA6IHdpbmRvd1NpemU7XG4gICAgICB0aGlzLnNjaGVkdWxlciA9IHNjaGVkdWxlciB8fCBjdXJyZW50VGhyZWFkU2NoZWR1bGVyO1xuICAgICAgdGhpcy5xID0gW107XG4gICAgICB0aGlzLm9ic2VydmVycyA9IFtdO1xuICAgICAgdGhpcy5pc1N0b3BwZWQgPSBmYWxzZTtcbiAgICAgIHRoaXMuaXNEaXNwb3NlZCA9IGZhbHNlO1xuICAgICAgdGhpcy5oYXNFcnJvciA9IGZhbHNlO1xuICAgICAgdGhpcy5lcnJvciA9IG51bGw7XG4gICAgICBfX3N1cGVyX18uY2FsbCh0aGlzKTtcbiAgICB9XG5cbiAgICBhZGRQcm9wZXJ0aWVzKFJlcGxheVN1YmplY3QucHJvdG90eXBlLCBPYnNlcnZlci5wcm90b3R5cGUsIHtcbiAgICAgIF9zdWJzY3JpYmU6IGZ1bmN0aW9uIChvKSB7XG4gICAgICAgIGNoZWNrRGlzcG9zZWQodGhpcyk7XG4gICAgICAgIHZhciBzbyA9IG5ldyBTY2hlZHVsZWRPYnNlcnZlcih0aGlzLnNjaGVkdWxlciwgbyksIHN1YnNjcmlwdGlvbiA9IGNyZWF0ZVJlbW92YWJsZURpc3Bvc2FibGUodGhpcywgc28pO1xuXG4gICAgICAgIHRoaXMuX3RyaW0odGhpcy5zY2hlZHVsZXIubm93KCkpO1xuICAgICAgICB0aGlzLm9ic2VydmVycy5wdXNoKHNvKTtcblxuICAgICAgICBmb3IgKHZhciBpID0gMCwgbGVuID0gdGhpcy5xLmxlbmd0aDsgaSA8IGxlbjsgaSsrKSB7XG4gICAgICAgICAgc28ub25OZXh0KHRoaXMucVtpXS52YWx1ZSk7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAodGhpcy5oYXNFcnJvcikge1xuICAgICAgICAgIHNvLm9uRXJyb3IodGhpcy5lcnJvcik7XG4gICAgICAgIH0gZWxzZSBpZiAodGhpcy5pc1N0b3BwZWQpIHtcbiAgICAgICAgICBzby5vbkNvbXBsZXRlZCgpO1xuICAgICAgICB9XG5cbiAgICAgICAgc28uZW5zdXJlQWN0aXZlKCk7XG4gICAgICAgIHJldHVybiBzdWJzY3JpcHRpb247XG4gICAgICB9LFxuICAgICAgLyoqXG4gICAgICAgKiBJbmRpY2F0ZXMgd2hldGhlciB0aGUgc3ViamVjdCBoYXMgb2JzZXJ2ZXJzIHN1YnNjcmliZWQgdG8gaXQuXG4gICAgICAgKiBAcmV0dXJucyB7Qm9vbGVhbn0gSW5kaWNhdGVzIHdoZXRoZXIgdGhlIHN1YmplY3QgaGFzIG9ic2VydmVycyBzdWJzY3JpYmVkIHRvIGl0LlxuICAgICAgICovXG4gICAgICBoYXNPYnNlcnZlcnM6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMub2JzZXJ2ZXJzLmxlbmd0aCA+IDA7XG4gICAgICB9LFxuICAgICAgX3RyaW06IGZ1bmN0aW9uIChub3cpIHtcbiAgICAgICAgd2hpbGUgKHRoaXMucS5sZW5ndGggPiB0aGlzLmJ1ZmZlclNpemUpIHtcbiAgICAgICAgICB0aGlzLnEuc2hpZnQoKTtcbiAgICAgICAgfVxuICAgICAgICB3aGlsZSAodGhpcy5xLmxlbmd0aCA+IDAgJiYgKG5vdyAtIHRoaXMucVswXS5pbnRlcnZhbCkgPiB0aGlzLndpbmRvd1NpemUpIHtcbiAgICAgICAgICB0aGlzLnEuc2hpZnQoKTtcbiAgICAgICAgfVxuICAgICAgfSxcbiAgICAgIC8qKlxuICAgICAgICogTm90aWZpZXMgYWxsIHN1YnNjcmliZWQgb2JzZXJ2ZXJzIGFib3V0IHRoZSBhcnJpdmFsIG9mIHRoZSBzcGVjaWZpZWQgZWxlbWVudCBpbiB0aGUgc2VxdWVuY2UuXG4gICAgICAgKiBAcGFyYW0ge01peGVkfSB2YWx1ZSBUaGUgdmFsdWUgdG8gc2VuZCB0byBhbGwgb2JzZXJ2ZXJzLlxuICAgICAgICovXG4gICAgICBvbk5leHQ6IGZ1bmN0aW9uICh2YWx1ZSkge1xuICAgICAgICBjaGVja0Rpc3Bvc2VkKHRoaXMpO1xuICAgICAgICBpZiAodGhpcy5pc1N0b3BwZWQpIHsgcmV0dXJuOyB9XG4gICAgICAgIHZhciBub3cgPSB0aGlzLnNjaGVkdWxlci5ub3coKTtcbiAgICAgICAgdGhpcy5xLnB1c2goeyBpbnRlcnZhbDogbm93LCB2YWx1ZTogdmFsdWUgfSk7XG4gICAgICAgIHRoaXMuX3RyaW0obm93KTtcblxuICAgICAgICBmb3IgKHZhciBpID0gMCwgb3MgPSBjbG9uZUFycmF5KHRoaXMub2JzZXJ2ZXJzKSwgbGVuID0gb3MubGVuZ3RoOyBpIDwgbGVuOyBpKyspIHtcbiAgICAgICAgICB2YXIgb2JzZXJ2ZXIgPSBvc1tpXTtcbiAgICAgICAgICBvYnNlcnZlci5vbk5leHQodmFsdWUpO1xuICAgICAgICAgIG9ic2VydmVyLmVuc3VyZUFjdGl2ZSgpO1xuICAgICAgICB9XG4gICAgICB9LFxuICAgICAgLyoqXG4gICAgICAgKiBOb3RpZmllcyBhbGwgc3Vic2NyaWJlZCBvYnNlcnZlcnMgYWJvdXQgdGhlIGV4Y2VwdGlvbi5cbiAgICAgICAqIEBwYXJhbSB7TWl4ZWR9IGVycm9yIFRoZSBleGNlcHRpb24gdG8gc2VuZCB0byBhbGwgb2JzZXJ2ZXJzLlxuICAgICAgICovXG4gICAgICBvbkVycm9yOiBmdW5jdGlvbiAoZXJyb3IpIHtcbiAgICAgICAgY2hlY2tEaXNwb3NlZCh0aGlzKTtcbiAgICAgICAgaWYgKHRoaXMuaXNTdG9wcGVkKSB7IHJldHVybjsgfVxuICAgICAgICB0aGlzLmlzU3RvcHBlZCA9IHRydWU7XG4gICAgICAgIHRoaXMuZXJyb3IgPSBlcnJvcjtcbiAgICAgICAgdGhpcy5oYXNFcnJvciA9IHRydWU7XG4gICAgICAgIHZhciBub3cgPSB0aGlzLnNjaGVkdWxlci5ub3coKTtcbiAgICAgICAgdGhpcy5fdHJpbShub3cpO1xuICAgICAgICBmb3IgKHZhciBpID0gMCwgb3MgPSBjbG9uZUFycmF5KHRoaXMub2JzZXJ2ZXJzKSwgbGVuID0gb3MubGVuZ3RoOyBpIDwgbGVuOyBpKyspIHtcbiAgICAgICAgICB2YXIgb2JzZXJ2ZXIgPSBvc1tpXTtcbiAgICAgICAgICBvYnNlcnZlci5vbkVycm9yKGVycm9yKTtcbiAgICAgICAgICBvYnNlcnZlci5lbnN1cmVBY3RpdmUoKTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLm9ic2VydmVycy5sZW5ndGggPSAwO1xuICAgICAgfSxcbiAgICAgIC8qKlxuICAgICAgICogTm90aWZpZXMgYWxsIHN1YnNjcmliZWQgb2JzZXJ2ZXJzIGFib3V0IHRoZSBlbmQgb2YgdGhlIHNlcXVlbmNlLlxuICAgICAgICovXG4gICAgICBvbkNvbXBsZXRlZDogZnVuY3Rpb24gKCkge1xuICAgICAgICBjaGVja0Rpc3Bvc2VkKHRoaXMpO1xuICAgICAgICBpZiAodGhpcy5pc1N0b3BwZWQpIHsgcmV0dXJuOyB9XG4gICAgICAgIHRoaXMuaXNTdG9wcGVkID0gdHJ1ZTtcbiAgICAgICAgdmFyIG5vdyA9IHRoaXMuc2NoZWR1bGVyLm5vdygpO1xuICAgICAgICB0aGlzLl90cmltKG5vdyk7XG4gICAgICAgIGZvciAodmFyIGkgPSAwLCBvcyA9IGNsb25lQXJyYXkodGhpcy5vYnNlcnZlcnMpLCBsZW4gPSBvcy5sZW5ndGg7IGkgPCBsZW47IGkrKykge1xuICAgICAgICAgIHZhciBvYnNlcnZlciA9IG9zW2ldO1xuICAgICAgICAgIG9ic2VydmVyLm9uQ29tcGxldGVkKCk7XG4gICAgICAgICAgb2JzZXJ2ZXIuZW5zdXJlQWN0aXZlKCk7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5vYnNlcnZlcnMubGVuZ3RoID0gMDtcbiAgICAgIH0sXG4gICAgICAvKipcbiAgICAgICAqIFVuc3Vic2NyaWJlIGFsbCBvYnNlcnZlcnMgYW5kIHJlbGVhc2UgcmVzb3VyY2VzLlxuICAgICAgICovXG4gICAgICBkaXNwb3NlOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHRoaXMuaXNEaXNwb3NlZCA9IHRydWU7XG4gICAgICAgIHRoaXMub2JzZXJ2ZXJzID0gbnVsbDtcbiAgICAgIH1cbiAgICB9KTtcblxuICAgIHJldHVybiBSZXBsYXlTdWJqZWN0O1xuICB9KE9ic2VydmFibGUpKTtcblxuICB2YXIgUmVmQ291bnRPYnNlcnZhYmxlID0gKGZ1bmN0aW9uIChfX3N1cGVyX18pIHtcbiAgICBpbmhlcml0cyhSZWZDb3VudE9ic2VydmFibGUsIF9fc3VwZXJfXyk7XG4gICAgZnVuY3Rpb24gUmVmQ291bnRPYnNlcnZhYmxlKHNvdXJjZSkge1xuICAgICAgdGhpcy5zb3VyY2UgPSBzb3VyY2U7XG4gICAgICB0aGlzLl9jb3VudCA9IDA7XG4gICAgICB0aGlzLl9jb25uZWN0YWJsZVN1YnNjcmlwdGlvbiA9IG51bGw7XG4gICAgICBfX3N1cGVyX18uY2FsbCh0aGlzKTtcbiAgICB9XG5cbiAgICBSZWZDb3VudE9ic2VydmFibGUucHJvdG90eXBlLnN1YnNjcmliZUNvcmUgPSBmdW5jdGlvbiAobykge1xuICAgICAgdmFyIHNob3VsZENvbm5lY3QgPSArK3RoaXMuX2NvdW50ID09PSAxLCBzdWJzY3JpcHRpb24gPSB0aGlzLnNvdXJjZS5zdWJzY3JpYmUobyk7XG4gICAgICBzaG91bGRDb25uZWN0ICYmICh0aGlzLl9jb25uZWN0YWJsZVN1YnNjcmlwdGlvbiA9IHRoaXMuc291cmNlLmNvbm5lY3QoKSk7XG4gICAgICByZXR1cm4gbmV3IFJlZkNvdW50RGlzcG9zYWJsZSh0aGlzLCBzdWJzY3JpcHRpb24pO1xuICAgIH07XG5cbiAgICBmdW5jdGlvbiBSZWZDb3VudERpc3Bvc2FibGUocCwgcykge1xuICAgICAgdGhpcy5fcCA9IHA7XG4gICAgICB0aGlzLl9zID0gcztcbiAgICAgIHRoaXMuaXNEaXNwb3NlZCA9IGZhbHNlO1xuICAgIH1cblxuICAgIFJlZkNvdW50RGlzcG9zYWJsZS5wcm90b3R5cGUuZGlzcG9zZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgIGlmICghdGhpcy5pc0Rpc3Bvc2VkKSB7XG4gICAgICAgIHRoaXMuaXNEaXNwb3NlZCA9IHRydWU7XG4gICAgICAgIHRoaXMuX3MuZGlzcG9zZSgpO1xuICAgICAgICAtLXRoaXMuX3AuX2NvdW50ID09PSAwICYmIHRoaXMuX3AuX2Nvbm5lY3RhYmxlU3Vic2NyaXB0aW9uLmRpc3Bvc2UoKTtcbiAgICAgIH1cbiAgICB9O1xuXG4gICAgcmV0dXJuIFJlZkNvdW50T2JzZXJ2YWJsZTtcbiAgfShPYnNlcnZhYmxlQmFzZSkpO1xuXG4gIHZhciBDb25uZWN0YWJsZU9ic2VydmFibGUgPSBSeC5Db25uZWN0YWJsZU9ic2VydmFibGUgPSAoZnVuY3Rpb24gKF9fc3VwZXJfXykge1xuICAgIGluaGVyaXRzKENvbm5lY3RhYmxlT2JzZXJ2YWJsZSwgX19zdXBlcl9fKTtcbiAgICBmdW5jdGlvbiBDb25uZWN0YWJsZU9ic2VydmFibGUoc291cmNlLCBzdWJqZWN0KSB7XG4gICAgICB0aGlzLnNvdXJjZSA9IHNvdXJjZTtcbiAgICAgIHRoaXMuX2hhc1N1YnNjcmlwdGlvbiAgPSBmYWxzZTtcbiAgICAgIHRoaXMuX3N1YnNjcmlwdGlvbiA9IG51bGw7XG4gICAgICB0aGlzLl9zb3VyY2VPYnNlcnZhYmxlID0gc291cmNlLmFzT2JzZXJ2YWJsZSgpO1xuICAgICAgdGhpcy5fc3ViamVjdCA9IHN1YmplY3Q7XG4gICAgICBfX3N1cGVyX18uY2FsbCh0aGlzKTtcbiAgICB9XG5cbiAgICBmdW5jdGlvbiBDb25uZWN0RGlzcG9zYWJsZShwYXJlbnQpIHtcbiAgICAgIHRoaXMuX3AgPSBwYXJlbnQ7XG4gICAgICB0aGlzLmlzRGlzcG9zZWQgPSBmYWxzZTtcbiAgICB9XG5cbiAgICBDb25uZWN0RGlzcG9zYWJsZS5wcm90b3R5cGUuZGlzcG9zZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgIGlmICghdGhpcy5pc0Rpc3Bvc2VkKSB7XG4gICAgICAgIHRoaXMuaXNEaXNwb3NlZCA9IHRydWU7XG4gICAgICAgIHRoaXMuX3AuX2hhc1N1YnNjcmlwdGlvbiA9IGZhbHNlO1xuICAgICAgfVxuICAgIH07XG5cbiAgICBDb25uZWN0YWJsZU9ic2VydmFibGUucHJvdG90eXBlLmNvbm5lY3QgPSBmdW5jdGlvbiAoKSB7XG4gICAgICBpZiAoIXRoaXMuX2hhc1N1YnNjcmlwdGlvbikge1xuICAgICAgICB0aGlzLl9oYXNTdWJzY3JpcHRpb24gPSB0cnVlO1xuICAgICAgICB0aGlzLl9zdWJzY3JpcHRpb24gPSBuZXcgQmluYXJ5RGlzcG9zYWJsZShcbiAgICAgICAgICB0aGlzLl9zb3VyY2VPYnNlcnZhYmxlLnN1YnNjcmliZSh0aGlzLl9zdWJqZWN0KSxcbiAgICAgICAgICBuZXcgQ29ubmVjdERpc3Bvc2FibGUodGhpcylcbiAgICAgICAgKTtcbiAgICAgIH1cbiAgICAgIHJldHVybiB0aGlzLl9zdWJzY3JpcHRpb247XG4gICAgfTtcblxuICAgIENvbm5lY3RhYmxlT2JzZXJ2YWJsZS5wcm90b3R5cGUuX3N1YnNjcmliZSA9IGZ1bmN0aW9uIChvKSB7XG4gICAgICByZXR1cm4gdGhpcy5fc3ViamVjdC5zdWJzY3JpYmUobyk7XG4gICAgfTtcblxuICAgIENvbm5lY3RhYmxlT2JzZXJ2YWJsZS5wcm90b3R5cGUucmVmQ291bnQgPSBmdW5jdGlvbiAoKSB7XG4gICAgICByZXR1cm4gbmV3IFJlZkNvdW50T2JzZXJ2YWJsZSh0aGlzKTtcbiAgICB9O1xuXG4gICAgcmV0dXJuIENvbm5lY3RhYmxlT2JzZXJ2YWJsZTtcbiAgfShPYnNlcnZhYmxlKSk7XG5cbiAgLyoqXG4gICAqIFJldHVybnMgYW4gb2JzZXJ2YWJsZSBzZXF1ZW5jZSB0aGF0IHNoYXJlcyBhIHNpbmdsZSBzdWJzY3JpcHRpb24gdG8gdGhlIHVuZGVybHlpbmcgc2VxdWVuY2UuIFRoaXMgb2JzZXJ2YWJsZSBzZXF1ZW5jZVxuICAgKiBjYW4gYmUgcmVzdWJzY3JpYmVkIHRvLCBldmVuIGlmIGFsbCBwcmlvciBzdWJzY3JpcHRpb25zIGhhdmUgZW5kZWQuICh1bmxpa2UgYC5wdWJsaXNoKCkucmVmQ291bnQoKWApXG4gICAqIEByZXR1cm5zIHtPYnNlcnZhYmxlfSBBbiBvYnNlcnZhYmxlIHNlcXVlbmNlIHRoYXQgY29udGFpbnMgdGhlIGVsZW1lbnRzIG9mIGEgc2VxdWVuY2UgcHJvZHVjZWQgYnkgbXVsdGljYXN0aW5nIHRoZSBzb3VyY2UuXG4gICAqL1xuICBvYnNlcnZhYmxlUHJvdG8uc2luZ2xlSW5zdGFuY2UgPSBmdW5jdGlvbigpIHtcbiAgICB2YXIgc291cmNlID0gdGhpcywgaGFzT2JzZXJ2YWJsZSA9IGZhbHNlLCBvYnNlcnZhYmxlO1xuXG4gICAgZnVuY3Rpb24gZ2V0T2JzZXJ2YWJsZSgpIHtcbiAgICAgIGlmICghaGFzT2JzZXJ2YWJsZSkge1xuICAgICAgICBoYXNPYnNlcnZhYmxlID0gdHJ1ZTtcbiAgICAgICAgb2JzZXJ2YWJsZSA9IHNvdXJjZS5maW5hbGx5KGZ1bmN0aW9uKCkgeyBoYXNPYnNlcnZhYmxlID0gZmFsc2U7IH0pLnB1Ymxpc2goKS5yZWZDb3VudCgpO1xuICAgICAgfVxuICAgICAgcmV0dXJuIG9ic2VydmFibGU7XG4gICAgfVxuXG4gICAgcmV0dXJuIG5ldyBBbm9ueW1vdXNPYnNlcnZhYmxlKGZ1bmN0aW9uKG8pIHtcbiAgICAgIHJldHVybiBnZXRPYnNlcnZhYmxlKCkuc3Vic2NyaWJlKG8pO1xuICAgIH0pO1xuICB9O1xuXG4gIC8qKlxuICAgKiAgQ29ycmVsYXRlcyB0aGUgZWxlbWVudHMgb2YgdHdvIHNlcXVlbmNlcyBiYXNlZCBvbiBvdmVybGFwcGluZyBkdXJhdGlvbnMuXG4gICAqXG4gICAqICBAcGFyYW0ge09ic2VydmFibGV9IHJpZ2h0IFRoZSByaWdodCBvYnNlcnZhYmxlIHNlcXVlbmNlIHRvIGpvaW4gZWxlbWVudHMgZm9yLlxuICAgKiAgQHBhcmFtIHtGdW5jdGlvbn0gbGVmdER1cmF0aW9uU2VsZWN0b3IgQSBmdW5jdGlvbiB0byBzZWxlY3QgdGhlIGR1cmF0aW9uIChleHByZXNzZWQgYXMgYW4gb2JzZXJ2YWJsZSBzZXF1ZW5jZSkgb2YgZWFjaCBlbGVtZW50IG9mIHRoZSBsZWZ0IG9ic2VydmFibGUgc2VxdWVuY2UsIHVzZWQgdG8gZGV0ZXJtaW5lIG92ZXJsYXAuXG4gICAqICBAcGFyYW0ge0Z1bmN0aW9ufSByaWdodER1cmF0aW9uU2VsZWN0b3IgQSBmdW5jdGlvbiB0byBzZWxlY3QgdGhlIGR1cmF0aW9uIChleHByZXNzZWQgYXMgYW4gb2JzZXJ2YWJsZSBzZXF1ZW5jZSkgb2YgZWFjaCBlbGVtZW50IG9mIHRoZSByaWdodCBvYnNlcnZhYmxlIHNlcXVlbmNlLCB1c2VkIHRvIGRldGVybWluZSBvdmVybGFwLlxuICAgKiAgQHBhcmFtIHtGdW5jdGlvbn0gcmVzdWx0U2VsZWN0b3IgQSBmdW5jdGlvbiBpbnZva2VkIHRvIGNvbXB1dGUgYSByZXN1bHQgZWxlbWVudCBmb3IgYW55IHR3byBvdmVybGFwcGluZyBlbGVtZW50cyBvZiB0aGUgbGVmdCBhbmQgcmlnaHQgb2JzZXJ2YWJsZSBzZXF1ZW5jZXMuIFRoZSBwYXJhbWV0ZXJzIHBhc3NlZCB0byB0aGUgZnVuY3Rpb24gY29ycmVzcG9uZCB3aXRoIHRoZSBlbGVtZW50cyBmcm9tIHRoZSBsZWZ0IGFuZCByaWdodCBzb3VyY2Ugc2VxdWVuY2VzIGZvciB3aGljaCBvdmVybGFwIG9jY3Vycy5cbiAgICogIEByZXR1cm5zIHtPYnNlcnZhYmxlfSBBbiBvYnNlcnZhYmxlIHNlcXVlbmNlIHRoYXQgY29udGFpbnMgcmVzdWx0IGVsZW1lbnRzIGNvbXB1dGVkIGZyb20gc291cmNlIGVsZW1lbnRzIHRoYXQgaGF2ZSBhbiBvdmVybGFwcGluZyBkdXJhdGlvbi5cbiAgICovXG4gIG9ic2VydmFibGVQcm90by5qb2luID0gZnVuY3Rpb24gKHJpZ2h0LCBsZWZ0RHVyYXRpb25TZWxlY3RvciwgcmlnaHREdXJhdGlvblNlbGVjdG9yLCByZXN1bHRTZWxlY3Rvcikge1xuICAgIHZhciBsZWZ0ID0gdGhpcztcbiAgICByZXR1cm4gbmV3IEFub255bW91c09ic2VydmFibGUoZnVuY3Rpb24gKG8pIHtcbiAgICAgIHZhciBncm91cCA9IG5ldyBDb21wb3NpdGVEaXNwb3NhYmxlKCk7XG4gICAgICB2YXIgbGVmdERvbmUgPSBmYWxzZSwgcmlnaHREb25lID0gZmFsc2U7XG4gICAgICB2YXIgbGVmdElkID0gMCwgcmlnaHRJZCA9IDA7XG4gICAgICB2YXIgbGVmdE1hcCA9IG5ldyBNYXAoKSwgcmlnaHRNYXAgPSBuZXcgTWFwKCk7XG4gICAgICB2YXIgaGFuZGxlRXJyb3IgPSBmdW5jdGlvbiAoZSkgeyBvLm9uRXJyb3IoZSk7IH07XG5cbiAgICAgIGdyb3VwLmFkZChsZWZ0LnN1YnNjcmliZShcbiAgICAgICAgZnVuY3Rpb24gKHZhbHVlKSB7XG4gICAgICAgICAgdmFyIGlkID0gbGVmdElkKyssIG1kID0gbmV3IFNpbmdsZUFzc2lnbm1lbnREaXNwb3NhYmxlKCk7XG5cbiAgICAgICAgICBsZWZ0TWFwLnNldChpZCwgdmFsdWUpO1xuICAgICAgICAgIGdyb3VwLmFkZChtZCk7XG5cbiAgICAgICAgICB2YXIgZHVyYXRpb24gPSB0cnlDYXRjaChsZWZ0RHVyYXRpb25TZWxlY3RvcikodmFsdWUpO1xuICAgICAgICAgIGlmIChkdXJhdGlvbiA9PT0gZXJyb3JPYmopIHsgcmV0dXJuIG8ub25FcnJvcihkdXJhdGlvbi5lKTsgfVxuXG4gICAgICAgICAgbWQuc2V0RGlzcG9zYWJsZShkdXJhdGlvbi50YWtlKDEpLnN1YnNjcmliZShcbiAgICAgICAgICAgIG5vb3AsXG4gICAgICAgICAgICBoYW5kbGVFcnJvcixcbiAgICAgICAgICAgIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgbGVmdE1hcFsnZGVsZXRlJ10oaWQpICYmIGxlZnRNYXAuc2l6ZSA9PT0gMCAmJiBsZWZ0RG9uZSAmJiBvLm9uQ29tcGxldGVkKCk7XG4gICAgICAgICAgICAgIGdyb3VwLnJlbW92ZShtZCk7XG4gICAgICAgICAgICB9KSk7XG5cbiAgICAgICAgICByaWdodE1hcC5mb3JFYWNoKGZ1bmN0aW9uICh2KSB7XG4gICAgICAgICAgICB2YXIgcmVzdWx0ID0gdHJ5Q2F0Y2gocmVzdWx0U2VsZWN0b3IpKHZhbHVlLCB2KTtcbiAgICAgICAgICAgIGlmIChyZXN1bHQgPT09IGVycm9yT2JqKSB7IHJldHVybiBvLm9uRXJyb3IocmVzdWx0LmUpOyB9XG4gICAgICAgICAgICBvLm9uTmV4dChyZXN1bHQpO1xuICAgICAgICAgIH0pO1xuICAgICAgICB9LFxuICAgICAgICBoYW5kbGVFcnJvcixcbiAgICAgICAgZnVuY3Rpb24gKCkge1xuICAgICAgICAgIGxlZnREb25lID0gdHJ1ZTtcbiAgICAgICAgICAocmlnaHREb25lIHx8IGxlZnRNYXAuc2l6ZSA9PT0gMCkgJiYgby5vbkNvbXBsZXRlZCgpO1xuICAgICAgICB9KVxuICAgICAgKTtcblxuICAgICAgZ3JvdXAuYWRkKHJpZ2h0LnN1YnNjcmliZShcbiAgICAgICAgZnVuY3Rpb24gKHZhbHVlKSB7XG4gICAgICAgICAgdmFyIGlkID0gcmlnaHRJZCsrLCBtZCA9IG5ldyBTaW5nbGVBc3NpZ25tZW50RGlzcG9zYWJsZSgpO1xuXG4gICAgICAgICAgcmlnaHRNYXAuc2V0KGlkLCB2YWx1ZSk7XG4gICAgICAgICAgZ3JvdXAuYWRkKG1kKTtcblxuICAgICAgICAgIHZhciBkdXJhdGlvbiA9IHRyeUNhdGNoKHJpZ2h0RHVyYXRpb25TZWxlY3RvcikodmFsdWUpO1xuICAgICAgICAgIGlmIChkdXJhdGlvbiA9PT0gZXJyb3JPYmopIHsgcmV0dXJuIG8ub25FcnJvcihkdXJhdGlvbi5lKTsgfVxuXG4gICAgICAgICAgbWQuc2V0RGlzcG9zYWJsZShkdXJhdGlvbi50YWtlKDEpLnN1YnNjcmliZShcbiAgICAgICAgICAgIG5vb3AsXG4gICAgICAgICAgICBoYW5kbGVFcnJvcixcbiAgICAgICAgICAgIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgcmlnaHRNYXBbJ2RlbGV0ZSddKGlkKSAmJiByaWdodE1hcC5zaXplID09PSAwICYmIHJpZ2h0RG9uZSAmJiBvLm9uQ29tcGxldGVkKCk7XG4gICAgICAgICAgICAgIGdyb3VwLnJlbW92ZShtZCk7XG4gICAgICAgICAgICB9KSk7XG5cbiAgICAgICAgICBsZWZ0TWFwLmZvckVhY2goZnVuY3Rpb24gKHYpIHtcbiAgICAgICAgICAgIHZhciByZXN1bHQgPSB0cnlDYXRjaChyZXN1bHRTZWxlY3RvcikodiwgdmFsdWUpO1xuICAgICAgICAgICAgaWYgKHJlc3VsdCA9PT0gZXJyb3JPYmopIHsgcmV0dXJuIG8ub25FcnJvcihyZXN1bHQuZSk7IH1cbiAgICAgICAgICAgIG8ub25OZXh0KHJlc3VsdCk7XG4gICAgICAgICAgfSk7XG4gICAgICAgIH0sXG4gICAgICAgIGhhbmRsZUVycm9yLFxuICAgICAgICBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgcmlnaHREb25lID0gdHJ1ZTtcbiAgICAgICAgICAobGVmdERvbmUgfHwgcmlnaHRNYXAuc2l6ZSA9PT0gMCkgJiYgby5vbkNvbXBsZXRlZCgpO1xuICAgICAgICB9KVxuICAgICAgKTtcbiAgICAgIHJldHVybiBncm91cDtcbiAgICB9LCBsZWZ0KTtcbiAgfTtcblxuICAvKipcbiAgICogIENvcnJlbGF0ZXMgdGhlIGVsZW1lbnRzIG9mIHR3byBzZXF1ZW5jZXMgYmFzZWQgb24gb3ZlcmxhcHBpbmcgZHVyYXRpb25zLCBhbmQgZ3JvdXBzIHRoZSByZXN1bHRzLlxuICAgKlxuICAgKiAgQHBhcmFtIHtPYnNlcnZhYmxlfSByaWdodCBUaGUgcmlnaHQgb2JzZXJ2YWJsZSBzZXF1ZW5jZSB0byBqb2luIGVsZW1lbnRzIGZvci5cbiAgICogIEBwYXJhbSB7RnVuY3Rpb259IGxlZnREdXJhdGlvblNlbGVjdG9yIEEgZnVuY3Rpb24gdG8gc2VsZWN0IHRoZSBkdXJhdGlvbiAoZXhwcmVzc2VkIGFzIGFuIG9ic2VydmFibGUgc2VxdWVuY2UpIG9mIGVhY2ggZWxlbWVudCBvZiB0aGUgbGVmdCBvYnNlcnZhYmxlIHNlcXVlbmNlLCB1c2VkIHRvIGRldGVybWluZSBvdmVybGFwLlxuICAgKiAgQHBhcmFtIHtGdW5jdGlvbn0gcmlnaHREdXJhdGlvblNlbGVjdG9yIEEgZnVuY3Rpb24gdG8gc2VsZWN0IHRoZSBkdXJhdGlvbiAoZXhwcmVzc2VkIGFzIGFuIG9ic2VydmFibGUgc2VxdWVuY2UpIG9mIGVhY2ggZWxlbWVudCBvZiB0aGUgcmlnaHQgb2JzZXJ2YWJsZSBzZXF1ZW5jZSwgdXNlZCB0byBkZXRlcm1pbmUgb3ZlcmxhcC5cbiAgICogIEBwYXJhbSB7RnVuY3Rpb259IHJlc3VsdFNlbGVjdG9yIEEgZnVuY3Rpb24gaW52b2tlZCB0byBjb21wdXRlIGEgcmVzdWx0IGVsZW1lbnQgZm9yIGFueSBlbGVtZW50IG9mIHRoZSBsZWZ0IHNlcXVlbmNlIHdpdGggb3ZlcmxhcHBpbmcgZWxlbWVudHMgZnJvbSB0aGUgcmlnaHQgb2JzZXJ2YWJsZSBzZXF1ZW5jZS4gVGhlIGZpcnN0IHBhcmFtZXRlciBwYXNzZWQgdG8gdGhlIGZ1bmN0aW9uIGlzIGFuIGVsZW1lbnQgb2YgdGhlIGxlZnQgc2VxdWVuY2UuIFRoZSBzZWNvbmQgcGFyYW1ldGVyIHBhc3NlZCB0byB0aGUgZnVuY3Rpb24gaXMgYW4gb2JzZXJ2YWJsZSBzZXF1ZW5jZSB3aXRoIGVsZW1lbnRzIGZyb20gdGhlIHJpZ2h0IHNlcXVlbmNlIHRoYXQgb3ZlcmxhcCB3aXRoIHRoZSBsZWZ0IHNlcXVlbmNlJ3MgZWxlbWVudC5cbiAgICogIEByZXR1cm5zIHtPYnNlcnZhYmxlfSBBbiBvYnNlcnZhYmxlIHNlcXVlbmNlIHRoYXQgY29udGFpbnMgcmVzdWx0IGVsZW1lbnRzIGNvbXB1dGVkIGZyb20gc291cmNlIGVsZW1lbnRzIHRoYXQgaGF2ZSBhbiBvdmVybGFwcGluZyBkdXJhdGlvbi5cbiAgICovXG4gIG9ic2VydmFibGVQcm90by5ncm91cEpvaW4gPSBmdW5jdGlvbiAocmlnaHQsIGxlZnREdXJhdGlvblNlbGVjdG9yLCByaWdodER1cmF0aW9uU2VsZWN0b3IsIHJlc3VsdFNlbGVjdG9yKSB7XG4gICAgdmFyIGxlZnQgPSB0aGlzO1xuICAgIHJldHVybiBuZXcgQW5vbnltb3VzT2JzZXJ2YWJsZShmdW5jdGlvbiAobykge1xuICAgICAgdmFyIGdyb3VwID0gbmV3IENvbXBvc2l0ZURpc3Bvc2FibGUoKTtcbiAgICAgIHZhciByID0gbmV3IFJlZkNvdW50RGlzcG9zYWJsZShncm91cCk7XG4gICAgICB2YXIgbGVmdE1hcCA9IG5ldyBNYXAoKSwgcmlnaHRNYXAgPSBuZXcgTWFwKCk7XG4gICAgICB2YXIgbGVmdElkID0gMCwgcmlnaHRJZCA9IDA7XG4gICAgICB2YXIgaGFuZGxlRXJyb3IgPSBmdW5jdGlvbiAoZSkgeyByZXR1cm4gZnVuY3Rpb24gKHYpIHsgdi5vbkVycm9yKGUpOyB9OyB9O1xuXG4gICAgICBmdW5jdGlvbiBoYW5kbGVFcnJvcihlKSB7IH07XG5cbiAgICAgIGdyb3VwLmFkZChsZWZ0LnN1YnNjcmliZShcbiAgICAgICAgZnVuY3Rpb24gKHZhbHVlKSB7XG4gICAgICAgICAgdmFyIHMgPSBuZXcgU3ViamVjdCgpO1xuICAgICAgICAgIHZhciBpZCA9IGxlZnRJZCsrO1xuICAgICAgICAgIGxlZnRNYXAuc2V0KGlkLCBzKTtcblxuICAgICAgICAgIHZhciByZXN1bHQgPSB0cnlDYXRjaChyZXN1bHRTZWxlY3RvcikodmFsdWUsIGFkZFJlZihzLCByKSk7XG4gICAgICAgICAgaWYgKHJlc3VsdCA9PT0gZXJyb3JPYmopIHtcbiAgICAgICAgICAgIGxlZnRNYXAuZm9yRWFjaChoYW5kbGVFcnJvcihyZXN1bHQuZSkpO1xuICAgICAgICAgICAgcmV0dXJuIG8ub25FcnJvcihyZXN1bHQuZSk7XG4gICAgICAgICAgfVxuICAgICAgICAgIG8ub25OZXh0KHJlc3VsdCk7XG5cbiAgICAgICAgICByaWdodE1hcC5mb3JFYWNoKGZ1bmN0aW9uICh2KSB7IHMub25OZXh0KHYpOyB9KTtcblxuICAgICAgICAgIHZhciBtZCA9IG5ldyBTaW5nbGVBc3NpZ25tZW50RGlzcG9zYWJsZSgpO1xuICAgICAgICAgIGdyb3VwLmFkZChtZCk7XG5cbiAgICAgICAgICB2YXIgZHVyYXRpb24gPSB0cnlDYXRjaChsZWZ0RHVyYXRpb25TZWxlY3RvcikodmFsdWUpO1xuICAgICAgICAgIGlmIChkdXJhdGlvbiA9PT0gZXJyb3JPYmopIHtcbiAgICAgICAgICAgIGxlZnRNYXAuZm9yRWFjaChoYW5kbGVFcnJvcihkdXJhdGlvbi5lKSk7XG4gICAgICAgICAgICByZXR1cm4gby5vbkVycm9yKGR1cmF0aW9uLmUpO1xuICAgICAgICAgIH1cblxuICAgICAgICAgIG1kLnNldERpc3Bvc2FibGUoZHVyYXRpb24udGFrZSgxKS5zdWJzY3JpYmUoXG4gICAgICAgICAgICBub29wLFxuICAgICAgICAgICAgZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgICAgICAgbGVmdE1hcC5mb3JFYWNoKGhhbmRsZUVycm9yKGUpKTtcbiAgICAgICAgICAgICAgby5vbkVycm9yKGUpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgbGVmdE1hcFsnZGVsZXRlJ10oaWQpICYmIHMub25Db21wbGV0ZWQoKTtcbiAgICAgICAgICAgICAgZ3JvdXAucmVtb3ZlKG1kKTtcbiAgICAgICAgICAgIH0pKTtcbiAgICAgICAgfSxcbiAgICAgICAgZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgICBsZWZ0TWFwLmZvckVhY2goaGFuZGxlRXJyb3IoZSkpO1xuICAgICAgICAgIG8ub25FcnJvcihlKTtcbiAgICAgICAgfSxcbiAgICAgICAgZnVuY3Rpb24gKCkgeyBvLm9uQ29tcGxldGVkKCk7IH0pXG4gICAgICApO1xuXG4gICAgICBncm91cC5hZGQocmlnaHQuc3Vic2NyaWJlKFxuICAgICAgICBmdW5jdGlvbiAodmFsdWUpIHtcbiAgICAgICAgICB2YXIgaWQgPSByaWdodElkKys7XG4gICAgICAgICAgcmlnaHRNYXAuc2V0KGlkLCB2YWx1ZSk7XG5cbiAgICAgICAgICB2YXIgbWQgPSBuZXcgU2luZ2xlQXNzaWdubWVudERpc3Bvc2FibGUoKTtcbiAgICAgICAgICBncm91cC5hZGQobWQpO1xuXG4gICAgICAgICAgdmFyIGR1cmF0aW9uID0gdHJ5Q2F0Y2gocmlnaHREdXJhdGlvblNlbGVjdG9yKSh2YWx1ZSk7XG4gICAgICAgICAgaWYgKGR1cmF0aW9uID09PSBlcnJvck9iaikge1xuICAgICAgICAgICAgbGVmdE1hcC5mb3JFYWNoKGhhbmRsZUVycm9yKGR1cmF0aW9uLmUpKTtcbiAgICAgICAgICAgIHJldHVybiBvLm9uRXJyb3IoZHVyYXRpb24uZSk7XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgbWQuc2V0RGlzcG9zYWJsZShkdXJhdGlvbi50YWtlKDEpLnN1YnNjcmliZShcbiAgICAgICAgICAgIG5vb3AsXG4gICAgICAgICAgICBmdW5jdGlvbiAoZSkge1xuICAgICAgICAgICAgICBsZWZ0TWFwLmZvckVhY2goaGFuZGxlRXJyb3IoZSkpO1xuICAgICAgICAgICAgICBvLm9uRXJyb3IoZSk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICByaWdodE1hcFsnZGVsZXRlJ10oaWQpO1xuICAgICAgICAgICAgICBncm91cC5yZW1vdmUobWQpO1xuICAgICAgICAgICAgfSkpO1xuXG4gICAgICAgICAgbGVmdE1hcC5mb3JFYWNoKGZ1bmN0aW9uICh2KSB7IHYub25OZXh0KHZhbHVlKTsgfSk7XG4gICAgICAgIH0sXG4gICAgICAgIGZ1bmN0aW9uIChlKSB7XG4gICAgICAgICAgbGVmdE1hcC5mb3JFYWNoKGhhbmRsZUVycm9yKGUpKTtcbiAgICAgICAgICBvLm9uRXJyb3IoZSk7XG4gICAgICAgIH0pXG4gICAgICApO1xuXG4gICAgICByZXR1cm4gcjtcbiAgICB9LCBsZWZ0KTtcbiAgfTtcblxuICBmdW5jdGlvbiB0b0FycmF5KHgpIHsgcmV0dXJuIHgudG9BcnJheSgpOyB9XG5cbiAgLyoqXG4gICAqICBQcm9qZWN0cyBlYWNoIGVsZW1lbnQgb2YgYW4gb2JzZXJ2YWJsZSBzZXF1ZW5jZSBpbnRvIHplcm8gb3IgbW9yZSBidWZmZXJzLlxuICAgKiAgQHBhcmFtIHtNaXhlZH0gYnVmZmVyT3BlbmluZ3NPckNsb3NpbmdTZWxlY3RvciBPYnNlcnZhYmxlIHNlcXVlbmNlIHdob3NlIGVsZW1lbnRzIGRlbm90ZSB0aGUgY3JlYXRpb24gb2YgbmV3IHdpbmRvd3MsIG9yLCBhIGZ1bmN0aW9uIGludm9rZWQgdG8gZGVmaW5lIHRoZSBib3VuZGFyaWVzIG9mIHRoZSBwcm9kdWNlZCB3aW5kb3dzIChhIG5ldyB3aW5kb3cgaXMgc3RhcnRlZCB3aGVuIHRoZSBwcmV2aW91cyBvbmUgaXMgY2xvc2VkLCByZXN1bHRpbmcgaW4gbm9uLW92ZXJsYXBwaW5nIHdpbmRvd3MpLlxuICAgKiAgQHBhcmFtIHtGdW5jdGlvbn0gW2J1ZmZlckNsb3NpbmdTZWxlY3Rvcl0gQSBmdW5jdGlvbiBpbnZva2VkIHRvIGRlZmluZSB0aGUgY2xvc2luZyBvZiBlYWNoIHByb2R1Y2VkIHdpbmRvdy4gSWYgYSBjbG9zaW5nIHNlbGVjdG9yIGZ1bmN0aW9uIGlzIHNwZWNpZmllZCBmb3IgdGhlIGZpcnN0IHBhcmFtZXRlciwgdGhpcyBwYXJhbWV0ZXIgaXMgaWdub3JlZC5cbiAgICogIEByZXR1cm5zIHtPYnNlcnZhYmxlfSBBbiBvYnNlcnZhYmxlIHNlcXVlbmNlIG9mIHdpbmRvd3MuXG4gICAqL1xuICBvYnNlcnZhYmxlUHJvdG8uYnVmZmVyID0gZnVuY3Rpb24gKCkge1xuICAgIHJldHVybiB0aGlzLndpbmRvdy5hcHBseSh0aGlzLCBhcmd1bWVudHMpXG4gICAgICAuZmxhdE1hcCh0b0FycmF5KTtcbiAgfTtcblxuICAvKipcbiAgICogIFByb2plY3RzIGVhY2ggZWxlbWVudCBvZiBhbiBvYnNlcnZhYmxlIHNlcXVlbmNlIGludG8gemVybyBvciBtb3JlIHdpbmRvd3MuXG4gICAqXG4gICAqICBAcGFyYW0ge01peGVkfSB3aW5kb3dPcGVuaW5nc09yQ2xvc2luZ1NlbGVjdG9yIE9ic2VydmFibGUgc2VxdWVuY2Ugd2hvc2UgZWxlbWVudHMgZGVub3RlIHRoZSBjcmVhdGlvbiBvZiBuZXcgd2luZG93cywgb3IsIGEgZnVuY3Rpb24gaW52b2tlZCB0byBkZWZpbmUgdGhlIGJvdW5kYXJpZXMgb2YgdGhlIHByb2R1Y2VkIHdpbmRvd3MgKGEgbmV3IHdpbmRvdyBpcyBzdGFydGVkIHdoZW4gdGhlIHByZXZpb3VzIG9uZSBpcyBjbG9zZWQsIHJlc3VsdGluZyBpbiBub24tb3ZlcmxhcHBpbmcgd2luZG93cykuXG4gICAqICBAcGFyYW0ge0Z1bmN0aW9ufSBbd2luZG93Q2xvc2luZ1NlbGVjdG9yXSBBIGZ1bmN0aW9uIGludm9rZWQgdG8gZGVmaW5lIHRoZSBjbG9zaW5nIG9mIGVhY2ggcHJvZHVjZWQgd2luZG93LiBJZiBhIGNsb3Npbmcgc2VsZWN0b3IgZnVuY3Rpb24gaXMgc3BlY2lmaWVkIGZvciB0aGUgZmlyc3QgcGFyYW1ldGVyLCB0aGlzIHBhcmFtZXRlciBpcyBpZ25vcmVkLlxuICAgKiAgQHJldHVybnMge09ic2VydmFibGV9IEFuIG9ic2VydmFibGUgc2VxdWVuY2Ugb2Ygd2luZG93cy5cbiAgICovXG4gIG9ic2VydmFibGVQcm90by53aW5kb3cgPSBmdW5jdGlvbiAod2luZG93T3BlbmluZ3NPckNsb3NpbmdTZWxlY3Rvciwgd2luZG93Q2xvc2luZ1NlbGVjdG9yKSB7XG4gICAgaWYgKGFyZ3VtZW50cy5sZW5ndGggPT09IDEgJiYgdHlwZW9mIGFyZ3VtZW50c1swXSAhPT0gJ2Z1bmN0aW9uJykge1xuICAgICAgcmV0dXJuIG9ic2VydmFibGVXaW5kb3dXaXRoQm91bmRhcmllcy5jYWxsKHRoaXMsIHdpbmRvd09wZW5pbmdzT3JDbG9zaW5nU2VsZWN0b3IpO1xuICAgIH1cbiAgICByZXR1cm4gdHlwZW9mIHdpbmRvd09wZW5pbmdzT3JDbG9zaW5nU2VsZWN0b3IgPT09ICdmdW5jdGlvbicgP1xuICAgICAgb2JzZXJ2YWJsZVdpbmRvd1dpdGhDbG9zaW5nU2VsZWN0b3IuY2FsbCh0aGlzLCB3aW5kb3dPcGVuaW5nc09yQ2xvc2luZ1NlbGVjdG9yKSA6XG4gICAgICBvYnNlcnZhYmxlV2luZG93V2l0aE9wZW5pbmdzLmNhbGwodGhpcywgd2luZG93T3BlbmluZ3NPckNsb3NpbmdTZWxlY3Rvciwgd2luZG93Q2xvc2luZ1NlbGVjdG9yKTtcbiAgfTtcblxuICBmdW5jdGlvbiBvYnNlcnZhYmxlV2luZG93V2l0aE9wZW5pbmdzKHdpbmRvd09wZW5pbmdzLCB3aW5kb3dDbG9zaW5nU2VsZWN0b3IpIHtcbiAgICByZXR1cm4gd2luZG93T3BlbmluZ3MuZ3JvdXBKb2luKHRoaXMsIHdpbmRvd0Nsb3NpbmdTZWxlY3Rvciwgb2JzZXJ2YWJsZUVtcHR5LCBmdW5jdGlvbiAoXywgd2luKSB7XG4gICAgICByZXR1cm4gd2luO1xuICAgIH0pO1xuICB9XG5cbiAgZnVuY3Rpb24gb2JzZXJ2YWJsZVdpbmRvd1dpdGhCb3VuZGFyaWVzKHdpbmRvd0JvdW5kYXJpZXMpIHtcbiAgICB2YXIgc291cmNlID0gdGhpcztcbiAgICByZXR1cm4gbmV3IEFub255bW91c09ic2VydmFibGUoZnVuY3Rpb24gKG9ic2VydmVyKSB7XG4gICAgICB2YXIgd2luID0gbmV3IFN1YmplY3QoKSxcbiAgICAgICAgZCA9IG5ldyBDb21wb3NpdGVEaXNwb3NhYmxlKCksXG4gICAgICAgIHIgPSBuZXcgUmVmQ291bnREaXNwb3NhYmxlKGQpO1xuXG4gICAgICBvYnNlcnZlci5vbk5leHQoYWRkUmVmKHdpbiwgcikpO1xuXG4gICAgICBkLmFkZChzb3VyY2Uuc3Vic2NyaWJlKGZ1bmN0aW9uICh4KSB7XG4gICAgICAgIHdpbi5vbk5leHQoeCk7XG4gICAgICB9LCBmdW5jdGlvbiAoZXJyKSB7XG4gICAgICAgIHdpbi5vbkVycm9yKGVycik7XG4gICAgICAgIG9ic2VydmVyLm9uRXJyb3IoZXJyKTtcbiAgICAgIH0sIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgd2luLm9uQ29tcGxldGVkKCk7XG4gICAgICAgIG9ic2VydmVyLm9uQ29tcGxldGVkKCk7XG4gICAgICB9KSk7XG5cbiAgICAgIGlzUHJvbWlzZSh3aW5kb3dCb3VuZGFyaWVzKSAmJiAod2luZG93Qm91bmRhcmllcyA9IG9ic2VydmFibGVGcm9tUHJvbWlzZSh3aW5kb3dCb3VuZGFyaWVzKSk7XG5cbiAgICAgIGQuYWRkKHdpbmRvd0JvdW5kYXJpZXMuc3Vic2NyaWJlKGZ1bmN0aW9uICh3KSB7XG4gICAgICAgIHdpbi5vbkNvbXBsZXRlZCgpO1xuICAgICAgICB3aW4gPSBuZXcgU3ViamVjdCgpO1xuICAgICAgICBvYnNlcnZlci5vbk5leHQoYWRkUmVmKHdpbiwgcikpO1xuICAgICAgfSwgZnVuY3Rpb24gKGVycikge1xuICAgICAgICB3aW4ub25FcnJvcihlcnIpO1xuICAgICAgICBvYnNlcnZlci5vbkVycm9yKGVycik7XG4gICAgICB9LCBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHdpbi5vbkNvbXBsZXRlZCgpO1xuICAgICAgICBvYnNlcnZlci5vbkNvbXBsZXRlZCgpO1xuICAgICAgfSkpO1xuXG4gICAgICByZXR1cm4gcjtcbiAgICB9LCBzb3VyY2UpO1xuICB9XG5cbiAgZnVuY3Rpb24gb2JzZXJ2YWJsZVdpbmRvd1dpdGhDbG9zaW5nU2VsZWN0b3Iod2luZG93Q2xvc2luZ1NlbGVjdG9yKSB7XG4gICAgdmFyIHNvdXJjZSA9IHRoaXM7XG4gICAgcmV0dXJuIG5ldyBBbm9ueW1vdXNPYnNlcnZhYmxlKGZ1bmN0aW9uIChvYnNlcnZlcikge1xuICAgICAgdmFyIG0gPSBuZXcgU2VyaWFsRGlzcG9zYWJsZSgpLFxuICAgICAgICBkID0gbmV3IENvbXBvc2l0ZURpc3Bvc2FibGUobSksXG4gICAgICAgIHIgPSBuZXcgUmVmQ291bnREaXNwb3NhYmxlKGQpLFxuICAgICAgICB3aW4gPSBuZXcgU3ViamVjdCgpO1xuICAgICAgb2JzZXJ2ZXIub25OZXh0KGFkZFJlZih3aW4sIHIpKTtcbiAgICAgIGQuYWRkKHNvdXJjZS5zdWJzY3JpYmUoZnVuY3Rpb24gKHgpIHtcbiAgICAgICAgICB3aW4ub25OZXh0KHgpO1xuICAgICAgfSwgZnVuY3Rpb24gKGVycikge1xuICAgICAgICAgIHdpbi5vbkVycm9yKGVycik7XG4gICAgICAgICAgb2JzZXJ2ZXIub25FcnJvcihlcnIpO1xuICAgICAgfSwgZnVuY3Rpb24gKCkge1xuICAgICAgICAgIHdpbi5vbkNvbXBsZXRlZCgpO1xuICAgICAgICAgIG9ic2VydmVyLm9uQ29tcGxldGVkKCk7XG4gICAgICB9KSk7XG5cbiAgICAgIGZ1bmN0aW9uIGNyZWF0ZVdpbmRvd0Nsb3NlICgpIHtcbiAgICAgICAgdmFyIHdpbmRvd0Nsb3NlO1xuICAgICAgICB0cnkge1xuICAgICAgICAgIHdpbmRvd0Nsb3NlID0gd2luZG93Q2xvc2luZ1NlbGVjdG9yKCk7XG4gICAgICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgICBvYnNlcnZlci5vbkVycm9yKGUpO1xuICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuXG4gICAgICAgIGlzUHJvbWlzZSh3aW5kb3dDbG9zZSkgJiYgKHdpbmRvd0Nsb3NlID0gb2JzZXJ2YWJsZUZyb21Qcm9taXNlKHdpbmRvd0Nsb3NlKSk7XG5cbiAgICAgICAgdmFyIG0xID0gbmV3IFNpbmdsZUFzc2lnbm1lbnREaXNwb3NhYmxlKCk7XG4gICAgICAgIG0uc2V0RGlzcG9zYWJsZShtMSk7XG4gICAgICAgIG0xLnNldERpc3Bvc2FibGUod2luZG93Q2xvc2UudGFrZSgxKS5zdWJzY3JpYmUobm9vcCwgZnVuY3Rpb24gKGVycikge1xuICAgICAgICAgIHdpbi5vbkVycm9yKGVycik7XG4gICAgICAgICAgb2JzZXJ2ZXIub25FcnJvcihlcnIpO1xuICAgICAgICB9LCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgd2luLm9uQ29tcGxldGVkKCk7XG4gICAgICAgICAgd2luID0gbmV3IFN1YmplY3QoKTtcbiAgICAgICAgICBvYnNlcnZlci5vbk5leHQoYWRkUmVmKHdpbiwgcikpO1xuICAgICAgICAgIGNyZWF0ZVdpbmRvd0Nsb3NlKCk7XG4gICAgICAgIH0pKTtcbiAgICAgIH1cblxuICAgICAgY3JlYXRlV2luZG93Q2xvc2UoKTtcbiAgICAgIHJldHVybiByO1xuICAgIH0sIHNvdXJjZSk7XG4gIH1cblxuICAvKipcbiAgICogUmV0dXJucyBhIG5ldyBvYnNlcnZhYmxlIHRoYXQgdHJpZ2dlcnMgb24gdGhlIHNlY29uZCBhbmQgc3Vic2VxdWVudCB0cmlnZ2VyaW5ncyBvZiB0aGUgaW5wdXQgb2JzZXJ2YWJsZS5cbiAgICogVGhlIE50aCB0cmlnZ2VyaW5nIG9mIHRoZSBpbnB1dCBvYnNlcnZhYmxlIHBhc3NlcyB0aGUgYXJndW1lbnRzIGZyb20gdGhlIE4tMXRoIGFuZCBOdGggdHJpZ2dlcmluZyBhcyBhIHBhaXIuXG4gICAqIFRoZSBhcmd1bWVudCBwYXNzZWQgdG8gdGhlIE4tMXRoIHRyaWdnZXJpbmcgaXMgaGVsZCBpbiBoaWRkZW4gaW50ZXJuYWwgc3RhdGUgdW50aWwgdGhlIE50aCB0cmlnZ2VyaW5nIG9jY3Vycy5cbiAgICogQHJldHVybnMge09ic2VydmFibGV9IEFuIG9ic2VydmFibGUgdGhhdCB0cmlnZ2VycyBvbiBzdWNjZXNzaXZlIHBhaXJzIG9mIG9ic2VydmF0aW9ucyBmcm9tIHRoZSBpbnB1dCBvYnNlcnZhYmxlIGFzIGFuIGFycmF5LlxuICAgKi9cbiAgb2JzZXJ2YWJsZVByb3RvLnBhaXJ3aXNlID0gZnVuY3Rpb24gKCkge1xuICAgIHZhciBzb3VyY2UgPSB0aGlzO1xuICAgIHJldHVybiBuZXcgQW5vbnltb3VzT2JzZXJ2YWJsZShmdW5jdGlvbiAob2JzZXJ2ZXIpIHtcbiAgICAgIHZhciBwcmV2aW91cywgaGFzUHJldmlvdXMgPSBmYWxzZTtcbiAgICAgIHJldHVybiBzb3VyY2Uuc3Vic2NyaWJlKFxuICAgICAgICBmdW5jdGlvbiAoeCkge1xuICAgICAgICAgIGlmIChoYXNQcmV2aW91cykge1xuICAgICAgICAgICAgb2JzZXJ2ZXIub25OZXh0KFtwcmV2aW91cywgeF0pO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBoYXNQcmV2aW91cyA9IHRydWU7XG4gICAgICAgICAgfVxuICAgICAgICAgIHByZXZpb3VzID0geDtcbiAgICAgICAgfSxcbiAgICAgICAgb2JzZXJ2ZXIub25FcnJvci5iaW5kKG9ic2VydmVyKSxcbiAgICAgICAgb2JzZXJ2ZXIub25Db21wbGV0ZWQuYmluZChvYnNlcnZlcikpO1xuICAgIH0sIHNvdXJjZSk7XG4gIH07XG5cbiAgLyoqXG4gICAqIFJldHVybnMgdHdvIG9ic2VydmFibGVzIHdoaWNoIHBhcnRpdGlvbiB0aGUgb2JzZXJ2YXRpb25zIG9mIHRoZSBzb3VyY2UgYnkgdGhlIGdpdmVuIGZ1bmN0aW9uLlxuICAgKiBUaGUgZmlyc3Qgd2lsbCB0cmlnZ2VyIG9ic2VydmF0aW9ucyBmb3IgdGhvc2UgdmFsdWVzIGZvciB3aGljaCB0aGUgcHJlZGljYXRlIHJldHVybnMgdHJ1ZS5cbiAgICogVGhlIHNlY29uZCB3aWxsIHRyaWdnZXIgb2JzZXJ2YXRpb25zIGZvciB0aG9zZSB2YWx1ZXMgd2hlcmUgdGhlIHByZWRpY2F0ZSByZXR1cm5zIGZhbHNlLlxuICAgKiBUaGUgcHJlZGljYXRlIGlzIGV4ZWN1dGVkIG9uY2UgZm9yIGVhY2ggc3Vic2NyaWJlZCBvYnNlcnZlci5cbiAgICogQm90aCBhbHNvIHByb3BhZ2F0ZSBhbGwgZXJyb3Igb2JzZXJ2YXRpb25zIGFyaXNpbmcgZnJvbSB0aGUgc291cmNlIGFuZCBlYWNoIGNvbXBsZXRlc1xuICAgKiB3aGVuIHRoZSBzb3VyY2UgY29tcGxldGVzLlxuICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBwcmVkaWNhdGVcbiAgICogICAgVGhlIGZ1bmN0aW9uIHRvIGRldGVybWluZSB3aGljaCBvdXRwdXQgT2JzZXJ2YWJsZSB3aWxsIHRyaWdnZXIgYSBwYXJ0aWN1bGFyIG9ic2VydmF0aW9uLlxuICAgKiBAcmV0dXJucyB7QXJyYXl9XG4gICAqICAgIEFuIGFycmF5IG9mIG9ic2VydmFibGVzLiBUaGUgZmlyc3QgdHJpZ2dlcnMgd2hlbiB0aGUgcHJlZGljYXRlIHJldHVybnMgdHJ1ZSxcbiAgICogICAgYW5kIHRoZSBzZWNvbmQgdHJpZ2dlcnMgd2hlbiB0aGUgcHJlZGljYXRlIHJldHVybnMgZmFsc2UuXG4gICovXG4gIG9ic2VydmFibGVQcm90by5wYXJ0aXRpb24gPSBmdW5jdGlvbihwcmVkaWNhdGUsIHRoaXNBcmcpIHtcbiAgICByZXR1cm4gW1xuICAgICAgdGhpcy5maWx0ZXIocHJlZGljYXRlLCB0aGlzQXJnKSxcbiAgICAgIHRoaXMuZmlsdGVyKGZ1bmN0aW9uICh4LCBpLCBvKSB7IHJldHVybiAhcHJlZGljYXRlLmNhbGwodGhpc0FyZywgeCwgaSwgbyk7IH0pXG4gICAgXTtcbiAgfTtcblxuICB2YXIgV2hpbGVFbnVtZXJhYmxlID0gKGZ1bmN0aW9uKF9fc3VwZXJfXykge1xuICAgIGluaGVyaXRzKFdoaWxlRW51bWVyYWJsZSwgX19zdXBlcl9fKTtcbiAgICBmdW5jdGlvbiBXaGlsZUVudW1lcmFibGUoYywgcykge1xuICAgICAgdGhpcy5jID0gYztcbiAgICAgIHRoaXMucyA9IHM7XG4gICAgfVxuICAgIFdoaWxlRW51bWVyYWJsZS5wcm90b3R5cGVbJGl0ZXJhdG9yJF0gPSBmdW5jdGlvbiAoKSB7XG4gICAgICB2YXIgc2VsZiA9IHRoaXM7XG4gICAgICByZXR1cm4ge1xuICAgICAgICBuZXh0OiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgcmV0dXJuIHNlbGYuYygpID9cbiAgICAgICAgICAgeyBkb25lOiBmYWxzZSwgdmFsdWU6IHNlbGYucyB9IDpcbiAgICAgICAgICAgeyBkb25lOiB0cnVlLCB2YWx1ZTogdm9pZCAwIH07XG4gICAgICAgIH1cbiAgICAgIH07XG4gICAgfTtcbiAgICByZXR1cm4gV2hpbGVFbnVtZXJhYmxlO1xuICB9KEVudW1lcmFibGUpKTtcbiAgXG4gIGZ1bmN0aW9uIGVudW1lcmFibGVXaGlsZShjb25kaXRpb24sIHNvdXJjZSkge1xuICAgIHJldHVybiBuZXcgV2hpbGVFbnVtZXJhYmxlKGNvbmRpdGlvbiwgc291cmNlKTtcbiAgfSAgXG5cbiAgIC8qKlxuICAgKiAgUmV0dXJucyBhbiBvYnNlcnZhYmxlIHNlcXVlbmNlIHRoYXQgaXMgdGhlIHJlc3VsdCBvZiBpbnZva2luZyB0aGUgc2VsZWN0b3Igb24gdGhlIHNvdXJjZSBzZXF1ZW5jZSwgd2l0aG91dCBzaGFyaW5nIHN1YnNjcmlwdGlvbnMuXG4gICAqICBUaGlzIG9wZXJhdG9yIGFsbG93cyBmb3IgYSBmbHVlbnQgc3R5bGUgb2Ygd3JpdGluZyBxdWVyaWVzIHRoYXQgdXNlIHRoZSBzYW1lIHNlcXVlbmNlIG11bHRpcGxlIHRpbWVzLlxuICAgKlxuICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBzZWxlY3RvciBTZWxlY3RvciBmdW5jdGlvbiB3aGljaCBjYW4gdXNlIHRoZSBzb3VyY2Ugc2VxdWVuY2UgYXMgbWFueSB0aW1lcyBhcyBuZWVkZWQsIHdpdGhvdXQgc2hhcmluZyBzdWJzY3JpcHRpb25zIHRvIHRoZSBzb3VyY2Ugc2VxdWVuY2UuXG4gICAqIEByZXR1cm5zIHtPYnNlcnZhYmxlfSBBbiBvYnNlcnZhYmxlIHNlcXVlbmNlIHRoYXQgY29udGFpbnMgdGhlIGVsZW1lbnRzIG9mIGEgc2VxdWVuY2UgcHJvZHVjZWQgYnkgbXVsdGljYXN0aW5nIHRoZSBzb3VyY2Ugc2VxdWVuY2Ugd2l0aGluIGEgc2VsZWN0b3IgZnVuY3Rpb24uXG4gICAqL1xuICBvYnNlcnZhYmxlUHJvdG8ubGV0QmluZCA9IG9ic2VydmFibGVQcm90b1snbGV0J10gPSBmdW5jdGlvbiAoZnVuYykge1xuICAgIHJldHVybiBmdW5jKHRoaXMpO1xuICB9O1xuXG4gICAvKipcbiAgICogIERldGVybWluZXMgd2hldGhlciBhbiBvYnNlcnZhYmxlIGNvbGxlY3Rpb24gY29udGFpbnMgdmFsdWVzLiBcbiAgICpcbiAgICogQGV4YW1wbGVcbiAgICogIDEgLSByZXMgPSBSeC5PYnNlcnZhYmxlLmlmKGNvbmRpdGlvbiwgb2JzMSk7XG4gICAqICAyIC0gcmVzID0gUnguT2JzZXJ2YWJsZS5pZihjb25kaXRpb24sIG9iczEsIG9iczIpO1xuICAgKiAgMyAtIHJlcyA9IFJ4Lk9ic2VydmFibGUuaWYoY29uZGl0aW9uLCBvYnMxLCBzY2hlZHVsZXIpO1xuICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBjb25kaXRpb24gVGhlIGNvbmRpdGlvbiB3aGljaCBkZXRlcm1pbmVzIGlmIHRoZSB0aGVuU291cmNlIG9yIGVsc2VTb3VyY2Ugd2lsbCBiZSBydW4uXG4gICAqIEBwYXJhbSB7T2JzZXJ2YWJsZX0gdGhlblNvdXJjZSBUaGUgb2JzZXJ2YWJsZSBzZXF1ZW5jZSBvciBQcm9taXNlIHRoYXQgd2lsbCBiZSBydW4gaWYgdGhlIGNvbmRpdGlvbiBmdW5jdGlvbiByZXR1cm5zIHRydWUuXG4gICAqIEBwYXJhbSB7T2JzZXJ2YWJsZX0gW2Vsc2VTb3VyY2VdIFRoZSBvYnNlcnZhYmxlIHNlcXVlbmNlIG9yIFByb21pc2UgdGhhdCB3aWxsIGJlIHJ1biBpZiB0aGUgY29uZGl0aW9uIGZ1bmN0aW9uIHJldHVybnMgZmFsc2UuIElmIHRoaXMgaXMgbm90IHByb3ZpZGVkLCBpdCBkZWZhdWx0cyB0byBSeC5PYnNlcnZhYmUuRW1wdHkgd2l0aCB0aGUgc3BlY2lmaWVkIHNjaGVkdWxlci5cbiAgICogQHJldHVybnMge09ic2VydmFibGV9IEFuIG9ic2VydmFibGUgc2VxdWVuY2Ugd2hpY2ggaXMgZWl0aGVyIHRoZSB0aGVuU291cmNlIG9yIGVsc2VTb3VyY2UuXG4gICAqL1xuICBPYnNlcnZhYmxlWydpZiddID0gZnVuY3Rpb24gKGNvbmRpdGlvbiwgdGhlblNvdXJjZSwgZWxzZVNvdXJjZU9yU2NoZWR1bGVyKSB7XG4gICAgcmV0dXJuIG9ic2VydmFibGVEZWZlcihmdW5jdGlvbiAoKSB7XG4gICAgICBlbHNlU291cmNlT3JTY2hlZHVsZXIgfHwgKGVsc2VTb3VyY2VPclNjaGVkdWxlciA9IG9ic2VydmFibGVFbXB0eSgpKTtcblxuICAgICAgaXNQcm9taXNlKHRoZW5Tb3VyY2UpICYmICh0aGVuU291cmNlID0gb2JzZXJ2YWJsZUZyb21Qcm9taXNlKHRoZW5Tb3VyY2UpKTtcbiAgICAgIGlzUHJvbWlzZShlbHNlU291cmNlT3JTY2hlZHVsZXIpICYmIChlbHNlU291cmNlT3JTY2hlZHVsZXIgPSBvYnNlcnZhYmxlRnJvbVByb21pc2UoZWxzZVNvdXJjZU9yU2NoZWR1bGVyKSk7XG5cbiAgICAgIC8vIEFzc3VtZSBhIHNjaGVkdWxlciBmb3IgZW1wdHkgb25seVxuICAgICAgdHlwZW9mIGVsc2VTb3VyY2VPclNjaGVkdWxlci5ub3cgPT09ICdmdW5jdGlvbicgJiYgKGVsc2VTb3VyY2VPclNjaGVkdWxlciA9IG9ic2VydmFibGVFbXB0eShlbHNlU291cmNlT3JTY2hlZHVsZXIpKTtcbiAgICAgIHJldHVybiBjb25kaXRpb24oKSA/IHRoZW5Tb3VyY2UgOiBlbHNlU291cmNlT3JTY2hlZHVsZXI7XG4gICAgfSk7XG4gIH07XG5cbiAgIC8qKlxuICAgKiAgQ29uY2F0ZW5hdGVzIHRoZSBvYnNlcnZhYmxlIHNlcXVlbmNlcyBvYnRhaW5lZCBieSBydW5uaW5nIHRoZSBzcGVjaWZpZWQgcmVzdWx0IHNlbGVjdG9yIGZvciBlYWNoIGVsZW1lbnQgaW4gc291cmNlLlxuICAgKiBUaGVyZSBpcyBhbiBhbGlhcyBmb3IgdGhpcyBtZXRob2QgY2FsbGVkICdmb3JJbicgZm9yIGJyb3dzZXJzIDxJRTlcbiAgICogQHBhcmFtIHtBcnJheX0gc291cmNlcyBBbiBhcnJheSBvZiB2YWx1ZXMgdG8gdHVybiBpbnRvIGFuIG9ic2VydmFibGUgc2VxdWVuY2UuXG4gICAqIEBwYXJhbSB7RnVuY3Rpb259IHJlc3VsdFNlbGVjdG9yIEEgZnVuY3Rpb24gdG8gYXBwbHkgdG8gZWFjaCBpdGVtIGluIHRoZSBzb3VyY2VzIGFycmF5IHRvIHR1cm4gaXQgaW50byBhbiBvYnNlcnZhYmxlIHNlcXVlbmNlLlxuICAgKiBAcmV0dXJucyB7T2JzZXJ2YWJsZX0gQW4gb2JzZXJ2YWJsZSBzZXF1ZW5jZSBmcm9tIHRoZSBjb25jYXRlbmF0ZWQgb2JzZXJ2YWJsZSBzZXF1ZW5jZXMuXG4gICAqL1xuICBPYnNlcnZhYmxlWydmb3InXSA9IE9ic2VydmFibGUuZm9ySW4gPSBmdW5jdGlvbiAoc291cmNlcywgcmVzdWx0U2VsZWN0b3IsIHRoaXNBcmcpIHtcbiAgICByZXR1cm4gZW51bWVyYWJsZU9mKHNvdXJjZXMsIHJlc3VsdFNlbGVjdG9yLCB0aGlzQXJnKS5jb25jYXQoKTtcbiAgfTtcblxuICAgLyoqXG4gICAqICBSZXBlYXRzIHNvdXJjZSBhcyBsb25nIGFzIGNvbmRpdGlvbiBob2xkcyBlbXVsYXRpbmcgYSB3aGlsZSBsb29wLlxuICAgKiBUaGVyZSBpcyBhbiBhbGlhcyBmb3IgdGhpcyBtZXRob2QgY2FsbGVkICd3aGlsZURvJyBmb3IgYnJvd3NlcnMgPElFOVxuICAgKlxuICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBjb25kaXRpb24gVGhlIGNvbmRpdGlvbiB3aGljaCBkZXRlcm1pbmVzIGlmIHRoZSBzb3VyY2Ugd2lsbCBiZSByZXBlYXRlZC5cbiAgICogQHBhcmFtIHtPYnNlcnZhYmxlfSBzb3VyY2UgVGhlIG9ic2VydmFibGUgc2VxdWVuY2UgdGhhdCB3aWxsIGJlIHJ1biBpZiB0aGUgY29uZGl0aW9uIGZ1bmN0aW9uIHJldHVybnMgdHJ1ZS5cbiAgICogQHJldHVybnMge09ic2VydmFibGV9IEFuIG9ic2VydmFibGUgc2VxdWVuY2Ugd2hpY2ggaXMgcmVwZWF0ZWQgYXMgbG9uZyBhcyB0aGUgY29uZGl0aW9uIGhvbGRzLlxuICAgKi9cbiAgdmFyIG9ic2VydmFibGVXaGlsZURvID0gT2JzZXJ2YWJsZVsnd2hpbGUnXSA9IE9ic2VydmFibGUud2hpbGVEbyA9IGZ1bmN0aW9uIChjb25kaXRpb24sIHNvdXJjZSkge1xuICAgIGlzUHJvbWlzZShzb3VyY2UpICYmIChzb3VyY2UgPSBvYnNlcnZhYmxlRnJvbVByb21pc2Uoc291cmNlKSk7XG4gICAgcmV0dXJuIGVudW1lcmFibGVXaGlsZShjb25kaXRpb24sIHNvdXJjZSkuY29uY2F0KCk7XG4gIH07XG5cbiAgIC8qKlxuICAgKiAgUmVwZWF0cyBzb3VyY2UgYXMgbG9uZyBhcyBjb25kaXRpb24gaG9sZHMgZW11bGF0aW5nIGEgZG8gd2hpbGUgbG9vcC5cbiAgICpcbiAgICogQHBhcmFtIHtGdW5jdGlvbn0gY29uZGl0aW9uIFRoZSBjb25kaXRpb24gd2hpY2ggZGV0ZXJtaW5lcyBpZiB0aGUgc291cmNlIHdpbGwgYmUgcmVwZWF0ZWQuXG4gICAqIEBwYXJhbSB7T2JzZXJ2YWJsZX0gc291cmNlIFRoZSBvYnNlcnZhYmxlIHNlcXVlbmNlIHRoYXQgd2lsbCBiZSBydW4gaWYgdGhlIGNvbmRpdGlvbiBmdW5jdGlvbiByZXR1cm5zIHRydWUuXG4gICAqIEByZXR1cm5zIHtPYnNlcnZhYmxlfSBBbiBvYnNlcnZhYmxlIHNlcXVlbmNlIHdoaWNoIGlzIHJlcGVhdGVkIGFzIGxvbmcgYXMgdGhlIGNvbmRpdGlvbiBob2xkcy5cbiAgICovXG4gIG9ic2VydmFibGVQcm90by5kb1doaWxlID0gZnVuY3Rpb24gKGNvbmRpdGlvbikge1xuICAgIHJldHVybiBvYnNlcnZhYmxlQ29uY2F0KFt0aGlzLCBvYnNlcnZhYmxlV2hpbGVEbyhjb25kaXRpb24sIHRoaXMpXSk7XG4gIH07XG5cbiAgIC8qKlxuICAgKiAgVXNlcyBzZWxlY3RvciB0byBkZXRlcm1pbmUgd2hpY2ggc291cmNlIGluIHNvdXJjZXMgdG8gdXNlLlxuICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBzZWxlY3RvciBUaGUgZnVuY3Rpb24gd2hpY2ggZXh0cmFjdHMgdGhlIHZhbHVlIGZvciB0byB0ZXN0IGluIGEgY2FzZSBzdGF0ZW1lbnQuXG4gICAqIEBwYXJhbSB7QXJyYXl9IHNvdXJjZXMgQSBvYmplY3Qgd2hpY2ggaGFzIGtleXMgd2hpY2ggY29ycmVzcG9uZCB0byB0aGUgY2FzZSBzdGF0ZW1lbnQgbGFiZWxzLlxuICAgKiBAcGFyYW0ge09ic2VydmFibGV9IFtlbHNlU291cmNlXSBUaGUgb2JzZXJ2YWJsZSBzZXF1ZW5jZSBvciBQcm9taXNlIHRoYXQgd2lsbCBiZSBydW4gaWYgdGhlIHNvdXJjZXMgYXJlIG5vdCBtYXRjaGVkLiBJZiB0aGlzIGlzIG5vdCBwcm92aWRlZCwgaXQgZGVmYXVsdHMgdG8gUnguT2JzZXJ2YWJlLmVtcHR5IHdpdGggdGhlIHNwZWNpZmllZCBzY2hlZHVsZXIuXG4gICAqXG4gICAqIEByZXR1cm5zIHtPYnNlcnZhYmxlfSBBbiBvYnNlcnZhYmxlIHNlcXVlbmNlIHdoaWNoIGlzIGRldGVybWluZWQgYnkgYSBjYXNlIHN0YXRlbWVudC5cbiAgICovXG4gIE9ic2VydmFibGVbJ2Nhc2UnXSA9IGZ1bmN0aW9uIChzZWxlY3Rvciwgc291cmNlcywgZGVmYXVsdFNvdXJjZU9yU2NoZWR1bGVyKSB7XG4gICAgcmV0dXJuIG9ic2VydmFibGVEZWZlcihmdW5jdGlvbiAoKSB7XG4gICAgICBpc1Byb21pc2UoZGVmYXVsdFNvdXJjZU9yU2NoZWR1bGVyKSAmJiAoZGVmYXVsdFNvdXJjZU9yU2NoZWR1bGVyID0gb2JzZXJ2YWJsZUZyb21Qcm9taXNlKGRlZmF1bHRTb3VyY2VPclNjaGVkdWxlcikpO1xuICAgICAgZGVmYXVsdFNvdXJjZU9yU2NoZWR1bGVyIHx8IChkZWZhdWx0U291cmNlT3JTY2hlZHVsZXIgPSBvYnNlcnZhYmxlRW1wdHkoKSk7XG5cbiAgICAgIGlzU2NoZWR1bGVyKGRlZmF1bHRTb3VyY2VPclNjaGVkdWxlcikgJiYgKGRlZmF1bHRTb3VyY2VPclNjaGVkdWxlciA9IG9ic2VydmFibGVFbXB0eShkZWZhdWx0U291cmNlT3JTY2hlZHVsZXIpKTtcblxuICAgICAgdmFyIHJlc3VsdCA9IHNvdXJjZXNbc2VsZWN0b3IoKV07XG4gICAgICBpc1Byb21pc2UocmVzdWx0KSAmJiAocmVzdWx0ID0gb2JzZXJ2YWJsZUZyb21Qcm9taXNlKHJlc3VsdCkpO1xuXG4gICAgICByZXR1cm4gcmVzdWx0IHx8IGRlZmF1bHRTb3VyY2VPclNjaGVkdWxlcjtcbiAgICB9KTtcbiAgfTtcblxuICAgLyoqXG4gICAqICBFeHBhbmRzIGFuIG9ic2VydmFibGUgc2VxdWVuY2UgYnkgcmVjdXJzaXZlbHkgaW52b2tpbmcgc2VsZWN0b3IuXG4gICAqXG4gICAqIEBwYXJhbSB7RnVuY3Rpb259IHNlbGVjdG9yIFNlbGVjdG9yIGZ1bmN0aW9uIHRvIGludm9rZSBmb3IgZWFjaCBwcm9kdWNlZCBlbGVtZW50LCByZXN1bHRpbmcgaW4gYW5vdGhlciBzZXF1ZW5jZSB0byB3aGljaCB0aGUgc2VsZWN0b3Igd2lsbCBiZSBpbnZva2VkIHJlY3Vyc2l2ZWx5IGFnYWluLlxuICAgKiBAcGFyYW0ge1NjaGVkdWxlcn0gW3NjaGVkdWxlcl0gU2NoZWR1bGVyIG9uIHdoaWNoIHRvIHBlcmZvcm0gdGhlIGV4cGFuc2lvbi4gSWYgbm90IHByb3ZpZGVkLCB0aGlzIGRlZmF1bHRzIHRvIHRoZSBjdXJyZW50IHRocmVhZCBzY2hlZHVsZXIuXG4gICAqIEByZXR1cm5zIHtPYnNlcnZhYmxlfSBBbiBvYnNlcnZhYmxlIHNlcXVlbmNlIGNvbnRhaW5pbmcgYWxsIHRoZSBlbGVtZW50cyBwcm9kdWNlZCBieSB0aGUgcmVjdXJzaXZlIGV4cGFuc2lvbi5cbiAgICovXG4gIG9ic2VydmFibGVQcm90by5leHBhbmQgPSBmdW5jdGlvbiAoc2VsZWN0b3IsIHNjaGVkdWxlcikge1xuICAgIGlzU2NoZWR1bGVyKHNjaGVkdWxlcikgfHwgKHNjaGVkdWxlciA9IGltbWVkaWF0ZVNjaGVkdWxlcik7XG4gICAgdmFyIHNvdXJjZSA9IHRoaXM7XG4gICAgcmV0dXJuIG5ldyBBbm9ueW1vdXNPYnNlcnZhYmxlKGZ1bmN0aW9uIChvKSB7XG4gICAgICB2YXIgcSA9IFtdLFxuICAgICAgICBtID0gbmV3IFNlcmlhbERpc3Bvc2FibGUoKSxcbiAgICAgICAgZCA9IG5ldyBDb21wb3NpdGVEaXNwb3NhYmxlKG0pLFxuICAgICAgICBhY3RpdmVDb3VudCA9IDAsXG4gICAgICAgIGlzQWNxdWlyZWQgPSBmYWxzZTtcblxuICAgICAgdmFyIGVuc3VyZUFjdGl2ZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIGlzT3duZXIgPSBmYWxzZTtcbiAgICAgICAgaWYgKHEubGVuZ3RoID4gMCkge1xuICAgICAgICAgIGlzT3duZXIgPSAhaXNBY3F1aXJlZDtcbiAgICAgICAgICBpc0FjcXVpcmVkID0gdHJ1ZTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoaXNPd25lcikge1xuICAgICAgICAgIG0uc2V0RGlzcG9zYWJsZShzY2hlZHVsZXIuc2NoZWR1bGVSZWN1cnNpdmUobnVsbCwgZnVuY3Rpb24gKF8sIHNlbGYpIHtcbiAgICAgICAgICAgIHZhciB3b3JrO1xuICAgICAgICAgICAgaWYgKHEubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgICB3b3JrID0gcS5zaGlmdCgpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgaXNBY3F1aXJlZCA9IGZhbHNlO1xuICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB2YXIgbTEgPSBuZXcgU2luZ2xlQXNzaWdubWVudERpc3Bvc2FibGUoKTtcbiAgICAgICAgICAgIGQuYWRkKG0xKTtcbiAgICAgICAgICAgIG0xLnNldERpc3Bvc2FibGUod29yay5zdWJzY3JpYmUoZnVuY3Rpb24gKHgpIHtcbiAgICAgICAgICAgICAgby5vbk5leHQoeCk7XG4gICAgICAgICAgICAgIHZhciByZXN1bHQgPSBudWxsO1xuICAgICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgIHJlc3VsdCA9IHNlbGVjdG9yKHgpO1xuICAgICAgICAgICAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgICAgICAgICAgby5vbkVycm9yKGUpO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIHEucHVzaChyZXN1bHQpO1xuICAgICAgICAgICAgICBhY3RpdmVDb3VudCsrO1xuICAgICAgICAgICAgICBlbnN1cmVBY3RpdmUoKTtcbiAgICAgICAgICAgIH0sIGZ1bmN0aW9uIChlKSB7IG8ub25FcnJvcihlKTsgfSwgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICBkLnJlbW92ZShtMSk7XG4gICAgICAgICAgICAgIGFjdGl2ZUNvdW50LS07XG4gICAgICAgICAgICAgIGlmIChhY3RpdmVDb3VudCA9PT0gMCkge1xuICAgICAgICAgICAgICAgIG8ub25Db21wbGV0ZWQoKTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSkpO1xuICAgICAgICAgICAgc2VsZigpO1xuICAgICAgICAgIH0pKTtcbiAgICAgICAgfVxuICAgICAgfTtcblxuICAgICAgcS5wdXNoKHNvdXJjZSk7XG4gICAgICBhY3RpdmVDb3VudCsrO1xuICAgICAgZW5zdXJlQWN0aXZlKCk7XG4gICAgICByZXR1cm4gZDtcbiAgICB9LCB0aGlzKTtcbiAgfTtcblxuICAgLyoqXG4gICAqICBSdW5zIGFsbCBvYnNlcnZhYmxlIHNlcXVlbmNlcyBpbiBwYXJhbGxlbCBhbmQgY29sbGVjdCB0aGVpciBsYXN0IGVsZW1lbnRzLlxuICAgKlxuICAgKiBAZXhhbXBsZVxuICAgKiAgMSAtIHJlcyA9IFJ4Lk9ic2VydmFibGUuZm9ya0pvaW4oW29iczEsIG9iczJdKTtcbiAgICogIDEgLSByZXMgPSBSeC5PYnNlcnZhYmxlLmZvcmtKb2luKG9iczEsIG9iczIsIC4uLik7XG4gICAqIEByZXR1cm5zIHtPYnNlcnZhYmxlfSBBbiBvYnNlcnZhYmxlIHNlcXVlbmNlIHdpdGggYW4gYXJyYXkgY29sbGVjdGluZyB0aGUgbGFzdCBlbGVtZW50cyBvZiBhbGwgdGhlIGlucHV0IHNlcXVlbmNlcy5cbiAgICovXG4gIE9ic2VydmFibGUuZm9ya0pvaW4gPSBmdW5jdGlvbiAoKSB7XG4gICAgdmFyIGFsbFNvdXJjZXMgPSBbXTtcbiAgICBpZiAoQXJyYXkuaXNBcnJheShhcmd1bWVudHNbMF0pKSB7XG4gICAgICBhbGxTb3VyY2VzID0gYXJndW1lbnRzWzBdO1xuICAgIH0gZWxzZSB7XG4gICAgICBmb3IodmFyIGkgPSAwLCBsZW4gPSBhcmd1bWVudHMubGVuZ3RoOyBpIDwgbGVuOyBpKyspIHsgYWxsU291cmNlcy5wdXNoKGFyZ3VtZW50c1tpXSk7IH1cbiAgICB9XG4gICAgcmV0dXJuIG5ldyBBbm9ueW1vdXNPYnNlcnZhYmxlKGZ1bmN0aW9uIChzdWJzY3JpYmVyKSB7XG4gICAgICB2YXIgY291bnQgPSBhbGxTb3VyY2VzLmxlbmd0aDtcbiAgICAgIGlmIChjb3VudCA9PT0gMCkge1xuICAgICAgICBzdWJzY3JpYmVyLm9uQ29tcGxldGVkKCk7XG4gICAgICAgIHJldHVybiBkaXNwb3NhYmxlRW1wdHk7XG4gICAgICB9XG4gICAgICB2YXIgZ3JvdXAgPSBuZXcgQ29tcG9zaXRlRGlzcG9zYWJsZSgpLFxuICAgICAgICBmaW5pc2hlZCA9IGZhbHNlLFxuICAgICAgICBoYXNSZXN1bHRzID0gbmV3IEFycmF5KGNvdW50KSxcbiAgICAgICAgaGFzQ29tcGxldGVkID0gbmV3IEFycmF5KGNvdW50KSxcbiAgICAgICAgcmVzdWx0cyA9IG5ldyBBcnJheShjb3VudCk7XG5cbiAgICAgIGZvciAodmFyIGlkeCA9IDA7IGlkeCA8IGNvdW50OyBpZHgrKykge1xuICAgICAgICAoZnVuY3Rpb24gKGkpIHtcbiAgICAgICAgICB2YXIgc291cmNlID0gYWxsU291cmNlc1tpXTtcbiAgICAgICAgICBpc1Byb21pc2Uoc291cmNlKSAmJiAoc291cmNlID0gb2JzZXJ2YWJsZUZyb21Qcm9taXNlKHNvdXJjZSkpO1xuICAgICAgICAgIGdyb3VwLmFkZChcbiAgICAgICAgICAgIHNvdXJjZS5zdWJzY3JpYmUoXG4gICAgICAgICAgICAgIGZ1bmN0aW9uICh2YWx1ZSkge1xuICAgICAgICAgICAgICBpZiAoIWZpbmlzaGVkKSB7XG4gICAgICAgICAgICAgICAgaGFzUmVzdWx0c1tpXSA9IHRydWU7XG4gICAgICAgICAgICAgICAgcmVzdWx0c1tpXSA9IHZhbHVlO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgICAgICAgZmluaXNoZWQgPSB0cnVlO1xuICAgICAgICAgICAgICBzdWJzY3JpYmVyLm9uRXJyb3IoZSk7XG4gICAgICAgICAgICAgIGdyb3VwLmRpc3Bvc2UoKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgIGlmICghZmluaXNoZWQpIHtcbiAgICAgICAgICAgICAgICBpZiAoIWhhc1Jlc3VsdHNbaV0pIHtcbiAgICAgICAgICAgICAgICAgICAgc3Vic2NyaWJlci5vbkNvbXBsZXRlZCgpO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGhhc0NvbXBsZXRlZFtpXSA9IHRydWU7XG4gICAgICAgICAgICAgICAgZm9yICh2YXIgaXggPSAwOyBpeCA8IGNvdW50OyBpeCsrKSB7XG4gICAgICAgICAgICAgICAgICBpZiAoIWhhc0NvbXBsZXRlZFtpeF0pIHsgcmV0dXJuOyB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGZpbmlzaGVkID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICBzdWJzY3JpYmVyLm9uTmV4dChyZXN1bHRzKTtcbiAgICAgICAgICAgICAgICBzdWJzY3JpYmVyLm9uQ29tcGxldGVkKCk7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pKTtcbiAgICAgICAgfSkoaWR4KTtcbiAgICAgIH1cblxuICAgICAgcmV0dXJuIGdyb3VwO1xuICAgIH0pO1xuICB9O1xuXG4gICAvKipcbiAgICogIFJ1bnMgdHdvIG9ic2VydmFibGUgc2VxdWVuY2VzIGluIHBhcmFsbGVsIGFuZCBjb21iaW5lcyB0aGVpciBsYXN0IGVsZW1lbmV0cy5cbiAgICogQHBhcmFtIHtPYnNlcnZhYmxlfSBzZWNvbmQgU2Vjb25kIG9ic2VydmFibGUgc2VxdWVuY2UuXG4gICAqIEBwYXJhbSB7RnVuY3Rpb259IHJlc3VsdFNlbGVjdG9yIFJlc3VsdCBzZWxlY3RvciBmdW5jdGlvbiB0byBpbnZva2Ugd2l0aCB0aGUgbGFzdCBlbGVtZW50cyBvZiBib3RoIHNlcXVlbmNlcy5cbiAgICogQHJldHVybnMge09ic2VydmFibGV9IEFuIG9ic2VydmFibGUgc2VxdWVuY2Ugd2l0aCB0aGUgcmVzdWx0IG9mIGNhbGxpbmcgdGhlIHNlbGVjdG9yIGZ1bmN0aW9uIHdpdGggdGhlIGxhc3QgZWxlbWVudHMgb2YgYm90aCBpbnB1dCBzZXF1ZW5jZXMuXG4gICAqL1xuICBvYnNlcnZhYmxlUHJvdG8uZm9ya0pvaW4gPSBmdW5jdGlvbiAoc2Vjb25kLCByZXN1bHRTZWxlY3Rvcikge1xuICAgIHZhciBmaXJzdCA9IHRoaXM7XG4gICAgcmV0dXJuIG5ldyBBbm9ueW1vdXNPYnNlcnZhYmxlKGZ1bmN0aW9uIChvYnNlcnZlcikge1xuICAgICAgdmFyIGxlZnRTdG9wcGVkID0gZmFsc2UsIHJpZ2h0U3RvcHBlZCA9IGZhbHNlLFxuICAgICAgICBoYXNMZWZ0ID0gZmFsc2UsIGhhc1JpZ2h0ID0gZmFsc2UsXG4gICAgICAgIGxhc3RMZWZ0LCBsYXN0UmlnaHQsXG4gICAgICAgIGxlZnRTdWJzY3JpcHRpb24gPSBuZXcgU2luZ2xlQXNzaWdubWVudERpc3Bvc2FibGUoKSwgcmlnaHRTdWJzY3JpcHRpb24gPSBuZXcgU2luZ2xlQXNzaWdubWVudERpc3Bvc2FibGUoKTtcblxuICAgICAgaXNQcm9taXNlKHNlY29uZCkgJiYgKHNlY29uZCA9IG9ic2VydmFibGVGcm9tUHJvbWlzZShzZWNvbmQpKTtcblxuICAgICAgbGVmdFN1YnNjcmlwdGlvbi5zZXREaXNwb3NhYmxlKFxuICAgICAgICAgIGZpcnN0LnN1YnNjcmliZShmdW5jdGlvbiAobGVmdCkge1xuICAgICAgICAgICAgaGFzTGVmdCA9IHRydWU7XG4gICAgICAgICAgICBsYXN0TGVmdCA9IGxlZnQ7XG4gICAgICAgICAgfSwgZnVuY3Rpb24gKGVycikge1xuICAgICAgICAgICAgcmlnaHRTdWJzY3JpcHRpb24uZGlzcG9zZSgpO1xuICAgICAgICAgICAgb2JzZXJ2ZXIub25FcnJvcihlcnIpO1xuICAgICAgICAgIH0sIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIGxlZnRTdG9wcGVkID0gdHJ1ZTtcbiAgICAgICAgICAgIGlmIChyaWdodFN0b3BwZWQpIHtcbiAgICAgICAgICAgICAgaWYgKCFoYXNMZWZ0KSB7XG4gICAgICAgICAgICAgICAgICBvYnNlcnZlci5vbkNvbXBsZXRlZCgpO1xuICAgICAgICAgICAgICB9IGVsc2UgaWYgKCFoYXNSaWdodCkge1xuICAgICAgICAgICAgICAgICAgb2JzZXJ2ZXIub25Db21wbGV0ZWQoKTtcbiAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICB2YXIgcmVzdWx0ID0gdHJ5Q2F0Y2gocmVzdWx0U2VsZWN0b3IpKGxhc3RMZWZ0LCBsYXN0UmlnaHQpO1xuICAgICAgICAgICAgICAgIGlmIChyZXN1bHQgPT09IGVycm9yT2JqKSB7IHJldHVybiBvYnNlcnZlci5vbkVycm9yKGUpOyB9XG4gICAgICAgICAgICAgICAgb2JzZXJ2ZXIub25OZXh0KHJlc3VsdCk7XG4gICAgICAgICAgICAgICAgb2JzZXJ2ZXIub25Db21wbGV0ZWQoKTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgIH0pXG4gICAgICApO1xuXG4gICAgICByaWdodFN1YnNjcmlwdGlvbi5zZXREaXNwb3NhYmxlKFxuICAgICAgICBzZWNvbmQuc3Vic2NyaWJlKGZ1bmN0aW9uIChyaWdodCkge1xuICAgICAgICAgIGhhc1JpZ2h0ID0gdHJ1ZTtcbiAgICAgICAgICBsYXN0UmlnaHQgPSByaWdodDtcbiAgICAgICAgfSwgZnVuY3Rpb24gKGVycikge1xuICAgICAgICAgIGxlZnRTdWJzY3JpcHRpb24uZGlzcG9zZSgpO1xuICAgICAgICAgIG9ic2VydmVyLm9uRXJyb3IoZXJyKTtcbiAgICAgICAgfSwgZnVuY3Rpb24gKCkge1xuICAgICAgICAgIHJpZ2h0U3RvcHBlZCA9IHRydWU7XG4gICAgICAgICAgaWYgKGxlZnRTdG9wcGVkKSB7XG4gICAgICAgICAgICBpZiAoIWhhc0xlZnQpIHtcbiAgICAgICAgICAgICAgb2JzZXJ2ZXIub25Db21wbGV0ZWQoKTtcbiAgICAgICAgICAgIH0gZWxzZSBpZiAoIWhhc1JpZ2h0KSB7XG4gICAgICAgICAgICAgIG9ic2VydmVyLm9uQ29tcGxldGVkKCk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICB2YXIgcmVzdWx0ID0gdHJ5Q2F0Y2gocmVzdWx0U2VsZWN0b3IpKGxhc3RMZWZ0LCBsYXN0UmlnaHQpO1xuICAgICAgICAgICAgICBpZiAocmVzdWx0ID09PSBlcnJvck9iaikgeyByZXR1cm4gb2JzZXJ2ZXIub25FcnJvcihyZXN1bHQuZSk7IH1cbiAgICAgICAgICAgICAgb2JzZXJ2ZXIub25OZXh0KHJlc3VsdCk7XG4gICAgICAgICAgICAgIG9ic2VydmVyLm9uQ29tcGxldGVkKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICB9KVxuICAgICAgKTtcblxuICAgICAgcmV0dXJuIG5ldyBCaW5hcnlEaXNwb3NhYmxlKGxlZnRTdWJzY3JpcHRpb24sIHJpZ2h0U3Vic2NyaXB0aW9uKTtcbiAgICB9LCBmaXJzdCk7XG4gIH07XG5cbiAgLyoqXG4gICAqIENvbW9uYWRpYyBiaW5kIG9wZXJhdG9yLlxuICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBzZWxlY3RvciBBIHRyYW5zZm9ybSBmdW5jdGlvbiB0byBhcHBseSB0byBlYWNoIGVsZW1lbnQuXG4gICAqIEBwYXJhbSB7T2JqZWN0fSBzY2hlZHVsZXIgU2NoZWR1bGVyIHVzZWQgdG8gZXhlY3V0ZSB0aGUgb3BlcmF0aW9uLiBJZiBub3Qgc3BlY2lmaWVkLCBkZWZhdWx0cyB0byB0aGUgSW1tZWRpYXRlU2NoZWR1bGVyLlxuICAgKiBAcmV0dXJucyB7T2JzZXJ2YWJsZX0gQW4gb2JzZXJ2YWJsZSBzZXF1ZW5jZSB3aGljaCByZXN1bHRzIGZyb20gdGhlIGNvbW9uYWRpYyBiaW5kIG9wZXJhdGlvbi5cbiAgICovXG4gIG9ic2VydmFibGVQcm90by5tYW55U2VsZWN0ID0gb2JzZXJ2YWJsZVByb3RvLmV4dGVuZCA9IGZ1bmN0aW9uIChzZWxlY3Rvciwgc2NoZWR1bGVyKSB7XG4gICAgaXNTY2hlZHVsZXIoc2NoZWR1bGVyKSB8fCAoc2NoZWR1bGVyID0gaW1tZWRpYXRlU2NoZWR1bGVyKTtcbiAgICB2YXIgc291cmNlID0gdGhpcztcbiAgICByZXR1cm4gb2JzZXJ2YWJsZURlZmVyKGZ1bmN0aW9uICgpIHtcbiAgICAgIHZhciBjaGFpbjtcblxuICAgICAgcmV0dXJuIHNvdXJjZVxuICAgICAgICAubWFwKGZ1bmN0aW9uICh4KSB7XG4gICAgICAgICAgdmFyIGN1cnIgPSBuZXcgQ2hhaW5PYnNlcnZhYmxlKHgpO1xuXG4gICAgICAgICAgY2hhaW4gJiYgY2hhaW4ub25OZXh0KHgpO1xuICAgICAgICAgIGNoYWluID0gY3VycjtcblxuICAgICAgICAgIHJldHVybiBjdXJyO1xuICAgICAgICB9KVxuICAgICAgICAudGFwKFxuICAgICAgICAgIG5vb3AsXG4gICAgICAgICAgZnVuY3Rpb24gKGUpIHsgY2hhaW4gJiYgY2hhaW4ub25FcnJvcihlKTsgfSxcbiAgICAgICAgICBmdW5jdGlvbiAoKSB7IGNoYWluICYmIGNoYWluLm9uQ29tcGxldGVkKCk7IH1cbiAgICAgICAgKVxuICAgICAgICAub2JzZXJ2ZU9uKHNjaGVkdWxlcilcbiAgICAgICAgLm1hcChzZWxlY3Rvcik7XG4gICAgfSwgc291cmNlKTtcbiAgfTtcblxuICB2YXIgQ2hhaW5PYnNlcnZhYmxlID0gKGZ1bmN0aW9uIChfX3N1cGVyX18pIHtcbiAgICBpbmhlcml0cyhDaGFpbk9ic2VydmFibGUsIF9fc3VwZXJfXyk7XG4gICAgZnVuY3Rpb24gQ2hhaW5PYnNlcnZhYmxlKGhlYWQpIHtcbiAgICAgIF9fc3VwZXJfXy5jYWxsKHRoaXMpO1xuICAgICAgdGhpcy5oZWFkID0gaGVhZDtcbiAgICAgIHRoaXMudGFpbCA9IG5ldyBBc3luY1N1YmplY3QoKTtcbiAgICB9XG5cbiAgICBhZGRQcm9wZXJ0aWVzKENoYWluT2JzZXJ2YWJsZS5wcm90b3R5cGUsIE9ic2VydmVyLCB7XG4gICAgICBfc3Vic2NyaWJlOiBmdW5jdGlvbiAobykge1xuICAgICAgICB2YXIgZyA9IG5ldyBDb21wb3NpdGVEaXNwb3NhYmxlKCk7XG4gICAgICAgIGcuYWRkKGN1cnJlbnRUaHJlYWRTY2hlZHVsZXIuc2NoZWR1bGUodGhpcywgZnVuY3Rpb24gKF8sIHNlbGYpIHtcbiAgICAgICAgICBvLm9uTmV4dChzZWxmLmhlYWQpO1xuICAgICAgICAgIGcuYWRkKHNlbGYudGFpbC5tZXJnZUFsbCgpLnN1YnNjcmliZShvKSk7XG4gICAgICAgIH0pKTtcblxuICAgICAgICByZXR1cm4gZztcbiAgICAgIH0sXG4gICAgICBvbkNvbXBsZXRlZDogZnVuY3Rpb24gKCkge1xuICAgICAgICB0aGlzLm9uTmV4dChPYnNlcnZhYmxlLmVtcHR5KCkpO1xuICAgICAgfSxcbiAgICAgIG9uRXJyb3I6IGZ1bmN0aW9uIChlKSB7XG4gICAgICAgIHRoaXMub25OZXh0KE9ic2VydmFibGVbJ3Rocm93J10oZSkpO1xuICAgICAgfSxcbiAgICAgIG9uTmV4dDogZnVuY3Rpb24gKHYpIHtcbiAgICAgICAgdGhpcy50YWlsLm9uTmV4dCh2KTtcbiAgICAgICAgdGhpcy50YWlsLm9uQ29tcGxldGVkKCk7XG4gICAgICB9XG4gICAgfSk7XG5cbiAgICByZXR1cm4gQ2hhaW5PYnNlcnZhYmxlO1xuXG4gIH0oT2JzZXJ2YWJsZSkpO1xuXG4gIHZhciBNYXAgPSByb290Lk1hcCB8fCAoZnVuY3Rpb24gKCkge1xuICAgIGZ1bmN0aW9uIE1hcCgpIHtcbiAgICAgIHRoaXMuc2l6ZSA9IDA7XG4gICAgICB0aGlzLl92YWx1ZXMgPSBbXTtcbiAgICAgIHRoaXMuX2tleXMgPSBbXTtcbiAgICB9XG5cbiAgICBNYXAucHJvdG90eXBlWydkZWxldGUnXSA9IGZ1bmN0aW9uIChrZXkpIHtcbiAgICAgIHZhciBpID0gdGhpcy5fa2V5cy5pbmRleE9mKGtleSk7XG4gICAgICBpZiAoaSA9PT0gLTEpIHsgcmV0dXJuIGZhbHNlOyB9XG4gICAgICB0aGlzLl92YWx1ZXMuc3BsaWNlKGksIDEpO1xuICAgICAgdGhpcy5fa2V5cy5zcGxpY2UoaSwgMSk7XG4gICAgICB0aGlzLnNpemUtLTtcbiAgICAgIHJldHVybiB0cnVlO1xuICAgIH07XG5cbiAgICBNYXAucHJvdG90eXBlLmdldCA9IGZ1bmN0aW9uIChrZXkpIHtcbiAgICAgIHZhciBpID0gdGhpcy5fa2V5cy5pbmRleE9mKGtleSk7XG4gICAgICByZXR1cm4gaSA9PT0gLTEgPyB1bmRlZmluZWQgOiB0aGlzLl92YWx1ZXNbaV07XG4gICAgfTtcblxuICAgIE1hcC5wcm90b3R5cGUuc2V0ID0gZnVuY3Rpb24gKGtleSwgdmFsdWUpIHtcbiAgICAgIHZhciBpID0gdGhpcy5fa2V5cy5pbmRleE9mKGtleSk7XG4gICAgICBpZiAoaSA9PT0gLTEpIHtcbiAgICAgICAgdGhpcy5fa2V5cy5wdXNoKGtleSk7XG4gICAgICAgIHRoaXMuX3ZhbHVlcy5wdXNoKHZhbHVlKTtcbiAgICAgICAgdGhpcy5zaXplKys7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICB0aGlzLl92YWx1ZXNbaV0gPSB2YWx1ZTtcbiAgICAgIH1cbiAgICAgIHJldHVybiB0aGlzO1xuICAgIH07XG5cbiAgICBNYXAucHJvdG90eXBlLmZvckVhY2ggPSBmdW5jdGlvbiAoY2IsIHRoaXNBcmcpIHtcbiAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgdGhpcy5zaXplOyBpKyspIHtcbiAgICAgICAgY2IuY2FsbCh0aGlzQXJnLCB0aGlzLl92YWx1ZXNbaV0sIHRoaXMuX2tleXNbaV0pO1xuICAgICAgfVxuICAgIH07XG5cbiAgICByZXR1cm4gTWFwO1xuICB9KCkpO1xuXG4gIC8qKlxuICAgKiBAY29uc3RydWN0b3JcbiAgICogUmVwcmVzZW50cyBhIGpvaW4gcGF0dGVybiBvdmVyIG9ic2VydmFibGUgc2VxdWVuY2VzLlxuICAgKi9cbiAgZnVuY3Rpb24gUGF0dGVybihwYXR0ZXJucykge1xuICAgIHRoaXMucGF0dGVybnMgPSBwYXR0ZXJucztcbiAgfVxuXG4gIC8qKlxuICAgKiAgQ3JlYXRlcyBhIHBhdHRlcm4gdGhhdCBtYXRjaGVzIHRoZSBjdXJyZW50IHBsYW4gbWF0Y2hlcyBhbmQgd2hlbiB0aGUgc3BlY2lmaWVkIG9ic2VydmFibGUgc2VxdWVuY2VzIGhhcyBhbiBhdmFpbGFibGUgdmFsdWUuXG4gICAqICBAcGFyYW0gb3RoZXIgT2JzZXJ2YWJsZSBzZXF1ZW5jZSB0byBtYXRjaCBpbiBhZGRpdGlvbiB0byB0aGUgY3VycmVudCBwYXR0ZXJuLlxuICAgKiAgQHJldHVybiB7UGF0dGVybn0gUGF0dGVybiBvYmplY3QgdGhhdCBtYXRjaGVzIHdoZW4gYWxsIG9ic2VydmFibGUgc2VxdWVuY2VzIGluIHRoZSBwYXR0ZXJuIGhhdmUgYW4gYXZhaWxhYmxlIHZhbHVlLlxuICAgKi9cbiAgUGF0dGVybi5wcm90b3R5cGUuYW5kID0gZnVuY3Rpb24gKG90aGVyKSB7XG4gICAgcmV0dXJuIG5ldyBQYXR0ZXJuKHRoaXMucGF0dGVybnMuY29uY2F0KG90aGVyKSk7XG4gIH07XG5cbiAgLyoqXG4gICAqICBNYXRjaGVzIHdoZW4gYWxsIG9ic2VydmFibGUgc2VxdWVuY2VzIGluIHRoZSBwYXR0ZXJuIChzcGVjaWZpZWQgdXNpbmcgYSBjaGFpbiBvZiBhbmQgb3BlcmF0b3JzKSBoYXZlIGFuIGF2YWlsYWJsZSB2YWx1ZSBhbmQgcHJvamVjdHMgdGhlIHZhbHVlcy5cbiAgICogIEBwYXJhbSB7RnVuY3Rpb259IHNlbGVjdG9yIFNlbGVjdG9yIHRoYXQgd2lsbCBiZSBpbnZva2VkIHdpdGggYXZhaWxhYmxlIHZhbHVlcyBmcm9tIHRoZSBzb3VyY2Ugc2VxdWVuY2VzLCBpbiB0aGUgc2FtZSBvcmRlciBvZiB0aGUgc2VxdWVuY2VzIGluIHRoZSBwYXR0ZXJuLlxuICAgKiAgQHJldHVybiB7UGxhbn0gUGxhbiB0aGF0IHByb2R1Y2VzIHRoZSBwcm9qZWN0ZWQgdmFsdWVzLCB0byBiZSBmZWQgKHdpdGggb3RoZXIgcGxhbnMpIHRvIHRoZSB3aGVuIG9wZXJhdG9yLlxuICAgKi9cbiAgUGF0dGVybi5wcm90b3R5cGUudGhlbkRvID0gZnVuY3Rpb24gKHNlbGVjdG9yKSB7XG4gICAgcmV0dXJuIG5ldyBQbGFuKHRoaXMsIHNlbGVjdG9yKTtcbiAgfTtcblxuICBmdW5jdGlvbiBQbGFuKGV4cHJlc3Npb24sIHNlbGVjdG9yKSB7XG4gICAgICB0aGlzLmV4cHJlc3Npb24gPSBleHByZXNzaW9uO1xuICAgICAgdGhpcy5zZWxlY3RvciA9IHNlbGVjdG9yO1xuICB9XG5cbiAgUGxhbi5wcm90b3R5cGUuYWN0aXZhdGUgPSBmdW5jdGlvbiAoZXh0ZXJuYWxTdWJzY3JpcHRpb25zLCBvYnNlcnZlciwgZGVhY3RpdmF0ZSkge1xuICAgIHZhciBzZWxmID0gdGhpcztcbiAgICB2YXIgam9pbk9ic2VydmVycyA9IFtdO1xuICAgIGZvciAodmFyIGkgPSAwLCBsZW4gPSB0aGlzLmV4cHJlc3Npb24ucGF0dGVybnMubGVuZ3RoOyBpIDwgbGVuOyBpKyspIHtcbiAgICAgIGpvaW5PYnNlcnZlcnMucHVzaChwbGFuQ3JlYXRlT2JzZXJ2ZXIoZXh0ZXJuYWxTdWJzY3JpcHRpb25zLCB0aGlzLmV4cHJlc3Npb24ucGF0dGVybnNbaV0sIG9ic2VydmVyLm9uRXJyb3IuYmluZChvYnNlcnZlcikpKTtcbiAgICB9XG4gICAgdmFyIGFjdGl2ZVBsYW4gPSBuZXcgQWN0aXZlUGxhbihqb2luT2JzZXJ2ZXJzLCBmdW5jdGlvbiAoKSB7XG4gICAgICB2YXIgcmVzdWx0O1xuICAgICAgdHJ5IHtcbiAgICAgICAgcmVzdWx0ID0gc2VsZi5zZWxlY3Rvci5hcHBseShzZWxmLCBhcmd1bWVudHMpO1xuICAgICAgfSBjYXRjaCAoZSkge1xuICAgICAgICBvYnNlcnZlci5vbkVycm9yKGUpO1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG4gICAgICBvYnNlcnZlci5vbk5leHQocmVzdWx0KTtcbiAgICB9LCBmdW5jdGlvbiAoKSB7XG4gICAgICBmb3IgKHZhciBqID0gMCwgamxlbiA9IGpvaW5PYnNlcnZlcnMubGVuZ3RoOyBqIDwgamxlbjsgaisrKSB7XG4gICAgICAgIGpvaW5PYnNlcnZlcnNbal0ucmVtb3ZlQWN0aXZlUGxhbihhY3RpdmVQbGFuKTtcbiAgICAgIH1cbiAgICAgIGRlYWN0aXZhdGUoYWN0aXZlUGxhbik7XG4gICAgfSk7XG4gICAgZm9yIChpID0gMCwgbGVuID0gam9pbk9ic2VydmVycy5sZW5ndGg7IGkgPCBsZW47IGkrKykge1xuICAgICAgam9pbk9ic2VydmVyc1tpXS5hZGRBY3RpdmVQbGFuKGFjdGl2ZVBsYW4pO1xuICAgIH1cbiAgICByZXR1cm4gYWN0aXZlUGxhbjtcbiAgfTtcblxuICBmdW5jdGlvbiBwbGFuQ3JlYXRlT2JzZXJ2ZXIoZXh0ZXJuYWxTdWJzY3JpcHRpb25zLCBvYnNlcnZhYmxlLCBvbkVycm9yKSB7XG4gICAgdmFyIGVudHJ5ID0gZXh0ZXJuYWxTdWJzY3JpcHRpb25zLmdldChvYnNlcnZhYmxlKTtcbiAgICBpZiAoIWVudHJ5KSB7XG4gICAgICB2YXIgb2JzZXJ2ZXIgPSBuZXcgSm9pbk9ic2VydmVyKG9ic2VydmFibGUsIG9uRXJyb3IpO1xuICAgICAgZXh0ZXJuYWxTdWJzY3JpcHRpb25zLnNldChvYnNlcnZhYmxlLCBvYnNlcnZlcik7XG4gICAgICByZXR1cm4gb2JzZXJ2ZXI7XG4gICAgfVxuICAgIHJldHVybiBlbnRyeTtcbiAgfVxuXG4gIGZ1bmN0aW9uIEFjdGl2ZVBsYW4oam9pbk9ic2VydmVyQXJyYXksIG9uTmV4dCwgb25Db21wbGV0ZWQpIHtcbiAgICB0aGlzLmpvaW5PYnNlcnZlckFycmF5ID0gam9pbk9ic2VydmVyQXJyYXk7XG4gICAgdGhpcy5vbk5leHQgPSBvbk5leHQ7XG4gICAgdGhpcy5vbkNvbXBsZXRlZCA9IG9uQ29tcGxldGVkO1xuICAgIHRoaXMuam9pbk9ic2VydmVycyA9IG5ldyBNYXAoKTtcbiAgICBmb3IgKHZhciBpID0gMCwgbGVuID0gdGhpcy5qb2luT2JzZXJ2ZXJBcnJheS5sZW5ndGg7IGkgPCBsZW47IGkrKykge1xuICAgICAgdmFyIGpvaW5PYnNlcnZlciA9IHRoaXMuam9pbk9ic2VydmVyQXJyYXlbaV07XG4gICAgICB0aGlzLmpvaW5PYnNlcnZlcnMuc2V0KGpvaW5PYnNlcnZlciwgam9pbk9ic2VydmVyKTtcbiAgICB9XG4gIH1cblxuICBBY3RpdmVQbGFuLnByb3RvdHlwZS5kZXF1ZXVlID0gZnVuY3Rpb24gKCkge1xuICAgIHRoaXMuam9pbk9ic2VydmVycy5mb3JFYWNoKGZ1bmN0aW9uICh2KSB7IHYucXVldWUuc2hpZnQoKTsgfSk7XG4gIH07XG5cbiAgQWN0aXZlUGxhbi5wcm90b3R5cGUubWF0Y2ggPSBmdW5jdGlvbiAoKSB7XG4gICAgdmFyIGksIGxlbiwgaGFzVmFsdWVzID0gdHJ1ZTtcbiAgICBmb3IgKGkgPSAwLCBsZW4gPSB0aGlzLmpvaW5PYnNlcnZlckFycmF5Lmxlbmd0aDsgaSA8IGxlbjsgaSsrKSB7XG4gICAgICBpZiAodGhpcy5qb2luT2JzZXJ2ZXJBcnJheVtpXS5xdWV1ZS5sZW5ndGggPT09IDApIHtcbiAgICAgICAgaGFzVmFsdWVzID0gZmFsc2U7XG4gICAgICAgIGJyZWFrO1xuICAgICAgfVxuICAgIH1cbiAgICBpZiAoaGFzVmFsdWVzKSB7XG4gICAgICB2YXIgZmlyc3RWYWx1ZXMgPSBbXSxcbiAgICAgICAgICBpc0NvbXBsZXRlZCA9IGZhbHNlO1xuICAgICAgZm9yIChpID0gMCwgbGVuID0gdGhpcy5qb2luT2JzZXJ2ZXJBcnJheS5sZW5ndGg7IGkgPCBsZW47IGkrKykge1xuICAgICAgICBmaXJzdFZhbHVlcy5wdXNoKHRoaXMuam9pbk9ic2VydmVyQXJyYXlbaV0ucXVldWVbMF0pO1xuICAgICAgICB0aGlzLmpvaW5PYnNlcnZlckFycmF5W2ldLnF1ZXVlWzBdLmtpbmQgPT09ICdDJyAmJiAoaXNDb21wbGV0ZWQgPSB0cnVlKTtcbiAgICAgIH1cbiAgICAgIGlmIChpc0NvbXBsZXRlZCkge1xuICAgICAgICB0aGlzLm9uQ29tcGxldGVkKCk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICB0aGlzLmRlcXVldWUoKTtcbiAgICAgICAgdmFyIHZhbHVlcyA9IFtdO1xuICAgICAgICBmb3IgKGkgPSAwLCBsZW4gPSBmaXJzdFZhbHVlcy5sZW5ndGg7IGkgPCBmaXJzdFZhbHVlcy5sZW5ndGg7IGkrKykge1xuICAgICAgICAgIHZhbHVlcy5wdXNoKGZpcnN0VmFsdWVzW2ldLnZhbHVlKTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLm9uTmV4dC5hcHBseSh0aGlzLCB2YWx1ZXMpO1xuICAgICAgfVxuICAgIH1cbiAgfTtcblxuICB2YXIgSm9pbk9ic2VydmVyID0gKGZ1bmN0aW9uIChfX3N1cGVyX18pIHtcbiAgICBpbmhlcml0cyhKb2luT2JzZXJ2ZXIsIF9fc3VwZXJfXyk7XG5cbiAgICBmdW5jdGlvbiBKb2luT2JzZXJ2ZXIoc291cmNlLCBvbkVycm9yKSB7XG4gICAgICBfX3N1cGVyX18uY2FsbCh0aGlzKTtcbiAgICAgIHRoaXMuc291cmNlID0gc291cmNlO1xuICAgICAgdGhpcy5vbkVycm9yID0gb25FcnJvcjtcbiAgICAgIHRoaXMucXVldWUgPSBbXTtcbiAgICAgIHRoaXMuYWN0aXZlUGxhbnMgPSBbXTtcbiAgICAgIHRoaXMuc3Vic2NyaXB0aW9uID0gbmV3IFNpbmdsZUFzc2lnbm1lbnREaXNwb3NhYmxlKCk7XG4gICAgICB0aGlzLmlzRGlzcG9zZWQgPSBmYWxzZTtcbiAgICB9XG5cbiAgICB2YXIgSm9pbk9ic2VydmVyUHJvdG90eXBlID0gSm9pbk9ic2VydmVyLnByb3RvdHlwZTtcblxuICAgIEpvaW5PYnNlcnZlclByb3RvdHlwZS5uZXh0ID0gZnVuY3Rpb24gKG5vdGlmaWNhdGlvbikge1xuICAgICAgaWYgKCF0aGlzLmlzRGlzcG9zZWQpIHtcbiAgICAgICAgaWYgKG5vdGlmaWNhdGlvbi5raW5kID09PSAnRScpIHtcbiAgICAgICAgICByZXR1cm4gdGhpcy5vbkVycm9yKG5vdGlmaWNhdGlvbi5lcnJvcik7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5xdWV1ZS5wdXNoKG5vdGlmaWNhdGlvbik7XG4gICAgICAgIHZhciBhY3RpdmVQbGFucyA9IHRoaXMuYWN0aXZlUGxhbnMuc2xpY2UoMCk7XG4gICAgICAgIGZvciAodmFyIGkgPSAwLCBsZW4gPSBhY3RpdmVQbGFucy5sZW5ndGg7IGkgPCBsZW47IGkrKykge1xuICAgICAgICAgIGFjdGl2ZVBsYW5zW2ldLm1hdGNoKCk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9O1xuXG4gICAgSm9pbk9ic2VydmVyUHJvdG90eXBlLmVycm9yID0gbm9vcDtcbiAgICBKb2luT2JzZXJ2ZXJQcm90b3R5cGUuY29tcGxldGVkID0gbm9vcDtcblxuICAgIEpvaW5PYnNlcnZlclByb3RvdHlwZS5hZGRBY3RpdmVQbGFuID0gZnVuY3Rpb24gKGFjdGl2ZVBsYW4pIHtcbiAgICAgIHRoaXMuYWN0aXZlUGxhbnMucHVzaChhY3RpdmVQbGFuKTtcbiAgICB9O1xuXG4gICAgSm9pbk9ic2VydmVyUHJvdG90eXBlLnN1YnNjcmliZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgIHRoaXMuc3Vic2NyaXB0aW9uLnNldERpc3Bvc2FibGUodGhpcy5zb3VyY2UubWF0ZXJpYWxpemUoKS5zdWJzY3JpYmUodGhpcykpO1xuICAgIH07XG5cbiAgICBKb2luT2JzZXJ2ZXJQcm90b3R5cGUucmVtb3ZlQWN0aXZlUGxhbiA9IGZ1bmN0aW9uIChhY3RpdmVQbGFuKSB7XG4gICAgICB0aGlzLmFjdGl2ZVBsYW5zLnNwbGljZSh0aGlzLmFjdGl2ZVBsYW5zLmluZGV4T2YoYWN0aXZlUGxhbiksIDEpO1xuICAgICAgdGhpcy5hY3RpdmVQbGFucy5sZW5ndGggPT09IDAgJiYgdGhpcy5kaXNwb3NlKCk7XG4gICAgfTtcblxuICAgIEpvaW5PYnNlcnZlclByb3RvdHlwZS5kaXNwb3NlID0gZnVuY3Rpb24gKCkge1xuICAgICAgX19zdXBlcl9fLnByb3RvdHlwZS5kaXNwb3NlLmNhbGwodGhpcyk7XG4gICAgICBpZiAoIXRoaXMuaXNEaXNwb3NlZCkge1xuICAgICAgICB0aGlzLmlzRGlzcG9zZWQgPSB0cnVlO1xuICAgICAgICB0aGlzLnN1YnNjcmlwdGlvbi5kaXNwb3NlKCk7XG4gICAgICB9XG4gICAgfTtcblxuICAgIHJldHVybiBKb2luT2JzZXJ2ZXI7XG4gIH0gKEFic3RyYWN0T2JzZXJ2ZXIpKTtcblxuICAvKipcbiAgICogIENyZWF0ZXMgYSBwYXR0ZXJuIHRoYXQgbWF0Y2hlcyB3aGVuIGJvdGggb2JzZXJ2YWJsZSBzZXF1ZW5jZXMgaGF2ZSBhbiBhdmFpbGFibGUgdmFsdWUuXG4gICAqXG4gICAqICBAcGFyYW0gcmlnaHQgT2JzZXJ2YWJsZSBzZXF1ZW5jZSB0byBtYXRjaCB3aXRoIHRoZSBjdXJyZW50IHNlcXVlbmNlLlxuICAgKiAgQHJldHVybiB7UGF0dGVybn0gUGF0dGVybiBvYmplY3QgdGhhdCBtYXRjaGVzIHdoZW4gYm90aCBvYnNlcnZhYmxlIHNlcXVlbmNlcyBoYXZlIGFuIGF2YWlsYWJsZSB2YWx1ZS5cbiAgICovXG4gIG9ic2VydmFibGVQcm90by5hbmQgPSBmdW5jdGlvbiAocmlnaHQpIHtcbiAgICByZXR1cm4gbmV3IFBhdHRlcm4oW3RoaXMsIHJpZ2h0XSk7XG4gIH07XG5cbiAgLyoqXG4gICAqICBNYXRjaGVzIHdoZW4gdGhlIG9ic2VydmFibGUgc2VxdWVuY2UgaGFzIGFuIGF2YWlsYWJsZSB2YWx1ZSBhbmQgcHJvamVjdHMgdGhlIHZhbHVlLlxuICAgKlxuICAgKiAgQHBhcmFtIHtGdW5jdGlvbn0gc2VsZWN0b3IgU2VsZWN0b3IgdGhhdCB3aWxsIGJlIGludm9rZWQgZm9yIHZhbHVlcyBpbiB0aGUgc291cmNlIHNlcXVlbmNlLlxuICAgKiAgQHJldHVybnMge1BsYW59IFBsYW4gdGhhdCBwcm9kdWNlcyB0aGUgcHJvamVjdGVkIHZhbHVlcywgdG8gYmUgZmVkICh3aXRoIG90aGVyIHBsYW5zKSB0byB0aGUgd2hlbiBvcGVyYXRvci5cbiAgICovXG4gIG9ic2VydmFibGVQcm90by50aGVuRG8gPSBmdW5jdGlvbiAoc2VsZWN0b3IpIHtcbiAgICByZXR1cm4gbmV3IFBhdHRlcm4oW3RoaXNdKS50aGVuRG8oc2VsZWN0b3IpO1xuICB9O1xuXG4gIC8qKlxuICAgKiAgSm9pbnMgdG9nZXRoZXIgdGhlIHJlc3VsdHMgZnJvbSBzZXZlcmFsIHBhdHRlcm5zLlxuICAgKlxuICAgKiAgQHBhcmFtIHBsYW5zIEEgc2VyaWVzIG9mIHBsYW5zIChzcGVjaWZpZWQgYXMgYW4gQXJyYXkgb2YgYXMgYSBzZXJpZXMgb2YgYXJndW1lbnRzKSBjcmVhdGVkIGJ5IHVzZSBvZiB0aGUgVGhlbiBvcGVyYXRvciBvbiBwYXR0ZXJucy5cbiAgICogIEByZXR1cm5zIHtPYnNlcnZhYmxlfSBPYnNlcnZhYmxlIHNlcXVlbmNlIHdpdGggdGhlIHJlc3VsdHMgZm9ybSBtYXRjaGluZyBzZXZlcmFsIHBhdHRlcm5zLlxuICAgKi9cbiAgT2JzZXJ2YWJsZS53aGVuID0gZnVuY3Rpb24gKCkge1xuICAgIHZhciBsZW4gPSBhcmd1bWVudHMubGVuZ3RoLCBwbGFucztcbiAgICBpZiAoQXJyYXkuaXNBcnJheShhcmd1bWVudHNbMF0pKSB7XG4gICAgICBwbGFucyA9IGFyZ3VtZW50c1swXTtcbiAgICB9IGVsc2Uge1xuICAgICAgcGxhbnMgPSBuZXcgQXJyYXkobGVuKTtcbiAgICAgIGZvcih2YXIgaSA9IDA7IGkgPCBsZW47IGkrKykgeyBwbGFuc1tpXSA9IGFyZ3VtZW50c1tpXTsgfVxuICAgIH1cbiAgICByZXR1cm4gbmV3IEFub255bW91c09ic2VydmFibGUoZnVuY3Rpb24gKG8pIHtcbiAgICAgIHZhciBhY3RpdmVQbGFucyA9IFtdLFxuICAgICAgICAgIGV4dGVybmFsU3Vic2NyaXB0aW9ucyA9IG5ldyBNYXAoKTtcbiAgICAgIHZhciBvdXRPYnNlcnZlciA9IG9ic2VydmVyQ3JlYXRlKFxuICAgICAgICBmdW5jdGlvbiAoeCkgeyBvLm9uTmV4dCh4KTsgfSxcbiAgICAgICAgZnVuY3Rpb24gKGVycikge1xuICAgICAgICAgIGV4dGVybmFsU3Vic2NyaXB0aW9ucy5mb3JFYWNoKGZ1bmN0aW9uICh2KSB7IHYub25FcnJvcihlcnIpOyB9KTtcbiAgICAgICAgICBvLm9uRXJyb3IoZXJyKTtcbiAgICAgICAgfSxcbiAgICAgICAgZnVuY3Rpb24gKHgpIHsgby5vbkNvbXBsZXRlZCgpOyB9XG4gICAgICApO1xuICAgICAgdHJ5IHtcbiAgICAgICAgZm9yICh2YXIgaSA9IDAsIGxlbiA9IHBsYW5zLmxlbmd0aDsgaSA8IGxlbjsgaSsrKSB7XG4gICAgICAgICAgYWN0aXZlUGxhbnMucHVzaChwbGFuc1tpXS5hY3RpdmF0ZShleHRlcm5hbFN1YnNjcmlwdGlvbnMsIG91dE9ic2VydmVyLCBmdW5jdGlvbiAoYWN0aXZlUGxhbikge1xuICAgICAgICAgICAgdmFyIGlkeCA9IGFjdGl2ZVBsYW5zLmluZGV4T2YoYWN0aXZlUGxhbik7XG4gICAgICAgICAgICBhY3RpdmVQbGFucy5zcGxpY2UoaWR4LCAxKTtcbiAgICAgICAgICAgIGFjdGl2ZVBsYW5zLmxlbmd0aCA9PT0gMCAmJiBvLm9uQ29tcGxldGVkKCk7XG4gICAgICAgICAgfSkpO1xuICAgICAgICB9XG4gICAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgIG9ic2VydmFibGVUaHJvdyhlKS5zdWJzY3JpYmUobyk7XG4gICAgICB9XG4gICAgICB2YXIgZ3JvdXAgPSBuZXcgQ29tcG9zaXRlRGlzcG9zYWJsZSgpO1xuICAgICAgZXh0ZXJuYWxTdWJzY3JpcHRpb25zLmZvckVhY2goZnVuY3Rpb24gKGpvaW5PYnNlcnZlcikge1xuICAgICAgICBqb2luT2JzZXJ2ZXIuc3Vic2NyaWJlKCk7XG4gICAgICAgIGdyb3VwLmFkZChqb2luT2JzZXJ2ZXIpO1xuICAgICAgfSk7XG5cbiAgICAgIHJldHVybiBncm91cDtcbiAgICB9KTtcbiAgfTtcblxuICB2YXIgVGltZXJPYnNlcnZhYmxlID0gKGZ1bmN0aW9uKF9fc3VwZXJfXykge1xuICAgIGluaGVyaXRzKFRpbWVyT2JzZXJ2YWJsZSwgX19zdXBlcl9fKTtcbiAgICBmdW5jdGlvbiBUaW1lck9ic2VydmFibGUoZHQsIHMpIHtcbiAgICAgIHRoaXMuX2R0ID0gZHQ7XG4gICAgICB0aGlzLl9zID0gcztcbiAgICAgIF9fc3VwZXJfXy5jYWxsKHRoaXMpO1xuICAgIH1cblxuICAgIFRpbWVyT2JzZXJ2YWJsZS5wcm90b3R5cGUuc3Vic2NyaWJlQ29yZSA9IGZ1bmN0aW9uIChvKSB7XG4gICAgICByZXR1cm4gdGhpcy5fcy5zY2hlZHVsZUZ1dHVyZShvLCB0aGlzLl9kdCwgc2NoZWR1bGVNZXRob2QpO1xuICAgIH07XG5cbiAgICBmdW5jdGlvbiBzY2hlZHVsZU1ldGhvZChzLCBvKSB7XG4gICAgICBvLm9uTmV4dCgwKTtcbiAgICAgIG8ub25Db21wbGV0ZWQoKTtcbiAgICB9XG5cbiAgICByZXR1cm4gVGltZXJPYnNlcnZhYmxlO1xuICB9KE9ic2VydmFibGVCYXNlKSk7XG5cbiAgZnVuY3Rpb24gX29ic2VydmFibGVUaW1lcihkdWVUaW1lLCBzY2hlZHVsZXIpIHtcbiAgICByZXR1cm4gbmV3IFRpbWVyT2JzZXJ2YWJsZShkdWVUaW1lLCBzY2hlZHVsZXIpO1xuICB9XG5cbiAgZnVuY3Rpb24gb2JzZXJ2YWJsZVRpbWVyRGF0ZUFuZFBlcmlvZChkdWVUaW1lLCBwZXJpb2QsIHNjaGVkdWxlcikge1xuICAgIHJldHVybiBuZXcgQW5vbnltb3VzT2JzZXJ2YWJsZShmdW5jdGlvbiAob2JzZXJ2ZXIpIHtcbiAgICAgIHZhciBkID0gZHVlVGltZSwgcCA9IG5vcm1hbGl6ZVRpbWUocGVyaW9kKTtcbiAgICAgIHJldHVybiBzY2hlZHVsZXIuc2NoZWR1bGVSZWN1cnNpdmVGdXR1cmUoMCwgZCwgZnVuY3Rpb24gKGNvdW50LCBzZWxmKSB7XG4gICAgICAgIGlmIChwID4gMCkge1xuICAgICAgICAgIHZhciBub3cgPSBzY2hlZHVsZXIubm93KCk7XG4gICAgICAgICAgZCA9IGQgKyBwO1xuICAgICAgICAgIGQgPD0gbm93ICYmIChkID0gbm93ICsgcCk7XG4gICAgICAgIH1cbiAgICAgICAgb2JzZXJ2ZXIub25OZXh0KGNvdW50KTtcbiAgICAgICAgc2VsZihjb3VudCArIDEsIG5ldyBEYXRlKGQpKTtcbiAgICAgIH0pO1xuICAgIH0pO1xuICB9XG5cbiAgZnVuY3Rpb24gb2JzZXJ2YWJsZVRpbWVyVGltZVNwYW5BbmRQZXJpb2QoZHVlVGltZSwgcGVyaW9kLCBzY2hlZHVsZXIpIHtcbiAgICByZXR1cm4gZHVlVGltZSA9PT0gcGVyaW9kID9cbiAgICAgIG5ldyBBbm9ueW1vdXNPYnNlcnZhYmxlKGZ1bmN0aW9uIChvYnNlcnZlcikge1xuICAgICAgICByZXR1cm4gc2NoZWR1bGVyLnNjaGVkdWxlUGVyaW9kaWMoMCwgcGVyaW9kLCBmdW5jdGlvbiAoY291bnQpIHtcbiAgICAgICAgICBvYnNlcnZlci5vbk5leHQoY291bnQpO1xuICAgICAgICAgIHJldHVybiBjb3VudCArIDE7XG4gICAgICAgIH0pO1xuICAgICAgfSkgOlxuICAgICAgb2JzZXJ2YWJsZURlZmVyKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmV0dXJuIG9ic2VydmFibGVUaW1lckRhdGVBbmRQZXJpb2QobmV3IERhdGUoc2NoZWR1bGVyLm5vdygpICsgZHVlVGltZSksIHBlcmlvZCwgc2NoZWR1bGVyKTtcbiAgICAgIH0pO1xuICB9XG5cbiAgLyoqXG4gICAqICBSZXR1cm5zIGFuIG9ic2VydmFibGUgc2VxdWVuY2UgdGhhdCBwcm9kdWNlcyBhIHZhbHVlIGFmdGVyIGVhY2ggcGVyaW9kLlxuICAgKlxuICAgKiBAZXhhbXBsZVxuICAgKiAgMSAtIHJlcyA9IFJ4Lk9ic2VydmFibGUuaW50ZXJ2YWwoMTAwMCk7XG4gICAqICAyIC0gcmVzID0gUnguT2JzZXJ2YWJsZS5pbnRlcnZhbCgxMDAwLCBSeC5TY2hlZHVsZXIudGltZW91dCk7XG4gICAqXG4gICAqIEBwYXJhbSB7TnVtYmVyfSBwZXJpb2QgUGVyaW9kIGZvciBwcm9kdWNpbmcgdGhlIHZhbHVlcyBpbiB0aGUgcmVzdWx0aW5nIHNlcXVlbmNlIChzcGVjaWZpZWQgYXMgYW4gaW50ZWdlciBkZW5vdGluZyBtaWxsaXNlY29uZHMpLlxuICAgKiBAcGFyYW0ge1NjaGVkdWxlcn0gW3NjaGVkdWxlcl0gU2NoZWR1bGVyIHRvIHJ1biB0aGUgdGltZXIgb24uIElmIG5vdCBzcGVjaWZpZWQsIFJ4LlNjaGVkdWxlci50aW1lb3V0IGlzIHVzZWQuXG4gICAqIEByZXR1cm5zIHtPYnNlcnZhYmxlfSBBbiBvYnNlcnZhYmxlIHNlcXVlbmNlIHRoYXQgcHJvZHVjZXMgYSB2YWx1ZSBhZnRlciBlYWNoIHBlcmlvZC5cbiAgICovXG4gIHZhciBvYnNlcnZhYmxlaW50ZXJ2YWwgPSBPYnNlcnZhYmxlLmludGVydmFsID0gZnVuY3Rpb24gKHBlcmlvZCwgc2NoZWR1bGVyKSB7XG4gICAgcmV0dXJuIG9ic2VydmFibGVUaW1lclRpbWVTcGFuQW5kUGVyaW9kKHBlcmlvZCwgcGVyaW9kLCBpc1NjaGVkdWxlcihzY2hlZHVsZXIpID8gc2NoZWR1bGVyIDogZGVmYXVsdFNjaGVkdWxlcik7XG4gIH07XG5cbiAgLyoqXG4gICAqICBSZXR1cm5zIGFuIG9ic2VydmFibGUgc2VxdWVuY2UgdGhhdCBwcm9kdWNlcyBhIHZhbHVlIGFmdGVyIGR1ZVRpbWUgaGFzIGVsYXBzZWQgYW5kIHRoZW4gYWZ0ZXIgZWFjaCBwZXJpb2QuXG4gICAqIEBwYXJhbSB7TnVtYmVyfSBkdWVUaW1lIEFic29sdXRlIChzcGVjaWZpZWQgYXMgYSBEYXRlIG9iamVjdCkgb3IgcmVsYXRpdmUgdGltZSAoc3BlY2lmaWVkIGFzIGFuIGludGVnZXIgZGVub3RpbmcgbWlsbGlzZWNvbmRzKSBhdCB3aGljaCB0byBwcm9kdWNlIHRoZSBmaXJzdCB2YWx1ZS5cbiAgICogQHBhcmFtIHtNaXhlZH0gW3BlcmlvZE9yU2NoZWR1bGVyXSAgUGVyaW9kIHRvIHByb2R1Y2Ugc3Vic2VxdWVudCB2YWx1ZXMgKHNwZWNpZmllZCBhcyBhbiBpbnRlZ2VyIGRlbm90aW5nIG1pbGxpc2Vjb25kcyksIG9yIHRoZSBzY2hlZHVsZXIgdG8gcnVuIHRoZSB0aW1lciBvbi4gSWYgbm90IHNwZWNpZmllZCwgdGhlIHJlc3VsdGluZyB0aW1lciBpcyBub3QgcmVjdXJyaW5nLlxuICAgKiBAcGFyYW0ge1NjaGVkdWxlcn0gW3NjaGVkdWxlcl0gIFNjaGVkdWxlciB0byBydW4gdGhlIHRpbWVyIG9uLiBJZiBub3Qgc3BlY2lmaWVkLCB0aGUgdGltZW91dCBzY2hlZHVsZXIgaXMgdXNlZC5cbiAgICogQHJldHVybnMge09ic2VydmFibGV9IEFuIG9ic2VydmFibGUgc2VxdWVuY2UgdGhhdCBwcm9kdWNlcyBhIHZhbHVlIGFmdGVyIGR1ZSB0aW1lIGhhcyBlbGFwc2VkIGFuZCB0aGVuIGVhY2ggcGVyaW9kLlxuICAgKi9cbiAgdmFyIG9ic2VydmFibGVUaW1lciA9IE9ic2VydmFibGUudGltZXIgPSBmdW5jdGlvbiAoZHVlVGltZSwgcGVyaW9kT3JTY2hlZHVsZXIsIHNjaGVkdWxlcikge1xuICAgIHZhciBwZXJpb2Q7XG4gICAgaXNTY2hlZHVsZXIoc2NoZWR1bGVyKSB8fCAoc2NoZWR1bGVyID0gZGVmYXVsdFNjaGVkdWxlcik7XG4gICAgaWYgKHBlcmlvZE9yU2NoZWR1bGVyICE9IG51bGwgJiYgdHlwZW9mIHBlcmlvZE9yU2NoZWR1bGVyID09PSAnbnVtYmVyJykge1xuICAgICAgcGVyaW9kID0gcGVyaW9kT3JTY2hlZHVsZXI7XG4gICAgfSBlbHNlIGlmIChpc1NjaGVkdWxlcihwZXJpb2RPclNjaGVkdWxlcikpIHtcbiAgICAgIHNjaGVkdWxlciA9IHBlcmlvZE9yU2NoZWR1bGVyO1xuICAgIH1cbiAgICBpZiAoKGR1ZVRpbWUgaW5zdGFuY2VvZiBEYXRlIHx8IHR5cGVvZiBkdWVUaW1lID09PSAnbnVtYmVyJykgJiYgcGVyaW9kID09PSB1bmRlZmluZWQpIHtcbiAgICAgIHJldHVybiBfb2JzZXJ2YWJsZVRpbWVyKGR1ZVRpbWUsIHNjaGVkdWxlcik7XG4gICAgfVxuICAgIGlmIChkdWVUaW1lIGluc3RhbmNlb2YgRGF0ZSAmJiBwZXJpb2QgIT09IHVuZGVmaW5lZCkge1xuICAgICAgcmV0dXJuIG9ic2VydmFibGVUaW1lckRhdGVBbmRQZXJpb2QoZHVlVGltZS5nZXRUaW1lKCksIHBlcmlvZE9yU2NoZWR1bGVyLCBzY2hlZHVsZXIpO1xuICAgIH1cbiAgICByZXR1cm4gb2JzZXJ2YWJsZVRpbWVyVGltZVNwYW5BbmRQZXJpb2QoZHVlVGltZSwgcGVyaW9kLCBzY2hlZHVsZXIpO1xuICB9O1xuXG4gIGZ1bmN0aW9uIG9ic2VydmFibGVEZWxheVJlbGF0aXZlKHNvdXJjZSwgZHVlVGltZSwgc2NoZWR1bGVyKSB7XG4gICAgcmV0dXJuIG5ldyBBbm9ueW1vdXNPYnNlcnZhYmxlKGZ1bmN0aW9uIChvKSB7XG4gICAgICB2YXIgYWN0aXZlID0gZmFsc2UsXG4gICAgICAgIGNhbmNlbGFibGUgPSBuZXcgU2VyaWFsRGlzcG9zYWJsZSgpLFxuICAgICAgICBleGNlcHRpb24gPSBudWxsLFxuICAgICAgICBxID0gW10sXG4gICAgICAgIHJ1bm5pbmcgPSBmYWxzZSxcbiAgICAgICAgc3Vic2NyaXB0aW9uO1xuICAgICAgc3Vic2NyaXB0aW9uID0gc291cmNlLm1hdGVyaWFsaXplKCkudGltZXN0YW1wKHNjaGVkdWxlcikuc3Vic2NyaWJlKGZ1bmN0aW9uIChub3RpZmljYXRpb24pIHtcbiAgICAgICAgdmFyIGQsIHNob3VsZFJ1bjtcbiAgICAgICAgaWYgKG5vdGlmaWNhdGlvbi52YWx1ZS5raW5kID09PSAnRScpIHtcbiAgICAgICAgICBxID0gW107XG4gICAgICAgICAgcS5wdXNoKG5vdGlmaWNhdGlvbik7XG4gICAgICAgICAgZXhjZXB0aW9uID0gbm90aWZpY2F0aW9uLnZhbHVlLmVycm9yO1xuICAgICAgICAgIHNob3VsZFJ1biA9ICFydW5uaW5nO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHEucHVzaCh7IHZhbHVlOiBub3RpZmljYXRpb24udmFsdWUsIHRpbWVzdGFtcDogbm90aWZpY2F0aW9uLnRpbWVzdGFtcCArIGR1ZVRpbWUgfSk7XG4gICAgICAgICAgc2hvdWxkUnVuID0gIWFjdGl2ZTtcbiAgICAgICAgICBhY3RpdmUgPSB0cnVlO1xuICAgICAgICB9XG4gICAgICAgIGlmIChzaG91bGRSdW4pIHtcbiAgICAgICAgICBpZiAoZXhjZXB0aW9uICE9PSBudWxsKSB7XG4gICAgICAgICAgICBvLm9uRXJyb3IoZXhjZXB0aW9uKTtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgZCA9IG5ldyBTaW5nbGVBc3NpZ25tZW50RGlzcG9zYWJsZSgpO1xuICAgICAgICAgICAgY2FuY2VsYWJsZS5zZXREaXNwb3NhYmxlKGQpO1xuICAgICAgICAgICAgZC5zZXREaXNwb3NhYmxlKHNjaGVkdWxlci5zY2hlZHVsZVJlY3Vyc2l2ZUZ1dHVyZShudWxsLCBkdWVUaW1lLCBmdW5jdGlvbiAoXywgc2VsZikge1xuICAgICAgICAgICAgICB2YXIgZSwgcmVjdXJzZUR1ZVRpbWUsIHJlc3VsdCwgc2hvdWxkUmVjdXJzZTtcbiAgICAgICAgICAgICAgaWYgKGV4Y2VwdGlvbiAhPT0gbnVsbCkge1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICBydW5uaW5nID0gdHJ1ZTtcbiAgICAgICAgICAgICAgZG8ge1xuICAgICAgICAgICAgICAgIHJlc3VsdCA9IG51bGw7XG4gICAgICAgICAgICAgICAgaWYgKHEubGVuZ3RoID4gMCAmJiBxWzBdLnRpbWVzdGFtcCAtIHNjaGVkdWxlci5ub3coKSA8PSAwKSB7XG4gICAgICAgICAgICAgICAgICByZXN1bHQgPSBxLnNoaWZ0KCkudmFsdWU7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGlmIChyZXN1bHQgIT09IG51bGwpIHtcbiAgICAgICAgICAgICAgICAgIHJlc3VsdC5hY2NlcHQobyk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICB9IHdoaWxlIChyZXN1bHQgIT09IG51bGwpO1xuICAgICAgICAgICAgICBzaG91bGRSZWN1cnNlID0gZmFsc2U7XG4gICAgICAgICAgICAgIHJlY3Vyc2VEdWVUaW1lID0gMDtcbiAgICAgICAgICAgICAgaWYgKHEubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgICAgIHNob3VsZFJlY3Vyc2UgPSB0cnVlO1xuICAgICAgICAgICAgICAgIHJlY3Vyc2VEdWVUaW1lID0gTWF0aC5tYXgoMCwgcVswXS50aW1lc3RhbXAgLSBzY2hlZHVsZXIubm93KCkpO1xuICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIGFjdGl2ZSA9IGZhbHNlO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIGUgPSBleGNlcHRpb247XG4gICAgICAgICAgICAgIHJ1bm5pbmcgPSBmYWxzZTtcbiAgICAgICAgICAgICAgaWYgKGUgIT09IG51bGwpIHtcbiAgICAgICAgICAgICAgICBvLm9uRXJyb3IoZSk7XG4gICAgICAgICAgICAgIH0gZWxzZSBpZiAoc2hvdWxkUmVjdXJzZSkge1xuICAgICAgICAgICAgICAgIHNlbGYobnVsbCwgcmVjdXJzZUR1ZVRpbWUpO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KSk7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9KTtcbiAgICAgIHJldHVybiBuZXcgQmluYXJ5RGlzcG9zYWJsZShzdWJzY3JpcHRpb24sIGNhbmNlbGFibGUpO1xuICAgIH0sIHNvdXJjZSk7XG4gIH1cblxuICBmdW5jdGlvbiBvYnNlcnZhYmxlRGVsYXlBYnNvbHV0ZShzb3VyY2UsIGR1ZVRpbWUsIHNjaGVkdWxlcikge1xuICAgIHJldHVybiBvYnNlcnZhYmxlRGVmZXIoZnVuY3Rpb24gKCkge1xuICAgICAgcmV0dXJuIG9ic2VydmFibGVEZWxheVJlbGF0aXZlKHNvdXJjZSwgZHVlVGltZSAtIHNjaGVkdWxlci5ub3coKSwgc2NoZWR1bGVyKTtcbiAgICB9KTtcbiAgfVxuXG4gIGZ1bmN0aW9uIGRlbGF5V2l0aFNlbGVjdG9yKHNvdXJjZSwgc3Vic2NyaXB0aW9uRGVsYXksIGRlbGF5RHVyYXRpb25TZWxlY3Rvcikge1xuICAgIHZhciBzdWJEZWxheSwgc2VsZWN0b3I7XG4gICAgaWYgKGlzRnVuY3Rpb24oc3Vic2NyaXB0aW9uRGVsYXkpKSB7XG4gICAgICBzZWxlY3RvciA9IHN1YnNjcmlwdGlvbkRlbGF5O1xuICAgIH0gZWxzZSB7XG4gICAgICBzdWJEZWxheSA9IHN1YnNjcmlwdGlvbkRlbGF5O1xuICAgICAgc2VsZWN0b3IgPSBkZWxheUR1cmF0aW9uU2VsZWN0b3I7XG4gICAgfVxuICAgIHJldHVybiBuZXcgQW5vbnltb3VzT2JzZXJ2YWJsZShmdW5jdGlvbiAobykge1xuICAgICAgdmFyIGRlbGF5cyA9IG5ldyBDb21wb3NpdGVEaXNwb3NhYmxlKCksIGF0RW5kID0gZmFsc2UsIHN1YnNjcmlwdGlvbiA9IG5ldyBTZXJpYWxEaXNwb3NhYmxlKCk7XG5cbiAgICAgIGZ1bmN0aW9uIHN0YXJ0KCkge1xuICAgICAgICBzdWJzY3JpcHRpb24uc2V0RGlzcG9zYWJsZShzb3VyY2Uuc3Vic2NyaWJlKFxuICAgICAgICAgIGZ1bmN0aW9uICh4KSB7XG4gICAgICAgICAgICB2YXIgZGVsYXkgPSB0cnlDYXRjaChzZWxlY3RvcikoeCk7XG4gICAgICAgICAgICBpZiAoZGVsYXkgPT09IGVycm9yT2JqKSB7IHJldHVybiBvLm9uRXJyb3IoZGVsYXkuZSk7IH1cbiAgICAgICAgICAgIHZhciBkID0gbmV3IFNpbmdsZUFzc2lnbm1lbnREaXNwb3NhYmxlKCk7XG4gICAgICAgICAgICBkZWxheXMuYWRkKGQpO1xuICAgICAgICAgICAgZC5zZXREaXNwb3NhYmxlKGRlbGF5LnN1YnNjcmliZShcbiAgICAgICAgICAgICAgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIG8ub25OZXh0KHgpO1xuICAgICAgICAgICAgICAgIGRlbGF5cy5yZW1vdmUoZCk7XG4gICAgICAgICAgICAgICAgZG9uZSgpO1xuICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICBmdW5jdGlvbiAoZSkgeyBvLm9uRXJyb3IoZSk7IH0sXG4gICAgICAgICAgICAgIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICBvLm9uTmV4dCh4KTtcbiAgICAgICAgICAgICAgICBkZWxheXMucmVtb3ZlKGQpO1xuICAgICAgICAgICAgICAgIGRvbmUoKTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgKSk7XG4gICAgICAgICAgfSxcbiAgICAgICAgICBmdW5jdGlvbiAoZSkgeyBvLm9uRXJyb3IoZSk7IH0sXG4gICAgICAgICAgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgYXRFbmQgPSB0cnVlO1xuICAgICAgICAgICAgc3Vic2NyaXB0aW9uLmRpc3Bvc2UoKTtcbiAgICAgICAgICAgIGRvbmUoKTtcbiAgICAgICAgICB9XG4gICAgICAgICkpO1xuICAgICAgfVxuXG4gICAgICBmdW5jdGlvbiBkb25lICgpIHtcbiAgICAgICAgYXRFbmQgJiYgZGVsYXlzLmxlbmd0aCA9PT0gMCAmJiBvLm9uQ29tcGxldGVkKCk7XG4gICAgICB9XG5cbiAgICAgIGlmICghc3ViRGVsYXkpIHtcbiAgICAgICAgc3RhcnQoKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHN1YnNjcmlwdGlvbi5zZXREaXNwb3NhYmxlKHN1YkRlbGF5LnN1YnNjcmliZShzdGFydCwgZnVuY3Rpb24gKGUpIHsgby5vbkVycm9yKGUpOyB9LCBzdGFydCkpO1xuICAgICAgfVxuXG4gICAgICByZXR1cm4gbmV3IEJpbmFyeURpc3Bvc2FibGUoc3Vic2NyaXB0aW9uLCBkZWxheXMpO1xuICAgIH0sIHRoaXMpO1xuICB9XG5cbiAgLyoqXG4gICAqICBUaW1lIHNoaWZ0cyB0aGUgb2JzZXJ2YWJsZSBzZXF1ZW5jZSBieSBkdWVUaW1lLlxuICAgKiAgVGhlIHJlbGF0aXZlIHRpbWUgaW50ZXJ2YWxzIGJldHdlZW4gdGhlIHZhbHVlcyBhcmUgcHJlc2VydmVkLlxuICAgKlxuICAgKiBAcGFyYW0ge051bWJlcn0gZHVlVGltZSBBYnNvbHV0ZSAoc3BlY2lmaWVkIGFzIGEgRGF0ZSBvYmplY3QpIG9yIHJlbGF0aXZlIHRpbWUgKHNwZWNpZmllZCBhcyBhbiBpbnRlZ2VyIGRlbm90aW5nIG1pbGxpc2Vjb25kcykgYnkgd2hpY2ggdG8gc2hpZnQgdGhlIG9ic2VydmFibGUgc2VxdWVuY2UuXG4gICAqIEBwYXJhbSB7U2NoZWR1bGVyfSBbc2NoZWR1bGVyXSBTY2hlZHVsZXIgdG8gcnVuIHRoZSBkZWxheSB0aW1lcnMgb24uIElmIG5vdCBzcGVjaWZpZWQsIHRoZSB0aW1lb3V0IHNjaGVkdWxlciBpcyB1c2VkLlxuICAgKiBAcmV0dXJucyB7T2JzZXJ2YWJsZX0gVGltZS1zaGlmdGVkIHNlcXVlbmNlLlxuICAgKi9cbiAgb2JzZXJ2YWJsZVByb3RvLmRlbGF5ID0gZnVuY3Rpb24gKCkge1xuICAgIHZhciBmaXJzdEFyZyA9IGFyZ3VtZW50c1swXTtcbiAgICBpZiAodHlwZW9mIGZpcnN0QXJnID09PSAnbnVtYmVyJyB8fCBmaXJzdEFyZyBpbnN0YW5jZW9mIERhdGUpIHtcbiAgICAgIHZhciBkdWVUaW1lID0gZmlyc3RBcmcsIHNjaGVkdWxlciA9IGFyZ3VtZW50c1sxXTtcbiAgICAgIGlzU2NoZWR1bGVyKHNjaGVkdWxlcikgfHwgKHNjaGVkdWxlciA9IGRlZmF1bHRTY2hlZHVsZXIpO1xuICAgICAgcmV0dXJuIGR1ZVRpbWUgaW5zdGFuY2VvZiBEYXRlID9cbiAgICAgICAgb2JzZXJ2YWJsZURlbGF5QWJzb2x1dGUodGhpcywgZHVlVGltZSwgc2NoZWR1bGVyKSA6XG4gICAgICAgIG9ic2VydmFibGVEZWxheVJlbGF0aXZlKHRoaXMsIGR1ZVRpbWUsIHNjaGVkdWxlcik7XG4gICAgfSBlbHNlIGlmIChPYnNlcnZhYmxlLmlzT2JzZXJ2YWJsZShmaXJzdEFyZykgfHwgaXNGdW5jdGlvbihmaXJzdEFyZykpIHtcbiAgICAgIHJldHVybiBkZWxheVdpdGhTZWxlY3Rvcih0aGlzLCBmaXJzdEFyZywgYXJndW1lbnRzWzFdKTtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKCdJbnZhbGlkIGFyZ3VtZW50cycpO1xuICAgIH1cbiAgfTtcblxuICB2YXIgRGVib3VuY2VPYnNlcnZhYmxlID0gKGZ1bmN0aW9uIChfX3N1cGVyX18pIHtcbiAgICBpbmhlcml0cyhEZWJvdW5jZU9ic2VydmFibGUsIF9fc3VwZXJfXyk7XG4gICAgZnVuY3Rpb24gRGVib3VuY2VPYnNlcnZhYmxlKHNvdXJjZSwgZHQsIHMpIHtcbiAgICAgIGlzU2NoZWR1bGVyKHMpIHx8IChzID0gZGVmYXVsdFNjaGVkdWxlcik7XG4gICAgICB0aGlzLnNvdXJjZSA9IHNvdXJjZTtcbiAgICAgIHRoaXMuX2R0ID0gZHQ7XG4gICAgICB0aGlzLl9zID0gcztcbiAgICAgIF9fc3VwZXJfXy5jYWxsKHRoaXMpO1xuICAgIH1cblxuICAgIERlYm91bmNlT2JzZXJ2YWJsZS5wcm90b3R5cGUuc3Vic2NyaWJlQ29yZSA9IGZ1bmN0aW9uIChvKSB7XG4gICAgICB2YXIgY2FuY2VsYWJsZSA9IG5ldyBTZXJpYWxEaXNwb3NhYmxlKCk7XG4gICAgICByZXR1cm4gbmV3IEJpbmFyeURpc3Bvc2FibGUoXG4gICAgICAgIHRoaXMuc291cmNlLnN1YnNjcmliZShuZXcgRGVib3VuY2VPYnNlcnZlcihvLCB0aGlzLnNvdXJjZSwgdGhpcy5fZHQsIHRoaXMuX3MsIGNhbmNlbGFibGUpKSxcbiAgICAgICAgY2FuY2VsYWJsZSk7XG4gICAgfTtcblxuICAgIHJldHVybiBEZWJvdW5jZU9ic2VydmFibGU7XG4gIH0oT2JzZXJ2YWJsZUJhc2UpKTtcblxuICB2YXIgRGVib3VuY2VPYnNlcnZlciA9IChmdW5jdGlvbiAoX19zdXBlcl9fKSB7XG4gICAgaW5oZXJpdHMoRGVib3VuY2VPYnNlcnZlciwgX19zdXBlcl9fKTtcbiAgICBmdW5jdGlvbiBEZWJvdW5jZU9ic2VydmVyKG9ic2VydmVyLCBzb3VyY2UsIGR1ZVRpbWUsIHNjaGVkdWxlciwgY2FuY2VsYWJsZSkge1xuICAgICAgdGhpcy5fbyA9IG9ic2VydmVyO1xuICAgICAgdGhpcy5fcyA9IHNvdXJjZTtcbiAgICAgIHRoaXMuX2QgPSBkdWVUaW1lO1xuICAgICAgdGhpcy5fc2NoZWR1bGVyID0gc2NoZWR1bGVyO1xuICAgICAgdGhpcy5fYyA9IGNhbmNlbGFibGU7XG4gICAgICB0aGlzLl92ID0gbnVsbDtcbiAgICAgIHRoaXMuX2h2ID0gZmFsc2U7XG4gICAgICB0aGlzLl9pZCA9IDA7XG4gICAgICBfX3N1cGVyX18uY2FsbCh0aGlzKTtcbiAgICB9XG5cbiAgICBEZWJvdW5jZU9ic2VydmVyLnByb3RvdHlwZS5uZXh0ID0gZnVuY3Rpb24gKHgpIHtcbiAgICAgIHRoaXMuX2h2ID0gdHJ1ZTtcbiAgICAgIHRoaXMuX3YgPSB4O1xuICAgICAgdmFyIGN1cnJlbnRJZCA9ICsrdGhpcy5faWQsIGQgPSBuZXcgU2luZ2xlQXNzaWdubWVudERpc3Bvc2FibGUoKTtcbiAgICAgIHRoaXMuX2Muc2V0RGlzcG9zYWJsZShkKTtcbiAgICAgIGQuc2V0RGlzcG9zYWJsZSh0aGlzLl9zY2hlZHVsZXIuc2NoZWR1bGVGdXR1cmUodGhpcywgdGhpcy5fZCwgZnVuY3Rpb24gKF8sIHNlbGYpIHtcbiAgICAgICAgc2VsZi5faHYgJiYgc2VsZi5faWQgPT09IGN1cnJlbnRJZCAmJiBzZWxmLl9vLm9uTmV4dCh4KTtcbiAgICAgICAgc2VsZi5faHYgPSBmYWxzZTtcbiAgICAgIH0pKTtcbiAgICB9O1xuXG4gICAgRGVib3VuY2VPYnNlcnZlci5wcm90b3R5cGUuZXJyb3IgPSBmdW5jdGlvbiAoZSkge1xuICAgICAgdGhpcy5fYy5kaXNwb3NlKCk7XG4gICAgICB0aGlzLl9vLm9uRXJyb3IoZSk7XG4gICAgICB0aGlzLl9odiA9IGZhbHNlO1xuICAgICAgdGhpcy5faWQrKztcbiAgICB9O1xuXG4gICAgRGVib3VuY2VPYnNlcnZlci5wcm90b3R5cGUuY29tcGxldGVkID0gZnVuY3Rpb24gKCkge1xuICAgICAgdGhpcy5fYy5kaXNwb3NlKCk7XG4gICAgICB0aGlzLl9odiAmJiB0aGlzLl9vLm9uTmV4dCh0aGlzLl92KTtcbiAgICAgIHRoaXMuX28ub25Db21wbGV0ZWQoKTtcbiAgICAgIHRoaXMuX2h2ID0gZmFsc2U7XG4gICAgICB0aGlzLl9pZCsrO1xuICAgIH07XG5cbiAgICByZXR1cm4gRGVib3VuY2VPYnNlcnZlcjtcbiAgfShBYnN0cmFjdE9ic2VydmVyKSk7XG5cbiAgZnVuY3Rpb24gZGVib3VuY2VXaXRoU2VsZWN0b3Ioc291cmNlLCBkdXJhdGlvblNlbGVjdG9yKSB7XG4gICAgcmV0dXJuIG5ldyBBbm9ueW1vdXNPYnNlcnZhYmxlKGZ1bmN0aW9uIChvKSB7XG4gICAgICB2YXIgdmFsdWUsIGhhc1ZhbHVlID0gZmFsc2UsIGNhbmNlbGFibGUgPSBuZXcgU2VyaWFsRGlzcG9zYWJsZSgpLCBpZCA9IDA7XG4gICAgICB2YXIgc3Vic2NyaXB0aW9uID0gc291cmNlLnN1YnNjcmliZShcbiAgICAgICAgZnVuY3Rpb24gKHgpIHtcbiAgICAgICAgICB2YXIgdGhyb3R0bGUgPSB0cnlDYXRjaChkdXJhdGlvblNlbGVjdG9yKSh4KTtcbiAgICAgICAgICBpZiAodGhyb3R0bGUgPT09IGVycm9yT2JqKSB7IHJldHVybiBvLm9uRXJyb3IodGhyb3R0bGUuZSk7IH1cblxuICAgICAgICAgIGlzUHJvbWlzZSh0aHJvdHRsZSkgJiYgKHRocm90dGxlID0gb2JzZXJ2YWJsZUZyb21Qcm9taXNlKHRocm90dGxlKSk7XG5cbiAgICAgICAgICBoYXNWYWx1ZSA9IHRydWU7XG4gICAgICAgICAgdmFsdWUgPSB4O1xuICAgICAgICAgIGlkKys7XG4gICAgICAgICAgdmFyIGN1cnJlbnRpZCA9IGlkLCBkID0gbmV3IFNpbmdsZUFzc2lnbm1lbnREaXNwb3NhYmxlKCk7XG4gICAgICAgICAgY2FuY2VsYWJsZS5zZXREaXNwb3NhYmxlKGQpO1xuICAgICAgICAgIGQuc2V0RGlzcG9zYWJsZSh0aHJvdHRsZS5zdWJzY3JpYmUoXG4gICAgICAgICAgICBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgIGhhc1ZhbHVlICYmIGlkID09PSBjdXJyZW50aWQgJiYgby5vbk5leHQodmFsdWUpO1xuICAgICAgICAgICAgICBoYXNWYWx1ZSA9IGZhbHNlO1xuICAgICAgICAgICAgICBkLmRpc3Bvc2UoKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBmdW5jdGlvbiAoZSkgeyBvLm9uRXJyb3IoZSk7IH0sXG4gICAgICAgICAgICBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgIGhhc1ZhbHVlICYmIGlkID09PSBjdXJyZW50aWQgJiYgby5vbk5leHQodmFsdWUpO1xuICAgICAgICAgICAgICBoYXNWYWx1ZSA9IGZhbHNlO1xuICAgICAgICAgICAgICBkLmRpc3Bvc2UoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICApKTtcbiAgICAgICAgfSxcbiAgICAgICAgZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgICBjYW5jZWxhYmxlLmRpc3Bvc2UoKTtcbiAgICAgICAgICBvLm9uRXJyb3IoZSk7XG4gICAgICAgICAgaGFzVmFsdWUgPSBmYWxzZTtcbiAgICAgICAgICBpZCsrO1xuICAgICAgICB9LFxuICAgICAgICBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgY2FuY2VsYWJsZS5kaXNwb3NlKCk7XG4gICAgICAgICAgaGFzVmFsdWUgJiYgby5vbk5leHQodmFsdWUpO1xuICAgICAgICAgIG8ub25Db21wbGV0ZWQoKTtcbiAgICAgICAgICBoYXNWYWx1ZSA9IGZhbHNlO1xuICAgICAgICAgIGlkKys7XG4gICAgICAgIH1cbiAgICAgICk7XG4gICAgICByZXR1cm4gbmV3IEJpbmFyeURpc3Bvc2FibGUoc3Vic2NyaXB0aW9uLCBjYW5jZWxhYmxlKTtcbiAgICB9LCBzb3VyY2UpO1xuICB9XG5cbiAgb2JzZXJ2YWJsZVByb3RvLmRlYm91bmNlID0gZnVuY3Rpb24gKCkge1xuICAgIGlmIChpc0Z1bmN0aW9uIChhcmd1bWVudHNbMF0pKSB7XG4gICAgICByZXR1cm4gZGVib3VuY2VXaXRoU2VsZWN0b3IodGhpcywgYXJndW1lbnRzWzBdKTtcbiAgICB9IGVsc2UgaWYgKHR5cGVvZiBhcmd1bWVudHNbMF0gPT09ICdudW1iZXInKSB7XG4gICAgICByZXR1cm4gbmV3IERlYm91bmNlT2JzZXJ2YWJsZSh0aGlzLCBhcmd1bWVudHNbMF0sIGFyZ3VtZW50c1sxXSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcignSW52YWxpZCBhcmd1bWVudHMnKTtcbiAgICB9XG4gIH07XG5cbiAgLyoqXG4gICAqICBQcm9qZWN0cyBlYWNoIGVsZW1lbnQgb2YgYW4gb2JzZXJ2YWJsZSBzZXF1ZW5jZSBpbnRvIHplcm8gb3IgbW9yZSB3aW5kb3dzIHdoaWNoIGFyZSBwcm9kdWNlZCBiYXNlZCBvbiB0aW1pbmcgaW5mb3JtYXRpb24uXG4gICAqIEBwYXJhbSB7TnVtYmVyfSB0aW1lU3BhbiBMZW5ndGggb2YgZWFjaCB3aW5kb3cgKHNwZWNpZmllZCBhcyBhbiBpbnRlZ2VyIGRlbm90aW5nIG1pbGxpc2Vjb25kcykuXG4gICAqIEBwYXJhbSB7TWl4ZWR9IFt0aW1lU2hpZnRPclNjaGVkdWxlcl0gIEludGVydmFsIGJldHdlZW4gY3JlYXRpb24gb2YgY29uc2VjdXRpdmUgd2luZG93cyAoc3BlY2lmaWVkIGFzIGFuIGludGVnZXIgZGVub3RpbmcgbWlsbGlzZWNvbmRzKSwgb3IgYW4gb3B0aW9uYWwgc2NoZWR1bGVyIHBhcmFtZXRlci4gSWYgbm90IHNwZWNpZmllZCwgdGhlIHRpbWUgc2hpZnQgY29ycmVzcG9uZHMgdG8gdGhlIHRpbWVTcGFuIHBhcmFtZXRlciwgcmVzdWx0aW5nIGluIG5vbi1vdmVybGFwcGluZyBhZGphY2VudCB3aW5kb3dzLlxuICAgKiBAcGFyYW0ge1NjaGVkdWxlcn0gW3NjaGVkdWxlcl0gIFNjaGVkdWxlciB0byBydW4gd2luZG93aW5nIHRpbWVycyBvbi4gSWYgbm90IHNwZWNpZmllZCwgdGhlIHRpbWVvdXQgc2NoZWR1bGVyIGlzIHVzZWQuXG4gICAqIEByZXR1cm5zIHtPYnNlcnZhYmxlfSBBbiBvYnNlcnZhYmxlIHNlcXVlbmNlIG9mIHdpbmRvd3MuXG4gICAqL1xuICBvYnNlcnZhYmxlUHJvdG8ud2luZG93V2l0aFRpbWUgPSBmdW5jdGlvbiAodGltZVNwYW4sIHRpbWVTaGlmdE9yU2NoZWR1bGVyLCBzY2hlZHVsZXIpIHtcbiAgICB2YXIgc291cmNlID0gdGhpcywgdGltZVNoaWZ0O1xuICAgIHRpbWVTaGlmdE9yU2NoZWR1bGVyID09IG51bGwgJiYgKHRpbWVTaGlmdCA9IHRpbWVTcGFuKTtcbiAgICBpc1NjaGVkdWxlcihzY2hlZHVsZXIpIHx8IChzY2hlZHVsZXIgPSBkZWZhdWx0U2NoZWR1bGVyKTtcbiAgICBpZiAodHlwZW9mIHRpbWVTaGlmdE9yU2NoZWR1bGVyID09PSAnbnVtYmVyJykge1xuICAgICAgdGltZVNoaWZ0ID0gdGltZVNoaWZ0T3JTY2hlZHVsZXI7XG4gICAgfSBlbHNlIGlmIChpc1NjaGVkdWxlcih0aW1lU2hpZnRPclNjaGVkdWxlcikpIHtcbiAgICAgIHRpbWVTaGlmdCA9IHRpbWVTcGFuO1xuICAgICAgc2NoZWR1bGVyID0gdGltZVNoaWZ0T3JTY2hlZHVsZXI7XG4gICAgfVxuICAgIHJldHVybiBuZXcgQW5vbnltb3VzT2JzZXJ2YWJsZShmdW5jdGlvbiAob2JzZXJ2ZXIpIHtcbiAgICAgIHZhciBncm91cERpc3Bvc2FibGUsXG4gICAgICAgIG5leHRTaGlmdCA9IHRpbWVTaGlmdCxcbiAgICAgICAgbmV4dFNwYW4gPSB0aW1lU3BhbixcbiAgICAgICAgcSA9IFtdLFxuICAgICAgICByZWZDb3VudERpc3Bvc2FibGUsXG4gICAgICAgIHRpbWVyRCA9IG5ldyBTZXJpYWxEaXNwb3NhYmxlKCksXG4gICAgICAgIHRvdGFsVGltZSA9IDA7XG4gICAgICAgIGdyb3VwRGlzcG9zYWJsZSA9IG5ldyBDb21wb3NpdGVEaXNwb3NhYmxlKHRpbWVyRCksXG4gICAgICAgIHJlZkNvdW50RGlzcG9zYWJsZSA9IG5ldyBSZWZDb3VudERpc3Bvc2FibGUoZ3JvdXBEaXNwb3NhYmxlKTtcblxuICAgICAgIGZ1bmN0aW9uIGNyZWF0ZVRpbWVyICgpIHtcbiAgICAgICAgdmFyIG0gPSBuZXcgU2luZ2xlQXNzaWdubWVudERpc3Bvc2FibGUoKSxcbiAgICAgICAgICBpc1NwYW4gPSBmYWxzZSxcbiAgICAgICAgICBpc1NoaWZ0ID0gZmFsc2U7XG4gICAgICAgIHRpbWVyRC5zZXREaXNwb3NhYmxlKG0pO1xuICAgICAgICBpZiAobmV4dFNwYW4gPT09IG5leHRTaGlmdCkge1xuICAgICAgICAgIGlzU3BhbiA9IHRydWU7XG4gICAgICAgICAgaXNTaGlmdCA9IHRydWU7XG4gICAgICAgIH0gZWxzZSBpZiAobmV4dFNwYW4gPCBuZXh0U2hpZnQpIHtcbiAgICAgICAgICAgIGlzU3BhbiA9IHRydWU7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgaXNTaGlmdCA9IHRydWU7XG4gICAgICAgIH1cbiAgICAgICAgdmFyIG5ld1RvdGFsVGltZSA9IGlzU3BhbiA/IG5leHRTcGFuIDogbmV4dFNoaWZ0LFxuICAgICAgICAgIHRzID0gbmV3VG90YWxUaW1lIC0gdG90YWxUaW1lO1xuICAgICAgICB0b3RhbFRpbWUgPSBuZXdUb3RhbFRpbWU7XG4gICAgICAgIGlmIChpc1NwYW4pIHtcbiAgICAgICAgICBuZXh0U3BhbiArPSB0aW1lU2hpZnQ7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGlzU2hpZnQpIHtcbiAgICAgICAgICBuZXh0U2hpZnQgKz0gdGltZVNoaWZ0O1xuICAgICAgICB9XG4gICAgICAgIG0uc2V0RGlzcG9zYWJsZShzY2hlZHVsZXIuc2NoZWR1bGVGdXR1cmUobnVsbCwgdHMsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICBpZiAoaXNTaGlmdCkge1xuICAgICAgICAgICAgdmFyIHMgPSBuZXcgU3ViamVjdCgpO1xuICAgICAgICAgICAgcS5wdXNoKHMpO1xuICAgICAgICAgICAgb2JzZXJ2ZXIub25OZXh0KGFkZFJlZihzLCByZWZDb3VudERpc3Bvc2FibGUpKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgaXNTcGFuICYmIHEuc2hpZnQoKS5vbkNvbXBsZXRlZCgpO1xuICAgICAgICAgIGNyZWF0ZVRpbWVyKCk7XG4gICAgICAgIH0pKTtcbiAgICAgIH07XG4gICAgICBxLnB1c2gobmV3IFN1YmplY3QoKSk7XG4gICAgICBvYnNlcnZlci5vbk5leHQoYWRkUmVmKHFbMF0sIHJlZkNvdW50RGlzcG9zYWJsZSkpO1xuICAgICAgY3JlYXRlVGltZXIoKTtcbiAgICAgIGdyb3VwRGlzcG9zYWJsZS5hZGQoc291cmNlLnN1YnNjcmliZShcbiAgICAgICAgZnVuY3Rpb24gKHgpIHtcbiAgICAgICAgICBmb3IgKHZhciBpID0gMCwgbGVuID0gcS5sZW5ndGg7IGkgPCBsZW47IGkrKykgeyBxW2ldLm9uTmV4dCh4KTsgfVxuICAgICAgICB9LFxuICAgICAgICBmdW5jdGlvbiAoZSkge1xuICAgICAgICAgIGZvciAodmFyIGkgPSAwLCBsZW4gPSBxLmxlbmd0aDsgaSA8IGxlbjsgaSsrKSB7IHFbaV0ub25FcnJvcihlKTsgfVxuICAgICAgICAgIG9ic2VydmVyLm9uRXJyb3IoZSk7XG4gICAgICAgIH0sXG4gICAgICAgIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICBmb3IgKHZhciBpID0gMCwgbGVuID0gcS5sZW5ndGg7IGkgPCBsZW47IGkrKykgeyBxW2ldLm9uQ29tcGxldGVkKCk7IH1cbiAgICAgICAgICBvYnNlcnZlci5vbkNvbXBsZXRlZCgpO1xuICAgICAgICB9XG4gICAgICApKTtcbiAgICAgIHJldHVybiByZWZDb3VudERpc3Bvc2FibGU7XG4gICAgfSwgc291cmNlKTtcbiAgfTtcblxuICAvKipcbiAgICogIFByb2plY3RzIGVhY2ggZWxlbWVudCBvZiBhbiBvYnNlcnZhYmxlIHNlcXVlbmNlIGludG8gYSB3aW5kb3cgdGhhdCBpcyBjb21wbGV0ZWQgd2hlbiBlaXRoZXIgaXQncyBmdWxsIG9yIGEgZ2l2ZW4gYW1vdW50IG9mIHRpbWUgaGFzIGVsYXBzZWQuXG4gICAqIEBwYXJhbSB7TnVtYmVyfSB0aW1lU3BhbiBNYXhpbXVtIHRpbWUgbGVuZ3RoIG9mIGEgd2luZG93LlxuICAgKiBAcGFyYW0ge051bWJlcn0gY291bnQgTWF4aW11bSBlbGVtZW50IGNvdW50IG9mIGEgd2luZG93LlxuICAgKiBAcGFyYW0ge1NjaGVkdWxlcn0gW3NjaGVkdWxlcl0gIFNjaGVkdWxlciB0byBydW4gd2luZG93aW5nIHRpbWVycyBvbi4gSWYgbm90IHNwZWNpZmllZCwgdGhlIHRpbWVvdXQgc2NoZWR1bGVyIGlzIHVzZWQuXG4gICAqIEByZXR1cm5zIHtPYnNlcnZhYmxlfSBBbiBvYnNlcnZhYmxlIHNlcXVlbmNlIG9mIHdpbmRvd3MuXG4gICAqL1xuICBvYnNlcnZhYmxlUHJvdG8ud2luZG93V2l0aFRpbWVPckNvdW50ID0gZnVuY3Rpb24gKHRpbWVTcGFuLCBjb3VudCwgc2NoZWR1bGVyKSB7XG4gICAgdmFyIHNvdXJjZSA9IHRoaXM7XG4gICAgaXNTY2hlZHVsZXIoc2NoZWR1bGVyKSB8fCAoc2NoZWR1bGVyID0gZGVmYXVsdFNjaGVkdWxlcik7XG4gICAgcmV0dXJuIG5ldyBBbm9ueW1vdXNPYnNlcnZhYmxlKGZ1bmN0aW9uIChvYnNlcnZlcikge1xuICAgICAgdmFyIHRpbWVyRCA9IG5ldyBTZXJpYWxEaXNwb3NhYmxlKCksXG4gICAgICAgICAgZ3JvdXBEaXNwb3NhYmxlID0gbmV3IENvbXBvc2l0ZURpc3Bvc2FibGUodGltZXJEKSxcbiAgICAgICAgICByZWZDb3VudERpc3Bvc2FibGUgPSBuZXcgUmVmQ291bnREaXNwb3NhYmxlKGdyb3VwRGlzcG9zYWJsZSksXG4gICAgICAgICAgbiA9IDAsXG4gICAgICAgICAgd2luZG93SWQgPSAwLFxuICAgICAgICAgIHMgPSBuZXcgU3ViamVjdCgpO1xuXG4gICAgICBmdW5jdGlvbiBjcmVhdGVUaW1lcihpZCkge1xuICAgICAgICB2YXIgbSA9IG5ldyBTaW5nbGVBc3NpZ25tZW50RGlzcG9zYWJsZSgpO1xuICAgICAgICB0aW1lckQuc2V0RGlzcG9zYWJsZShtKTtcbiAgICAgICAgbS5zZXREaXNwb3NhYmxlKHNjaGVkdWxlci5zY2hlZHVsZUZ1dHVyZShudWxsLCB0aW1lU3BhbiwgZnVuY3Rpb24gKCkge1xuICAgICAgICAgIGlmIChpZCAhPT0gd2luZG93SWQpIHsgcmV0dXJuOyB9XG4gICAgICAgICAgbiA9IDA7XG4gICAgICAgICAgdmFyIG5ld0lkID0gKyt3aW5kb3dJZDtcbiAgICAgICAgICBzLm9uQ29tcGxldGVkKCk7XG4gICAgICAgICAgcyA9IG5ldyBTdWJqZWN0KCk7XG4gICAgICAgICAgb2JzZXJ2ZXIub25OZXh0KGFkZFJlZihzLCByZWZDb3VudERpc3Bvc2FibGUpKTtcbiAgICAgICAgICBjcmVhdGVUaW1lcihuZXdJZCk7XG4gICAgICAgIH0pKTtcbiAgICAgIH1cblxuICAgICAgb2JzZXJ2ZXIub25OZXh0KGFkZFJlZihzLCByZWZDb3VudERpc3Bvc2FibGUpKTtcbiAgICAgIGNyZWF0ZVRpbWVyKDApO1xuXG4gICAgICBncm91cERpc3Bvc2FibGUuYWRkKHNvdXJjZS5zdWJzY3JpYmUoXG4gICAgICAgIGZ1bmN0aW9uICh4KSB7XG4gICAgICAgICAgdmFyIG5ld0lkID0gMCwgbmV3V2luZG93ID0gZmFsc2U7XG4gICAgICAgICAgcy5vbk5leHQoeCk7XG4gICAgICAgICAgaWYgKCsrbiA9PT0gY291bnQpIHtcbiAgICAgICAgICAgIG5ld1dpbmRvdyA9IHRydWU7XG4gICAgICAgICAgICBuID0gMDtcbiAgICAgICAgICAgIG5ld0lkID0gKyt3aW5kb3dJZDtcbiAgICAgICAgICAgIHMub25Db21wbGV0ZWQoKTtcbiAgICAgICAgICAgIHMgPSBuZXcgU3ViamVjdCgpO1xuICAgICAgICAgICAgb2JzZXJ2ZXIub25OZXh0KGFkZFJlZihzLCByZWZDb3VudERpc3Bvc2FibGUpKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgbmV3V2luZG93ICYmIGNyZWF0ZVRpbWVyKG5ld0lkKTtcbiAgICAgICAgfSxcbiAgICAgICAgZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgICBzLm9uRXJyb3IoZSk7XG4gICAgICAgICAgb2JzZXJ2ZXIub25FcnJvcihlKTtcbiAgICAgICAgfSwgZnVuY3Rpb24gKCkge1xuICAgICAgICAgIHMub25Db21wbGV0ZWQoKTtcbiAgICAgICAgICBvYnNlcnZlci5vbkNvbXBsZXRlZCgpO1xuICAgICAgICB9XG4gICAgICApKTtcbiAgICAgIHJldHVybiByZWZDb3VudERpc3Bvc2FibGU7XG4gICAgfSwgc291cmNlKTtcbiAgfTtcblxuICBmdW5jdGlvbiB0b0FycmF5KHgpIHsgcmV0dXJuIHgudG9BcnJheSgpOyB9XG5cbiAgLyoqXG4gICAqICBQcm9qZWN0cyBlYWNoIGVsZW1lbnQgb2YgYW4gb2JzZXJ2YWJsZSBzZXF1ZW5jZSBpbnRvIHplcm8gb3IgbW9yZSBidWZmZXJzIHdoaWNoIGFyZSBwcm9kdWNlZCBiYXNlZCBvbiB0aW1pbmcgaW5mb3JtYXRpb24uXG4gICAqIEBwYXJhbSB7TnVtYmVyfSB0aW1lU3BhbiBMZW5ndGggb2YgZWFjaCBidWZmZXIgKHNwZWNpZmllZCBhcyBhbiBpbnRlZ2VyIGRlbm90aW5nIG1pbGxpc2Vjb25kcykuXG4gICAqIEBwYXJhbSB7TWl4ZWR9IFt0aW1lU2hpZnRPclNjaGVkdWxlcl0gIEludGVydmFsIGJldHdlZW4gY3JlYXRpb24gb2YgY29uc2VjdXRpdmUgYnVmZmVycyAoc3BlY2lmaWVkIGFzIGFuIGludGVnZXIgZGVub3RpbmcgbWlsbGlzZWNvbmRzKSwgb3IgYW4gb3B0aW9uYWwgc2NoZWR1bGVyIHBhcmFtZXRlci4gSWYgbm90IHNwZWNpZmllZCwgdGhlIHRpbWUgc2hpZnQgY29ycmVzcG9uZHMgdG8gdGhlIHRpbWVTcGFuIHBhcmFtZXRlciwgcmVzdWx0aW5nIGluIG5vbi1vdmVybGFwcGluZyBhZGphY2VudCBidWZmZXJzLlxuICAgKiBAcGFyYW0ge1NjaGVkdWxlcn0gW3NjaGVkdWxlcl0gIFNjaGVkdWxlciB0byBydW4gYnVmZmVyIHRpbWVycyBvbi4gSWYgbm90IHNwZWNpZmllZCwgdGhlIHRpbWVvdXQgc2NoZWR1bGVyIGlzIHVzZWQuXG4gICAqIEByZXR1cm5zIHtPYnNlcnZhYmxlfSBBbiBvYnNlcnZhYmxlIHNlcXVlbmNlIG9mIGJ1ZmZlcnMuXG4gICAqL1xuICBvYnNlcnZhYmxlUHJvdG8uYnVmZmVyV2l0aFRpbWUgPSBmdW5jdGlvbiAodGltZVNwYW4sIHRpbWVTaGlmdE9yU2NoZWR1bGVyLCBzY2hlZHVsZXIpIHtcbiAgICByZXR1cm4gdGhpcy53aW5kb3dXaXRoVGltZSh0aW1lU3BhbiwgdGltZVNoaWZ0T3JTY2hlZHVsZXIsIHNjaGVkdWxlcikuZmxhdE1hcCh0b0FycmF5KTtcbiAgfTtcblxuICBmdW5jdGlvbiB0b0FycmF5KHgpIHsgcmV0dXJuIHgudG9BcnJheSgpOyB9XG5cbiAgLyoqXG4gICAqICBQcm9qZWN0cyBlYWNoIGVsZW1lbnQgb2YgYW4gb2JzZXJ2YWJsZSBzZXF1ZW5jZSBpbnRvIGEgYnVmZmVyIHRoYXQgaXMgY29tcGxldGVkIHdoZW4gZWl0aGVyIGl0J3MgZnVsbCBvciBhIGdpdmVuIGFtb3VudCBvZiB0aW1lIGhhcyBlbGFwc2VkLlxuICAgKiBAcGFyYW0ge051bWJlcn0gdGltZVNwYW4gTWF4aW11bSB0aW1lIGxlbmd0aCBvZiBhIGJ1ZmZlci5cbiAgICogQHBhcmFtIHtOdW1iZXJ9IGNvdW50IE1heGltdW0gZWxlbWVudCBjb3VudCBvZiBhIGJ1ZmZlci5cbiAgICogQHBhcmFtIHtTY2hlZHVsZXJ9IFtzY2hlZHVsZXJdICBTY2hlZHVsZXIgdG8gcnVuIGJ1ZmZlcmluIHRpbWVycyBvbi4gSWYgbm90IHNwZWNpZmllZCwgdGhlIHRpbWVvdXQgc2NoZWR1bGVyIGlzIHVzZWQuXG4gICAqIEByZXR1cm5zIHtPYnNlcnZhYmxlfSBBbiBvYnNlcnZhYmxlIHNlcXVlbmNlIG9mIGJ1ZmZlcnMuXG4gICAqL1xuICBvYnNlcnZhYmxlUHJvdG8uYnVmZmVyV2l0aFRpbWVPckNvdW50ID0gZnVuY3Rpb24gKHRpbWVTcGFuLCBjb3VudCwgc2NoZWR1bGVyKSB7XG4gICAgcmV0dXJuIHRoaXMud2luZG93V2l0aFRpbWVPckNvdW50KHRpbWVTcGFuLCBjb3VudCwgc2NoZWR1bGVyKS5mbGF0TWFwKHRvQXJyYXkpO1xuICB9O1xuXG4gIHZhciBUaW1lSW50ZXJ2YWxPYnNlcnZhYmxlID0gKGZ1bmN0aW9uIChfX3N1cGVyX18pIHtcbiAgICBpbmhlcml0cyhUaW1lSW50ZXJ2YWxPYnNlcnZhYmxlLCBfX3N1cGVyX18pO1xuICAgIGZ1bmN0aW9uIFRpbWVJbnRlcnZhbE9ic2VydmFibGUoc291cmNlLCBzKSB7XG4gICAgICB0aGlzLnNvdXJjZSA9IHNvdXJjZTtcbiAgICAgIHRoaXMuX3MgPSBzO1xuICAgICAgX19zdXBlcl9fLmNhbGwodGhpcyk7XG4gICAgfVxuXG4gICAgVGltZUludGVydmFsT2JzZXJ2YWJsZS5wcm90b3R5cGUuc3Vic2NyaWJlQ29yZSA9IGZ1bmN0aW9uIChvKSB7XG4gICAgICByZXR1cm4gdGhpcy5zb3VyY2Uuc3Vic2NyaWJlKG5ldyBUaW1lSW50ZXJ2YWxPYnNlcnZlcihvLCB0aGlzLl9zKSk7XG4gICAgfTtcblxuICAgIHJldHVybiBUaW1lSW50ZXJ2YWxPYnNlcnZhYmxlO1xuICB9KE9ic2VydmFibGVCYXNlKSk7XG5cbiAgdmFyIFRpbWVJbnRlcnZhbE9ic2VydmVyID0gKGZ1bmN0aW9uIChfX3N1cGVyX18pIHtcbiAgICBpbmhlcml0cyhUaW1lSW50ZXJ2YWxPYnNlcnZlciwgX19zdXBlcl9fKTtcblxuICAgIGZ1bmN0aW9uIFRpbWVJbnRlcnZhbE9ic2VydmVyKG8sIHMpIHtcbiAgICAgIHRoaXMuX28gPSBvO1xuICAgICAgdGhpcy5fcyA9IHM7XG4gICAgICB0aGlzLl9sID0gcy5ub3coKTtcbiAgICAgIF9fc3VwZXJfXy5jYWxsKHRoaXMpO1xuICAgIH1cblxuICAgIFRpbWVJbnRlcnZhbE9ic2VydmVyLnByb3RvdHlwZS5uZXh0ID0gZnVuY3Rpb24gKHgpIHtcbiAgICAgIHZhciBub3cgPSB0aGlzLl9zLm5vdygpLCBzcGFuID0gbm93IC0gdGhpcy5fbDtcbiAgICAgIHRoaXMuX2wgPSBub3c7XG4gICAgICB0aGlzLl9vLm9uTmV4dCh7IHZhbHVlOiB4LCBpbnRlcnZhbDogc3BhbiB9KTtcbiAgICB9O1xuICAgIFRpbWVJbnRlcnZhbE9ic2VydmVyLnByb3RvdHlwZS5lcnJvciA9IGZ1bmN0aW9uIChlKSB7IHRoaXMuX28ub25FcnJvcihlKTsgfTtcbiAgICBUaW1lSW50ZXJ2YWxPYnNlcnZlci5wcm90b3R5cGUuY29tcGxldGVkID0gZnVuY3Rpb24gKCkgeyB0aGlzLl9vLm9uQ29tcGxldGVkKCk7IH07XG5cbiAgICByZXR1cm4gVGltZUludGVydmFsT2JzZXJ2ZXI7XG4gIH0oQWJzdHJhY3RPYnNlcnZlcikpO1xuXG4gIC8qKlxuICAgKiAgUmVjb3JkcyB0aGUgdGltZSBpbnRlcnZhbCBiZXR3ZWVuIGNvbnNlY3V0aXZlIHZhbHVlcyBpbiBhbiBvYnNlcnZhYmxlIHNlcXVlbmNlLlxuICAgKlxuICAgKiBAZXhhbXBsZVxuICAgKiAgMSAtIHJlcyA9IHNvdXJjZS50aW1lSW50ZXJ2YWwoKTtcbiAgICogIDIgLSByZXMgPSBzb3VyY2UudGltZUludGVydmFsKFJ4LlNjaGVkdWxlci50aW1lb3V0KTtcbiAgICpcbiAgICogQHBhcmFtIFtzY2hlZHVsZXJdICBTY2hlZHVsZXIgdXNlZCB0byBjb21wdXRlIHRpbWUgaW50ZXJ2YWxzLiBJZiBub3Qgc3BlY2lmaWVkLCB0aGUgdGltZW91dCBzY2hlZHVsZXIgaXMgdXNlZC5cbiAgICogQHJldHVybnMge09ic2VydmFibGV9IEFuIG9ic2VydmFibGUgc2VxdWVuY2Ugd2l0aCB0aW1lIGludGVydmFsIGluZm9ybWF0aW9uIG9uIHZhbHVlcy5cbiAgICovXG4gIG9ic2VydmFibGVQcm90by50aW1lSW50ZXJ2YWwgPSBmdW5jdGlvbiAoc2NoZWR1bGVyKSB7XG4gICAgaXNTY2hlZHVsZXIoc2NoZWR1bGVyKSB8fCAoc2NoZWR1bGVyID0gZGVmYXVsdFNjaGVkdWxlcik7XG4gICAgcmV0dXJuIG5ldyBUaW1lSW50ZXJ2YWxPYnNlcnZhYmxlKHRoaXMsIHNjaGVkdWxlcik7XG4gIH07XG5cbiAgdmFyIFRpbWVzdGFtcE9ic2VydmFibGUgPSAoZnVuY3Rpb24gKF9fc3VwZXJfXykge1xuICAgIGluaGVyaXRzKFRpbWVzdGFtcE9ic2VydmFibGUsIF9fc3VwZXJfXyk7XG4gICAgZnVuY3Rpb24gVGltZXN0YW1wT2JzZXJ2YWJsZShzb3VyY2UsIHMpIHtcbiAgICAgIHRoaXMuc291cmNlID0gc291cmNlO1xuICAgICAgdGhpcy5fcyA9IHM7XG4gICAgICBfX3N1cGVyX18uY2FsbCh0aGlzKTtcbiAgICB9XG5cbiAgICBUaW1lc3RhbXBPYnNlcnZhYmxlLnByb3RvdHlwZS5zdWJzY3JpYmVDb3JlID0gZnVuY3Rpb24gKG8pIHtcbiAgICAgIHJldHVybiB0aGlzLnNvdXJjZS5zdWJzY3JpYmUobmV3IFRpbWVzdGFtcE9ic2VydmVyKG8sIHRoaXMuX3MpKTtcbiAgICB9O1xuXG4gICAgcmV0dXJuIFRpbWVzdGFtcE9ic2VydmFibGU7XG4gIH0oT2JzZXJ2YWJsZUJhc2UpKTtcblxuICB2YXIgVGltZXN0YW1wT2JzZXJ2ZXIgPSAoZnVuY3Rpb24gKF9fc3VwZXJfXykge1xuICAgIGluaGVyaXRzKFRpbWVzdGFtcE9ic2VydmVyLCBfX3N1cGVyX18pO1xuICAgIGZ1bmN0aW9uIFRpbWVzdGFtcE9ic2VydmVyKG8sIHMpIHtcbiAgICAgIHRoaXMuX28gPSBvO1xuICAgICAgdGhpcy5fcyA9IHM7XG4gICAgICBfX3N1cGVyX18uY2FsbCh0aGlzKTtcbiAgICB9XG5cbiAgICBUaW1lc3RhbXBPYnNlcnZlci5wcm90b3R5cGUubmV4dCA9IGZ1bmN0aW9uICh4KSB7XG4gICAgICB0aGlzLl9vLm9uTmV4dCh7IHZhbHVlOiB4LCB0aW1lc3RhbXA6IHRoaXMuX3Mubm93KCkgfSk7XG4gICAgfTtcblxuICAgIFRpbWVzdGFtcE9ic2VydmVyLnByb3RvdHlwZS5lcnJvciA9IGZ1bmN0aW9uIChlKSB7XG4gICAgICB0aGlzLl9vLm9uRXJyb3IoZSk7XG4gICAgfTtcblxuICAgIFRpbWVzdGFtcE9ic2VydmVyLnByb3RvdHlwZS5jb21wbGV0ZWQgPSBmdW5jdGlvbiAoKSB7XG4gICAgICB0aGlzLl9vLm9uQ29tcGxldGVkKCk7XG4gICAgfTtcblxuICAgIHJldHVybiBUaW1lc3RhbXBPYnNlcnZlcjtcbiAgfShBYnN0cmFjdE9ic2VydmVyKSk7XG5cbiAgLyoqXG4gICAqICBSZWNvcmRzIHRoZSB0aW1lc3RhbXAgZm9yIGVhY2ggdmFsdWUgaW4gYW4gb2JzZXJ2YWJsZSBzZXF1ZW5jZS5cbiAgICpcbiAgICogQGV4YW1wbGVcbiAgICogIDEgLSByZXMgPSBzb3VyY2UudGltZXN0YW1wKCk7IC8vIHByb2R1Y2VzIHsgdmFsdWU6IHgsIHRpbWVzdGFtcDogdHMgfVxuICAgKiAgMiAtIHJlcyA9IHNvdXJjZS50aW1lc3RhbXAoUnguU2NoZWR1bGVyLmRlZmF1bHQpO1xuICAgKlxuICAgKiBAcGFyYW0ge1NjaGVkdWxlcn0gW3NjaGVkdWxlcl0gIFNjaGVkdWxlciB1c2VkIHRvIGNvbXB1dGUgdGltZXN0YW1wcy4gSWYgbm90IHNwZWNpZmllZCwgdGhlIGRlZmF1bHQgc2NoZWR1bGVyIGlzIHVzZWQuXG4gICAqIEByZXR1cm5zIHtPYnNlcnZhYmxlfSBBbiBvYnNlcnZhYmxlIHNlcXVlbmNlIHdpdGggdGltZXN0YW1wIGluZm9ybWF0aW9uIG9uIHZhbHVlcy5cbiAgICovXG4gIG9ic2VydmFibGVQcm90by50aW1lc3RhbXAgPSBmdW5jdGlvbiAoc2NoZWR1bGVyKSB7XG4gICAgaXNTY2hlZHVsZXIoc2NoZWR1bGVyKSB8fCAoc2NoZWR1bGVyID0gZGVmYXVsdFNjaGVkdWxlcik7XG4gICAgcmV0dXJuIG5ldyBUaW1lc3RhbXBPYnNlcnZhYmxlKHRoaXMsIHNjaGVkdWxlcik7XG4gIH07XG5cbiAgZnVuY3Rpb24gc2FtcGxlT2JzZXJ2YWJsZShzb3VyY2UsIHNhbXBsZXIpIHtcbiAgICByZXR1cm4gbmV3IEFub255bW91c09ic2VydmFibGUoZnVuY3Rpb24gKG8pIHtcbiAgICAgIHZhciBhdEVuZCA9IGZhbHNlLCB2YWx1ZSwgaGFzVmFsdWUgPSBmYWxzZTtcblxuICAgICAgZnVuY3Rpb24gc2FtcGxlU3Vic2NyaWJlKCkge1xuICAgICAgICBpZiAoaGFzVmFsdWUpIHtcbiAgICAgICAgICBoYXNWYWx1ZSA9IGZhbHNlO1xuICAgICAgICAgIG8ub25OZXh0KHZhbHVlKTtcbiAgICAgICAgfVxuICAgICAgICBhdEVuZCAmJiBvLm9uQ29tcGxldGVkKCk7XG4gICAgICB9XG5cbiAgICAgIHZhciBzb3VyY2VTdWJzY3JpcHRpb24gPSBuZXcgU2luZ2xlQXNzaWdubWVudERpc3Bvc2FibGUoKTtcbiAgICAgIHNvdXJjZVN1YnNjcmlwdGlvbi5zZXREaXNwb3NhYmxlKHNvdXJjZS5zdWJzY3JpYmUoXG4gICAgICAgIGZ1bmN0aW9uIChuZXdWYWx1ZSkge1xuICAgICAgICAgIGhhc1ZhbHVlID0gdHJ1ZTtcbiAgICAgICAgICB2YWx1ZSA9IG5ld1ZhbHVlO1xuICAgICAgICB9LFxuICAgICAgICBmdW5jdGlvbiAoZSkgeyBvLm9uRXJyb3IoZSk7IH0sXG4gICAgICAgIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICBhdEVuZCA9IHRydWU7XG4gICAgICAgICAgc291cmNlU3Vic2NyaXB0aW9uLmRpc3Bvc2UoKTtcbiAgICAgICAgfVxuICAgICAgKSk7XG5cbiAgICAgIHJldHVybiBuZXcgQmluYXJ5RGlzcG9zYWJsZShcbiAgICAgICAgc291cmNlU3Vic2NyaXB0aW9uLFxuICAgICAgICBzYW1wbGVyLnN1YnNjcmliZShzYW1wbGVTdWJzY3JpYmUsIGZ1bmN0aW9uIChlKSB7IG8ub25FcnJvcihlKTsgfSwgc2FtcGxlU3Vic2NyaWJlKVxuICAgICAgKTtcbiAgICB9LCBzb3VyY2UpO1xuICB9XG5cbiAgLyoqXG4gICAqICBTYW1wbGVzIHRoZSBvYnNlcnZhYmxlIHNlcXVlbmNlIGF0IGVhY2ggaW50ZXJ2YWwuXG4gICAqXG4gICAqIEBleGFtcGxlXG4gICAqICAxIC0gcmVzID0gc291cmNlLnNhbXBsZShzYW1wbGVPYnNlcnZhYmxlKTsgLy8gU2FtcGxlciB0aWNrIHNlcXVlbmNlXG4gICAqICAyIC0gcmVzID0gc291cmNlLnNhbXBsZSg1MDAwKTsgLy8gNSBzZWNvbmRzXG4gICAqICAyIC0gcmVzID0gc291cmNlLnNhbXBsZSg1MDAwLCBSeC5TY2hlZHVsZXIudGltZW91dCk7IC8vIDUgc2Vjb25kc1xuICAgKlxuICAgKiBAcGFyYW0ge01peGVkfSBpbnRlcnZhbE9yU2FtcGxlciBJbnRlcnZhbCBhdCB3aGljaCB0byBzYW1wbGUgKHNwZWNpZmllZCBhcyBhbiBpbnRlZ2VyIGRlbm90aW5nIG1pbGxpc2Vjb25kcykgb3IgU2FtcGxlciBPYnNlcnZhYmxlLlxuICAgKiBAcGFyYW0ge1NjaGVkdWxlcn0gW3NjaGVkdWxlcl0gIFNjaGVkdWxlciB0byBydW4gdGhlIHNhbXBsaW5nIHRpbWVyIG9uLiBJZiBub3Qgc3BlY2lmaWVkLCB0aGUgdGltZW91dCBzY2hlZHVsZXIgaXMgdXNlZC5cbiAgICogQHJldHVybnMge09ic2VydmFibGV9IFNhbXBsZWQgb2JzZXJ2YWJsZSBzZXF1ZW5jZS5cbiAgICovXG4gIG9ic2VydmFibGVQcm90by5zYW1wbGUgPSBvYnNlcnZhYmxlUHJvdG8udGhyb3R0bGVMYXRlc3QgPSBmdW5jdGlvbiAoaW50ZXJ2YWxPclNhbXBsZXIsIHNjaGVkdWxlcikge1xuICAgIGlzU2NoZWR1bGVyKHNjaGVkdWxlcikgfHwgKHNjaGVkdWxlciA9IGRlZmF1bHRTY2hlZHVsZXIpO1xuICAgIHJldHVybiB0eXBlb2YgaW50ZXJ2YWxPclNhbXBsZXIgPT09ICdudW1iZXInID9cbiAgICAgIHNhbXBsZU9ic2VydmFibGUodGhpcywgb2JzZXJ2YWJsZWludGVydmFsKGludGVydmFsT3JTYW1wbGVyLCBzY2hlZHVsZXIpKSA6XG4gICAgICBzYW1wbGVPYnNlcnZhYmxlKHRoaXMsIGludGVydmFsT3JTYW1wbGVyKTtcbiAgfTtcblxuICB2YXIgVGltZW91dEVycm9yID0gUnguVGltZW91dEVycm9yID0gZnVuY3Rpb24obWVzc2FnZSkge1xuICAgIHRoaXMubWVzc2FnZSA9IG1lc3NhZ2UgfHwgJ1RpbWVvdXQgaGFzIG9jY3VycmVkJztcbiAgICB0aGlzLm5hbWUgPSAnVGltZW91dEVycm9yJztcbiAgICBFcnJvci5jYWxsKHRoaXMpO1xuICB9O1xuICBUaW1lb3V0RXJyb3IucHJvdG90eXBlID0gT2JqZWN0LmNyZWF0ZShFcnJvci5wcm90b3R5cGUpO1xuXG4gIGZ1bmN0aW9uIHRpbWVvdXRXaXRoU2VsZWN0b3Ioc291cmNlLCBmaXJzdFRpbWVvdXQsIHRpbWVvdXREdXJhdGlvblNlbGVjdG9yLCBvdGhlcikge1xuICAgIGlmIChpc0Z1bmN0aW9uKGZpcnN0VGltZW91dCkpIHtcbiAgICAgIG90aGVyID0gdGltZW91dER1cmF0aW9uU2VsZWN0b3I7XG4gICAgICB0aW1lb3V0RHVyYXRpb25TZWxlY3RvciA9IGZpcnN0VGltZW91dDtcbiAgICAgIGZpcnN0VGltZW91dCA9IG9ic2VydmFibGVOZXZlcigpO1xuICAgIH1cbiAgICBvdGhlciB8fCAob3RoZXIgPSBvYnNlcnZhYmxlVGhyb3cobmV3IFRpbWVvdXRFcnJvcigpKSk7XG4gICAgcmV0dXJuIG5ldyBBbm9ueW1vdXNPYnNlcnZhYmxlKGZ1bmN0aW9uIChvKSB7XG4gICAgICB2YXIgc3Vic2NyaXB0aW9uID0gbmV3IFNlcmlhbERpc3Bvc2FibGUoKSxcbiAgICAgICAgdGltZXIgPSBuZXcgU2VyaWFsRGlzcG9zYWJsZSgpLFxuICAgICAgICBvcmlnaW5hbCA9IG5ldyBTaW5nbGVBc3NpZ25tZW50RGlzcG9zYWJsZSgpO1xuXG4gICAgICBzdWJzY3JpcHRpb24uc2V0RGlzcG9zYWJsZShvcmlnaW5hbCk7XG5cbiAgICAgIHZhciBpZCA9IDAsIHN3aXRjaGVkID0gZmFsc2U7XG5cbiAgICAgIGZ1bmN0aW9uIHNldFRpbWVyKHRpbWVvdXQpIHtcbiAgICAgICAgdmFyIG15SWQgPSBpZCwgZCA9IG5ldyBTaW5nbGVBc3NpZ25tZW50RGlzcG9zYWJsZSgpO1xuXG4gICAgICAgIGZ1bmN0aW9uIHRpbWVyV2lucygpIHtcbiAgICAgICAgICBzd2l0Y2hlZCA9IChteUlkID09PSBpZCk7XG4gICAgICAgICAgcmV0dXJuIHN3aXRjaGVkO1xuICAgICAgICB9XG5cbiAgICAgICAgdGltZXIuc2V0RGlzcG9zYWJsZShkKTtcbiAgICAgICAgZC5zZXREaXNwb3NhYmxlKHRpbWVvdXQuc3Vic2NyaWJlKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICB0aW1lcldpbnMoKSAmJiBzdWJzY3JpcHRpb24uc2V0RGlzcG9zYWJsZShvdGhlci5zdWJzY3JpYmUobykpO1xuICAgICAgICAgIGQuZGlzcG9zZSgpO1xuICAgICAgICB9LCBmdW5jdGlvbiAoZSkge1xuICAgICAgICAgIHRpbWVyV2lucygpICYmIG8ub25FcnJvcihlKTtcbiAgICAgICAgfSwgZnVuY3Rpb24gKCkge1xuICAgICAgICAgIHRpbWVyV2lucygpICYmIHN1YnNjcmlwdGlvbi5zZXREaXNwb3NhYmxlKG90aGVyLnN1YnNjcmliZShvKSk7XG4gICAgICAgIH0pKTtcbiAgICAgIH07XG5cbiAgICAgIHNldFRpbWVyKGZpcnN0VGltZW91dCk7XG5cbiAgICAgIGZ1bmN0aW9uIG9XaW5zKCkge1xuICAgICAgICB2YXIgcmVzID0gIXN3aXRjaGVkO1xuICAgICAgICBpZiAocmVzKSB7IGlkKys7IH1cbiAgICAgICAgcmV0dXJuIHJlcztcbiAgICAgIH1cblxuICAgICAgb3JpZ2luYWwuc2V0RGlzcG9zYWJsZShzb3VyY2Uuc3Vic2NyaWJlKGZ1bmN0aW9uICh4KSB7XG4gICAgICAgIGlmIChvV2lucygpKSB7XG4gICAgICAgICAgby5vbk5leHQoeCk7XG4gICAgICAgICAgdmFyIHRpbWVvdXQgPSB0cnlDYXRjaCh0aW1lb3V0RHVyYXRpb25TZWxlY3RvcikoeCk7XG4gICAgICAgICAgaWYgKHRpbWVvdXQgPT09IGVycm9yT2JqKSB7IHJldHVybiBvLm9uRXJyb3IodGltZW91dC5lKTsgfVxuICAgICAgICAgIHNldFRpbWVyKGlzUHJvbWlzZSh0aW1lb3V0KSA/IG9ic2VydmFibGVGcm9tUHJvbWlzZSh0aW1lb3V0KSA6IHRpbWVvdXQpO1xuICAgICAgICB9XG4gICAgICB9LCBmdW5jdGlvbiAoZSkge1xuICAgICAgICBvV2lucygpICYmIG8ub25FcnJvcihlKTtcbiAgICAgIH0sIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgb1dpbnMoKSAmJiBvLm9uQ29tcGxldGVkKCk7XG4gICAgICB9KSk7XG4gICAgICByZXR1cm4gbmV3IEJpbmFyeURpc3Bvc2FibGUoc3Vic2NyaXB0aW9uLCB0aW1lcik7XG4gICAgfSwgc291cmNlKTtcbiAgfVxuXG4gIGZ1bmN0aW9uIHRpbWVvdXQoc291cmNlLCBkdWVUaW1lLCBvdGhlciwgc2NoZWR1bGVyKSB7XG4gICAgaWYgKGlzU2NoZWR1bGVyKG90aGVyKSkge1xuICAgICAgc2NoZWR1bGVyID0gb3RoZXI7XG4gICAgICBvdGhlciA9IG9ic2VydmFibGVUaHJvdyhuZXcgVGltZW91dEVycm9yKCkpO1xuICAgIH1cbiAgICBpZiAob3RoZXIgaW5zdGFuY2VvZiBFcnJvcikgeyBvdGhlciA9IG9ic2VydmFibGVUaHJvdyhvdGhlcik7IH1cbiAgICBpc1NjaGVkdWxlcihzY2hlZHVsZXIpIHx8IChzY2hlZHVsZXIgPSBkZWZhdWx0U2NoZWR1bGVyKTtcblxuICAgIHJldHVybiBuZXcgQW5vbnltb3VzT2JzZXJ2YWJsZShmdW5jdGlvbiAobykge1xuICAgICAgdmFyIGlkID0gMCxcbiAgICAgICAgb3JpZ2luYWwgPSBuZXcgU2luZ2xlQXNzaWdubWVudERpc3Bvc2FibGUoKSxcbiAgICAgICAgc3Vic2NyaXB0aW9uID0gbmV3IFNlcmlhbERpc3Bvc2FibGUoKSxcbiAgICAgICAgc3dpdGNoZWQgPSBmYWxzZSxcbiAgICAgICAgdGltZXIgPSBuZXcgU2VyaWFsRGlzcG9zYWJsZSgpO1xuXG4gICAgICBzdWJzY3JpcHRpb24uc2V0RGlzcG9zYWJsZShvcmlnaW5hbCk7XG5cbiAgICAgIGZ1bmN0aW9uIGNyZWF0ZVRpbWVyKCkge1xuICAgICAgICB2YXIgbXlJZCA9IGlkO1xuICAgICAgICB0aW1lci5zZXREaXNwb3NhYmxlKHNjaGVkdWxlci5zY2hlZHVsZUZ1dHVyZShudWxsLCBkdWVUaW1lLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgc3dpdGNoZWQgPSBpZCA9PT0gbXlJZDtcbiAgICAgICAgICBpZiAoc3dpdGNoZWQpIHtcbiAgICAgICAgICAgIGlzUHJvbWlzZShvdGhlcikgJiYgKG90aGVyID0gb2JzZXJ2YWJsZUZyb21Qcm9taXNlKG90aGVyKSk7XG4gICAgICAgICAgICBzdWJzY3JpcHRpb24uc2V0RGlzcG9zYWJsZShvdGhlci5zdWJzY3JpYmUobykpO1xuICAgICAgICAgIH1cbiAgICAgICAgfSkpO1xuICAgICAgfVxuXG4gICAgICBjcmVhdGVUaW1lcigpO1xuXG4gICAgICBvcmlnaW5hbC5zZXREaXNwb3NhYmxlKHNvdXJjZS5zdWJzY3JpYmUoZnVuY3Rpb24gKHgpIHtcbiAgICAgICAgaWYgKCFzd2l0Y2hlZCkge1xuICAgICAgICAgIGlkKys7XG4gICAgICAgICAgby5vbk5leHQoeCk7XG4gICAgICAgICAgY3JlYXRlVGltZXIoKTtcbiAgICAgICAgfVxuICAgICAgfSwgZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgaWYgKCFzd2l0Y2hlZCkge1xuICAgICAgICAgIGlkKys7XG4gICAgICAgICAgby5vbkVycm9yKGUpO1xuICAgICAgICB9XG4gICAgICB9LCBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGlmICghc3dpdGNoZWQpIHtcbiAgICAgICAgICBpZCsrO1xuICAgICAgICAgIG8ub25Db21wbGV0ZWQoKTtcbiAgICAgICAgfVxuICAgICAgfSkpO1xuICAgICAgcmV0dXJuIG5ldyBCaW5hcnlEaXNwb3NhYmxlKHN1YnNjcmlwdGlvbiwgdGltZXIpO1xuICAgIH0sIHNvdXJjZSk7XG4gIH1cblxuICBvYnNlcnZhYmxlUHJvdG8udGltZW91dCA9IGZ1bmN0aW9uICgpIHtcbiAgICB2YXIgZmlyc3RBcmcgPSBhcmd1bWVudHNbMF07XG4gICAgaWYgKGZpcnN0QXJnIGluc3RhbmNlb2YgRGF0ZSB8fCB0eXBlb2YgZmlyc3RBcmcgPT09ICdudW1iZXInKSB7XG4gICAgICByZXR1cm4gdGltZW91dCh0aGlzLCBmaXJzdEFyZywgYXJndW1lbnRzWzFdLCBhcmd1bWVudHNbMl0pO1xuICAgIH0gZWxzZSBpZiAoT2JzZXJ2YWJsZS5pc09ic2VydmFibGUoZmlyc3RBcmcpIHx8IGlzRnVuY3Rpb24oZmlyc3RBcmcpKSB7XG4gICAgICByZXR1cm4gdGltZW91dFdpdGhTZWxlY3Rvcih0aGlzLCBmaXJzdEFyZywgYXJndW1lbnRzWzFdLCBhcmd1bWVudHNbMl0pO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ0ludmFsaWQgYXJndW1lbnRzJyk7XG4gICAgfVxuICB9O1xuXG4gIHZhciBHZW5lcmF0ZUFic29sdXRlT2JzZXJ2YWJsZSA9IChmdW5jdGlvbiAoX19zdXBlcl9fKSB7XG4gICAgaW5oZXJpdHMoR2VuZXJhdGVBYnNvbHV0ZU9ic2VydmFibGUsIF9fc3VwZXJfXyk7XG4gICAgZnVuY3Rpb24gR2VuZXJhdGVBYnNvbHV0ZU9ic2VydmFibGUoc3RhdGUsIGNuZEZuLCBpdHJGbiwgcmVzRm4sIHRpbWVGbiwgcykge1xuICAgICAgdGhpcy5fc3RhdGUgPSBzdGF0ZTtcbiAgICAgIHRoaXMuX2NuZEZuID0gY25kRm47XG4gICAgICB0aGlzLl9pdHJGbiA9IGl0ckZuO1xuICAgICAgdGhpcy5fcmVzRm4gPSByZXNGbjtcbiAgICAgIHRoaXMuX3RpbWVGbiA9IHRpbWVGbjtcbiAgICAgIHRoaXMuX3MgPSBzO1xuICAgICAgdGhpcy5fZmlyc3QgPSB0cnVlO1xuICAgICAgdGhpcy5faGFzUmVzdWx0ID0gZmFsc2U7XG4gICAgICBfX3N1cGVyX18uY2FsbCh0aGlzKTtcbiAgICB9XG5cbiAgICBmdW5jdGlvbiBzY2hlZHVsZVJlY3Vyc2l2ZShzZWxmLCByZWN1cnNlKSB7XG4gICAgICBzZWxmLl9oYXNSZXN1bHQgJiYgc2VsZi5fby5vbk5leHQoc2VsZi5fc3RhdGUpO1xuXG4gICAgICBpZiAoc2VsZi5fZmlyc3QpIHtcbiAgICAgICAgc2VsZi5fZmlyc3QgPSBmYWxzZTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHNlbGYuX3N0YXRlID0gdHJ5Q2F0Y2goc2VsZi5faXRyRm4pKHNlbGYuX3N0YXRlKTtcbiAgICAgICAgaWYgKHNlbGYuX3N0YXRlID09PSBlcnJvck9iaikgeyByZXR1cm4gc2VsZi5fby5vbkVycm9yKHNlbGYuX3N0YXRlLmUpOyB9XG4gICAgICB9XG4gICAgICBzZWxmLl9oYXNSZXN1bHQgPSB0cnlDYXRjaChzZWxmLl9jbmRGbikoc2VsZi5fc3RhdGUpO1xuICAgICAgaWYgKHNlbGYuX2hhc1Jlc3VsdCA9PT0gZXJyb3JPYmopIHsgcmV0dXJuIHNlbGYuX28ub25FcnJvcihzZWxmLl9oYXNSZXN1bHQuZSk7IH1cbiAgICAgIGlmIChzZWxmLl9oYXNSZXN1bHQpIHtcbiAgICAgICAgdmFyIHJlc3VsdCA9IHRyeUNhdGNoKHNlbGYuX3Jlc0ZuKShzZWxmLl9zdGF0ZSk7XG4gICAgICAgIGlmIChyZXN1bHQgPT09IGVycm9yT2JqKSB7IHJldHVybiBzZWxmLl9vLm9uRXJyb3IocmVzdWx0LmUpOyB9XG4gICAgICAgIHZhciB0aW1lID0gdHJ5Q2F0Y2goc2VsZi5fdGltZUZuKShzZWxmLl9zdGF0ZSk7XG4gICAgICAgIGlmICh0aW1lID09PSBlcnJvck9iaikgeyByZXR1cm4gc2VsZi5fby5vbkVycm9yKHRpbWUuZSk7IH1cbiAgICAgICAgcmVjdXJzZShzZWxmLCB0aW1lKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHNlbGYuX28ub25Db21wbGV0ZWQoKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICBHZW5lcmF0ZUFic29sdXRlT2JzZXJ2YWJsZS5wcm90b3R5cGUuc3Vic2NyaWJlQ29yZSA9IGZ1bmN0aW9uIChvKSB7XG4gICAgICB0aGlzLl9vID0gbztcbiAgICAgIHJldHVybiB0aGlzLl9zLnNjaGVkdWxlUmVjdXJzaXZlRnV0dXJlKHRoaXMsIG5ldyBEYXRlKHRoaXMuX3Mubm93KCkpLCBzY2hlZHVsZVJlY3Vyc2l2ZSk7XG4gICAgfTtcblxuICAgIHJldHVybiBHZW5lcmF0ZUFic29sdXRlT2JzZXJ2YWJsZTtcbiAgfShPYnNlcnZhYmxlQmFzZSkpO1xuXG4gIC8qKlxuICAgKiAgR2VuZXJhdGVBYnNvbHV0ZXMgYW4gb2JzZXJ2YWJsZSBzZXF1ZW5jZSBieSBpdGVyYXRpbmcgYSBzdGF0ZSBmcm9tIGFuIGluaXRpYWwgc3RhdGUgdW50aWwgdGhlIGNvbmRpdGlvbiBmYWlscy5cbiAgICpcbiAgICogQGV4YW1wbGVcbiAgICogIHJlcyA9IHNvdXJjZS5nZW5lcmF0ZVdpdGhBYnNvbHV0ZVRpbWUoMCxcbiAgICogICAgICBmdW5jdGlvbiAoeCkgeyByZXR1cm4gcmV0dXJuIHRydWU7IH0sXG4gICAqICAgICAgZnVuY3Rpb24gKHgpIHsgcmV0dXJuIHggKyAxOyB9LFxuICAgKiAgICAgIGZ1bmN0aW9uICh4KSB7IHJldHVybiB4OyB9LFxuICAgKiAgICAgIGZ1bmN0aW9uICh4KSB7IHJldHVybiBuZXcgRGF0ZSgpOyB9XG4gICAqICB9KTtcbiAgICpcbiAgICogQHBhcmFtIHtNaXhlZH0gaW5pdGlhbFN0YXRlIEluaXRpYWwgc3RhdGUuXG4gICAqIEBwYXJhbSB7RnVuY3Rpb259IGNvbmRpdGlvbiBDb25kaXRpb24gdG8gdGVybWluYXRlIGdlbmVyYXRpb24gKHVwb24gcmV0dXJuaW5nIGZhbHNlKS5cbiAgICogQHBhcmFtIHtGdW5jdGlvbn0gaXRlcmF0ZSBJdGVyYXRpb24gc3RlcCBmdW5jdGlvbi5cbiAgICogQHBhcmFtIHtGdW5jdGlvbn0gcmVzdWx0U2VsZWN0b3IgU2VsZWN0b3IgZnVuY3Rpb24gZm9yIHJlc3VsdHMgcHJvZHVjZWQgaW4gdGhlIHNlcXVlbmNlLlxuICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSB0aW1lU2VsZWN0b3IgVGltZSBzZWxlY3RvciBmdW5jdGlvbiB0byBjb250cm9sIHRoZSBzcGVlZCBvZiB2YWx1ZXMgYmVpbmcgcHJvZHVjZWQgZWFjaCBpdGVyYXRpb24sIHJldHVybmluZyBEYXRlIHZhbHVlcy5cbiAgICogQHBhcmFtIHtTY2hlZHVsZXJ9IFtzY2hlZHVsZXJdICBTY2hlZHVsZXIgb24gd2hpY2ggdG8gcnVuIHRoZSBnZW5lcmF0b3IgbG9vcC4gSWYgbm90IHNwZWNpZmllZCwgdGhlIHRpbWVvdXQgc2NoZWR1bGVyIGlzIHVzZWQuXG4gICAqIEByZXR1cm5zIHtPYnNlcnZhYmxlfSBUaGUgZ2VuZXJhdGVkIHNlcXVlbmNlLlxuICAgKi9cbiAgT2JzZXJ2YWJsZS5nZW5lcmF0ZVdpdGhBYnNvbHV0ZVRpbWUgPSBmdW5jdGlvbiAoaW5pdGlhbFN0YXRlLCBjb25kaXRpb24sIGl0ZXJhdGUsIHJlc3VsdFNlbGVjdG9yLCB0aW1lU2VsZWN0b3IsIHNjaGVkdWxlcikge1xuICAgIGlzU2NoZWR1bGVyKHNjaGVkdWxlcikgfHwgKHNjaGVkdWxlciA9IGRlZmF1bHRTY2hlZHVsZXIpO1xuICAgIHJldHVybiBuZXcgR2VuZXJhdGVBYnNvbHV0ZU9ic2VydmFibGUoaW5pdGlhbFN0YXRlLCBjb25kaXRpb24sIGl0ZXJhdGUsIHJlc3VsdFNlbGVjdG9yLCB0aW1lU2VsZWN0b3IsIHNjaGVkdWxlcik7XG4gIH07XG5cbiAgdmFyIEdlbmVyYXRlUmVsYXRpdmVPYnNlcnZhYmxlID0gKGZ1bmN0aW9uIChfX3N1cGVyX18pIHtcbiAgICBpbmhlcml0cyhHZW5lcmF0ZVJlbGF0aXZlT2JzZXJ2YWJsZSwgX19zdXBlcl9fKTtcbiAgICBmdW5jdGlvbiBHZW5lcmF0ZVJlbGF0aXZlT2JzZXJ2YWJsZShzdGF0ZSwgY25kRm4sIGl0ckZuLCByZXNGbiwgdGltZUZuLCBzKSB7XG4gICAgICB0aGlzLl9zdGF0ZSA9IHN0YXRlO1xuICAgICAgdGhpcy5fY25kRm4gPSBjbmRGbjtcbiAgICAgIHRoaXMuX2l0ckZuID0gaXRyRm47XG4gICAgICB0aGlzLl9yZXNGbiA9IHJlc0ZuO1xuICAgICAgdGhpcy5fdGltZUZuID0gdGltZUZuO1xuICAgICAgdGhpcy5fcyA9IHM7XG4gICAgICB0aGlzLl9maXJzdCA9IHRydWU7XG4gICAgICB0aGlzLl9oYXNSZXN1bHQgPSBmYWxzZTtcbiAgICAgIF9fc3VwZXJfXy5jYWxsKHRoaXMpO1xuICAgIH1cblxuICAgIGZ1bmN0aW9uIHNjaGVkdWxlUmVjdXJzaXZlKHNlbGYsIHJlY3Vyc2UpIHtcbiAgICAgIHNlbGYuX2hhc1Jlc3VsdCAmJiBzZWxmLl9vLm9uTmV4dChzZWxmLl9zdGF0ZSk7XG5cbiAgICAgIGlmIChzZWxmLl9maXJzdCkge1xuICAgICAgICBzZWxmLl9maXJzdCA9IGZhbHNlO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgc2VsZi5fc3RhdGUgPSB0cnlDYXRjaChzZWxmLl9pdHJGbikoc2VsZi5fc3RhdGUpO1xuICAgICAgICBpZiAoc2VsZi5fc3RhdGUgPT09IGVycm9yT2JqKSB7IHJldHVybiBzZWxmLl9vLm9uRXJyb3Ioc2VsZi5fc3RhdGUuZSk7IH1cbiAgICAgIH1cbiAgICAgIHNlbGYuX2hhc1Jlc3VsdCA9IHRyeUNhdGNoKHNlbGYuX2NuZEZuKShzZWxmLl9zdGF0ZSk7XG4gICAgICBpZiAoc2VsZi5faGFzUmVzdWx0ID09PSBlcnJvck9iaikgeyByZXR1cm4gc2VsZi5fby5vbkVycm9yKHNlbGYuX2hhc1Jlc3VsdC5lKTsgfVxuICAgICAgaWYgKHNlbGYuX2hhc1Jlc3VsdCkge1xuICAgICAgICB2YXIgcmVzdWx0ID0gdHJ5Q2F0Y2goc2VsZi5fcmVzRm4pKHNlbGYuX3N0YXRlKTtcbiAgICAgICAgaWYgKHJlc3VsdCA9PT0gZXJyb3JPYmopIHsgcmV0dXJuIHNlbGYuX28ub25FcnJvcihyZXN1bHQuZSk7IH1cbiAgICAgICAgdmFyIHRpbWUgPSB0cnlDYXRjaChzZWxmLl90aW1lRm4pKHNlbGYuX3N0YXRlKTtcbiAgICAgICAgaWYgKHRpbWUgPT09IGVycm9yT2JqKSB7IHJldHVybiBzZWxmLl9vLm9uRXJyb3IodGltZS5lKTsgfVxuICAgICAgICByZWN1cnNlKHNlbGYsIHRpbWUpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgc2VsZi5fby5vbkNvbXBsZXRlZCgpO1xuICAgICAgfVxuICAgIH1cblxuICAgIEdlbmVyYXRlUmVsYXRpdmVPYnNlcnZhYmxlLnByb3RvdHlwZS5zdWJzY3JpYmVDb3JlID0gZnVuY3Rpb24gKG8pIHtcbiAgICAgIHRoaXMuX28gPSBvO1xuICAgICAgcmV0dXJuIHRoaXMuX3Muc2NoZWR1bGVSZWN1cnNpdmVGdXR1cmUodGhpcywgMCwgc2NoZWR1bGVSZWN1cnNpdmUpO1xuICAgIH07XG5cbiAgICByZXR1cm4gR2VuZXJhdGVSZWxhdGl2ZU9ic2VydmFibGU7XG4gIH0oT2JzZXJ2YWJsZUJhc2UpKTtcblxuICAvKipcbiAgICogIEdlbmVyYXRlcyBhbiBvYnNlcnZhYmxlIHNlcXVlbmNlIGJ5IGl0ZXJhdGluZyBhIHN0YXRlIGZyb20gYW4gaW5pdGlhbCBzdGF0ZSB1bnRpbCB0aGUgY29uZGl0aW9uIGZhaWxzLlxuICAgKlxuICAgKiBAZXhhbXBsZVxuICAgKiAgcmVzID0gc291cmNlLmdlbmVyYXRlV2l0aFJlbGF0aXZlVGltZSgwLFxuICAgKiAgICAgIGZ1bmN0aW9uICh4KSB7IHJldHVybiByZXR1cm4gdHJ1ZTsgfSxcbiAgICogICAgICBmdW5jdGlvbiAoeCkgeyByZXR1cm4geCArIDE7IH0sXG4gICAqICAgICAgZnVuY3Rpb24gKHgpIHsgcmV0dXJuIHg7IH0sXG4gICAqICAgICAgZnVuY3Rpb24gKHgpIHsgcmV0dXJuIDUwMDsgfVxuICAgKiAgKTtcbiAgICpcbiAgICogQHBhcmFtIHtNaXhlZH0gaW5pdGlhbFN0YXRlIEluaXRpYWwgc3RhdGUuXG4gICAqIEBwYXJhbSB7RnVuY3Rpb259IGNvbmRpdGlvbiBDb25kaXRpb24gdG8gdGVybWluYXRlIGdlbmVyYXRpb24gKHVwb24gcmV0dXJuaW5nIGZhbHNlKS5cbiAgICogQHBhcmFtIHtGdW5jdGlvbn0gaXRlcmF0ZSBJdGVyYXRpb24gc3RlcCBmdW5jdGlvbi5cbiAgICogQHBhcmFtIHtGdW5jdGlvbn0gcmVzdWx0U2VsZWN0b3IgU2VsZWN0b3IgZnVuY3Rpb24gZm9yIHJlc3VsdHMgcHJvZHVjZWQgaW4gdGhlIHNlcXVlbmNlLlxuICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSB0aW1lU2VsZWN0b3IgVGltZSBzZWxlY3RvciBmdW5jdGlvbiB0byBjb250cm9sIHRoZSBzcGVlZCBvZiB2YWx1ZXMgYmVpbmcgcHJvZHVjZWQgZWFjaCBpdGVyYXRpb24sIHJldHVybmluZyBpbnRlZ2VyIHZhbHVlcyBkZW5vdGluZyBtaWxsaXNlY29uZHMuXG4gICAqIEBwYXJhbSB7U2NoZWR1bGVyfSBbc2NoZWR1bGVyXSAgU2NoZWR1bGVyIG9uIHdoaWNoIHRvIHJ1biB0aGUgZ2VuZXJhdG9yIGxvb3AuIElmIG5vdCBzcGVjaWZpZWQsIHRoZSB0aW1lb3V0IHNjaGVkdWxlciBpcyB1c2VkLlxuICAgKiBAcmV0dXJucyB7T2JzZXJ2YWJsZX0gVGhlIGdlbmVyYXRlZCBzZXF1ZW5jZS5cbiAgICovXG4gIE9ic2VydmFibGUuZ2VuZXJhdGVXaXRoUmVsYXRpdmVUaW1lID0gZnVuY3Rpb24gKGluaXRpYWxTdGF0ZSwgY29uZGl0aW9uLCBpdGVyYXRlLCByZXN1bHRTZWxlY3RvciwgdGltZVNlbGVjdG9yLCBzY2hlZHVsZXIpIHtcbiAgICBpc1NjaGVkdWxlcihzY2hlZHVsZXIpIHx8IChzY2hlZHVsZXIgPSBkZWZhdWx0U2NoZWR1bGVyKTtcbiAgICByZXR1cm4gbmV3IEdlbmVyYXRlUmVsYXRpdmVPYnNlcnZhYmxlKGluaXRpYWxTdGF0ZSwgY29uZGl0aW9uLCBpdGVyYXRlLCByZXN1bHRTZWxlY3RvciwgdGltZVNlbGVjdG9yLCBzY2hlZHVsZXIpO1xuICB9O1xuXG4gIHZhciBEZWxheVN1YnNjcmlwdGlvbiA9IChmdW5jdGlvbihfX3N1cGVyX18pIHtcbiAgICBpbmhlcml0cyhEZWxheVN1YnNjcmlwdGlvbiwgX19zdXBlcl9fKTtcbiAgICBmdW5jdGlvbiBEZWxheVN1YnNjcmlwdGlvbihzb3VyY2UsIGR0LCBzKSB7XG4gICAgICB0aGlzLnNvdXJjZSA9IHNvdXJjZTtcbiAgICAgIHRoaXMuX2R0ID0gZHQ7XG4gICAgICB0aGlzLl9zID0gcztcbiAgICAgIF9fc3VwZXJfXy5jYWxsKHRoaXMpO1xuICAgIH1cblxuICAgIERlbGF5U3Vic2NyaXB0aW9uLnByb3RvdHlwZS5zdWJzY3JpYmVDb3JlID0gZnVuY3Rpb24gKG8pIHtcbiAgICAgIHZhciBkID0gbmV3IFNlcmlhbERpc3Bvc2FibGUoKTtcblxuICAgICAgZC5zZXREaXNwb3NhYmxlKHRoaXMuX3Muc2NoZWR1bGVGdXR1cmUoW3RoaXMuc291cmNlLCBvLCBkXSwgdGhpcy5fZHQsIHNjaGVkdWxlTWV0aG9kKSk7XG5cbiAgICAgIHJldHVybiBkO1xuICAgIH07XG5cbiAgICBmdW5jdGlvbiBzY2hlZHVsZU1ldGhvZChzLCBzdGF0ZSkge1xuICAgICAgdmFyIHNvdXJjZSA9IHN0YXRlWzBdLCBvID0gc3RhdGVbMV0sIGQgPSBzdGF0ZVsyXTtcbiAgICAgIGQuc2V0RGlzcG9zYWJsZShzb3VyY2Uuc3Vic2NyaWJlKG8pKTtcbiAgICB9XG5cbiAgICByZXR1cm4gRGVsYXlTdWJzY3JpcHRpb247XG4gIH0oT2JzZXJ2YWJsZUJhc2UpKTtcblxuICAvKipcbiAgICogIFRpbWUgc2hpZnRzIHRoZSBvYnNlcnZhYmxlIHNlcXVlbmNlIGJ5IGRlbGF5aW5nIHRoZSBzdWJzY3JpcHRpb24gd2l0aCB0aGUgc3BlY2lmaWVkIHJlbGF0aXZlIHRpbWUgZHVyYXRpb24sIHVzaW5nIHRoZSBzcGVjaWZpZWQgc2NoZWR1bGVyIHRvIHJ1biB0aW1lcnMuXG4gICAqXG4gICAqIEBleGFtcGxlXG4gICAqICAxIC0gcmVzID0gc291cmNlLmRlbGF5U3Vic2NyaXB0aW9uKDUwMDApOyAvLyA1c1xuICAgKiAgMiAtIHJlcyA9IHNvdXJjZS5kZWxheVN1YnNjcmlwdGlvbig1MDAwLCBSeC5TY2hlZHVsZXIuZGVmYXVsdCk7IC8vIDUgc2Vjb25kc1xuICAgKlxuICAgKiBAcGFyYW0ge051bWJlcn0gZHVlVGltZSBSZWxhdGl2ZSBvciBhYnNvbHV0ZSB0aW1lIHNoaWZ0IG9mIHRoZSBzdWJzY3JpcHRpb24uXG4gICAqIEBwYXJhbSB7U2NoZWR1bGVyfSBbc2NoZWR1bGVyXSAgU2NoZWR1bGVyIHRvIHJ1biB0aGUgc3Vic2NyaXB0aW9uIGRlbGF5IHRpbWVyIG9uLiBJZiBub3Qgc3BlY2lmaWVkLCB0aGUgdGltZW91dCBzY2hlZHVsZXIgaXMgdXNlZC5cbiAgICogQHJldHVybnMge09ic2VydmFibGV9IFRpbWUtc2hpZnRlZCBzZXF1ZW5jZS5cbiAgICovXG4gIG9ic2VydmFibGVQcm90by5kZWxheVN1YnNjcmlwdGlvbiA9IGZ1bmN0aW9uIChkdWVUaW1lLCBzY2hlZHVsZXIpIHtcbiAgICBpc1NjaGVkdWxlcihzY2hlZHVsZXIpIHx8IChzY2hlZHVsZXIgPSBkZWZhdWx0U2NoZWR1bGVyKTtcbiAgICByZXR1cm4gbmV3IERlbGF5U3Vic2NyaXB0aW9uKHRoaXMsIGR1ZVRpbWUsIHNjaGVkdWxlcik7XG4gIH07XG5cbiAgdmFyIFNraXBMYXN0V2l0aFRpbWVPYnNlcnZhYmxlID0gKGZ1bmN0aW9uIChfX3N1cGVyX18pIHtcbiAgICBpbmhlcml0cyhTa2lwTGFzdFdpdGhUaW1lT2JzZXJ2YWJsZSwgX19zdXBlcl9fKTtcbiAgICBmdW5jdGlvbiBTa2lwTGFzdFdpdGhUaW1lT2JzZXJ2YWJsZShzb3VyY2UsIGQsIHMpIHtcbiAgICAgIHRoaXMuc291cmNlID0gc291cmNlO1xuICAgICAgdGhpcy5fZCA9IGQ7XG4gICAgICB0aGlzLl9zID0gcztcbiAgICAgIF9fc3VwZXJfXy5jYWxsKHRoaXMpO1xuICAgIH1cblxuICAgIFNraXBMYXN0V2l0aFRpbWVPYnNlcnZhYmxlLnByb3RvdHlwZS5zdWJzY3JpYmVDb3JlID0gZnVuY3Rpb24gKG8pIHtcbiAgICAgIHJldHVybiB0aGlzLnNvdXJjZS5zdWJzY3JpYmUobmV3IFNraXBMYXN0V2l0aFRpbWVPYnNlcnZlcihvLCB0aGlzKSk7XG4gICAgfTtcblxuICAgIHJldHVybiBTa2lwTGFzdFdpdGhUaW1lT2JzZXJ2YWJsZTtcbiAgfShPYnNlcnZhYmxlQmFzZSkpO1xuXG4gIHZhciBTa2lwTGFzdFdpdGhUaW1lT2JzZXJ2ZXIgPSAoZnVuY3Rpb24gKF9fc3VwZXJfXykge1xuICAgIGluaGVyaXRzKFNraXBMYXN0V2l0aFRpbWVPYnNlcnZlciwgX19zdXBlcl9fKTtcblxuICAgIGZ1bmN0aW9uIFNraXBMYXN0V2l0aFRpbWVPYnNlcnZlcihvLCBwKSB7XG4gICAgICB0aGlzLl9vID0gbztcbiAgICAgIHRoaXMuX3MgPSBwLl9zO1xuICAgICAgdGhpcy5fZCA9IHAuX2Q7XG4gICAgICB0aGlzLl9xID0gW107XG4gICAgICBfX3N1cGVyX18uY2FsbCh0aGlzKTtcbiAgICB9XG5cbiAgICBTa2lwTGFzdFdpdGhUaW1lT2JzZXJ2ZXIucHJvdG90eXBlLm5leHQgPSBmdW5jdGlvbiAoeCkge1xuICAgICAgdmFyIG5vdyA9IHRoaXMuX3Mubm93KCk7XG4gICAgICB0aGlzLl9xLnB1c2goeyBpbnRlcnZhbDogbm93LCB2YWx1ZTogeCB9KTtcbiAgICAgIHdoaWxlICh0aGlzLl9xLmxlbmd0aCA+IDAgJiYgbm93IC0gdGhpcy5fcVswXS5pbnRlcnZhbCA+PSB0aGlzLl9kKSB7XG4gICAgICAgIHRoaXMuX28ub25OZXh0KHRoaXMuX3Euc2hpZnQoKS52YWx1ZSk7XG4gICAgICB9XG4gICAgfTtcbiAgICBTa2lwTGFzdFdpdGhUaW1lT2JzZXJ2ZXIucHJvdG90eXBlLmVycm9yID0gZnVuY3Rpb24gKGUpIHsgdGhpcy5fby5vbkVycm9yKGUpOyB9O1xuICAgIFNraXBMYXN0V2l0aFRpbWVPYnNlcnZlci5wcm90b3R5cGUuY29tcGxldGVkID0gZnVuY3Rpb24gKCkge1xuICAgICAgdmFyIG5vdyA9IHRoaXMuX3Mubm93KCk7XG4gICAgICB3aGlsZSAodGhpcy5fcS5sZW5ndGggPiAwICYmIG5vdyAtIHRoaXMuX3FbMF0uaW50ZXJ2YWwgPj0gdGhpcy5fZCkge1xuICAgICAgICB0aGlzLl9vLm9uTmV4dCh0aGlzLl9xLnNoaWZ0KCkudmFsdWUpO1xuICAgICAgfVxuICAgICAgdGhpcy5fby5vbkNvbXBsZXRlZCgpO1xuICAgIH07XG5cbiAgICByZXR1cm4gU2tpcExhc3RXaXRoVGltZU9ic2VydmVyO1xuICB9KEFic3RyYWN0T2JzZXJ2ZXIpKTtcblxuICAvKipcbiAgICogIFNraXBzIGVsZW1lbnRzIGZvciB0aGUgc3BlY2lmaWVkIGR1cmF0aW9uIGZyb20gdGhlIGVuZCBvZiB0aGUgb2JzZXJ2YWJsZSBzb3VyY2Ugc2VxdWVuY2UsIHVzaW5nIHRoZSBzcGVjaWZpZWQgc2NoZWR1bGVyIHRvIHJ1biB0aW1lcnMuXG4gICAqIEBkZXNjcmlwdGlvblxuICAgKiAgVGhpcyBvcGVyYXRvciBhY2N1bXVsYXRlcyBhIHF1ZXVlIHdpdGggYSBsZW5ndGggZW5vdWdoIHRvIHN0b3JlIGVsZW1lbnRzIHJlY2VpdmVkIGR1cmluZyB0aGUgaW5pdGlhbCBkdXJhdGlvbiB3aW5kb3cuXG4gICAqICBBcyBtb3JlIGVsZW1lbnRzIGFyZSByZWNlaXZlZCwgZWxlbWVudHMgb2xkZXIgdGhhbiB0aGUgc3BlY2lmaWVkIGR1cmF0aW9uIGFyZSB0YWtlbiBmcm9tIHRoZSBxdWV1ZSBhbmQgcHJvZHVjZWQgb24gdGhlXG4gICAqICByZXN1bHQgc2VxdWVuY2UuIFRoaXMgY2F1c2VzIGVsZW1lbnRzIHRvIGJlIGRlbGF5ZWQgd2l0aCBkdXJhdGlvbi5cbiAgICogQHBhcmFtIHtOdW1iZXJ9IGR1cmF0aW9uIER1cmF0aW9uIGZvciBza2lwcGluZyBlbGVtZW50cyBmcm9tIHRoZSBlbmQgb2YgdGhlIHNlcXVlbmNlLlxuICAgKiBAcGFyYW0ge1NjaGVkdWxlcn0gW3NjaGVkdWxlcl0gIFNjaGVkdWxlciB0byBydW4gdGhlIHRpbWVyIG9uLiBJZiBub3Qgc3BlY2lmaWVkLCBkZWZhdWx0cyB0byBSeC5TY2hlZHVsZXIudGltZW91dFxuICAgKiBAcmV0dXJucyB7T2JzZXJ2YWJsZX0gQW4gb2JzZXJ2YWJsZSBzZXF1ZW5jZSB3aXRoIHRoZSBlbGVtZW50cyBza2lwcGVkIGR1cmluZyB0aGUgc3BlY2lmaWVkIGR1cmF0aW9uIGZyb20gdGhlIGVuZCBvZiB0aGUgc291cmNlIHNlcXVlbmNlLlxuICAgKi9cbiAgb2JzZXJ2YWJsZVByb3RvLnNraXBMYXN0V2l0aFRpbWUgPSBmdW5jdGlvbiAoZHVyYXRpb24sIHNjaGVkdWxlcikge1xuICAgIGlzU2NoZWR1bGVyKHNjaGVkdWxlcikgfHwgKHNjaGVkdWxlciA9IGRlZmF1bHRTY2hlZHVsZXIpO1xuICAgIHJldHVybiBuZXcgU2tpcExhc3RXaXRoVGltZU9ic2VydmFibGUodGhpcywgZHVyYXRpb24sIHNjaGVkdWxlcik7XG4gIH07XG5cbiAgdmFyIFRha2VMYXN0V2l0aFRpbWVPYnNlcnZhYmxlID0gKGZ1bmN0aW9uIChfX3N1cGVyX18pIHtcbiAgICBpbmhlcml0cyhUYWtlTGFzdFdpdGhUaW1lT2JzZXJ2YWJsZSwgX19zdXBlcl9fKTtcbiAgICBmdW5jdGlvbiBUYWtlTGFzdFdpdGhUaW1lT2JzZXJ2YWJsZShzb3VyY2UsIGQsIHMpIHtcbiAgICAgIHRoaXMuc291cmNlID0gc291cmNlO1xuICAgICAgdGhpcy5fZCA9IGQ7XG4gICAgICB0aGlzLl9zID0gcztcbiAgICAgIF9fc3VwZXJfXy5jYWxsKHRoaXMpO1xuICAgIH1cblxuICAgIFRha2VMYXN0V2l0aFRpbWVPYnNlcnZhYmxlLnByb3RvdHlwZS5zdWJzY3JpYmVDb3JlID0gZnVuY3Rpb24gKG8pIHtcbiAgICAgIHJldHVybiB0aGlzLnNvdXJjZS5zdWJzY3JpYmUobmV3IFRha2VMYXN0V2l0aFRpbWVPYnNlcnZlcihvLCB0aGlzLl9kLCB0aGlzLl9zKSk7XG4gICAgfTtcblxuICAgIHJldHVybiBUYWtlTGFzdFdpdGhUaW1lT2JzZXJ2YWJsZTtcbiAgfShPYnNlcnZhYmxlQmFzZSkpO1xuXG4gIHZhciBUYWtlTGFzdFdpdGhUaW1lT2JzZXJ2ZXIgPSAoZnVuY3Rpb24gKF9fc3VwZXJfXykge1xuICAgIGluaGVyaXRzKFRha2VMYXN0V2l0aFRpbWVPYnNlcnZlciwgX19zdXBlcl9fKTtcblxuICAgIGZ1bmN0aW9uIFRha2VMYXN0V2l0aFRpbWVPYnNlcnZlcihvLCBkLCBzKSB7XG4gICAgICB0aGlzLl9vID0gbztcbiAgICAgIHRoaXMuX2QgPSBkO1xuICAgICAgdGhpcy5fcyA9IHM7XG4gICAgICB0aGlzLl9xID0gW107XG4gICAgICBfX3N1cGVyX18uY2FsbCh0aGlzKTtcbiAgICB9XG5cbiAgICBUYWtlTGFzdFdpdGhUaW1lT2JzZXJ2ZXIucHJvdG90eXBlLm5leHQgPSBmdW5jdGlvbiAoeCkge1xuICAgICAgdmFyIG5vdyA9IHRoaXMuX3Mubm93KCk7XG4gICAgICB0aGlzLl9xLnB1c2goeyBpbnRlcnZhbDogbm93LCB2YWx1ZTogeCB9KTtcbiAgICAgIHdoaWxlICh0aGlzLl9xLmxlbmd0aCA+IDAgJiYgbm93IC0gdGhpcy5fcVswXS5pbnRlcnZhbCA+PSB0aGlzLl9kKSB7XG4gICAgICAgIHRoaXMuX3Euc2hpZnQoKTtcbiAgICAgIH1cbiAgICB9O1xuICAgIFRha2VMYXN0V2l0aFRpbWVPYnNlcnZlci5wcm90b3R5cGUuZXJyb3IgPSBmdW5jdGlvbiAoZSkgeyB0aGlzLl9vLm9uRXJyb3IoZSk7IH07XG4gICAgVGFrZUxhc3RXaXRoVGltZU9ic2VydmVyLnByb3RvdHlwZS5jb21wbGV0ZWQgPSBmdW5jdGlvbiAoKSB7XG4gICAgICB2YXIgbm93ID0gdGhpcy5fcy5ub3coKTtcbiAgICAgIHdoaWxlICh0aGlzLl9xLmxlbmd0aCA+IDApIHtcbiAgICAgICAgdmFyIG5leHQgPSB0aGlzLl9xLnNoaWZ0KCk7XG4gICAgICAgIGlmIChub3cgLSBuZXh0LmludGVydmFsIDw9IHRoaXMuX2QpIHsgdGhpcy5fby5vbk5leHQobmV4dC52YWx1ZSk7IH1cbiAgICAgIH1cbiAgICAgIHRoaXMuX28ub25Db21wbGV0ZWQoKTtcbiAgICB9O1xuXG4gICAgcmV0dXJuIFRha2VMYXN0V2l0aFRpbWVPYnNlcnZlcjtcbiAgfShBYnN0cmFjdE9ic2VydmVyKSk7XG5cbiAgLyoqXG4gICAqICBSZXR1cm5zIGVsZW1lbnRzIHdpdGhpbiB0aGUgc3BlY2lmaWVkIGR1cmF0aW9uIGZyb20gdGhlIGVuZCBvZiB0aGUgb2JzZXJ2YWJsZSBzb3VyY2Ugc2VxdWVuY2UsIHVzaW5nIHRoZSBzcGVjaWZpZWQgc2NoZWR1bGVycyB0byBydW4gdGltZXJzIGFuZCB0byBkcmFpbiB0aGUgY29sbGVjdGVkIGVsZW1lbnRzLlxuICAgKiBAZGVzY3JpcHRpb25cbiAgICogIFRoaXMgb3BlcmF0b3IgYWNjdW11bGF0ZXMgYSBxdWV1ZSB3aXRoIGEgbGVuZ3RoIGVub3VnaCB0byBzdG9yZSBlbGVtZW50cyByZWNlaXZlZCBkdXJpbmcgdGhlIGluaXRpYWwgZHVyYXRpb24gd2luZG93LlxuICAgKiAgQXMgbW9yZSBlbGVtZW50cyBhcmUgcmVjZWl2ZWQsIGVsZW1lbnRzIG9sZGVyIHRoYW4gdGhlIHNwZWNpZmllZCBkdXJhdGlvbiBhcmUgdGFrZW4gZnJvbSB0aGUgcXVldWUgYW5kIHByb2R1Y2VkIG9uIHRoZVxuICAgKiAgcmVzdWx0IHNlcXVlbmNlLiBUaGlzIGNhdXNlcyBlbGVtZW50cyB0byBiZSBkZWxheWVkIHdpdGggZHVyYXRpb24uXG4gICAqIEBwYXJhbSB7TnVtYmVyfSBkdXJhdGlvbiBEdXJhdGlvbiBmb3IgdGFraW5nIGVsZW1lbnRzIGZyb20gdGhlIGVuZCBvZiB0aGUgc2VxdWVuY2UuXG4gICAqIEBwYXJhbSB7U2NoZWR1bGVyfSBbc2NoZWR1bGVyXSAgU2NoZWR1bGVyIHRvIHJ1biB0aGUgdGltZXIgb24uIElmIG5vdCBzcGVjaWZpZWQsIGRlZmF1bHRzIHRvIFJ4LlNjaGVkdWxlci50aW1lb3V0LlxuICAgKiBAcmV0dXJucyB7T2JzZXJ2YWJsZX0gQW4gb2JzZXJ2YWJsZSBzZXF1ZW5jZSB3aXRoIHRoZSBlbGVtZW50cyB0YWtlbiBkdXJpbmcgdGhlIHNwZWNpZmllZCBkdXJhdGlvbiBmcm9tIHRoZSBlbmQgb2YgdGhlIHNvdXJjZSBzZXF1ZW5jZS5cbiAgICovXG4gIG9ic2VydmFibGVQcm90by50YWtlTGFzdFdpdGhUaW1lID0gZnVuY3Rpb24gKGR1cmF0aW9uLCBzY2hlZHVsZXIpIHtcbiAgICBpc1NjaGVkdWxlcihzY2hlZHVsZXIpIHx8IChzY2hlZHVsZXIgPSBkZWZhdWx0U2NoZWR1bGVyKTtcbiAgICByZXR1cm4gbmV3IFRha2VMYXN0V2l0aFRpbWVPYnNlcnZhYmxlKHRoaXMsIGR1cmF0aW9uLCBzY2hlZHVsZXIpO1xuICB9O1xuXG4gIC8qKlxuICAgKiAgUmV0dXJucyBhbiBhcnJheSB3aXRoIHRoZSBlbGVtZW50cyB3aXRoaW4gdGhlIHNwZWNpZmllZCBkdXJhdGlvbiBmcm9tIHRoZSBlbmQgb2YgdGhlIG9ic2VydmFibGUgc291cmNlIHNlcXVlbmNlLCB1c2luZyB0aGUgc3BlY2lmaWVkIHNjaGVkdWxlciB0byBydW4gdGltZXJzLlxuICAgKiBAZGVzY3JpcHRpb25cbiAgICogIFRoaXMgb3BlcmF0b3IgYWNjdW11bGF0ZXMgYSBxdWV1ZSB3aXRoIGEgbGVuZ3RoIGVub3VnaCB0byBzdG9yZSBlbGVtZW50cyByZWNlaXZlZCBkdXJpbmcgdGhlIGluaXRpYWwgZHVyYXRpb24gd2luZG93LlxuICAgKiAgQXMgbW9yZSBlbGVtZW50cyBhcmUgcmVjZWl2ZWQsIGVsZW1lbnRzIG9sZGVyIHRoYW4gdGhlIHNwZWNpZmllZCBkdXJhdGlvbiBhcmUgdGFrZW4gZnJvbSB0aGUgcXVldWUgYW5kIHByb2R1Y2VkIG9uIHRoZVxuICAgKiAgcmVzdWx0IHNlcXVlbmNlLiBUaGlzIGNhdXNlcyBlbGVtZW50cyB0byBiZSBkZWxheWVkIHdpdGggZHVyYXRpb24uXG4gICAqIEBwYXJhbSB7TnVtYmVyfSBkdXJhdGlvbiBEdXJhdGlvbiBmb3IgdGFraW5nIGVsZW1lbnRzIGZyb20gdGhlIGVuZCBvZiB0aGUgc2VxdWVuY2UuXG4gICAqIEBwYXJhbSB7U2NoZWR1bGVyfSBzY2hlZHVsZXIgU2NoZWR1bGVyIHRvIHJ1biB0aGUgdGltZXIgb24uIElmIG5vdCBzcGVjaWZpZWQsIGRlZmF1bHRzIHRvIFJ4LlNjaGVkdWxlci50aW1lb3V0LlxuICAgKiBAcmV0dXJucyB7T2JzZXJ2YWJsZX0gQW4gb2JzZXJ2YWJsZSBzZXF1ZW5jZSBjb250YWluaW5nIGEgc2luZ2xlIGFycmF5IHdpdGggdGhlIGVsZW1lbnRzIHRha2VuIGR1cmluZyB0aGUgc3BlY2lmaWVkIGR1cmF0aW9uIGZyb20gdGhlIGVuZCBvZiB0aGUgc291cmNlIHNlcXVlbmNlLlxuICAgKi9cbiAgb2JzZXJ2YWJsZVByb3RvLnRha2VMYXN0QnVmZmVyV2l0aFRpbWUgPSBmdW5jdGlvbiAoZHVyYXRpb24sIHNjaGVkdWxlcikge1xuICAgIHZhciBzb3VyY2UgPSB0aGlzO1xuICAgIGlzU2NoZWR1bGVyKHNjaGVkdWxlcikgfHwgKHNjaGVkdWxlciA9IGRlZmF1bHRTY2hlZHVsZXIpO1xuICAgIHJldHVybiBuZXcgQW5vbnltb3VzT2JzZXJ2YWJsZShmdW5jdGlvbiAobykge1xuICAgICAgdmFyIHEgPSBbXTtcbiAgICAgIHJldHVybiBzb3VyY2Uuc3Vic2NyaWJlKGZ1bmN0aW9uICh4KSB7XG4gICAgICAgIHZhciBub3cgPSBzY2hlZHVsZXIubm93KCk7XG4gICAgICAgIHEucHVzaCh7IGludGVydmFsOiBub3csIHZhbHVlOiB4IH0pO1xuICAgICAgICB3aGlsZSAocS5sZW5ndGggPiAwICYmIG5vdyAtIHFbMF0uaW50ZXJ2YWwgPj0gZHVyYXRpb24pIHtcbiAgICAgICAgICBxLnNoaWZ0KCk7XG4gICAgICAgIH1cbiAgICAgIH0sIGZ1bmN0aW9uIChlKSB7IG8ub25FcnJvcihlKTsgfSwgZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgbm93ID0gc2NoZWR1bGVyLm5vdygpLCByZXMgPSBbXTtcbiAgICAgICAgd2hpbGUgKHEubGVuZ3RoID4gMCkge1xuICAgICAgICAgIHZhciBuZXh0ID0gcS5zaGlmdCgpO1xuICAgICAgICAgIG5vdyAtIG5leHQuaW50ZXJ2YWwgPD0gZHVyYXRpb24gJiYgcmVzLnB1c2gobmV4dC52YWx1ZSk7XG4gICAgICAgIH1cbiAgICAgICAgby5vbk5leHQocmVzKTtcbiAgICAgICAgby5vbkNvbXBsZXRlZCgpO1xuICAgICAgfSk7XG4gICAgfSwgc291cmNlKTtcbiAgfTtcblxuICB2YXIgVGFrZVdpdGhUaW1lT2JzZXJ2YWJsZSA9IChmdW5jdGlvbiAoX19zdXBlcl9fKSB7XG4gICAgaW5oZXJpdHMoVGFrZVdpdGhUaW1lT2JzZXJ2YWJsZSwgX19zdXBlcl9fKTtcbiAgICBmdW5jdGlvbiBUYWtlV2l0aFRpbWVPYnNlcnZhYmxlKHNvdXJjZSwgZCwgcykge1xuICAgICAgdGhpcy5zb3VyY2UgPSBzb3VyY2U7XG4gICAgICB0aGlzLl9kID0gZDtcbiAgICAgIHRoaXMuX3MgPSBzO1xuICAgICAgX19zdXBlcl9fLmNhbGwodGhpcyk7XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gc2NoZWR1bGVNZXRob2Qocywgbykge1xuICAgICAgby5vbkNvbXBsZXRlZCgpO1xuICAgIH1cblxuICAgIFRha2VXaXRoVGltZU9ic2VydmFibGUucHJvdG90eXBlLnN1YnNjcmliZUNvcmUgPSBmdW5jdGlvbiAobykge1xuICAgICAgcmV0dXJuIG5ldyBCaW5hcnlEaXNwb3NhYmxlKFxuICAgICAgICB0aGlzLl9zLnNjaGVkdWxlRnV0dXJlKG8sIHRoaXMuX2QsIHNjaGVkdWxlTWV0aG9kKSxcbiAgICAgICAgdGhpcy5zb3VyY2Uuc3Vic2NyaWJlKG8pXG4gICAgICApO1xuICAgIH07XG5cbiAgICByZXR1cm4gVGFrZVdpdGhUaW1lT2JzZXJ2YWJsZTtcbiAgfShPYnNlcnZhYmxlQmFzZSkpO1xuXG4gIC8qKlxuICAgKiAgVGFrZXMgZWxlbWVudHMgZm9yIHRoZSBzcGVjaWZpZWQgZHVyYXRpb24gZnJvbSB0aGUgc3RhcnQgb2YgdGhlIG9ic2VydmFibGUgc291cmNlIHNlcXVlbmNlLCB1c2luZyB0aGUgc3BlY2lmaWVkIHNjaGVkdWxlciB0byBydW4gdGltZXJzLlxuICAgKlxuICAgKiBAZXhhbXBsZVxuICAgKiAgMSAtIHJlcyA9IHNvdXJjZS50YWtlV2l0aFRpbWUoNTAwMCwgIFtvcHRpb25hbCBzY2hlZHVsZXJdKTtcbiAgICogQGRlc2NyaXB0aW9uXG4gICAqICBUaGlzIG9wZXJhdG9yIGFjY3VtdWxhdGVzIGEgcXVldWUgd2l0aCBhIGxlbmd0aCBlbm91Z2ggdG8gc3RvcmUgZWxlbWVudHMgcmVjZWl2ZWQgZHVyaW5nIHRoZSBpbml0aWFsIGR1cmF0aW9uIHdpbmRvdy5cbiAgICogIEFzIG1vcmUgZWxlbWVudHMgYXJlIHJlY2VpdmVkLCBlbGVtZW50cyBvbGRlciB0aGFuIHRoZSBzcGVjaWZpZWQgZHVyYXRpb24gYXJlIHRha2VuIGZyb20gdGhlIHF1ZXVlIGFuZCBwcm9kdWNlZCBvbiB0aGVcbiAgICogIHJlc3VsdCBzZXF1ZW5jZS4gVGhpcyBjYXVzZXMgZWxlbWVudHMgdG8gYmUgZGVsYXllZCB3aXRoIGR1cmF0aW9uLlxuICAgKiBAcGFyYW0ge051bWJlcn0gZHVyYXRpb24gRHVyYXRpb24gZm9yIHRha2luZyBlbGVtZW50cyBmcm9tIHRoZSBzdGFydCBvZiB0aGUgc2VxdWVuY2UuXG4gICAqIEBwYXJhbSB7U2NoZWR1bGVyfSBzY2hlZHVsZXIgU2NoZWR1bGVyIHRvIHJ1biB0aGUgdGltZXIgb24uIElmIG5vdCBzcGVjaWZpZWQsIGRlZmF1bHRzIHRvIFJ4LlNjaGVkdWxlci50aW1lb3V0LlxuICAgKiBAcmV0dXJucyB7T2JzZXJ2YWJsZX0gQW4gb2JzZXJ2YWJsZSBzZXF1ZW5jZSB3aXRoIHRoZSBlbGVtZW50cyB0YWtlbiBkdXJpbmcgdGhlIHNwZWNpZmllZCBkdXJhdGlvbiBmcm9tIHRoZSBzdGFydCBvZiB0aGUgc291cmNlIHNlcXVlbmNlLlxuICAgKi9cbiAgb2JzZXJ2YWJsZVByb3RvLnRha2VXaXRoVGltZSA9IGZ1bmN0aW9uIChkdXJhdGlvbiwgc2NoZWR1bGVyKSB7XG4gICAgaXNTY2hlZHVsZXIoc2NoZWR1bGVyKSB8fCAoc2NoZWR1bGVyID0gZGVmYXVsdFNjaGVkdWxlcik7XG4gICAgcmV0dXJuIG5ldyBUYWtlV2l0aFRpbWVPYnNlcnZhYmxlKHRoaXMsIGR1cmF0aW9uLCBzY2hlZHVsZXIpO1xuICB9O1xuXG4gIHZhciBTa2lwV2l0aFRpbWVPYnNlcnZhYmxlID0gKGZ1bmN0aW9uIChfX3N1cGVyX18pIHtcbiAgICBpbmhlcml0cyhTa2lwV2l0aFRpbWVPYnNlcnZhYmxlLCBfX3N1cGVyX18pO1xuICAgIGZ1bmN0aW9uIFNraXBXaXRoVGltZU9ic2VydmFibGUoc291cmNlLCBkLCBzKSB7XG4gICAgICB0aGlzLnNvdXJjZSA9IHNvdXJjZTtcbiAgICAgIHRoaXMuX2QgPSBkO1xuICAgICAgdGhpcy5fcyA9IHM7XG4gICAgICB0aGlzLl9vcGVuID0gZmFsc2U7XG4gICAgICBfX3N1cGVyX18uY2FsbCh0aGlzKTtcbiAgICB9XG5cbiAgICBmdW5jdGlvbiBzY2hlZHVsZU1ldGhvZChzLCBzZWxmKSB7XG4gICAgICBzZWxmLl9vcGVuID0gdHJ1ZTtcbiAgICB9XG5cbiAgICBTa2lwV2l0aFRpbWVPYnNlcnZhYmxlLnByb3RvdHlwZS5zdWJzY3JpYmVDb3JlID0gZnVuY3Rpb24gKG8pIHtcbiAgICAgIHJldHVybiBuZXcgQmluYXJ5RGlzcG9zYWJsZShcbiAgICAgICAgdGhpcy5fcy5zY2hlZHVsZUZ1dHVyZSh0aGlzLCB0aGlzLl9kLCBzY2hlZHVsZU1ldGhvZCksXG4gICAgICAgIHRoaXMuc291cmNlLnN1YnNjcmliZShuZXcgU2tpcFdpdGhUaW1lT2JzZXJ2ZXIobywgdGhpcykpXG4gICAgICApO1xuICAgIH07XG5cbiAgICByZXR1cm4gU2tpcFdpdGhUaW1lT2JzZXJ2YWJsZTtcbiAgfShPYnNlcnZhYmxlQmFzZSkpO1xuXG4gIHZhciBTa2lwV2l0aFRpbWVPYnNlcnZlciA9IChmdW5jdGlvbiAoX19zdXBlcl9fKSB7XG4gICAgaW5oZXJpdHMoU2tpcFdpdGhUaW1lT2JzZXJ2ZXIsIF9fc3VwZXJfXyk7XG5cbiAgICBmdW5jdGlvbiBTa2lwV2l0aFRpbWVPYnNlcnZlcihvLCBwKSB7XG4gICAgICB0aGlzLl9vID0gbztcbiAgICAgIHRoaXMuX3AgPSBwO1xuICAgICAgX19zdXBlcl9fLmNhbGwodGhpcyk7XG4gICAgfVxuXG4gICAgU2tpcFdpdGhUaW1lT2JzZXJ2ZXIucHJvdG90eXBlLm5leHQgPSBmdW5jdGlvbiAoeCkgeyB0aGlzLl9wLl9vcGVuICYmIHRoaXMuX28ub25OZXh0KHgpOyB9O1xuICAgIFNraXBXaXRoVGltZU9ic2VydmVyLnByb3RvdHlwZS5lcnJvciA9IGZ1bmN0aW9uIChlKSB7IHRoaXMuX28ub25FcnJvcihlKTsgfTtcbiAgICBTa2lwV2l0aFRpbWVPYnNlcnZlci5wcm90b3R5cGUuY29tcGxldGVkID0gZnVuY3Rpb24gKCkgeyB0aGlzLl9vLm9uQ29tcGxldGVkKCk7IH07XG5cbiAgICByZXR1cm4gU2tpcFdpdGhUaW1lT2JzZXJ2ZXI7XG4gIH0oQWJzdHJhY3RPYnNlcnZlcikpO1xuXG4gIC8qKlxuICAgKiAgU2tpcHMgZWxlbWVudHMgZm9yIHRoZSBzcGVjaWZpZWQgZHVyYXRpb24gZnJvbSB0aGUgc3RhcnQgb2YgdGhlIG9ic2VydmFibGUgc291cmNlIHNlcXVlbmNlLCB1c2luZyB0aGUgc3BlY2lmaWVkIHNjaGVkdWxlciB0byBydW4gdGltZXJzLlxuICAgKiBAZGVzY3JpcHRpb25cbiAgICogIFNwZWNpZnlpbmcgYSB6ZXJvIHZhbHVlIGZvciBkdXJhdGlvbiBkb2Vzbid0IGd1YXJhbnRlZSBubyBlbGVtZW50cyB3aWxsIGJlIGRyb3BwZWQgZnJvbSB0aGUgc3RhcnQgb2YgdGhlIHNvdXJjZSBzZXF1ZW5jZS5cbiAgICogIFRoaXMgaXMgYSBzaWRlLWVmZmVjdCBvZiB0aGUgYXN5bmNocm9ueSBpbnRyb2R1Y2VkIGJ5IHRoZSBzY2hlZHVsZXIsIHdoZXJlIHRoZSBhY3Rpb24gdGhhdCBjYXVzZXMgY2FsbGJhY2tzIGZyb20gdGhlIHNvdXJjZSBzZXF1ZW5jZSB0byBiZSBmb3J3YXJkZWRcbiAgICogIG1heSBub3QgZXhlY3V0ZSBpbW1lZGlhdGVseSwgZGVzcGl0ZSB0aGUgemVybyBkdWUgdGltZS5cbiAgICpcbiAgICogIEVycm9ycyBwcm9kdWNlZCBieSB0aGUgc291cmNlIHNlcXVlbmNlIGFyZSBhbHdheXMgZm9yd2FyZGVkIHRvIHRoZSByZXN1bHQgc2VxdWVuY2UsIGV2ZW4gaWYgdGhlIGVycm9yIG9jY3VycyBiZWZvcmUgdGhlIGR1cmF0aW9uLlxuICAgKiBAcGFyYW0ge051bWJlcn0gZHVyYXRpb24gRHVyYXRpb24gZm9yIHNraXBwaW5nIGVsZW1lbnRzIGZyb20gdGhlIHN0YXJ0IG9mIHRoZSBzZXF1ZW5jZS5cbiAgICogQHBhcmFtIHtTY2hlZHVsZXJ9IHNjaGVkdWxlciBTY2hlZHVsZXIgdG8gcnVuIHRoZSB0aW1lciBvbi4gSWYgbm90IHNwZWNpZmllZCwgZGVmYXVsdHMgdG8gUnguU2NoZWR1bGVyLnRpbWVvdXQuXG4gICAqIEByZXR1cm5zIHtPYnNlcnZhYmxlfSBBbiBvYnNlcnZhYmxlIHNlcXVlbmNlIHdpdGggdGhlIGVsZW1lbnRzIHNraXBwZWQgZHVyaW5nIHRoZSBzcGVjaWZpZWQgZHVyYXRpb24gZnJvbSB0aGUgc3RhcnQgb2YgdGhlIHNvdXJjZSBzZXF1ZW5jZS5cbiAgICovXG4gIG9ic2VydmFibGVQcm90by5za2lwV2l0aFRpbWUgPSBmdW5jdGlvbiAoZHVyYXRpb24sIHNjaGVkdWxlcikge1xuICAgIGlzU2NoZWR1bGVyKHNjaGVkdWxlcikgfHwgKHNjaGVkdWxlciA9IGRlZmF1bHRTY2hlZHVsZXIpO1xuICAgIHJldHVybiBuZXcgU2tpcFdpdGhUaW1lT2JzZXJ2YWJsZSh0aGlzLCBkdXJhdGlvbiwgc2NoZWR1bGVyKTtcbiAgfTtcblxuICB2YXIgU2tpcFVudGlsV2l0aFRpbWVPYnNlcnZhYmxlID0gKGZ1bmN0aW9uIChfX3N1cGVyX18pIHtcbiAgICBpbmhlcml0cyhTa2lwVW50aWxXaXRoVGltZU9ic2VydmFibGUsIF9fc3VwZXJfXyk7XG4gICAgZnVuY3Rpb24gU2tpcFVudGlsV2l0aFRpbWVPYnNlcnZhYmxlKHNvdXJjZSwgc3RhcnRUaW1lLCBzY2hlZHVsZXIpIHtcbiAgICAgIHRoaXMuc291cmNlID0gc291cmNlO1xuICAgICAgdGhpcy5fc3QgPSBzdGFydFRpbWU7XG4gICAgICB0aGlzLl9zID0gc2NoZWR1bGVyO1xuICAgICAgX19zdXBlcl9fLmNhbGwodGhpcyk7XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gc2NoZWR1bGVNZXRob2Qocywgc3RhdGUpIHtcbiAgICAgIHN0YXRlLl9vcGVuID0gdHJ1ZTtcbiAgICB9XG5cbiAgICBTa2lwVW50aWxXaXRoVGltZU9ic2VydmFibGUucHJvdG90eXBlLnN1YnNjcmliZUNvcmUgPSBmdW5jdGlvbiAobykge1xuICAgICAgdGhpcy5fb3BlbiA9IGZhbHNlO1xuICAgICAgcmV0dXJuIG5ldyBCaW5hcnlEaXNwb3NhYmxlKFxuICAgICAgICB0aGlzLl9zLnNjaGVkdWxlRnV0dXJlKHRoaXMsIHRoaXMuX3N0LCBzY2hlZHVsZU1ldGhvZCksXG4gICAgICAgIHRoaXMuc291cmNlLnN1YnNjcmliZShuZXcgU2tpcFVudGlsV2l0aFRpbWVPYnNlcnZlcihvLCB0aGlzKSlcbiAgICAgICk7XG4gICAgfTtcblxuICAgIHJldHVybiBTa2lwVW50aWxXaXRoVGltZU9ic2VydmFibGU7XG4gIH0oT2JzZXJ2YWJsZUJhc2UpKTtcblxuICB2YXIgU2tpcFVudGlsV2l0aFRpbWVPYnNlcnZlciA9IChmdW5jdGlvbiAoX19zdXBlcl9fKSB7XG4gICAgaW5oZXJpdHMoU2tpcFVudGlsV2l0aFRpbWVPYnNlcnZlciwgX19zdXBlcl9fKTtcblxuICAgIGZ1bmN0aW9uIFNraXBVbnRpbFdpdGhUaW1lT2JzZXJ2ZXIobywgcCkge1xuICAgICAgdGhpcy5fbyA9IG87XG4gICAgICB0aGlzLl9wID0gcDtcbiAgICAgIF9fc3VwZXJfXy5jYWxsKHRoaXMpO1xuICAgIH1cblxuICAgIFNraXBVbnRpbFdpdGhUaW1lT2JzZXJ2ZXIucHJvdG90eXBlLm5leHQgPSBmdW5jdGlvbiAoeCkgeyB0aGlzLl9wLl9vcGVuICYmIHRoaXMuX28ub25OZXh0KHgpOyB9O1xuICAgIFNraXBVbnRpbFdpdGhUaW1lT2JzZXJ2ZXIucHJvdG90eXBlLmVycm9yID0gZnVuY3Rpb24gKGUpIHsgdGhpcy5fby5vbkVycm9yKGUpOyB9O1xuICAgIFNraXBVbnRpbFdpdGhUaW1lT2JzZXJ2ZXIucHJvdG90eXBlLmNvbXBsZXRlZCA9IGZ1bmN0aW9uICgpIHsgdGhpcy5fby5vbkNvbXBsZXRlZCgpOyB9O1xuXG4gICAgcmV0dXJuIFNraXBVbnRpbFdpdGhUaW1lT2JzZXJ2ZXI7XG4gIH0oQWJzdHJhY3RPYnNlcnZlcikpO1xuXG5cbiAgLyoqXG4gICAqICBTa2lwcyBlbGVtZW50cyBmcm9tIHRoZSBvYnNlcnZhYmxlIHNvdXJjZSBzZXF1ZW5jZSB1bnRpbCB0aGUgc3BlY2lmaWVkIHN0YXJ0IHRpbWUsIHVzaW5nIHRoZSBzcGVjaWZpZWQgc2NoZWR1bGVyIHRvIHJ1biB0aW1lcnMuXG4gICAqICBFcnJvcnMgcHJvZHVjZWQgYnkgdGhlIHNvdXJjZSBzZXF1ZW5jZSBhcmUgYWx3YXlzIGZvcndhcmRlZCB0byB0aGUgcmVzdWx0IHNlcXVlbmNlLCBldmVuIGlmIHRoZSBlcnJvciBvY2N1cnMgYmVmb3JlIHRoZSBzdGFydCB0aW1lLlxuICAgKlxuICAgKiBAZXhhbXBsZXNcbiAgICogIDEgLSByZXMgPSBzb3VyY2Uuc2tpcFVudGlsV2l0aFRpbWUobmV3IERhdGUoKSwgW3NjaGVkdWxlcl0pO1xuICAgKiAgMiAtIHJlcyA9IHNvdXJjZS5za2lwVW50aWxXaXRoVGltZSg1MDAwLCBbc2NoZWR1bGVyXSk7XG4gICAqIEBwYXJhbSB7RGF0ZXxOdW1iZXJ9IHN0YXJ0VGltZSBUaW1lIHRvIHN0YXJ0IHRha2luZyBlbGVtZW50cyBmcm9tIHRoZSBzb3VyY2Ugc2VxdWVuY2UuIElmIHRoaXMgdmFsdWUgaXMgbGVzcyB0aGFuIG9yIGVxdWFsIHRvIERhdGUoKSwgbm8gZWxlbWVudHMgd2lsbCBiZSBza2lwcGVkLlxuICAgKiBAcGFyYW0ge1NjaGVkdWxlcn0gW3NjaGVkdWxlcl0gU2NoZWR1bGVyIHRvIHJ1biB0aGUgdGltZXIgb24uIElmIG5vdCBzcGVjaWZpZWQsIGRlZmF1bHRzIHRvIFJ4LlNjaGVkdWxlci50aW1lb3V0LlxuICAgKiBAcmV0dXJucyB7T2JzZXJ2YWJsZX0gQW4gb2JzZXJ2YWJsZSBzZXF1ZW5jZSB3aXRoIHRoZSBlbGVtZW50cyBza2lwcGVkIHVudGlsIHRoZSBzcGVjaWZpZWQgc3RhcnQgdGltZS5cbiAgICovXG4gIG9ic2VydmFibGVQcm90by5za2lwVW50aWxXaXRoVGltZSA9IGZ1bmN0aW9uIChzdGFydFRpbWUsIHNjaGVkdWxlcikge1xuICAgIGlzU2NoZWR1bGVyKHNjaGVkdWxlcikgfHwgKHNjaGVkdWxlciA9IGRlZmF1bHRTY2hlZHVsZXIpO1xuICAgIHJldHVybiBuZXcgU2tpcFVudGlsV2l0aFRpbWVPYnNlcnZhYmxlKHRoaXMsIHN0YXJ0VGltZSwgc2NoZWR1bGVyKTtcbiAgfTtcblxuICAvKipcbiAgICogIFRha2VzIGVsZW1lbnRzIGZvciB0aGUgc3BlY2lmaWVkIGR1cmF0aW9uIHVudGlsIHRoZSBzcGVjaWZpZWQgZW5kIHRpbWUsIHVzaW5nIHRoZSBzcGVjaWZpZWQgc2NoZWR1bGVyIHRvIHJ1biB0aW1lcnMuXG4gICAqIEBwYXJhbSB7TnVtYmVyIHwgRGF0ZX0gZW5kVGltZSBUaW1lIHRvIHN0b3AgdGFraW5nIGVsZW1lbnRzIGZyb20gdGhlIHNvdXJjZSBzZXF1ZW5jZS4gSWYgdGhpcyB2YWx1ZSBpcyBsZXNzIHRoYW4gb3IgZXF1YWwgdG8gbmV3IERhdGUoKSwgdGhlIHJlc3VsdCBzdHJlYW0gd2lsbCBjb21wbGV0ZSBpbW1lZGlhdGVseS5cbiAgICogQHBhcmFtIHtTY2hlZHVsZXJ9IFtzY2hlZHVsZXJdIFNjaGVkdWxlciB0byBydW4gdGhlIHRpbWVyIG9uLlxuICAgKiBAcmV0dXJucyB7T2JzZXJ2YWJsZX0gQW4gb2JzZXJ2YWJsZSBzZXF1ZW5jZSB3aXRoIHRoZSBlbGVtZW50cyB0YWtlbiB1bnRpbCB0aGUgc3BlY2lmaWVkIGVuZCB0aW1lLlxuICAgKi9cbiAgb2JzZXJ2YWJsZVByb3RvLnRha2VVbnRpbFdpdGhUaW1lID0gZnVuY3Rpb24gKGVuZFRpbWUsIHNjaGVkdWxlcikge1xuICAgIGlzU2NoZWR1bGVyKHNjaGVkdWxlcikgfHwgKHNjaGVkdWxlciA9IGRlZmF1bHRTY2hlZHVsZXIpO1xuICAgIHZhciBzb3VyY2UgPSB0aGlzO1xuICAgIHJldHVybiBuZXcgQW5vbnltb3VzT2JzZXJ2YWJsZShmdW5jdGlvbiAobykge1xuICAgICAgcmV0dXJuIG5ldyBCaW5hcnlEaXNwb3NhYmxlKFxuICAgICAgICBzY2hlZHVsZXIuc2NoZWR1bGVGdXR1cmUobywgZW5kVGltZSwgZnVuY3Rpb24gKF8sIG8pIHsgby5vbkNvbXBsZXRlZCgpOyB9KSxcbiAgICAgICAgc291cmNlLnN1YnNjcmliZShvKSk7XG4gICAgfSwgc291cmNlKTtcbiAgfTtcblxuICAvKipcbiAgICogUmV0dXJucyBhbiBPYnNlcnZhYmxlIHRoYXQgZW1pdHMgb25seSB0aGUgZmlyc3QgaXRlbSBlbWl0dGVkIGJ5IHRoZSBzb3VyY2UgT2JzZXJ2YWJsZSBkdXJpbmcgc2VxdWVudGlhbCB0aW1lIHdpbmRvd3Mgb2YgYSBzcGVjaWZpZWQgZHVyYXRpb24uXG4gICAqIEBwYXJhbSB7TnVtYmVyfSB3aW5kb3dEdXJhdGlvbiB0aW1lIHRvIHdhaXQgYmVmb3JlIGVtaXR0aW5nIGFub3RoZXIgaXRlbSBhZnRlciBlbWl0dGluZyB0aGUgbGFzdCBpdGVtXG4gICAqIEBwYXJhbSB7U2NoZWR1bGVyfSBbc2NoZWR1bGVyXSB0aGUgU2NoZWR1bGVyIHRvIHVzZSBpbnRlcm5hbGx5IHRvIG1hbmFnZSB0aGUgdGltZXJzIHRoYXQgaGFuZGxlIHRpbWVvdXQgZm9yIGVhY2ggaXRlbS4gSWYgbm90IHByb3ZpZGVkLCBkZWZhdWx0cyB0byBTY2hlZHVsZXIudGltZW91dC5cbiAgICogQHJldHVybnMge09ic2VydmFibGV9IEFuIE9ic2VydmFibGUgdGhhdCBwZXJmb3JtcyB0aGUgdGhyb3R0bGUgb3BlcmF0aW9uLlxuICAgKi9cbiAgb2JzZXJ2YWJsZVByb3RvLnRocm90dGxlID0gZnVuY3Rpb24gKHdpbmRvd0R1cmF0aW9uLCBzY2hlZHVsZXIpIHtcbiAgICBpc1NjaGVkdWxlcihzY2hlZHVsZXIpIHx8IChzY2hlZHVsZXIgPSBkZWZhdWx0U2NoZWR1bGVyKTtcbiAgICB2YXIgZHVyYXRpb24gPSArd2luZG93RHVyYXRpb24gfHwgMDtcbiAgICBpZiAoZHVyYXRpb24gPD0gMCkgeyB0aHJvdyBuZXcgUmFuZ2VFcnJvcignd2luZG93RHVyYXRpb24gY2Fubm90IGJlIGxlc3Mgb3IgZXF1YWwgemVyby4nKTsgfVxuICAgIHZhciBzb3VyY2UgPSB0aGlzO1xuICAgIHJldHVybiBuZXcgQW5vbnltb3VzT2JzZXJ2YWJsZShmdW5jdGlvbiAobykge1xuICAgICAgdmFyIGxhc3RPbk5leHQgPSAwO1xuICAgICAgcmV0dXJuIHNvdXJjZS5zdWJzY3JpYmUoXG4gICAgICAgIGZ1bmN0aW9uICh4KSB7XG4gICAgICAgICAgdmFyIG5vdyA9IHNjaGVkdWxlci5ub3coKTtcbiAgICAgICAgICBpZiAobGFzdE9uTmV4dCA9PT0gMCB8fCBub3cgLSBsYXN0T25OZXh0ID49IGR1cmF0aW9uKSB7XG4gICAgICAgICAgICBsYXN0T25OZXh0ID0gbm93O1xuICAgICAgICAgICAgby5vbk5leHQoeCk7XG4gICAgICAgICAgfVxuICAgICAgICB9LGZ1bmN0aW9uIChlKSB7IG8ub25FcnJvcihlKTsgfSwgZnVuY3Rpb24gKCkgeyBvLm9uQ29tcGxldGVkKCk7IH1cbiAgICAgICk7XG4gICAgfSwgc291cmNlKTtcbiAgfTtcblxuICB2YXIgVHJhbnNkdWNlT2JzZXJ2ZXIgPSAoZnVuY3Rpb24gKF9fc3VwZXJfXykge1xuICAgIGluaGVyaXRzKFRyYW5zZHVjZU9ic2VydmVyLCBfX3N1cGVyX18pO1xuICAgIGZ1bmN0aW9uIFRyYW5zZHVjZU9ic2VydmVyKG8sIHhmb3JtKSB7XG4gICAgICB0aGlzLl9vID0gbztcbiAgICAgIHRoaXMuX3hmb3JtID0geGZvcm07XG4gICAgICBfX3N1cGVyX18uY2FsbCh0aGlzKTtcbiAgICB9XG5cbiAgICBUcmFuc2R1Y2VPYnNlcnZlci5wcm90b3R5cGUubmV4dCA9IGZ1bmN0aW9uICh4KSB7XG4gICAgICB2YXIgcmVzID0gdHJ5Q2F0Y2godGhpcy5feGZvcm1bJ0BAdHJhbnNkdWNlci9zdGVwJ10pLmNhbGwodGhpcy5feGZvcm0sIHRoaXMuX28sIHgpO1xuICAgICAgaWYgKHJlcyA9PT0gZXJyb3JPYmopIHsgdGhpcy5fby5vbkVycm9yKHJlcy5lKTsgfVxuICAgIH07XG5cbiAgICBUcmFuc2R1Y2VPYnNlcnZlci5wcm90b3R5cGUuZXJyb3IgPSBmdW5jdGlvbiAoZSkgeyB0aGlzLl9vLm9uRXJyb3IoZSk7IH07XG5cbiAgICBUcmFuc2R1Y2VPYnNlcnZlci5wcm90b3R5cGUuY29tcGxldGVkID0gZnVuY3Rpb24gKCkge1xuICAgICAgdGhpcy5feGZvcm1bJ0BAdHJhbnNkdWNlci9yZXN1bHQnXSh0aGlzLl9vKTtcbiAgICB9O1xuXG4gICAgcmV0dXJuIFRyYW5zZHVjZU9ic2VydmVyO1xuICB9KEFic3RyYWN0T2JzZXJ2ZXIpKTtcblxuICBmdW5jdGlvbiB0cmFuc2Zvcm1Gb3JPYnNlcnZlcihvKSB7XG4gICAgcmV0dXJuIHtcbiAgICAgICdAQHRyYW5zZHVjZXIvaW5pdCc6IGZ1bmN0aW9uKCkge1xuICAgICAgICByZXR1cm4gbztcbiAgICAgIH0sXG4gICAgICAnQEB0cmFuc2R1Y2VyL3N0ZXAnOiBmdW5jdGlvbihvYnMsIGlucHV0KSB7XG4gICAgICAgIHJldHVybiBvYnMub25OZXh0KGlucHV0KTtcbiAgICAgIH0sXG4gICAgICAnQEB0cmFuc2R1Y2VyL3Jlc3VsdCc6IGZ1bmN0aW9uKG9icykge1xuICAgICAgICByZXR1cm4gb2JzLm9uQ29tcGxldGVkKCk7XG4gICAgICB9XG4gICAgfTtcbiAgfVxuXG4gIC8qKlxuICAgKiBFeGVjdXRlcyBhIHRyYW5zZHVjZXIgdG8gdHJhbnNmb3JtIHRoZSBvYnNlcnZhYmxlIHNlcXVlbmNlXG4gICAqIEBwYXJhbSB7VHJhbnNkdWNlcn0gdHJhbnNkdWNlciBBIHRyYW5zZHVjZXIgdG8gZXhlY3V0ZVxuICAgKiBAcmV0dXJucyB7T2JzZXJ2YWJsZX0gQW4gT2JzZXJ2YWJsZSBzZXF1ZW5jZSBjb250YWluaW5nIHRoZSByZXN1bHRzIGZyb20gdGhlIHRyYW5zZHVjZXIuXG4gICAqL1xuICBvYnNlcnZhYmxlUHJvdG8udHJhbnNkdWNlID0gZnVuY3Rpb24odHJhbnNkdWNlcikge1xuICAgIHZhciBzb3VyY2UgPSB0aGlzO1xuICAgIHJldHVybiBuZXcgQW5vbnltb3VzT2JzZXJ2YWJsZShmdW5jdGlvbihvKSB7XG4gICAgICB2YXIgeGZvcm0gPSB0cmFuc2R1Y2VyKHRyYW5zZm9ybUZvck9ic2VydmVyKG8pKTtcbiAgICAgIHJldHVybiBzb3VyY2Uuc3Vic2NyaWJlKG5ldyBUcmFuc2R1Y2VPYnNlcnZlcihvLCB4Zm9ybSkpO1xuICAgIH0sIHNvdXJjZSk7XG4gIH07XG5cbiAgLyoqXG4gICAqIFBlcmZvcm1zIGEgZXhjbHVzaXZlIHdhaXRpbmcgZm9yIHRoZSBmaXJzdCB0byBmaW5pc2ggYmVmb3JlIHN1YnNjcmliaW5nIHRvIGFub3RoZXIgb2JzZXJ2YWJsZS5cbiAgICogT2JzZXJ2YWJsZXMgdGhhdCBjb21lIGluIGJldHdlZW4gc3Vic2NyaXB0aW9ucyB3aWxsIGJlIGRyb3BwZWQgb24gdGhlIGZsb29yLlxuICAgKiBAcmV0dXJucyB7T2JzZXJ2YWJsZX0gQSBleGNsdXNpdmUgb2JzZXJ2YWJsZSB3aXRoIG9ubHkgdGhlIHJlc3VsdHMgdGhhdCBoYXBwZW4gd2hlbiBzdWJzY3JpYmVkLlxuICAgKi9cbiAgb2JzZXJ2YWJsZVByb3RvLnN3aXRjaEZpcnN0ID0gZnVuY3Rpb24gKCkge1xuICAgIHZhciBzb3VyY2VzID0gdGhpcztcbiAgICByZXR1cm4gbmV3IEFub255bW91c09ic2VydmFibGUoZnVuY3Rpb24gKG8pIHtcbiAgICAgIHZhciBoYXNDdXJyZW50ID0gZmFsc2UsXG4gICAgICAgIGlzU3RvcHBlZCA9IGZhbHNlLFxuICAgICAgICBtID0gbmV3IFNpbmdsZUFzc2lnbm1lbnREaXNwb3NhYmxlKCksXG4gICAgICAgIGcgPSBuZXcgQ29tcG9zaXRlRGlzcG9zYWJsZSgpO1xuXG4gICAgICBnLmFkZChtKTtcblxuICAgICAgbS5zZXREaXNwb3NhYmxlKHNvdXJjZXMuc3Vic2NyaWJlKFxuICAgICAgICBmdW5jdGlvbiAoaW5uZXJTb3VyY2UpIHtcbiAgICAgICAgICBpZiAoIWhhc0N1cnJlbnQpIHtcbiAgICAgICAgICAgIGhhc0N1cnJlbnQgPSB0cnVlO1xuXG4gICAgICAgICAgICBpc1Byb21pc2UoaW5uZXJTb3VyY2UpICYmIChpbm5lclNvdXJjZSA9IG9ic2VydmFibGVGcm9tUHJvbWlzZShpbm5lclNvdXJjZSkpO1xuXG4gICAgICAgICAgICB2YXIgaW5uZXJTdWJzY3JpcHRpb24gPSBuZXcgU2luZ2xlQXNzaWdubWVudERpc3Bvc2FibGUoKTtcbiAgICAgICAgICAgIGcuYWRkKGlubmVyU3Vic2NyaXB0aW9uKTtcblxuICAgICAgICAgICAgaW5uZXJTdWJzY3JpcHRpb24uc2V0RGlzcG9zYWJsZShpbm5lclNvdXJjZS5zdWJzY3JpYmUoXG4gICAgICAgICAgICAgIGZ1bmN0aW9uICh4KSB7IG8ub25OZXh0KHgpOyB9LFxuICAgICAgICAgICAgICBmdW5jdGlvbiAoZSkgeyBvLm9uRXJyb3IoZSk7IH0sXG4gICAgICAgICAgICAgIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICBnLnJlbW92ZShpbm5lclN1YnNjcmlwdGlvbik7XG4gICAgICAgICAgICAgICAgaGFzQ3VycmVudCA9IGZhbHNlO1xuICAgICAgICAgICAgICAgIGlzU3RvcHBlZCAmJiBnLmxlbmd0aCA9PT0gMSAmJiBvLm9uQ29tcGxldGVkKCk7XG4gICAgICAgICAgICB9KSk7XG4gICAgICAgICAgfVxuICAgICAgICB9LFxuICAgICAgICBmdW5jdGlvbiAoZSkgeyBvLm9uRXJyb3IoZSk7IH0sXG4gICAgICAgIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICBpc1N0b3BwZWQgPSB0cnVlO1xuICAgICAgICAgICFoYXNDdXJyZW50ICYmIGcubGVuZ3RoID09PSAxICYmIG8ub25Db21wbGV0ZWQoKTtcbiAgICAgICAgfSkpO1xuXG4gICAgICByZXR1cm4gZztcbiAgICB9LCB0aGlzKTtcbiAgfTtcblxub2JzZXJ2YWJsZVByb3RvLmZsYXRNYXBGaXJzdCA9IG9ic2VydmFibGVQcm90by5zZWxlY3RNYW55Rmlyc3QgPSBmdW5jdGlvbihzZWxlY3RvciwgcmVzdWx0U2VsZWN0b3IsIHRoaXNBcmcpIHtcbiAgICByZXR1cm4gbmV3IEZsYXRNYXBPYnNlcnZhYmxlKHRoaXMsIHNlbGVjdG9yLCByZXN1bHRTZWxlY3RvciwgdGhpc0FyZykuc3dpdGNoRmlyc3QoKTtcbn07XG5cblJ4Lk9ic2VydmFibGUucHJvdG90eXBlLmZsYXRNYXBXaXRoTWF4Q29uY3VycmVudCA9IGZ1bmN0aW9uKGxpbWl0LCBzZWxlY3RvciwgcmVzdWx0U2VsZWN0b3IsIHRoaXNBcmcpIHtcbiAgICByZXR1cm4gbmV3IEZsYXRNYXBPYnNlcnZhYmxlKHRoaXMsIHNlbGVjdG9yLCByZXN1bHRTZWxlY3RvciwgdGhpc0FyZykubWVyZ2UobGltaXQpO1xufTtcbiAgLyoqIFByb3ZpZGVzIGEgc2V0IG9mIGV4dGVuc2lvbiBtZXRob2RzIGZvciB2aXJ0dWFsIHRpbWUgc2NoZWR1bGluZy4gKi9cbiAgdmFyIFZpcnR1YWxUaW1lU2NoZWR1bGVyID0gUnguVmlydHVhbFRpbWVTY2hlZHVsZXIgPSAoZnVuY3Rpb24gKF9fc3VwZXJfXykge1xuICAgIGluaGVyaXRzKFZpcnR1YWxUaW1lU2NoZWR1bGVyLCBfX3N1cGVyX18pO1xuXG4gICAgLyoqXG4gICAgICogQ3JlYXRlcyBhIG5ldyB2aXJ0dWFsIHRpbWUgc2NoZWR1bGVyIHdpdGggdGhlIHNwZWNpZmllZCBpbml0aWFsIGNsb2NrIHZhbHVlIGFuZCBhYnNvbHV0ZSB0aW1lIGNvbXBhcmVyLlxuICAgICAqXG4gICAgICogQGNvbnN0cnVjdG9yXG4gICAgICogQHBhcmFtIHtOdW1iZXJ9IGluaXRpYWxDbG9jayBJbml0aWFsIHZhbHVlIGZvciB0aGUgY2xvY2suXG4gICAgICogQHBhcmFtIHtGdW5jdGlvbn0gY29tcGFyZXIgQ29tcGFyZXIgdG8gZGV0ZXJtaW5lIGNhdXNhbGl0eSBvZiBldmVudHMgYmFzZWQgb24gYWJzb2x1dGUgdGltZS5cbiAgICAgKi9cbiAgICBmdW5jdGlvbiBWaXJ0dWFsVGltZVNjaGVkdWxlcihpbml0aWFsQ2xvY2ssIGNvbXBhcmVyKSB7XG4gICAgICB0aGlzLmNsb2NrID0gaW5pdGlhbENsb2NrO1xuICAgICAgdGhpcy5jb21wYXJlciA9IGNvbXBhcmVyO1xuICAgICAgdGhpcy5pc0VuYWJsZWQgPSBmYWxzZTtcbiAgICAgIHRoaXMucXVldWUgPSBuZXcgUHJpb3JpdHlRdWV1ZSgxMDI0KTtcbiAgICAgIF9fc3VwZXJfXy5jYWxsKHRoaXMpO1xuICAgIH1cblxuICAgIHZhciBWaXJ0dWFsVGltZVNjaGVkdWxlclByb3RvdHlwZSA9IFZpcnR1YWxUaW1lU2NoZWR1bGVyLnByb3RvdHlwZTtcblxuICAgIFZpcnR1YWxUaW1lU2NoZWR1bGVyUHJvdG90eXBlLm5vdyA9IGZ1bmN0aW9uICgpIHtcbiAgICAgIHJldHVybiB0aGlzLnRvQWJzb2x1dGVUaW1lKHRoaXMuY2xvY2spO1xuICAgIH07XG5cbiAgICBWaXJ0dWFsVGltZVNjaGVkdWxlclByb3RvdHlwZS5zY2hlZHVsZSA9IGZ1bmN0aW9uIChzdGF0ZSwgYWN0aW9uKSB7XG4gICAgICByZXR1cm4gdGhpcy5zY2hlZHVsZUFic29sdXRlKHN0YXRlLCB0aGlzLmNsb2NrLCBhY3Rpb24pO1xuICAgIH07XG5cbiAgICBWaXJ0dWFsVGltZVNjaGVkdWxlclByb3RvdHlwZS5zY2hlZHVsZUZ1dHVyZSA9IGZ1bmN0aW9uIChzdGF0ZSwgZHVlVGltZSwgYWN0aW9uKSB7XG4gICAgICB2YXIgZHQgPSBkdWVUaW1lIGluc3RhbmNlb2YgRGF0ZSA/XG4gICAgICAgIHRoaXMudG9SZWxhdGl2ZVRpbWUoZHVlVGltZSAtIHRoaXMubm93KCkpIDpcbiAgICAgICAgdGhpcy50b1JlbGF0aXZlVGltZShkdWVUaW1lKTtcblxuICAgICAgcmV0dXJuIHRoaXMuc2NoZWR1bGVSZWxhdGl2ZShzdGF0ZSwgZHQsIGFjdGlvbik7XG4gICAgfTtcblxuICAgIC8qKlxuICAgICAqIEFkZHMgYSByZWxhdGl2ZSB0aW1lIHZhbHVlIHRvIGFuIGFic29sdXRlIHRpbWUgdmFsdWUuXG4gICAgICogQHBhcmFtIHtOdW1iZXJ9IGFic29sdXRlIEFic29sdXRlIHZpcnR1YWwgdGltZSB2YWx1ZS5cbiAgICAgKiBAcGFyYW0ge051bWJlcn0gcmVsYXRpdmUgUmVsYXRpdmUgdmlydHVhbCB0aW1lIHZhbHVlIHRvIGFkZC5cbiAgICAgKiBAcmV0dXJuIHtOdW1iZXJ9IFJlc3VsdGluZyBhYnNvbHV0ZSB2aXJ0dWFsIHRpbWUgc3VtIHZhbHVlLlxuICAgICAqL1xuICAgIFZpcnR1YWxUaW1lU2NoZWR1bGVyUHJvdG90eXBlLmFkZCA9IG5vdEltcGxlbWVudGVkO1xuXG4gICAgLyoqXG4gICAgICogQ29udmVydHMgYW4gYWJzb2x1dGUgdGltZSB0byBhIG51bWJlclxuICAgICAqIEBwYXJhbSB7QW55fSBUaGUgYWJzb2x1dGUgdGltZS5cbiAgICAgKiBAcmV0dXJucyB7TnVtYmVyfSBUaGUgYWJzb2x1dGUgdGltZSBpbiBtc1xuICAgICAqL1xuICAgIFZpcnR1YWxUaW1lU2NoZWR1bGVyUHJvdG90eXBlLnRvQWJzb2x1dGVUaW1lID0gbm90SW1wbGVtZW50ZWQ7XG5cbiAgICAvKipcbiAgICAgKiBDb252ZXJ0cyB0aGUgVGltZVNwYW4gdmFsdWUgdG8gYSByZWxhdGl2ZSB2aXJ0dWFsIHRpbWUgdmFsdWUuXG4gICAgICogQHBhcmFtIHtOdW1iZXJ9IHRpbWVTcGFuIFRpbWVTcGFuIHZhbHVlIHRvIGNvbnZlcnQuXG4gICAgICogQHJldHVybiB7TnVtYmVyfSBDb3JyZXNwb25kaW5nIHJlbGF0aXZlIHZpcnR1YWwgdGltZSB2YWx1ZS5cbiAgICAgKi9cbiAgICBWaXJ0dWFsVGltZVNjaGVkdWxlclByb3RvdHlwZS50b1JlbGF0aXZlVGltZSA9IG5vdEltcGxlbWVudGVkO1xuXG4gICAgLyoqXG4gICAgICogU2NoZWR1bGVzIGEgcGVyaW9kaWMgcGllY2Ugb2Ygd29yayBieSBkeW5hbWljYWxseSBkaXNjb3ZlcmluZyB0aGUgc2NoZWR1bGVyJ3MgY2FwYWJpbGl0aWVzLiBUaGUgcGVyaW9kaWMgdGFzayB3aWxsIGJlIGVtdWxhdGVkIHVzaW5nIHJlY3Vyc2l2ZSBzY2hlZHVsaW5nLlxuICAgICAqIEBwYXJhbSB7TWl4ZWR9IHN0YXRlIEluaXRpYWwgc3RhdGUgcGFzc2VkIHRvIHRoZSBhY3Rpb24gdXBvbiB0aGUgZmlyc3QgaXRlcmF0aW9uLlxuICAgICAqIEBwYXJhbSB7TnVtYmVyfSBwZXJpb2QgUGVyaW9kIGZvciBydW5uaW5nIHRoZSB3b3JrIHBlcmlvZGljYWxseS5cbiAgICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBhY3Rpb24gQWN0aW9uIHRvIGJlIGV4ZWN1dGVkLCBwb3RlbnRpYWxseSB1cGRhdGluZyB0aGUgc3RhdGUuXG4gICAgICogQHJldHVybnMge0Rpc3Bvc2FibGV9IFRoZSBkaXNwb3NhYmxlIG9iamVjdCB1c2VkIHRvIGNhbmNlbCB0aGUgc2NoZWR1bGVkIHJlY3VycmluZyBhY3Rpb24gKGJlc3QgZWZmb3J0KS5cbiAgICAgKi9cbiAgICBWaXJ0dWFsVGltZVNjaGVkdWxlclByb3RvdHlwZS5zY2hlZHVsZVBlcmlvZGljID0gZnVuY3Rpb24gKHN0YXRlLCBwZXJpb2QsIGFjdGlvbikge1xuICAgICAgdmFyIHMgPSBuZXcgU2NoZWR1bGVQZXJpb2RpY1JlY3Vyc2l2ZSh0aGlzLCBzdGF0ZSwgcGVyaW9kLCBhY3Rpb24pO1xuICAgICAgcmV0dXJuIHMuc3RhcnQoKTtcbiAgICB9O1xuXG4gICAgLyoqXG4gICAgICogU2NoZWR1bGVzIGFuIGFjdGlvbiB0byBiZSBleGVjdXRlZCBhZnRlciBkdWVUaW1lLlxuICAgICAqIEBwYXJhbSB7TWl4ZWR9IHN0YXRlIFN0YXRlIHBhc3NlZCB0byB0aGUgYWN0aW9uIHRvIGJlIGV4ZWN1dGVkLlxuICAgICAqIEBwYXJhbSB7TnVtYmVyfSBkdWVUaW1lIFJlbGF0aXZlIHRpbWUgYWZ0ZXIgd2hpY2ggdG8gZXhlY3V0ZSB0aGUgYWN0aW9uLlxuICAgICAqIEBwYXJhbSB7RnVuY3Rpb259IGFjdGlvbiBBY3Rpb24gdG8gYmUgZXhlY3V0ZWQuXG4gICAgICogQHJldHVybnMge0Rpc3Bvc2FibGV9IFRoZSBkaXNwb3NhYmxlIG9iamVjdCB1c2VkIHRvIGNhbmNlbCB0aGUgc2NoZWR1bGVkIGFjdGlvbiAoYmVzdCBlZmZvcnQpLlxuICAgICAqL1xuICAgIFZpcnR1YWxUaW1lU2NoZWR1bGVyUHJvdG90eXBlLnNjaGVkdWxlUmVsYXRpdmUgPSBmdW5jdGlvbiAoc3RhdGUsIGR1ZVRpbWUsIGFjdGlvbikge1xuICAgICAgdmFyIHJ1bkF0ID0gdGhpcy5hZGQodGhpcy5jbG9jaywgZHVlVGltZSk7XG4gICAgICByZXR1cm4gdGhpcy5zY2hlZHVsZUFic29sdXRlKHN0YXRlLCBydW5BdCwgYWN0aW9uKTtcbiAgICB9O1xuXG4gICAgLyoqXG4gICAgICogU3RhcnRzIHRoZSB2aXJ0dWFsIHRpbWUgc2NoZWR1bGVyLlxuICAgICAqL1xuICAgIFZpcnR1YWxUaW1lU2NoZWR1bGVyUHJvdG90eXBlLnN0YXJ0ID0gZnVuY3Rpb24gKCkge1xuICAgICAgaWYgKCF0aGlzLmlzRW5hYmxlZCkge1xuICAgICAgICB0aGlzLmlzRW5hYmxlZCA9IHRydWU7XG4gICAgICAgIGRvIHtcbiAgICAgICAgICB2YXIgbmV4dCA9IHRoaXMuZ2V0TmV4dCgpO1xuICAgICAgICAgIGlmIChuZXh0ICE9PSBudWxsKSB7XG4gICAgICAgICAgICB0aGlzLmNvbXBhcmVyKG5leHQuZHVlVGltZSwgdGhpcy5jbG9jaykgPiAwICYmICh0aGlzLmNsb2NrID0gbmV4dC5kdWVUaW1lKTtcbiAgICAgICAgICAgIG5leHQuaW52b2tlKCk7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMuaXNFbmFibGVkID0gZmFsc2U7XG4gICAgICAgICAgfVxuICAgICAgICB9IHdoaWxlICh0aGlzLmlzRW5hYmxlZCk7XG4gICAgICB9XG4gICAgfTtcblxuICAgIC8qKlxuICAgICAqIFN0b3BzIHRoZSB2aXJ0dWFsIHRpbWUgc2NoZWR1bGVyLlxuICAgICAqL1xuICAgIFZpcnR1YWxUaW1lU2NoZWR1bGVyUHJvdG90eXBlLnN0b3AgPSBmdW5jdGlvbiAoKSB7XG4gICAgICB0aGlzLmlzRW5hYmxlZCA9IGZhbHNlO1xuICAgIH07XG5cbiAgICAvKipcbiAgICAgKiBBZHZhbmNlcyB0aGUgc2NoZWR1bGVyJ3MgY2xvY2sgdG8gdGhlIHNwZWNpZmllZCB0aW1lLCBydW5uaW5nIGFsbCB3b3JrIHRpbGwgdGhhdCBwb2ludC5cbiAgICAgKiBAcGFyYW0ge051bWJlcn0gdGltZSBBYnNvbHV0ZSB0aW1lIHRvIGFkdmFuY2UgdGhlIHNjaGVkdWxlcidzIGNsb2NrIHRvLlxuICAgICAqL1xuICAgIFZpcnR1YWxUaW1lU2NoZWR1bGVyUHJvdG90eXBlLmFkdmFuY2VUbyA9IGZ1bmN0aW9uICh0aW1lKSB7XG4gICAgICB2YXIgZHVlVG9DbG9jayA9IHRoaXMuY29tcGFyZXIodGhpcy5jbG9jaywgdGltZSk7XG4gICAgICBpZiAodGhpcy5jb21wYXJlcih0aGlzLmNsb2NrLCB0aW1lKSA+IDApIHsgdGhyb3cgbmV3IEFyZ3VtZW50T3V0T2ZSYW5nZUVycm9yKCk7IH1cbiAgICAgIGlmIChkdWVUb0Nsb2NrID09PSAwKSB7IHJldHVybjsgfVxuICAgICAgaWYgKCF0aGlzLmlzRW5hYmxlZCkge1xuICAgICAgICB0aGlzLmlzRW5hYmxlZCA9IHRydWU7XG4gICAgICAgIGRvIHtcbiAgICAgICAgICB2YXIgbmV4dCA9IHRoaXMuZ2V0TmV4dCgpO1xuICAgICAgICAgIGlmIChuZXh0ICE9PSBudWxsICYmIHRoaXMuY29tcGFyZXIobmV4dC5kdWVUaW1lLCB0aW1lKSA8PSAwKSB7XG4gICAgICAgICAgICB0aGlzLmNvbXBhcmVyKG5leHQuZHVlVGltZSwgdGhpcy5jbG9jaykgPiAwICYmICh0aGlzLmNsb2NrID0gbmV4dC5kdWVUaW1lKTtcbiAgICAgICAgICAgIG5leHQuaW52b2tlKCk7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMuaXNFbmFibGVkID0gZmFsc2U7XG4gICAgICAgICAgfVxuICAgICAgICB9IHdoaWxlICh0aGlzLmlzRW5hYmxlZCk7XG4gICAgICAgIHRoaXMuY2xvY2sgPSB0aW1lO1xuICAgICAgfVxuICAgIH07XG5cbiAgICAvKipcbiAgICAgKiBBZHZhbmNlcyB0aGUgc2NoZWR1bGVyJ3MgY2xvY2sgYnkgdGhlIHNwZWNpZmllZCByZWxhdGl2ZSB0aW1lLCBydW5uaW5nIGFsbCB3b3JrIHNjaGVkdWxlZCBmb3IgdGhhdCB0aW1lc3Bhbi5cbiAgICAgKiBAcGFyYW0ge051bWJlcn0gdGltZSBSZWxhdGl2ZSB0aW1lIHRvIGFkdmFuY2UgdGhlIHNjaGVkdWxlcidzIGNsb2NrIGJ5LlxuICAgICAqL1xuICAgIFZpcnR1YWxUaW1lU2NoZWR1bGVyUHJvdG90eXBlLmFkdmFuY2VCeSA9IGZ1bmN0aW9uICh0aW1lKSB7XG4gICAgICB2YXIgZHQgPSB0aGlzLmFkZCh0aGlzLmNsb2NrLCB0aW1lKSxcbiAgICAgICAgICBkdWVUb0Nsb2NrID0gdGhpcy5jb21wYXJlcih0aGlzLmNsb2NrLCBkdCk7XG4gICAgICBpZiAoZHVlVG9DbG9jayA+IDApIHsgdGhyb3cgbmV3IEFyZ3VtZW50T3V0T2ZSYW5nZUVycm9yKCk7IH1cbiAgICAgIGlmIChkdWVUb0Nsb2NrID09PSAwKSB7ICByZXR1cm47IH1cblxuICAgICAgdGhpcy5hZHZhbmNlVG8oZHQpO1xuICAgIH07XG5cbiAgICAvKipcbiAgICAgKiBBZHZhbmNlcyB0aGUgc2NoZWR1bGVyJ3MgY2xvY2sgYnkgdGhlIHNwZWNpZmllZCByZWxhdGl2ZSB0aW1lLlxuICAgICAqIEBwYXJhbSB7TnVtYmVyfSB0aW1lIFJlbGF0aXZlIHRpbWUgdG8gYWR2YW5jZSB0aGUgc2NoZWR1bGVyJ3MgY2xvY2sgYnkuXG4gICAgICovXG4gICAgVmlydHVhbFRpbWVTY2hlZHVsZXJQcm90b3R5cGUuc2xlZXAgPSBmdW5jdGlvbiAodGltZSkge1xuICAgICAgdmFyIGR0ID0gdGhpcy5hZGQodGhpcy5jbG9jaywgdGltZSk7XG4gICAgICBpZiAodGhpcy5jb21wYXJlcih0aGlzLmNsb2NrLCBkdCkgPj0gMCkgeyB0aHJvdyBuZXcgQXJndW1lbnRPdXRPZlJhbmdlRXJyb3IoKTsgfVxuXG4gICAgICB0aGlzLmNsb2NrID0gZHQ7XG4gICAgfTtcblxuICAgIC8qKlxuICAgICAqIEdldHMgdGhlIG5leHQgc2NoZWR1bGVkIGl0ZW0gdG8gYmUgZXhlY3V0ZWQuXG4gICAgICogQHJldHVybnMge1NjaGVkdWxlZEl0ZW19IFRoZSBuZXh0IHNjaGVkdWxlZCBpdGVtLlxuICAgICAqL1xuICAgIFZpcnR1YWxUaW1lU2NoZWR1bGVyUHJvdG90eXBlLmdldE5leHQgPSBmdW5jdGlvbiAoKSB7XG4gICAgICB3aGlsZSAodGhpcy5xdWV1ZS5sZW5ndGggPiAwKSB7XG4gICAgICAgIHZhciBuZXh0ID0gdGhpcy5xdWV1ZS5wZWVrKCk7XG4gICAgICAgIGlmIChuZXh0LmlzQ2FuY2VsbGVkKCkpIHtcbiAgICAgICAgICB0aGlzLnF1ZXVlLmRlcXVldWUoKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICByZXR1cm4gbmV4dDtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgcmV0dXJuIG51bGw7XG4gICAgfTtcblxuICAgIC8qKlxuICAgICAqIFNjaGVkdWxlcyBhbiBhY3Rpb24gdG8gYmUgZXhlY3V0ZWQgYXQgZHVlVGltZS5cbiAgICAgKiBAcGFyYW0ge01peGVkfSBzdGF0ZSBTdGF0ZSBwYXNzZWQgdG8gdGhlIGFjdGlvbiB0byBiZSBleGVjdXRlZC5cbiAgICAgKiBAcGFyYW0ge051bWJlcn0gZHVlVGltZSBBYnNvbHV0ZSB0aW1lIGF0IHdoaWNoIHRvIGV4ZWN1dGUgdGhlIGFjdGlvbi5cbiAgICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBhY3Rpb24gQWN0aW9uIHRvIGJlIGV4ZWN1dGVkLlxuICAgICAqIEByZXR1cm5zIHtEaXNwb3NhYmxlfSBUaGUgZGlzcG9zYWJsZSBvYmplY3QgdXNlZCB0byBjYW5jZWwgdGhlIHNjaGVkdWxlZCBhY3Rpb24gKGJlc3QgZWZmb3J0KS5cbiAgICAgKi9cbiAgICBWaXJ0dWFsVGltZVNjaGVkdWxlclByb3RvdHlwZS5zY2hlZHVsZUFic29sdXRlID0gZnVuY3Rpb24gKHN0YXRlLCBkdWVUaW1lLCBhY3Rpb24pIHtcbiAgICAgIHZhciBzZWxmID0gdGhpcztcblxuICAgICAgZnVuY3Rpb24gcnVuKHNjaGVkdWxlciwgc3RhdGUxKSB7XG4gICAgICAgIHNlbGYucXVldWUucmVtb3ZlKHNpKTtcbiAgICAgICAgcmV0dXJuIGFjdGlvbihzY2hlZHVsZXIsIHN0YXRlMSk7XG4gICAgICB9XG5cbiAgICAgIHZhciBzaSA9IG5ldyBTY2hlZHVsZWRJdGVtKHRoaXMsIHN0YXRlLCBydW4sIGR1ZVRpbWUsIHRoaXMuY29tcGFyZXIpO1xuICAgICAgdGhpcy5xdWV1ZS5lbnF1ZXVlKHNpKTtcblxuICAgICAgcmV0dXJuIHNpLmRpc3Bvc2FibGU7XG4gICAgfTtcblxuICAgIHJldHVybiBWaXJ0dWFsVGltZVNjaGVkdWxlcjtcbiAgfShTY2hlZHVsZXIpKTtcblxuICAvKiogUHJvdmlkZXMgYSB2aXJ0dWFsIHRpbWUgc2NoZWR1bGVyIHRoYXQgdXNlcyBEYXRlIGZvciBhYnNvbHV0ZSB0aW1lIGFuZCBudW1iZXIgZm9yIHJlbGF0aXZlIHRpbWUuICovXG4gIFJ4Lkhpc3RvcmljYWxTY2hlZHVsZXIgPSAoZnVuY3Rpb24gKF9fc3VwZXJfXykge1xuICAgIGluaGVyaXRzKEhpc3RvcmljYWxTY2hlZHVsZXIsIF9fc3VwZXJfXyk7XG5cbiAgICAvKipcbiAgICAgKiBDcmVhdGVzIGEgbmV3IGhpc3RvcmljYWwgc2NoZWR1bGVyIHdpdGggdGhlIHNwZWNpZmllZCBpbml0aWFsIGNsb2NrIHZhbHVlLlxuICAgICAqIEBjb25zdHJ1Y3RvclxuICAgICAqIEBwYXJhbSB7TnVtYmVyfSBpbml0aWFsQ2xvY2sgSW5pdGlhbCB2YWx1ZSBmb3IgdGhlIGNsb2NrLlxuICAgICAqIEBwYXJhbSB7RnVuY3Rpb259IGNvbXBhcmVyIENvbXBhcmVyIHRvIGRldGVybWluZSBjYXVzYWxpdHkgb2YgZXZlbnRzIGJhc2VkIG9uIGFic29sdXRlIHRpbWUuXG4gICAgICovXG4gICAgZnVuY3Rpb24gSGlzdG9yaWNhbFNjaGVkdWxlcihpbml0aWFsQ2xvY2ssIGNvbXBhcmVyKSB7XG4gICAgICB2YXIgY2xvY2sgPSBpbml0aWFsQ2xvY2sgPT0gbnVsbCA/IDAgOiBpbml0aWFsQ2xvY2s7XG4gICAgICB2YXIgY21wID0gY29tcGFyZXIgfHwgZGVmYXVsdFN1YkNvbXBhcmVyO1xuICAgICAgX19zdXBlcl9fLmNhbGwodGhpcywgY2xvY2ssIGNtcCk7XG4gICAgfVxuXG4gICAgdmFyIEhpc3RvcmljYWxTY2hlZHVsZXJQcm90byA9IEhpc3RvcmljYWxTY2hlZHVsZXIucHJvdG90eXBlO1xuXG4gICAgLyoqXG4gICAgICogQWRkcyBhIHJlbGF0aXZlIHRpbWUgdmFsdWUgdG8gYW4gYWJzb2x1dGUgdGltZSB2YWx1ZS5cbiAgICAgKiBAcGFyYW0ge051bWJlcn0gYWJzb2x1dGUgQWJzb2x1dGUgdmlydHVhbCB0aW1lIHZhbHVlLlxuICAgICAqIEBwYXJhbSB7TnVtYmVyfSByZWxhdGl2ZSBSZWxhdGl2ZSB2aXJ0dWFsIHRpbWUgdmFsdWUgdG8gYWRkLlxuICAgICAqIEByZXR1cm4ge051bWJlcn0gUmVzdWx0aW5nIGFic29sdXRlIHZpcnR1YWwgdGltZSBzdW0gdmFsdWUuXG4gICAgICovXG4gICAgSGlzdG9yaWNhbFNjaGVkdWxlclByb3RvLmFkZCA9IGZ1bmN0aW9uIChhYnNvbHV0ZSwgcmVsYXRpdmUpIHtcbiAgICAgIHJldHVybiBhYnNvbHV0ZSArIHJlbGF0aXZlO1xuICAgIH07XG5cbiAgICBIaXN0b3JpY2FsU2NoZWR1bGVyUHJvdG8udG9BYnNvbHV0ZVRpbWUgPSBmdW5jdGlvbiAoYWJzb2x1dGUpIHtcbiAgICAgIHJldHVybiBuZXcgRGF0ZShhYnNvbHV0ZSkuZ2V0VGltZSgpO1xuICAgIH07XG5cbiAgICAvKipcbiAgICAgKiBDb252ZXJ0cyB0aGUgVGltZVNwYW4gdmFsdWUgdG8gYSByZWxhdGl2ZSB2aXJ0dWFsIHRpbWUgdmFsdWUuXG4gICAgICogQG1lbWJlck9mIEhpc3RvcmljYWxTY2hlZHVsZXJcbiAgICAgKiBAcGFyYW0ge051bWJlcn0gdGltZVNwYW4gVGltZVNwYW4gdmFsdWUgdG8gY29udmVydC5cbiAgICAgKiBAcmV0dXJuIHtOdW1iZXJ9IENvcnJlc3BvbmRpbmcgcmVsYXRpdmUgdmlydHVhbCB0aW1lIHZhbHVlLlxuICAgICAqL1xuICAgIEhpc3RvcmljYWxTY2hlZHVsZXJQcm90by50b1JlbGF0aXZlVGltZSA9IGZ1bmN0aW9uICh0aW1lU3Bhbikge1xuICAgICAgcmV0dXJuIHRpbWVTcGFuO1xuICAgIH07XG5cbiAgICByZXR1cm4gSGlzdG9yaWNhbFNjaGVkdWxlcjtcbiAgfShSeC5WaXJ0dWFsVGltZVNjaGVkdWxlcikpO1xuXG5mdW5jdGlvbiBPbk5leHRQcmVkaWNhdGUocHJlZGljYXRlKSB7XG4gICAgdGhpcy5wcmVkaWNhdGUgPSBwcmVkaWNhdGU7XG59XG5cbk9uTmV4dFByZWRpY2F0ZS5wcm90b3R5cGUuZXF1YWxzID0gZnVuY3Rpb24gKG90aGVyKSB7XG4gIGlmIChvdGhlciA9PT0gdGhpcykgeyByZXR1cm4gdHJ1ZTsgfVxuICBpZiAob3RoZXIgPT0gbnVsbCkgeyByZXR1cm4gZmFsc2U7IH1cbiAgaWYgKG90aGVyLmtpbmQgIT09ICdOJykgeyByZXR1cm4gZmFsc2U7IH1cbiAgcmV0dXJuIHRoaXMucHJlZGljYXRlKG90aGVyLnZhbHVlKTtcbn07XG5cbmZ1bmN0aW9uIE9uRXJyb3JQcmVkaWNhdGUocHJlZGljYXRlKSB7XG4gIHRoaXMucHJlZGljYXRlID0gcHJlZGljYXRlO1xufVxuXG5PbkVycm9yUHJlZGljYXRlLnByb3RvdHlwZS5lcXVhbHMgPSBmdW5jdGlvbiAob3RoZXIpIHtcbiAgaWYgKG90aGVyID09PSB0aGlzKSB7IHJldHVybiB0cnVlOyB9XG4gIGlmIChvdGhlciA9PSBudWxsKSB7IHJldHVybiBmYWxzZTsgfVxuICBpZiAob3RoZXIua2luZCAhPT0gJ0UnKSB7IHJldHVybiBmYWxzZTsgfVxuICByZXR1cm4gdGhpcy5wcmVkaWNhdGUob3RoZXIuZXJyb3IpO1xufTtcblxudmFyIFJlYWN0aXZlVGVzdCA9IFJ4LlJlYWN0aXZlVGVzdCA9IHtcbiAgLyoqIERlZmF1bHQgdmlydHVhbCB0aW1lIHVzZWQgZm9yIGNyZWF0aW9uIG9mIG9ic2VydmFibGUgc2VxdWVuY2VzIGluIHVuaXQgdGVzdHMuICovXG4gIGNyZWF0ZWQ6IDEwMCxcbiAgLyoqIERlZmF1bHQgdmlydHVhbCB0aW1lIHVzZWQgdG8gc3Vic2NyaWJlIHRvIG9ic2VydmFibGUgc2VxdWVuY2VzIGluIHVuaXQgdGVzdHMuICovXG4gIHN1YnNjcmliZWQ6IDIwMCxcbiAgLyoqIERlZmF1bHQgdmlydHVhbCB0aW1lIHVzZWQgdG8gZGlzcG9zZSBzdWJzY3JpcHRpb25zIGluIHVuaXQgdGVzdHMuICovXG4gIGRpc3Bvc2VkOiAxMDAwLFxuXG4gIC8qKlxuICAgKiBGYWN0b3J5IG1ldGhvZCBmb3IgYW4gT25OZXh0IG5vdGlmaWNhdGlvbiByZWNvcmQgYXQgYSBnaXZlbiB0aW1lIHdpdGggYSBnaXZlbiB2YWx1ZSBvciBhIHByZWRpY2F0ZSBmdW5jdGlvbi5cbiAgICpcbiAgICogMSAtIFJlYWN0aXZlVGVzdC5vbk5leHQoMjAwLCA0Mik7XG4gICAqIDIgLSBSZWFjdGl2ZVRlc3Qub25OZXh0KDIwMCwgZnVuY3Rpb24gKHgpIHsgcmV0dXJuIHgubGVuZ3RoID09IDI7IH0pO1xuICAgKlxuICAgKiBAcGFyYW0gdGlja3MgUmVjb3JkZWQgdmlydHVhbCB0aW1lIHRoZSBPbk5leHQgbm90aWZpY2F0aW9uIG9jY3Vycy5cbiAgICogQHBhcmFtIHZhbHVlIFJlY29yZGVkIHZhbHVlIHN0b3JlZCBpbiB0aGUgT25OZXh0IG5vdGlmaWNhdGlvbiBvciBhIHByZWRpY2F0ZS5cbiAgICogQHJldHVybiBSZWNvcmRlZCBPbk5leHQgbm90aWZpY2F0aW9uLlxuICAgKi9cbiAgb25OZXh0OiBmdW5jdGlvbiAodGlja3MsIHZhbHVlKSB7XG4gICAgcmV0dXJuIHR5cGVvZiB2YWx1ZSA9PT0gJ2Z1bmN0aW9uJyA/XG4gICAgICBuZXcgUmVjb3JkZWQodGlja3MsIG5ldyBPbk5leHRQcmVkaWNhdGUodmFsdWUpKSA6XG4gICAgICBuZXcgUmVjb3JkZWQodGlja3MsIE5vdGlmaWNhdGlvbi5jcmVhdGVPbk5leHQodmFsdWUpKTtcbiAgfSxcbiAgLyoqXG4gICAqIEZhY3RvcnkgbWV0aG9kIGZvciBhbiBPbkVycm9yIG5vdGlmaWNhdGlvbiByZWNvcmQgYXQgYSBnaXZlbiB0aW1lIHdpdGggYSBnaXZlbiBlcnJvci5cbiAgICpcbiAgICogMSAtIFJlYWN0aXZlVGVzdC5vbk5leHQoMjAwLCBuZXcgRXJyb3IoJ2Vycm9yJykpO1xuICAgKiAyIC0gUmVhY3RpdmVUZXN0Lm9uTmV4dCgyMDAsIGZ1bmN0aW9uIChlKSB7IHJldHVybiBlLm1lc3NhZ2UgPT09ICdlcnJvcic7IH0pO1xuICAgKlxuICAgKiBAcGFyYW0gdGlja3MgUmVjb3JkZWQgdmlydHVhbCB0aW1lIHRoZSBPbkVycm9yIG5vdGlmaWNhdGlvbiBvY2N1cnMuXG4gICAqIEBwYXJhbSBleGNlcHRpb24gUmVjb3JkZWQgZXhjZXB0aW9uIHN0b3JlZCBpbiB0aGUgT25FcnJvciBub3RpZmljYXRpb24uXG4gICAqIEByZXR1cm4gUmVjb3JkZWQgT25FcnJvciBub3RpZmljYXRpb24uXG4gICAqL1xuICBvbkVycm9yOiBmdW5jdGlvbiAodGlja3MsIGVycm9yKSB7XG4gICAgcmV0dXJuIHR5cGVvZiBlcnJvciA9PT0gJ2Z1bmN0aW9uJyA/XG4gICAgICBuZXcgUmVjb3JkZWQodGlja3MsIG5ldyBPbkVycm9yUHJlZGljYXRlKGVycm9yKSkgOlxuICAgICAgbmV3IFJlY29yZGVkKHRpY2tzLCBOb3RpZmljYXRpb24uY3JlYXRlT25FcnJvcihlcnJvcikpO1xuICB9LFxuICAvKipcbiAgICogRmFjdG9yeSBtZXRob2QgZm9yIGFuIE9uQ29tcGxldGVkIG5vdGlmaWNhdGlvbiByZWNvcmQgYXQgYSBnaXZlbiB0aW1lLlxuICAgKlxuICAgKiBAcGFyYW0gdGlja3MgUmVjb3JkZWQgdmlydHVhbCB0aW1lIHRoZSBPbkNvbXBsZXRlZCBub3RpZmljYXRpb24gb2NjdXJzLlxuICAgKiBAcmV0dXJuIFJlY29yZGVkIE9uQ29tcGxldGVkIG5vdGlmaWNhdGlvbi5cbiAgICovXG4gIG9uQ29tcGxldGVkOiBmdW5jdGlvbiAodGlja3MpIHtcbiAgICByZXR1cm4gbmV3IFJlY29yZGVkKHRpY2tzLCBOb3RpZmljYXRpb24uY3JlYXRlT25Db21wbGV0ZWQoKSk7XG4gIH0sXG4gIC8qKlxuICAgKiBGYWN0b3J5IG1ldGhvZCBmb3IgYSBzdWJzY3JpcHRpb24gcmVjb3JkIGJhc2VkIG9uIGEgZ2l2ZW4gc3Vic2NyaXB0aW9uIGFuZCBkaXNwb3NhbCB0aW1lLlxuICAgKlxuICAgKiBAcGFyYW0gc3RhcnQgVmlydHVhbCB0aW1lIGluZGljYXRpbmcgd2hlbiB0aGUgc3Vic2NyaXB0aW9uIHdhcyBjcmVhdGVkLlxuICAgKiBAcGFyYW0gZW5kIFZpcnR1YWwgdGltZSBpbmRpY2F0aW5nIHdoZW4gdGhlIHN1YnNjcmlwdGlvbiB3YXMgZGlzcG9zZWQuXG4gICAqIEByZXR1cm4gU3Vic2NyaXB0aW9uIG9iamVjdC5cbiAgICovXG4gIHN1YnNjcmliZTogZnVuY3Rpb24gKHN0YXJ0LCBlbmQpIHtcbiAgICByZXR1cm4gbmV3IFN1YnNjcmlwdGlvbihzdGFydCwgZW5kKTtcbiAgfVxufTtcblxuICAvKipcbiAgICogQ3JlYXRlcyBhIG5ldyBvYmplY3QgcmVjb3JkaW5nIHRoZSBwcm9kdWN0aW9uIG9mIHRoZSBzcGVjaWZpZWQgdmFsdWUgYXQgdGhlIGdpdmVuIHZpcnR1YWwgdGltZS5cbiAgICpcbiAgICogQGNvbnN0cnVjdG9yXG4gICAqIEBwYXJhbSB7TnVtYmVyfSB0aW1lIFZpcnR1YWwgdGltZSB0aGUgdmFsdWUgd2FzIHByb2R1Y2VkIG9uLlxuICAgKiBAcGFyYW0ge01peGVkfSB2YWx1ZSBWYWx1ZSB0aGF0IHdhcyBwcm9kdWNlZC5cbiAgICogQHBhcmFtIHtGdW5jdGlvbn0gY29tcGFyZXIgQW4gb3B0aW9uYWwgY29tcGFyZXIuXG4gICAqL1xuICB2YXIgUmVjb3JkZWQgPSBSeC5SZWNvcmRlZCA9IGZ1bmN0aW9uICh0aW1lLCB2YWx1ZSwgY29tcGFyZXIpIHtcbiAgICB0aGlzLnRpbWUgPSB0aW1lO1xuICAgIHRoaXMudmFsdWUgPSB2YWx1ZTtcbiAgICB0aGlzLmNvbXBhcmVyID0gY29tcGFyZXIgfHwgZGVmYXVsdENvbXBhcmVyO1xuICB9O1xuXG4gIC8qKlxuICAgKiBDaGVja3Mgd2hldGhlciB0aGUgZ2l2ZW4gcmVjb3JkZWQgb2JqZWN0IGlzIGVxdWFsIHRvIHRoZSBjdXJyZW50IGluc3RhbmNlLlxuICAgKlxuICAgKiBAcGFyYW0ge1JlY29yZGVkfSBvdGhlciBSZWNvcmRlZCBvYmplY3QgdG8gY2hlY2sgZm9yIGVxdWFsaXR5LlxuICAgKiBAcmV0dXJucyB7Qm9vbGVhbn0gdHJ1ZSBpZiBib3RoIG9iamVjdHMgYXJlIGVxdWFsOyBmYWxzZSBvdGhlcndpc2UuXG4gICAqL1xuICBSZWNvcmRlZC5wcm90b3R5cGUuZXF1YWxzID0gZnVuY3Rpb24gKG90aGVyKSB7XG4gICAgcmV0dXJuIHRoaXMudGltZSA9PT0gb3RoZXIudGltZSAmJiB0aGlzLmNvbXBhcmVyKHRoaXMudmFsdWUsIG90aGVyLnZhbHVlKTtcbiAgfTtcblxuICAvKipcbiAgICogUmV0dXJucyBhIHN0cmluZyByZXByZXNlbnRhdGlvbiBvZiB0aGUgY3VycmVudCBSZWNvcmRlZCB2YWx1ZS5cbiAgICpcbiAgICogQHJldHVybnMge1N0cmluZ30gU3RyaW5nIHJlcHJlc2VudGF0aW9uIG9mIHRoZSBjdXJyZW50IFJlY29yZGVkIHZhbHVlLlxuICAgKi9cbiAgUmVjb3JkZWQucHJvdG90eXBlLnRvU3RyaW5nID0gZnVuY3Rpb24gKCkge1xuICAgIHJldHVybiB0aGlzLnZhbHVlLnRvU3RyaW5nKCkgKyAnQCcgKyB0aGlzLnRpbWU7XG4gIH07XG5cbiAgLyoqXG4gICAqIENyZWF0ZXMgYSBuZXcgc3Vic2NyaXB0aW9uIG9iamVjdCB3aXRoIHRoZSBnaXZlbiB2aXJ0dWFsIHN1YnNjcmlwdGlvbiBhbmQgdW5zdWJzY3JpcHRpb24gdGltZS5cbiAgICpcbiAgICogQGNvbnN0cnVjdG9yXG4gICAqIEBwYXJhbSB7TnVtYmVyfSBzdWJzY3JpYmUgVmlydHVhbCB0aW1lIGF0IHdoaWNoIHRoZSBzdWJzY3JpcHRpb24gb2NjdXJyZWQuXG4gICAqIEBwYXJhbSB7TnVtYmVyfSB1bnN1YnNjcmliZSBWaXJ0dWFsIHRpbWUgYXQgd2hpY2ggdGhlIHVuc3Vic2NyaXB0aW9uIG9jY3VycmVkLlxuICAgKi9cbiAgdmFyIFN1YnNjcmlwdGlvbiA9IFJ4LlN1YnNjcmlwdGlvbiA9IGZ1bmN0aW9uIChzdGFydCwgZW5kKSB7XG4gICAgdGhpcy5zdWJzY3JpYmUgPSBzdGFydDtcbiAgICB0aGlzLnVuc3Vic2NyaWJlID0gZW5kIHx8IE51bWJlci5NQVhfVkFMVUU7XG4gIH07XG5cbiAgLyoqXG4gICAqIENoZWNrcyB3aGV0aGVyIHRoZSBnaXZlbiBzdWJzY3JpcHRpb24gaXMgZXF1YWwgdG8gdGhlIGN1cnJlbnQgaW5zdGFuY2UuXG4gICAqIEBwYXJhbSBvdGhlciBTdWJzY3JpcHRpb24gb2JqZWN0IHRvIGNoZWNrIGZvciBlcXVhbGl0eS5cbiAgICogQHJldHVybnMge0Jvb2xlYW59IHRydWUgaWYgYm90aCBvYmplY3RzIGFyZSBlcXVhbDsgZmFsc2Ugb3RoZXJ3aXNlLlxuICAgKi9cbiAgU3Vic2NyaXB0aW9uLnByb3RvdHlwZS5lcXVhbHMgPSBmdW5jdGlvbiAob3RoZXIpIHtcbiAgICByZXR1cm4gdGhpcy5zdWJzY3JpYmUgPT09IG90aGVyLnN1YnNjcmliZSAmJiB0aGlzLnVuc3Vic2NyaWJlID09PSBvdGhlci51bnN1YnNjcmliZTtcbiAgfTtcblxuICAvKipcbiAgICogUmV0dXJucyBhIHN0cmluZyByZXByZXNlbnRhdGlvbiBvZiB0aGUgY3VycmVudCBTdWJzY3JpcHRpb24gdmFsdWUuXG4gICAqIEByZXR1cm5zIHtTdHJpbmd9IFN0cmluZyByZXByZXNlbnRhdGlvbiBvZiB0aGUgY3VycmVudCBTdWJzY3JpcHRpb24gdmFsdWUuXG4gICAqL1xuICBTdWJzY3JpcHRpb24ucHJvdG90eXBlLnRvU3RyaW5nID0gZnVuY3Rpb24gKCkge1xuICAgIHJldHVybiAnKCcgKyB0aGlzLnN1YnNjcmliZSArICcsICcgKyAodGhpcy51bnN1YnNjcmliZSA9PT0gTnVtYmVyLk1BWF9WQUxVRSA/ICdJbmZpbml0ZScgOiB0aGlzLnVuc3Vic2NyaWJlKSArICcpJztcbiAgfTtcblxuICB2YXIgTW9ja0Rpc3Bvc2FibGUgPSBSeC5Nb2NrRGlzcG9zYWJsZSA9IGZ1bmN0aW9uIChzY2hlZHVsZXIpIHtcbiAgICB0aGlzLnNjaGVkdWxlciA9IHNjaGVkdWxlcjtcbiAgICB0aGlzLmRpc3Bvc2VzID0gW107XG4gICAgdGhpcy5kaXNwb3Nlcy5wdXNoKHRoaXMuc2NoZWR1bGVyLmNsb2NrKTtcbiAgfTtcblxuICBNb2NrRGlzcG9zYWJsZS5wcm90b3R5cGUuZGlzcG9zZSA9IGZ1bmN0aW9uICgpIHtcbiAgICB0aGlzLmRpc3Bvc2VzLnB1c2godGhpcy5zY2hlZHVsZXIuY2xvY2spO1xuICB9O1xuXG4gIHZhciBNb2NrT2JzZXJ2ZXIgPSAoZnVuY3Rpb24gKF9fc3VwZXJfXykge1xuICAgIGluaGVyaXRzKE1vY2tPYnNlcnZlciwgX19zdXBlcl9fKTtcblxuICAgIGZ1bmN0aW9uIE1vY2tPYnNlcnZlcihzY2hlZHVsZXIpIHtcbiAgICAgIF9fc3VwZXJfXy5jYWxsKHRoaXMpO1xuICAgICAgdGhpcy5zY2hlZHVsZXIgPSBzY2hlZHVsZXI7XG4gICAgICB0aGlzLm1lc3NhZ2VzID0gW107XG4gICAgfVxuXG4gICAgdmFyIE1vY2tPYnNlcnZlclByb3RvdHlwZSA9IE1vY2tPYnNlcnZlci5wcm90b3R5cGU7XG5cbiAgICBNb2NrT2JzZXJ2ZXJQcm90b3R5cGUub25OZXh0ID0gZnVuY3Rpb24gKHZhbHVlKSB7XG4gICAgICB0aGlzLm1lc3NhZ2VzLnB1c2gobmV3IFJlY29yZGVkKHRoaXMuc2NoZWR1bGVyLmNsb2NrLCBOb3RpZmljYXRpb24uY3JlYXRlT25OZXh0KHZhbHVlKSkpO1xuICAgIH07XG5cbiAgICBNb2NrT2JzZXJ2ZXJQcm90b3R5cGUub25FcnJvciA9IGZ1bmN0aW9uIChlKSB7XG4gICAgICB0aGlzLm1lc3NhZ2VzLnB1c2gobmV3IFJlY29yZGVkKHRoaXMuc2NoZWR1bGVyLmNsb2NrLCBOb3RpZmljYXRpb24uY3JlYXRlT25FcnJvcihlKSkpO1xuICAgIH07XG5cbiAgICBNb2NrT2JzZXJ2ZXJQcm90b3R5cGUub25Db21wbGV0ZWQgPSBmdW5jdGlvbiAoKSB7XG4gICAgICB0aGlzLm1lc3NhZ2VzLnB1c2gobmV3IFJlY29yZGVkKHRoaXMuc2NoZWR1bGVyLmNsb2NrLCBOb3RpZmljYXRpb24uY3JlYXRlT25Db21wbGV0ZWQoKSkpO1xuICAgIH07XG5cbiAgICByZXR1cm4gTW9ja09ic2VydmVyO1xuICB9KShPYnNlcnZlcik7XG5cbiAgZnVuY3Rpb24gTW9ja1Byb21pc2Uoc2NoZWR1bGVyLCBtZXNzYWdlcykge1xuICAgIHZhciBzZWxmID0gdGhpcztcbiAgICB0aGlzLnNjaGVkdWxlciA9IHNjaGVkdWxlcjtcbiAgICB0aGlzLm1lc3NhZ2VzID0gbWVzc2FnZXM7XG4gICAgdGhpcy5zdWJzY3JpcHRpb25zID0gW107XG4gICAgdGhpcy5vYnNlcnZlcnMgPSBbXTtcbiAgICBmb3IgKHZhciBpID0gMCwgbGVuID0gdGhpcy5tZXNzYWdlcy5sZW5ndGg7IGkgPCBsZW47IGkrKykge1xuICAgICAgdmFyIG1lc3NhZ2UgPSB0aGlzLm1lc3NhZ2VzW2ldLFxuICAgICAgICAgIG5vdGlmaWNhdGlvbiA9IG1lc3NhZ2UudmFsdWU7XG4gICAgICAoZnVuY3Rpb24gKGlubmVyTm90aWZpY2F0aW9uKSB7XG4gICAgICAgIHNjaGVkdWxlci5zY2hlZHVsZUFic29sdXRlKG51bGwsIG1lc3NhZ2UudGltZSwgZnVuY3Rpb24gKCkge1xuICAgICAgICAgIHZhciBvYnMgPSBzZWxmLm9ic2VydmVycy5zbGljZSgwKTtcblxuICAgICAgICAgIGZvciAodmFyIGogPSAwLCBqTGVuID0gb2JzLmxlbmd0aDsgaiA8IGpMZW47IGorKykge1xuICAgICAgICAgICAgaW5uZXJOb3RpZmljYXRpb24uYWNjZXB0KG9ic1tqXSk7XG4gICAgICAgICAgfVxuICAgICAgICAgIHJldHVybiBkaXNwb3NhYmxlRW1wdHk7XG4gICAgICAgIH0pO1xuICAgICAgfSkobm90aWZpY2F0aW9uKTtcbiAgICB9XG4gIH1cblxuICBNb2NrUHJvbWlzZS5wcm90b3R5cGUudGhlbiA9IGZ1bmN0aW9uIChvblJlc29sdmVkLCBvblJlamVjdGVkKSB7XG4gICAgdmFyIHNlbGYgPSB0aGlzO1xuXG4gICAgdGhpcy5zdWJzY3JpcHRpb25zLnB1c2gobmV3IFN1YnNjcmlwdGlvbih0aGlzLnNjaGVkdWxlci5jbG9jaykpO1xuICAgIHZhciBpbmRleCA9IHRoaXMuc3Vic2NyaXB0aW9ucy5sZW5ndGggLSAxO1xuXG4gICAgdmFyIG5ld1Byb21pc2U7XG5cbiAgICB2YXIgb2JzZXJ2ZXIgPSBSeC5PYnNlcnZlci5jcmVhdGUoXG4gICAgICBmdW5jdGlvbiAoeCkge1xuICAgICAgICB2YXIgcmV0VmFsdWUgPSBvblJlc29sdmVkKHgpO1xuICAgICAgICBpZiAocmV0VmFsdWUgJiYgdHlwZW9mIHJldFZhbHVlLnRoZW4gPT09ICdmdW5jdGlvbicpIHtcbiAgICAgICAgICBuZXdQcm9taXNlID0gcmV0VmFsdWU7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgdmFyIHRpY2tzID0gc2VsZi5zY2hlZHVsZXIuY2xvY2s7XG4gICAgICAgICAgbmV3UHJvbWlzZSA9IG5ldyBNb2NrUHJvbWlzZShzZWxmLnNjaGVkdWxlciwgW1J4LlJlYWN0aXZlVGVzdC5vbk5leHQodGlja3MsIHVuZGVmaW5lZCksIFJ4LlJlYWN0aXZlVGVzdC5vbkNvbXBsZXRlZCh0aWNrcyldKTtcbiAgICAgICAgfVxuICAgICAgICB2YXIgaWR4ID0gc2VsZi5vYnNlcnZlcnMuaW5kZXhPZihvYnNlcnZlcik7XG4gICAgICAgIHNlbGYub2JzZXJ2ZXJzLnNwbGljZShpZHgsIDEpO1xuICAgICAgICBzZWxmLnN1YnNjcmlwdGlvbnNbaW5kZXhdID0gbmV3IFN1YnNjcmlwdGlvbihzZWxmLnN1YnNjcmlwdGlvbnNbaW5kZXhdLnN1YnNjcmliZSwgc2VsZi5zY2hlZHVsZXIuY2xvY2spO1xuICAgICAgfSxcbiAgICAgIGZ1bmN0aW9uIChlcnIpIHtcbiAgICAgICAgb25SZWplY3RlZChlcnIpO1xuICAgICAgICB2YXIgaWR4ID0gc2VsZi5vYnNlcnZlcnMuaW5kZXhPZihvYnNlcnZlcik7XG4gICAgICAgIHNlbGYub2JzZXJ2ZXJzLnNwbGljZShpZHgsIDEpO1xuICAgICAgICBzZWxmLnN1YnNjcmlwdGlvbnNbaW5kZXhdID0gbmV3IFN1YnNjcmlwdGlvbihzZWxmLnN1YnNjcmlwdGlvbnNbaW5kZXhdLnN1YnNjcmliZSwgc2VsZi5zY2hlZHVsZXIuY2xvY2spO1xuICAgICAgfVxuICAgICk7XG4gICAgdGhpcy5vYnNlcnZlcnMucHVzaChvYnNlcnZlcik7XG5cbiAgICByZXR1cm4gbmV3UHJvbWlzZSB8fCBuZXcgTW9ja1Byb21pc2UodGhpcy5zY2hlZHVsZXIsIHRoaXMubWVzc2FnZXMpO1xuICB9O1xuXG4gIHZhciBIb3RPYnNlcnZhYmxlID0gKGZ1bmN0aW9uIChfX3N1cGVyX18pIHtcbiAgICBpbmhlcml0cyhIb3RPYnNlcnZhYmxlLCBfX3N1cGVyX18pO1xuXG4gICAgZnVuY3Rpb24gSG90T2JzZXJ2YWJsZShzY2hlZHVsZXIsIG1lc3NhZ2VzKSB7XG4gICAgICBfX3N1cGVyX18uY2FsbCh0aGlzKTtcbiAgICAgIHZhciBtZXNzYWdlLCBub3RpZmljYXRpb24sIG9ic2VydmFibGUgPSB0aGlzO1xuICAgICAgdGhpcy5zY2hlZHVsZXIgPSBzY2hlZHVsZXI7XG4gICAgICB0aGlzLm1lc3NhZ2VzID0gbWVzc2FnZXM7XG4gICAgICB0aGlzLnN1YnNjcmlwdGlvbnMgPSBbXTtcbiAgICAgIHRoaXMub2JzZXJ2ZXJzID0gW107XG4gICAgICBmb3IgKHZhciBpID0gMCwgbGVuID0gdGhpcy5tZXNzYWdlcy5sZW5ndGg7IGkgPCBsZW47IGkrKykge1xuICAgICAgICBtZXNzYWdlID0gdGhpcy5tZXNzYWdlc1tpXTtcbiAgICAgICAgbm90aWZpY2F0aW9uID0gbWVzc2FnZS52YWx1ZTtcbiAgICAgICAgKGZ1bmN0aW9uIChpbm5lck5vdGlmaWNhdGlvbikge1xuICAgICAgICAgIHNjaGVkdWxlci5zY2hlZHVsZUFic29sdXRlKG51bGwsIG1lc3NhZ2UudGltZSwgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgdmFyIG9icyA9IG9ic2VydmFibGUub2JzZXJ2ZXJzLnNsaWNlKDApO1xuXG4gICAgICAgICAgICBmb3IgKHZhciBqID0gMCwgakxlbiA9IG9icy5sZW5ndGg7IGogPCBqTGVuOyBqKyspIHtcbiAgICAgICAgICAgICAgaW5uZXJOb3RpZmljYXRpb24uYWNjZXB0KG9ic1tqXSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gZGlzcG9zYWJsZUVtcHR5O1xuICAgICAgICAgIH0pO1xuICAgICAgICB9KShub3RpZmljYXRpb24pO1xuICAgICAgfVxuICAgIH1cblxuICAgIEhvdE9ic2VydmFibGUucHJvdG90eXBlLl9zdWJzY3JpYmUgPSBmdW5jdGlvbiAobykge1xuICAgICAgdmFyIG9ic2VydmFibGUgPSB0aGlzO1xuICAgICAgdGhpcy5vYnNlcnZlcnMucHVzaChvKTtcbiAgICAgIHRoaXMuc3Vic2NyaXB0aW9ucy5wdXNoKG5ldyBTdWJzY3JpcHRpb24odGhpcy5zY2hlZHVsZXIuY2xvY2spKTtcbiAgICAgIHZhciBpbmRleCA9IHRoaXMuc3Vic2NyaXB0aW9ucy5sZW5ndGggLSAxO1xuICAgICAgcmV0dXJuIGRpc3Bvc2FibGVDcmVhdGUoZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgaWR4ID0gb2JzZXJ2YWJsZS5vYnNlcnZlcnMuaW5kZXhPZihvKTtcbiAgICAgICAgb2JzZXJ2YWJsZS5vYnNlcnZlcnMuc3BsaWNlKGlkeCwgMSk7XG4gICAgICAgIG9ic2VydmFibGUuc3Vic2NyaXB0aW9uc1tpbmRleF0gPSBuZXcgU3Vic2NyaXB0aW9uKG9ic2VydmFibGUuc3Vic2NyaXB0aW9uc1tpbmRleF0uc3Vic2NyaWJlLCBvYnNlcnZhYmxlLnNjaGVkdWxlci5jbG9jayk7XG4gICAgICB9KTtcbiAgICB9O1xuXG4gICAgcmV0dXJuIEhvdE9ic2VydmFibGU7XG4gIH0pKE9ic2VydmFibGUpO1xuXG4gIHZhciBDb2xkT2JzZXJ2YWJsZSA9IChmdW5jdGlvbiAoX19zdXBlcl9fKSB7XG4gICAgaW5oZXJpdHMoQ29sZE9ic2VydmFibGUsIF9fc3VwZXJfXyk7XG5cbiAgICBmdW5jdGlvbiBDb2xkT2JzZXJ2YWJsZShzY2hlZHVsZXIsIG1lc3NhZ2VzKSB7XG4gICAgICBfX3N1cGVyX18uY2FsbCh0aGlzKTtcbiAgICAgIHRoaXMuc2NoZWR1bGVyID0gc2NoZWR1bGVyO1xuICAgICAgdGhpcy5tZXNzYWdlcyA9IG1lc3NhZ2VzO1xuICAgICAgdGhpcy5zdWJzY3JpcHRpb25zID0gW107XG4gICAgfVxuXG4gICAgQ29sZE9ic2VydmFibGUucHJvdG90eXBlLl9zdWJzY3JpYmUgPSBmdW5jdGlvbiAobykge1xuICAgICAgdmFyIG1lc3NhZ2UsIG5vdGlmaWNhdGlvbiwgb2JzZXJ2YWJsZSA9IHRoaXM7XG4gICAgICB0aGlzLnN1YnNjcmlwdGlvbnMucHVzaChuZXcgU3Vic2NyaXB0aW9uKHRoaXMuc2NoZWR1bGVyLmNsb2NrKSk7XG4gICAgICB2YXIgaW5kZXggPSB0aGlzLnN1YnNjcmlwdGlvbnMubGVuZ3RoIC0gMTtcbiAgICAgIHZhciBkID0gbmV3IENvbXBvc2l0ZURpc3Bvc2FibGUoKTtcbiAgICAgIGZvciAodmFyIGkgPSAwLCBsZW4gPSB0aGlzLm1lc3NhZ2VzLmxlbmd0aDsgaSA8IGxlbjsgaSsrKSB7XG4gICAgICAgIG1lc3NhZ2UgPSB0aGlzLm1lc3NhZ2VzW2ldO1xuICAgICAgICBub3RpZmljYXRpb24gPSBtZXNzYWdlLnZhbHVlO1xuICAgICAgICAoZnVuY3Rpb24gKGlubmVyTm90aWZpY2F0aW9uKSB7XG4gICAgICAgICAgZC5hZGQob2JzZXJ2YWJsZS5zY2hlZHVsZXIuc2NoZWR1bGVSZWxhdGl2ZShudWxsLCBtZXNzYWdlLnRpbWUsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIGlubmVyTm90aWZpY2F0aW9uLmFjY2VwdChvKTtcbiAgICAgICAgICAgIHJldHVybiBkaXNwb3NhYmxlRW1wdHk7XG4gICAgICAgICAgfSkpO1xuICAgICAgICB9KShub3RpZmljYXRpb24pO1xuICAgICAgfVxuICAgICAgcmV0dXJuIGRpc3Bvc2FibGVDcmVhdGUoZnVuY3Rpb24gKCkge1xuICAgICAgICBvYnNlcnZhYmxlLnN1YnNjcmlwdGlvbnNbaW5kZXhdID0gbmV3IFN1YnNjcmlwdGlvbihvYnNlcnZhYmxlLnN1YnNjcmlwdGlvbnNbaW5kZXhdLnN1YnNjcmliZSwgb2JzZXJ2YWJsZS5zY2hlZHVsZXIuY2xvY2spO1xuICAgICAgICBkLmRpc3Bvc2UoKTtcbiAgICAgIH0pO1xuICAgIH07XG5cbiAgICByZXR1cm4gQ29sZE9ic2VydmFibGU7XG4gIH0pKE9ic2VydmFibGUpO1xuXG4gIC8qKiBWaXJ0dWFsIHRpbWUgc2NoZWR1bGVyIHVzZWQgZm9yIHRlc3RpbmcgYXBwbGljYXRpb25zIGFuZCBsaWJyYXJpZXMgYnVpbHQgdXNpbmcgUmVhY3RpdmUgRXh0ZW5zaW9ucy4gKi9cbiAgUnguVGVzdFNjaGVkdWxlciA9IChmdW5jdGlvbiAoX19zdXBlcl9fKSB7XG4gICAgaW5oZXJpdHMoVGVzdFNjaGVkdWxlciwgX19zdXBlcl9fKTtcblxuICAgIGZ1bmN0aW9uIGJhc2VDb21wYXJlcih4LCB5KSB7XG4gICAgICByZXR1cm4geCA+IHkgPyAxIDogKHggPCB5ID8gLTEgOiAwKTtcbiAgICB9XG5cbiAgICBmdW5jdGlvbiBUZXN0U2NoZWR1bGVyKCkge1xuICAgICAgX19zdXBlcl9fLmNhbGwodGhpcywgMCwgYmFzZUNvbXBhcmVyKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBTY2hlZHVsZXMgYW4gYWN0aW9uIHRvIGJlIGV4ZWN1dGVkIGF0IHRoZSBzcGVjaWZpZWQgdmlydHVhbCB0aW1lLlxuICAgICAqXG4gICAgICogQHBhcmFtIHN0YXRlIFN0YXRlIHBhc3NlZCB0byB0aGUgYWN0aW9uIHRvIGJlIGV4ZWN1dGVkLlxuICAgICAqIEBwYXJhbSBkdWVUaW1lIEFic29sdXRlIHZpcnR1YWwgdGltZSBhdCB3aGljaCB0byBleGVjdXRlIHRoZSBhY3Rpb24uXG4gICAgICogQHBhcmFtIGFjdGlvbiBBY3Rpb24gdG8gYmUgZXhlY3V0ZWQuXG4gICAgICogQHJldHVybiBEaXNwb3NhYmxlIG9iamVjdCB1c2VkIHRvIGNhbmNlbCB0aGUgc2NoZWR1bGVkIGFjdGlvbiAoYmVzdCBlZmZvcnQpLlxuICAgICAqL1xuICAgIFRlc3RTY2hlZHVsZXIucHJvdG90eXBlLnNjaGVkdWxlQWJzb2x1dGUgPSBmdW5jdGlvbiAoc3RhdGUsIGR1ZVRpbWUsIGFjdGlvbikge1xuICAgICAgZHVlVGltZSA8PSB0aGlzLmNsb2NrICYmIChkdWVUaW1lID0gdGhpcy5jbG9jayArIDEpO1xuICAgICAgcmV0dXJuIF9fc3VwZXJfXy5wcm90b3R5cGUuc2NoZWR1bGVBYnNvbHV0ZS5jYWxsKHRoaXMsIHN0YXRlLCBkdWVUaW1lLCBhY3Rpb24pO1xuICAgIH07XG4gICAgLyoqXG4gICAgICogQWRkcyBhIHJlbGF0aXZlIHZpcnR1YWwgdGltZSB0byBhbiBhYnNvbHV0ZSB2aXJ0dWFsIHRpbWUgdmFsdWUuXG4gICAgICpcbiAgICAgKiBAcGFyYW0gYWJzb2x1dGUgQWJzb2x1dGUgdmlydHVhbCB0aW1lIHZhbHVlLlxuICAgICAqIEBwYXJhbSByZWxhdGl2ZSBSZWxhdGl2ZSB2aXJ0dWFsIHRpbWUgdmFsdWUgdG8gYWRkLlxuICAgICAqIEByZXR1cm4gUmVzdWx0aW5nIGFic29sdXRlIHZpcnR1YWwgdGltZSBzdW0gdmFsdWUuXG4gICAgICovXG4gICAgVGVzdFNjaGVkdWxlci5wcm90b3R5cGUuYWRkID0gZnVuY3Rpb24gKGFic29sdXRlLCByZWxhdGl2ZSkge1xuICAgICAgcmV0dXJuIGFic29sdXRlICsgcmVsYXRpdmU7XG4gICAgfTtcbiAgICAvKipcbiAgICAgKiBDb252ZXJ0cyB0aGUgYWJzb2x1dGUgdmlydHVhbCB0aW1lIHZhbHVlIHRvIGEgRGF0ZVRpbWVPZmZzZXQgdmFsdWUuXG4gICAgICpcbiAgICAgKiBAcGFyYW0gYWJzb2x1dGUgQWJzb2x1dGUgdmlydHVhbCB0aW1lIHZhbHVlIHRvIGNvbnZlcnQuXG4gICAgICogQHJldHVybiBDb3JyZXNwb25kaW5nIERhdGVUaW1lT2Zmc2V0IHZhbHVlLlxuICAgICAqL1xuICAgIFRlc3RTY2hlZHVsZXIucHJvdG90eXBlLnRvQWJzb2x1dGVUaW1lID0gZnVuY3Rpb24gKGFic29sdXRlKSB7XG4gICAgICByZXR1cm4gbmV3IERhdGUoYWJzb2x1dGUpLmdldFRpbWUoKTtcbiAgICB9O1xuICAgIC8qKlxuICAgICAqIENvbnZlcnRzIHRoZSBUaW1lU3BhbiB2YWx1ZSB0byBhIHJlbGF0aXZlIHZpcnR1YWwgdGltZSB2YWx1ZS5cbiAgICAgKlxuICAgICAqIEBwYXJhbSB0aW1lU3BhbiBUaW1lU3BhbiB2YWx1ZSB0byBjb252ZXJ0LlxuICAgICAqIEByZXR1cm4gQ29ycmVzcG9uZGluZyByZWxhdGl2ZSB2aXJ0dWFsIHRpbWUgdmFsdWUuXG4gICAgICovXG4gICAgVGVzdFNjaGVkdWxlci5wcm90b3R5cGUudG9SZWxhdGl2ZVRpbWUgPSBmdW5jdGlvbiAodGltZVNwYW4pIHtcbiAgICAgIHJldHVybiB0aW1lU3BhbjtcbiAgICB9O1xuICAgIC8qKlxuICAgICAqIFN0YXJ0cyB0aGUgdGVzdCBzY2hlZHVsZXIgYW5kIHVzZXMgdGhlIHNwZWNpZmllZCB2aXJ0dWFsIHRpbWVzIHRvIGludm9rZSB0aGUgZmFjdG9yeSBmdW5jdGlvbiwgc3Vic2NyaWJlIHRvIHRoZSByZXN1bHRpbmcgc2VxdWVuY2UsIGFuZCBkaXNwb3NlIHRoZSBzdWJzY3JpcHRpb24uXG4gICAgICpcbiAgICAgKiBAcGFyYW0gY3JlYXRlIEZhY3RvcnkgbWV0aG9kIHRvIGNyZWF0ZSBhbiBvYnNlcnZhYmxlIHNlcXVlbmNlLlxuICAgICAqIEBwYXJhbSBjcmVhdGVkIFZpcnR1YWwgdGltZSBhdCB3aGljaCB0byBpbnZva2UgdGhlIGZhY3RvcnkgdG8gY3JlYXRlIGFuIG9ic2VydmFibGUgc2VxdWVuY2UuXG4gICAgICogQHBhcmFtIHN1YnNjcmliZWQgVmlydHVhbCB0aW1lIGF0IHdoaWNoIHRvIHN1YnNjcmliZSB0byB0aGUgY3JlYXRlZCBvYnNlcnZhYmxlIHNlcXVlbmNlLlxuICAgICAqIEBwYXJhbSBkaXNwb3NlZCBWaXJ0dWFsIHRpbWUgYXQgd2hpY2ggdG8gZGlzcG9zZSB0aGUgc3Vic2NyaXB0aW9uLlxuICAgICAqIEByZXR1cm4gT2JzZXJ2ZXIgd2l0aCB0aW1lc3RhbXBlZCByZWNvcmRpbmdzIG9mIG5vdGlmaWNhdGlvbiBtZXNzYWdlcyB0aGF0IHdlcmUgcmVjZWl2ZWQgZHVyaW5nIHRoZSB2aXJ0dWFsIHRpbWUgd2luZG93IHdoZW4gdGhlIHN1YnNjcmlwdGlvbiB0byB0aGUgc291cmNlIHNlcXVlbmNlIHdhcyBhY3RpdmUuXG4gICAgICovXG4gICAgVGVzdFNjaGVkdWxlci5wcm90b3R5cGUuc3RhcnRTY2hlZHVsZXIgPSBmdW5jdGlvbiAoY3JlYXRlRm4sIHNldHRpbmdzKSB7XG4gICAgICBzZXR0aW5ncyB8fCAoc2V0dGluZ3MgPSB7fSk7XG4gICAgICBzZXR0aW5ncy5jcmVhdGVkID09IG51bGwgJiYgKHNldHRpbmdzLmNyZWF0ZWQgPSBSZWFjdGl2ZVRlc3QuY3JlYXRlZCk7XG4gICAgICBzZXR0aW5ncy5zdWJzY3JpYmVkID09IG51bGwgJiYgKHNldHRpbmdzLnN1YnNjcmliZWQgPSBSZWFjdGl2ZVRlc3Quc3Vic2NyaWJlZCk7XG4gICAgICBzZXR0aW5ncy5kaXNwb3NlZCA9PSBudWxsICYmIChzZXR0aW5ncy5kaXNwb3NlZCA9IFJlYWN0aXZlVGVzdC5kaXNwb3NlZCk7XG5cbiAgICAgIHZhciBvYnNlcnZlciA9IHRoaXMuY3JlYXRlT2JzZXJ2ZXIoKSwgc291cmNlLCBzdWJzY3JpcHRpb247XG5cbiAgICAgIHRoaXMuc2NoZWR1bGVBYnNvbHV0ZShudWxsLCBzZXR0aW5ncy5jcmVhdGVkLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHNvdXJjZSA9IGNyZWF0ZUZuKCk7XG4gICAgICAgIHJldHVybiBkaXNwb3NhYmxlRW1wdHk7XG4gICAgICB9KTtcblxuICAgICAgdGhpcy5zY2hlZHVsZUFic29sdXRlKG51bGwsIHNldHRpbmdzLnN1YnNjcmliZWQsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgc3Vic2NyaXB0aW9uID0gc291cmNlLnN1YnNjcmliZShvYnNlcnZlcik7XG4gICAgICAgIHJldHVybiBkaXNwb3NhYmxlRW1wdHk7XG4gICAgICB9KTtcblxuICAgICAgdGhpcy5zY2hlZHVsZUFic29sdXRlKG51bGwsIHNldHRpbmdzLmRpc3Bvc2VkLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHN1YnNjcmlwdGlvbi5kaXNwb3NlKCk7XG4gICAgICAgIHJldHVybiBkaXNwb3NhYmxlRW1wdHk7XG4gICAgICB9KTtcblxuICAgICAgdGhpcy5zdGFydCgpO1xuXG4gICAgICByZXR1cm4gb2JzZXJ2ZXI7XG4gICAgfTtcblxuICAgIC8qKlxuICAgICAqIENyZWF0ZXMgYSBob3Qgb2JzZXJ2YWJsZSB1c2luZyB0aGUgc3BlY2lmaWVkIHRpbWVzdGFtcGVkIG5vdGlmaWNhdGlvbiBtZXNzYWdlcyBlaXRoZXIgYXMgYW4gYXJyYXkgb3IgYXJndW1lbnRzLlxuICAgICAqIEBwYXJhbSBtZXNzYWdlcyBOb3RpZmljYXRpb25zIHRvIHN1cmZhY2UgdGhyb3VnaCB0aGUgY3JlYXRlZCBzZXF1ZW5jZSBhdCB0aGVpciBzcGVjaWZpZWQgYWJzb2x1dGUgdmlydHVhbCB0aW1lcy5cbiAgICAgKiBAcmV0dXJuIEhvdCBvYnNlcnZhYmxlIHNlcXVlbmNlIHRoYXQgY2FuIGJlIHVzZWQgdG8gYXNzZXJ0IHRoZSB0aW1pbmcgb2Ygc3Vic2NyaXB0aW9ucyBhbmQgbm90aWZpY2F0aW9ucy5cbiAgICAgKi9cbiAgICBUZXN0U2NoZWR1bGVyLnByb3RvdHlwZS5jcmVhdGVIb3RPYnNlcnZhYmxlID0gZnVuY3Rpb24gKCkge1xuICAgICAgdmFyIGxlbiA9IGFyZ3VtZW50cy5sZW5ndGgsIGFyZ3M7XG4gICAgICBpZiAoQXJyYXkuaXNBcnJheShhcmd1bWVudHNbMF0pKSB7XG4gICAgICAgIGFyZ3MgPSBhcmd1bWVudHNbMF07XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBhcmdzID0gbmV3IEFycmF5KGxlbik7XG4gICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbGVuOyBpKyspIHsgYXJnc1tpXSA9IGFyZ3VtZW50c1tpXTsgfVxuICAgICAgfVxuICAgICAgcmV0dXJuIG5ldyBIb3RPYnNlcnZhYmxlKHRoaXMsIGFyZ3MpO1xuICAgIH07XG5cbiAgICAvKipcbiAgICAgKiBDcmVhdGVzIGEgY29sZCBvYnNlcnZhYmxlIHVzaW5nIHRoZSBzcGVjaWZpZWQgdGltZXN0YW1wZWQgbm90aWZpY2F0aW9uIG1lc3NhZ2VzIGVpdGhlciBhcyBhbiBhcnJheSBvciBhcmd1bWVudHMuXG4gICAgICogQHBhcmFtIG1lc3NhZ2VzIE5vdGlmaWNhdGlvbnMgdG8gc3VyZmFjZSB0aHJvdWdoIHRoZSBjcmVhdGVkIHNlcXVlbmNlIGF0IHRoZWlyIHNwZWNpZmllZCB2aXJ0dWFsIHRpbWUgb2Zmc2V0cyBmcm9tIHRoZSBzZXF1ZW5jZSBzdWJzY3JpcHRpb24gdGltZS5cbiAgICAgKiBAcmV0dXJuIENvbGQgb2JzZXJ2YWJsZSBzZXF1ZW5jZSB0aGF0IGNhbiBiZSB1c2VkIHRvIGFzc2VydCB0aGUgdGltaW5nIG9mIHN1YnNjcmlwdGlvbnMgYW5kIG5vdGlmaWNhdGlvbnMuXG4gICAgICovXG4gICAgVGVzdFNjaGVkdWxlci5wcm90b3R5cGUuY3JlYXRlQ29sZE9ic2VydmFibGUgPSBmdW5jdGlvbiAoKSB7XG4gICAgICB2YXIgbGVuID0gYXJndW1lbnRzLmxlbmd0aCwgYXJncztcbiAgICAgIGlmIChBcnJheS5pc0FycmF5KGFyZ3VtZW50c1swXSkpIHtcbiAgICAgICAgYXJncyA9IGFyZ3VtZW50c1swXTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGFyZ3MgPSBuZXcgQXJyYXkobGVuKTtcbiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBsZW47IGkrKykgeyBhcmdzW2ldID0gYXJndW1lbnRzW2ldOyB9XG4gICAgICB9XG4gICAgICByZXR1cm4gbmV3IENvbGRPYnNlcnZhYmxlKHRoaXMsIGFyZ3MpO1xuICAgIH07XG5cbiAgICAvKipcbiAgICAgKiBDcmVhdGVzIGEgcmVzb2x2ZWQgcHJvbWlzZSB3aXRoIHRoZSBnaXZlbiB2YWx1ZSBhbmQgdGlja3NcbiAgICAgKiBAcGFyYW0ge051bWJlcn0gdGlja3MgVGhlIGFic29sdXRlIHRpbWUgb2YgdGhlIHJlc29sdXRpb24uXG4gICAgICogQHBhcmFtIHtBbnl9IHZhbHVlIFRoZSB2YWx1ZSB0byB5aWVsZCBhdCB0aGUgZ2l2ZW4gdGljay5cbiAgICAgKiBAcmV0dXJucyB7TW9ja1Byb21pc2V9IEEgbW9jayBQcm9taXNlIHdoaWNoIGZ1bGZpbGxzIHdpdGggdGhlIGdpdmVuIHZhbHVlLlxuICAgICAqL1xuICAgIFRlc3RTY2hlZHVsZXIucHJvdG90eXBlLmNyZWF0ZVJlc29sdmVkUHJvbWlzZSA9IGZ1bmN0aW9uICh0aWNrcywgdmFsdWUpIHtcbiAgICAgIHJldHVybiBuZXcgTW9ja1Byb21pc2UodGhpcywgW1J4LlJlYWN0aXZlVGVzdC5vbk5leHQodGlja3MsIHZhbHVlKSwgUnguUmVhY3RpdmVUZXN0Lm9uQ29tcGxldGVkKHRpY2tzKV0pO1xuICAgIH07XG5cbiAgICAvKipcbiAgICAgKiBDcmVhdGVzIGEgcmVqZWN0ZWQgcHJvbWlzZSB3aXRoIHRoZSBnaXZlbiByZWFzb24gYW5kIHRpY2tzXG4gICAgICogQHBhcmFtIHtOdW1iZXJ9IHRpY2tzIFRoZSBhYnNvbHV0ZSB0aW1lIG9mIHRoZSByZXNvbHV0aW9uLlxuICAgICAqIEBwYXJhbSB7QW55fSByZWFzb24gVGhlIHJlYXNvbiBmb3IgcmVqZWN0aW9uIHRvIHlpZWxkIGF0IHRoZSBnaXZlbiB0aWNrLlxuICAgICAqIEByZXR1cm5zIHtNb2NrUHJvbWlzZX0gQSBtb2NrIFByb21pc2Ugd2hpY2ggcmVqZWN0cyB3aXRoIHRoZSBnaXZlbiByZWFzb24uXG4gICAgICovXG4gICAgVGVzdFNjaGVkdWxlci5wcm90b3R5cGUuY3JlYXRlUmVqZWN0ZWRQcm9taXNlID0gZnVuY3Rpb24gKHRpY2tzLCByZWFzb24pIHtcbiAgICAgIHJldHVybiBuZXcgTW9ja1Byb21pc2UodGhpcywgW1J4LlJlYWN0aXZlVGVzdC5vbkVycm9yKHRpY2tzLCByZWFzb24pXSk7XG4gICAgfTtcblxuICAgIC8qKlxuICAgICAqIENyZWF0ZXMgYW4gb2JzZXJ2ZXIgdGhhdCByZWNvcmRzIHJlY2VpdmVkIG5vdGlmaWNhdGlvbiBtZXNzYWdlcyBhbmQgdGltZXN0YW1wcyB0aG9zZS5cbiAgICAgKiBAcmV0dXJuIE9ic2VydmVyIHRoYXQgY2FuIGJlIHVzZWQgdG8gYXNzZXJ0IHRoZSB0aW1pbmcgb2YgcmVjZWl2ZWQgbm90aWZpY2F0aW9ucy5cbiAgICAgKi9cbiAgICBUZXN0U2NoZWR1bGVyLnByb3RvdHlwZS5jcmVhdGVPYnNlcnZlciA9IGZ1bmN0aW9uICgpIHtcbiAgICAgIHJldHVybiBuZXcgTW9ja09ic2VydmVyKHRoaXMpO1xuICAgIH07XG5cbiAgICByZXR1cm4gVGVzdFNjaGVkdWxlcjtcbiAgfSkoVmlydHVhbFRpbWVTY2hlZHVsZXIpO1xuXG4gIHZhciBBbm9ueW1vdXNPYnNlcnZhYmxlID0gUnguQW5vbnltb3VzT2JzZXJ2YWJsZSA9IChmdW5jdGlvbiAoX19zdXBlcl9fKSB7XG4gICAgaW5oZXJpdHMoQW5vbnltb3VzT2JzZXJ2YWJsZSwgX19zdXBlcl9fKTtcblxuICAgIC8vIEZpeCBzdWJzY3JpYmVyIHRvIGNoZWNrIGZvciB1bmRlZmluZWQgb3IgZnVuY3Rpb24gcmV0dXJuZWQgdG8gZGVjb3JhdGUgYXMgRGlzcG9zYWJsZVxuICAgIGZ1bmN0aW9uIGZpeFN1YnNjcmliZXIoc3Vic2NyaWJlcikge1xuICAgICAgcmV0dXJuIHN1YnNjcmliZXIgJiYgaXNGdW5jdGlvbihzdWJzY3JpYmVyLmRpc3Bvc2UpID8gc3Vic2NyaWJlciA6XG4gICAgICAgIGlzRnVuY3Rpb24oc3Vic2NyaWJlcikgPyBkaXNwb3NhYmxlQ3JlYXRlKHN1YnNjcmliZXIpIDogZGlzcG9zYWJsZUVtcHR5O1xuICAgIH1cblxuICAgIGZ1bmN0aW9uIHNldERpc3Bvc2FibGUocywgc3RhdGUpIHtcbiAgICAgIHZhciBhZG8gPSBzdGF0ZVswXSwgc2VsZiA9IHN0YXRlWzFdO1xuICAgICAgdmFyIHN1YiA9IHRyeUNhdGNoKHNlbGYuX19zdWJzY3JpYmUpLmNhbGwoc2VsZiwgYWRvKTtcbiAgICAgIGlmIChzdWIgPT09IGVycm9yT2JqICYmICFhZG8uZmFpbChlcnJvck9iai5lKSkgeyB0aHJvd2VyKGVycm9yT2JqLmUpOyB9XG4gICAgICBhZG8uc2V0RGlzcG9zYWJsZShmaXhTdWJzY3JpYmVyKHN1YikpO1xuICAgIH1cblxuICAgIGZ1bmN0aW9uIEFub255bW91c09ic2VydmFibGUoc3Vic2NyaWJlLCBwYXJlbnQpIHtcbiAgICAgIHRoaXMuc291cmNlID0gcGFyZW50O1xuICAgICAgdGhpcy5fX3N1YnNjcmliZSA9IHN1YnNjcmliZTtcbiAgICAgIF9fc3VwZXJfXy5jYWxsKHRoaXMpO1xuICAgIH1cblxuICAgIEFub255bW91c09ic2VydmFibGUucHJvdG90eXBlLl9zdWJzY3JpYmUgPSBmdW5jdGlvbiAobykge1xuICAgICAgdmFyIGFkbyA9IG5ldyBBdXRvRGV0YWNoT2JzZXJ2ZXIobyksIHN0YXRlID0gW2FkbywgdGhpc107XG5cbiAgICAgIGlmIChjdXJyZW50VGhyZWFkU2NoZWR1bGVyLnNjaGVkdWxlUmVxdWlyZWQoKSkge1xuICAgICAgICBjdXJyZW50VGhyZWFkU2NoZWR1bGVyLnNjaGVkdWxlKHN0YXRlLCBzZXREaXNwb3NhYmxlKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHNldERpc3Bvc2FibGUobnVsbCwgc3RhdGUpO1xuICAgICAgfVxuICAgICAgcmV0dXJuIGFkbztcbiAgICB9O1xuXG4gICAgcmV0dXJuIEFub255bW91c09ic2VydmFibGU7XG5cbiAgfShPYnNlcnZhYmxlKSk7XG5cbiAgdmFyIEF1dG9EZXRhY2hPYnNlcnZlciA9IChmdW5jdGlvbiAoX19zdXBlcl9fKSB7XG4gICAgaW5oZXJpdHMoQXV0b0RldGFjaE9ic2VydmVyLCBfX3N1cGVyX18pO1xuXG4gICAgZnVuY3Rpb24gQXV0b0RldGFjaE9ic2VydmVyKG9ic2VydmVyKSB7XG4gICAgICBfX3N1cGVyX18uY2FsbCh0aGlzKTtcbiAgICAgIHRoaXMub2JzZXJ2ZXIgPSBvYnNlcnZlcjtcbiAgICAgIHRoaXMubSA9IG5ldyBTaW5nbGVBc3NpZ25tZW50RGlzcG9zYWJsZSgpO1xuICAgIH1cblxuICAgIHZhciBBdXRvRGV0YWNoT2JzZXJ2ZXJQcm90b3R5cGUgPSBBdXRvRGV0YWNoT2JzZXJ2ZXIucHJvdG90eXBlO1xuXG4gICAgQXV0b0RldGFjaE9ic2VydmVyUHJvdG90eXBlLm5leHQgPSBmdW5jdGlvbiAodmFsdWUpIHtcbiAgICAgIHZhciByZXN1bHQgPSB0cnlDYXRjaCh0aGlzLm9ic2VydmVyLm9uTmV4dCkuY2FsbCh0aGlzLm9ic2VydmVyLCB2YWx1ZSk7XG4gICAgICBpZiAocmVzdWx0ID09PSBlcnJvck9iaikge1xuICAgICAgICB0aGlzLmRpc3Bvc2UoKTtcbiAgICAgICAgdGhyb3dlcihyZXN1bHQuZSk7XG4gICAgICB9XG4gICAgfTtcblxuICAgIEF1dG9EZXRhY2hPYnNlcnZlclByb3RvdHlwZS5lcnJvciA9IGZ1bmN0aW9uIChlcnIpIHtcbiAgICAgIHZhciByZXN1bHQgPSB0cnlDYXRjaCh0aGlzLm9ic2VydmVyLm9uRXJyb3IpLmNhbGwodGhpcy5vYnNlcnZlciwgZXJyKTtcbiAgICAgIHRoaXMuZGlzcG9zZSgpO1xuICAgICAgcmVzdWx0ID09PSBlcnJvck9iaiAmJiB0aHJvd2VyKHJlc3VsdC5lKTtcbiAgICB9O1xuXG4gICAgQXV0b0RldGFjaE9ic2VydmVyUHJvdG90eXBlLmNvbXBsZXRlZCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgIHZhciByZXN1bHQgPSB0cnlDYXRjaCh0aGlzLm9ic2VydmVyLm9uQ29tcGxldGVkKS5jYWxsKHRoaXMub2JzZXJ2ZXIpO1xuICAgICAgdGhpcy5kaXNwb3NlKCk7XG4gICAgICByZXN1bHQgPT09IGVycm9yT2JqICYmIHRocm93ZXIocmVzdWx0LmUpO1xuICAgIH07XG5cbiAgICBBdXRvRGV0YWNoT2JzZXJ2ZXJQcm90b3R5cGUuc2V0RGlzcG9zYWJsZSA9IGZ1bmN0aW9uICh2YWx1ZSkgeyB0aGlzLm0uc2V0RGlzcG9zYWJsZSh2YWx1ZSk7IH07XG4gICAgQXV0b0RldGFjaE9ic2VydmVyUHJvdG90eXBlLmdldERpc3Bvc2FibGUgPSBmdW5jdGlvbiAoKSB7IHJldHVybiB0aGlzLm0uZ2V0RGlzcG9zYWJsZSgpOyB9O1xuXG4gICAgQXV0b0RldGFjaE9ic2VydmVyUHJvdG90eXBlLmRpc3Bvc2UgPSBmdW5jdGlvbiAoKSB7XG4gICAgICBfX3N1cGVyX18ucHJvdG90eXBlLmRpc3Bvc2UuY2FsbCh0aGlzKTtcbiAgICAgIHRoaXMubS5kaXNwb3NlKCk7XG4gICAgfTtcblxuICAgIHJldHVybiBBdXRvRGV0YWNoT2JzZXJ2ZXI7XG4gIH0oQWJzdHJhY3RPYnNlcnZlcikpO1xuXG4gIHZhciBVbmRlcmx5aW5nT2JzZXJ2YWJsZSA9IChmdW5jdGlvbiAoX19zdXBlcl9fKSB7XG4gICAgaW5oZXJpdHMoVW5kZXJseWluZ09ic2VydmFibGUsIF9fc3VwZXJfXyk7XG4gICAgZnVuY3Rpb24gVW5kZXJseWluZ09ic2VydmFibGUobSwgdSkge1xuICAgICAgdGhpcy5fbSA9IG07XG4gICAgICB0aGlzLl91ID0gdTtcbiAgICAgIF9fc3VwZXJfXy5jYWxsKHRoaXMpO1xuICAgIH1cblxuICAgIFVuZGVybHlpbmdPYnNlcnZhYmxlLnByb3RvdHlwZS5zdWJzY3JpYmVDb3JlID0gZnVuY3Rpb24gKG8pIHtcbiAgICAgIHJldHVybiBuZXcgQmluYXJ5RGlzcG9zYWJsZSh0aGlzLl9tLmdldERpc3Bvc2FibGUoKSwgdGhpcy5fdS5zdWJzY3JpYmUobykpO1xuICAgIH07XG5cbiAgICByZXR1cm4gVW5kZXJseWluZ09ic2VydmFibGU7XG4gIH0oT2JzZXJ2YWJsZUJhc2UpKTtcblxuICB2YXIgR3JvdXBlZE9ic2VydmFibGUgPSAoZnVuY3Rpb24gKF9fc3VwZXJfXykge1xuICAgIGluaGVyaXRzKEdyb3VwZWRPYnNlcnZhYmxlLCBfX3N1cGVyX18pO1xuICAgIGZ1bmN0aW9uIEdyb3VwZWRPYnNlcnZhYmxlKGtleSwgdW5kZXJseWluZ09ic2VydmFibGUsIG1lcmdlZERpc3Bvc2FibGUpIHtcbiAgICAgIF9fc3VwZXJfXy5jYWxsKHRoaXMpO1xuICAgICAgdGhpcy5rZXkgPSBrZXk7XG4gICAgICB0aGlzLnVuZGVybHlpbmdPYnNlcnZhYmxlID0gIW1lcmdlZERpc3Bvc2FibGUgP1xuICAgICAgICB1bmRlcmx5aW5nT2JzZXJ2YWJsZSA6XG4gICAgICAgIG5ldyBVbmRlcmx5aW5nT2JzZXJ2YWJsZShtZXJnZWREaXNwb3NhYmxlLCB1bmRlcmx5aW5nT2JzZXJ2YWJsZSk7XG4gICAgfVxuXG4gICAgR3JvdXBlZE9ic2VydmFibGUucHJvdG90eXBlLl9zdWJzY3JpYmUgPSBmdW5jdGlvbiAobykge1xuICAgICAgcmV0dXJuIHRoaXMudW5kZXJseWluZ09ic2VydmFibGUuc3Vic2NyaWJlKG8pO1xuICAgIH07XG5cbiAgICByZXR1cm4gR3JvdXBlZE9ic2VydmFibGU7XG4gIH0oT2JzZXJ2YWJsZSkpO1xuXG4gIC8qKlxuICAgKiAgUmVwcmVzZW50cyBhbiBvYmplY3QgdGhhdCBpcyBib3RoIGFuIG9ic2VydmFibGUgc2VxdWVuY2UgYXMgd2VsbCBhcyBhbiBvYnNlcnZlci5cbiAgICogIEVhY2ggbm90aWZpY2F0aW9uIGlzIGJyb2FkY2FzdGVkIHRvIGFsbCBzdWJzY3JpYmVkIG9ic2VydmVycy5cbiAgICovXG4gIHZhciBTdWJqZWN0ID0gUnguU3ViamVjdCA9IChmdW5jdGlvbiAoX19zdXBlcl9fKSB7XG4gICAgaW5oZXJpdHMoU3ViamVjdCwgX19zdXBlcl9fKTtcbiAgICBmdW5jdGlvbiBTdWJqZWN0KCkge1xuICAgICAgX19zdXBlcl9fLmNhbGwodGhpcyk7XG4gICAgICB0aGlzLmlzRGlzcG9zZWQgPSBmYWxzZTtcbiAgICAgIHRoaXMuaXNTdG9wcGVkID0gZmFsc2U7XG4gICAgICB0aGlzLm9ic2VydmVycyA9IFtdO1xuICAgICAgdGhpcy5oYXNFcnJvciA9IGZhbHNlO1xuICAgIH1cblxuICAgIGFkZFByb3BlcnRpZXMoU3ViamVjdC5wcm90b3R5cGUsIE9ic2VydmVyLnByb3RvdHlwZSwge1xuICAgICAgX3N1YnNjcmliZTogZnVuY3Rpb24gKG8pIHtcbiAgICAgICAgY2hlY2tEaXNwb3NlZCh0aGlzKTtcbiAgICAgICAgaWYgKCF0aGlzLmlzU3RvcHBlZCkge1xuICAgICAgICAgIHRoaXMub2JzZXJ2ZXJzLnB1c2gobyk7XG4gICAgICAgICAgcmV0dXJuIG5ldyBJbm5lclN1YnNjcmlwdGlvbih0aGlzLCBvKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAodGhpcy5oYXNFcnJvcikge1xuICAgICAgICAgIG8ub25FcnJvcih0aGlzLmVycm9yKTtcbiAgICAgICAgICByZXR1cm4gZGlzcG9zYWJsZUVtcHR5O1xuICAgICAgICB9XG4gICAgICAgIG8ub25Db21wbGV0ZWQoKTtcbiAgICAgICAgcmV0dXJuIGRpc3Bvc2FibGVFbXB0eTtcbiAgICAgIH0sXG4gICAgICAvKipcbiAgICAgICAqIEluZGljYXRlcyB3aGV0aGVyIHRoZSBzdWJqZWN0IGhhcyBvYnNlcnZlcnMgc3Vic2NyaWJlZCB0byBpdC5cbiAgICAgICAqIEByZXR1cm5zIHtCb29sZWFufSBJbmRpY2F0ZXMgd2hldGhlciB0aGUgc3ViamVjdCBoYXMgb2JzZXJ2ZXJzIHN1YnNjcmliZWQgdG8gaXQuXG4gICAgICAgKi9cbiAgICAgIGhhc09ic2VydmVyczogZnVuY3Rpb24gKCkgeyByZXR1cm4gdGhpcy5vYnNlcnZlcnMubGVuZ3RoID4gMDsgfSxcbiAgICAgIC8qKlxuICAgICAgICogTm90aWZpZXMgYWxsIHN1YnNjcmliZWQgb2JzZXJ2ZXJzIGFib3V0IHRoZSBlbmQgb2YgdGhlIHNlcXVlbmNlLlxuICAgICAgICovXG4gICAgICBvbkNvbXBsZXRlZDogZnVuY3Rpb24gKCkge1xuICAgICAgICBjaGVja0Rpc3Bvc2VkKHRoaXMpO1xuICAgICAgICBpZiAoIXRoaXMuaXNTdG9wcGVkKSB7XG4gICAgICAgICAgdGhpcy5pc1N0b3BwZWQgPSB0cnVlO1xuICAgICAgICAgIGZvciAodmFyIGkgPSAwLCBvcyA9IGNsb25lQXJyYXkodGhpcy5vYnNlcnZlcnMpLCBsZW4gPSBvcy5sZW5ndGg7IGkgPCBsZW47IGkrKykge1xuICAgICAgICAgICAgb3NbaV0ub25Db21wbGV0ZWQoKTtcbiAgICAgICAgICB9XG5cbiAgICAgICAgICB0aGlzLm9ic2VydmVycy5sZW5ndGggPSAwO1xuICAgICAgICB9XG4gICAgICB9LFxuICAgICAgLyoqXG4gICAgICAgKiBOb3RpZmllcyBhbGwgc3Vic2NyaWJlZCBvYnNlcnZlcnMgYWJvdXQgdGhlIGV4Y2VwdGlvbi5cbiAgICAgICAqIEBwYXJhbSB7TWl4ZWR9IGVycm9yIFRoZSBleGNlcHRpb24gdG8gc2VuZCB0byBhbGwgb2JzZXJ2ZXJzLlxuICAgICAgICovXG4gICAgICBvbkVycm9yOiBmdW5jdGlvbiAoZXJyb3IpIHtcbiAgICAgICAgY2hlY2tEaXNwb3NlZCh0aGlzKTtcbiAgICAgICAgaWYgKCF0aGlzLmlzU3RvcHBlZCkge1xuICAgICAgICAgIHRoaXMuaXNTdG9wcGVkID0gdHJ1ZTtcbiAgICAgICAgICB0aGlzLmVycm9yID0gZXJyb3I7XG4gICAgICAgICAgdGhpcy5oYXNFcnJvciA9IHRydWU7XG4gICAgICAgICAgZm9yICh2YXIgaSA9IDAsIG9zID0gY2xvbmVBcnJheSh0aGlzLm9ic2VydmVycyksIGxlbiA9IG9zLmxlbmd0aDsgaSA8IGxlbjsgaSsrKSB7XG4gICAgICAgICAgICBvc1tpXS5vbkVycm9yKGVycm9yKTtcbiAgICAgICAgICB9XG5cbiAgICAgICAgICB0aGlzLm9ic2VydmVycy5sZW5ndGggPSAwO1xuICAgICAgICB9XG4gICAgICB9LFxuICAgICAgLyoqXG4gICAgICAgKiBOb3RpZmllcyBhbGwgc3Vic2NyaWJlZCBvYnNlcnZlcnMgYWJvdXQgdGhlIGFycml2YWwgb2YgdGhlIHNwZWNpZmllZCBlbGVtZW50IGluIHRoZSBzZXF1ZW5jZS5cbiAgICAgICAqIEBwYXJhbSB7TWl4ZWR9IHZhbHVlIFRoZSB2YWx1ZSB0byBzZW5kIHRvIGFsbCBvYnNlcnZlcnMuXG4gICAgICAgKi9cbiAgICAgIG9uTmV4dDogZnVuY3Rpb24gKHZhbHVlKSB7XG4gICAgICAgIGNoZWNrRGlzcG9zZWQodGhpcyk7XG4gICAgICAgIGlmICghdGhpcy5pc1N0b3BwZWQpIHtcbiAgICAgICAgICBmb3IgKHZhciBpID0gMCwgb3MgPSBjbG9uZUFycmF5KHRoaXMub2JzZXJ2ZXJzKSwgbGVuID0gb3MubGVuZ3RoOyBpIDwgbGVuOyBpKyspIHtcbiAgICAgICAgICAgIG9zW2ldLm9uTmV4dCh2YWx1ZSk7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9LFxuICAgICAgLyoqXG4gICAgICAgKiBVbnN1YnNjcmliZSBhbGwgb2JzZXJ2ZXJzIGFuZCByZWxlYXNlIHJlc291cmNlcy5cbiAgICAgICAqL1xuICAgICAgZGlzcG9zZTogZnVuY3Rpb24gKCkge1xuICAgICAgICB0aGlzLmlzRGlzcG9zZWQgPSB0cnVlO1xuICAgICAgICB0aGlzLm9ic2VydmVycyA9IG51bGw7XG4gICAgICB9XG4gICAgfSk7XG5cbiAgICAvKipcbiAgICAgKiBDcmVhdGVzIGEgc3ViamVjdCBmcm9tIHRoZSBzcGVjaWZpZWQgb2JzZXJ2ZXIgYW5kIG9ic2VydmFibGUuXG4gICAgICogQHBhcmFtIHtPYnNlcnZlcn0gb2JzZXJ2ZXIgVGhlIG9ic2VydmVyIHVzZWQgdG8gc2VuZCBtZXNzYWdlcyB0byB0aGUgc3ViamVjdC5cbiAgICAgKiBAcGFyYW0ge09ic2VydmFibGV9IG9ic2VydmFibGUgVGhlIG9ic2VydmFibGUgdXNlZCB0byBzdWJzY3JpYmUgdG8gbWVzc2FnZXMgc2VudCBmcm9tIHRoZSBzdWJqZWN0LlxuICAgICAqIEByZXR1cm5zIHtTdWJqZWN0fSBTdWJqZWN0IGltcGxlbWVudGVkIHVzaW5nIHRoZSBnaXZlbiBvYnNlcnZlciBhbmQgb2JzZXJ2YWJsZS5cbiAgICAgKi9cbiAgICBTdWJqZWN0LmNyZWF0ZSA9IGZ1bmN0aW9uIChvYnNlcnZlciwgb2JzZXJ2YWJsZSkge1xuICAgICAgcmV0dXJuIG5ldyBBbm9ueW1vdXNTdWJqZWN0KG9ic2VydmVyLCBvYnNlcnZhYmxlKTtcbiAgICB9O1xuXG4gICAgcmV0dXJuIFN1YmplY3Q7XG4gIH0oT2JzZXJ2YWJsZSkpO1xuXG4gIC8qKlxuICAgKiAgUmVwcmVzZW50cyB0aGUgcmVzdWx0IG9mIGFuIGFzeW5jaHJvbm91cyBvcGVyYXRpb24uXG4gICAqICBUaGUgbGFzdCB2YWx1ZSBiZWZvcmUgdGhlIE9uQ29tcGxldGVkIG5vdGlmaWNhdGlvbiwgb3IgdGhlIGVycm9yIHJlY2VpdmVkIHRocm91Z2ggT25FcnJvciwgaXMgc2VudCB0byBhbGwgc3Vic2NyaWJlZCBvYnNlcnZlcnMuXG4gICAqL1xuICB2YXIgQXN5bmNTdWJqZWN0ID0gUnguQXN5bmNTdWJqZWN0ID0gKGZ1bmN0aW9uIChfX3N1cGVyX18pIHtcbiAgICBpbmhlcml0cyhBc3luY1N1YmplY3QsIF9fc3VwZXJfXyk7XG5cbiAgICAvKipcbiAgICAgKiBDcmVhdGVzIGEgc3ViamVjdCB0aGF0IGNhbiBvbmx5IHJlY2VpdmUgb25lIHZhbHVlIGFuZCB0aGF0IHZhbHVlIGlzIGNhY2hlZCBmb3IgYWxsIGZ1dHVyZSBvYnNlcnZhdGlvbnMuXG4gICAgICogQGNvbnN0cnVjdG9yXG4gICAgICovXG4gICAgZnVuY3Rpb24gQXN5bmNTdWJqZWN0KCkge1xuICAgICAgX19zdXBlcl9fLmNhbGwodGhpcyk7XG4gICAgICB0aGlzLmlzRGlzcG9zZWQgPSBmYWxzZTtcbiAgICAgIHRoaXMuaXNTdG9wcGVkID0gZmFsc2U7XG4gICAgICB0aGlzLmhhc1ZhbHVlID0gZmFsc2U7XG4gICAgICB0aGlzLm9ic2VydmVycyA9IFtdO1xuICAgICAgdGhpcy5oYXNFcnJvciA9IGZhbHNlO1xuICAgIH1cblxuICAgIGFkZFByb3BlcnRpZXMoQXN5bmNTdWJqZWN0LnByb3RvdHlwZSwgT2JzZXJ2ZXIsIHtcbiAgICAgIF9zdWJzY3JpYmU6IGZ1bmN0aW9uIChvKSB7XG4gICAgICAgIGNoZWNrRGlzcG9zZWQodGhpcyk7XG5cbiAgICAgICAgaWYgKCF0aGlzLmlzU3RvcHBlZCkge1xuICAgICAgICAgIHRoaXMub2JzZXJ2ZXJzLnB1c2gobyk7XG4gICAgICAgICAgcmV0dXJuIG5ldyBJbm5lclN1YnNjcmlwdGlvbih0aGlzLCBvKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmICh0aGlzLmhhc0Vycm9yKSB7XG4gICAgICAgICAgby5vbkVycm9yKHRoaXMuZXJyb3IpO1xuICAgICAgICB9IGVsc2UgaWYgKHRoaXMuaGFzVmFsdWUpIHtcbiAgICAgICAgICBvLm9uTmV4dCh0aGlzLnZhbHVlKTtcbiAgICAgICAgICBvLm9uQ29tcGxldGVkKCk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgby5vbkNvbXBsZXRlZCgpO1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIGRpc3Bvc2FibGVFbXB0eTtcbiAgICAgIH0sXG4gICAgICAvKipcbiAgICAgICAqIEluZGljYXRlcyB3aGV0aGVyIHRoZSBzdWJqZWN0IGhhcyBvYnNlcnZlcnMgc3Vic2NyaWJlZCB0byBpdC5cbiAgICAgICAqIEByZXR1cm5zIHtCb29sZWFufSBJbmRpY2F0ZXMgd2hldGhlciB0aGUgc3ViamVjdCBoYXMgb2JzZXJ2ZXJzIHN1YnNjcmliZWQgdG8gaXQuXG4gICAgICAgKi9cbiAgICAgIGhhc09ic2VydmVyczogZnVuY3Rpb24gKCkge1xuICAgICAgICBjaGVja0Rpc3Bvc2VkKHRoaXMpO1xuICAgICAgICByZXR1cm4gdGhpcy5vYnNlcnZlcnMubGVuZ3RoID4gMDtcbiAgICAgIH0sXG4gICAgICAvKipcbiAgICAgICAqIE5vdGlmaWVzIGFsbCBzdWJzY3JpYmVkIG9ic2VydmVycyBhYm91dCB0aGUgZW5kIG9mIHRoZSBzZXF1ZW5jZSwgYWxzbyBjYXVzaW5nIHRoZSBsYXN0IHJlY2VpdmVkIHZhbHVlIHRvIGJlIHNlbnQgb3V0IChpZiBhbnkpLlxuICAgICAgICovXG4gICAgICBvbkNvbXBsZXRlZDogZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgaSwgbGVuO1xuICAgICAgICBjaGVja0Rpc3Bvc2VkKHRoaXMpO1xuICAgICAgICBpZiAoIXRoaXMuaXNTdG9wcGVkKSB7XG4gICAgICAgICAgdGhpcy5pc1N0b3BwZWQgPSB0cnVlO1xuICAgICAgICAgIHZhciBvcyA9IGNsb25lQXJyYXkodGhpcy5vYnNlcnZlcnMpLCBsZW4gPSBvcy5sZW5ndGg7XG5cbiAgICAgICAgICBpZiAodGhpcy5oYXNWYWx1ZSkge1xuICAgICAgICAgICAgZm9yIChpID0gMDsgaSA8IGxlbjsgaSsrKSB7XG4gICAgICAgICAgICAgIHZhciBvID0gb3NbaV07XG4gICAgICAgICAgICAgIG8ub25OZXh0KHRoaXMudmFsdWUpO1xuICAgICAgICAgICAgICBvLm9uQ29tcGxldGVkKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGZvciAoaSA9IDA7IGkgPCBsZW47IGkrKykge1xuICAgICAgICAgICAgICBvc1tpXS5vbkNvbXBsZXRlZCgpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cblxuICAgICAgICAgIHRoaXMub2JzZXJ2ZXJzLmxlbmd0aCA9IDA7XG4gICAgICAgIH1cbiAgICAgIH0sXG4gICAgICAvKipcbiAgICAgICAqIE5vdGlmaWVzIGFsbCBzdWJzY3JpYmVkIG9ic2VydmVycyBhYm91dCB0aGUgZXJyb3IuXG4gICAgICAgKiBAcGFyYW0ge01peGVkfSBlcnJvciBUaGUgRXJyb3IgdG8gc2VuZCB0byBhbGwgb2JzZXJ2ZXJzLlxuICAgICAgICovXG4gICAgICBvbkVycm9yOiBmdW5jdGlvbiAoZXJyb3IpIHtcbiAgICAgICAgY2hlY2tEaXNwb3NlZCh0aGlzKTtcbiAgICAgICAgaWYgKCF0aGlzLmlzU3RvcHBlZCkge1xuICAgICAgICAgIHRoaXMuaXNTdG9wcGVkID0gdHJ1ZTtcbiAgICAgICAgICB0aGlzLmhhc0Vycm9yID0gdHJ1ZTtcbiAgICAgICAgICB0aGlzLmVycm9yID0gZXJyb3I7XG5cbiAgICAgICAgICBmb3IgKHZhciBpID0gMCwgb3MgPSBjbG9uZUFycmF5KHRoaXMub2JzZXJ2ZXJzKSwgbGVuID0gb3MubGVuZ3RoOyBpIDwgbGVuOyBpKyspIHtcbiAgICAgICAgICAgIG9zW2ldLm9uRXJyb3IoZXJyb3IpO1xuICAgICAgICAgIH1cblxuICAgICAgICAgIHRoaXMub2JzZXJ2ZXJzLmxlbmd0aCA9IDA7XG4gICAgICAgIH1cbiAgICAgIH0sXG4gICAgICAvKipcbiAgICAgICAqIFNlbmRzIGEgdmFsdWUgdG8gdGhlIHN1YmplY3QuIFRoZSBsYXN0IHZhbHVlIHJlY2VpdmVkIGJlZm9yZSBzdWNjZXNzZnVsIHRlcm1pbmF0aW9uIHdpbGwgYmUgc2VudCB0byBhbGwgc3Vic2NyaWJlZCBhbmQgZnV0dXJlIG9ic2VydmVycy5cbiAgICAgICAqIEBwYXJhbSB7TWl4ZWR9IHZhbHVlIFRoZSB2YWx1ZSB0byBzdG9yZSBpbiB0aGUgc3ViamVjdC5cbiAgICAgICAqL1xuICAgICAgb25OZXh0OiBmdW5jdGlvbiAodmFsdWUpIHtcbiAgICAgICAgY2hlY2tEaXNwb3NlZCh0aGlzKTtcbiAgICAgICAgaWYgKHRoaXMuaXNTdG9wcGVkKSB7IHJldHVybjsgfVxuICAgICAgICB0aGlzLnZhbHVlID0gdmFsdWU7XG4gICAgICAgIHRoaXMuaGFzVmFsdWUgPSB0cnVlO1xuICAgICAgfSxcbiAgICAgIC8qKlxuICAgICAgICogVW5zdWJzY3JpYmUgYWxsIG9ic2VydmVycyBhbmQgcmVsZWFzZSByZXNvdXJjZXMuXG4gICAgICAgKi9cbiAgICAgIGRpc3Bvc2U6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdGhpcy5pc0Rpc3Bvc2VkID0gdHJ1ZTtcbiAgICAgICAgdGhpcy5vYnNlcnZlcnMgPSBudWxsO1xuICAgICAgICB0aGlzLmVycm9yID0gbnVsbDtcbiAgICAgICAgdGhpcy52YWx1ZSA9IG51bGw7XG4gICAgICB9XG4gICAgfSk7XG5cbiAgICByZXR1cm4gQXN5bmNTdWJqZWN0O1xuICB9KE9ic2VydmFibGUpKTtcblxuICB2YXIgQW5vbnltb3VzU3ViamVjdCA9IFJ4LkFub255bW91c1N1YmplY3QgPSAoZnVuY3Rpb24gKF9fc3VwZXJfXykge1xuICAgIGluaGVyaXRzKEFub255bW91c1N1YmplY3QsIF9fc3VwZXJfXyk7XG4gICAgZnVuY3Rpb24gQW5vbnltb3VzU3ViamVjdChvYnNlcnZlciwgb2JzZXJ2YWJsZSkge1xuICAgICAgdGhpcy5vYnNlcnZlciA9IG9ic2VydmVyO1xuICAgICAgdGhpcy5vYnNlcnZhYmxlID0gb2JzZXJ2YWJsZTtcbiAgICAgIF9fc3VwZXJfXy5jYWxsKHRoaXMpO1xuICAgIH1cblxuICAgIGFkZFByb3BlcnRpZXMoQW5vbnltb3VzU3ViamVjdC5wcm90b3R5cGUsIE9ic2VydmVyLnByb3RvdHlwZSwge1xuICAgICAgX3N1YnNjcmliZTogZnVuY3Rpb24gKG8pIHtcbiAgICAgICAgcmV0dXJuIHRoaXMub2JzZXJ2YWJsZS5zdWJzY3JpYmUobyk7XG4gICAgICB9LFxuICAgICAgb25Db21wbGV0ZWQ6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdGhpcy5vYnNlcnZlci5vbkNvbXBsZXRlZCgpO1xuICAgICAgfSxcbiAgICAgIG9uRXJyb3I6IGZ1bmN0aW9uIChlcnJvcikge1xuICAgICAgICB0aGlzLm9ic2VydmVyLm9uRXJyb3IoZXJyb3IpO1xuICAgICAgfSxcbiAgICAgIG9uTmV4dDogZnVuY3Rpb24gKHZhbHVlKSB7XG4gICAgICAgIHRoaXMub2JzZXJ2ZXIub25OZXh0KHZhbHVlKTtcbiAgICAgIH1cbiAgICB9KTtcblxuICAgIHJldHVybiBBbm9ueW1vdXNTdWJqZWN0O1xuICB9KE9ic2VydmFibGUpKTtcblxuICAvKipcbiAgKiBVc2VkIHRvIHBhdXNlIGFuZCByZXN1bWUgc3RyZWFtcy5cbiAgKi9cbiAgUnguUGF1c2VyID0gKGZ1bmN0aW9uIChfX3N1cGVyX18pIHtcbiAgICBpbmhlcml0cyhQYXVzZXIsIF9fc3VwZXJfXyk7XG4gICAgZnVuY3Rpb24gUGF1c2VyKCkge1xuICAgICAgX19zdXBlcl9fLmNhbGwodGhpcyk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogUGF1c2VzIHRoZSB1bmRlcmx5aW5nIHNlcXVlbmNlLlxuICAgICAqL1xuICAgIFBhdXNlci5wcm90b3R5cGUucGF1c2UgPSBmdW5jdGlvbiAoKSB7IHRoaXMub25OZXh0KGZhbHNlKTsgfTtcblxuICAgIC8qKlxuICAgICogUmVzdW1lcyB0aGUgdW5kZXJseWluZyBzZXF1ZW5jZS5cbiAgICAqL1xuICAgIFBhdXNlci5wcm90b3R5cGUucmVzdW1lID0gZnVuY3Rpb24gKCkgeyB0aGlzLm9uTmV4dCh0cnVlKTsgfTtcblxuICAgIHJldHVybiBQYXVzZXI7XG4gIH0oU3ViamVjdCkpO1xuXG4gIGlmICh0eXBlb2YgZGVmaW5lID09ICdmdW5jdGlvbicgJiYgdHlwZW9mIGRlZmluZS5hbWQgPT0gJ29iamVjdCcgJiYgZGVmaW5lLmFtZCkge1xuICAgIHJvb3QuUnggPSBSeDtcblxuICAgIGRlZmluZShmdW5jdGlvbigpIHtcbiAgICAgIHJldHVybiBSeDtcbiAgICB9KTtcbiAgfSBlbHNlIGlmIChmcmVlRXhwb3J0cyAmJiBmcmVlTW9kdWxlKSB7XG4gICAgLy8gaW4gTm9kZS5qcyBvciBSaW5nb0pTXG4gICAgaWYgKG1vZHVsZUV4cG9ydHMpIHtcbiAgICAgIChmcmVlTW9kdWxlLmV4cG9ydHMgPSBSeCkuUnggPSBSeDtcbiAgICB9IGVsc2Uge1xuICAgICAgZnJlZUV4cG9ydHMuUnggPSBSeDtcbiAgICB9XG4gIH0gZWxzZSB7XG4gICAgLy8gaW4gYSBicm93c2VyIG9yIFJoaW5vXG4gICAgcm9vdC5SeCA9IFJ4O1xuICB9XG5cbiAgLy8gQWxsIGNvZGUgYmVmb3JlIHRoaXMgcG9pbnQgd2lsbCBiZSBmaWx0ZXJlZCBmcm9tIHN0YWNrIHRyYWNlcy5cbiAgdmFyIHJFbmRpbmdMaW5lID0gY2FwdHVyZUxpbmUoKTtcblxufS5jYWxsKHRoaXMpKTtcblxuXG5cbi8qKioqKioqKioqKioqKioqKlxuICoqIFdFQlBBQ0sgRk9PVEVSXG4gKiogLi9+L3J4L2Rpc3QvcnguYWxsLmpzXG4gKiogbW9kdWxlIGlkID0gMTBcbiAqKiBtb2R1bGUgY2h1bmtzID0gMFxuICoqLyIsIm1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24obW9kdWxlKSB7XHJcblx0aWYoIW1vZHVsZS53ZWJwYWNrUG9seWZpbGwpIHtcclxuXHRcdG1vZHVsZS5kZXByZWNhdGUgPSBmdW5jdGlvbigpIHt9O1xyXG5cdFx0bW9kdWxlLnBhdGhzID0gW107XHJcblx0XHQvLyBtb2R1bGUucGFyZW50ID0gdW5kZWZpbmVkIGJ5IGRlZmF1bHRcclxuXHRcdG1vZHVsZS5jaGlsZHJlbiA9IFtdO1xyXG5cdFx0bW9kdWxlLndlYnBhY2tQb2x5ZmlsbCA9IDE7XHJcblx0fVxyXG5cdHJldHVybiBtb2R1bGU7XHJcbn1cclxuXG5cblxuLyoqKioqKioqKioqKioqKioqXG4gKiogV0VCUEFDSyBGT09URVJcbiAqKiAod2VicGFjaykvYnVpbGRpbi9tb2R1bGUuanNcbiAqKiBtb2R1bGUgaWQgPSAxMVxuICoqIG1vZHVsZSBjaHVua3MgPSAwXG4gKiovIiwiLy8gc2hpbSBmb3IgdXNpbmcgcHJvY2VzcyBpbiBicm93c2VyXG5cbnZhciBwcm9jZXNzID0gbW9kdWxlLmV4cG9ydHMgPSB7fTtcbnZhciBxdWV1ZSA9IFtdO1xudmFyIGRyYWluaW5nID0gZmFsc2U7XG52YXIgY3VycmVudFF1ZXVlO1xudmFyIHF1ZXVlSW5kZXggPSAtMTtcblxuZnVuY3Rpb24gY2xlYW5VcE5leHRUaWNrKCkge1xuICAgIGRyYWluaW5nID0gZmFsc2U7XG4gICAgaWYgKGN1cnJlbnRRdWV1ZS5sZW5ndGgpIHtcbiAgICAgICAgcXVldWUgPSBjdXJyZW50UXVldWUuY29uY2F0KHF1ZXVlKTtcbiAgICB9IGVsc2Uge1xuICAgICAgICBxdWV1ZUluZGV4ID0gLTE7XG4gICAgfVxuICAgIGlmIChxdWV1ZS5sZW5ndGgpIHtcbiAgICAgICAgZHJhaW5RdWV1ZSgpO1xuICAgIH1cbn1cblxuZnVuY3Rpb24gZHJhaW5RdWV1ZSgpIHtcbiAgICBpZiAoZHJhaW5pbmcpIHtcbiAgICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICB2YXIgdGltZW91dCA9IHNldFRpbWVvdXQoY2xlYW5VcE5leHRUaWNrKTtcbiAgICBkcmFpbmluZyA9IHRydWU7XG5cbiAgICB2YXIgbGVuID0gcXVldWUubGVuZ3RoO1xuICAgIHdoaWxlKGxlbikge1xuICAgICAgICBjdXJyZW50UXVldWUgPSBxdWV1ZTtcbiAgICAgICAgcXVldWUgPSBbXTtcbiAgICAgICAgd2hpbGUgKCsrcXVldWVJbmRleCA8IGxlbikge1xuICAgICAgICAgICAgaWYgKGN1cnJlbnRRdWV1ZSkge1xuICAgICAgICAgICAgICAgIGN1cnJlbnRRdWV1ZVtxdWV1ZUluZGV4XS5ydW4oKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBxdWV1ZUluZGV4ID0gLTE7XG4gICAgICAgIGxlbiA9IHF1ZXVlLmxlbmd0aDtcbiAgICB9XG4gICAgY3VycmVudFF1ZXVlID0gbnVsbDtcbiAgICBkcmFpbmluZyA9IGZhbHNlO1xuICAgIGNsZWFyVGltZW91dCh0aW1lb3V0KTtcbn1cblxucHJvY2Vzcy5uZXh0VGljayA9IGZ1bmN0aW9uIChmdW4pIHtcbiAgICB2YXIgYXJncyA9IG5ldyBBcnJheShhcmd1bWVudHMubGVuZ3RoIC0gMSk7XG4gICAgaWYgKGFyZ3VtZW50cy5sZW5ndGggPiAxKSB7XG4gICAgICAgIGZvciAodmFyIGkgPSAxOyBpIDwgYXJndW1lbnRzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICBhcmdzW2kgLSAxXSA9IGFyZ3VtZW50c1tpXTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBxdWV1ZS5wdXNoKG5ldyBJdGVtKGZ1biwgYXJncykpO1xuICAgIGlmIChxdWV1ZS5sZW5ndGggPT09IDEgJiYgIWRyYWluaW5nKSB7XG4gICAgICAgIHNldFRpbWVvdXQoZHJhaW5RdWV1ZSwgMCk7XG4gICAgfVxufTtcblxuLy8gdjggbGlrZXMgcHJlZGljdGlibGUgb2JqZWN0c1xuZnVuY3Rpb24gSXRlbShmdW4sIGFycmF5KSB7XG4gICAgdGhpcy5mdW4gPSBmdW47XG4gICAgdGhpcy5hcnJheSA9IGFycmF5O1xufVxuSXRlbS5wcm90b3R5cGUucnVuID0gZnVuY3Rpb24gKCkge1xuICAgIHRoaXMuZnVuLmFwcGx5KG51bGwsIHRoaXMuYXJyYXkpO1xufTtcbnByb2Nlc3MudGl0bGUgPSAnYnJvd3Nlcic7XG5wcm9jZXNzLmJyb3dzZXIgPSB0cnVlO1xucHJvY2Vzcy5lbnYgPSB7fTtcbnByb2Nlc3MuYXJndiA9IFtdO1xucHJvY2Vzcy52ZXJzaW9uID0gJyc7IC8vIGVtcHR5IHN0cmluZyB0byBhdm9pZCByZWdleHAgaXNzdWVzXG5wcm9jZXNzLnZlcnNpb25zID0ge307XG5cbmZ1bmN0aW9uIG5vb3AoKSB7fVxuXG5wcm9jZXNzLm9uID0gbm9vcDtcbnByb2Nlc3MuYWRkTGlzdGVuZXIgPSBub29wO1xucHJvY2Vzcy5vbmNlID0gbm9vcDtcbnByb2Nlc3Mub2ZmID0gbm9vcDtcbnByb2Nlc3MucmVtb3ZlTGlzdGVuZXIgPSBub29wO1xucHJvY2Vzcy5yZW1vdmVBbGxMaXN0ZW5lcnMgPSBub29wO1xucHJvY2Vzcy5lbWl0ID0gbm9vcDtcblxucHJvY2Vzcy5iaW5kaW5nID0gZnVuY3Rpb24gKG5hbWUpIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoJ3Byb2Nlc3MuYmluZGluZyBpcyBub3Qgc3VwcG9ydGVkJyk7XG59O1xuXG5wcm9jZXNzLmN3ZCA9IGZ1bmN0aW9uICgpIHsgcmV0dXJuICcvJyB9O1xucHJvY2Vzcy5jaGRpciA9IGZ1bmN0aW9uIChkaXIpIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoJ3Byb2Nlc3MuY2hkaXIgaXMgbm90IHN1cHBvcnRlZCcpO1xufTtcbnByb2Nlc3MudW1hc2sgPSBmdW5jdGlvbigpIHsgcmV0dXJuIDA7IH07XG5cblxuXG4vKioqKioqKioqKioqKioqKipcbiAqKiBXRUJQQUNLIEZPT1RFUlxuICoqICh3ZWJwYWNrKS9+L25vZGUtbGlicy1icm93c2VyL34vcHJvY2Vzcy9icm93c2VyLmpzXG4gKiogbW9kdWxlIGlkID0gMTJcbiAqKiBtb2R1bGUgY2h1bmtzID0gMFxuICoqLyJdLCJzb3VyY2VSb290IjoiIn0=